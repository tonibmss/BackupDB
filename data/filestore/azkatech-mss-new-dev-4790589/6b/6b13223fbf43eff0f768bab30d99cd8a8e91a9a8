
/* /web_studio/static/src/js/action_manager.js defined in bundle 'web_studio.assets' */
odoo.define('web_studio.ActionManager',function(require){"use strict";var ActionManager=require('web.ActionManager');var bus=require('web_studio.bus');ActionManager.include({custom_events:_.extend({},ActionManager.prototype.custom_events,{'reload_action':'_onReloadAction',}),init:function(){this._super.apply(this,arguments);this.studioControllerIndex=undefined;bus.on('edition_mode_entered',this,this._onEditionModeEntered);bus.on('studio_toggled',this,this._onStudioToggled);},clearUncommittedChanges:function(){var currentController=this.getCurrentController();if(currentController&&!currentController.widget){return Promise.resolve();}
return this._super.apply(this,arguments);},getCurrentStudioAction:function(){var controller=this.getCurrentStudioController();return controller?this.actions[controller.actionID]:null;},getCurrentStudioController:function(){var controllerID=this.controllerStack[this.studioControllerIndex];var controller=this.controllers[controllerID];return controller;},getLastAction:function(){var currentControllerID=_.last(this.controllerStack);var controller=currentControllerID?this.controllers[currentControllerID]:null;return controller?this.actions[controller.actionID]:null;},restoreStudioAction:function(){var self=this;var studioControllerIndex=this.studioControllerIndex;var controllerID=this.controllerStack[studioControllerIndex];var controller=this.controllers[controllerID];var action=this.actions[controller.actionID];var index=_.findIndex(this.controllerStack,function(controllerID){var controller=self.controllers[controllerID];return controller.actionID===action.jsID;});this.studioControllerIndex=undefined;var options={additional_context:action.context,index:index,viewType:this.studioViewType,};if(this.studioViewType==='form'){if(controller.widget){options.resID=controller.widget.exportState().currentId;}}
return this.doAction(action.id,options);},studioHistoryBack:function(){var controller=this.controllerStack[this.studioControllerIndex+1];this._restoreController(controller);},_detachCurrentController:function(){var currentAction=this.getCurrentAction();if(currentAction&&!currentAction.studioNavigation){this._super.apply(this,arguments);}},_executeWindowAction:function(action,options){if(action.studioNavigation){this._processStudioAction(action,options);this.actions[action.jsID]=action;var controller={actionID:action.jsID,jsID:_.uniqueId('controller_'),};this.controllers[controller.jsID]=controller;this.controllerStack.push(controller.jsID);this.studioControllerIndex=0;this.navigatingInStudio=true;return Promise.resolve(action);}
return this._super.apply(this,arguments);},_getControllerStackIndex:function(options){if(options.studio_clear_studio_breadcrumbs){return this.studioControllerIndex+1;}
return this._super.apply(this,arguments);},_pushController:function(controller){var length;if(this.navigatingInStudio){this.navigatingInStudio=false;length=this.controllerStack.length;var toDestroy=this.controllerStack.slice(0,length-1);this._removeControllers(toDestroy);this.controllerStack=this.controllerStack.slice(length-1);controller.index=1;}
this._super.apply(this,arguments);if(this.studioControllerIndex!==undefined){var indexFrom=this.studioControllerIndex+1;var indexTo=this.controllerStack.length-1;var breadcrumbs=this._getBreadcrumbs(this.controllerStack.slice(indexFrom,indexTo));controller.widget.updateControlPanel({breadcrumbs:breadcrumbs},{clear:false});}},_processStudioAction:function(action){action.controllers={};var views=_.map(action.views,function(view){return{type:view[1],viewID:view[0],};});action._views=action.views;action.views=views;},_onEditionModeEntered:function(viewType){if(viewType!=='search'){this.studioViewType=viewType;}},_onPushState:function(ev){if(!ev.data.studioPushState){this._super.apply(this,arguments);}},_onReloadAction:function(ev){var self=this;var action=_.findWhere(this.actions,{id:ev.data.actionID});this._loadAction(action.id).then(function(result){self._preprocessAction(result,{additional_context:action.context});self._processStudioAction(result,{});result.jsID=action.jsID;self.actions[action.jsID]=result;bus.trigger('action_changed',result);if(ev.data.onSuccess){ev.data.onSuccess(result);}});},_onStudioToggled:function(mode){if(mode==='main'){this.studioControllerIndex=this.controllerStack.length-2;}},});});;

/* /web_studio/static/src/js/bus.js defined in bundle 'web_studio.assets' */
odoo.define('web_studio.bus',function(require){"use strict";var Bus=require('web.Bus');var bus=new Bus();return bus;});;

/* /web_studio/static/src/js/systray_item.js defined in bundle 'web_studio.assets' */
odoo.define('web_studio.SystrayItem',function(require){"use strict";var SystrayMenu=require('web.SystrayMenu');var Widget=require('web.Widget');var SystrayItem=Widget.extend({events:{'click':'_onClick',},sequence:1,template:'web_studio.SystrayItem',init:function(){this._super.apply(this,arguments);this.disabled=true;},disable:function(){this.disabled=true;this.renderElement();},enable:function(){this.disabled=false;this.renderElement();},_onClick:function(event){event.preventDefault();this.disable();this.trigger_up('studio_icon_clicked');},});SystrayMenu.Items.unshift(SystrayItem);return SystrayItem;});;

/* /web_studio/static/src/js/web_client.js defined in bundle 'web_studio.assets' */
odoo.define('web_studio.WebClient',function(require){"use strict";var ajax=require('web.ajax');var core=require('web.core');var session=require('web.session');var WebClient=require('web.WebClient');var bus=require('web_studio.bus');var SystrayItem=require('web_studio.SystrayItem');var _t=core._t;WebClient.include({custom_events:_.extend({},WebClient.prototype.custom_events,{'new_app_created':'_onNewAppCreated','reload_menu_data':'_onReloadMenuData','studio_icon_clicked':'_onStudioIconClicked','studio_history_back':'_onStudioHistoryBack','switch_studio_view':'_onSwitchStudioView',}),init:function(){this._super.apply(this,arguments);this.studioMode=undefined;},current_action_updated:function(action){this._super.apply(this,arguments);if(!this.studioMode){this._updateStudioSystray(this._isStudioEditable(action));}},instanciate_menu_widgets:function(){var self=this;return this._super.apply(this,arguments).then(function(){if(self.studioMode==='main'){var action=self.action_manager.getCurrentStudioAction();if(action){return self.menu.renderStudioMenu(action);}}});},do_action:function(action,options){if(this.studioMode==='main'&&action.target==='new'){this.do_warn("Studio",_t("Wizards are not editable with Studio."));return Promise.reject();}
var blockPushState=this.studioMode&&!action.studioNavigation;if(blockPushState){options=options||{};options.pushState=false;}
var prom=this._super(action,options)
prom.then(function(action){if(blockPushState){action.pushState=false;}});return prom;},on_app_clicked:function(){var self=this;if(this.studioMode){this.openingMenu=true;}
return this._super.apply(this,arguments).then(function(){self.openingMenu=false;});},openAppCreator:function(){var self=this;return this.do_action('action_web_studio_app_creator').then(function(){self.menu.toggle_mode(true,false);});},show_application:function(){var self=this;var qs=$.deparam.querystring();self.studioMode=_.contains(['main','app_creator'],qs.studio)?qs.studio:false;var def=self.studioMode?ajax.loadLibs({assetLibs:this._studioAssets}):Promise.resolve();var _super=this._super;return def.then(function(){return _super.apply(self,arguments).then(function(){if(self.studioMode){self._updateContext();return self._openStudio();}});});},toggle_home_menu:function(display){if(this.studioMode){if(display){this.studioMode='app_creator';}else{var action=this.action_manager.getCurrentAction();if(action&&action.tag==='action_web_studio_app_creator'){this.studioMode='app_creator';}else{this.studioMode='main';}
if(this.openingMenu){return;}}
this._toggleStudioMode();}else{if(display){this._updateStudioSystray(true);}}
this._super.apply(this,arguments);},_closeStudio:function(){var self=this;var def;var action=this.action_manager.getCurrentAction();if(this.home_menu_displayed){this.toggle_home_menu(true);this.menu.toggle_mode(true,false);}else if(action.tag==='action_web_studio_app_creator'){this.toggle_home_menu(true);this.menu.toggle_mode(true,false);}else{def=this.action_manager.restoreStudioAction();}
return Promise.resolve(def).then(function(){self._toggleStudioMode();self.$el.toggleClass('o_in_studio',!!self.studioMode);});},_isStudioEditable:function(action){return action&&action.xml_id&&action.type==='ir.actions.act_window'&&action.res_model&&(action.res_model.indexOf('settings')===-1||action.res_model.indexOf('x_')===0)&&action.res_model!=='board.board'?true:false;},_navigateInStudio:function(viewType){var self=this;var action=this.action_manager.getLastAction();var options={action:action,viewType:viewType,};return this._openStudioMain(options).then(function(){self.openingMenu=false;});},_openMenu:function(action,options){var self=this;if(this.studioMode){if(!this._isStudioEditable(action)){this.do_warn("Studio",_t("This action is not editable by Studio"));return Promise.reject();}
action.studioNavigation=true;}
return this._super.apply(this,arguments).then(function(){if(self.studioMode){return self._navigateInStudio(options.viewType);}});},_studioAssets:['web_editor.compiled_assets_wysiwyg','web_studio.compiled_assets_studio'],_openStudio:function(){var self=this;var def=ajax.loadLibs({assetLibs:this._studioAssets});if(this.studioMode==='main'){var action=this.action_manager.getCurrentAction();var controller=this.action_manager.getCurrentController();def=def.then(this._openStudioMain.bind(this,{action:action,controllerState:controller.widget.exportState(),viewType:controller.viewType,}));}else{def.then(function(){self.menu.toggle_mode(true,false);});}
return Promise.resolve(def).then(function(){self.$el.toggleClass('o_in_studio',!!self.studioMode);self._toggleStudioMode();});},_openStudioMain:function(options){return this.do_action('action_web_studio_action_editor',options);},_redrawMenuWidgets:function(){var self=this;var oldHomeMenu=this.home_menu;var oldMenu=this.menu;return this.instanciate_menu_widgets().then(function(){if(oldHomeMenu){oldHomeMenu.destroy();}
if(oldMenu){oldMenu.destroy();}
self.menu.$el.prependTo(self.$el);});},_toggleStudioMode:function(){bus.trigger('studio_toggled',this.studioMode);var qs=$.deparam.querystring();if(this.studioMode){qs.studio=this.studioMode;}else{delete qs.studio;}
var l=window.location;var url=l.protocol+"//"+l.host+l.pathname+'?'+$.param(qs)+l.hash;window.history.pushState({path:url},'',url);},_updateContext:function(){if(this.studioMode){session.user_context.studio=1;}else{delete session.user_context.studio;}},_updateStudioSystray:function(show){var systray_item=_.find(this.menu.systray_menu.widgets,function(item){return item instanceof SystrayItem;});if(show){systray_item.enable();}else{systray_item.disable();}},_onStudioHistoryBack:function(){this.action_manager.studioHistoryBack();},_onNewAppCreated:function(ev){var self=this;this._redrawMenuWidgets().then(function(){self.on_app_clicked({data:{menu_id:ev.data.menu_id,action_id:ev.data.action_id,options:{viewType:'form',}}}).then(function(){self.menu.toggle_mode(false);});});},_onReloadMenuData:function(ev){var self=this;var current_primary_menu=this.menu.current_primary_menu;core.bus.trigger('clear_cache');this._redrawMenuWidgets().then(function(){self.menu.toggle_mode(self.home_menu_displayed);self.menu.change_menu_section(current_primary_menu);if(self.home_menu_displayed){self.append_home_menu();}
self.menu.switchMode(self.studioMode);self._updateStudioSystray(!!self.studioMode);self.home_menu.toggleStudioMode(!!self.studioMode);if(ev&&ev.data.keep_open){self.menu.edit_menu.editMenu();}
if(ev&&ev.data.def){ev.data.def.resolve();}});},_onStudioIconClicked:function(){var newMode=this.home_menu_displayed?'app_creator':'main';this.studioMode=this.studioMode?false:newMode;this._updateContext();if(this.studioMode){this._openStudio();}else{this._closeStudio();}},_onSwitchStudioView:function(ev){var action=this.action_manager.getCurrentStudioAction();var controller=this.action_manager.getCurrentStudioController();var params=_.extend({},ev.data,{action:action,});if(controller.widget){params.controllerState=controller.widget.exportState();}
this._openStudioMain(params);},});});;

/* /web_studio/static/src/js/menu.js defined in bundle 'web_studio.assets' */
odoo.define('web_studio.Menu',function(require){"use strict";var core=require('web.core');var Dialog=require('web.Dialog');var framework=require('web.framework');var Menu=require('web_enterprise.Menu');var session=require('web.session');var bus=require('web_studio.bus');var EditMenu=require('web_studio.EditMenu');var SubMenu=require('web_studio.SubMenu');var qweb=core.qweb;var _t=core._t;Menu.include({events:_.extend({},Menu.prototype.events,{'click .o_web_studio_change_background':'_onChangeBackground','click .o_web_studio_reset_default_background':'_onResetDefaultBackground','click .o_web_studio_export':'_onExport','click .o_web_studio_import':'_onImport',}),init:function(){this._super.apply(this,arguments);bus.on('studio_toggled',this,this.switchMode);bus.on('studio_main',this,this._onStudioMain);this.widget="image";this.company_id=session.company_id;this.fileupload_id=_.uniqueId('o_fileupload');$(window).on(this.fileupload_id,this._onBackgroundLoaded.bind(this));},destroy:function(){$(window).off(this.fileupload_id);return this._super.apply(this,arguments);},renderStudioMenu:function(action){if(this.studio_menu){this.studio_menu.destroy();}
this.studio_menu=new SubMenu(this,action);return this.studio_menu.insertAfter(this.$('.o_main_navbar'));},switchMode:function(mode){var self=this;var old_mode=this.studio_mode;if(old_mode===mode){return;}
this.studio_mode=mode;this._clean();if(mode){var $main_navbar=this.$('.o_main_navbar');if(!old_mode){this.$detached_systray=this.$('.o_menu_systray').detach();}
if(mode==='main'){if(this.studio_menu){this.studio_menu.$el.insertAfter(this.$('.o_main_navbar'));}
if(this.current_primary_menu){this.edit_menu=new EditMenu.MenuItem(this,this.menu_data,this.current_primary_menu);this.edit_menu.appendTo($main_navbar.find('.o_menu_sections'));}}else{this.$home_studio_menu=$(qweb.render('web_studio.HomeStudioMenu',{widget:this,}));this.$home_studio_menu.appendTo($main_navbar);if(this.studio_menu){this.studio_menu.$el.detach();}}
this.$leave_button=$('<div>').addClass('o_web_studio_leave').append($('<a>',{href:'#',class:'btn btn-primary',text:_t("Close"),})).click(function(event){event.preventDefault();if(!$(this).hasClass('o_disabled')){self.trigger_up('studio_icon_clicked');}
$(this).addClass('o_disabled');});this.$leave_button.appendTo($main_navbar);this.$notes=$('<div>').addClass('o_web_studio_notes').append($('<a>',{href:'http://pad.odoo.com/p/customization-'+session.dbuuid,target:'_blank',text:_t("Notes"),}));this.$notes.appendTo($main_navbar);}else{this.$detached_systray.prependTo('.o_main_navbar');if(this.studio_menu){this.studio_menu.destroy();this.studio_menu=undefined;}}},toggle_mode:function(home_menu){this._super.apply(this,arguments);if(!home_menu&&this.$home_studio_menu){this.$home_studio_menu.remove();}},_clean:function(){if(this.edit_menu){this.edit_menu.destroy();this.edit_menu=undefined;}
if(this.$notes){this.$notes.remove();this.$nodes=undefined;}
if(this.$leave_button){this.$leave_button.remove();this.$leave_button=undefined;}
if(this.$home_studio_menu){this.$home_studio_menu.remove();this.$home_studio_menu=undefined;}},_setBackgroundImage:function(attachment_id){return this._rpc({route:'/web_studio/set_background_image',params:{attachment_id:attachment_id,context:session.user_context,},});},_onBackgroundLoaded:function(event,result){if(result.error||!result.id){this.do_warn(result.error);}else{framework.blockUI();this._setBackgroundImage(result.id).then(function(){window.location.reload();}).guardedCatch(function(){framework.unblockUI();});}},_onChangeBackground:function(){var self=this;this.$('input.o_input_file').on('change',function(){self.$('form.o_form_binary_form').submit();});this.$('input.o_input_file').click();},_onExport:function(event){event.preventDefault();var $export=$(event.currentTarget);$export.addClass('o_disabled');session.get_file({url:'/web_studio/export',complete:$export.removeClass.bind($export,'o_disabled'),});},_onImport:function(event){event.preventDefault();var self=this;this.do_action({name:'Import modules',res_model:'base.import.module',views:[[false,'form']],type:'ir.actions.act_window',target:'new',context:{dialog_size:'medium',},},{on_close:function(){self.trigger_up('reload_menu_data');},});},_onResetDefaultBackground:function(){var self=this;var message=_t('Are you sure you want to reset the background image?');Dialog.confirm(this,message,{confirm_callback:function(){framework.blockUI();self._rpc({route:'/web_studio/reset_background_image',params:{context:session.user_context,},}).then(function(){window.location.reload();}).guardedCatch(function(){framework.unblockUI();});}});},_onStudioMain:function(action){this.renderStudioMenu(action);},});});;

/* /web_studio/static/src/js/edit_menu.js defined in bundle 'web_studio.assets' */
odoo.define('web_studio.EditMenu',function(require){"use strict";var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var FieldManagerMixin=require('web.FieldManagerMixin');var form_common=require('web.view_dialogs');var relational_fields=require('web.relational_fields');var session=require('web.session');var StandaloneFieldManagerMixin=require('web.StandaloneFieldManagerMixin');var Widget=require('web.Widget');var Many2One=relational_fields.FieldMany2One;var _t=core._t;var MenuItem=Widget.extend({template:'web_studio.EditMenu.MenuItem',events:{'click .o_web_edit_menu':'_onClick',},init:function(parent,menu_data,current_primary_menu){this._super.apply(this,arguments);this.menu_data=menu_data;this.current_primary_menu=current_primary_menu;},editMenu:function(){new EditMenuDialog(this,this.menu_data,this.current_primary_menu).open();},_onClick:function(event){event.preventDefault();this.editMenu();},});var EditMenuDialog=Dialog.extend({template:'web_studio.EditMenu.Dialog',events:_.extend({},Dialog.prototype.events,{'click a.js_add_menu':'_onAddMenu','click button.js_edit_menu':'_onEditMenu','click button.js_delete_menu':'_onDeleteMenu',}),init:function(parent,menu_data,current_primary_menu){var options={title:_t('Edit Menu'),size:'medium',dialogClass:'o_web_studio_edit_menu_modal',buttons:[{text:_t("Confirm"),classes:'btn-primary',click:this._onSave.bind(this),},{text:_t("Cancel"),close:true,}],};this.current_primary_menu=current_primary_menu;this.roots=this.getMenuDataFiltered(menu_data);this.to_delete=[];this.to_move={};this._super(parent,options);},start:function(){this.$('.oe_menu_editor').nestedSortable({listType:'ul',handle:'div',items:'li',maxLevels:5,toleranceElement:'> div',forcePlaceholderSize:true,opacity:0.6,placeholder:'oe_menu_placeholder',tolerance:'pointer',attribute:'data-menu-id',expression:'()(.+)',relocate:this.moveMenu.bind(this),rtl:_t.database.parameters.direction==="rtl",});return this._super.apply(this,arguments);},getMenuDataFiltered:function(menu_data){var self=this;var menus=menu_data.children.filter(function(el){return el.id===self.current_primary_menu;});return menus;},moveMenu:function(ev,ui){var self=this;var $menu=$(ui.item);var menu_id=$menu.data('menu-id');this.to_move[menu_id]={parent_id:$menu.parents('[data-menu-id]').data('menu-id')||this.current_primary_menu,sequence:$menu.index(),};_.each($menu.siblings('li'),function(el){var menu_id=$(el).data('menu-id');if(menu_id in self.to_move){self.to_move[menu_id].sequence=$(el).index();}else{self.to_move[menu_id]={sequence:$(el).index()};}});},_reloadMenuData:function(keep_open){this.trigger_up('reload_menu_data',{keep_open:keep_open});},_onAddMenu:function(ev){ev.preventDefault();var self=this;new NewMenuDialog(this,{parent_id:this.current_primary_menu,on_saved:function(){self._saveChanges().then(function(){self._reloadMenuData(true);});},}).open();},_onDeleteMenu:function(ev){var $menu=$(ev.currentTarget).closest('[data-menu-id]');var menu_id=$menu.data('menu-id')||0;if(menu_id){this.to_delete.push(menu_id);}
$menu.remove();},_onEditMenu:function(ev){var self=this;var menu_id=$(ev.currentTarget).closest('[data-menu-id]').data('menu-id');new form_common.FormViewDialog(this,{res_model:'ir.ui.menu',res_id:menu_id,on_saved:function(){self._saveChanges().then(function(){self._reloadMenuData(true);});},}).open();},_onSave:function(){var self=this;if(!_.isEmpty(this.to_move)||!_.isEmpty(this.to_delete)){this._saveChanges().then(function(){self._reloadMenuData();});}else{this.close();}},_saveChanges:function(){return this._rpc({model:'ir.ui.menu',method:'customize',kwargs:{to_move:this.to_move,to_delete:this.to_delete,},});},});var EditMenuMany2One=Many2One.extend({_quickCreate:function(){this.trigger_up('edit_menu_disable_save');var def=this._super.apply(this,arguments);Promise.resolve(def).then(this.trigger_up.bind(this,'edit_menu_enable_save'),this.trigger_up.bind(this,'edit_menu_enable_save'));},});var NewMenuDialog=Dialog.extend(StandaloneFieldManagerMixin,{template:'web_studio.EditMenu.Dialog.New',custom_events:_.extend({},Dialog.prototype.custom_events,FieldManagerMixin.custom_events,{edit_menu_disable_save:function(){this.$footer.find('.confirm_button').attr("disabled","disabled");},edit_menu_enable_save:function(){this.$footer.find('.confirm_button').removeAttr("disabled");},}),init:function(parent,params){this.parent_id=params.parent_id;this.on_saved=params.on_saved;var options={title:_t('Create a new Menu'),size:'small',buttons:[{text:_t("Confirm"),classes:'btn-primary confirm_button',click:this._onSave.bind(this)},{text:_t("Cancel"),close:true}],};this._super(parent,options);StandaloneFieldManagerMixin.init.call(this);},start:function(){var self=this;var defs=[];this.opened().then(function(){self.$modal.addClass('o_web_studio_add_menu_modal');self.$el.find('input[name="name"]').focus();});defs.push(this._super.apply(this,arguments));defs.push(this.model.makeRecord('ir.actions.act_window',[{name:'model',relation:'ir.model',type:'many2one',domain:[['transient','=',false],['abstract','=',false]],}]).then(function(recordID){var options={mode:'edit',};var record=self.model.get(recordID);self.many2one=new EditMenuMany2One(self,'model',record,options);self.many2one.nodeOptions.no_create_edit=!config.isDebug();self._registerWidget(recordID,'model',self.many2one);self.many2one.appendTo(self.$('.js_model'));}));return Promise.all(defs);},_createNewMenu:function(menu_name,parent_id,model_id){core.bus.trigger('clear_cache');return this._rpc({route:'/web_studio/create_new_menu',params:{menu_name:menu_name,model_id:model_id,parent_id:parent_id,context:session.user_context,},});},_onSave:function(){var self=this;this.$footer.find('.confirm_button').addClass('disabled');var name=this.$el.find('input').first().val();var model_id=this.many2one.value&&this.many2one.value.res_id;var def=this._createNewMenu(name,this.parent_id,model_id);def.then(function(){self.on_saved();}).guardedCatch(function(){self.$footer.find('.confirm_button').removeClass('disabled');});},});return{MenuItem:MenuItem,Dialog:EditMenuDialog,};});;

/* /web_studio/static/src/js/submenu.js defined in bundle 'web_studio.assets' */
odoo.define('web_studio.SubMenu',function(require){"use strict";var ajax=require('web.ajax');var core=require('web.core');var session=require('web.session');var Widget=require('web.Widget');var bus=require('web_studio.bus');var _t=core._t;var SubMenu=Widget.extend({template:'web_studio.Menu',events:{'click .o_menu_sections > li':'_onMenu','click .o_web_studio_undo':'_onUndo','click .o_web_studio_redo':'_onRedo','click .o_menu_sections .o_web_studio_views_icons > a':'_onIcon',},init:function(parent,action){this._super.apply(this,arguments);this.action=action;this.active_view_types=this._getActiveViewTypes();this.activeMenu='Views';this.studio_actions=[{action:'action_web_studio_action_editor',title:'Views'}];this.multi_lang=session.multi_lang;this._isRedoToggled=false;this._isUndoToggled=false;bus.on('action_changed',this,this._onActionChanged);bus.on('undo_available',this,this._onToggleUndo.bind(this,true));bus.on('undo_not_available',this,this._onToggleUndo.bind(this,false));bus.on('redo_available',this,this._onToggleRedo.bind(this,true));bus.on('redo_not_available',this,this._onToggleRedo.bind(this,false));bus.on('toggle_snack_bar',this,this._onToggleSnackBar);bus.on('edition_mode_entered',this,this._onEditionModeEntered);bus.on('edition_x2m_entered',this,this._onX2MEntered);bus.on('report_template_opened',this,this._onReportTemplateOpened);bus.on('report_template_closed',this,this._onReportTemplateClosed);},renderElement:function(){this._super.apply(this,arguments);this._setActiveButtons();this._renderBreadcrumb();},_addAction:function(options){this.studio_actions.push(options);if(this.$el){this.$('.o_menu_sections li a.active').removeClass('active');this.renderElement();}},_getActiveViewTypes:function(){return _.map(this.action.views,function(view){return view.type;});},_renderBreadcrumb:function(){var self=this;var $breadcrumb=$('<ol>').addClass('breadcrumb');_.each(this.studio_actions,function(bc,index){$breadcrumb.append(self._renderBreadcrumbsLi(bc,index,self.studio_actions.length));});this.$('.o_web_studio_breadcrumb').empty().append($breadcrumb);},_renderBreadcrumbsLi:function(bc,index,length){var self=this;var is_last=(index===length-1);var li_content=bc.title&&_.escape(bc.title.trim());var $bc=$('<li>',{class:'breadcrumb-item'}).append(li_content).toggleClass('active',is_last);if(!is_last){$bc.click(function(){if(bc.action.res_model==='ir.actions.report'){self.studio_actions.pop();self.trigger_up('studio_history_back');self.renderElement();return;}
var options={action:self.action,replace_last_action:true,index:index,};if(bc.viewType){options.viewType=bc.viewType;}
if(bc.x2mEditorPath){options.x2mEditorPath=bc.x2mEditorPath.slice();}
if(bc.viewName){options.viewName=bc.viewName;}
self._replaceAction(bc.action,bc.title,options);});$bc.toggleClass('o_back_button');}
return $bc;},_replaceAction:function(action,title,options){if(options.viewType){if(options.index>1){this.studio_actions.length=options.index+1;}else{this.studio_actions=[{action:'action_web_studio_action_editor',title:_t('Views')},{action:action,title:title,viewType:options.viewType},];}}else{this.studio_actions=[{action:action,title:title}];}
delete options.index;if(action==='action_web_studio_action_editor'){options.noEdit=!options.viewType;}
this.activeMenu=title;if(action._originalAction){action=JSON.parse(action._originalAction);}
if(action==='action_web_studio_action_editor'){this.trigger_up('switch_studio_view',options);}else{this.do_action(action,options);}
this.renderElement();},_setActiveButtons(){this.$(`.o_menu_sections li:contains(${this.activeMenu})`).addClass('active');if(this.studio_actions.length===0){return;}
const currentAction=_.last(this.studio_actions);const isReportAction=currentAction.action==='web_studio.action_edit_report';this.$('.o_web_studio_menu_undo_redo').toggleClass('d-none',!currentAction.viewType&&!isReportAction);this.$('.o_web_studio_breadcrumb').toggleClass('o_web_studio_breadcrumb_report',isReportAction);},_onActionChanged:function(new_action){this.action=new_action;this.active_view_types=this._getActiveViewTypes();this.studio_actions=[{action:'action_web_studio_action_editor',title:'Views'}];this.renderElement();},_onEditionModeEntered:function(viewType){if(this.studio_actions.length===1){var bcOptions={action:'action_web_studio_action_editor',viewType:viewType,title:viewType.charAt(0).toUpperCase()+viewType.slice(1),};this._addAction(bcOptions);}},_onIcon:function(ev){ev.preventDefault();var view_name=$(ev.currentTarget).data('name');return this._replaceAction('action_web_studio_action_editor',view_name,{action:this.action,replace_last_action:true,viewType:view_name,});},_onMenu:function(ev){var $menu=$(ev.currentTarget);if(!$menu.data('name')){return;}
var title=$menu.text();var name=$menu.data('name');if(name==='views'){this._replaceAction('action_web_studio_action_editor',title,{action:this.action,studio_clear_studio_breadcrumbs:true,});}else if(_.contains(['automations','reports','acl','filters','translations'],name)){var self=this;ajax.jsonRpc('/web_studio/get_studio_action','call',{action_name:name,model:this.action.res_model,view_id:this.action.view_id[0],}).then(function(result){self._replaceAction(result,title,{studio_clear_studio_breadcrumbs:true,});});}},_onRedo:function(){bus.trigger('redo_clicked');},_onReportTemplateClosed:function(){if(this.studio_actions.length>1){this.studio_actions.pop();}
this.renderElement();},_onReportTemplateOpened:function(reportName){if(this.studio_actions.length>1){this.studio_actions.pop();}
var bcOptions={action:'web_studio.action_edit_report',title:reportName,};this._addAction(bcOptions);},_onToggleUndo:function(display){this._isUndoToggled=display;this.$('.o_web_studio_undo').toggleClass('o_web_studio_active',display);},_onToggleRedo:function(display){this._isRedoToggled=display;this.$('.o_web_studio_redo').toggleClass('o_web_studio_active',display);},_onToggleSnackBar(type){switch(type){case'saved':this.$('.o_web_studio_snackbar_icon').removeClass('fa-spinner fa-pulse');this.$('.o_web_studio_snackbar_icon').addClass('show fa fa-check');this.$('.o_web_studio_snackbar_text').text(_t("Saved"));break;case'saving':this.$('.o_web_studio_snackbar_icon').addClass('show fa fa-spinner fa-pulse');this.$('.o_web_studio_snackbar_text').text(_t("Saving"));break;}},_onUndo:function(){bus.trigger('undo_clicked');},_onX2MEntered:function(subviewType,x2mEditorPath){var bcOptions={action:'action_web_studio_action_editor',viewType:subviewType,x2mEditorPath:x2mEditorPath.slice(),title:_t('Subview ')+subviewType,};this._addAction(bcOptions);},});return SubMenu;});;

/* /web_studio/static/src/js/home_menu.js defined in bundle 'web_studio.assets' */
odoo.define('web_studio.HomeMenu',function(require){"use strict";var core=require('web.core');var Dialog=require('web.Dialog');var session=require('web.session');var web_client=require('web.web_client');var HomeMenu=require('web_enterprise.HomeMenu');var bus=require('web_studio.bus');var IconCreator=require('web_studio.IconCreator');var QWeb=core.qweb;var _t=core._t;HomeMenu.include({events:_.extend(HomeMenu.prototype.events,{'click .o_web_studio_edit_icon':'_onEditIcon','click .o_web_studio_new_app':'_onNewApp',}),start:function(){bus.on('studio_toggled',this,this.toggleStudioMode);return this._super.apply(this,arguments);},on_attach_callback:function(){this.in_DOM=true;this._super.apply(this,arguments);},on_detach_callback:function(){this._super.apply(this,arguments);this.in_DOM=false;},toggleStudioMode:function(display){this._inStudioMode=display;if(!this.in_DOM){return;}
if(display){this._state=this._getInitialState();this.on_detach_callback();this.in_DOM=true;}else{this.on_attach_callback();}
this._render();},_render:function(){this._super.apply(this,arguments);if(this._inStudioMode){this.$('.o_app').append($('<i>',{class:"o_web_studio_edit_icon fa fa-pencil-square",}));this._renderNewApp();}},_renderNewApp:function(){this._$newApp=$(QWeb.render('web_studio.AppCreator.NewApp'));this._$newApp.appendTo(this.$('.o_apps'));},_onEditIcon:function(ev){ev.preventDefault();ev.stopPropagation();var self=this;var menuID=$(ev.currentTarget).closest('.o_app').data('menu');var app=_.findWhere(this._state.apps,{id:menuID});this.iconCreator=new IconCreator(this,{background_color:app.web_icon.background,color:app.web_icon.color,icon_class:app.web_icon.class,webIconData:app.web_icon_data,});var fragment=document.createDocumentFragment();this.iconCreator.appendTo(fragment).then(function(){new Dialog(self,{dialogClass:'o_web_studio_edit_menu_icon_modal',size:'medium',title:_t('Edit Application Icon'),$content:$('<div>').append(self.iconCreator.$el),buttons:[{text:_t("Confirm"),classes:'btn-primary',click:self._onIconSaved.bind(self,menuID),},{text:_t("Cancel"),close:true,}],}).open();});},_onIconSaved:function(menuID){var self=this;this._rpc({route:'/web_studio/edit_menu_icon',params:{menu_id:menuID,icon:this.iconCreator.getValue(),context:session.user_context,},}).then(function(){self.trigger_up('reload_menu_data');});},_onNewApp:function(ev){ev.preventDefault();web_client.openAppCreator().then(function(){core.bus.trigger('toggle_mode',true,false);});},});});;

/* /web_studio/static/src/js/icon_creator.js defined in bundle 'web_studio.assets' */
odoo.define('web_studio.IconCreator',function(require){"use strict";var core=require('web.core');var session=require('web.session');var Widget=require('web.Widget');var utils=require('web_studio.utils');var QWeb=core.qweb;var IconCreator=Widget.extend({template:'web_studio.IconCreator',events:{'click .o_web_studio_selector':'_onSelector','click .js_upload':'_onUploadButton','click .js_discard_upload':'_onUploadDiscarded',},init:function(parent,options){this.COLORS=utils.COLORS;this.BG_COLORS=utils.BG_COLORS;this.ICONS=utils.ICONS;options=options||{};this.color=options.color||this.COLORS[4];this.background_color=options.background_color||this.BG_COLORS[5];this.icon_class=options.icon_class||this.ICONS[0];this.PALETTE_TEMPLATES={'color':'web_studio.IconCreator.IconColorPalette','background_color':'web_studio.IconCreator.BgPalette','icon':'web_studio.IconCreator.IconPalette',};this.uploaded_image=options.webIconData;this.uploaded=!!options.webIconData;this.uploaded_attachment_id=false;this.image_only=true;this.user_id=session.uid;this.fileupload_id=_.uniqueId('o_fileupload');$(window).on(this.fileupload_id,this._onUploadDone.bind(this));this.mode='edit';this._super.apply(this,arguments);},start:function(){this.update(true);return this._super.apply(this,arguments);},destroy:function(){$(window).off(this.fileupload_id);return this._super.apply(this,arguments);},getValue:function(){if(this.uploaded){return this.uploaded_attachment_id;}else{return[this.icon_class,this.color,this.background_color];}},enableEdit:function(){this.mode='edit';this.renderElement();},disableEdit:function(){this.mode='readonly';this.renderElement();},update:function(replace_icon){var self=this;this.$('.o_app_icon').css('background-color',this.background_color).find('i').css('color',this.color);if(replace_icon){this.$('.o_app_icon i').fadeOut(50,function(){$(this).attr('class',self.icon_class).fadeIn(800);});}
this.$('.o_web_studio_selector[data-type="icon"] i').attr('class',self.icon_class);this.$('.o_web_studio_selector[data-type="background_color"]').css('background-color',this.background_color);this.$('.o_web_studio_selector[data-type="color"]').css('background-color',this.color);},_onSelector:function(ev){var self=this;var $el=$(ev.currentTarget);var selector_type=$el.data('type');if(!selector_type){return;}
if(this.$palette){this.$palette.remove();}
this.$palette=$(QWeb.render(this.PALETTE_TEMPLATES[selector_type],{widget:this,}));$el.find('.o_web_studio_selector_pointer').before(this.$palette);this.$palette.on('mouseleave',function(){$(this).remove();});this.$palette.find('.o_web_studio_selector').click(function(ev){$el=$(ev.currentTarget);if(selector_type==='background_color'){self.background_color=$el.data('color');self.update();}else if(selector_type==='color'){self.color=$el.data('color');self.update();}else{self.icon_class=$el.children('i').attr('class');self.update(true);}});},_onUploadButton:function(event){event.preventDefault();var self=this;this.$('input.o_input_file').on('change',function(){self.$('form.o_form_binary_form').submit();});this.$('input.o_input_file').click();},_onUploadDone:function(event,result){event.preventDefault();this.uploaded=true;this.uploaded_attachment_id=result.id;var self=this;this._rpc({model:'ir.attachment',method:'read',args:[[this.uploaded_attachment_id],['datas']],}).then(function(res){var base64=res[0].datas.replace(/\s/g,'');self.uploaded_image='data:image/png;base64,'+base64;self.renderElement();});},_onUploadDiscarded:function(event){event.preventDefault();this.uploaded=false;this.uploaded_attachment_id=false;this.renderElement();this.update(true);},});return IconCreator;});;

/* /web_studio/static/src/js/utils.js defined in bundle 'web_studio.assets' */
odoo.define('web_studio.utils',function(){"use strict";var COLORS=['#FFFFFF','#262c34','#00dec9','#2ecc71','#f1c40f','#FFAB4A','#EB5A46','#9b59b6','#0079BF','#4dd0e1',];var BG_COLORS=['#1abc9c','#58a177','#B4C259','#56829f','#636DA9','#34495e','#BC4242','#C6572A','#d49054','#D89F45','#DAB852','#606060','#6B6C70','#838383','#F5F5F5',];var ICONS=['fa fa-diamond','fa fa-bell','fa fa-calendar','fa fa-circle','fa fa-cube','fa fa-cubes','fa fa-flag','fa fa-folder-open','fa fa-home','fa fa-rocket','fa fa-sitemap','fa fa-area-chart','fa fa-balance-scale','fa fa-database','fa fa-globe','fa fa-institution','fa fa-random','fa fa-umbrella','fa fa-bed','fa fa-bolt','fa fa-commenting','fa fa-envelope','fa fa-flask','fa fa-magic','fa fa-pie-chart','fa fa-retweet','fa fa-shopping-basket','fa fa-star','fa fa-television','fa fa-tree','fa fa-thumbs-o-up','fa fa-file-o','fa fa-wheelchair','fa fa-code','fa fa-spinner','fa fa-ticket','fa fa-shield','fa fa-recycle','fa fa-phone','fa fa-microphone','fa fa-magnet','fa fa-info','fa fa-inbox','fa fa-heart','fa fa-bullseye','fa fa-cutlery','fa fa-credit-card','fa fa-briefcase',];function randomString(string_length){var chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";var randomstring='';for(var i=0;i<string_length;i++){var rnum=Math.floor(Math.random()*chars.length);randomstring+=chars.substring(rnum,rnum+1);}
return randomstring;}
return{COLORS:COLORS,BG_COLORS:BG_COLORS,ICONS:ICONS,randomString:randomString,};});;

/* /web_studio/static/src/js/tours/web_studio.js defined in bundle 'web_studio.assets' */
odoo.define('web_studio.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var utils=require('web_studio.utils');var _t=core._t;tour.register('web_studio_home_menu_background_tour',{url:"/web",},[{trigger:'.o_web_studio_navbar_item',content:_t('Want to customize the background? Let’s activate <b>Odoo Studio</b>.'),position:'bottom',extra_trigger:'.o_home_menu',},{trigger:'.o_web_studio_home_studio_menu a',content:_t('Click here.'),position:'right',},{trigger:'.o_web_studio_home_studio_menu .dropdown-menu .dropdown-item:eq(0)',content:_t('Change the <b>background</b>, make it yours.'),position:'bottom',}]);tour.register('web_studio_new_app_tour',{url:"/web?studio=app_creator",},[{trigger:'.o_web_studio_new_app',auto:true,position:'bottom',},{trigger:'.o_web_studio_app_creator_next',content:_t('I bet you can <b>build an app</b> in 5 minutes. Ready for the challenge?'),position:'top',},{trigger:'.o_web_studio_app_creator_name > input',content:_t('How do you want to <b>name</b> your app? Library, Academy, …?'),position:'right',run:'text '+utils.randomString(6),},{trigger:'.o_web_studio_selectors .o_web_studio_selector:eq(2)',content:_t('Now, customize your icon. Make it yours.'),position:'top',},{trigger:'.o_web_studio_app_creator_next.is_ready',content:_t('Go on, you are almost done!'),position:'top',},{trigger:'.o_web_studio_app_creator_menu > input',content:_t('How do you want to name your first <b>menu</b>? My books, My courses?'),position:'right',run:'text '+utils.randomString(6),},{trigger:'.o_web_studio_app_creator_next.is_ready',content:_t('You are just one click away from <b>generating your first app</b>.'),position:'bottom',},{trigger:'.o_web_studio_sidebar .o_web_studio_field_type_container:eq(1) .o_web_studio_field_char',content:_t('Nicely done! Let’s build your screen now; <b>drag</b> a <i>text field</i> and <b>drop</b> it in your view, on the right.'),position:'bottom',run:'drag_and_drop .o_web_studio_form_view_editor .o_inner_group',timeout:60000,},{trigger:'.o_web_studio_form_view_editor td.o_td_label',content:_t('To <b>customize a field</b>, click on its <i>label</i>.'),position:'bottom',},{trigger:'.o_web_studio_sidebar_content.o_display_field input[name="string"]',content:_t('Here, you can <b>name</b> your field (e.g. Book reference, ISBN, Internal Note, etc.).'),position:'bottom',run:'text My Field',},{extra_trigger:'.o_web_studio_form_view_editor td.o_td_label:contains(My Field)',trigger:'.o_web_studio_sidebar .o_web_studio_new',content:_t('Good job! To add more <b>fields</b>, come back to the <i>Add tab</i>.'),position:'bottom',},{trigger:'.o_web_studio_sidebar .o_web_studio_field_type_container:eq(1) .o_web_studio_field_selection',content:_t('Drag & drop <b>another field</b>. Let’s try with a <i>selection field</i>.'),position:'bottom',run:'drag_and_drop .o_web_studio_form_view_editor .o_inner_group',},{trigger:'.o_web_studio_field_dialog_form > .o_web_studio_add_selection input',content:_t("Create your <b>selection values</b> (e.g.: Romance, Polar, Fantasy, etc.)"),position:'top',run:'text '+utils.randomString(6),},{trigger:'.o_web_studio_field_dialog_form > .o_web_studio_add_selection .o_web_studio_add_selection_value',auto:true,},{trigger:'.modal-footer > button:eq(0)',auto:true,},{trigger:'.o_web_studio_add_chatter',content:_t("Add a <b>chatter widget</b> to allow discussions on your document: by email or online."),position:'top',},{trigger:'.o_web_studio_form_view_editor .oe_chatter',content:_t("Click to edit."),position:'top',timeout:60000,},{trigger:'.o_web_studio_sidebar .o_display_chatter input[name="email_alias"]',content:_t("Set an <b>email alias</b>. Then, try to send an email to this address; it will create a document automatically for you. Pretty cool, huh?"),position:'bottom',},{trigger:'.o_web_studio_leave',content:_t("Let’s check the result. Close Odoo Studio to get an <b>overview of your app</b>."),position:'left',},{trigger:'input.o_required_modifier',auto:true,position:'bottom',},{trigger:'.o_control_panel .o_cp_buttons .o_form_button_save',content:_t("Save."),position:'right',},{trigger:'.o_web_studio_navbar_item',extra_trigger:'.o_form_view.o_form_readonly',content:_t("Wow, nice! And I’m sure you can make it even better! Use this icon to open <b>Odoo Studio</b> and customize any screen."),position:'bottom',},{trigger:'.o_web_studio_menu .o_menu_sections li[data-name="views"]',content:_t("Want more fun? Let’s create more <b>views</b>."),position:'bottom',},{trigger:'.o_web_studio_view_category .o_web_studio_view_type.o_web_studio_inactive[data-type="kanban"] .o_web_studio_thumbnail',content:_t("What about a <b>Kanban view</b>?"),position:'bottom',},{trigger:'.o_web_studio_sidebar .o_web_studio_new',content:_t("Now you’re on your own. Enjoy your <b>super power</b>."),position:'bottom',}]);});;

/* /website_studio/static/src/js/submenu.js defined in bundle 'web_studio.assets' */
odoo.define('website_studio.SubMenu',function(require){"use strict";var SubMenu=require('web_studio.SubMenu');var WebsiteSubMenu=SubMenu.include({template:'website_studio.SubMenu',_onMenu:function(ev){this._super.apply(this,arguments);var $menu=$(ev.currentTarget);var title=$menu.text();if($menu.data('name')==='website'){this._replaceAction('action_web_studio_form',title,{action:this.action,replace_last_action:true,});}},});return WebsiteSubMenu;});