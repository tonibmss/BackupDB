
/* /base/static/src/js/res_config_settings.js defined in bundle 'web.assets_backend' */
odoo.define('base.settings',function(require){"use strict";var BasicModel=require('web.BasicModel');var core=require('web.core');var config=require('web.config');var FormView=require('web.FormView');var FormController=require('web.FormController');var FormRenderer=require('web.FormRenderer');var view_registry=require('web.view_registry');var QWeb=core.qweb;var _t=core._t;var BaseSettingRenderer=FormRenderer.extend({events:_.extend({},FormRenderer.prototype.events,{'click .tab':'_onSettingTabClick','keyup .searchInput':'_onKeyUpSearch',}),init:function(){this._super.apply(this,arguments);this.activeView=false;this.activeTab=false;},start:function(){var prom=this._super.apply(this,arguments);if(config.device.isMobile){core.bus.on("DOM_updated",this,function(){this._moveToTab(this.currentIndex||this._currentAppIndex());});}
return prom;},confirmChange:function(){var self=this;return this._super.apply(this,arguments).then(function(){if(!self.$(".o_dirty_warning").length){self.$('.o_statusbar_buttons').append($('<span/>',{text:_t("Unsaved changes"),class:'text-muted ml-2 o_dirty_warning'}))}});},on_attach_callback:function(){this._super.apply(this,arguments);this.searchInput.focus();},displayTranslationAlert:function(){},_initModules:function(){var self=this;this.modules=[];_.each(this.$('.app_settings_block'),function(settingView,index){var group=!$(settingView).hasClass('o_invisible_modifier');var isNotApp=$(settingView).hasClass('o_not_app');if(group&&!isNotApp){var data=$(settingView).data();data.string=$(settingView).attr('string')||data.string;self.modules.push({key:data.key,string:data.string,imgurl:self._getAppIconUrl(data.key),});}else{$(settingView).remove();}});},_initSearch:function(){this.searchInput=this.$('.searchInput');if(this.searchText){this.searchInput.val(this.searchText);this._onKeyUpSearch();}else{this.searchText="";}},_activateSettingMobileTab:function(currentTab){var self=this;var moveTo=currentTab;var next=moveTo+1;var previous=moveTo-1;this.$(".settings .app_settings_block").removeClass("previous next current before after");this.$(".settings_tab .tab").removeClass("previous next current before after");_.each(this.modules,function(module,index){var tab=self.$(".tab[data-key='"+module.key+"']");var view=module.settingView;if(index===previous){tab.addClass("previous");tab.css("margin-left","0px");view.addClass("previous");}else if(index===next){tab.addClass("next");tab.css("margin-left","-"+tab.outerWidth()+"px");view.addClass("next");}else if(index<moveTo){tab.addClass("before");tab.css("margin-left","-"+tab.outerWidth()+"px");view.addClass("before");}else if(index===moveTo){var marginLeft=tab.outerWidth()/2;tab.css("margin-left","-"+marginLeft+"px");tab.addClass("current");view.addClass("current");}else if(index>moveTo){tab.addClass("after");tab.css("margin-left","0");view.addClass("after");}});},_currentAppIndex:function(){var self=this;var index=_.findIndex(this.modules,function(module){return module.key===self.activeSettingTab;});return index;},_enableSwipe:function(){var self=this;this.$('.settings').swipe({swipeLeft:function(){self._moveToTab(self.currentIndex+1);},swipeRight:function(){self._moveToTab(self.currentIndex-1);}});},_getAppIconUrl:function(module){return module==="general_settings"?"/base/static/description/settings.png":"/"+module+"/static/description/icon.png";},_getSearchHeader:function(imgurl,string){return $(QWeb.render('BaseSetting.SearchHeader',{imgurl:imgurl,string:string}));},_moveToTab:function(index){this.currentIndex=!index||index===-1?0:(index===this.modules.length?index-1:index);if(this.currentIndex!==-1){if(this.activeView){this.activeView.addClass("o_hidden");}
if(this.activeTab){this.activeTab.removeClass("selected");}
var view=this.modules[this.currentIndex].settingView;var tab=this.$(".tab[data-key='"+this.modules[this.currentIndex].key+"']");view.removeClass("o_hidden");this.activeView=view;this.activeTab=tab;if(config.device.isMobile){this._activateSettingMobileTab(this.currentIndex);}else{tab.addClass("selected");}}},_onSettingTabClick:function(event){this.searchInput.focus();if(this.searchText.length>0){this.searchInput.val('');this.searchText="";this._searchSetting();}
var settingKey=this.$(event.currentTarget).data('key');this._moveToTab(_.findIndex(this.modules,function(m){return m.key===settingKey;}));},_onKeyUpSearch:function(event){this.searchText=this.searchInput.val();this.activeTab.removeClass('selected');if(config.device.isMobile){this.$('.settings_tab').addClass('o_hidden');this.$('.settings').addClass('d-block');}
this._searchSetting();},_resetSearch:function(){this.searchInput.val("");_.each(this.modules,function(module){module.settingView.addClass('o_hidden');module.settingView.find('.o_setting_box').removeClass('o_hidden');module.settingView.find('h2').removeClass('o_hidden');module.settingView.find('.settingSearchHeader').addClass('o_hidden');module.settingView.find('.o_settings_container').addClass('mt16');});this.activeTab.removeClass('o_hidden').addClass('selected');this.activeView.removeClass('o_hidden');if(config.device.isMobile){this.$('.settings_tab').removeClass('o_hidden');this.$('.settings').removeClass('d-block');}},_render:function(){var self=this;return this._super.apply(this,arguments).then(function(){self._initModules();self._renderLeftPanel();self._initSearch();if(config.device.isMobile){self._enableSwipe();}});},_renderLeftPanel:function(){var self=this;_.each(this.modules,function(module){module.settingView=self.$('.app_settings_block[data-key="'+module.key+'"]');module.settingView.addClass("o_hidden");module.settingView.prepend(self._getSearchHeader(module.imgurl,module.string));});this._renderTabs();this._moveToTab(this.currentIndex||this._currentAppIndex());},_renderTabs:function(){var tabs=$(QWeb.render('BaseSetting.Tabs',{tabItems:this.modules}));tabs.appendTo(this.$(".settings_tab"));},_searchSetting:function(){var self=this;this.count=0;_.each(this.modules,function(module){self.inVisibleCount=0;module.settingView.find('.o_setting_box').addClass('o_hidden');module.settingView.find('h2').addClass('o_hidden');module.settingView.find('.settingSearchHeader').addClass('o_hidden');module.settingView.find('.o_settings_container').removeClass('mt16');const upperCasedSearchText=self.searchText.toUpperCase();const[matches,others]=_.partition(module.settingView.find(".o_form_label"),(e)=>e.textContent.toUpperCase().includes(upperCasedSearchText));if(matches.length){for(let result of matches){const settingBox=$(result).closest('.o_setting_box');if(!settingBox.hasClass('o_invisible_modifier')){settingBox.removeClass('o_hidden');self._wordHighlighter(result,upperCasedSearchText);}else{self.inVisibleCount++;}}
if(self.inVisibleCount!==matches.length){module.settingView.find('.settingSearchHeader').removeClass('o_hidden');module.settingView.removeClass('o_hidden');}}else{++self.count;}
others.filter(e=>e.firstElementChild).forEach(e=>self._removeHighlight(e));});this.count===_.size(this.modules)?this.$('.notFound').removeClass('o_hidden'):this.$('.notFound').addClass('o_hidden');if(this.searchText.length===0){this._resetSearch();}},_wordHighlighter:function(node,upperCasedSearchText){const text=node.textContent;const startIndex=text.toUpperCase().indexOf(upperCasedSearchText);const endIndex=startIndex+upperCasedSearchText.length;$(node).empty().append(document.createTextNode(text.substring(0,startIndex)),$('<span class="highlighter">').text(text.substring(startIndex,endIndex)),document.createTextNode(text.substring(endIndex)));},_removeHighlight:function(node){node.textContent=node.textContent;},});var BaseSettingController=FormController.extend({custom_events:_.extend({},FormController.prototype.custom_events,{button_clicked:'_onButtonClicked',}),init:function(){this._super.apply(this,arguments);this.disableAutofocus=true;this.renderer.activeSettingTab=this.initialState.context.module;},willRestore:function(){this.mode='edit';},_onButtonClicked:function(ev){var self=this;if(ev.data.attrs.name!=='execute'&&ev.data.attrs.name!=='cancel'){var recordID=ev.data.recordID;var _super=this._super;var args=arguments;this._discardChanges(recordID).then(function(){_super.apply(self,args);});}else{this._super.apply(this,arguments);}},});var BaseSettingsModel=BasicModel.extend({save:function(recordID){var self=this;return this._super.apply(this,arguments).then(function(result){delete self.localData[recordID].res_id;return result;});},});var BaseSettingView=FormView.extend({jsLibs:[],config:_.extend({},FormView.prototype.config,{Model:BaseSettingsModel,Renderer:BaseSettingRenderer,Controller:BaseSettingController,}),init:function(){if(config.device.isMobile){this.jsLibs.push('/web/static/lib/jquery.touchSwipe/jquery.touchSwipe.js');}
this._super.apply(this,arguments);},});view_registry.add('base_settings',BaseSettingView);return{Model:BaseSettingsModel,Renderer:BaseSettingRenderer,Controller:BaseSettingController,};});;

/* /web/static/lib/jquery.scrollTo/jquery.scrollTo.js defined in bundle 'web.assets_backend' */
;(function(define){'use strict';define(['jquery'],function($){var $scrollTo=$.scrollTo=function(target,duration,settings){return $(window).scrollTo(target,duration,settings);};$scrollTo.defaults={axis:'xy',duration:0,limit:true};$scrollTo.window=function(scope){return $(window)._scrollable();};$.fn._scrollable=function(){return this.map(function(){var elem=this,isWin=!elem.nodeName||$.inArray(elem.nodeName.toLowerCase(),['iframe','#document','html','body'])!=-1;if(!isWin)
return elem;var doc=(elem.contentWindow||elem).document||elem.ownerDocument||elem;return/webkit/i.test(navigator.userAgent)||doc.compatMode=='BackCompat'?doc.body:doc.documentElement;});};$.fn.scrollTo=function(target,duration,settings){if(typeof duration=='object'){settings=duration;duration=0;}
if(typeof settings=='function')
settings={onAfter:settings};if(target=='max')
target=9e9;settings=$.extend({},$scrollTo.defaults,settings);duration=duration||settings.duration;settings.queue=settings.queue&&settings.axis.length>1;if(settings.queue)
duration/=2;settings.offset=both(settings.offset);settings.over=both(settings.over);return this._scrollable().each(function(){if(target==null)return;var elem=this,$elem=$(elem),targ=target,toff,attr={},win=$elem.is('html,body');switch(typeof targ){case'number':case'string':if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(targ)){targ=both(targ);break;}
targ=win?$(targ):$(targ,this);if(!targ.length)return;case'object':if(targ.is||targ.style)
toff=(targ=$(targ)).offset();}
var offset=$.isFunction(settings.offset)&&settings.offset(elem,targ)||settings.offset;$.each(settings.axis.split(''),function(i,axis){var Pos=axis=='x'?'Left':'Top',pos=Pos.toLowerCase(),key='scroll'+Pos,old=elem[key],max=$scrollTo.max(elem,axis);if(toff){attr[key]=toff[pos]+(win?0:old-$elem.offset()[pos]);if(settings.margin){attr[key]-=parseInt(targ.css('margin'+Pos))||0;attr[key]-=parseInt(targ.css('border'+Pos+'Width'))||0;}
attr[key]+=offset[pos]||0;if(settings.over[pos])
attr[key]+=targ[axis=='x'?'width':'height']()*settings.over[pos];}else{var val=targ[pos];attr[key]=val.slice&&val.slice(-1)=='%'?parseFloat(val)/100*max:val;}
if(settings.limit&&/^\d+$/.test(attr[key]))
attr[key]=attr[key]<=0?0:Math.min(attr[key],max);if(!i&&settings.queue){if(old!=attr[key])
animate(settings.onAfterFirst);delete attr[key];}});animate(settings.onAfter);function animate(callback){$elem.animate(attr,duration,settings.easing,callback&&function(){callback.call(this,targ,settings);});}}).end();};$scrollTo.max=function(elem,axis){var Dim=axis=='x'?'Width':'Height',scroll='scroll'+Dim;if(!$(elem).is('html,body'))
return elem[scroll]-$(elem)[Dim.toLowerCase()]();var size='client'+Dim,html=elem.ownerDocument.documentElement,body=elem.ownerDocument.body;return Math.max(html[scroll],body[scroll])-Math.min(html[size],body[size]);};function both(val){return $.isFunction(val)||$.isPlainObject(val)?val:{top:val,left:val};}
return $scrollTo;})}(typeof define==='function'&&define.amd?define:function(deps,factory){if(typeof module!=='undefined'&&module.exports){module.exports=factory(require('jquery'));}else{factory(jQuery);}}));;

/* /web/static/lib/fuzzy-master/fuzzy.js defined in bundle 'web.assets_backend' */
(function(){var root=this;var fuzzy={};if(typeof exports!=='undefined'){module.exports=fuzzy;}else{root.fuzzy=fuzzy;}
fuzzy.simpleFilter=function(pattern,array){return array.filter(function(string){return fuzzy.test(pattern,string);});};fuzzy.test=function(pattern,string){return fuzzy.match(pattern,string)!==null;};fuzzy.match=function(pattern,string,opts){opts=opts||{};var patternIdx=0,result=[],len=string.length,totalScore=0,currScore=0,pre=opts.pre||'',post=opts.post||'',compareString=opts.caseSensitive&&string||string.toLowerCase(),ch,compareChar;pattern=opts.caseSensitive&&pattern||pattern.toLowerCase();for(var idx=0;idx<len;idx++){ch=string[idx];if(compareString[idx]===pattern[patternIdx]){if(pattern[patternIdx]===' '){currScore=1-idx/200;}else{currScore+=1+currScore-idx/200;}
ch=pre+ch+post;patternIdx+=1;}else{currScore=0;}
totalScore+=currScore;if(compareString[idx]===' '){currScore=0;}
result[result.length]=ch;}
if(patternIdx===pattern.length){return{rendered:result.join(''),score:totalScore};}
return null;};fuzzy.filter=function(pattern,arr,opts){if(!arr||arr.length===0){return[]}
if(typeof pattern!=='string'){return arr}
opts=opts||{};return arr.reduce(function(prev,element,idx,arr){var str=element;if(opts.extract){str=opts.extract(element);}
var rendered=fuzzy.match(pattern,str,opts);if(rendered!=null){prev[prev.length]={string:rendered.rendered,score:rendered.score,index:idx,original:element};}
return prev;},[]).sort(function(a,b){var compare=b.score-a.score;if(compare)return compare;return a.index-b.index;});};}());;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo._modules=["base","web","base_setup","bus","web_tour","mail","sales_team","product","web_editor","auth_signup","portal","resource","digest","account","payment","utm","sale","crm_opportunity_product","sale_management","azka_customer_credit_limit","sale_stock","az_customer_history","azka_customer_credit_limit_with_mss","account_check_printing","contacts","web_mobile","mail_enterprise","account_accountant","lb_accounting","app_web_widget_ztree","calendar","crm","website","rating","project","barcodes","stock","mail_bot","hr","hr_timesheet","web_gantt","hr_appraisal","account_reports","account_asset","hr_contract","hr_holidays","hr_work_entry","web_dashboard","hr_payroll","quality","quality_control","website_form","website_crm","helpdesk","payroll_dynamic_xls_report","purchase","hr_attendance","hr_recruitment","hr_expense","account_batch_payment","hibou_professional","hr_payroll_payment","access_cost_price_product","account_auto_transfer","account_bank_statement_import","base_import","account_bank_statement_import_csv","account_bank_statement_import_ofx","account_check_deposit","iap","sms","account_followup","account_invoice_extract","account_move_line_stock_info","account_online_sync","account_plaid","account_ponto","account_reconciliation_widget_partial","account_yodlee","approvals","authorized_ledger_account","az_amount_currency_text","az_customer_supplier_approve","az_local_product_hierarchy","rma","az_product_exchange","product_expiry","az_product_tracking","az_profit_loss_report_filters","az_purchase_valuation_report","azk_appraisal_batch","azk_engagement_activities","azk_history_pricing","azk_lebanon_leaves","azk_stock_forecast","web_action_conditionable","sale_blanket_order","azk_stock_forecast_mss","lb_account_reports","azk_trial_balance_account_currency","azka_acceptance_expiry_date","barcodes_mobile","barcodes_search","base_automation","base_gs1_barcode","board","credit_note_with_transfer","stock_barcode","delivery_barcode","documents","documents_account","einv_sa","event","event_sale","web_kanban_gauge","gamification","hr_gamification","hr_employee_updation","hr_holidays_exclude_weekend","hr_holidays_multi_levels_approval","hr_leave_request_aliasing","hr_org_chart","hr_reminder","hr_reward_warning","hr_skills","website_mail","website_partner","website_profile","website_rating","website_slides","hr_skills_slides","survey","hr_skills_survey","ks_dashboard_ninja","ks_account_dashboard","ks_crm_dashboard_ninja","ks_dn_advance","ks_inventory_dashboard","ks_sale_dashboard_ninja","l10n_generic_coa","l10n_us","l10n_us_check_printing","lb_hr_payroll","lb_payroll_account","mail_activity_board","mail_activity_done","ocn_client","odoo_referral","oh_employee_creation_from_user","oh_employee_documents_expiry","payment_transfer","web_map","project_enterprise","project_timesheet_synchro","rp_hide_edit_btn_v13","sale_enterprise","sale_expense","sale_timesheet","web_grid","timesheet_grid","sale_timesheet_enterprise","sign","snailmail","snailmail_account","snailmail_account_followup","stock_barcode_mobile","stock_barcode_quality_control","stock_barcodes","stock_barcodes_gs1","web_cohort","stock_enterprise","stock_no_negative","stock_picking_invoice_link","stock_picking_purchase_order_link","stock_picking_sale_order_link","stock_picking_show_return","stock_split_picking","web_diagram","web_enterprise","web_studio","web_unsplash","website_enterprise","website_form_project","website_links","mass_mailing","website_mass_mailing","website_slides_survey","website_studio","website_theme_install","mass_mailing_themes","website_hr_recruitment","website_event"];;

/* /web/static/lib/py.js/lib/py.js defined in bundle 'web.assets_backend' */
var py={};(function(py){var create=function(o,props){function F(){}
F.prototype=o;var inst=new F;if(props){for(var name in props){if(!props.hasOwnProperty(name)){continue;}
inst[name]=props[name];}}
return inst;};var symbols={};var comparators={};var Base={nud:function(){throw new Error(this.id+" undefined as prefix");},led:function(led){throw new Error(this.id+" undefined as infix");},toString:function(){if(this.id==='(constant)'||this.id==='(number)'||this.id==='(name)'||this.id==='(string)'){return[this.id.slice(0,this.id.length-1),' ',this.value,')'].join('');}else if(this.id==='(end)'){return'(end)';}else if(this.id==='(comparator)'){var repr=['(comparator',this.expressions[0]];for(var i=0;i<this.operators.length;++i){repr.push(this.operators[i],this.expressions[i+1]);}
return repr.join(' ')+')';}
var out=[this.id,this.first,this.second,this.third].filter(function(r){return r}).join(' ');return'('+out+')';}};function symbol(id,bp){bp=bp||0;var s=symbols[id];if(s){if(bp>s.lbp){s.lbp=bp;}
return s;}
return symbols[id]=create(Base,{id:id,lbp:bp});}
function constant(id){var s=symbol(id);s.id='(constant)';s.value=id;s.nud=function(){return this;};}
function prefix(id,bp,nud){symbol(id).nud=nud||function(){this.first=expression(bp);return this}}
function infix(id,bp,led){symbol(id,bp).led=led||function(left){this.first=left;this.second=expression(bp);return this;}}
function infixr(id,bp){symbol(id,bp).led=function(left){this.first=left;this.second=expression(bp-1);return this;}}
function comparator(id){comparators[id]=true;var bp=60;infix(id,bp,function(left){this.id='(comparator)';this.operators=[id];this.expressions=[left,expression(bp)];while(token.id in comparators){this.operators.push(token.id);advance();this.expressions.push(expression(bp));}
return this;});}
constant('None');constant('False');constant('True');symbol('(number)').nud=function(){return this;};symbol('(name)').nud=function(){return this;};symbol('(string)').nud=function(){return this;};symbol('(end)');symbol(':');symbol(')');symbol(']');symbol('}');symbol(',');symbol('else');infix('=',10,function(left){if(left.id!=='(name)'){throw new Error("Expected keyword argument name, got "+token.id);}
this.first=left;this.second=expression();return this;});symbol('lambda',20).nud=function(){this.first=[];if(token.id!==':'){for(;;){if(token.id!=='(name)'){throw new Error('Excepted an argument name');}
this.first.push(token);advance();if(token.id!==','){break;}
advance(',');}}
advance(':');this.second=expression();return this;};infix('if',20,function(left){this.first=left;this.second=expression();advance('else');this.third=expression();return this;});infixr('or',30);infixr('and',40);prefix('not',50);comparator('in');comparator('not in');comparator('is');comparator('is not');comparator('<');comparator('<=');comparator('>');comparator('>=');comparator('<>');comparator('!=');comparator('==');infix('|',70);infix('^',80);infix('&',90);infix('<<',100);infix('>>',100);infix('+',110);infix('-',110);infix('*',120);infix('/',120);infix('//',120);infix('%',120);prefix('-',130);prefix('+',130);prefix('~',130);infixr('**',140);infix('.',150,function(left){if(token.id!=='(name)'){throw new Error('Expected attribute name, got '+token.id);}
this.first=left;this.second=token;advance();return this;});symbol('(',150).nud=function(){this.first=[];var comma=false;if(token.id!==')'){while(true){if(token.id===')'){break;}
this.first.push(expression());if(token.id!==','){break;}
comma=true;advance(',');}}
advance(')');if(!this.first.length||comma){return this;}else{return this.first[0];}};symbol('(').led=function(left){this.first=left;this.second=[];if(token.id!==")"){for(;;){this.second.push(expression());if(token.id!==','){break;}
advance(',');}}
advance(")");return this;};infix('[',150,function(left){this.first=left;this.second=expression();advance("]");return this;});symbol('[').nud=function(){this.first=[];if(token.id!==']'){for(;;){if(token.id===']'){break;}
this.first.push(expression());if(token.id!==','){break;}
advance(',');}}
advance(']');return this;};symbol('{').nud=function(){this.first=[];if(token.id!=='}'){for(;;){if(token.id==='}'){break;}
var key=expression();advance(':');var value=expression();this.first.push([key,value]);if(token.id!==','){break;}
advance(',');}}
advance('}');return this;};py.tokenize=(function(){function group(){return'('+Array.prototype.join.call(arguments,'|')+')';}
var Whitespace='[ \\f\\t]*';var Name='[a-zA-Z_]\\w*';var DecNumber='\\d+(L|l)?';var IntNumber=DecNumber;var PointFloat=group('\\d+\\.\\d*','\\.\\d+');var FloatNumber=PointFloat;var Number=group(FloatNumber,IntNumber);var Operator=group("\\*\\*=?",">>=?","<<=?","<>","!=","//=?","[+\\-*/%&|^=<>]=?","~");var Bracket='[\\[\\]\\(\\)\\{\\}]';var Special='[:;.,`@]';var Funny=group(Operator,Bracket,Special);var ContStr=group("([uU])?'([^\n'\\\\]*(?:\\\\.[^\n'\\\\]*)*)'",'([uU])?"([^\n"\\\\]*(?:\\\\.[^\n"\\\\]*)*)"');var PseudoToken=Whitespace+group(Number,Funny,ContStr,Name);var number_pattern=new RegExp('^'+Number+'$');var string_pattern=new RegExp('^'+ContStr+'$');var name_pattern=new RegExp('^'+Name+'$');var strip=new RegExp('^'+Whitespace);return function tokenize(s){var max=s.length,tokens=[],start,end;var pseudoprog=new RegExp(PseudoToken,'g');while(pseudoprog.lastIndex<max){var pseudomatch=pseudoprog.exec(s);if(!pseudomatch){if(/^\s+$/.test(s.slice(end))){break;}
throw new Error('Failed to tokenize <<'+s
+'>> at index '+(end||0)
+'; parsed so far: '+tokens);}
start=pseudomatch.index;end=pseudoprog.lastIndex;var token=s.slice(start,end).replace(strip,'');if(number_pattern.test(token)){tokens.push(create(symbols['(number)'],{value:parseFloat(token)}));}else if(string_pattern.test(token)){var m=string_pattern.exec(token);var value=(m[3]!==undefined?m[3]:m[5]);tokens.push(create(symbols['(string)'],{unicode:!!(m[2]||m[4]),value:value}));}else if(token in symbols){var symbol;if(token==='in'&&tokens.length>1&&tokens[tokens.length-1].id==='not'){symbol=symbols['not in'];tokens.pop();}else if(token==='not'&&tokens.length>1&&tokens[tokens.length-1].id==='is'){symbol=symbols['is not'];tokens.pop();}else{symbol=symbols[token];}
tokens.push(create(symbol));}else if(name_pattern.test(token)){tokens.push(create(symbols['(name)'],{value:token}));}else{throw new Error("Tokenizing failure of <<"+s+">> at index "+start
+" for token [["+token+"]]"
+"; parsed so far: "+tokens);}}
tokens.push(create(symbols['(end)']));return tokens;}})();var token,next;function expression(rbp){rbp=rbp||0;var t=token;token=next();var left=t.nud();while(rbp<token.lbp){t=token;token=next();left=t.led(left);}
return left;}
function advance(id){if(id&&token.id!==id){throw new Error('Expected "'+id+'", got "'+token.id+'"');}
token=next();}
function PY_ensurepy(val,name){switch(val){case undefined:throw new Error("NameError: name '"+name+"' is not defined");case null:return py.None;case true:return py.True;case false:return py.False;}
var fn=function(){};fn.prototype=py.object;if(py.PY_isInstance(val,py.object)||py.PY_isSubclass(val,py.object)){return val;}
switch(typeof val){case'number':return py.float.fromJSON(val);case'string':return py.str.fromJSON(val);case'function':return py.PY_def.fromJSON(val);}
switch(val.constructor){case Object:var o=py.PY_call(py.object);for(var prop in val){if(val.hasOwnProperty(prop)){o[prop]=val[prop];}}
return o;case Array:return py.list.fromJSON(val);}
throw new Error("Could not convert "+val+" to a pyval");}
var typename=function(obj){if(obj.__class__){return obj.__class__.__name__;}else if(typeof obj!=='object'){return typeof obj;}else{return obj.constructor.name;}};py.py={};py.PY_parseArgs=function PY_parseArgs(argument,format){var out={};var args=argument[0];var kwargs={};for(var k in argument[1]){if(!argument[1].hasOwnProperty(k)){continue;}
kwargs[k]=argument[1][k];}
if(typeof format==='string'){format=format.split(/\s+/);}
var name=function(spec){if(typeof spec==='string'){return spec;}else if(spec instanceof Array&&spec.length===2){return spec[0];}
throw new Error("TypeError: unknown format specification "+
JSON.stringify(spec));};var spec;for(var i=0;i<args.length;++i){spec=format[i];if(!spec||spec==='*'){throw new Error("TypeError: function takes exactly "+(i-1)+" positional arguments ("+args.length+" given")}else if(/^\*\w/.test(spec)){out[name(spec.slice(1))]=args.slice(i);break;}
out[name(spec)]=args[i];}
for(var j=i;j<format.length;++j){spec=format[j];var n=name(spec);if(n in out){throw new Error("TypeError: function got multiple values "+"for keyword argument '"+kwarg+"'");}
if(/^\*\*\w/.test(n)){out[n.slice(2)]=kwargs;kwargs={};break;}
if(n in kwargs){out[n]=kwargs[n];delete kwargs[n];}}
for(var key in kwargs){throw new Error("TypeError: function got an unexpected keyword argument '"
+key+"'");}
var kwonly=0;for(var k=0;k<format.length;++k){if(/^\*/.test(format[k])){kwonly=1;break;}}
for(var k=0;k<format.length;++k){spec=format[k];var n=name(spec);if(/^\*/.test(n)||n in out){continue;}
if(!(spec instanceof Array)){throw new Error("TypeError: function takes exactly "+(format.length-kwonly)
+" arguments");}
out[n]=spec[1];}
return out;};py.PY_hasAttr=function(o,attr_name){try{py.PY_getAttr(o,attr_name);return true;}catch(e){return false;}};py.PY_getAttr=function(o,attr_name){return PY_ensurepy(o.__getattribute__(attr_name));};py.PY_str=function(o){var v=o.__str__();if(py.PY_isInstance(v,py.str)){return v;}
throw new Error('TypeError: __str__ returned non-string (type '
+typename(v)
+')');};py.PY_isInstance=function(inst,cls){var fn=function(){};fn.prototype=cls;return inst instanceof fn;};py.PY_isSubclass=function(derived,cls){var fn=function(){};fn.prototype=cls;return derived===cls||derived instanceof fn;};py.PY_call=function(callable,args,kwargs){if(!args){args=[];}
if(typeof args==='object'&&!(args instanceof Array)){kwargs=args;args=[];}
if(!kwargs){kwargs={};}
if(callable.__is_type){var instance=callable.__new__.call(callable,args,kwargs);var typ=function(){};typ.prototype=callable;if(instance instanceof typ){instance.__init__.call(instance,args,kwargs);}
return instance}
return callable.__call__(args,kwargs);};py.PY_isTrue=function(o){var res=o.__nonzero__();if(res===py.True){return true;}
if(res===py.False){return false;}
throw new Error("TypeError: __nonzero__ should return bool, returned "
+typename(res));};py.PY_not=function(o){return!py.PY_isTrue(o);};py.PY_size=function(o){if(!o.__len__){throw new Error("TypeError: object of type '"+
typename(o)+"' has no len()");}
var v=o.__len__();if(typeof v!=='number'){throw new Error("TypeError: a number is required");}
return v;};py.PY_getItem=function(o,key){if(!('__getitem__'in o)){throw new Error("TypeError: '"+typename(o)+"' object is unsubscriptable")}
if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: '"+typename(key)+"' is not a py.js object");}
var res=o.__getitem__(key);if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: __getitem__ must return a py.js object, got "
+typename(res));}
return res;};py.PY_setItem=function(o,key,v){if(!('__setitem__'in o)){throw new Error("TypeError: '"+typename(o)+"' object does not support item assignment");}
if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: '"+typename(key)+"' is not a py.js object");}
if(!py.PY_isInstance(v,py.object)){throw new Error("TypeError: '"+typename(v)+"' is not a py.js object");}
o.__setitem__(key,v);};py.PY_add=function(o1,o2){return PY_op(o1,o2,'+');};py.PY_subtract=function(o1,o2){return PY_op(o1,o2,'-');};py.PY_multiply=function(o1,o2){return PY_op(o1,o2,'*');};py.PY_divide=function(o1,o2){return PY_op(o1,o2,'/');};py.PY_negative=function(o){if(!o.__neg__){throw new Error("TypeError: bad operand for unary -: '"
+typename(o)
+"'");}
return o.__neg__();};py.PY_positive=function(o){if(!o.__pos__){throw new Error("TypeError: bad operand for unary +: '"
+typename(o)
+"'");}
return o.__pos__();};py.type=function type(name,bases,dict){if(typeof name!=='string'){throw new Error("ValueError: a class name should be a string");}
if(!bases||bases.length===0){bases=[py.object];}else if(bases.length>1){throw new Error("ValueError: can't provide multiple bases for a "
+"new type");}
var base=bases[0];var ClassObj=create(base);if(dict){for(var k in dict){if(!dict.hasOwnProperty(k)){continue;}
ClassObj[k]=dict[k];}}
ClassObj.__class__=ClassObj;ClassObj.__name__=name;ClassObj.__bases__=bases;ClassObj.__is_type=true;return ClassObj;};py.type.__call__=function(){var args=py.PY_parseArgs(arguments,['object']);return args.object.__class__;};var hash_counter=0;py.object=py.type('object',[{}],{__new__:function(){var inst=create(this);inst.__is_type=false;return inst;},__init__:function(){},__hash__:function(){if(this._hash){return this._hash;}
return this._hash='\0\0\0'+String(hash_counter++);},__eq__:function(other){return(this===other)?py.True:py.False;},__ne__:function(other){if(py.PY_isTrue(this.__eq__(other))){return py.False;}else{return py.True;}},__lt__:function(){return py.NotImplemented;},__le__:function(){return py.NotImplemented;},__ge__:function(){return py.NotImplemented;},__gt__:function(){return py.NotImplemented;},__str__:function(){return this.__unicode__();},__unicode__:function(){return py.str.fromJSON('<'+typename(this)+' object>');},__nonzero__:function(){return py.True;},__getattribute__:function(name){if(name in this){var val=this[name];if(typeof val==='object'&&'__get__'in val){return val.__get__(this,py.PY_call(py.type,[this]));}
if(typeof val==='function'&&!this.hasOwnProperty(name)){return PY_instancemethod.fromJSON(val,this);}
return val;}
if('__getattr__'in this){return this.__getattr__(name);}
throw new Error("AttributeError: object has no attribute '"+name+"'");},__setattr__:function(name,value){if(name in this&&'__set__'in this[name]){this[name].__set__(this,value);}
this[name]=value;},toJSON:function(){throw new Error(this.constructor.name+' can not be converted to JSON');}});var NoneType=py.type('NoneType',null,{__nonzero__:function(){return py.False;},toJSON:function(){return null;}});py.None=py.PY_call(NoneType);var NotImplementedType=py.type('NotImplementedType',null,{});py.NotImplemented=py.PY_call(NotImplementedType);var booleans_initialized=false;py.bool=py.type('bool',null,{__new__:function(){if(!booleans_initialized){return py.object.__new__.apply(this);}
var ph={};var args=py.PY_parseArgs(arguments,[['value',ph]]);if(args.value===ph){return py.False;}
return py.PY_isTrue(args.value)?py.True:py.False;},__str__:function(){return py.str.fromJSON((this===py.True)?"True":"False");},__nonzero__:function(){return this;},fromJSON:function(val){return val?py.True:py.False},toJSON:function(){return this===py.True;}});py.True=py.PY_call(py.bool);py.False=py.PY_call(py.bool);booleans_initialized=true;py.float=py.type('float',null,{__init__:function(){var placeholder={};var args=py.PY_parseArgs(arguments,[['value',placeholder]]);var value=args.value;if(value===placeholder){this._value=0;return;}
if(py.PY_isInstance(value,py.float)){this._value=value._value;}
if(py.PY_isInstance(value,py.object)&&'__float__'in value){var res=value.__float__();if(py.PY_isInstance(res,py.float)){this._value=res._value;return;}
throw new Error('TypeError: __float__ returned non-float (type '+
typename(res)+')');}
throw new Error('TypeError: float() argument must be a string or a number');},__str__:function(){return py.str.fromJSON(String(this._value));},__eq__:function(other){return this._value===other._value?py.True:py.False;},__lt__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value<other._value?py.True:py.False;},__le__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value<=other._value?py.True:py.False;},__gt__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value>other._value?py.True:py.False;},__ge__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value>=other._value?py.True:py.False;},__abs__:function(){return py.float.fromJSON(Math.abs(this._value));},__add__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value+other._value);},__mod__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value%other._value);},__neg__:function(){return py.float.fromJSON(-this._value);},__sub__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value-other._value);},__mul__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value*other._value);},__pow__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value**other._value);},__div__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value/other._value);},__nonzero__:function(){return this._value?py.True:py.False;},fromJSON:function(v){if(!(typeof v==='number')){throw new Error('py.float.fromJSON can only take numbers');}
var instance=py.PY_call(py.float);instance._value=v;return instance;},toJSON:function(){return this._value;}});py.str=py.type('str',null,{__init__:function(){var placeholder={};var args=py.PY_parseArgs(arguments,[['value',placeholder]]);var s=args.value;if(s===placeholder){this._value='';return;}
this._value=py.PY_str(s)._value;},__hash__:function(){return'\1\0\1'+this._value;},__str__:function(){return this;},__eq__:function(other){if(py.PY_isInstance(other,py.str)&&this._value===other._value){return py.True;}
return py.False;},__lt__:function(other){if(py.PY_not(py.PY_call(py.isinstance,[other,py.str]))){return py.NotImplemented;}
return this._value<other._value?py.True:py.False;},__le__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value<=other._value?py.True:py.False;},__gt__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value>other._value?py.True:py.False;},__ge__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value>=other._value?py.True:py.False;},__add__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return py.str.fromJSON(this._value+other._value);},__nonzero__:function(){return this._value.length?py.True:py.False;},__contains__:function(s){return(this._value.indexOf(s._value)!==-1)?py.True:py.False;},fromJSON:function(s){if(typeof s==='string'){var instance=py.PY_call(py.str);instance._value=s;return instance;}
throw new Error("str.fromJSON can only take strings");},toJSON:function(){return this._value;}});py.tuple=py.type('tuple',null,{__init__:function(){this._values=[];},__len__:function(){return this._values.length;},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},__contains__:function(value){for(var i=0,len=this._values.length;i<len;++i){if(py.PY_isTrue(this._values[i].__eq__(value))){return py.True;}}
return py.False;},__getitem__:function(index){return this._values[index.toJSON()];},toJSON:function(){var out=[];for(var i=0;i<this._values.length;++i){out.push(this._values[i].toJSON());}
return out;},fromJSON:function(ar){if(!(ar instanceof Array)){throw new Error("Can only create a py.tuple from an Array");}
var t=py.PY_call(py.tuple);for(var i=0;i<ar.length;++i){t._values.push(PY_ensurepy(ar[i]));}
return t;}});py.list=py.type('list',null,{__nonzero__:function(){return this.__len__>0?py.True:py.False;},});_.defaults(py.list,py.tuple)
py.dict=py.type('dict',null,{__init__:function(){this._store={};},__getitem__:function(key){var h=key.__hash__();if(!(h in this._store)){throw new Error("KeyError: '"+key.toJSON()+"'");}
return this._store[h][1];},__setitem__:function(key,value){this._store[key.__hash__()]=[key,value];},__len__:function(){return Object.keys(this._store).length},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},get:function(){var args=py.PY_parseArgs(arguments,['k',['d',py.None]]);var h=args.k.__hash__();if(!(h in this._store)){return args.d;}
return this._store[h][1];},fromJSON:function(d){var instance=py.PY_call(py.dict);for(var k in(d||{})){if(!d.hasOwnProperty(k)){continue;}
instance.__setitem__(py.str.fromJSON(k),PY_ensurepy(d[k]));}
return instance;},toJSON:function(){var out={};for(var k in this._store){var item=this._store[k];out[item[0].toJSON()]=item[1].toJSON();}
return out;}});py.PY_def=py.type('function',null,{__call__:function(){return this._func.apply(this._inst,arguments);},fromJSON:function(nativefunc){var instance=py.PY_call(py.PY_def);instance._inst=null;instance._func=nativefunc;return instance;},toJSON:function(){return this._func;}});py.classmethod=py.type('classmethod',null,{__init__:function(){var args=py.PY_parseArgs(arguments,'function');this._func=args['function'];},__get__:function(obj,type){return PY_instancemethod.fromJSON(this._func,type);},fromJSON:function(func){return py.PY_call(py.classmethod,[func]);}});var PY_instancemethod=py.type('instancemethod',[py.PY_def],{fromJSON:function(nativefunc,instance){var inst=py.PY_call(PY_instancemethod);inst._inst=instance;inst._func=nativefunc;return inst;}});py.abs=new py.PY_def.fromJSON(function abs(){var args=py.PY_parseArgs(arguments,['number']);if(!args.number.__abs__){throw new Error("TypeError: bad operand type for abs(): '"
+typename(args.number)
+"'");}
return args.number.__abs__();});py.len=new py.PY_def.fromJSON(function len(){var args=py.PY_parseArgs(arguments,['object']);return py.float.fromJSON(py.PY_size(args.object));});py.isinstance=new py.PY_def.fromJSON(function isinstance(){var args=py.PY_parseArgs(arguments,['object','class']);return py.PY_isInstance(args.object,args['class'])?py.True:py.False;});py.issubclass=new py.PY_def.fromJSON(function issubclass(){var args=py.PY_parseArgs(arguments,['C','B']);return py.PY_isSubclass(args.C,args.B)?py.True:py.False;});var PY_decode_string_literal=function(str,unicode){var out=[],code;var direct_map={'\\':'\\','"':'"',"'":"'",'a':'\x07','b':'\x08','f':'\x0c','n':'\n','r':'\r','t':'\t','v':'\v'};for(var i=0;i<str.length;++i){if(str[i]!=='\\'){out.push(str[i]);continue;}
var escape=str[i+1];if(escape in direct_map){out.push(direct_map[escape]);++i;continue;}
switch(escape){case'\n':++i;continue;case'N':if(!unicode){break;}
throw Error("SyntaxError: \\N{} escape not implemented");case'u':if(!unicode){break;}
var uni=str.slice(i+2,i+6);if(!/[0-9a-f]{4}/i.test(uni)){throw new Error(["SyntaxError: (unicode error) 'unicodeescape' codec"," can't decode bytes in position ",i,"-",i+4,": truncated \\uXXXX escape"].join(''));}
code=parseInt(uni,16);out.push(String.fromCharCode(code));i+=5;continue;case'U':if(!unicode){break;}
throw Error("SyntaxError: \\U escape not implemented");case'x':var hex=str.slice(i+2,i+4);if(!/[0-9a-f]{2}/i.test(hex)){if(!unicode){throw new Error('ValueError: invalid \\x escape');}
throw new Error(["SyntaxError: (unicode error) 'unicodeescape'"," codec can't decode bytes in position ",i,'-',i+2,": truncated \\xXX escape"].join(''))}
code=parseInt(hex,16);out.push(String.fromCharCode(code));i+=3;continue;default:if(!/[0-8]/.test(escape)){break;}
var r=/[0-8]{1,3}/g;r.lastIndex=i+1;var m=r.exec(str);var oct=m[0];code=parseInt(oct,8);out.push(String.fromCharCode(code));i+=oct.length;continue;}
out.push('\\');}
return out.join('');};var PY_operators={'==':['eq','eq',function(a,b){return a===b;}],'!=':['ne','ne',function(a,b){return a!==b;}],'<>':['ne','ne',function(a,b){return a!==b;}],'<':['lt','gt',function(a,b){return a.__class__.__name__<b.__class__.__name__;}],'<=':['le','ge',function(a,b){return a.__class__.__name__<=b.__class__.__name__;}],'>':['gt','lt',function(a,b){return a.__class__.__name__>b.__class__.__name__;}],'>=':['ge','le',function(a,b){return a.__class__.__name__>=b.__class__.__name__;}],'+':['add','radd'],'-':['sub','rsub'],'*':['mul','rmul'],'/':['div','rdiv'],'//':['floordiv','rfloordiv'],'%':['mod','rmod'],'**':['pow','rpow'],'<<':['lshift','rlshift'],'>>':['rshift','rrshift'],'&':['and','rand'],'^':['xor','rxor'],'|':['or','ror']};var PY_op=function(o1,o2,op){var r;var methods=PY_operators[op];var forward='__'+methods[0]+'__',reverse='__'+methods[1]+'__';var otherwise=methods[2];if(forward in o1&&(r=o1[forward](o2))!==py.NotImplemented){return r;}
if(reverse in o2&&(r=o2[reverse](o1))!==py.NotImplemented){return r;}
if(otherwise){return PY_ensurepy(otherwise(o1,o2));}
throw new Error("TypeError: unsupported operand type(s) for "+op+": '"
+typename(o1)+"' and '"+typename(o2)+"'");};var PY_builtins={type:py.type,None:py.None,True:py.True,False:py.False,NotImplemented:py.NotImplemented,object:py.object,bool:py.bool,float:py.float,str:py.str,unicode:py.unicode,tuple:py.tuple,list:py.list,dict:py.dict,abs:py.abs,len:py.len,isinstance:py.isinstance,issubclass:py.issubclass,classmethod:py.classmethod,};py.parse=function(toks){var index=0;token=toks[0];next=function(){return toks[++index];};return expression();};var evaluate_operator=function(operator,a,b){switch(operator){case'is':return a===b?py.True:py.False;case'is not':return a!==b?py.True:py.False;case'in':return b.__contains__(a);case'not in':return py.PY_isTrue(b.__contains__(a))?py.False:py.True;case'==':case'!=':case'<>':case'<':case'<=':case'>':case'>=':return PY_op(a,b,operator);}
throw new Error('SyntaxError: unknown comparator [['+operator+']]');};py.evaluate=function(expr,context){context=context||{};switch(expr.id){case'(name)':var val=context[expr.value];if(val===undefined&&expr.value in PY_builtins){return PY_builtins[expr.value];}
return PY_ensurepy(val,expr.value);case'(string)':return py.str.fromJSON(PY_decode_string_literal(expr.value,expr.unicode));case'(number)':return py.float.fromJSON(expr.value);case'(constant)':switch(expr.value){case'None':return py.None;case'False':return py.False;case'True':return py.True;}
throw new Error("SyntaxError: unknown constant '"+expr.value+"'");case'(comparator)':var result,left=py.evaluate(expr.expressions[0],context);for(var i=0;i<expr.operators.length;++i){result=evaluate_operator(expr.operators[i],left,left=py.evaluate(expr.expressions[i+1],context));if(py.PY_not(result)){return py.False;}}
return py.True;case'not':return py.PY_isTrue(py.evaluate(expr.first,context))?py.False:py.True;case'and':var and_first=py.evaluate(expr.first,context);if(py.PY_isTrue(and_first.__nonzero__())){return py.evaluate(expr.second,context);}
return and_first;case'or':var or_first=py.evaluate(expr.first,context);if(py.PY_isTrue(or_first.__nonzero__())){return or_first}
return py.evaluate(expr.second,context);case'(':if(expr.second){var callable=py.evaluate(expr.first,context);var args=[],kwargs={};for(var jj=0;jj<expr.second.length;++jj){var arg=expr.second[jj];if(arg.id!=='='){args.push(py.evaluate(arg,context));}else{kwargs[arg.first.value]=py.evaluate(arg.second,context);}}
return py.PY_call(callable,args,kwargs);}
var tuple_exprs=expr.first,tuple_values=[];for(var j=0,len=tuple_exprs.length;j<len;++j){tuple_values.push(py.evaluate(tuple_exprs[j],context));}
return py.tuple.fromJSON(tuple_values);case'[':if(expr.second){return py.PY_getItem(py.evaluate(expr.first,context),py.evaluate(expr.second,context));}
var list_exprs=expr.first,list_values=[];for(var k=0;k<list_exprs.length;++k){list_values.push(py.evaluate(list_exprs[k],context));}
return py.list.fromJSON(list_values);case'{':var dict_exprs=expr.first,dict=py.PY_call(py.dict);for(var l=0;l<dict_exprs.length;++l){py.PY_setItem(dict,py.evaluate(dict_exprs[l][0],context),py.evaluate(dict_exprs[l][1],context));}
return dict;case'.':if(expr.second.id!=='(name)'){throw new Error('SyntaxError: '+expr);}
return py.PY_getAttr(py.evaluate(expr.first,context),expr.second.value);case'~':return(py.evaluate(expr.first,context)).__invert__();case'+':if(!expr.second){return py.PY_positive(py.evaluate(expr.first,context));}
case'-':if(!expr.second){return py.PY_negative(py.evaluate(expr.first,context));}
case'*':case'/':case'//':case'%':case'**':case'<<':case'>>':case'&':case'^':case'|':return PY_op(py.evaluate(expr.first,context),py.evaluate(expr.second,context),expr.id);default:throw new Error('SyntaxError: Unknown node [['+expr.id+']]');}};py.eval=function(str,context){return py.evaluate(py.parse(py.tokenize(str)),context).toJSON();}})(typeof exports==='undefined'?py:exports);;

/* /web/static/lib/py.js/lib/py_extras.js defined in bundle 'web.assets_backend' */
(function(py){"use strict";function divmod(a,b,fn){var mod=a%b;if(mod>0&&b<0||mod<0&&b>0){mod+=b;}
return fn(Math.floor(a/b),mod);}
function modf(x,fn){var mod=x%1;if(mod<0){mod+=1;}
return fn(mod,Math.floor(x));}
function assert(bool){if(!bool){throw new Error("AssertionError");}}
var obj=function(){};obj.prototype=py.object;var asJS=function(arg){if(arg instanceof obj){return arg.toJSON();}
return arg;};var datetime=py.PY_call(py.object);var zero=py.float.fromJSON(0);var DAYS_IN_MONTH=[null,31,28,31,30,31,30,31,31,30,31,30,31];var DAYS_BEFORE_MONTH=[null];var dbm=0;for(var i=1;i<DAYS_IN_MONTH.length;++i){DAYS_BEFORE_MONTH.push(dbm);dbm+=DAYS_IN_MONTH[i];}
function is_leap(year){return year%4===0&&(year%100!==0||year%400===0);}
function days_before_year(year){var y=year-1;return y*365+Math.floor(y/4)-Math.floor(y/100)+Math.floor(y/400);}
function days_in_month(year,month){if(month===2&&is_leap(year)){return 29;}
return DAYS_IN_MONTH[month];}
function days_before_month(year,month){var post_leap_feb=month>2&&is_leap(year);return DAYS_BEFORE_MONTH[month]+(post_leap_feb?1:0);}
function ymd2ord(year,month,day){var dim=days_in_month(year,month);if(!(1<=day&&day<=dim)){throw new Error("ValueError: day must be in 1.."+dim);}
return days_before_year(year)+
days_before_month(year,month)+
day;}
function get_quarter_number(month){return Math.ceil(month/3);}
function get_quarter(year,month){var quarter_number=get_quarter_number(month);var month_from=((quarter_number-1)*3)+1
var date_from={year:year,month:month_from,day:1}
var date_to={year:year,month:month_from+2,day:days_in_month(year,month)}
return[date_from,date_to];}
function get_day_of_week(year,month,day){var d=new Date(year,month-1,day);return(d.getDay()+6)%7;}
var DI400Y=days_before_year(401);var DI100Y=days_before_year(101);var DI4Y=days_before_year(5);function ord2ymd(n){--n;var n400,n100,n4,n1,n0;divmod(n,DI400Y,function(_n400,n){n400=_n400;divmod(n,DI100Y,function(_n100,n){n100=_n100;divmod(n,DI4Y,function(_n4,n){n4=_n4;divmod(n,365,function(_n1,n){n1=_n1;n0=n;});});});});n=n0;var year=n400*400+1+n100*100+n4*4+n1;if(n1==4||n100==100){assert(n0===0);return{year:year-1,month:12,day:31};}
var leapyear=n1===3&&(n4!==24||n100==3);assert(leapyear==is_leap(year));var month=(n+50)>>5;var preceding=DAYS_BEFORE_MONTH[month]+((month>2&&leapyear)?1:0);if(preceding>n){--month;preceding-=DAYS_IN_MONTH[month]+((month===2&&leapyear)?1:0);}
n-=preceding;return{year:year,month:month,day:n+1};}
function tmxxx(year,month,day,hour,minute,second,microsecond){hour=hour||0;minute=minute||0;second=second||0;microsecond=microsecond||0;if(microsecond<0||microsecond>999999){divmod(microsecond,1000000,function(carry,ms){microsecond=ms;second+=carry;});}
if(second<0||second>59){divmod(second,60,function(carry,s){second=s;minute+=carry;});}
if(minute<0||minute>59){divmod(minute,60,function(carry,m){minute=m;hour+=carry;});}
if(hour<0||hour>23){divmod(hour,24,function(carry,h){hour=h;day+=carry;});}
if(month<1||month>12){divmod(month-1,12,function(carry,m){month=m+1;year+=carry;});}
var dim=days_in_month(year,month);if(day<1||day>dim){if(day===0){--month;if(month>0){day=days_in_month(year,month);}else{--year;month=12;day=31;}}else if(day==dim+1){++month;day=1;if(month>12){month=1;++year;}}else{var r=ord2ymd(ymd2ord(year,month,1)+(day-1));year=r.year;month=r.month;day=r.day;}}
return{year:year,month:month,day:day,hour:hour,minute:minute,second:second,microsecond:microsecond};}
datetime.timedelta=py.type('timedelta',null,{__init__:function(){var args=py.PY_parseArgs(arguments,[['days',zero],['seconds',zero],['microseconds',zero],['milliseconds',zero],['minutes',zero],['hours',zero],['weeks',zero]]);var d=0,s=0,m=0;var days=args.days.toJSON()+args.weeks.toJSON()*7;var seconds=args.seconds.toJSON()
+args.minutes.toJSON()*60
+args.hours.toJSON()*3600;var microseconds=args.microseconds.toJSON()
+args.milliseconds.toJSON()*1000;var daysecondsfrac=modf(days,function(dayfrac,days){d=days;if(dayfrac){return modf(dayfrac*24*3600,function(dsf,dsw){s=dsw;return dsf;});}
return 0;});var secondsfrac=modf(seconds,function(sf,s){seconds=s;return sf+daysecondsfrac;});divmod(seconds,24*3600,function(days,seconds){d+=days;s+=seconds;});microseconds+=secondsfrac*1e6;divmod(microseconds,1000000,function(seconds,microseconds){divmod(seconds,24*3600,function(days,seconds){d+=days;s+=seconds;m+=Math.round(microseconds);});});this.days=d;this.seconds=s;this.microseconds=m;},__str__:function(){var hh,mm,ss;divmod(this.seconds,60,function(m,s){divmod(m,60,function(h,m){hh=h;mm=m;ss=s;});});var s=_.str.sprintf("%d:%02d:%02d",hh,mm,ss);if(this.days){s=_.str.sprintf("%d day%s, %s",this.days,(this.days!=1&&this.days!=-1)?'s':'',s);}
if(this.microseconds){s=_.str.sprintf("%s.%06d",s,this.microseconds);}
return py.str.fromJSON(s);},__eq__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.False;}
return(this.days===other.days&&this.seconds===other.seconds&&this.microseconds===other.microseconds)?py.True:py.False;},__add__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days+other.days),py.float.fromJSON(this.seconds+other.seconds),py.float.fromJSON(this.microseconds+other.microseconds)]);},__radd__:function(other){return this.__add__(other);},__sub__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days-other.days),py.float.fromJSON(this.seconds-other.seconds),py.float.fromJSON(this.microseconds-other.microseconds)]);},__rsub__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return this.__neg__().__add__(other);},__neg__:function(){return py.PY_call(datetime.timedelta,[py.float.fromJSON(-this.days),py.float.fromJSON(-this.seconds),py.float.fromJSON(-this.microseconds)]);},__pos__:function(){return this;},__mul__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
var n=other.toJSON();return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days*n),py.float.fromJSON(this.seconds*n),py.float.fromJSON(this.microseconds*n)]);},__rmul__:function(other){return this.__mul__(other);},__div__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
var usec=((this.days*24*3600)+this.seconds)*1000000
+this.microseconds;return py.PY_call(datetime.timedelta,[zero,zero,py.float.fromJSON(usec/other.toJSON())]);},__floordiv__:function(other){return this.__div__(other);},total_seconds:function(){return py.float.fromJSON(this.days*86400
+this.seconds
+this.microseconds/1000000);},__nonzero__:function(){return(!!this.days||!!this.seconds||!!this.microseconds)?py.True:py.False;}});datetime.datetime=py.type('datetime',null,{__init__:function(){var zero=py.float.fromJSON(0);var args=py.PY_parseArgs(arguments,['year','month','day',['hour',zero],['minute',zero],['second',zero],['microsecond',zero],['tzinfo',py.None]]);for(var key in args){if(!args.hasOwnProperty(key)){continue;}
this[key]=asJS(args[key]);}},__eq__:function(other){return(this.year===other.year&&this.month===other.month&&this.day===other.day&&this.hour===other.hour&&this.minute===other.minute&&this.second===other.second&&this.microsecond===other.microsecond&&this.tzinfo===other.tzinfo)?py.True:py.False;},replace:function(){var args=py.PY_parseArgs(arguments,[['year',py.None],['month',py.None],['day',py.None],['hour',py.None],['minute',py.None],['second',py.None],['microsecond',py.None]]);var params={};for(var key in args){if(!args.hasOwnProperty(key)){continue;}
var arg=args[key];params[key]=(arg===py.None?this[key]:asJS(arg));}
return py.PY_call(datetime.datetime,params);},start_of:function(){var args=py.PY_parseArgs(arguments,'granularity');var granularity=args.granularity.toJSON();if(granularity==='year'){return py.PY_call(datetime.datetime,[this.year,1,1]);}else if(granularity==='quarter'){var quarter=get_quarter(this.year,this.month)[0];return py.PY_call(datetime.datetime,[quarter.year,quarter.month,quarter.day]);}else if(granularity==='month'){return py.PY_call(datetime.datetime,[this.year,this.month,1]);}else if(granularity==='week'){var dow=get_day_of_week(this.year,this.month,this.day);return py.PY_call(datetime.datetime,[this.year,this.month,this.day-dow]);}else if(granularity==='day'){return py.PY_call(datetime.datetime,[this.year,this.month,this.day]);}else if(granularity==='hour'){return py.PY_call(datetime.datetime,[this.year,this.month,this.day,this.hour]);}else{throw new Error('ValueError: '+granularity+' is not a supported granularity, supported '+' granularities are: year, quarter, month, week, day and hour.')}},end_of:function(){var args=py.PY_parseArgs(arguments,'granularity');var granularity=args.granularity.toJSON();var min=[23,59,59];if(granularity==='year'){return py.PY_call(datetime.datetime,[this.year,12,31].concat(min));}else if(granularity==='quarter'){var quarter=get_quarter(this.year,this.month)[1];return py.PY_call(datetime.datetime,[quarter.year,quarter.month,quarter.day].concat(min));}else if(granularity==='month'){var dom=days_in_month(this.year,this.month);return py.PY_call(datetime.datetime,[this.year,this.month,dom].concat(min));}else if(granularity==='week'){var dow=get_day_of_week(this.year,this.month,this.day);return py.PY_call(datetime.datetime,[this.year,this.month,this.day+(6-dow)].concat(min));}else if(granularity==='day'){return py.PY_call(datetime.datetime,[this.year,this.month,this.day].concat(min));}else if(granularity==='hour'){return py.PY_call(datetime.datetime,[this.year,this.month,this.day,this.hour,59,59]);}else{throw new Error('ValueError: '+granularity+' is not a supported granularity, supported '+' granularities are: year, quarter, month, week, day and hour.')}},add:function(){var args=py.PY_parseArgs(arguments,[['years',py.None],['months',py.None],['days',py.None],['hours',py.None],['minutes',py.None],['seconds',py.None],]);return py.PY_add(this,py.PY_call(relativedelta,{'years':args.years,'months':args.months,'days':args.days,'hours':args.hours,'minutes':args.minutes,'seconds':args.seconds,}));},subtract:function(){var args=py.PY_parseArgs(arguments,[['years',py.None],['months',py.None],['days',py.None],['hours',py.None],['minutes',py.None],['seconds',py.None],]);var params={};for(var key in args){params[key]=(args[key]===py.None?args[key]:py.float.fromJSON(-asJS(args[key])));}
return py.PY_add(this,py.PY_call(relativedelta,params));},strftime:function(){var self=this;var args=py.PY_parseArgs(arguments,'format');return py.str.fromJSON(args.format.toJSON().replace(/%([A-Za-z])/g,function(m,c){switch(c){case'Y':return _.str.sprintf('%04d',self.year);case'm':return _.str.sprintf('%02d',self.month);case'd':return _.str.sprintf('%02d',self.day);case'H':return _.str.sprintf('%02d',self.hour);case'M':return _.str.sprintf('%02d',self.minute);case'S':return _.str.sprintf('%02d',self.second);}
throw new Error('ValueError: No known conversion for '+m);}));},to_utc:function(){var d=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);var offset=d.getTimezoneOffset();var kwargs={minutes:py.float.fromJSON(offset)};var timedelta=py.PY_call(py.extras.datetime.timedelta,[],kwargs);var s=tmxxx(this.year,this.month,this.day+timedelta.days,this.hour,this.minute,this.second+timedelta.seconds);return datetime.datetime.fromJSON(s.year,s.month,s.day,s.hour,s.minute,s.second);},now:py.classmethod.fromJSON(function(){var d=new Date();return py.PY_call(datetime.datetime,[d.getFullYear(),d.getMonth()+1,d.getDate(),d.getHours(),d.getMinutes(),d.getSeconds(),d.getMilliseconds()*1000]);}),today:py.classmethod.fromJSON(function(){var dt_class=py.PY_getAttr(datetime,'datetime');return py.PY_call(py.PY_getAttr(dt_class,'now'));}),utcnow:py.classmethod.fromJSON(function(){var d=new Date();return py.PY_call(datetime.datetime,[d.getUTCFullYear(),d.getUTCMonth()+1,d.getUTCDate(),d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()*1000]);}),combine:py.classmethod.fromJSON(function(){var args=py.PY_parseArgs(arguments,'date time');return py.PY_call(datetime.datetime,[py.PY_getAttr(args.date,'year'),py.PY_getAttr(args.date,'month'),py.PY_getAttr(args.date,'day'),py.PY_getAttr(args.time,'hour'),py.PY_getAttr(args.time,'minute'),py.PY_getAttr(args.time,'second')]);}),toJSON:function(){return new Date(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.microsecond/1000);},__add__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
var s=tmxxx(this.year,this.month,this.day+other.days,this.hour,this.minute,this.second+other.seconds);return datetime.datetime.fromJSON(s.year,s.month,s.day,s.hour,s.minute,s.second);},__sub__:function(other){if(py.PY_isInstance(other,datetime.timedelta)){return py.PY_add(this,py.PY_negative(other));}
return py.NotImplemented;},fromJSON:function(year,month,day,hour,minute,second){return py.PY_call(datetime.datetime,[year,month,day,hour,minute,second]);},});datetime.date=py.type('date',null,{__init__:function(){var args=py.PY_parseArgs(arguments,'year month day');this.year=asJS(args.year);this.month=asJS(args.month);this.day=asJS(args.day);},strftime:function(){var self=this;var args=py.PY_parseArgs(arguments,'format');return py.str.fromJSON(args.format.toJSON().replace(/%([A-Za-z])/g,function(m,c){switch(c){case'Y':return self.year;case'm':return _.str.sprintf('%02d',self.month);case'd':return _.str.sprintf('%02d',self.day);}
throw new Error('ValueError: No known conversion for '+m);}));},__eq__:function(other){return(this.year===other.year&&this.month===other.month&&this.day===other.day)?py.True:py.False;},replace:function(){var args=py.PY_parseArgs(arguments,[['year',py.None],['month',py.None],['day',py.None]]);var params={};for(var key in args){if(!args.hasOwnProperty(key)){continue;}
var arg=args[key];params[key]=(arg===py.None?this[key]:asJS(arg));}
return py.PY_call(datetime.date,params);},start_of:function(){var args=py.PY_parseArgs(arguments,'granularity');var granularity=args.granularity.toJSON();if(granularity==='year'){return py.PY_call(datetime.date,[this.year,1,1]);}else if(granularity==='quarter'){var quarter=get_quarter(this.year,this.month)[0];return py.PY_call(datetime.date,[quarter.year,quarter.month,quarter.day]);}else if(granularity==='month'){return py.PY_call(datetime.date,[this.year,this.month,1]);}else if(granularity==='week'){var dow=get_day_of_week(this.year,this.month,this.day);return py.PY_call(datetime.date,[this.year,this.month,this.day-dow]);}else if(granularity==='day'){return py.PY_call(datetime.date,[this.year,this.month,this.day]);}else{throw new Error('ValueError: '+granularity+' is not a supported granularity, supported '+' granularities are: year, quarter, month, week and day.')}},end_of:function(){var args=py.PY_parseArgs(arguments,'granularity');var granularity=args.granularity.toJSON();if(granularity==='year'){return py.PY_call(datetime.date,[this.year,12,31]);}else if(granularity==='quarter'){var quarter=get_quarter(this.year,this.month)[1];return py.PY_call(datetime.date,[quarter.year,quarter.month,quarter.day]);}else if(granularity==='month'){var dom=days_in_month(this.year,this.month);return py.PY_call(datetime.date,[this.year,this.month,dom]);}else if(granularity==='week'){var dow=get_day_of_week(this.year,this.month,this.day);return py.PY_call(datetime.date,[this.year,this.month,this.day+(6-dow)]);}else if(granularity==='day'){return py.PY_call(datetime.date,[this.year,this.month,this.day]);}else{throw new Error('ValueError: '+granularity+' is not a supported granularity, supported '+' granularities are: year, quarter, month, week and day.')}},add:function(){var args=py.PY_parseArgs(arguments,[['years',py.None],['months',py.None],['days',py.None],]);return py.PY_add(this,py.PY_call(relativedelta,{'years':args.years,'months':args.months,'days':args.days,}));},subtract:function(){var args=py.PY_parseArgs(arguments,[['years',py.None],['months',py.None],['days',py.None],]);var params={};for(var key in args){params[key]=(args[key]===py.None?args[key]:py.float.fromJSON(-asJS(args[key])));}
return py.PY_add(this,py.PY_call(relativedelta,params));},__add__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
var s=tmxxx(this.year,this.month,this.day+other.days);return datetime.date.fromJSON(s.year,s.month,s.day);},__radd__:function(other){return this.__add__(other);},__sub__:function(other){if(py.PY_isInstance(other,datetime.timedelta)){return py.PY_add(this,py.PY_negative(other));}
if(py.PY_isInstance(other,datetime.date)){return py.PY_call(datetime.timedelta,[py.PY_subtract(py.PY_call(py.PY_getAttr(this,'toordinal')),py.PY_call(py.PY_getAttr(other,'toordinal')))]);}
return py.NotImplemented;},toordinal:function(){return py.float.fromJSON(ymd2ord(this.year,this.month,this.day));},weekday:function(){return py.float.fromJSON((this.toordinal().toJSON()+6)%7);},fromJSON:function(year,month,day){return py.PY_call(datetime.date,[year,month,day]);},today:py.classmethod.fromJSON(function(){var d=new Date();return py.PY_call(datetime.date,[d.getFullYear(),d.getMonth()+1,d.getDate()]);}),});datetime.time=py.type('time',null,{__init__:function(){var zero=py.float.fromJSON(0);var args=py.PY_parseArgs(arguments,[['hour',zero],['minute',zero],['second',zero],['microsecond',zero],['tzinfo',py.None]]);for(var k in args){if(!args.hasOwnProperty(k)){continue;}
this[k]=asJS(args[k]);}}});var time=py.PY_call(py.object);time.strftime=py.PY_def.fromJSON(function(){var args=py.PY_parseArgs(arguments,'format');var dt_class=py.PY_getAttr(datetime,'datetime');var d=py.PY_call(py.PY_getAttr(dt_class,'utcnow'));return py.PY_call(py.PY_getAttr(d,'strftime'),[args.format]);});var args=_.map(('year month day hour minute second '
+'years months weeks days hours minutes seconds '
+'weekday leapdays yearday nlyearday').split(' '),function(arg){switch(arg){case'years':case'months':case'days':case'leapdays':case'weeks':case'hours':case'minutes':case'seconds':return[arg,zero];case'year':case'month':case'day':case'weekday':case'hour':case'minute':case'second':case'yearday':case'nlyearday':return[arg,null];default:throw new Error("Unknown relativedelta argument "+arg);}});args.unshift('*');var _utils={monthrange:function(year,month){if(month<1||month>12){throw new Error("Illegal month "+month);}
var day1=this.weekday(year,month,1);var ndays=this.mdays[month]+(month==this.February&&this.isleap(year));return[day1,ndays];},weekday:function(year,month,day){var date=py.PY_call(datetime.date,[year,month,day]);return py.PY_call(py.PY_getAttr(date,'weekday'));},isleap:function(year){return year%4===0&&(year%100!==0||year%400===0);},mdays:[0,31,28,31,30,31,30,31,31,30,31,30,31],January:1,February:2};var relativedelta=py.type('relativedelta',null,{__init__:function(){this.ops=py.PY_parseArgs(arguments,args);this.ops.days=py.float.fromJSON(asJS(this.ops.days)+asJS(this.ops.weeks)*7);var yday=zero;if(this.ops.nlyearday){yday=this.ops.nlyearday;}else if(this.ops.yearday){yday=this.ops.yearday;if(asJS(this.ops.yearday)>59){this.ops.leapdays=py.float.fromJS(-1);}}
if(py.PY_isTrue(yday)){var ydayidx=[31,59,90,120,151,181,212,243,273,304,334,366];for(var idx=0;idx<ydayidx.length;++idx){var ydays=ydayidx[idx];if(asJS(yday)<=ydays){this.ops.month=py.float.fromJSON(idx+1);if(!idx){this.ops.day=yday;}else{this.ops.day=py.PY_subtract(yday,py.float.fromJSON(ydayidx[idx-1]));}
break;}}
if(idx===ydayidx.length){throw new Error("Invalid year day ("+asJS(yday)+")");}}
this._fix();},_fix:function(){var self=this;var months=asJS(this.ops.months);if(Math.abs(months)>11){var s=months>0?1:-1;divmod(months*s,12,function(years,months){self.ops.months=py.float.fromJSON(months*s);self.ops.years=py.float.fromJSON(asJS(self.ops.years)+years*s);});}
this._has_time=0;},__add__:function(other){if(!(py.PY_isInstance(other,datetime.date)||py.PY_isInstance(other,datetime.datetime))){return py.NotImplemented;}
var year=(asJS(this.ops.year)||asJS(other.year))+asJS(this.ops.years);var month=asJS(this.ops.month)||asJS(other.month);var months;if(months=asJS(this.ops.months)){if(Math.abs(months)<1||Math.abs(months)>12){throw new Error("Can only use relative months between -12 and +12");}
month+=months;if(month>12){year+=1;month-=12;}
if(month<1){year-=1;month+=12;}}
var day=Math.min(_utils.monthrange(year,month)[1],asJS(this.ops.day)||asJS(other.day));var repl={year:py.float.fromJSON(year),month:py.float.fromJSON(month),day:py.float.fromJSON(day)};if(py.PY_isInstance(other,datetime.datetime)){repl.hour=py.float.fromJSON(asJS(this.ops.hour)||asJS(other.hour));repl.minute=py.float.fromJSON(asJS(this.ops.minute)||asJS(other.minute));repl.second=py.float.fromJSON(asJS(this.ops.second)||asJS(other.second));}
var days=asJS(this.ops.days);if(py.PY_isTrue(this.ops.leapdays)&&month>2&&_utils.isleap(year)){days+=asJS(this.ops.leapdays);}
var ret=py.PY_add(py.PY_call(py.PY_getAttr(other,'replace'),repl),py.PY_call(datetime.timedelta,{days:py.float.fromJSON(days),hours:py.float.fromJSON(asJS(this.ops.hours)),minutes:py.float.fromJSON(asJS(this.ops.minutes)),seconds:py.float.fromJSON(asJS(this.ops.seconds))}));if(this.ops.weekday){var weekday=asJS(this.ops.weekday),nth=1;var jumpdays=(Math.abs(nth)-1)*7;var ret_weekday=asJS(py.PY_call(py.PY_getAttr(ret,'weekday')));if(nth>0){jumpdays+=(7-ret_weekday+weekday)%7;}else{jumpdays+=(ret_weekday-weekday)%7;jumpdays*=-1;}
ret=py.PY_add(ret,py.PY_call(datetime.timedelta,{days:py.float.fromJSON(jumpdays)}));}
return ret;},__radd__:function(other){return this.__add__(other);},__rsub__:function(other){return this.__neg__().__radd__(other);},__neg__:function(){return py.PY_call(relativedelta,{years:py.PY_negative(this.ops.years),months:py.PY_negative(this.ops.months),days:py.PY_negative(this.ops.days),leapdays:this.ops.leapdays,hours:py.PY_negative(this.ops.hours),minutes:py.PY_negative(this.ops.minutes),seconds:py.PY_negative(this.ops.seconds),year:this.ops.year,month:this.ops.month,day:this.ops.day,weekday:this.ops.weekday,hour:this.ops.hour,minute:this.ops.minute,second:this.ops.second});}});py.extras={datetime:datetime,time:time,relativedelta:relativedelta,};})(typeof exports==='undefined'?py:exports);;

/* /web/static/lib/jquery.ba-bbq/jquery.ba-bbq.js defined in bundle 'web.assets_backend' */
(function($,window){'$:nomunge';var undefined,aps=Array.prototype.slice,decode=decodeURIComponent,jq_param=$.param,jq_param_sorted,jq_param_fragment,jq_deparam,jq_deparam_fragment,jq_bbq=$.bbq=$.bbq||{},jq_bbq_pushState,jq_bbq_getState,jq_elemUrlAttr,special=$.event.special,str_hashchange='hashchange',str_querystring='querystring',str_fragment='fragment',str_elemUrlAttr='elemUrlAttr',str_href='href',str_src='src',re_params_querystring=/^.*\?|#.*$/g,re_params_fragment,re_fragment,re_no_escape,ajax_crawlable,fragment_prefix,elemUrlAttr_cache={};function is_string(arg){return typeof arg==='string';};function curry(func){var args=aps.call(arguments,1);return function(){return func.apply(this,args.concat(aps.call(arguments)));};};function get_fragment(url){return url.replace(re_fragment,'$2');};function get_querystring(url){return url.replace(/(?:^[^?#]*\?([^#]*).*$)?.*/,'$1');};function jq_param_sub(is_fragment,get_func,url,params,merge_mode){var result,qs,matches,url_params,hash;if(params!==undefined){matches=url.match(is_fragment?re_fragment:/^([^#?]*)\??([^#]*)(#?.*)/);hash=matches[3]||'';if(merge_mode===2&&is_string(params)){qs=params.replace(is_fragment?re_params_fragment:re_params_querystring,'');}else{url_params=jq_deparam(matches[2]);params=is_string(params)?jq_deparam[is_fragment?str_fragment:str_querystring](params):params;qs=merge_mode===2?params:merge_mode===1?$.extend({},params,url_params):$.extend({},url_params,params);qs=jq_param_sorted(qs);if(is_fragment){qs=qs.replace(re_no_escape,decode);}}
result=matches[1]+(is_fragment?fragment_prefix:qs||!matches[1]?'?':'')+qs+hash;}else{result=get_func(url!==undefined?url:location.href);}
return result;};jq_param[str_querystring]=curry(jq_param_sub,0,get_querystring);jq_param[str_fragment]=jq_param_fragment=curry(jq_param_sub,1,get_fragment);jq_param.sorted=jq_param_sorted=function(a,traditional){var arr=[],obj={};$.each(jq_param(a,traditional).split('&'),function(i,v){var key=v.replace(/(?:%5B|=).*$/,''),key_obj=obj[key];if(!key_obj){key_obj=obj[key]=[];arr.push(key);}
key_obj.push(v);});return $.map(arr.sort(),function(v){return obj[v];}).join('&');};jq_param_fragment.noEscape=function(chars){chars=chars||'';var arr=$.map(chars.split(''),encodeURIComponent);re_no_escape=new RegExp(arr.join('|'),'g');};jq_param_fragment.noEscape(',/');jq_param_fragment.ajaxCrawlable=function(state){if(state!==undefined){if(state){re_params_fragment=/^.*(?:#!|#)/;re_fragment=/^([^#]*)(?:#!|#)?(.*)$/;fragment_prefix='#!';}else{re_params_fragment=/^.*#/;re_fragment=/^([^#]*)#?(.*)$/;fragment_prefix='#';}
ajax_crawlable=!!state;}
return ajax_crawlable;};jq_param_fragment.ajaxCrawlable(0);$.deparam=jq_deparam=function(params,coerce){var obj={},coerce_types={'true':!0,'false':!1,'null':null};$.each(params.replace(/\+/g,' ').split('&'),function(j,v){var param=v.split('='),key=decode(param[0]),val,cur=obj,i=0,keys=key.split(']['),keys_last=keys.length-1;if(/\[/.test(keys[0])&&/\]$/.test(keys[keys_last])){keys[keys_last]=keys[keys_last].replace(/\]$/,'');keys=keys.shift().split('[').concat(keys);keys_last=keys.length-1;}else{keys_last=0;}
if(param.length===2){val=decode(param[1]);if(coerce){val=val&&!isNaN(val)?+val:val==='undefined'?undefined:coerce_types[val]!==undefined?coerce_types[val]:val;}
if(keys_last){for(;i<=keys_last;i++){key=keys[i]===''?cur.length:keys[i];if(key==="__proto__"||key==="prototype"||key==="constructor")break;cur=cur[key]=i<keys_last?cur[key]||(keys[i+1]&&isNaN(keys[i+1])?{}:[]):val;}}else{if($.isArray(obj[key])){obj[key].push(val);}else if(obj[key]!==undefined){obj[key]=[obj[key],val];}else{obj[key]=val;}}}else if(key){obj[key]=coerce?undefined:'';}});return obj;};function jq_deparam_sub(is_fragment,url_or_params,coerce){if(url_or_params===undefined||typeof url_or_params==='boolean'){coerce=url_or_params;url_or_params=jq_param[is_fragment?str_fragment:str_querystring]();}else{url_or_params=is_string(url_or_params)?url_or_params.replace(is_fragment?re_params_fragment:re_params_querystring,''):url_or_params;}
return jq_deparam(url_or_params,coerce);};jq_deparam[str_querystring]=curry(jq_deparam_sub,0);jq_deparam[str_fragment]=jq_deparam_fragment=curry(jq_deparam_sub,1);$[str_elemUrlAttr]||($[str_elemUrlAttr]=function(obj){return $.extend(elemUrlAttr_cache,obj);})({a:str_href,base:str_href,iframe:str_src,img:str_src,input:str_src,form:'action',link:str_href,script:str_src});jq_elemUrlAttr=$[str_elemUrlAttr];function jq_fn_sub(mode,force_attr,params,merge_mode){if(!is_string(params)&&typeof params!=='object'){merge_mode=params;params=force_attr;force_attr=undefined;}
return this.each(function(){var that=$(this),attr=force_attr||jq_elemUrlAttr()[(this.nodeName||'').toLowerCase()]||'',url=attr&&that.attr(attr)||'';that.attr(attr,jq_param[mode](url,params,merge_mode));});};$.fn[str_querystring]=curry(jq_fn_sub,str_querystring);$.fn[str_fragment]=curry(jq_fn_sub,str_fragment);jq_bbq.pushState=jq_bbq_pushState=function(params,merge_mode){if(is_string(params)&&/^#/.test(params)&&merge_mode===undefined){merge_mode=2;}
var has_args=params!==undefined,url=jq_param_fragment(location.href,has_args?params:{},has_args?merge_mode:2);location.href=url;};jq_bbq.getState=jq_bbq_getState=function(key,coerce){return key===undefined||typeof key==='boolean'?jq_deparam_fragment(key):jq_deparam_fragment(coerce)[key];};jq_bbq.removeState=function(arr){var state={};if(arr!==undefined){state=jq_bbq_getState();$.each($.isArray(arr)?arr:arguments,function(i,v){delete state[v];});}
jq_bbq_pushState(state,2);};special[str_hashchange]=$.extend(special[str_hashchange],{add:function(handleObj){var old_handler;function new_handler(e){var hash=e[str_fragment]=jq_param_fragment();e.getState=function(key,coerce){return key===undefined||typeof key==='boolean'?jq_deparam(hash,key):jq_deparam(hash,coerce)[key];};old_handler.apply(this,arguments);};if($.isFunction(handleObj)){old_handler=handleObj;return new_handler;}else{old_handler=handleObj.handler;handleObj.handler=new_handler;}}});})(jQuery,this);(function($,window,undefined){'$:nomunge';var str_hashchange='hashchange',doc=document,fake_onhashchange,special=$.event.special,doc_mode=doc.documentMode,supports_onhashchange='on'+str_hashchange in window&&(doc_mode===undefined||doc_mode>7);function get_fragment(url){url=url||location.href;return'#'+url.replace(/^[^#]*#?(.*)$/,'$1');};$.fn[str_hashchange]=function(fn){return fn?this.bind(str_hashchange,fn):this.trigger(str_hashchange);};$.fn[str_hashchange].delay=50;special[str_hashchange]=$.extend(special[str_hashchange],{setup:function(){if(supports_onhashchange){return false;}
$(fake_onhashchange.start);},teardown:function(){if(supports_onhashchange){return false;}
$(fake_onhashchange.stop);}});fake_onhashchange=(function(){var self={},timeout_id,last_hash=get_fragment(),fn_retval=function(val){return val;},history_set=fn_retval,history_get=fn_retval;self.start=function(){timeout_id||poll();};self.stop=function(){timeout_id&&clearTimeout(timeout_id);timeout_id=undefined;};function poll(){var hash=get_fragment(),history_hash=history_get(last_hash);if(hash!==last_hash){history_set(last_hash=hash,history_hash);$(window).trigger(str_hashchange);}else if(history_hash!==last_hash){location.href=location.href.replace(/#.*/,'')+history_hash;}
timeout_id=setTimeout(poll,$.fn[str_hashchange].delay);};$.browser.msie&&!supports_onhashchange&&(function(){var iframe,iframe_src;self.start=function(){if(!iframe){iframe_src=$.fn[str_hashchange].src;iframe_src=iframe_src&&iframe_src+get_fragment();iframe=$('<iframe tabindex="-1" title="empty"/>').hide().one('load',function(){iframe_src||history_set(get_fragment());poll();}).attr('src',iframe_src||'javascript:0').insertAfter('body')[0].contentWindow;doc.onpropertychange=function(){try{if(event.propertyName==='title'){iframe.document.title=doc.title;}}catch(e){}};}};self.stop=fn_retval;history_get=function(){return get_fragment(iframe.location.href);};history_set=function(hash,history_hash){var iframe_doc=iframe.document,domain=$.fn[str_hashchange].domain;if(hash!==history_hash){iframe_doc.title=doc.title;iframe_doc.open();domain&&iframe_doc.write('<script>document.domain="'+domain+'"</script>');iframe_doc.close();iframe.location.hash=hash;}};})();return self;})();})(jQuery,this);;

/* /web/static/src/js/core/domain.js defined in bundle 'web.assets_backend' */
odoo.define("web.Domain",function(require){"use strict";var collections=require("web.collections");var pyUtils=require("web.py_utils");var py=window.py;var Domain=collections.Tree.extend({init:function(domain,evalContext){this._super.apply(this,arguments);if(_.isArray(domain)||_.isString(domain)){this._parse(this.normalizeArray(_.clone(this.stringToArray(domain,evalContext))));}else{this._data=!!domain;}},compute:function(values){if(this._data===true||this._data===false){return this._data;}else if(_.isArray(this._data)){var isParentField=false;var fieldName=this._data[0];var parentField=this._data[0].split('.');if('parent'in values&&parentField.length===2){fieldName=parentField[1];isParentField=parentField[0]==='parent'&&fieldName in values.parent;}
if(!(this._data[0]in values)&&!(isParentField)){throw new Error(_.str.sprintf("Unknown field %s in domain",this._data[0]));}
var fieldValue;if(!isParentField){fieldValue=values[fieldName];}else{fieldValue=values.parent[fieldName];}
switch(this._data[1]){case"=":case"==":return _.isEqual(fieldValue,this._data[2]);case"!=":case"<>":return!_.isEqual(fieldValue,this._data[2]);case"<":return(fieldValue<this._data[2]);case">":return(fieldValue>this._data[2]);case"<=":return(fieldValue<=this._data[2]);case">=":return(fieldValue>=this._data[2]);case"in":return _.intersection(_.isArray(this._data[2])?this._data[2]:[this._data[2]],_.isArray(fieldValue)?fieldValue:[fieldValue],).length!==0;;case"not in":return _.intersection(_.isArray(this._data[2])?this._data[2]:[this._data[2]],_.isArray(fieldValue)?fieldValue:[fieldValue],).length===0;case"like":return(fieldValue.toLowerCase().indexOf(this._data[2].toLowerCase())>=0);case"=like":var regExp=new RegExp(this._data[2].toLowerCase().replace(/([.\[\]\{\}\+\*])/g,'\\\$1').replace(/%/g,'.*'));return regExp.test(fieldValue.toLowerCase());case"ilike":return(fieldValue.indexOf(this._data[2])>=0);case"=ilike":return new RegExp(this._data[2].replace(/%/g,'.*'),'i').test(fieldValue);default:throw new Error(_.str.sprintf("Domain %s uses an unsupported operator",this._data));}}else{switch(this._data){case"&":return _.every(this._children,function(child){return child.compute(values);});case"|":return _.some(this._children,function(child){return child.compute(values);});case"!":return!this._children[0].compute(values);}}},toArray:function(){if(this._data===false){throw new Error("'false' domain cannot be converted to array");}else if(this._data===true){return[];}else{var arr=[this._data];return arr.concat.apply(arr,_.map(this._children,function(child){return child.toArray();}));}},toString:function(){return Domain.prototype.arrayToString(this.toArray());},_parse:function(domain){this._data=(domain.length===0?true:domain[0]);if(domain.length<=1)return;var expected=1;for(var i=1;i<domain.length;i++){if(domain[i]==="&"||domain[i]==="|"){expected++;}else if(domain[i]!=="!"){expected--;}
if(!expected){i++;this._addSubdomain(domain.slice(1,i));this._addSubdomain(domain.slice(i));break;}}},_addSubdomain:function(domain){if(!domain.length)return;var subdomain=new Domain(domain);if(!subdomain._children.length||subdomain._data!==this._data){this._children.push(subdomain);}else{var self=this;_.each(subdomain._children,function(childDomain){self._children.push(childDomain);});}},arrayToString:function(domain){if(_.isString(domain))return domain;const parts=(domain||[]).map(part=>{if(_.isArray(part)){return"["+part.map(c=>{switch(c){case null:return"None";case true:return"True";case false:return"False";default:return JSON.stringify(c);}}).join(',')+"]";}else{return JSON.stringify(part);}});return"["+parts.join(',')+"]";},constructDomain:function(fieldName,period,type,comparisonPeriod){var leftBoundaryParams,rightBoundaryParams;var offsetPeriodParams;function makeInterval(){switch(comparisonPeriod){case'previous_period':_.each(offsetPeriodParams,function(value,key){if(!leftBoundaryParams[key]||_.isNumber(leftBoundaryParams[key])){leftBoundaryParams[key]=value+(leftBoundaryParams[key]||0);}else{leftBoundaryParams[key]=value+' + '+leftBoundaryParams[key];}
if(!rightBoundaryParams[key]||_.isNumber(rightBoundaryParams[key])){rightBoundaryParams[key]=value+(rightBoundaryParams[key]||0);}else{rightBoundaryParams[key]=value+' + '+rightBoundaryParams[key];}});break;case'previous_year':leftBoundaryParams.years=leftBoundaryParams.years?leftBoundaryParams.years-1:-1;rightBoundaryParams.years=rightBoundaryParams.years?rightBoundaryParams.years-1:-1;break;}
var stringifyParams=function(value,key){return key+'='+value;};var leftBoundaryStringifyParams=_.map(leftBoundaryParams,stringifyParams).join(', ');var rightBoundaryStringifyParams=_.map(rightBoundaryParams,stringifyParams).join(', ');if(type==='date'){return"['&',"+"('"+fieldName+"', '>=', (context_today() + relativedelta("+leftBoundaryStringifyParams+")).strftime('%Y-%m-%d')),"+"('"+fieldName+"', '<', (context_today() + relativedelta("+rightBoundaryStringifyParams+")).strftime('%Y-%m-%d'))"+"]";}
else{return"['&',"+"('"+fieldName+"', '>=', "+"(datetime.datetime.combine(context_today() + relativedelta("+leftBoundaryStringifyParams+"), datetime.time(0,0,0)).to_utc()).strftime('%Y-%m-%d %H:%M:%S')),"+"('"+fieldName+"', '<', "+"(datetime.datetime.combine(context_today() + relativedelta("+rightBoundaryStringifyParams+"), datetime.time(0,0,0)).to_utc()).strftime('%Y-%m-%d %H:%M:%S'))"+"]";}}
switch(period){case'today':leftBoundaryParams={};rightBoundaryParams={days:1};offsetPeriodParams={days:-1};return makeInterval();case'this_week':leftBoundaryParams={weeks:-1,days:1,weekday:0};rightBoundaryParams={days:1,weekday:0};offsetPeriodParams={weeks:-1};return makeInterval();case'this_month':leftBoundaryParams={day:1};rightBoundaryParams={day:1,months:1};offsetPeriodParams={months:-1};return makeInterval();case'this_quarter':leftBoundaryParams={months:'- (context_today().month - 1) % 3',day:1};rightBoundaryParams={months:'3 - (context_today().month - 1) % 3',day:1};offsetPeriodParams={months:-3};return makeInterval();case'this_year':leftBoundaryParams={month:1,day:1};rightBoundaryParams={month:1,day:1,years:1};offsetPeriodParams={years:-1};return makeInterval();case'yesterday':leftBoundaryParams={days:-1};rightBoundaryParams={};offsetPeriodParams={days:-1};return makeInterval();case'last_week':leftBoundaryParams={weeks:-2,days:1,weekday:0};rightBoundaryParams={weeks:-1,days:1,weekday:0};offsetPeriodParams={weeks:-1};return makeInterval();case'last_month':leftBoundaryParams={months:-1,day:1};rightBoundaryParams={day:1};offsetPeriodParams={months:-1};return makeInterval();case'last_quarter':leftBoundaryParams={months:'- 3 - (context_today().month - 1) % 3',day:1};rightBoundaryParams={months:'- (context_today().month - 1) % 3',day:1};offsetPeriodParams={months:-3};return makeInterval();case'last_year':leftBoundaryParams={month:1,day:1,years:-1};rightBoundaryParams={month:1,day:1};offsetPeriodParams={years:-1};return makeInterval();case'last_7_days':leftBoundaryParams={days:-7};rightBoundaryParams={};offsetPeriodParams={days:-7};return makeInterval();case'last_30_days':leftBoundaryParams={days:-30};rightBoundaryParams={};offsetPeriodParams={days:-30};return makeInterval();case'last_365_days':leftBoundaryParams={days:-365};rightBoundaryParams={};offsetPeriodParams={days:-365};return makeInterval();case'last_5_years':leftBoundaryParams={years:-5};rightBoundaryParams={};offsetPeriodParams={years:-5};return makeInterval();}},stringToArray:function(domain,evalContext){if(!_.isString(domain))return _.clone(domain);return pyUtils.eval("domain",domain?domain.replace(/%%/g,'%'):"[]",evalContext);},normalizeArray:function(domain){var expected=1;_.each(domain,function(item){if(item==="&"||item==="|"){expected++;}else if(item!=="!"){expected--;}});if(expected<0){domain.unshift.apply(domain,_.times(Math.abs(expected),_.constant("&")));}
return domain;},domainToCondition:function(domain){if(!domain.length){return'True';}
var self=this;function consume(stack){var len=stack.length;if(len<=1){return stack;}else if(stack[len-1]==='|'||stack[len-1]==='&'||stack[len-2]==='|'||stack[len-2]==='&'){return stack;}else if(len==2){stack.splice(-2,2,stack[len-2]+' and '+stack[len-1]);}else if(stack[len-3]=='|'){if(len===3){stack.splice(-3,3,stack[len-2]+' or '+stack[len-1]);}else{stack.splice(-3,3,'('+stack[len-2]+' or '+stack[len-1]+')');}}else{stack.splice(-3,3,stack[len-2]+' and '+stack[len-1]);}
consume(stack);}
var stack=[];_.each(domain,function(dom){if(dom==='|'||dom==='&'){stack.push(dom);}else{var operator=dom[1]==='='?'==':dom[1];if(!operator){throw new Error('Wrong operator for this domain');}
if(operator==='!='&&dom[2]===false){stack.push(dom[0]);}else if(dom[2]===null||dom[2]===true||dom[2]===false){stack.push(dom[0]+' '+(operator==='!='?'is not ':'is ')+(dom[2]===null?'None':(dom[2]?'True':'False')));}else{stack.push(dom[0]+' '+operator+' '+JSON.stringify(dom[2]));}
consume(stack);}});if(stack.length!==1){throw new Error('Wrong domain');}
return stack[0];},conditionToDomain:function(condition){if(!condition||condition.match(/^\s*(True)?\s*$/)){return[];}
var ast=py.parse(py.tokenize(condition));function astToStackValue(node){switch(node.id){case'(name)':return node.value;case'.':return astToStackValue(node.first)+'.'+astToStackValue(node.second);case'(string)':return node.value;case'(number)':return node.value;case'(constant)':return node.value==='None'?null:node.value==='True'?true:false;case'[':return _.map(node.first,function(node){return astToStackValue(node);});}}
function astToStack(node){switch(node.id){case'(name)':return[[astToStackValue(node),'!=',false]];case'.':return[[astToStackValue(node.first)+'.'+astToStackValue(node.second),'!=',false]];case'not':return[[astToStackValue(node.first),'=',false]];case'or':return['|'].concat(astToStack(node.first)).concat(astToStack(node.second));case'and':return['&'].concat(astToStack(node.first)).concat(astToStack(node.second));case'(comparator)':if(node.operators.length!==1){throw new Error('Wrong condition to convert in domain');}
var right=astToStackValue(node.expressions[0]);var left=astToStackValue(node.expressions[1]);var operator=node.operators[0];switch(operator){case'is':operator='=';break;case'is not':operator='!=';break;case'==':operator='=';break;}
return[[right,operator,left]];default:throw"Condition cannot be transformed into domain";}}
return astToStack(ast);},});return Domain;});;

/* /web/static/src/js/core/mvc.js defined in bundle 'web.assets_backend' */
odoo.define('web.mvc',function(require){"use strict";var ajax=require('web.ajax');var Class=require('web.Class');var mixins=require('web.mixins');var ServicesMixin=require('web.ServicesMixin');var Widget=require('web.Widget');var Model=Class.extend(mixins.EventDispatcherMixin,ServicesMixin,{init:function(parent,params){mixins.EventDispatcherMixin.init.call(this);this.setParent(parent);},get:function(){},load:function(){return Promise.resolve();},});var Renderer=Widget.extend({init:function(parent,state,params){this._super(parent);this.state=state;},});var Controller=Widget.extend({init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.model=model;this.renderer=renderer;},start:function(){return Promise.all([this._super.apply(this,arguments),this._startRenderer()]);},_startRenderer:function(){return this.renderer.appendTo(this.$el);},});var Factory=Class.extend({config:{Model:Model,Renderer:Renderer,Controller:Controller,},init:function(){this.rendererParams={};this.controllerParams={};this.modelParams={};this.loadParams={};},getController:function(parent){var self=this;var model=this.getModel(parent);return Promise.all([this._loadData(model),ajax.loadLibs(this)]).then(function(result){var state=result[0];var renderer=self.getRenderer(parent,state);var Controller=self.Controller||self.config.Controller;var controllerParams=_.extend({initialState:state,},self.controllerParams);var controller=new Controller(parent,model,renderer,controllerParams);model.setParent(controller);renderer.setParent(controller);return controller;});},getModel:function(parent){var Model=this.config.Model;return new Model(parent,this.modelParams);},getRenderer:function(parent,state){var Renderer=this.config.Renderer;return new Renderer(parent,state,this.rendererParams);},_loadData:function(model){return model.load(this.loadParams).then(function(){return model.get.apply(model,arguments);});},});return{Factory:Factory,Model:Model,Renderer:Renderer,Controller:Controller,};});;

/* /web/static/src/js/core/py_utils.js defined in bundle 'web.assets_backend' */
odoo.define('web.py_utils',function(require){"use strict";var core=require('web.core');var _t=core._t;var py=window.py;function wrap(value){if(value===null){return py.None;}
switch(typeof value){case'undefined':throw new Error("No conversion for undefined");case'boolean':return py.bool.fromJSON(value);case'number':return py.float.fromJSON(value);case'string':return py.str.fromJSON(value);}
switch(value.constructor){case Object:return wrapping_dict.fromJSON(value);case Array:return wrapping_list.fromJSON(value);}
throw new Error("ValueError: unable to wrap "+value);}
var wrapping_dict=py.type('wrapping_dict',null,{__init__:function(){this._store={};},__getitem__:function(key){var k=key.toJSON();if(!(k in this._store)){throw new Error("KeyError: '"+k+"'");}
return wrap(this._store[k]);},__getattr__:function(key){return this.__getitem__(py.str.fromJSON(key));},__len__:function(){return Object.keys(this._store).length;},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},get:function(){var args=py.PY_parseArgs(arguments,['k',['d',py.None]]);if(!(args.k.toJSON()in this._store)){return args.d;}
return this.__getitem__(args.k);},fromJSON:function(d){var instance=py.PY_call(wrapping_dict);instance._store=d;return instance;},toJSON:function(){return this._store;},});var wrapping_list=py.type('wrapping_list',null,{__init__:function(){this._store=[];},__getitem__:function(index){return wrap(this._store[index.toJSON()]);},__len__:function(){return this._store.length;},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},fromJSON:function(ar){var instance=py.PY_call(wrapping_list);instance._store=ar;return instance;},toJSON:function(){return this._store;},});function wrap_context(context){for(var k in context){if(!context.hasOwnProperty(k)){continue;}
var val=context[k];if(val===null){continue;}
if(val.constructor===Array){context[k]=wrapping_list.fromJSON(val);}else if(val.constructor===Object&&!py.PY_isInstance(val,py.object)){context[k]=wrapping_dict.fromJSON(val);}}
return context;}
function eval_contexts(contexts,evaluation_context){evaluation_context=_.extend(pycontext(),evaluation_context||{});return _(contexts).reduce(function(result_context,ctx){if(_.isEmpty(ctx)){return result_context;}
if(_.isString(ctx)){ctx={__ref:'context',__debug:ctx};}
var evaluated=ctx;switch(ctx.__ref){case'context':evaluation_context.context=evaluation_context;evaluated=py.eval(ctx.__debug,wrap_context(evaluation_context));break;case'compound_context':var eval_context=eval_contexts([ctx.__eval_context]);evaluated=eval_contexts(ctx.__contexts,_.extend({},evaluation_context,eval_context));break;}
_.extend(evaluation_context,evaluated);return _.extend(result_context,evaluated);},{});}
function eval_domains(domains,evaluation_context){evaluation_context=_.extend(pycontext(),evaluation_context||{});var result_domain=[];var need_normalization=(domains&&domains.length>0&&domains[0].length===1&&(domains[0][0]==="|"||domains[0][0]==="!"));_(domains).each(function(domain){if(_.isString(domain)){domain={__ref:'domain',__debug:domain};}
var domain_array_to_combine;switch(domain.__ref){case'domain':evaluation_context.context=evaluation_context;domain_array_to_combine=py.eval(domain.__debug,wrap_context(evaluation_context));break;default:domain_array_to_combine=domain;}
if(need_normalization){domain_array_to_combine=get_normalized_domain(domain_array_to_combine);}
result_domain.push.apply(result_domain,domain_array_to_combine);});return result_domain;}
function get_normalized_domain(domain_array){var expected=1;_.each(domain_array,function(item){if(item==="&"||item==="|"){expected++;}else if(item!=="!"){expected--;}});var new_explicit_ands=_.times(-expected,_.constant("&"));return new_explicit_ands.concat(domain_array);}
function eval_groupbys(contexts,evaluation_context){evaluation_context=_.extend(pycontext(),evaluation_context||{});var result_group=[];_(contexts).each(function(ctx){if(_.isString(ctx)){ctx={__ref:'context',__debug:ctx};}
var group;var evaluated=ctx;switch(ctx.__ref){case'context':evaluation_context.context=evaluation_context;evaluated=py.eval(ctx.__debug,wrap_context(evaluation_context));break;case'compound_context':var eval_context=eval_contexts([ctx.__eval_context]);evaluated=eval_contexts(ctx.__contexts,_.extend({},evaluation_context,eval_context));break;}
group=evaluated.group_by;if(!group){return;}
if(typeof group==='string'){result_group.push(group);}else if(group instanceof Array){result_group.push.apply(result_group,group);}else{throw new Error('Got invalid groupby {{'
+JSON.stringify(group)+'}}');}
_.extend(evaluation_context,evaluated);});return result_group;}
function context_today(){var d=new Date();return py.PY_call(py.extras.datetime.date,[d.getFullYear(),d.getMonth()+1,d.getDate()]);}
function tz_offset(){var offset=new Date().getTimezoneOffset();var kwargs={minutes:py.float.fromJSON(offset)};return py.PY_call(py.extras.datetime.timedelta,[],kwargs);}
function pycontext(){return{datetime:py.extras.datetime,context_today:context_today,time:py.extras.time,relativedelta:py.extras.relativedelta,current_date:py.PY_call(py.extras.time.strftime,[py.str.fromJSON('%Y-%m-%d')]),tz_offset:tz_offset,};}
function pyeval(type,object,context){context=_.extend(pycontext(),context||{});switch(type){case'context':case'contexts':if(type==='context'){object=[object];}
return eval_contexts(object,context);case'domain':case'domains':if(type==='domain')
object=[object];return eval_domains(object,context);case'groupbys':return eval_groupbys(object,context);}
throw new Error("Unknow evaluation type "+type);}
function eval_arg(arg){if(typeof arg!=='object'||!arg.__ref){return arg;}
switch(arg.__ref){case'domain':return pyeval('domains',[arg]);case'context':case'compound_context':return pyeval('contexts',[arg]);default:throw new Error(_t("Unknown nonliteral type ")+' '+arg.__ref);}}
function ensure_evaluated(args,kwargs){for(var i=0;i<args.length;++i){args[i]=eval_arg(args[i]);}
for(var k in kwargs){if(!kwargs.hasOwnProperty(k)){continue;}
kwargs[k]=eval_arg(kwargs[k]);}}
function eval_domains_and_contexts(source){return{context:pyeval('contexts',source.contexts||[],source.eval_context),domain:pyeval('domains',source.domains,source.eval_context),group_by:pyeval('groupbys',source.group_by_seq||[],source.eval_context),};}
function py_eval(expr,context){return py.eval(expr,_.extend({},context||{},{"true":true,"false":false,"null":null}));}
function assembleDomains(domains,operator){var ASTs=domains.map(_getPyJSAST);if(operator==="OR"){operator=py.tokenize("'|'")[0];}else{operator=py.tokenize("'&'")[0];}
var result=_getPyJSAST("[]");var normalizedDomains=ASTs.filter(function(AST){return AST.first.length>0;}).map(_normalizeDomainAST);if(normalizedDomains.length>0){result.first=normalizedDomains.reduce(function(acc,ast){return acc.concat(ast.first);},_.times(normalizedDomains.length-1,_.constant(operator)));}
return _formatAST(result);}
function normalizeDomain(domain){return _formatAST(_normalizeDomainAST(_getPyJSAST(domain)));}
var BINDING_POWERS={or:30,and:40,not:50,};function _formatAST(ast,lbp){lbp=lbp||0;switch(ast.id){case"(number)":return String(ast.value);case"(string)":return JSON.stringify(ast.value.replace(/(\\(['"\\]))/g,"\$2"));case"(constant)":return ast.value;case"(name)":return ast.value;case"[":if(ast.second){return _formatAST(ast.first)+'['+_formatAST(ast.second)+']';}else{var values=ast.first.map(_formatAST);return'['+values.join(', ')+']';}
case"{":var keyValues=ast.first.map(function(kv){return _formatAST(kv[0])+': '+_formatAST(kv[1]);});return'{'+keyValues.join(', ')+'}';case"=":return _formatAST(ast.first)+' '+ast.id+' '+_formatAST(ast.second);case"-":case"+":case"~":case"*":case"**":case"%":case"//":case"and":case"or":if(ast.second){var r=_formatAST(ast.first,ast.lbp)+' '+ast.id+' '+_formatAST(ast.second,ast.lbp);if(ast.lbp<lbp){r='('+r+')';}
return r;}
var actualBP=BINDING_POWERS[ast.id]||130;return ast.id+_formatAST(ast.first,actualBP);case".":return _formatAST(ast.first,ast.lbp)+'.'+_formatAST(ast.second);case"not":return"not "+_formatAST(ast.first);case"(comparator)":var operator=ast.operators[0];return _formatAST(ast.expressions[0])+' '+operator+' '+_formatAST(ast.expressions[1]);case"(":if(ast.second){return _formatAST(ast.first)+'('+ast.second.map(_formatAST).join(', ')+')';}else{return'('+ast.first.map(_formatAST).join(', ')+')';}}
throw new Error("Unimplemented python construct");}
function _getPyJSAST(domain){return py.parse(py.tokenize(domain));}
function _normalizeDomainAST(domain){var expected=1;for(var i=0;i<domain.first.length;i++){var value=domain.first[i].value;if(value==='&'||value==='|'){expected++;}else if(value!=='!'){expected--;}}
var andOperator=py.tokenize("'&'")[0];if(expected<0){domain.first.unshift.apply(domain.first,_.times(Math.abs(expected),_.constant(andOperator)));}
return domain;}
return{context:pycontext,ensure_evaluated:ensure_evaluated,eval:pyeval,eval_domains_and_contexts:eval_domains_and_contexts,py_eval:py_eval,normalizeDomain:normalizeDomain,assembleDomains:assembleDomains,_getPyJSAST:_getPyJSAST,_formatAST:_formatAST,_normalizeDomainAST:_normalizeDomainAST,};});;

/* /web/static/src/js/chrome/abstract_action.js defined in bundle 'web.assets_backend' */
odoo.define('web.AbstractAction',function(require){"use strict";var ActionMixin=require('web.ActionMixin');var ControlPanelView=require('web.ControlPanelView');var Widget=require('web.Widget');var AbstractAction=Widget.extend(ActionMixin,{config:{ControlPanelView:ControlPanelView,},hasControlPanel:false,loadControlPanel:false,withSearchBar:false,searchMenuTypes:[],init:function(parent,action,options){this._super(parent);this._title=action.display_name||action.name;this.controlPanelParams={actionId:action.id,context:action.context,breadcrumbs:options&&options.breadcrumbs||[],title:this.getTitle(),viewId:action.search_view_id&&action.search_view_id[0],withSearchBar:this.withSearchBar,searchMenuTypes:this.searchMenuTypes,};},willStart:function(){var self=this;var proms=[this._super.apply(this,arguments)];if(this.hasControlPanel){var params=this.controlPanelParams;if(this.loadControlPanel){proms.push(this.loadFieldView(params.modelName,params.context||{},params.viewId,'search').then(function(fieldsView){params.viewInfo={arch:fieldsView.arch,fields:fieldsView.fields,};}));}
return Promise.all(proms).then(function(){var controlPanelView=new self.config.ControlPanelView(params);return controlPanelView.getController(self).then(function(controlPanel){self._controlPanel=controlPanel;return self._controlPanel.appendTo(document.createDocumentFragment());});});}
return Promise.all(proms);},start:function(){if(this._controlPanel){this._controlPanel.$el.prependTo(this.$el);}
return this._super.apply(this,arguments);},});return AbstractAction;});;

/* /web/static/src/js/chrome/action_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.ActionManager',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var concurrency=require('web.concurrency');var Context=require('web.Context');var core=require('web.core');var Dialog=require('web.Dialog');var dom=require('web.dom');var framework=require('web.framework');var pyUtils=require('web.py_utils');var Widget=require('web.Widget');var _t=core._t;var ActionManager=Widget.extend({className:'o_action_manager',custom_events:{breadcrumb_clicked:'_onBreadcrumbClicked',history_back:'_onHistoryBack',push_state:'_onPushState',redirect:'_onRedirect',},init:function(parent,userContext){this._super.apply(this,arguments);this.userContext=userContext||{};this.dp=new concurrency.DropPrevious();this.actions={};this.controllers={};this.controllerStack=[];this.currentDialogController=null;},on_attach_callback:function(){this.isInDOM=true;var currentController=this.getCurrentController();if(currentController){currentController.widget.on_attach_callback();}},on_detach_callback:function(){this.isInDOM=false;var currentController=this.getCurrentController();if(currentController){currentController.widget.on_detach_callback();}},clearUncommittedChanges:function(){var currentController=this.getCurrentController();if(currentController){return currentController.widget.canBeRemoved();}
return Promise.resolve();},doAction:function(action,options){var self=this;options=_.defaults({},options,{additional_context:{},clear_breadcrumbs:false,on_close:function(){},on_reverse_breadcrumb:function(){},pushState:true,replace_last_action:false,});var def;if(_.isString(action)&&core.action_registry.contains(action)){action={type:'ir.actions.client',tag:action};}else if(_.isNumber(action)||_.isString(action)){def=this._loadAction(action,{active_id:options.additional_context.active_id,active_ids:options.additional_context.active_ids,active_model:options.additional_context.active_model,}).then(function(result){action=result;});}
return this.dp.add(Promise.resolve(def)).then(function(){options.clear_breadcrumbs=action.target==='main'||options.clear_breadcrumbs;self._preprocessAction(action,options);return self._handleAction(action,options).then(function(){action.pushState=true;return action;});});},do_push_state:function(state){this.trigger_up('push_state',{state:state});},getCurrentAction:function(){var controller=this.getCurrentController();return controller?this.actions[controller.actionID]:null;},getCurrentController:function(){var currentControllerID=_.last(this.controllerStack);return currentControllerID?this.controllers[currentControllerID]:null;},loadState:function(state){var action;if(!state.action){return Promise.resolve();}
if(_.isString(state.action)&&core.action_registry.contains(state.action)){action={params:state,tag:state.action,type:'ir.actions.client',};}else{action=state.action;}
return this.doAction(action,{clear_breadcrumbs:true,pushState:false,});},_appendController:function(controller){dom.append(this.$el,controller.widget.$el,{in_DOM:this.isInDOM,callbacks:[{widget:controller.widget}],});if(controller.scrollPosition){this.trigger_up('scrollTo',controller.scrollPosition);}},_closeDialog:function(options){if(this.currentDialogController){this.currentDialogController.dialog.destroy(options);}},_detachCurrentController:function(){var currentController=this.getCurrentController();if(currentController){currentController.scrollPosition=this._getScrollPosition();dom.detach([{widget:currentController.widget}]);}},_executeAction:function(action,options){var self=this;this.actions[action.jsID]=action;if(action.target==='new'){return this._executeActionInDialog(action,options);}
var controller=self.controllers[action.controllerID];return this.clearUncommittedChanges().then(function(){return self.dp.add(self._startController(controller));}).then(function(){if(self.currentDialogController){self._closeDialog({silent:true});}
if(options.on_reverse_breadcrumb){var currentAction=self.getCurrentAction();if(currentAction){currentAction.on_reverse_breadcrumb=options.on_reverse_breadcrumb;}}
self._pushController(controller);self.call('session_storage','setItem','current_action',action._originalAction);return action;}).guardedCatch(function(){self._removeAction(action.jsID);});},_executeActionInDialog:function(action,options){var self=this;var controller=this.controllers[action.controllerID];var widget=controller.widget;return this._startController(controller).then(function(controller){var prevDialogOnClose;if(self.currentDialogController){prevDialogOnClose=self.currentDialogController.onClose;self._closeDialog({silent:true});}
controller.onClose=prevDialogOnClose||options.on_close;var dialog=new Dialog(self,_.defaults({},options,{buttons:[],dialogClass:controller.className,title:action.name,size:action.context.dialog_size,}));dialog.on('closed',self,function(options){options=options||{};self._removeAction(action.jsID);self.currentDialogController=null;if(options.silent!==true){controller.onClose(options.infos);}});controller.dialog=dialog;return dialog.open().opened(function(){self.currentDialogController=controller;dom.append(dialog.$el,widget.$el,{in_DOM:true,callbacks:[{widget:dialog},{widget:controller.widget}],});widget.renderButtons(dialog.$footer);dialog.rebindButtonBehavior();return action;});}).guardedCatch(function(){self._removeAction(action.jsID);});},_executeClientAction:function(action,options){var self=this;var ClientAction=core.action_registry.get(action.tag);if(!ClientAction){console.error("Could not find client action "+action.tag,action);return Promise.reject();}
if(!(ClientAction.prototype instanceof Widget)){var next=ClientAction(this,action);if(next){return this.doAction(next,options);}
return Promise.resolve();}
if(!(ClientAction.prototype instanceof AbstractAction)){console.warn('The client action '+action.tag+' should be an instance of AbstractAction!');}
var controllerID=_.uniqueId('controller_');var index=this._getControllerStackIndex(options);options.breadcrumbs=this._getBreadcrumbs(this.controllerStack.slice(0,index));options.controllerID=controllerID;var widget=new ClientAction(this,action,options);var controller={actionID:action.jsID,index:index,jsID:controllerID,title:widget.getTitle(),widget:widget,};this.controllers[controllerID]=controller;action.controllerID=controllerID;var prom=this._executeAction(action,options);prom.then(function(){self._pushState(controllerID,{});});return prom;},_executeCloseAction:function(action,options){var result;if(!this.currentDialogController){result=options.on_close(action.infos);}
this._closeDialog({infos:action.infos});if(action.effect){this.trigger_up('show_effect',action.effect);}
return Promise.resolve(result);},_executeServerAction:function(action,options){var self=this;var runDef=this._rpc({route:'/web/action/run',params:{action_id:action.id,context:action.context||{},},});return this.dp.add(runDef).then(function(action){action=action||{type:'ir.actions.act_window_close'};return self.doAction(action,options);});},_executeURLAction:function(action,options){var url=action.url;if(action.target==='self'){framework.redirect(url);return Promise.resolve();}else{var w=window.open(url,'_blank');if(!w||w.closed||typeof w.closed==='undefined'){var message=_t('A popup window has been blocked. You '+'may need to change your browser settings to allow '+'popup windows for this page.');this.do_warn(_t('Warning'),message,true);}}
options.on_close();return Promise.resolve();},_getBreadcrumbs:function(controllerStack){var self=this;return _.map(controllerStack,function(controllerID){return{controllerID:controllerID,title:self.controllers[controllerID].title,};});},_getControllerStackIndex:function(options){var index;if('index'in options){index=options.index;}else if(options.clear_breadcrumbs){index=0;}else if(options.replace_last_action){index=this.controllerStack.length-1;}else{index=this.controllerStack.length;}
return index;},_getControllerState:function(controllerID){var controller=this.controllers[controllerID];var action=this.actions[controller.actionID];var state={title:controller.widget.getTitle(),};if(action.id){state.action=action.id;}else if(action.type==='ir.actions.client'){state.action=action.tag;var params=_.pick(action.params,function(v){return _.isString(v)||_.isNumber(v);});state=_.extend(params||{},state);}
if(action.context){var active_id=action.context.active_id;if(active_id){state.active_id=active_id;}
var active_ids=action.context.active_ids;if(active_ids&&!(active_ids.length===1&&active_ids[0]===active_id)){state.active_ids=action.context.active_ids.join(',');}}
return state;},_getScrollPosition:function(){var scrollPosition;this.trigger_up('getScrollPosition',{callback:function(_scrollPosition){scrollPosition=_scrollPosition;}});return scrollPosition;},_handleAction:function(action,options){if(!action.type){console.error("No type for action",action);return Promise.reject();}
switch(action.type){case'ir.actions.act_url':return this._executeURLAction(action,options);case'ir.actions.act_window_close':return this._executeCloseAction(action,options);case'ir.actions.client':return this._executeClientAction(action,options);case'ir.actions.server':return this._executeServerAction(action,options);default:console.error("The ActionManager can't handle actions of type "+
action.type,action);return Promise.reject();}},_pushController:function(controller){var self=this;this._detachCurrentController();var toDestroy=this.controllerStack.slice(controller.index);toDestroy=_.reject(toDestroy,function(controllerID){return controllerID===controller.jsID||self.controllers[controllerID].actionID===controller.actionID;});this._removeControllers(toDestroy);this.controllerStack=this.controllerStack.slice(0,controller.index);this.controllerStack.push(controller.jsID);this._appendController(controller);this.trigger_up('current_action_updated',{action:this.getCurrentAction(),controller:controller,});core.bus.trigger('close_dialogs');this._toggleFullscreen();},_pushState:function(controllerID,state){var controller=this.controllers[controllerID];if(controller){var action=this.actions[controller.actionID];if(action.target==='new'){return;}
if(action.pushState===false){this.trigger_up('set_title_part',{part:"action",title:controller.widget.getTitle()});return;}
state=_.extend({},state,this._getControllerState(controller.jsID));this.trigger_up('push_state',{state:state});}},_loadAction:function(actionID,context){var self=this;return new Promise(function(resolve,reject){self.trigger_up('load_action',{actionID:actionID,context:context,on_success:resolve,});});},_preprocessAction:function(action,options){var context=new Context(this.userContext,options.additional_context,action.context);action.context=pyUtils.eval('context',context);if(action.domain){action.domain=pyUtils.eval('domain',action.domain,action.context);}
action._originalAction=JSON.stringify(action);action.jsID=_.uniqueId('action_');action.pushState=options.pushState;},_removeAction:function(actionID){var action=this.actions[actionID];var controller=this.controllers[action.controllerID];delete this.actions[action.jsID];delete this.controllers[action.controllerID];controller.widget.destroy();},_removeControllers:function(controllerIDs){var self=this;var actionsToRemove=_.map(controllerIDs,function(controllerID){return self.controllers[controllerID].actionID;});_.each(_.uniq(actionsToRemove),this._removeAction.bind(this));},_restoreController:function(controllerID){var self=this;var controller=this.controllers[controllerID];var action=this.actions[controller.actionID];var def;if(action.on_reverse_breadcrumb){def=action.on_reverse_breadcrumb();}
return Promise.resolve(def).then(function(){return Promise.resolve(controller.widget.do_show()).then(function(){var index=_.indexOf(self.controllerStack,controllerID);self._pushController(controller,index);});});},_startController:function(controller){var fragment=document.createDocumentFragment();return controller.widget.appendTo(fragment).then(function(){return controller;});},_toggleFullscreen:function(){var self=this;var fullscreen=_.some(this.controllerStack,function(controllerID){var controller=self.controllers[controllerID];return self.actions[controller.actionID].target==='fullscreen';});this.trigger_up('toggle_fullscreen',{fullscreen:fullscreen});},_onBreadcrumbClicked:function(ev){ev.stopPropagation();this._restoreController(ev.data.controllerID);},_onHistoryBack:function(){if(this.currentDialogController){this._closeDialog();}else{var length=this.controllerStack.length;if(length>1){this._restoreController(this.controllerStack[length-2]);}}},_onPushState:function(ev){if(ev.target!==this){ev.stopPropagation();this._pushState(ev.data.controllerID,ev.data.state);}},_onRedirect:function(ev){this.do_action({type:'ir.actions.act_window',view_mode:'form',res_model:ev.data.res_model,views:[[false,'form']],res_id:ev.data.res_id,});},});return ActionManager;});;

/* /web/static/src/js/chrome/action_manager_act_window.js defined in bundle 'web.assets_backend' */
odoo.define('web.ActWindowActionManager',function(require){"use strict";var ActionManager=require('web.ActionManager');var config=require('web.config');var Context=require('web.Context');var core=require('web.core');var pyUtils=require('web.py_utils');var view_registry=require('web.view_registry');ActionManager.include({custom_events:_.extend({},ActionManager.prototype.custom_events,{execute_action:'_onExecuteAction',switch_view:'_onSwitchView',}),getCurrentController:function(){var currentController=this._super.apply(this,arguments);var action=currentController&&this.actions[currentController.actionID];if(action&&action.type==='ir.actions.act_window'&&!currentController.widget){var lastControllerID=this.controllerStack.pop();currentController=this._super.apply(this,arguments);this.controllerStack.push(lastControllerID);}
return currentController;},loadState:function(state){var _super=this._super.bind(this);var action;var options={clear_breadcrumbs:true,pushState:false,};if(state.action){var currentController=this.getCurrentController();var currentAction=currentController&&this.actions[currentController.actionID];if(currentAction&&currentAction.id===state.action&&currentAction.type==='ir.actions.act_window'){this._closeDialog(true);var viewOptions={currentId:state.id};var viewType=state.view_type||currentController.viewType;return this._switchController(currentAction,viewType,viewOptions);}else if(!core.action_registry.contains(state.action)){var context={};if(state.active_id){context.active_id=state.active_id;}
if(state.active_ids){context.active_ids=state.active_ids.toString().split(',').map(function(id){return parseInt(id,10)||id;});}else if(state.active_id){context.active_ids=[state.active_id];}
context.params=state;action=state.action;options=_.extend(options,{additional_context:context,resID:state.id||undefined,viewType:state.view_type,});}}else if(state.model&&state.id){action={res_model:state.model,res_id:state.id,type:'ir.actions.act_window',views:[[state.view_id||false,'form']],};}else if(state.model&&state.view_type){var storedAction=this.call('session_storage','getItem','current_action');var lastAction=JSON.parse(storedAction||'{}');if(lastAction.res_model===state.model){action=lastAction;options.viewType=state.view_type;}}
if(action){return this.doAction(action,options);}
return _super.apply(this,arguments);},_createViewController:function(action,viewType,viewOptions,options){var self=this;var viewDescr=_.findWhere(action.views,{type:viewType});if(!viewDescr){return Promise.reject();}
options=options||{};var index=options.index||0;var controllerID=options.controllerID||_.uniqueId('controller_');var controller={actionID:action.jsID,className:'o_act_window',index:index,jsID:controllerID,viewType:viewType,};Object.defineProperty(controller,'title',{get:function(){return controller.widget?controller.widget.getTitle():(action.display_name||action.name);},});this.controllers[controllerID]=controller;if(!options.lazy){var flags=action.flags||{};viewOptions=_.extend({},flags,flags[viewType],viewOptions,{action:action,breadcrumbs:this._getBreadcrumbs(this.controllerStack.slice(0,index)),controllerID:controllerID,});var rejection;var view=new viewDescr.Widget(viewDescr.fieldsView,viewOptions);var def=new Promise(function(resolve,reject){rejection=reject;view.getController(self).then(function(widget){if(def.rejected){widget.destroy();}else{controller.widget=widget;resolve(controller);}}).guardedCatch(reject);});def.reject=rejection;def.guardedCatch(function(){def.rejected=true;delete self.controllers[controllerID];});action.controllers[viewType]=def;}else{action.controllers[viewType]=Promise.resolve(controller);}
return action.controllers[viewType];},_destroyWindowAction:function(action){var self=this;for(var c in action.controllers){var controllerDef=action.controllers[c];controllerDef.then(function(controller){delete self.controllers[controller.jsID];if(controller.widget){controller.widget.destroy();}});if(controllerDef.reject){controllerDef.reject();}}},_executeWindowAction:function(action,options){var self=this;return this.dp.add(this._loadViews(action)).then(function(fieldsViews){var views=self._generateActionViews(action,fieldsViews);action._views=action.views;action.views=views;action.controlPanelFieldsView=fieldsViews.search;action.controllers={};var curView=options.viewType&&_.findWhere(views,{type:options.viewType});var lazyView;if(curView){if(!curView.multiRecord&&views[0].multiRecord){lazyView=views[0];}}else{curView=views[0];}
if(config.device.isMobile){if(!curView.isMobileFriendly){curView=self._findMobileView(views,curView.multiRecord)||curView;}
if(lazyView&&!lazyView.isMobileFriendly){lazyView=self._findMobileView(views,lazyView.multiRecord)||lazyView;}}
var lazyViewDef;var lazyControllerID;if(lazyView){options.clear_breadcrumbs=false;lazyViewDef=self._createViewController(action,lazyView.type,{},{lazy:true}).then(function(lazyLoadedController){lazyControllerID=lazyLoadedController.jsID;self.controllerStack.push(lazyLoadedController.jsID);});}
return self.dp.add(Promise.resolve(lazyViewDef)).then(function(){var viewOptions={controllerState:options.controllerState,currentId:options.resID,};var curViewDef=self._createViewController(action,curView.type,viewOptions,{index:self._getControllerStackIndex(options),});return self.dp.add(curViewDef);}).then(function(controller){action.controllerID=controller.jsID;return self._executeAction(action,options);}).guardedCatch(function(){if(lazyControllerID){var index=self.controllerStack.indexOf(lazyControllerID);self.controllerStack=self.controllerStack.slice(0,index);}
self._destroyWindowAction(action);});});},_findMobileView:function(views,multiRecord){return _.findWhere(views,{isMobileFriendly:true,multiRecord:multiRecord,});},_generateActionViews:function(action,fieldsViews){var views=[];_.each(action.views,function(view){var viewType=view[1];var fieldsView=fieldsViews[viewType];var parsedXML=new DOMParser().parseFromString(fieldsView.arch,"text/xml");var key=parsedXML.documentElement.getAttribute('js_class');var View=view_registry.get(key||viewType);if(View){views.push({accessKey:View.prototype.accessKey||View.prototype.accesskey,displayName:View.prototype.display_name,fieldsView:fieldsView,icon:View.prototype.icon,isMobileFriendly:View.prototype.mobile_friendly,multiRecord:View.prototype.multi_record,type:viewType,viewID:view[0],Widget:View,});}else if(config.isDebug('assets')){console.log("View type '"+viewType+"' is not present in the view registry.");}});return views;},_getControllerState:function(controllerID){var state=this._super.apply(this,arguments);var controller=this.controllers[controllerID];var action=this.actions[controller.actionID];if(action.type==='ir.actions.act_window'){state.model=action.res_model;state.view_type=controller.viewType;}
return state;},_handleAction:function(action,options){if(action.type==='ir.actions.act_window'){return this._executeWindowAction(action,options);}
return this._super.apply(this,arguments);},_loadViews:function(action){var inDialog=action.target==='new';var inline=action.target==='inline';var options={action_id:action.id,toolbar:!inDialog&&!inline,};var views=action.views.slice();if(!inline&&!(inDialog&&action.views[0][1]==='form')){options.load_filters=true;var searchviewID=action.search_view_id&&action.search_view_id[0];views.push([searchviewID||false,'search']);}
return this.loadViews(action.res_model,action.context,views,options);},_removeAction:function(actionID){var action=this.actions[actionID];if(action.type==='ir.actions.act_window'){delete this.actions[action.jsID];this._destroyWindowAction(action);}else{this._super.apply(this,arguments);}},_restoreController:function(controllerID){var self=this;var controller=this.controllers[controllerID];var action=this.actions[controller.actionID];if(action.type==='ir.actions.act_window'){return this.clearUncommittedChanges().then(function(){var def=Promise.resolve();if(action.on_reverse_breadcrumb){def=action.on_reverse_breadcrumb();}
return Promise.resolve(def).then(function(){return self._switchController(action,controller.viewType);});});}
return this._super.apply(this,arguments);},_switchController:function(action,viewType,viewOptions){var self=this;var view=_.findWhere(action.views,{type:viewType});if(!view){return Promise.reject();}
var currentController=this.getCurrentController();var index;if(currentController.actionID!==action.jsID){var controller=_.findWhere(this.controllers,{actionID:action.jsID,viewType:viewType,});index=_.indexOf(this.controllerStack,controller.jsID);}else{if(view.multiRecord){index=_.findIndex(this.controllerStack,function(controllerID){return self.controllers[controllerID].actionID===action.jsID;});}else if(!_.findWhere(action.views,{type:currentController.viewType}).multiRecord){index=this.controllerStack.length-1;}else{index=this.controllerStack.length;}}
var newController=function(controllerID){var options={controllerID:controllerID,index:index,};return self._createViewController(action,viewType,viewOptions,options).then(function(controller){return self._startController(controller);});};var controllerDef=action.controllers[viewType];if(controllerDef){controllerDef=controllerDef.then(function(controller){if(!controller.widget){return newController(controller.jsID);}else{return Promise.resolve(controller.widget.willRestore()).then(function(){viewOptions=_.extend({},viewOptions,{breadcrumbs:self._getBreadcrumbs(self.controllerStack.slice(0,index)),});return controller.widget.reload(viewOptions).then(function(){return controller;});});}},function(){return newController();});}else{controllerDef=newController();}
return this.dp.add(controllerDef).then(function(controller){return self._pushController(controller);});},_onExecuteAction:function(ev){ev.stopPropagation();var self=this;var actionData=ev.data.action_data;var env=ev.data.env;var context=new Context(env.context,actionData.context||{});var recordID=env.currentID||null;var def;if(actionData.special){def=Promise.resolve({type:'ir.actions.act_window_close',infos:{special:true},});}else if(actionData.type==='object'){var args=recordID?[[recordID]]:[env.resIDs];if(actionData.args){try{var additionalArgs=JSON.parse(actionData.args.replace(/'/g,'"'));args=args.concat(additionalArgs);}catch(e){console.error("Could not JSON.parse arguments",actionData.args);}}
def=this._rpc({route:'/web/dataset/call_button',params:{args:args,kwargs:{context:context.eval()},method:actionData.name,model:env.model,},});}else if(actionData.type==='action'){def=this._loadAction(actionData.name,_.extend(pyUtils.eval('context',context),{active_model:env.model,active_ids:env.resIDs,active_id:recordID,}));}else{def=Promise.reject();}
def.guardedCatch(ev.data.on_fail);this.dp.add(def).then(function(action){var effect=false;if(actionData.effect){effect=pyUtils.py_eval(actionData.effect);}
if(action&&action.constructor===Object){var ctx=new Context(_.object(_.reject(_.pairs(env.context),function(pair){return pair[0].match('^(?:(?:default_|search_default_|show_).+|'+'.+_view_ref|group_by|group_by_no_leaf|active_id|'+'active_ids|orderedBy)$')!==null;})));ctx.add(actionData.context||{});ctx.add({active_model:env.model});if(recordID){ctx.add({active_id:recordID,active_ids:[recordID],});}
ctx.add(action.context||{});action.context=ctx;action.effect=effect||action.effect;}else{action={effect:effect,type:'ir.actions.act_window_close',};}
var options={on_close:ev.data.on_closed};if(config.device.isMobile&&actionData.mobile){options=Object.assign({},options,actionData.mobile);}
action.flags=_.extend({},action.flags,{searchPanelDefaultNoFilter:true});return self.doAction(action,options).then(ev.data.on_success,ev.data.on_fail);});},_onSwitchView:function(ev){ev.stopPropagation();var viewType=ev.data.view_type;var currentController=this.getCurrentController();if(currentController.jsID===ev.data.controllerID){var action=this.actions[currentController.actionID];var currentControllerState=currentController.widget.exportState();action.controllerState=_.extend({},action.controllerState,currentControllerState);var options={controllerState:action.controllerState,currentId:ev.data.res_id,};if(ev.data.mode){options.mode=ev.data.mode;}
this._switchController(action,viewType,options);}},});});;

/* /web/static/src/js/chrome/action_manager_report.js defined in bundle 'web.assets_backend' */
odoo.define('web.ReportActionManager',function(require){"use strict";var ActionManager=require('web.ActionManager');var core=require('web.core');var framework=require('web.framework');var session=require('web.session');var _t=core._t;var _lt=core._lt;var link='<br><br><a href="http://wkhtmltopdf.org/" target="_blank">wkhtmltopdf.org</a>';var WKHTMLTOPDF_MESSAGES={broken:_lt('Your installation of Wkhtmltopdf seems to be broken. The report will be shown '+'in html.')+link,install:_lt('Unable to find Wkhtmltopdf on this system. The report will be shown in '+'html.')+link,upgrade:_lt('You should upgrade your version of Wkhtmltopdf to at least 0.12.0 in order to '+'get a correct display of headers and footers as well as support for '+'table-breaking between pages.')+link,workers:_lt('You need to start Odoo with at least two workers to print a pdf version of '+'the reports.'),};ActionManager.include({_downloadReport:function(url){var self=this;framework.blockUI();return new Promise(function(resolve,reject){var type='qweb-'+url.split('/')[2];var blocked=!session.get_file({url:'/report/download',data:{data:JSON.stringify([url,type]),context:JSON.stringify(session.user_context),},success:resolve,error:(error)=>{self.call('crash_manager','rpc_error',error);reject();},complete:framework.unblockUI,});if(blocked){var message=_t('A popup window with your report was blocked. You '+'may need to change your browser settings to allow '+'popup windows for this page.');self.do_warn(_t('Warning'),message,true);}});},_triggerDownload:function(action,options,type){var self=this;var reportUrls=this._makeReportUrls(action);return this._downloadReport(reportUrls[type]).then(function(){if(action.close_on_report_download){var closeAction={type:'ir.actions.act_window_close'};return self.doAction(closeAction,_.pick(options,'on_close'));}else{return options.on_close();}});},_executeReportAction:function(action,options){var self=this;if(action.report_type==='qweb-html'){return this._executeReportClientAction(action,options);}else if(action.report_type==='qweb-pdf'){return this.call('report','checkWkhtmltopdf').then(function(state){if(state in WKHTMLTOPDF_MESSAGES){self.do_notify(_t('Report'),WKHTMLTOPDF_MESSAGES[state],true);}
if(state==='upgrade'||state==='ok'){return self._triggerDownload(action,options,'pdf');}else{return self._executeReportClientAction(action,options);}});}else if(action.report_type==='qweb-text'){return self._triggerDownload(action,options,'text');}else{console.error("The ActionManager can't handle reports of type "+
action.report_type,action);return Promise.reject();}},_executeReportClientAction:function(action,options){var urls=this._makeReportUrls(action);var clientActionOptions=_.extend({},options,{context:action.context,data:action.data,display_name:action.display_name,name:action.name,report_file:action.report_file,report_name:action.report_name,report_url:urls.html,});return this.doAction('report.client_action',clientActionOptions);},_handleAction:function(action,options){if(action.type==='ir.actions.report'){return this._executeReportAction(action,options);}
return this._super.apply(this,arguments);},_makeReportUrls:function(action){var reportUrls={html:'/report/html/'+action.report_name,pdf:'/report/pdf/'+action.report_name,text:'/report/text/'+action.report_name,};if(_.isUndefined(action.data)||_.isNull(action.data)||(_.isObject(action.data)&&_.isEmpty(action.data))){if(action.context.active_ids){var activeIDsPath='/'+action.context.active_ids.join(',');reportUrls=_.mapObject(reportUrls,function(value){return value+=activeIDsPath;});}
reportUrls.html+='?context='+encodeURIComponent(JSON.stringify(session.user_context));}else{var serializedOptionsPath='?options='+encodeURIComponent(JSON.stringify(action.data));serializedOptionsPath+='&context='+encodeURIComponent(JSON.stringify(action.context));reportUrls=_.mapObject(reportUrls,function(value){return value+=serializedOptionsPath;});}
return reportUrls;},});});;

/* /web/static/src/js/chrome/action_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('web.ActionMixin',function(require){"use strict";var core=require('web.core');var ActionMixin={template:'Action',contentTemplate:null,custom_events:{get_controller_query_params:'_onGetControllerQueryParams',},_controlPanel:null,_title:'',renderElement:function(){this._super.apply(this,arguments);if(this.contentTemplate){var content=core.qweb.render(this.contentTemplate,{widget:this});this.$('.o_content').append(content);}},on_attach_callback:function(){},on_detach_callback:function(){},willRestore:function(){},canBeRemoved:function(){return Promise.resolve();},getOwnedQueryParams:function(){return{};},getTitle:function(){return this._title;},giveFocus:function(){},renderButtons:function($node){},updateControlPanel:function(status,options){if(this._controlPanel){status=status||{};status.title=status.title||this.getTitle();this._controlPanel.updateContents(status,options||{});}},_setTitle:function(title){this._title=title;this.updateControlPanel({title:this._title},{clear:false});},_onGetControllerQueryParams:function(ev){ev.stopPropagation();var state=this.getOwnedQueryParams();ev.data.callback(state||{});},};return ActionMixin;});;

/* /web/static/src/js/core/browser_detection.js defined in bundle 'web.assets_backend' */
odoo.define('web.BrowserDetection',function(require){"use strict";var Class=require('web.Class');var BrowserDetection=Class.extend({init:function(){},isOsMac:function(){return navigator.platform.toLowerCase().indexOf('mac')!==-1;},isBrowserChrome:function(){return $.browser.chrome&&navigator.userAgent.toLocaleLowerCase().indexOf('edge')===-1;}});return BrowserDetection;});;

/* /web/static/src/js/chrome/keyboard_navigation_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('web.KeyboardNavigationMixin',function(require){"use strict";var BrowserDetection=require('web.BrowserDetection');var knownUnusableAccessKeys=[' ','A','B','C','H','J','K','L','N','P','S','Q','E','F','D','0','1','2','3','4','5','6','7','8','9'];var KeyboardNavigationMixin={events:{'keydown':'_onKeyDown','keyup':'_onKeyUp',},init:function(){this._areAccessKeyVisible=false;this.BrowserDetection=new BrowserDetection();},_addAccessKeyOverlays:function(){var accesskeyElements=$(document).find('[accesskey]').filter(':visible');_.each(accesskeyElements,function(elem){var overlay=$(_.str.sprintf("<div class='o_web_accesskey_overlay'>%s</div>",$(elem).attr('accesskey').toUpperCase()));var $overlayParent;if(elem.tagName.toUpperCase()==="INPUT"){$overlayParent=$(elem).parent();}else{$overlayParent=$(elem);}
if($overlayParent.css('position')!=='absolute'){$overlayParent.css('position','relative');}
overlay.appendTo($overlayParent);});},_getAllUsedAccessKeys:function(){var usedAccessKeys=knownUnusableAccessKeys.slice();this.$el.find('[accesskey]').each(function(_,elem){usedAccessKeys.push(elem.accessKey.toUpperCase());});return usedAccessKeys;},_hideAccessKeyOverlay:function(){this._areAccessKeyVisible=false;var overlays=this.$el.find('.o_web_accesskey_overlay');if(overlays.length){return overlays.remove();}},_setAccessKeyOnTopNavigation:function(){this.$el.find('.o_menu_sections>li>a').each(function(number,item){item.accessKey=number+1;});},_onKeyDown:function(keyDownEvent){if($('body.o_ui_blocked').length&&(keyDownEvent.altKey||keyDownEvent.key==='Alt')&&!keyDownEvent.ctrlKey){if(keyDownEvent.preventDefault)keyDownEvent.preventDefault();else keyDownEvent.returnValue=false;if(keyDownEvent.stopPropagation)keyDownEvent.stopPropagation();if(keyDownEvent.cancelBubble)keyDownEvent.cancelBubble=true;return false;}
if(!this._areAccessKeyVisible&&(keyDownEvent.altKey||keyDownEvent.key==='Alt')&&!keyDownEvent.ctrlKey){this._areAccessKeyVisible=true;this._setAccessKeyOnTopNavigation();var usedAccessKey=this._getAllUsedAccessKeys();var buttonsWithoutAccessKey=this.$el.find('button.btn:visible').not('[accesskey]').not('[disabled]').not('[tabindex="-1"]');_.each(buttonsWithoutAccessKey,function(elem){var buttonString=[elem.innerText,elem.title,"ABCDEFGHIJKLMNOPQRSTUVWXYZ"].join('');for(var letterIndex=0;letterIndex<buttonString.length;letterIndex++){var candidateAccessKey=buttonString[letterIndex].toUpperCase();if(candidateAccessKey>='A'&&candidateAccessKey<='Z'&&!_.includes(usedAccessKey,candidateAccessKey)){elem.accessKey=candidateAccessKey;usedAccessKey.push(candidateAccessKey);break;}}});var elementsWithoutAriaKeyshortcut=this.$el.find('[accesskey]').not('[aria-keyshortcuts]');_.each(elementsWithoutAriaKeyshortcut,function(elem){elem.setAttribute('aria-keyshortcuts','Alt+Shift+'+elem.accessKey);});this._addAccessKeyOverlays();}
if(this.BrowserDetection.isOsMac())
return;if(keyDownEvent.altKey&&!keyDownEvent.ctrlKey&&keyDownEvent.key.length===1){var elementWithAccessKey=[];if(keyDownEvent.keyCode>=65&&keyDownEvent.keyCode<=90||keyDownEvent.keyCode>=97&&keyDownEvent.keyCode<=122){elementWithAccessKey=document.querySelectorAll('[accesskey="'+String.fromCharCode(keyDownEvent.keyCode).toLowerCase()+'"], [accesskey="'+String.fromCharCode(keyDownEvent.keyCode).toUpperCase()+'"]');if(elementWithAccessKey.length){if(this.BrowserDetection.isOsMac()||!this.BrowserDetection.isBrowserChrome()){elementWithAccessKey[0].focus();elementWithAccessKey[0].click();if(keyDownEvent.preventDefault)keyDownEvent.preventDefault();else keyDownEvent.returnValue=false;if(keyDownEvent.stopPropagation)keyDownEvent.stopPropagation();if(keyDownEvent.cancelBubble)keyDownEvent.cancelBubble=true;return false;}}}
else{var numberKey;if(keyDownEvent.originalEvent.code&&keyDownEvent.originalEvent.code.indexOf('Digit')===0){numberKey=keyDownEvent.originalEvent.code[keyDownEvent.originalEvent.code.length-1];}else if(keyDownEvent.originalEvent.key&&keyDownEvent.originalEvent.key.length===1&&keyDownEvent.originalEvent.key>='0'&&keyDownEvent.originalEvent.key<='9'){numberKey=keyDownEvent.originalEvent.key;}else if(keyDownEvent.keyCode>=48&&keyDownEvent.keyCode<=57){numberKey=keyDownEvent.keyCode-48;}
if(numberKey>='0'&&numberKey<='9'){elementWithAccessKey=document.querySelectorAll('[accesskey="'+numberKey+'"]');if(elementWithAccessKey.length){elementWithAccessKey[0].click();if(keyDownEvent.preventDefault)keyDownEvent.preventDefault();else keyDownEvent.returnValue=false;if(keyDownEvent.stopPropagation)keyDownEvent.stopPropagation();if(keyDownEvent.cancelBubble)keyDownEvent.cancelBubble=true;return false;}}}}},_onKeyUp:function(keyUpEvent){if((keyUpEvent.altKey||keyUpEvent.key==='Alt')&&!keyUpEvent.ctrlKey){this._hideAccessKeyOverlay();if(keyUpEvent.preventDefault)keyUpEvent.preventDefault();else keyUpEvent.returnValue=false;if(keyUpEvent.stopPropagation)keyUpEvent.stopPropagation();if(keyUpEvent.cancelBubble)keyUpEvent.cancelBubble=true;return false;}},};return KeyboardNavigationMixin;});;

/* /web/static/src/js/chrome/abstract_web_client.js defined in bundle 'web.assets_backend' */
odoo.define('web.AbstractWebClient',function(require){"use strict";var ActionManager=require('web.ActionManager');var concurrency=require('web.concurrency');var core=require('web.core');var config=require('web.config');var WarningDialog=require('web.CrashManager').WarningDialog;var data_manager=require('web.data_manager');var dom=require('web.dom');var KeyboardNavigationMixin=require('web.KeyboardNavigationMixin');var Loading=require('web.Loading');var local_storage=require('web.local_storage');var RainbowMan=require('web.RainbowMan');var ServiceProviderMixin=require('web.ServiceProviderMixin');var session=require('web.session');var utils=require('web.utils');var Widget=require('web.Widget');var _t=core._t;var AbstractWebClient=Widget.extend(ServiceProviderMixin,KeyboardNavigationMixin,{dependencies:['notification'],events:_.extend({},KeyboardNavigationMixin.events,{'click .o_search_options .dropdown-menu':'_onClickDropDownMenu',}),custom_events:{clear_uncommitted_changes:function(e){this.clear_uncommitted_changes().then(e.data.callback);},toggle_fullscreen:function(event){this.toggle_fullscreen(event.data.fullscreen);},current_action_updated:function(ev){this.current_action_updated(ev.data.action,ev.data.controller);},warning:'_onDisplayWarning',load_action:'_onLoadAction',load_views:function(event){var params={model:event.data.modelName,context:event.data.context,views_descr:event.data.views,};return data_manager.load_views(params,event.data.options||{}).then(event.data.on_success);},load_filters:function(event){return data_manager.load_filters(event.data).then(event.data.on_success);},create_filter:'_onCreateFilter',delete_filter:'_onDeleteFilter',push_state:'_onPushState',show_effect:'_onShowEffect',get_session:function(event){if(event.data.callback){event.data.callback(session);}},do_action:function(event){this.do_action(event.data.action,event.data.options||{}).then(function(result){if(event.data.on_success){event.data.on_success(result);}}).guardedCatch(function(result){if(event.data.on_fail){event.data.on_fail(result);}});},getScrollPosition:'_onGetScrollPosition',scrollTo:'_onScrollTo',set_title_part:'_onSetTitlePart',},init:function(parent){odoo.isReady=false;this.client_options={};this._super(parent);ServiceProviderMixin.init.call(this);KeyboardNavigationMixin.init.call(this);this.origin=undefined;this._current_state=null;this.menu_dp=new concurrency.DropPrevious();this.action_mutex=new concurrency.Mutex();this.set('title_part',{"zopenerp":"Odoo"});},start:function(){var self=this;this.$el.toggleClass('o_touch_device',config.device.touch);this.on("change:title_part",this,this._title_changed);this._title_changed();var state=$.bbq.getState();var current_company_id=session.user_companies.current_company[0]
if(!state.cids){state.cids=utils.get_cookie('cids')!==null?utils.get_cookie('cids'):String(current_company_id);}
var stateCompanyIDS=_.map(state.cids.split(','),function(cid){return parseInt(cid)});var userCompanyIDS=_.map(session.user_companies.allowed_companies,function(company){return company[0]});if(!_.isEmpty(_.difference(stateCompanyIDS,userCompanyIDS))){state.cids=String(current_company_id);stateCompanyIDS=[current_company_id]}
session.user_context.allowed_company_ids=stateCompanyIDS;$.bbq.pushState(state);$("link[type='image/x-icon']").attr('href','/web/image/res.company/'+String(stateCompanyIDS[0])+'/favicon/')
return session.is_bound.then(function(){self.$el.toggleClass('o_rtl',_t.database.parameters.direction==="rtl");self.bind_events();return Promise.all([self.set_action_manager(),self.set_loading()]);}).then(function(){if(session.session_is_valid()){return self.show_application();}else{return Promise.resolve();}}).then(function(){self.action_manager.$el.on('scroll',core.bus.trigger.bind(core.bus,'scroll'));core.bus.trigger('web_client_ready');odoo.isReady=true;if(session.uid===1){self.$el.addClass('o_is_superuser');}});},bind_events:function(){var self=this;$('.oe_systray').show();this.$el.on('mouseenter','.oe_systray > div:not([data-toggle=tooltip])',function(){$(this).attr('data-toggle','tooltip').tooltip().trigger('mouseenter');});this.$el.on('click','.oe_dropdown_toggle',function(ev){ev.preventDefault();var $toggle=$(this);var doc_width=$(document).width();var $menu=$toggle.siblings('.oe_dropdown_menu');$menu=$menu.length>=1?$menu:$toggle.find('.oe_dropdown_menu');var state=$menu.is('.oe_opened');setTimeout(function(){$toggle.add($menu).toggleClass('oe_opened',!state);if(!state){var offset=$menu.offset();var menu_width=$menu.width();var x=doc_width-offset.left-menu_width-2;if(x<0){$menu.offset({left:offset.left+x}).width(menu_width);}}},0);});window.addEventListener('blur',function(e){self._hideAccessKeyOverlay();});core.bus.on('click',this,function(ev){$('.tooltip').remove();if(!$(ev.target).is('input[type=file]')){$(this.el.getElementsByClassName('oe_dropdown_menu oe_opened')).removeClass('oe_opened');$(this.el.getElementsByClassName('oe_dropdown_toggle oe_opened')).removeClass('oe_opened');}
this._hideAccessKeyOverlay();});core.bus.on('connection_lost',this,this._onConnectionLost);core.bus.on('connection_restored',this,this._onConnectionRestored);},set_action_manager:function(){var self=this;this.action_manager=new ActionManager(this,session.user_context);var fragment=document.createDocumentFragment();return this.action_manager.appendTo(fragment).then(function(){dom.append(self.$el,fragment,{in_DOM:true,callbacks:[{widget:self.action_manager}],});});},set_loading:function(){this.loading=new Loading(this);return this.loading.appendTo(this.$el);},show_application:function(){},clear_uncommitted_changes:function(){return this.action_manager.clearUncommittedChanges();},destroy_content:function(){_.each(_.clone(this.getChildren()),function(el){el.destroy();});this.$el.children().remove();},set_title:function(title){this.set_title_part("action",title);},set_title_part:function(part,title){var tmp=_.clone(this.get("title_part"));tmp[part]=title;this.set("title_part",tmp);},_title_changed:function(){var parts=_.sortBy(_.keys(this.get("title_part")),function(x){return x;});var tmp="";_.each(parts,function(part){var str=this.get("title_part")[part];if(str){tmp=tmp?tmp+" - "+str:str;}},this);document.title=tmp;},do_action:function(){return this.action_manager.doAction.apply(this.action_manager,arguments);},do_reload:function(){var self=this;return session.session_reload().then(function(){session.load_modules(true).then(self.menu.proxy('do_reload'));});},do_push_state:function(state){if(!state.menu_id&&this.menu){state.menu_id=this.menu.getCurrentPrimaryMenu();}
if('title'in state){this.set_title(state.title);delete state.title;}
var url='#'+$.param(state);this._current_state=$.deparam($.param(state),false);$.bbq.pushState(url);this.trigger('state_pushed',state);},current_action_updated:function(action,controller){},toggle_fullscreen:function(fullscreen){this.$el.toggleClass('o_fullscreen',fullscreen);},getScrollPosition:function(){var scrollingEl=this.action_manager.el.getElementsByClassName('o_content')[0];return{left:scrollingEl?scrollingEl.scrollLeft:0,top:scrollingEl?scrollingEl.scrollTop:0,};},_onClickDropDownMenu:function(ev){ev.stopPropagation();},_onConnectionLost:function(){this.connectionNotificationID=this.displayNotification({title:_t('Connection lost'),message:_t('Trying to reconnect...'),sticky:true});},_onConnectionRestored:function(){if(this.connectionNotificationID){this.call('notification','close',this.connectionNotificationID);this.displayNotification({type:'info',title:_t('Connection restored'),message:_t('You are back online'),sticky:false});this.connectionNotificationID=false;}},_onCreateFilter:function(e){data_manager.create_filter(e.data.filter).then(e.data.on_success);},_onDeleteFilter:function(e){data_manager.delete_filter(e.data.filterId).then(e.data.on_success);},_onDisplayWarning:function(e){var data=e.data;if(data.type==='dialog'){new WarningDialog(this,{title:data.title,},data).open();}else{data.type='warning';this.call('notification','notify',data);}},_onGetScrollPosition:function(ev){ev.data.callback(this.getScrollPosition());},_onLoadAction:function(event){data_manager.load_action(event.data.actionID,event.data.context).then(event.data.on_success);},_onPushState:function(e){this.do_push_state(_.extend(e.data.state,{'cids':$.bbq.getState().cids}));},_onScrollTo:function(ev){var scrollingEl=this.action_manager.el.getElementsByClassName('o_content')[0];if(!scrollingEl){return;}
var offset={top:ev.data.top,left:ev.data.left||0};if(ev.data.selector){offset=dom.getPosition(document.querySelector(ev.data.selector));offset.top-=dom.getPosition(scrollingEl).top;}
scrollingEl.scrollTop=offset.top;scrollingEl.scrollLeft=offset.left;},_onSetTitlePart:function(ev){var part=ev.data.part;var title=ev.data.title;this.set_title_part(part,title);},_onShowEffect:function(e){var data=e.data||{};var type=data.type||'rainbow_man';if(type==='rainbow_man'){if(session.show_effect){new RainbowMan(data).appendTo(this.$el);}else{this.call('notification','notify',{title:"",message:data.message,sticky:false});}}else{throw new Error('Unknown effect type: '+type);}},});return AbstractWebClient;});;

/* /web_enterprise/static/src/js/web_client.js defined in bundle 'web.assets_backend' */
odoo.define('web.WebClient',function(require){"use strict";var AbstractWebClient=require('web.AbstractWebClient');var config=require('web.config');var core=require('web.core');var data_manager=require('web.data_manager');var dom=require('web.dom');var session=require('web.session');var HomeMenu=require('web_enterprise.HomeMenu');var Menu=require('web_enterprise.Menu');return AbstractWebClient.extend({custom_events:_.extend({},AbstractWebClient.prototype.custom_events,{app_clicked:'on_app_clicked',menu_clicked:'on_menu_clicked',show_home_menu:'_onShowHomeMenu',hide_home_menu:'_onHideHomeMenu'}),init:function(){this._super.apply(this,arguments);this.home_menu_displayed=false;},start:function(){core.bus.on('change_menu_section',this,function(menu_id){this.do_push_state(_.extend($.bbq.getState(),{menu_id:menu_id,}));});return this._super.apply(this,arguments);},bind_events:function(){var self=this;this._super.apply(this,arguments);this.$el.on('click','a',function(ev){var disable_anchor=ev.target.attributes.disable_anchor;if(disable_anchor&&disable_anchor.value==="true"){return;}
var href=ev.target.attributes.href;if(href){if(href.value[0]==='#'&&href.value.length>1){if(self.$("[id='"+href.value.substr(1)+"']").length){ev.preventDefault();self.trigger_up('scrollTo',{'selector':href.value});}}}});},load_menus:function(){return(odoo.loadMenusPromise||odoo.reloadMenus()).then(function(menuData){for(var i=0;i<menuData.children.length;i++){var child=menuData.children[i];if(child.action===false){while(child.children&&child.children.length){child=child.children[0];if(child.action){menuData.children[i].action=child.action;break;}}}}
odoo.loadMenusPromise=null;return menuData;});},show_application:function(){var self=this;this.set_title();const insertMenu=()=>{this.menu.$el.prependTo(this.$el);};return this.menu_dp.add(this.instanciate_menu_widgets()).then(function(){$(window).bind('hashchange',self.on_hashchange);self.home_menu.$el.on('scroll',core.bus.trigger.bind(core.bus,'scroll'));var state=$.bbq.getState(true);if(_.keys(state).length===1&&_.keys(state)[0]==="cids"){return self.menu_dp.add(self._rpc({model:'res.users',method:'read',args:[session.uid,["action_id"]],})).then(function(result){var data=result[0];if(data.action_id){return self.do_action(data.action_id[0]).then(function(){self.toggle_home_menu(false);self.menu.change_menu_section(self.menu.action_id_to_primary_menu_id(data.action_id[0]));});}else{self.toggle_home_menu(true);}});}else{return self.on_hashchange();}}).then(insertMenu).guardedCatch(insertMenu);},instanciate_menu_widgets:function(){var self=this;var defs=[];return this.load_menus().then(function(menu_data){self.menu_data=menu_data;self.home_menu=new HomeMenu(self,menu_data);self.menu=new Menu(self,menu_data);defs.push(self.home_menu.appendTo(document.createDocumentFragment()));defs.push(self.menu.appendTo(document.createDocumentFragment()));return Promise.all(defs);});},on_hashchange:function(event){if(this._ignore_hashchange){this._ignore_hashchange=false;return Promise.resolve();}
var self=this;return this.clear_uncommitted_changes().then(function(){var stringstate=$.bbq.getState(false);if(!_.isEqual(self._current_state,stringstate)){var state=$.bbq.getState(true);if(state.action||(state.model&&(state.view_type||state.id))){return self.menu_dp.add(self.action_manager.loadState(state,!!self._current_state)).then(function(){if(state.menu_id){if(state.menu_id!==self.menu.current_primary_menu){core.bus.trigger('change_menu_section',state.menu_id);}}else{var action=self.action_manager.getCurrentAction();if(action){var menu_id=self.menu.action_id_to_primary_menu_id(action.id);core.bus.trigger('change_menu_section',menu_id);}}
self.toggle_home_menu(false);}).guardedCatch(self.toggle_home_menu.bind(self,true));}else if(state.menu_id){var action_id=self.menu.menu_id_to_action_id(state.menu_id);return self.menu_dp.add(self.do_action(action_id,{clear_breadcrumbs:true})).then(function(){core.bus.trigger('change_menu_section',state.menu_id);self.toggle_home_menu(false);});}else{self.toggle_home_menu(true);}}
self._current_state=stringstate;},function(){if(event){self._ignore_hashchange=true;window.location=event.originalEvent.oldURL;}});},on_app_clicked:function(ev){var self=this;return this.menu_dp.add(data_manager.load_action(ev.data.action_id)).then(function(result){return self.action_mutex.exec(function(){return new Promise(function(resolve,reject){var options=_.extend({},ev.data.options,{clear_breadcrumbs:true,action_menu_id:ev.data.menu_id,});Promise.resolve(self._openMenu(result,options)).guardedCatch(function(){self.toggle_home_menu(true);resolve();}).then(function(){self._on_app_clicked_done(ev).then(resolve).guardedCatch(reject);});});});});},_on_app_clicked_done:function(ev){core.bus.trigger('change_menu_section',ev.data.menu_id);this.toggle_home_menu(false);return Promise.resolve();},on_menu_clicked:function(ev){var self=this;return this.menu_dp.add(data_manager.load_action(ev.data.action_id)).then(function(result){return self.action_mutex.exec(function(){return self._openMenu(result,{clear_breadcrumbs:true});});}).then(function(){self.$el.removeClass('o_mobile_menu_opened');});},_openMenu:function(action,options){return this.do_action(action,options);},toggle_home_menu:function(display){if(display===this.home_menu_displayed){return;}
if(display){var self=this;this.clear_uncommitted_changes().then(function(){self.scrollPosition=self.getScrollPosition();var $to_detach=self.$el.contents().not(self.menu.$el).not('.o_loading').not('.o_in_home_menu').not('.o_notification_manager');self.web_client_content=document.createDocumentFragment();dom.detach([{widget:self.action_manager}],{$to_detach:$to_detach}).appendTo(self.web_client_content);self.append_home_menu();self.$el.addClass('o_home_menu_background');self.url=$.bbq.getState();if(location.hash){self._ignore_hashchange=true;$.bbq.pushState('#home',2);}
$.bbq.pushState({'cids':self.url.cids},0);self.menu.toggle_mode(true,self.action_manager.getCurrentAction()!==null);});}else{dom.detach([{widget:this.home_menu}]);dom.append(this.$el,[this.web_client_content],{in_DOM:true,callbacks:[{widget:this.action_manager}],});this.trigger_up('scrollTo',this.scrollPosition);this.home_menu_displayed=false;this.$el.removeClass('o_home_menu_background');this.menu.toggle_mode(false,this.action_manager.getCurrentAction()!==null);}},append_home_menu:function(){dom.append(this.$el,[this.home_menu.$el],{in_DOM:true,callbacks:[{widget:this.home_menu}],});this.home_menu_displayed=true;},current_action_updated:function(){this._super.apply(this,arguments);if(this.home_menu_displayed){this.toggle_home_menu(false);}},_onShowHomeMenu:function(){this.toggle_home_menu(true);},_onHideHomeMenu:function(){if(this.action_manager.getCurrentAction()!==null){$.bbq.pushState(this.url,2);this.toggle_home_menu(false);}},getScrollPosition:function(){if(config.device.isMobile){return{left:$(window).scrollLeft(),top:$(window).scrollTop(),};}
return this._super.apply(this,arguments);},_onScrollTo:function(ev){if(config.device.isMobile){var offset={top:ev.data.top,left:ev.data.left||0};if(!offset.top){offset=dom.getPosition(document.querySelector(ev.data.selector));}
$(window).scrollTop(offset.top);$(window).scrollLeft(offset.left);}
this._super.apply(this,arguments);},});});;

/* /web/static/src/js/chrome/root_widget.js defined in bundle 'web.assets_backend' */
odoo.define('root.widget',function(require){"use strict";var webClient=require('web.web_client');return webClient;});;

/* /web/static/src/js/_deprecated/data.js defined in bundle 'web.assets_backend' */
odoo.define('web.data',function(require){"use strict";var Class=require('web.Class');var Context=require('web.Context');var concurrency=require('web.concurrency');var mixins=require('web.mixins');var session=require('web.session');var translation=require('web.translation');var pyUtils=require('web.py_utils');var _t=translation._t;function serialize_sort(criterion){return _.map(criterion,function(criteria){if(criteria[0]==='-'){return criteria.slice(1)+' DESC';}
return criteria+' ASC';}).join(', ');}
function deserialize_sort(criterion){return _.map(criterion,function(criteria){var split=_.without(criteria.split(' '),'');return(split[1]&&split[1].toLowerCase()==='desc'?'-':'')+split[0];});}
var Query=Class.extend({init:function(model,fields){this._model=model;this._fields=fields;this._filter=[];this._context={};this._lazy=true;this._limit=false;this._offset=0;this._order_by=[];},clone:function(to_set){to_set=to_set||{};var q=new Query(this._model,this._fields);q._context=this._context;q._filter=this._filter;q._lazy=this._lazy;q._limit=this._limit;q._offset=this._offset;q._order_by=this._order_by;for(var key in to_set){if(!to_set.hasOwnProperty(key)){continue;}
switch(key){case'filter':q._filter=(q._filter||[]).concat(to_set.filter||[]);break;case'context':q._context=new Context(q._context,to_set.context);break;case'lazy':case'limit':case'offset':case'order_by':q['_'+key]=to_set[key];}}
return q;},_execute:function(options){var self=this;options=options||{};return session.rpc('/web/dataset/search_read',{model:this._model.name,fields:this._fields||false,domain:pyUtils.eval('domains',[this._model.domain(this._filter)]),context:pyUtils.eval('contexts',[this._model.context(this._context)]),offset:this._offset,limit:this._limit,sort:serialize_sort(this._order_by)},options).then(function(results){self._count=results.length;return results.records;},null);},first:function(options){var self=this;return this.clone({limit:1})._execute(options).then(function(records){delete self._count;if(records.length){return records[0];}
return null;});},all:function(options){return this._execute(options);},count:function(){if(this._count!==undefined){return Promise.resolve(this._count);}
return this._model.call('search_count',[this._filter],{context:this._model.context(this._context)});},group_by:function(grouping){var ctx=pyUtils.eval('context',this._model.context(this._context));if(_.isUndefined(grouping)){grouping=[];}
if(!(grouping instanceof Array)){grouping=_.toArray(arguments);}
if(_.isEmpty(grouping)&&!ctx.group_by_no_leaf){return null;}
var raw_fields=_.map(grouping.concat(this._fields||[]),function(field){return field.split(':')[0];});var self=this;return this._model.call('read_group',{groupby:grouping,fields:_.uniq(raw_fields),domain:this._model.domain(this._filter),context:ctx,offset:this._offset,lazy:this._lazy,limit:this._limit,orderby:serialize_sort(this._order_by)||false}).then(function(results){return _(results).map(function(result){result.__context=result.__context||{};result.__context.group_by=result.__context.group_by||[];_.defaults(result.__context,ctx);var grouping_fields=self._lazy?[grouping[0]]:grouping;return new QueryGroup(self._model.name,grouping_fields,result);});});},context:function(context){if(!context){return this;}
return this.clone({context:context});},filter:function(domain){if(!domain){return this;}
return this.clone({filter:domain});},lazy:function(lazy){return this.clone({lazy:lazy});},limit:function(limit){return this.clone({limit:limit});},offset:function(offset){return this.clone({offset:offset});},order_by:function(fields){if(fields===undefined){return this;}
if(!(fields instanceof Array)){fields=_.toArray(arguments);}
if(_.isEmpty(fields)){return this;}
return this.clone({order_by:fields});}});var QueryGroup=Class.extend({init:function(model,grouping_fields,read_group_group){var fixed_group=_.extend({__context:{group_by:[]},__domain:[]},read_group_group);var count_key=(grouping_fields[0]&&grouping_fields[0].split(':')[0])+'_count';var aggregates={};for(var key in fixed_group){if(fixed_group.hasOwnProperty(key)){if(!(key.indexOf('__')===0||_.contains(grouping_fields,key)||(key===count_key))){aggregates[key]=fixed_group[key]||0;}}}
this.model=new Model(model,fixed_group.__context,fixed_group.__domain);var group_size=fixed_group[count_key]||fixed_group.__count||0;var leaf_group=fixed_group.__context.group_by.length===0;var value=(grouping_fields.length===1)?fixed_group[grouping_fields[0]]:_.map(grouping_fields,function(field){return fixed_group[field];});var grouped_on=(grouping_fields.length===1)?grouping_fields[0]:grouping_fields;this.attributes={folded:!!(fixed_group.__fold),grouped_on:grouped_on,length:group_size,value:value,has_children:!(leaf_group&&fixed_group.__context.group_by_no_leaf),aggregates:aggregates};},get:function(key){return this.attributes[key];},subgroups:function(){return this.model.query().group_by(this.model.context().group_by);},query:function(){return this.model.query.apply(this.model,arguments);}});var DataSet=Class.extend(mixins.PropertiesMixin,{init:function(parent,model,context){mixins.PropertiesMixin.init.call(this);this.setParent(parent);this.model=model;this.context=context||{};this.index=null;this._sort=[];this._model=new Model(model,context);this.orderer=new concurrency.DropMisordered();},previous:function(){this.index-=1;if(!this.ids.length){this.index=null;}else if(this.index<0){this.index=this.ids.length-1;}
return this;},next:function(){this.index+=1;if(!this.ids.length){this.index=null;}else if(this.index>=this.ids.length){this.index=0;}
return this;},select_id:function(id){var idx=this.get_id_index(id);if(idx===null){return false;}else{this.index=idx;return true;}},get_id_index:function(id){for(var i=0,ii=this.ids.length;i<ii;i++){if(id==this.ids[i]){return i;}}
return null;},read_ids:function(ids,fields,options){if(_.isEmpty(ids)){return Promise.resolve([]);}
options=options||{};var method='read';var ids_arg=ids;var context=this.get_context(options.context);if(options.check_access_rule===true){method='search_read';ids_arg=[['id','in',ids]];context=new Context(context,{active_test:false});}
return this._model.call(method,[ids_arg,fields||false],{context:context}).then(function(records){if(records.length<=1){return records;}
var indexes={};for(var i=0;i<ids.length;i++){indexes[ids[i]]=i;}
records.sort(function(a,b){return indexes[a.id]-indexes[b.id];});return records;});},read_slice:function(fields,options){var self=this;options=options||{};var query=this._model.query(fields).limit(options.limit||false).offset(options.offset||0).all();var prom=this.orderer.add(query);prom.then(function(records){self.ids=_(records).pluck('id');});return prom;},read_index:function(fields,options){options=options||{};return this.read_ids([this.ids[this.index]],fields,options).then(function(records){if(_.isEmpty(records)){return Promise.reject();}
return records[0];});},default_get:function(fields,options){options=options||{};return this._model.call('default_get',[fields],{context:this.get_context(options.context)});},create:function(data,options){var self=this;var prom=this._model.call('create',[data],{context:this.get_context()});prom.then(function(){self.trigger('dataset_changed',data,options);});return prom;},write:function(id,data,options){options=options||{};var self=this;var prom=this._model.call('write',[[id],data],{context:this.get_context(options.context)});prom.then(function(){self.trigger('dataset_changed',id,data,options);});return prom;},unlink:function(ids){var self=this;var prom=this._model.call('unlink',[ids],{context:this.get_context()});prom.then(function(){self.trigger('dataset_changed',ids);});return prom;},call:function(method,args){return this._model.call(method,args);},call_button:function(method,args){return this._model.call_button(method,args);},name_get:function(ids){return this._model.call('name_get',[ids],{context:this.get_context()});},name_search:function(name,domain,operator,limit){return this._model.call('name_search',{name:name||'',args:domain||false,operator:operator||'ilike',context:this._model.context(),limit:limit||0});},name_create:function(name,context){return this._model.call('name_create',[name],{context:this.get_context(context)});},get_context:function(request_context){return this._model.context(request_context);},sort:function(field,force_reverse){if(!field){return serialize_sort(this._sort);}
var reverse=force_reverse||(this._sort[0]===field);this._sort.splice.apply(this._sort,[0,this._sort.length].concat(_.without(this._sort,field,'-'+field)));this._sort.unshift((reverse?'-':'')+field);return undefined;},set_sort:function(fields_list){this._sort=deserialize_sort(fields_list);},size:function(){return this.ids.length;},alter_ids:function(n_ids){this.ids=n_ids;},remove_ids:function(ids){this.alter_ids(_(this.ids).difference(ids));},add_ids:function(ids,at){var args=[at,0].concat(_.difference(ids,this.ids));this.ids.splice.apply(this.ids,args);},resequence:function(ids,options){options=options||{};return session.rpc('/web/dataset/resequence',{model:this.model,ids:ids,context:pyUtils.eval('context',this.get_context(options.context)),}).then(function(results){return results;});},});var DataSetStatic=DataSet.extend({init:function(parent,model,context,ids){this._super(parent,model,context);this.ids=ids||[];},read_slice:function(fields,options){options=options||{};fields=fields||{};var offset=options.offset||0,limit=options.limit||false;var end_pos=limit&&limit!==-1?offset+limit:this.ids.length;return this.read_ids(this.ids.slice(offset,end_pos),fields,options);},set_ids:function(ids){this.ids=ids;if(ids.length===0){this.index=null;}else if(this.index>=ids.length-1){this.index=ids.length-1;}},unlink:function(ids){this.set_ids(_.without.apply(null,[this.ids].concat(ids)));this.trigger('unlink',ids);return Promise.resolve({result:true});},});var DataSetSearch=DataSet.extend({init:function(parent,model,context,domain){this._super(parent,model,context);this.domain=domain||[];this._length=null;this.ids=[];this._model=new Model(model,context,domain);},read_slice:function(fields,options){options=options||{};var self=this;var q=this._model.query(fields||false).filter(options.domain).context(options.context).offset(options.offset||0).limit(options.limit||false);q=q.order_by.apply(q,this._sort);var prom=this.orderer.add(q.all());prom.then(function(records){q.count().then(function(count){self._length=count;});self.ids=_(records).pluck('id');});return prom;},get_domain:function(other_domain){return this._model.domain(other_domain);},alter_ids:function(ids){this._super(ids);if(this.index!==null&&this.index>=this.ids.length){this.index=this.ids.length>0?this.ids.length-1:0;}},remove_ids:function(ids){var before=this.ids.length;this._super(ids);if(this._length){this._length-=(before-this.ids.length);}},add_ids:function(ids,at){var before=this.ids.length;this._super(ids,at);if(this._length){this._length+=(this.ids.length-before);}},unlink:function(ids,callback,error_callback){var self=this;var prom=this._super(ids);prom.then(function(){self.remove_ids(ids);self.trigger("dataset_changed",ids,callback,error_callback);});return prom;},size:function(){if(this._length!==null){return this._length;}
return this._super();}});var data={Query:Query,DataSet:DataSet,DataSetStatic:DataSetStatic,DataSetSearch:DataSetSearch,noDisplayContent:"<em class=\"text-warning\">"+_t("Unnamed")+"</em>",};var Model=Class.extend({init:function(name,context,domain){this.name=name;this._context=context||{};this._domain=domain||[];},get_func:function(method_name){var self=this;return function(){return self.call(method_name,_.toArray(arguments));};},query:function(fields){return new data.Query(this,fields);},domain:function(domain){if(!domain){return this._domain;}
return this._domain.concat(domain);},context:function(context){return new Context(session.user_context,this._context,context||{});},call:function(method,args,kwargs,options){args=args||[];kwargs=kwargs||{};if(!_.isArray(args)){kwargs=args;args=[];}
pyUtils.ensure_evaluated(args,kwargs);var call_kw='/web/dataset/call_kw/'+this.name+'/'+method;return session.rpc(call_kw,{model:this.name,method:method,args:args,kwargs:kwargs},options);},call_button:function(method,args){pyUtils.ensure_evaluated(args,{});var context=(args||[]).length>0?args.pop():{};return session.rpc('/web/dataset/call_button',{model:this.name,method:method,args:args||[],kwargs:{context:context},});},});return data;});;

/* /web/static/src/js/core/context.js defined in bundle 'web.assets_backend' */
odoo.define('web.Context',function(require){"use strict";var Class=require('web.Class');var pyUtils=require('web.py_utils');var Context=Class.extend({init:function(){this.__ref="compound_context";this.__contexts=[];this.__eval_context=null;var self=this;_.each(arguments,function(x){self.add(x);});},add:function(context){this.__contexts.push(context);return this;},eval:function(){return pyUtils.eval('context',this);},set_eval_context:function(evalContext){for(var key in evalContext){if(evalContext[key]instanceof moment){evalContext[key]=evalContext[key].toJSON();}}
this.__eval_context=evalContext;return this;},});return Context;});;

/* /web/static/src/js/core/data_comparison_utils.js defined in bundle 'web.assets_backend' */
odoo.define('web.dataComparisonUtils',function(require){"use strict";var fieldUtils=require('web.field_utils');var Class=require('web.Class');var DateClasses=Class.extend({init:function(dateSets){this.dateSets=dateSets;this.referenceIndex=null;for(var i=0;i<dateSets.length;i++){var dateSet=dateSets[i];if(dateSet.length&&this.referenceIndex===null){this.referenceIndex=i;}}},dateClass:function(datesetIndex,date){return this.dateSets[datesetIndex].indexOf(date);},dateClassMembers:function(dateClass){return _.uniq(_.compact(this.dateSets.map(function(dateSet){return dateSet[dateClass];})));},representative:function(dateClass,index){index=index===undefined?this.referenceIndex:index;return this.dateSets[index][dateClass];},});function computeVariation(value,comparisonValue){if(isNaN(value)||isNaN(comparisonValue)){return NaN;}
if(comparisonValue===0){if(value===0){return 0;}else if(value>0){return 1;}else{return-1;}}
return(value-comparisonValue)/Math.abs(comparisonValue);}
function renderVariation(variation,field,options){var className='o_variation';var value;if(!isNaN(variation)){if(variation>0){className+=' o_positive';}else if(variation<0){className+=' o_negative';}else{className+=' o_null';}
value=fieldUtils.format.percentage(variation,field,options);}else{value='-';}
return $('<div>',{class:className,html:value});}
function renderComparison($node,value,comparisonValue,variation,formatter,field,options){var $variation=renderVariation(variation,field,options);$node.append($variation);if(!isNaN(variation)){$node.append($('<div>',{class:'o_comparison'}).html(formatter(value,field,options)+' <span>vs</span> '+formatter(comparisonValue,field,options)));}}
return{computeVariation:computeVariation,DateClasses:DateClasses,renderComparison:renderComparison,renderVariation:renderVariation,};});;

/* /web/static/src/js/core/math_utils.js defined in bundle 'web.assets_backend' */
odoo.define('web.mathUtils',function(){"use strict";function _cartesian(){var args=Array.prototype.slice.call(arguments);if(args.length===0){return[undefined];}
var firstArray=args[0].map(function(elem){return[elem];});if(args.length===1){return firstArray;}
var productOfOtherArrays=_cartesian.apply(null,args.slice(1));var result=firstArray.reduce(function(acc,elem){return acc.concat(productOfOtherArrays.map(function(tuple){return elem.concat(tuple);}));},[]);return result;}
function cartesian(){var args=Array.prototype.slice.call(arguments);if(args.length===0){return[undefined];}else if(args.length===1){return args[0];}else{return _cartesian.apply(null,args);}}
function sections(array){var sections=[];for(var i=0;i<array.length+1;i++){sections.push(array.slice(0,i));}
return sections;}
return{cartesian:cartesian,sections:sections,};});;

/* /web/static/src/js/core/misc.js defined in bundle 'web.assets_backend' */
odoo.define('web.framework',function(require){"use strict";var core=require('web.core');var ajax=require('web.ajax');var Widget=require('web.Widget');var disableCrashManager=require('web.CrashManager').disable;var _t=core._t;var messages_by_seconds=function(){return[[0,_t("Loading...")],[20,_t("Still loading...")],[60,_t("Still loading...<br />Please be patient.")],[120,_t("Don't leave yet,<br />it's still loading...")],[300,_t("You may not believe it,<br />but the application is actually loading...")],[420,_t("Take a minute to get a coffee,<br />because it's loading...")],[3600,_t("Maybe you should consider reloading the application by pressing F5...")]];};var Throbber=Widget.extend({template:"Throbber",start:function(){this.start_time=new Date().getTime();this.act_message();},act_message:function(){var self=this;setTimeout(function(){if(self.isDestroyed())
return;var seconds=(new Date().getTime()-self.start_time)/1000;var mes;_.each(messages_by_seconds(),function(el){if(seconds>=el[0])
mes=el[1];});self.$(".oe_throbber_message").html(mes);self.act_message();},1000);},});if($.blockUI){$.blockUI.defaults.baseZ=1100;$.blockUI.defaults.message='<div class="openerp oe_blockui_spin_container" style="background-color: transparent;">';$.blockUI.defaults.css.border='0';$.blockUI.defaults.css["background-color"]='';}
function blockAccessKeys(){var elementWithAccessKey=[];elementWithAccessKey=document.querySelectorAll('[accesskey]');_.each(elementWithAccessKey,function(elem){elem.setAttribute("data-accesskey",elem.getAttribute('accesskey'));elem.removeAttribute('accesskey');});}
function unblockAccessKeys(){var elementWithDataAccessKey=[];elementWithDataAccessKey=document.querySelectorAll('[data-accesskey]');_.each(elementWithDataAccessKey,function(elem){elem.setAttribute('accesskey',elem.getAttribute('data-accesskey'));elem.removeAttribute('data-accesskey');});}
var throbbers=[];function blockUI(){var tmp=$.blockUI.apply($,arguments);var throbber=new Throbber();throbbers.push(throbber);throbber.appendTo($(".oe_blockui_spin_container"));$(document.body).addClass('o_ui_blocked');blockAccessKeys();return tmp;}
function unblockUI(){_.invoke(throbbers,'destroy');throbbers=[];$(document.body).removeClass('o_ui_blocked');unblockAccessKeys();return $.unblockUI.apply($,arguments);}
function redirect(url,wait){disableCrashManager();var load=function(){var old=""+window.location;var old_no_hash=old.split("#")[0];var url_no_hash=url.split("#")[0];location.assign(url);if(old_no_hash===url_no_hash){location.reload(true);}};var wait_server=function(){ajax.rpc("/web/webclient/version_info",{}).then(load).guardedCatch(function(){setTimeout(wait_server,250);});};if(wait){setTimeout(wait_server,1000);}else{load();}}
function Reload(parent,action){var params=action.params||{};var menu_id=params.menu_id||false;var l=window.location;var sobj=$.deparam(l.search.substr(1));if(params.url_search){sobj=_.extend(sobj,params.url_search);}
var search='?'+$.param(sobj);var hash=l.hash;if(menu_id){hash="#menu_id="+menu_id;}
var url=l.protocol+"//"+l.host+l.pathname+search+hash;core.bus.trigger('clear_cache');redirect(url,params.wait);}
core.action_registry.add("reload",Reload);function Home(parent,action){var url='/'+(window.location.search||'');redirect(url,action&&action.params&&action.params.wait);}
core.action_registry.add("home",Home);function login(){redirect('/web/login');}
core.action_registry.add("login",login);function logout(){redirect('/web/session/logout');return new Promise();}
core.action_registry.add("logout",logout);function displayNotification(parent,action){parent.displayNotification(action.params);}
core.action_registry.add("display_notification",displayNotification);function ReloadContext(parent,action){ajax.rpc("/web/session/get_session_info",{}).then(function(){Reload(parent,action);});}
core.action_registry.add("reload_context",ReloadContext);if(!document.contains){document.contains=function contains(node){if(!(0 in arguments)){throw new TypeError('1 argument is required');}
do{if(this===node){return true;}}while(node=node&&node.parentNode);return false;};}
return{blockUI:blockUI,unblockUI:unblockUI,redirect:redirect,};});;

/* /web/static/src/js/services/crash_manager_service.js defined in bundle 'web.assets_backend' */
odoo.define('crash_manager.service',function(require){'use strict';const core=require('web.core');const CrashManager=require('web.CrashManager').CrashManager;core.serviceRegistry.add('crash_manager',CrashManager);});;

/* /web/static/src/js/services/data_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.DataManager',function(require){"use strict";var config=require('web.config');var core=require('web.core');var rpc=require('web.rpc');var session=require('web.session');var utils=require('web.utils');return core.Class.extend({init:function(){this._init_cache();core.bus.on('clear_cache',this,this.invalidate.bind(this));},_init_cache:function(){this._cache={actions:{},fields_views:{},filters:{},views:{},};},invalidate:function(){session.invalidateCacheKey('load_menus');this._init_cache();},load_action:function(action_id,additional_context){var self=this;var key=this._gen_key(action_id,additional_context||{});if(config.isDebug('assets')||!this._cache.actions[key]){this._cache.actions[key]=rpc.query({route:"/web/action/load",params:{action_id:action_id,additional_context:additional_context,},}).then(function(action){self._cache.actions[key]=action.no_cache?null:self._cache.actions[key];return action;},this._invalidate.bind(this,this._cache.actions,key));}
return this._cache.actions[key].then(function(action){return $.extend(true,{},action);});},load_views:function(params,options){var self=this;var model=params.model;var context=params.context;var views_descr=params.views_descr;var key=this._gen_key(model,views_descr,options||{},context);if(config.isDebug('assets')||!this._cache.views[key]){var filters_key;if(options.load_filters){filters_key=this._gen_key(model,options.action_id);options.load_filters=!this._cache.filters[filters_key];}
this._cache.views[key]=rpc.query({args:[],kwargs:{views:views_descr,options:options,context:context,},model:model,method:'load_views',}).then(function(result){utils.deepFreeze(result.fields);_.each(views_descr,function(view_descr){var toolbar=options.toolbar&&view_descr[1]!=='search';var fv_key=self._gen_key(model,view_descr[0],view_descr[1],toolbar,context);var fvg=result.fields_views[view_descr[1]];fvg.viewFields=fvg.fields;fvg.fields=result.fields;self._cache.fields_views[fv_key]=Promise.resolve(fvg);});if(result.filters){self._cache.filters[filters_key]=Promise.resolve(result.filters);}
return result.fields_views;},this._invalidate.bind(this,this._cache.views,key));}
return this._cache.views[key];},load_filters:function(params){var key=this._gen_key(params.modelName,params.actionId);if(config.isDebug('assets')||!this._cache.filters[key]){this._cache.filters[key]=rpc.query({args:[params.modelName,params.actionId],kwargs:{context:params.context||{},},model:'ir.filters',method:'get_filters',}).guardedCatch(this._invalidate.bind(this,this._cache.filters,key));}
return this._cache.filters[key];},create_filter:function(filter){var self=this;return rpc.query({args:[filter],model:'ir.filters',method:'create_or_replace',}).then(function(filterId){var key=[filter.model_id,filter.action_id||false,].join(',');self._invalidate(self._cache.filters,key);return filterId;});},delete_filter:function(filterId){var self=this;return rpc.query({args:[filterId],model:'ir.filters',method:'unlink',}).then(function(){self._cache.filters={};});},_gen_key:function(){return _.map(Array.prototype.slice.call(arguments),function(arg){if(!arg){return false;}
return _.isObject(arg)?JSON.stringify(arg):arg;}).join(',');},_invalidate:function(cache,key){delete cache[key];},});});odoo.define('web.data_manager',function(require){"use strict";var DataManager=require('web.DataManager');var data_manager=new DataManager();return data_manager;});;

/* /web/static/src/js/services/report_service.js defined in bundle 'web.assets_backend' */
odoo.define('web.ReportService',function(require){"use strict";var AbstractService=require('web.AbstractService');var core=require('web.core');var ReportService=AbstractService.extend({dependencies:['ajax'],checkWkhtmltopdf:function(){if(!this.wkhtmltopdfState){this.wkhtmltopdfState=this._rpc({route:'/report/check_wkhtmltopdf'});}
return this.wkhtmltopdfState;},});core.serviceRegistry.add('report',ReportService);return ReportService;});;

/* /web/static/src/js/services/session.js defined in bundle 'web.assets_backend' */
odoo.define('web.session',function(require){"use strict";var Session=require('web.Session');var modules=odoo._modules;var session=new Session(undefined,undefined,{modules:modules,use_cors:false});session.is_bound=session.session_bind();return session;});;

/* /web/static/src/js/widgets/auto_complete.js defined in bundle 'web.assets_backend' */
odoo.define('web.AutoComplete',function(require){"use strict";var Widget=require('web.Widget');return Widget.extend({template:"SearchView.autocomplete",init:function(parent,options){this._super(parent);this.$input=options.$input;this.source=options.source;this.select=options.select;this.get_search_string=options.get_search_string;this.current_result=null;this.searching=true;this.search_string='';this.current_search=null;this._isInputComposing=false;},start:function(){var self=this;this.$input.on('compositionend',function(ev){self._isInputComposing=false;});this.$input.on('compositionstart',function(ev){self._isInputComposing=true;});this.$input.on('keyup',function(ev){if(ev.which===$.ui.keyCode.RIGHT&&!self._isInputComposing){self.searching=true;ev.preventDefault();return;}
if(ev.which===$.ui.keyCode.ENTER&&!self._isInputComposing){if(self.search_string.length){self.select_item(ev);}
return;}
self._updateSearch();});this.$input.on('input',function(ev){if(ev.originalEvent&&ev.originalEvent.inputType==='insertCompositionText'||ev.originalEvent.inputType==='insertFromPaste'){self._updateSearch();}});this.$input.on('keypress',function(ev){if(ev.which>31&&ev.which!==127){self.search_string=self.search_string+String.fromCharCode(ev.which);}
if(self.search_string.length){self.searching=true;var search_string=self.search_string;self.initiate_search(search_string);}else{self.close();}});this.$input.on('keydown',function(ev){if(self._isInputComposing){return;}
switch(ev.which){case $.ui.keyCode.ENTER:case $.ui.keyCode.TAB:if(self.search_string.length){self.select_item(ev);}
break;case $.ui.keyCode.DOWN:self.move('down');self.searching=false;ev.preventDefault();break;case $.ui.keyCode.UP:self.move('up');self.searching=false;ev.preventDefault();break;case $.ui.keyCode.RIGHT:if(self.$input[0].selectionStart<self.search_string.length){ev.stopPropagation();return;}
self.searching=false;var current=self.current_result;if(current&&current.expand&&!current.expanded){self.expand();self.searching=true;ev.stopPropagation();}
ev.preventDefault();break;case $.ui.keyCode.LEFT:if(self.$input[0].selectionStart>0){ev.stopPropagation();}
break;case $.ui.keyCode.ESCAPE:self.close();self.searching=false;break;}});},initiate_search:function(query){if(query===this.search_string&&query!==this.current_search){this.search(query);}},search:function(query){var self=this;this.current_search=query;this.source({term:query},function(results){if(results.length){self.render_search_results(results);self.focus_element(self.$('li:first-child'));}else{self.close();}});},render_search_results:function(results){var self=this;var $list=this.$el;$list.empty();results.forEach(function(result){var $item=self.make_list_item(result).appendTo($list);result.$el=$item;});this.el.onmousemove=function(ev){self.$('li').each(function(index,li){li.onmouseenter=self.focus_element.bind(self,$(li));});var targetFocus=ev.target.tagName==='LI'?ev.target:ev.target.closest('li');self.focus_element($(targetFocus));self.el.onmousemove=null;};this.show();},make_list_item:function(result){var self=this;var $li=$('<li>').mousedown(function(ev){if(ev.button===0){self.select(ev,{item:{facet:result.facet}});self.close();}}).data('result',result);if(result.expand){var $expand=$('<a class="o-expand" href="#">').appendTo($li);$expand.mousedown(function(ev){ev.stopPropagation();ev.preventDefault();if(result.expanded){self.fold();}else{self.expand();}});$expand.click(function(ev){ev.preventDefault();});result.expanded=false;}
if(result.indent)$li.addClass('o-indent');$li.append($('<a href="#">').html(result.label));return $li;},expand:function(){var self=this;var current_result=this.current_result;current_result.expand(this.get_search_string()).then(function(results){(results||[{label:'(no result)'}]).reverse().forEach(function(result){result.indent=true;var $li=self.make_list_item(result);current_result.$el.after($li);});self.current_result.expanded=true;self.current_result.$el.find('a.o-expand').removeClass('o-expand').addClass('o-expanded');});},fold:function(){var $next=this.current_result.$el.next();while($next.hasClass('o-indent')){$next.remove();$next=this.current_result.$el.next();}
this.current_result.expanded=false;this.current_result.$el.find('a.o-expanded').removeClass('o-expanded').addClass('o-expand');},focus_element:function($li){this.$('li').removeClass('o-selection-focus');$li.addClass('o-selection-focus');this.current_result=$li.data('result');},select_item:function(ev){this.select(ev,{item:{facet:this.current_result.facet}});this.close();},show:function(){this.$el.show();},close:function(){this.current_search=null;this.search_string='';this.searching=true;this.$el.hide();},move:function(direction){var $next;if(direction==='down'){$next=this.$('li.o-selection-focus').next();if(!$next.length)$next=this.$('li').first();}else{$next=this.$('li.o-selection-focus').prev();if(!$next.length)$next=this.$('li').last();}
this.focus_element($next);},is_expandable:function(){return!!this.$('.o-selection-focus .o-expand').length;},is_expanded:function(){return this.$el[0].style.display==="block";},_updateSearch:function(){var search_string=this.get_search_string();if(this.search_string!==search_string){if(search_string.length){this.search_string=search_string;this.initiate_search(search_string);}else{this.close();}}},});});;

/* /web/static/src/js/widgets/change_password.js defined in bundle 'web.assets_backend' */
odoo.define('web.ChangePassword',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var core=require('web.core');var Dialog=require('web.Dialog');var web_client=require('web.web_client');var _t=core._t;var ChangePassword=AbstractAction.extend({template:"ChangePassword",start:function(){var self=this;web_client.set_title(_t("Change Password"));var $button=self.$('.oe_form_button');$button.appendTo(this.getParent().$footer);$button.eq(1).click(function(){self.$el.parents('.modal').modal('hide');});$button.eq(0).click(function(){self._rpc({route:'/web/session/change_password',params:{fields:$('form[name=change_password_form]').serializeArray()}}).then(function(result){if(result.error){self._display_error(result);}else{self.do_action('logout');}});});},_display_error:function(error){return new Dialog(this,{size:'medium',title:error.title,$content:$('<div>').html(error.error)}).open();},});core.action_registry.add("change_password",ChangePassword);return ChangePassword;});;

/* /web/static/src/js/tools/test_menus_loader.js defined in bundle 'web.assets_backend' */
odoo.define('web.clickEverywhere',function(require){"use strict";var ajax=require('web.ajax');function startClickEverywhere(menu_id){ajax.loadJS('web/static/src/js/tools/test_menus.js').then(function(){clickEverywhere(menu_id);});}
return startClickEverywhere;});;

/* /web/static/src/js/tools/debug_manager_backend.js defined in bundle 'web.assets_backend' */
odoo.define('web.DebugManager.Backend',function(require){"use strict";var ActionManager=require('web.ActionManager');var DebugManager=require('web.DebugManager');var dialogs=require('web.view_dialogs');var startClickEverywhere=require('web.clickEverywhere');var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var field_utils=require('web.field_utils');var SystrayMenu=require('web.SystrayMenu');var utils=require('web.utils');var WebClient=require('web.WebClient');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;DebugManager.include({requests_clear:function(){if(!this._events){return;}
this._events=[];this.trigger('update-stats',this._events);},show_timelines:function(){if(this._overlay){this._overlay.destroy();this._overlay=null;return;}
this._overlay=new RequestsOverlay(this);this._overlay.appendTo(document.body);},update:function(tag,descriptor){return this._super().then(function(){this.$dropdown.find(".o_debug_split_assets").before(QWeb.render('WebClient.DebugManager.Backend',{manager:this,}));}.bind(this));},select_view:function(){var self=this;new dialogs.SelectCreateDialog(this,{res_model:'ir.ui.view',title:_t('Select a view'),disable_multiple_selection:true,domain:[['type','!=','qweb'],['type','!=','search']],on_selected:function(records){self._rpc({model:'ir.ui.view',method:'search_read',domain:[['id','=',records[0].id]],fields:['name','model','type'],limit:1,}).then(function(views){var view=views[0];view.type=view.type==='tree'?'list':view.type;self.do_action({type:'ir.actions.act_window',name:view.name,res_model:view.model,views:[[view.id,view.type]]});});}}).open();},perform_js_tests:function(){this.do_action({name:_t("JS Tests"),target:'new',type:'ir.actions.act_url',url:'/web/tests?mod=*'});},perform_js_mobile_tests:function(){this.do_action({name:_t("JS Mobile Tests"),target:'new',type:'ir.actions.act_url',url:'/web/tests/mobile?mod=*'});},perform_click_everywhere_test:function(){var $homeMenu=$("nav.o_main_navbar > a.o_menu_toggle.fa-th");$homeMenu.click();startClickEverywhere();},});DebugManager.include({update:function(tag,descriptor){if(tag==='action'){this._action=descriptor;}
return this._super().then(function(){this.$dropdown.find(".o_debug_leave_section").before(QWeb.render('WebClient.DebugManager.Action',{manager:this,action:this._action}));}.bind(this));},edit:function(params,evt){this.do_action({res_model:params.model,res_id:params.id,name:evt.target.text,type:'ir.actions.act_window',views:[[false,'form']],view_mode:'form',target:'new',flags:{action_buttons:true,headless:true}});},get_view_fields:function(){var model=this._action.res_model,self=this;this._rpc({model:'ir.model',method:'search',args:[[['model','=',model]]]}).then(function(ids){self.do_action({res_model:'ir.model.fields',name:_t('View Fields'),views:[[false,'list'],[false,'form']],domain:[['model_id','=',model]],type:'ir.actions.act_window',context:{'default_model_id':ids[0]}});});},manage_filters:function(){this.do_action({res_model:'ir.filters',name:_t('Manage Filters'),views:[[false,'list'],[false,'form']],type:'ir.actions.act_window',context:{search_default_my_filters:true,search_default_model_id:this._action.res_model}});},translate:function(){this._rpc({model:'ir.translation',method:'get_technical_translations',args:[this._action.res_model],}).then(this.do_action);}});DebugManager.include({start:function(){this._can_edit_views=false;return Promise.all([this._super(),this._rpc({model:'ir.ui.view',method:'check_access_rights',kwargs:{operation:'write',raise_exception:false},}).then(function(ar){this._can_edit_views=ar;}.bind(this))]);},update:function(tag,descriptor,widget){if(tag==='action'||tag==='view'){this._controller=widget;}
return this._super(tag,descriptor).then(function(){this.$dropdown.find(".o_debug_leave_section").before(QWeb.render('WebClient.DebugManager.View',{action:this._action,can_edit:this._can_edit_views,controller:this._controller,controlPanelView:this._controller&&this._controller._controlPanel,manager:this,view:this._controller&&_.findWhere(this._action.views,{type:this._controller.viewType,}),}));}.bind(this));},get_attachments:function(){var selectedIDs=this._controller.getSelectedIds();if(!selectedIDs.length){console.warn(_t("No attachment available"));return;}
this.do_action({res_model:'ir.attachment',name:_t('Manage Attachments'),views:[[false,'list'],[false,'form']],type:'ir.actions.act_window',domain:[['res_model','=',this._action.res_model],['res_id','=',selectedIDs[0]]],context:{default_res_model:this._action.res_model,default_res_id:selectedIDs[0],},});},get_metadata:function(){var self=this;var selectedIDs=this._controller.getSelectedIds();if(!selectedIDs.length){console.warn(_t("No metadata available"));return;}
this._rpc({model:this._action.res_model,method:'get_metadata',args:[selectedIDs],}).then(function(result){var metadata=result[0];metadata.creator=field_utils.format.many2one(metadata.create_uid);metadata.lastModifiedBy=field_utils.format.many2one(metadata.write_uid);var createDate=field_utils.parse.datetime(metadata.create_date);metadata.create_date=field_utils.format.datetime(createDate);var modificationDate=field_utils.parse.datetime(metadata.write_date);metadata.write_date=field_utils.format.datetime(modificationDate);var dialog=new Dialog(this,{title:_.str.sprintf(_t("Metadata (%s)"),self._action.res_model),size:'medium',$content:QWeb.render('WebClient.DebugViewLog',{perm:metadata,})});dialog.open().opened(function(){dialog.$el.on('click','a[data-action="toggle_noupdate"]',function(ev){ev.preventDefault();self._rpc({model:'ir.model.data',method:'toggle_noupdate',args:[self._action.res_model,metadata.id]}).then(function(res){dialog.close();self.get_metadata();})});})});},set_defaults:function(){var self=this;var display=function(fieldInfo,value){var displayed=value;if(value&&fieldInfo.type==='many2one'){displayed=value.data.display_name;value=value.data.id;}else if(value&&fieldInfo.type==='selection'){displayed=_.find(fieldInfo.selection,function(option){return option[0]===value;})[1];}
return[value,displayed];};var renderer=this._controller.renderer;var state=renderer.state;var fields=state.fields;var fieldsInfo=state.fieldsInfo.form;var fieldNamesInView=state.getFieldNames();var fieldNamesOnlyOnView=['message_attachment_count'];var fieldsValues=state.data;var modifierDatas={};_.each(fieldNamesInView,function(fieldName){modifierDatas[fieldName]=_.find(renderer.allModifiersData,function(modifierdata){return modifierdata.node.attrs.name===fieldName;});});this.fields=_.chain(fieldNamesInView).difference(fieldNamesOnlyOnView).map(function(fieldName){var modifierData=modifierDatas[fieldName];var invisibleOrReadOnly;if(modifierData){var evaluatedModifiers=modifierData.evaluatedModifiers[state.id];invisibleOrReadOnly=evaluatedModifiers.invisible||evaluatedModifiers.readonly;}
var fieldInfo=fields[fieldName];var valueDisplayed=display(fieldInfo,fieldsValues[fieldName]);var value=valueDisplayed[0];var displayed=valueDisplayed[1];if(!value||invisibleOrReadOnly||fieldInfo.type==='one2many'||fieldInfo.type==='many2many'||fieldInfo.type==='binary'||fieldsInfo[fieldName].options.isPassword||!_.isEmpty(fieldInfo.depends)){return false;}
return{name:fieldName,string:fieldInfo.string,value:value,displayed:displayed,};}).compact().sortBy(function(field){return field.string;}).value();var conditions=_.chain(fieldNamesInView).filter(function(fieldName){var fieldInfo=fields[fieldName];return fieldInfo.change_default;}).map(function(fieldName){var fieldInfo=fields[fieldName];var valueDisplayed=display(fieldInfo,fieldsValues[fieldName]);var value=valueDisplayed[0];var displayed=valueDisplayed[1];return{name:fieldName,string:fieldInfo.string,value:value,displayed:displayed,};}).value();var d=new Dialog(this,{title:_t("Set Default"),buttons:[{text:_t("Close"),close:true},{text:_t("Save default"),click:function(){var $defaults=d.$el.find('#formview_default_fields');var fieldToSet=$defaults.val();if(!fieldToSet){$defaults.parent().addClass('o_form_invalid');return;}
var selfUser=d.$el.find('#formview_default_self').is(':checked');var condition=d.$el.find('#formview_default_conditions').val();var value=_.find(self.fields,function(field){return field.name===fieldToSet;}).value;self._rpc({model:'ir.default',method:'set',args:[self._action.res_model,fieldToSet,value,selfUser,true,condition||false,],}).then(function(){d.close();});}}]});d.args={fields:this.fields,conditions:conditions,};d.template='FormView.set_default';d.open();},fvg:function(){var self=this;var dialog=new Dialog(this,{title:_t("Fields View Get")});dialog.opened().then(function(){$('<pre>').text(utils.json_node_to_xml(self._controller.renderer.arch,true)).appendTo(dialog.$el);});dialog.open();},});function make_context(width,height,fn){var canvas=document.createElement('canvas');canvas.width=width;canvas.height=height;canvas.style.position='relative';var ctx=canvas.getContext('2d');ctx.imageSmoothingEnabled=false;ctx.mozImageSmoothingEnabled=false;ctx.oImageSmoothingEnabled=false;ctx.webkitImageSmoothingEnabled=false;fn&&fn(ctx);return ctx;}
var RequestsOverlay=Widget.extend({template:'WebClient.DebugManager.RequestsOverlay',TRACKS:8,TRACK_WIDTH:9,events:{mousemove:function(e){this.$tooltip.hide();}},init:function(){this._super.apply(this,arguments);this._render=_.throttle(this._render.bind(this),1000/15,{leading:false});},start:function(){var _super=this._super();this.$tooltip=this.$('div.o_debug_tooltip');this.getParent().on('update-stats',this,this._render);this._render();return _super;},tooltip:function(text,start,end,x,y){var top=y-this.el.offsetTop+this.el.scrollTop+1;var left=x-this.el.offsetLeft+this.el.scrollLeft+1;this.$tooltip.css({top:top,left:left}).show()[0].innerHTML=['<p>',text,' (',(end-start),'ms)','</p>'].join('');},_render:function(){var $summary=this.$('header'),w=$summary[0].clientWidth,$requests=this.$('.o_debug_requests');$summary.find('canvas').attr('width',w);var tracks=document.getElementById('o_debug_requests_summary');_.invoke(this.getChildren(),'destroy');var requests=this.getParent()._events;var bounds=this._get_bounds(requests);var scale=w/(bounds.high-bounds.low);var track_ends=_(this.TRACKS).times(_.constant(-Infinity));var ctx=tracks.getContext('2d');ctx.lineWidth=this.TRACK_WIDTH;for(var i=0;i<requests.length;i++){var request=requests[i];var rstart=Math.floor(request[0][3]*1e3);var rend=Math.ceil(request[request.length-1][3]*1e3);for(var track=0;track<track_ends.length;++track){if(track_ends[track]<rstart){break;}}
if(track>=track_ends.length){console.warn("could not find an empty summary track");continue;}
track_ends[track]=rend;ctx.save();ctx.translate(Math.floor((rstart-bounds.low)*scale),track*(this.TRACK_WIDTH+1));this._draw_request(request,ctx,0,scale);ctx.restore();new RequestDetails(this,request,scale).appendTo($requests);}},_draw_request:function(request,to_context,step,hscale,handle_event){var surfaces={request:make_context(to_context.canvas.width,to_context.canvas.height,function(ctx){ctx.strokeStyle='blue';ctx.fillStyle='#88f';ctx.lineJoin='round';ctx.lineWidth=1;}),sql:make_context(to_context.canvas.width,to_context.canvas.height,function(ctx){ctx.strokeStyle='red';ctx.fillStyle='#f88';ctx.lineJoin='round';ctx.lineWidth=1;}),template:make_context(to_context.canvas.width,to_context.canvas.height,function(ctx){ctx.strokeStyle='green';ctx.fillStyle='#8f8';ctx.lineJoin='round';ctx.lineWidth=1;})};var stacks={},start=Math.floor(request[0][3]*1e3*hscale);var event_idx=0;var rect_width=to_context.lineWidth;for(var i=0;i<request.length;i++){var type,m,event=request[i];var tag=event[0],timestamp=Math.floor(event[3]*1e3*hscale)-start;if(m=/(\w+)-start/.exec(tag)){type=m[1];if(!(type in stacks)){stacks[type]=[];}
handle_event&&handle_event(event_idx,timestamp,event);stacks[type].push({timestamp:timestamp,idx:event_idx++});}else if(m=/(\w+)-end/.exec(tag)){type=m[1];var stack=stacks[type];var estart=stack.pop(),duration=Math.ceil(timestamp-estart.timestamp);handle_event&&handle_event(estart.idx,timestamp,event);var surface=surfaces[type];if(!surface){continue;}
var y=step*estart.idx;surface.rect(estart.timestamp+0.5,y+0.5,duration||1,rect_width);}}
var keys=['request','template','sql'];for(var j=0;j<keys.length;++j){var ctx=surfaces[keys[j]];ctx.fill();ctx.stroke();to_context.drawImage(ctx.canvas,0,0);}},_get_bounds:function(requests){var low=+Infinity;var high=-+Infinity;for(var i=0;i<requests.length;i++){var request=requests[i];for(var j=0;j<request.length;j++){var event=request[j];var timestamp=event[3];low=Math.min(low,timestamp);high=Math.max(high,timestamp);}}
return{low:Math.floor(low*1e3),high:Math.ceil(high*1e3)};}});var RequestDetails=Widget.extend({events:{click:function(){this._open=!this._open;this.render();},'mousemove canvas':function(e){e.stopPropagation();var y=e.y||e.offsetY||e.layerY;if(!y){return;}
var event=this._payloads[Math.floor(y/this._REQ_HEIGHT)];if(!event){return;}
this.getParent().tooltip(event.payload,event.start,event.stop,e.clientX,e.clientY);}},init:function(parent,request,scale){this._super.apply(this,arguments);this._request=request;this._open=false;this._scale=scale;this._REQ_HEIGHT=20;},start:function(){this.el.style.borderBottom='1px solid black';this.render();return this._super();},render:function(){var request_cell_height=this._REQ_HEIGHT,TITLE_WIDTH=200;var request=this._request;var req_start=request[0][3]*1e3;var req_duration=request[request.length-1][3]*1e3-req_start;var height=request_cell_height*(this._open?request.length/2:1);var cell_center=request_cell_height/2;var ctx=make_context(210+Math.ceil(req_duration*this._scale),height,function(ctx){ctx.lineWidth=cell_center;});this.$el.empty().append(ctx.canvas);var payloads=this._payloads=[];var text_ctx=make_context(TITLE_WIDTH,height,function(ctx){ctx.font='12px sans-serif';ctx.textAlign='right';ctx.textBaseline='middle';ctx.translate(0,cell_center);});ctx.save();ctx.translate(TITLE_WIDTH+10,((request_cell_height/4)|0));this.getParent()._draw_request(request,ctx,this._open?request_cell_height:0,this._scale,function(idx,timestamp,event){if(/-start$/g.test(event[0])){payloads.push({payload:event[2],start:timestamp,stop:null});var title=event[2];title=title.replace(/\s+$/,'');title=title.length<=50?title:('…'+title.slice(-49));while(text_ctx.measureText(title).width>200){title='…'+title.slice(2);}
text_ctx.fillText(title,TITLE_WIDTH,request_cell_height*idx);}else if(/-end$/g.test(event[0])){payloads[idx].stop=timestamp;}});ctx.restore();ctx.drawImage(text_ctx.canvas,0,0);}});if(config.isDebug()){SystrayMenu.Items.push(DebugManager);WebClient.include({current_action_updated:function(action,controller){this._super.apply(this,arguments);this.update_debug_manager(action,controller);},update_debug_manager:function(action,controller){var debugManager=_.find(this.menu.systray_menu.widgets,function(item){return item instanceof DebugManager;});debugManager.update('action',action,controller&&controller.widget);}});ActionManager.include({getCurrentActionInDialog:function(){if(this.currentDialogController){return this.actions[this.currentDialogController.actionID];}
return null;},getCurrentControllerInDialog:function(){return this.currentDialogController;},});Dialog.include({open:function(){var self=this;this.opened(function(){setTimeout(function(){var parent=self.getParent();if(parent instanceof ActionManager){var action=parent.getCurrentActionInDialog();if(action){var controller=parent.getCurrentControllerInDialog();self.debugManager=new DebugManager(self);var $header=self.$modal.find('.modal-header:first');return self.debugManager.prependTo($header).then(function(){self.debugManager.update('action',action,controller.widget);});}}},0);});return this._super.apply(this,arguments);},});}
return DebugManager;});;

/* /web/static/src/js/tools/tools.js defined in bundle 'web.assets_backend' */
odoo.define('web.tools',function(require){"use strict";function deprecated(fn,message){return function(){console.warn(message||(fn.name+' is deprecated.'));return fn.apply(this,arguments);};}
return{deprecated:deprecated,};});;

/* /web/static/src/js/widgets/data_export.js defined in bundle 'web.assets_backend' */
odoo.define('web.DataExport',function(require){"use strict";var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var data=require('web.data');var framework=require('web.framework');var pyUtils=require('web.py_utils');var QWeb=core.qweb;var _t=core._t;var DataExport=Dialog.extend({template:'ExportDialog',events:{'change .o_exported_lists_select':'_onChangeExportList','change .o_import_compat input':'_onChangeCompatibleInput','click .o_add_field':'_onClickAddField','click .o_delete_exported_list':'_onClickDeleteExportListBtn','click .o_expand':'_onClickExpand','click .o_remove_field':'_onClickRemoveField','click .o_save_list .o_save_list_btn':'_onClickSaveListBtn','click .o_save_list .o_cancel_list_btn':'_resetTemplateField','click .o_export_tree_item':'_onClickTreeItem','dblclick .o_export_tree_item:not(.haschild)':'_onDblclickTreeItem','keydown .o_export_tree_item':'_onKeydownTreeItem','keydown .o_save_list_name':'_onKeydownSaveList','input .o_export_search_input':'_onSearchInput',},init:function(parent,record,defaultExportFields,groupedBy,activeDomain,idsToExport){var options={title:_t("Export Data"),buttons:[{text:_t("Export"),click:this._onExportData,classes:'btn-primary'},{text:_t("Close"),close:true},],};this._super(parent,options);this.records={};this.record=record;this.defaultExportFields=defaultExportFields;this.groupby=groupedBy;this.exports=new data.DataSetSearch(this,'ir.exports',this.record.getContext());this.rowIndex=0;this.rowIndexLevel=0;this.isCompatibleMode=false;this.domain=activeDomain||this.record.domain;this.idsToExport=activeDomain?false:idsToExport;},start:function(){var self=this;var proms=[this._super.apply(this,arguments)];this.$modal.find('.modal-content').css('height','100%');this.$fieldsList=this.$('.o_fields_list');proms.push(this._rpc({route:'/web/export/formats'}).then(doSetupExportFormats));proms.push(this._onChangeCompatibleInput().then(function(){_.each(self.defaultExportFields,function(field){var record=self.records[field];self._addField(record.id,record.string);});}));proms.push(this._showExportsList());this.opened().then(function(){self.$('.o_fields_list').sortable({axis:'y',handle:'.o_short_field',forcePlaceholderSize:true,placeholder:'o-field-placeholder',update:self.proxy('_resetTemplateField'),});});return Promise.all(proms);function doSetupExportFormats(formats){var $fmts=self.$('.o_export_format');_.each(formats,function(format){var $radio=$('<input/>',{type:'radio',value:format.tag,name:'o_export_format_name',class:'form-check-input',id:'o_radio'+format.label});var $label=$('<label/>',{html:format.label,class:'form-check-label',for:'o_radio'+format.label});if(format.error){$radio.prop('disabled',true);$label.html(_.str.sprintf("%s — %s",format.label,format.error));}
$fmts.append($("<div class='radio form-check form-check-inline pl-4'></div>").append($radio,$label));});self.$exportFormatInputs=$fmts.find('input');self.$exportFormatInputs.filter(':enabled').first().prop('checked',true);}},export(){let exportedFields=this.defaultExportFields.map(field=>({name:field,label:this.record.fields[field].string,store:this.record.fields[field].store,type:this.record.fields[field].type,}));this._exportData(exportedFields,'xlsx',false);},_addField:function(fieldID,label){var $fieldList=this.$('.o_fields_list');if(!$fieldList.find(".o_export_field[data-field_id='"+fieldID+"']").length){$fieldList.append($('<li>',{'class':'o_export_field','data-field_id':fieldID}).append($('<span>',{'class':"fa fa-arrows o_short_field mx-1"}),label,$('<span>',{'class':'fa fa-trash m-1 pull-right o_remove_field','title':_t("Remove field")})));}},_exportData(exportedFields,exportFormat,idsToExport){if(_.isEmpty(exportedFields)){Dialog.alert(this,_t("Please select fields to export..."));return;}
if(this.isCompatibleMode){exportedFields.unshift({name:'id',label:_t('External ID')});}
framework.blockUI();this.getSession().get_file({url:'/web/export/'+exportFormat,data:{data:JSON.stringify({model:this.record.model,fields:exportedFields,ids:idsToExport,domain:this.domain,groupby:this.groupby,context:pyUtils.eval('contexts',[this.record.getContext()]),import_compat:this.isCompatibleMode,})},complete:framework.unblockUI,error:(error)=>this.call('crash_manager','rpc_error',error),});},_getFields:function(){var exportFields=this.$('.o_export_field').map(function(){return $(this).data('field_id');}).get();if(exportFields.length===0){Dialog.alert(this,_t("Please select fields to save export list..."));}
return exportFields;},_onExpandAction:function(record){var self=this;if(!record.children){return;}
var model=record.params.model;var prefix=record.params.prefix;var name=record.params.name;var excludeFields=[];if(record.relation_field){excludeFields.push(record.relation_field);}
if(!record.loaded){this._rpc({route:'/web/export/get_fields',params:{model:model,prefix:prefix,parent_name:name,import_compat:this.isCompatibleMode,parent_field_type:record.field_type,parent_field:record.params.parent_field,exclude:excludeFields,},}).then(function(results){record.loaded=true;self._onShowData(results,record.id);});}else{this._showContent(record.id);}},_onShowData:function(records,expansion){var self=this;if(expansion){this.$('.o_export_tree_item[data-id="'+expansion+'"]').addClass('show').find('.o_expand_parent').toggleClass('fa-chevron-right fa-chevron-down').next().after(QWeb.render('Export.TreeItems',{fields:records,debug:config.isDebug()}));}else{this.$('.o_left_field_panel').empty().append($('<div/>').addClass('o_field_tree_structure').append(QWeb.render('Export.TreeItems',{fields:records,debug:config.isDebug()})));}
_.extend(this.records,_.object(_.pluck(records,'id'),records));this.$records=this.$('.o_export_tree_item');this.$records.each(function(i,el){var $el=$(el);$el.find('.o_tree_column').first().toggleClass('o_required',!!self.records[$el.data('id')].required);});},_addNewTemplate:function(){this.$('.o_exported_lists').addClass('d-none');this.$(".o_save_list").show().find(".o_save_list_name").val("").focus();},_resetTemplateField:function(){this.$('.o_exported_lists_select').val("");this.$('.o_delete_exported_list').addClass('d-none');this.$('.o_exported_lists').removeClass('d-none');this.$(".o_save_list").hide().find(".o_save_list_name").val("");},_showContent:function(fieldID){var $item=this.$('.o_export_tree_item[data-id="'+fieldID+'"]');$item.toggleClass('show');var isOpen=$item.hasClass('show');$item.children('.o_expand_parent').toggleClass('fa-chevron-down',!!isOpen).toggleClass('fa-chevron-right',!isOpen);var $childField=$item.find('.o_export_tree_item');var childLength=(fieldID.split('/')).length+1;for(var i=0;i<$childField.length;i++){var $child=$childField.eq(i);if(!isOpen){$child.hide();}else if(childLength===$childField.eq(i).data('id').split('/').length){if($child.hasClass('show')){$child.removeClass('show');$child.children('.o_expand_parent').removeClass('fa-chevron-down').addClass('fa-chevron-right');}
$child.show();}}},_showExportsList:function(){var self=this;if(this.$('.o_exported_lists_select').is(':hidden')){this.$('.o_exported_lists').show();return Promise.resolve();}
return this._rpc({model:'ir.exports',method:'search_read',fields:['name'],domain:[['resource','=',this.record.model]]}).then(function(exportList){self.$('.o_exported_lists').append(QWeb.render('Export.SavedList',{existing_exports:exportList,}));});},_onChangeExportList:function(){var self=this;var exportID=this.$('.o_exported_lists_select option:selected').val();this.$('.o_delete_exported_list').toggleClass('d-none',!exportID);if(exportID&&exportID!=='new_template'){this.$('.o_fields_list').empty();this._rpc({route:'/web/export/namelist',params:{model:this.record.model,export_id:parseInt(exportID,10),},}).then(function(fieldList){_.each(fieldList,function(field){self._addField(field.name,field.label);});});}else if(exportID==='new_template'){self._addNewTemplate();}},_onChangeCompatibleInput:function(){var self=this;this.isCompatibleMode=this.$('.o_import_compat input').is(':checked');this.$('.o_field_tree_structure').remove();this._resetTemplateField();return this._rpc({route:'/web/export/get_fields',params:{model:this.record.model,import_compat:this.isCompatibleMode,},}).then(function(records){var compatibleFields=_.map(records,function(record){return record.id;});self._onShowData(records);self.$('.o_fields_list').empty();_.chain(self.$fieldsList.find('.o_export_field')).map(function(field){return $(field).data('field_id');}).union(self.defaultExportFields).intersection(compatibleFields).each(function(field){var record=_.find(records,function(rec){return rec.id===field;});self._addField(record.id,record.string);});self.$('#o-export-search-filter').val('');});},_onClickAddField:function(ev){ev.stopPropagation();var $field=$(ev.currentTarget);this._resetTemplateField();this._addField($field.closest('.o_export_tree_item').data('id'),$field.closest('.o_tree_column').text());},_onClickDeleteExportListBtn:function(){var self=this;var selectExp=this.$('.o_exported_lists_select option:selected');var options={confirm_callback:function(){if(selectExp.val()){self.exports.unlink([parseInt(selectExp.val(),10)]);selectExp.remove();if(self.$('.o_exported_lists_select option').length<=1){self.$('.o_exported_lists').hide();}}}};Dialog.confirm(this,_t("Do you really want to delete this export template?"),options);},_onClickExpand:function(ev){this._onExpandAction(this.records[$(ev.target).closest('.o_export_tree_item').data('id')]);},_onClickRemoveField:function(ev){$(ev.currentTarget).closest('.o_export_field').remove();this._resetTemplateField();},_onClickSaveListBtn:function(){var self=this;var $saveList=this.$('.o_save_list');var value=$saveList.find('input').val();if(!value){Dialog.alert(this,_t("Please enter save field list name"));return;}
var fields=this._getFields();if(fields.length===0){return;}
$saveList.hide();this.exports.create({name:value,resource:this.record.model,export_fields:_.map(fields,function(field){return[0,0,{name:field}];}),}).then(function(exportListID){if(!exportListID){return;}
var $select=self.$('.o_exported_lists_select');if($select.length===0||$select.is(':hidden')){self._showExportsList();}
$select.append(new Option(value,exportListID));self.$('.o_exported_lists').removeClass('d-none');$select.val(exportListID);});},_onClickTreeItem:function(ev){ev.stopPropagation();var $elem=$(ev.currentTarget);var rowIndex=$elem.prevAll('.o_export_tree_item').length;var rowIndexLevel=$elem.parents('.o_export_tree_item').length;if(ev.shiftKey&&rowIndexLevel===this.rowIndexLevel){var minIndex=Math.min(rowIndex,this.rowIndex);var maxIndex=Math.max(rowIndex,this.rowIndex);this.$records.filter(function(){return($elem.parent()[0]===$(this).parent()[0]);}).slice(minIndex,maxIndex+1).addClass('o_selected').filter(':not(:last)').each(processChildren);}
this.rowIndex=rowIndex;this.rowIndexLevel=rowIndexLevel;if(ev.ctrlKey){$elem.toggleClass('o_selected').focus();}else if(ev.shiftKey){$elem.addClass('o_selected').focus();}else{this.$('.o_selected').removeClass('o_selected');$elem.addClass('o_selected').focus();}
function processChildren(){var $child=$(this);if($child.hasClass('show')){$child.children('.o_export_tree_item').addClass('o_selected').each(processChildren);}}},_onExportData(){let exportedFields=this.$('.o_export_field').map((i,field)=>({name:$(field).data('field_id'),label:field.textContent,})).get();let exportFormat=this.$exportFormatInputs.filter(':checked').val();this._exportData(exportedFields,exportFormat,this.idsToExport);},_onDblclickTreeItem:function(ev){var self=this;this._resetTemplateField();function addElement(el){self._addField(el.getAttribute('data-id'),el.querySelector('.o_tree_column').textContent);}
var target=ev.currentTarget;target.classList.remove('o_selected');[].reverse.call($(target).parents('.o_export_tree_item')).each(function(){addElement(this);});addElement(target);},_onKeydownSaveList:function(ev){if(ev.keyCode===$.ui.keyCode.ENTER){this._onClickSaveListBtn();}},_onKeydownTreeItem:function(ev){ev.stopPropagation();var $el=$(ev.currentTarget);var record=this.records[$el.data('id')];switch(ev.keyCode||ev.which){case $.ui.keyCode.LEFT:if($el.hasClass('show')){this._onExpandAction(record);}
break;case $.ui.keyCode.RIGHT:if(!$el.hasClass('show')){this._onExpandAction(record);}
break;case $.ui.keyCode.UP:var $prev=$el.prev('.o_export_tree_item');if($prev.length===1){while($prev.hasClass('show')){$prev=$prev.children('.o_export_tree_item').last();}}else{$prev=$el.parent('.o_export_tree_item');if($prev.length===0){break;}}
$el.removeClass('o_selected').blur();$prev.addClass("o_selected").focus();break;case $.ui.keyCode.DOWN:var $next;if($el.hasClass('show')){$next=$el.children('.o_export_tree_item').first();}else{$next=$el.next('.o_export_tree_item');if($next.length===0){$next=$el.parent('.o_export_tree_item').next('.o_export_tree_item');if($next.length===0){break;}}}
$el.removeClass('o_selected').blur();$next.addClass('o_selected').focus();break;}},_onSearchInput:function(ev){var searchText=$(ev.currentTarget).val().trim().toUpperCase();if(!searchText){this.$('.o_no_match').remove();this.$(".o_export_tree_item").show();this.$(".o_export_tree_item.haschild:not(.show) .o_export_tree_item").hide();return;}
var matchItems=this.$(".o_tree_column").filter(function(){var title=this.getAttribute('title');return this.innerText.toUpperCase().indexOf(searchText)>=0||title&&title.toUpperCase().indexOf(searchText)>=0;}).parent();this.$(".o_export_tree_item").hide();if(matchItems.length){this.$('.o_no_match').remove();_.each(matchItems,function(col){var $col=$(col);$col.show();$col.parents('.haschild.show').show();if(!$col.parent().hasClass('show')&&!$col.parent().hasClass('o_field_tree_structure')){$col.hide();}});}else if(!this.$('.o_no_match').length){this.$(".o_field_tree_structure").append($("<h3/>",{class:'text-center text-muted mt-5 o_no_match',text:_t("No match found.")}));}},});return DataExport;});;

/* /web/static/src/js/widgets/date_picker.js defined in bundle 'web.assets_backend' */
odoo.define('web.datepicker',function(require){"use strict";var core=require('web.core');var field_utils=require('web.field_utils');var time=require('web.time');var Widget=require('web.Widget');var _t=core._t;var DateWidget=Widget.extend({template:"web.datepicker",type_of_date:"date",events:{'error.datetimepicker':'errorDatetime','change .o_datepicker_input':'changeDatetime','click input':'_onInputClicked','input input':'_onInput','keydown':'_onKeydown','show.datetimepicker':'_onDateTimePickerShow','hide.datetimepicker':'_onDateTimePickerHide',},init:function(parent,options){this._super.apply(this,arguments);this.name=parent.name;this.options=_.extend({locale:moment.locale(),format:this.type_of_date==='datetime'?time.getLangDatetimeFormat():time.getLangDateFormat(),minDate:moment({y:1900}),maxDate:moment({y:9999,M:11,d:31}),useCurrent:false,icons:{time:'fa fa-clock-o',date:'fa fa-calendar',up:'fa fa-chevron-up',down:'fa fa-chevron-down',previous:'fa fa-chevron-left',next:'fa fa-chevron-right',today:'fa fa-calendar-check-o',clear:'fa fa-trash',close:'fa fa-check primary',},calendarWeeks:true,buttons:{showToday:false,showClear:false,showClose:false,},widgetParent:'body',keyBinds:null,},options||{});this.__libInput=0;this.__isOpen=false;},start:function(){this.$input=this.$('input.o_datepicker_input');this.__libInput++;this.$el.datetimepicker(this.options);this.__libInput--;this._setReadonly(false);},destroy:function(){if(this._onScroll){window.removeEventListener('wheel',this._onScroll,true);}
this.__libInput++;this.$input.blur();this.$el.datetimepicker('destroy');this.__libInput--;this._super.apply(this,arguments);},changeDatetime:function(){if(this.__libInput>0){if(this.options.warn_future){this._warnFuture(this.getValue());}
this.trigger("datetime_changed");return;}
var oldValue=this.getValue();if(this.isValid()){this._setValueFromUi();var newValue=this.getValue();var hasChanged=!oldValue!==!newValue;if(oldValue&&newValue){var formattedOldValue=oldValue.format(time.getLangDatetimeFormat());var formattedNewValue=newValue.format(time.getLangDatetimeFormat());if(formattedNewValue!==formattedOldValue){hasChanged=true;}}
if(hasChanged){if(this.options.warn_future){this._warnFuture(newValue);}
this.trigger("datetime_changed");}}else{var formattedValue=oldValue?this._formatClient(oldValue):null;this.$input.val(formattedValue);}},errorDatetime:function(e){return false;},focus:function(){this.__libInput++;this.$input.focus();this.__libInput--;},getValue:function(){var value=this.get('value');return value&&value.clone();},isValid:function(){var value=this.$input.val();if(value===""){return true;}else{try{this._parseClient(value);return true;}catch(e){return false;}}},maxDate:function(date){this.__libInput++;this.$el.datetimepicker('maxDate',date||null);this.__libInput--;},minDate:function(date){this.__libInput++;this.$el.datetimepicker('minDate',date||null);this.__libInput--;},setValue:function(value){this.set({'value':value});var formatted_value=value?this._formatClient(value):null;this.$input.val(formatted_value);this._setLibInputValue(value);},_warnFuture:function(currentDate){if(!this.$warning){this.$warning=$('<span>',{class:'fa fa-exclamation-triangle o_tz_warning o_datepicker_warning',});var title=_t("This date is on the future. Make sure it is what you expected.");this.$warning.attr('title',title);this.$input.after(this.$warning);}
if(currentDate&&currentDate.format('YYYY-MM-DD')>moment().format('YYYY-MM-DD')){this.$warning.show();}else{this.$warning.hide();}},_formatClient:function(v){return field_utils.format[this.type_of_date](v,null,{timezone:false});},_parseClient:function(v){return field_utils.parse[this.type_of_date](v,null,{timezone:false});},_setLibInputValue:function(value){this.__libInput++;this.$el.datetimepicker('date',value||null);this.__libInput--;},_setReadonly:function(readonly){this.readonly=readonly;this.$input.prop('readonly',this.readonly);},_setValueFromUi:function(){var value=this.$input.val()||false;this.setValue(this._parseClient(value));},_onDateTimePickerHide:function(){this.__isOpen=false;this.changeDatetime();if(this._onScroll){window.removeEventListener('wheel',this._onScroll,true);}
this.changeDatetime();},_onDateTimePickerShow:function(){this.__isOpen=true;if(this.$input.val().length!==0&&this.isValid()){this.$input.select();}
var self=this;this._onScroll=function(ev){if(ev.target!==self.$input.get(0)){self.__libInput++;self.$el.datetimepicker('hide');self.__libInput--;}};window.addEventListener('wheel',this._onScroll,true);},_onKeydown:function(ev){if(ev.which===$.ui.keyCode.ESCAPE){if(this.__isOpen){ev.stopImmediatePropagation();this.__libInput++;this.$el.datetimepicker('hide');this.__libInput--;this.focus();}}},_onInput:function(ev){if(this.__libInput>0){ev.stopImmediatePropagation();}},_onInputClicked:function(){this.__libInput++;this.$el.datetimepicker('toggle');this.__libInput--;this.focus();},});var DateTimeWidget=DateWidget.extend({type_of_date:"datetime",init:function(parent,options){this._super(parent,_.extend({buttons:{showToday:false,showClear:false,showClose:true,},},options||{}));},});return{DateWidget:DateWidget,DateTimeWidget:DateTimeWidget,};});;

/* /web/static/src/js/widgets/domain_selector_dialog.js defined in bundle 'web.assets_backend' */
odoo.define("web.DomainSelectorDialog",function(require){"use strict";var core=require("web.core");var Dialog=require("web.Dialog");var DomainSelector=require("web.DomainSelector");var _t=core._t;return Dialog.extend({init:function(parent,model,domain,options){this.model=model;this.options=_.extend({readonly:true,debugMode:false,},options||{});var buttons;if(this.options.readonly){buttons=[{text:_t("Close"),close:true},];}else{buttons=[{text:_t("Save"),classes:"btn-primary",close:true,click:function(){this.trigger_up("domain_selected",{domain:this.domainSelector.getDomain()});}},{text:_t("Discard"),close:true},];}
this._super(parent,_.extend({},{title:_t("Domain"),buttons:buttons,},options||{}));this.domainSelector=new DomainSelector(this,model,domain,options);},start:function(){var self=this;this.opened().then(function(){self.$el.css('overflow','visible').closest('.modal-dialog').css('height','auto');});return Promise.all([this._super.apply(this,arguments),this.domainSelector.appendTo(this.$el)]);},});});;

/* /web/static/src/js/widgets/domain_selector.js defined in bundle 'web.assets_backend' */
odoo.define("web.DomainSelector",function(require){"use strict";var core=require("web.core");var datepicker=require("web.datepicker");var Domain=require("web.Domain");var field_utils=require("web.field_utils");var ModelFieldSelector=require("web.ModelFieldSelector");var Widget=require("web.Widget");var _t=core._t;var _lt=core._lt;var operator_mapping={"=":"=","!=":_lt("is not ="),">":">","<":"<",">=":">=","<=":"<=","ilike":_lt("contains"),"not ilike":_lt("does not contain"),"in":_lt("in"),"not in":_lt("not in"),"child_of":_lt("child of"),"parent_of":_lt("parent of"),"like":"like","not like":"not like","=like":"=like","=ilike":"=ilike","set":_lt("is set"),"not set":_lt("is not set"),};var DomainNode=Widget.extend({events:{"click .o_domain_add_node_button":"_onAddButtonClick","click .o_domain_delete_node_button":"_onDeleteButtonClick","mouseenter button":"_onButtonEntered","mouseleave button":"_onButtonLeft",},init:function(parent,model,domain,options){this._super.apply(this,arguments);this.model=model;this.options=_.extend({readonly:true,operators:null,debugMode:false,},options||{});this.readonly=this.options.readonly;this.debug=this.options.debugMode;},isValid:function(){},getDomain:function(){},_onAddButtonClick:function(e){e.preventDefault();e.stopPropagation();this.trigger_up("add_node_clicked",{newBranch:!!$(e.currentTarget).data("branch"),child:this});},_onDeleteButtonClick:function(e){e.preventDefault();e.stopPropagation();this.trigger_up("delete_node_clicked",{child:this});},_onButtonEntered:function(e){e.preventDefault();e.stopPropagation();var $target=$(e.currentTarget);this.$el.toggleClass("o_hover_btns",$target.hasClass("o_domain_delete_node_button"));this.$el.toggleClass("o_hover_add_node",$target.hasClass("o_domain_add_node_button"));this.$el.toggleClass("o_hover_add_inset_node",!!$target.data("branch"));},_onButtonLeft:function(e){e.preventDefault();e.stopPropagation();this.$el.removeClass("o_hover_btns o_hover_add_node o_hover_add_inset_node");},});var DomainTree=DomainNode.extend({template:"DomainTree",events:_.extend({},DomainNode.prototype.events,{"click .o_domain_tree_operator_selector .dropdown-item":"_onOperatorChange",}),custom_events:{"add_node_clicked":"_onNodeAdditionAsk","delete_node_clicked":"_onNodeDeletionAsk",},init:function(parent,model,domain){this._super.apply(this,arguments);var parsedDomain=this._parseDomain(domain);if(parsedDomain){this._initialize(parsedDomain);}},start:function(){this._postRender();return Promise.all([this._super.apply(this,arguments),this._renderChildrenTo(this.$childrenContainer)]);},isValid:function(){for(var i=0;i<this.children.length;i++){var cValid=this.children[i].isValid();if(!cValid){return cValid;}}
return this._isValid;},getDomain:function(){var childDomains=[];var nbChildren=0;_.each(this.children,function(child){var childDomain=child.getDomain();if(childDomain.length){nbChildren++;childDomains=childDomains.concat(child.getDomain());}});var nbChildRequired=this.operator==="!"?1:2;var operators=_.times(nbChildren-nbChildRequired+1,_.constant(this.operator));return operators.concat(childDomains);},_addChild:function(domain,afterNode){var i=afterNode?_.indexOf(this.children,afterNode):this.children.length;if(i<0)return false;this.children.splice(i+1,0,instantiateNode(this,this.model,domain,this.options));this.trigger_up("domain_changed",{child:this});return true;},_addFlattenedChildren:function(domain){var node=instantiateNode(this,this.model,domain,this.options);if(node===null){return;}
if(!node.children||node.operator!==this.operator){this.children.push(node);return;}
_.each(node.children,(function(child){child.setParent(this);this.children.push(child);}).bind(this));node.destroy();},_changeOperator:function(operator,silent){this.operator=operator;if(!silent)this.trigger_up("domain_changed",{child:this});},_initialize:function(domain){this._isValid=true;this.operator=domain[0];this.children=[];if(domain.length<=1){return;}
var nbLeafsToFind=1;for(var i=1;i<domain.length;i++){if(domain[i]==="&"||domain[i]==="|"){nbLeafsToFind++;}else if(domain[i]!=="!"){nbLeafsToFind--;}
if(!nbLeafsToFind){var partLeft=domain.slice(1,i+1);var partRight=domain.slice(i+1);if(partLeft.length){this._addFlattenedChildren(partLeft);}
if(partRight.length){this._addFlattenedChildren(partRight);}
break;}}
this._isValid=(nbLeafsToFind===0);if(this.operator==="!"){this.children[0].noControlPanel=true;}},_postRender:function(){this.$childrenContainer=this.$("> .o_domain_node_children_container");},_removeChild:function(oldChild){var i=_.indexOf(this.children,oldChild);if(i<0)return false;this.children[i].destroy();this.children.splice(i,1);this.trigger_up("domain_changed",{child:this});return true;},_renderChildrenTo:function($to){var $div=$("<div/>");return Promise.all(_.map(this.children,(function(child){return child.appendTo($div);}).bind(this))).then((function(){_.each(this.children,function(child){child.$el.appendTo($to);});}).bind(this));},_parseDomain:function(domain){var parsedDomain=false;try{parsedDomain=Domain.prototype.stringToArray(domain);this.invalidDomain=false;}catch(err){this.invalidDomain=true;this.children=[];}
return parsedDomain;},_onOperatorChange:function(e){e.preventDefault();e.stopPropagation();this._changeOperator($(e.target).data("operator"));},_onNodeAdditionAsk:function(e){var domain=this.options.default||[["id","=",1]];if(e.data.newBranch){domain=[this.operator==="&"?"|":"&"].concat(domain).concat(domain);}
if(this._addChild(domain,e.data.child)){e.stopPropagation();}},_onNodeDeletionAsk:function(e){if(this._removeChild(e.data.child)){e.stopPropagation();}},});var DomainSelector=DomainTree.extend({template:"DomainSelector",events:_.extend({},DomainTree.prototype.events,{"click .o_domain_add_first_node_button":"_onAddFirstButtonClick","change .o_domain_debug_input":"_onDebugInputChange",}),custom_events:_.extend({},DomainTree.prototype.custom_events,{domain_changed:"_onDomainChange",}),start:function(){var self=this;return this._super.apply(this,arguments).then(function(){if(self.invalidDomain){var msg=_t("This domain is not supported.");self.$el.html(msg);}});},setDomain:function(domain){if(domain===Domain.prototype.arrayToString(this.getDomain())){return Promise.resolve();}
var parsedDomain=this._parseDomain(domain);if(parsedDomain){return this._redraw(parsedDomain);}},_initialize:function(domain){if(domain.length>1){Domain.prototype.normalizeArray(domain);}else{domain=["&"].concat(domain);}
return this._super(domain);},_postRender:function(){this._super.apply(this,arguments);this.$debugInput=this.$(".o_domain_debug_input");if(this.$debugInput.length){this.$debugInput.val(Domain.prototype.arrayToString(this.getDomain()));}
if(!this._isValid){this.do_warn(_t("Domain error"),_t("The domain you entered is not properly formed"));}},_redraw:function(domain){var oldChildren=this.children.slice();this._initialize(domain||this.getDomain());return this._renderChildrenTo($("<div/>")).then((function(){_.each(oldChildren,function(child){child.destroy();});this.renderElement();this._postRender();_.each(this.children,(function(child){child.$el.appendTo(this.$childrenContainer);}).bind(this));}).bind(this));},_onAddFirstButtonClick:function(){this._addChild(this.options.default||[["id","=",1]]);},_onDebugInputChange:function(e){var domain;try{domain=Domain.prototype.stringToArray($(e.currentTarget).val());}catch(err){this.do_warn(_t("Syntax error"),_t("The domain you entered is not properly formed"));return;}
this._redraw(domain).then((function(){this.trigger_up("domain_changed",{child:this,alreadyRedrawn:true});}).bind(this));},_onDomainChange:function(e){if(!e.data.alreadyRedrawn){this._redraw();}},});var DomainLeaf=DomainNode.extend({template:"DomainLeaf",events:_.extend({},DomainNode.prototype.events,{"change .o_domain_leaf_operator_select":"_onOperatorSelectChange","change .o_domain_leaf_value_input":"_onValueInputChange","click .o_domain_leaf_value_add_tag_button":"on_add_tag","keyup .o_domain_leaf_value_tags input":"on_add_tag","click .o_domain_leaf_value_remove_tag_button":"on_remove_tag",}),custom_events:{"field_chain_changed":"_onFieldChainChange",},init:function(parent,model,domain,options){this._super.apply(this,arguments);var currentDomain=Domain.prototype.stringToArray(domain);this.chain=currentDomain[0][0];this.operator=currentDomain[0][1];this.value=currentDomain[0][2];this.operator_mapping=operator_mapping;},willStart:function(){var defs=[this._super.apply(this,arguments)];this.fieldSelector=new ModelFieldSelector(this,this.model,this.chain!==undefined?this.chain.toString().split("."):[],this.options);defs.push(this.fieldSelector.appendTo($("<div/>")).then((function(){var wDefs=[];if(!this.readonly){var selectedField=this.fieldSelector.getSelectedField()||{};this.operators=this._getOperatorsFromType(selectedField.type);if(_.contains(["child_of","parent_of","like","not like","=like","=ilike"],this.operator)){this.operators[this.operator]=operator_mapping[this.operator];}else if(!this.operators[this.operator]){this.operators[this.operator]="?";}
this.selectionChoices=null;if(selectedField.type==="boolean"){this.selectionChoices=[["1",_t("set (true)")],["0",_t("not set (false)")]];}else if(selectedField.type==="selection"){this.selectionChoices=selectedField.selection;}
this.displayValue=this.value;try{if(selectedField&&!selectedField.relation&&!_.isArray(this.value)){this.displayValue=field_utils.format[selectedField.type](this.value,selectedField);}}catch(err){}
this.displayOperator=this.operator;if(selectedField.type==="boolean"){this.displayValue=this.value?"1":"0";}else if((this.operator==="!="||this.operator==="=")&&this.value===false){this.displayOperator=this.operator==="!="?"set":"not set";}
if(_.contains(["date","datetime"],selectedField.type)){this.valueWidget=new(selectedField.type==="datetime"?datepicker.DateTimeWidget:datepicker.DateWidget)(this);wDefs.push(this.valueWidget.appendTo("<div/>").then((function(){this.valueWidget.$el.addClass("o_domain_leaf_value_input");this.valueWidget.setValue(moment(this.value));this.valueWidget.on("datetime_changed",this,function(){this._changeValue(this.valueWidget.getValue());});}).bind(this)));}
return Promise.all(wDefs);}}).bind(this)));return Promise.all(defs);},start:function(){this.fieldSelector.$el.prependTo(this.$("> .o_domain_leaf_info, > .o_domain_leaf_edition"));if(!this.readonly&&this.valueWidget){this.$(".o_domain_leaf_value_input").replaceWith(this.valueWidget.$el);}
return this._super.apply(this,arguments);},isValid:function(){return this.fieldSelector&&this.fieldSelector.isValid();},getDomain:function(){return[[this.chain,this.operator,this.value]];},_changeFieldChain:function(chain,silent){this.chain=chain.join(".");this.fieldSelector.setChain(chain).then((function(){if(!this.fieldSelector.isValid())return;var selectedField=this.fieldSelector.getSelectedField()||{};var operators=this._getOperatorsFromType(selectedField.type);if(operators[this.operator]===undefined){this._changeOperator("=",true);}
this._changeValue(this.value,true);if(!silent)this.trigger_up("domain_changed",{child:this});}).bind(this));},_changeOperator:function(operator,silent){this.operator=operator;if(_.contains(["set","not set"],this.operator)){this.operator=this.operator==="not set"?"=":"!=";this.value=false;}else if(_.contains(["in","not in"],this.operator)){this.value=_.isArray(this.value)?this.value:this.value?(""+this.value).split(","):[];}else{if(_.isArray(this.value)){this.value=this.value.join(",");}
this._changeValue(this.value,true);}
if(!silent)this.trigger_up("domain_changed",{child:this});},_changeValue:function(value,silent){var couldNotParse=false;var selectedField=this.fieldSelector.getSelectedField()||{};try{this.value=field_utils.parse[selectedField.type](value,selectedField);}catch(err){this.value=value;couldNotParse=true;}
if(selectedField.type==="boolean"){if(!_.isBoolean(this.value)){this.value=!!parseFloat(this.value);}}else if(selectedField.type==="selection"){if(!_.some(selectedField.selection,(function(option){return option[0]===this.value;}).bind(this))){this.value=selectedField.selection[0][0];}}else if(_.contains(["date","datetime"],selectedField.type)){if(couldNotParse||_.isBoolean(this.value)){this.value=field_utils.parse[selectedField.type](field_utils.format[selectedField.type](moment())).toJSON();}else{this.value=this.value.toJSON();}}else{if(_.isBoolean(this.value)){this.value="";}else if(_.isObject(this.value)&&!_.isArray(this.value)){this.value=this.value.id||value||"";}}
if(!silent)this.trigger_up("domain_changed",{child:this});},_getOperatorsFromType:function(type){var operators={};switch(type){case"boolean":operators={"=":_t("is"),"!=":_t("is not"),};break;case"char":case"text":case"html":operators=_.pick(operator_mapping,"=","!=","ilike","not ilike","set","not set","in","not in");break;case"many2many":case"one2many":case"many2one":operators=_.pick(operator_mapping,"=","!=","ilike","not ilike","set","not set");break;case"integer":case"float":case"monetary":operators=_.pick(operator_mapping,"=","!=",">","<",">=","<=","ilike","not ilike","set","not set");break;case"selection":operators=_.pick(operator_mapping,"=","!=","set","not set");break;case"date":case"datetime":operators=_.pick(operator_mapping,"=","!=",">","<",">=","<=","set","not set");break;default:operators=_.extend({},operator_mapping);break;}
if(this.options.operators){operators=_.pick.apply(_,[operators].concat(this.options.operators));}
return operators;},_onOperatorSelectChange:function(e){this._changeOperator($(e.currentTarget).val());},_onValueInputChange:function(e){if(e.currentTarget!==e.target)return;this._changeValue($(e.currentTarget).val());},_onFieldChainChange:function(e){this._changeFieldChain(e.data.chain);},on_add_tag:function(e){if(e.type==="keyup"&&e.which!==$.ui.keyCode.ENTER)return;if(!_.contains(["not in","in"],this.operator))return;var values=_.isArray(this.value)?this.value.slice():[];var $input=this.$(".o_domain_leaf_value_tags input");var val=$input.val().trim();if(val&&values.indexOf(val)<0){values.push(val);_.defer(this._changeValue.bind(this,values));$input.focus();}},on_remove_tag:function(e){var values=_.isArray(this.value)?this.value.slice():[];var val=this.$(e.currentTarget).data("value");var index=values.indexOf(val);if(index>=0){values.splice(index,1);_.defer(this._changeValue.bind(this,values));}},});function instantiateNode(parent,model,domain,options){if(domain.length>1){return new DomainTree(parent,model,domain,options);}else if(domain.length===1){return new DomainLeaf(parent,model,domain,options);}
return null;}
return DomainSelector;});;

/* /web/static/src/js/widgets/iframe_widget.js defined in bundle 'web.assets_backend' */
odoo.define('web.IFrameWidget',function(require){"use strict";var Widget=require('web.Widget');var IFrameWidget=Widget.extend({tagName:'iframe',init:function(parent,url){this._super(parent);this.url=url;},start:function(){this.$el.css({height:'100%',width:'100%',border:0});this.$el.attr({src:this.url});this.$el.on("load",this._bindEvents.bind(this));return this._super();},_bindEvents:function(){this.$el.contents().click(this._onIFrameClicked.bind(this));},_onIFrameClicked:function(event){}});return IFrameWidget;});;

/* /web/static/src/js/chrome/loading.js defined in bundle 'web.assets_backend' */
odoo.define('web.Loading',function(require){"use strict";var config=require('web.config');var core=require('web.core');var framework=require('web.framework');var Widget=require('web.Widget');var _t=core._t;var Loading=Widget.extend({template:"Loading",init:function(parent){this._super(parent);this.count=0;this.blocked_ui=false;},start:function(){core.bus.on('rpc_request',this,this.request_call);core.bus.on("rpc_response",this,this.response_call);core.bus.on("rpc_response_failed",this,this.response_call);},destroy:function(){this.on_rpc_event(-this.count);this._super();},request_call:function(){this.on_rpc_event(1);},response_call:function(){this.on_rpc_event(-1);},on_rpc_event:function(increment){var self=this;if(!this.count&&increment===1){this.long_running_timer=setTimeout(function(){self.blocked_ui=true;framework.blockUI();},3000);}
this.count+=increment;if(this.count>0){if(config.isDebug()){this.$el.text(_.str.sprintf(_t("Loading (%d)"),this.count));}else{this.$el.text(_t("Loading"));}
this.$el.show();this.getParent().$el.addClass('oe_wait');}else{this.count=0;clearTimeout(this.long_running_timer);if(self.blocked_ui){this.blocked_ui=false;framework.unblockUI();}
this.$el.fadeOut();this.getParent().$el.removeClass('oe_wait');}}});return Loading;});;

/* /web/static/src/js/widgets/model_field_selector.js defined in bundle 'web.assets_backend' */
odoo.define("web.ModelFieldSelector",function(require){"use strict";var core=require("web.core");var Widget=require("web.Widget");var _t=core._t;var modelFieldsCache={cache:{},cacheDefs:{},};core.bus.on('clear_cache',null,function(){modelFieldsCache.cache={};modelFieldsCache.cacheDefs={};});var ModelFieldSelector=Widget.extend({template:"ModelFieldSelector",events:{},editionEvents:{"focusin":"_onFocusIn","focusout":"_onFocusOut","click .o_field_selector_close":"_onCloseClick","click .o_field_selector_prev_page":"_onPrevPageClick","click .o_field_selector_next_page":"_onNextPageClick","click li.o_field_selector_select_button":"_onLastFieldClick","change input.o_field_selector_debug":"_onDebugInputChange","keyup .o_field_selector_search > input":"_onSearchInputChange","mouseover li.o_field_selector_item":"_onItemHover","keydown":"_onKeydown",},init:function(parent,model,chain,options){this._super.apply(this,arguments);this.model=model;this.chain=chain;this.options=_.extend({order:'string',readonly:true,filters:{},fields:null,filter:function(){return true;},followRelations:true,debugMode:false,showSearchInput:true,},options||{});this.options.filters=_.extend({searchable:true,},this.options.filters);if(typeof this.options.followRelations!=='function'){this.options.followRelations=this.options.followRelations?function(){return true;}:function(){return false;};}
this.pages=[];this.dirty=false;if(!this.options.readonly){_.extend(this.events,this.editionEvents);}
this.searchValue='';},willStart:function(){return Promise.all([this._super.apply(this,arguments),this._prefill()]);},start:function(){this.$value=this.$(".o_field_selector_value");this.$popover=this.$(".o_field_selector_popover");this.$input=this.$popover.find(".o_field_selector_popover_footer > input");this.$searchInput=this.$popover.find(".o_field_selector_search > input");this.$valid=this.$(".o_field_selector_warning");this._render();return this._super.apply(this,arguments);},getSelectedField:function(){return _.findWhere(this.pages[this.chain.length-1],{name:_.last(this.chain)});},isValid:function(){return this.valid;},setChain:function(chain){if(_.isEqual(chain,this.chain)){return Promise.resolve();}
this.chain=chain;return this._prefill().then(this._render.bind(this));},_addChainNode:function(fieldName){this.dirty=true;this.chain=this.chain.slice(0,this.pages.length-1);this.chain.push(fieldName);this.searchValue='';this.$searchInput.val('');},_getLastPageField:function(name){return _.findWhere(_.last(this.pages),{name:name,});},_getModelFieldsFromCache:function(model,filters){var self=this;var def=modelFieldsCache.cacheDefs[model];if(!def){def=modelFieldsCache.cacheDefs[model]=this._rpc({model:model,method:'fields_get',args:[false,["store","searchable","type","string","relation","selection","related"]],context:this.getSession().user_context,}).then((function(fields){modelFieldsCache.cache[model]=sortFields(fields,model,self.options.order);}).bind(this));}
return def.then((function(){return _.filter(modelFieldsCache.cache[model],function(f){return(!filters.searchable||f.searchable)&&self.options.filter(f);});}).bind(this));},_goToNextPage:function(field){if(!_.isEqual(this._getLastPageField(field.name),field))return;this._validate(true);this._addChainNode(field.name);this._pushPageData(field.relation).then(this._render.bind(this));},_goToPrevPage:function(){if(this.pages.length<=0)return;this._validate(true);this._removeChainNode();if(this.pages.length>1){this.pages.pop();}
this._render();},_hidePopover:function(){if(!this._isOpen)return;this._isOpen=false;this.$popover.addClass('d-none');if(this.dirty){this.dirty=false;this.trigger_up("field_chain_changed",{chain:this.chain});}},_prefill:function(){this.pages=[];return this._pushPageData(this.model).then((function(){this._validate(true);return(this.chain.length?processChain.call(this,this.chain.slice().reverse()):Promise.resolve());}).bind(this));function processChain(chain){var fieldName=chain.pop();var field=this._getLastPageField(fieldName);if(field&&field.relation){if(chain.length){return this._pushPageData(field.relation).then(processChain.bind(this,chain));}else{return this._pushPageData(field.relation);}}else if(field&&chain.length===0){return Promise.resolve();}else if(!field&&fieldName==="1"){this._validate(true);}else if(!field&&fieldName==="0"){this._validate(true);}else{this._validate(false);}
return Promise.resolve();}},_pushPageData:function(model){var def;if(this.model===model&&this.options.fields){def=Promise.resolve(sortFields(this.options.fields,model,this.options.order));}else{def=this._getModelFieldsFromCache(model,this.options.filters);}
return def.then((function(fields){this.pages.push(fields);}).bind(this));},_removeChainNode:function(){this.dirty=true;this.chain=this.chain.slice(0,this.pages.length-1);this.chain.pop();},_render:function(){this.$value.html(core.qweb.render(this.template+".value",{chain:this.chain,pages:this.pages,}));this.$valid.toggleClass('d-none',!!this.isValid());var page=_.last(this.pages);var title="";if(this.pages.length>1){var prevField=_.findWhere(this.pages[this.pages.length-2],{name:(this.chain.length===this.pages.length)?this.chain[this.chain.length-2]:_.last(this.chain),});if(prevField)title=prevField.string;}
this.$(".o_field_selector_popover_header .o_field_selector_title").text(title);var lines=_.filter(page,this.options.filter);if(this.searchValue){var matches=fuzzy.filter(this.searchValue,_.pluck(lines,'string'));lines=_.map(_.pluck(matches,'index'),function(i){return lines[i];});}
this.$(".o_field_selector_page").replaceWith(core.qweb.render(this.template+".page",{lines:lines,followRelations:this.options.followRelations,debug:this.options.debugMode,}));this.$input.val(this.chain.join("."));},_selectField:function(field){if(!_.isEqual(this._getLastPageField(field.name),field))return;this._validate(true);this._addChainNode(field.name);this._render();this._hidePopover();},_showPopover:function(){if(this._isOpen)return;this._isOpen=true;this.$popover.removeClass('d-none');},_validate:function(valid){this.valid=!!valid;if(!this.valid){this.do_warn(_t("Invalid field chain"),_t("The field chain is not valid. Did you maybe use a non-existing field name or followed a non-relational field?"));}},_onFocusIn:function(){clearTimeout(this._hidePopoverTimeout);this._showPopover();},_onFocusOut:function(){this._hidePopoverTimeout=_.defer(this._hidePopover.bind(this));},_onCloseClick:function(){this._hidePopover();},_onPrevPageClick:function(){this._goToPrevPage();},_onNextPageClick:function(e){e.stopPropagation();this._goToNextPage(this._getLastPageField($(e.currentTarget).data("name")));},_onLastFieldClick:function(e){this._selectField(this._getLastPageField($(e.currentTarget).data("name")));},_onDebugInputChange:function(){var userChainStr=this.$input.val();var userChain=userChainStr.split(".");if(!this.options.followRelations&&userChain.length>1){this.do_warn(_t("Relation not allowed"),_t("You cannot follow relations for this field chain construction"));userChain=[userChain[0]];}
this.setChain(userChain).then((function(){this.trigger_up("field_chain_changed",{chain:this.chain});}).bind(this));},_onSearchInputChange:function(){this.searchValue=this.$searchInput.val();this._render();},_onItemHover:function(e){this.$("li.o_field_selector_item").removeClass("active");$(e.currentTarget).addClass("active");},_onKeydown:function(e){if(!this.$popover.is(":visible"))return;var inputHasFocus=this.$input.is(":focus");var searchInputHasFocus=this.$searchInput.is(":focus");switch(e.which){case $.ui.keyCode.UP:case $.ui.keyCode.DOWN:e.preventDefault();var $active=this.$("li.o_field_selector_item.active");var $to=$active[e.which===$.ui.keyCode.DOWN?"next":"prev"](".o_field_selector_item");if($to.length){$active.removeClass("active");$to.addClass("active");this.$popover.focus();var $page=$to.closest(".o_field_selector_page");var full_height=$page.height();var el_position=$to.position().top;var el_height=$to.outerHeight();var current_scroll=$page.scrollTop();if(el_position<0){$page.scrollTop(current_scroll-el_height);}else if(full_height<el_position+el_height){$page.scrollTop(current_scroll+el_height);}}
break;case $.ui.keyCode.RIGHT:if(inputHasFocus)break;e.preventDefault();var name=this.$("li.o_field_selector_item.active").data("name");if(name){var field=this._getLastPageField(name);if(field.relation){this._goToNextPage(field);}}
break;case $.ui.keyCode.LEFT:if(inputHasFocus)break;e.preventDefault();this._goToPrevPage();break;case $.ui.keyCode.ESCAPE:e.stopPropagation();this._hidePopover();break;case $.ui.keyCode.ENTER:if(inputHasFocus||searchInputHasFocus)break;e.preventDefault();this._selectField(this._getLastPageField(this.$("li.o_field_selector_item.active").data("name")));break;}}});return ModelFieldSelector;function sortFields(fields,model,order){var array=_.chain(fields).pairs().sortBy(function(p){return p[1].string;});if(order!=='string'){array=array.sortBy(function(p){return p[1][order];});}
return array.map(function(p){return _.extend({name:p[0],model:model,},p[1]);}).value();}});;

/* /web/static/src/js/chrome/sidebar.js defined in bundle 'web.assets_backend' */
odoo.define('web.Sidebar',function(require){"use strict";var Context=require('web.Context');var core=require('web.core');var pyUtils=require('web.py_utils');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var Sidebar=Widget.extend({events:{"click a.dropdown-item":"_onDropdownClicked"},init:function(parent,options){this._super.apply(this,arguments);this.options=_.defaults(options||{},{'editable':true});this.env=options.env;this.sections=options.sections||[{name:'print',label:_t('Print')},{name:'other',label:_t('Action')},];this.items=options.items||{print:[],other:[],};if(options.actions){this._addToolbarActions(options.actions);}},start:function(){this._super.apply(this,arguments);this.$el.addClass('btn-group');this._redraw();},updateEnv:function(env){this.env=env;this._redraw();},_addItems:function(sectionCode,items){if(items){this.items[sectionCode].unshift.apply(this.items[sectionCode],items);}},_addToolbarActions:function(toolbarActions){var self=this;_.each(['print','action','relate'],function(type){if(type in toolbarActions){var actions=toolbarActions[type];if(actions&&actions.length){var items=_.map(actions,function(action){return{label:action.name,action:action,};});self._addItems(type==='print'?'print':'other',items);}}});if('other'in toolbarActions){this._addItems('other',toolbarActions.other);}},_onItemActionClicked:function(item){var self=this;this.trigger_up('sidebar_data_asked',{callback:function(env){self.env=env;var activeIdsContext={active_id:env.activeIds[0],active_ids:env.activeIds,active_model:env.model,};if(env.domain){activeIdsContext.active_domain=env.domain;}
var context=pyUtils.eval('context',new Context(env.context,activeIdsContext));self._rpc({route:'/web/action/load',params:{action_id:item.action.id,context:context,},}).then(function(result){result.context=new Context(result.context||{},activeIdsContext).set_eval_context(context);result.flags=result.flags||{};result.flags.new_window=true;self.do_action(result,{on_close:function(){self.trigger_up('reload');},});});}});},_redraw:function(){this.$el.html(QWeb.render('Sidebar',{widget:this}));_.each(this.$('.o_dropdown'),function(el){var $dropdown=$(el);if(!$dropdown.find('.dropdown-item').length){$dropdown.hide();}});this.$("[title]").tooltip({delay:{show:500,hide:0}});},_onDropdownClicked:function(event){var section=$(event.currentTarget).data('section');var index=$(event.currentTarget).data('index');var item=this.items[section][index];if(item.callback){item.callback.apply(this,[item]);}else if(item.action){this._onItemActionClicked(item);}else if(item.url){return true;}
event.preventDefault();},});return Sidebar;});;

/* /web/static/src/js/chrome/pager.js defined in bundle 'web.assets_backend' */
odoo.define('web.Pager',function(require){"use strict";var utils=require('web.utils');var Widget=require('web.Widget');var direction={previous:-1,next:1,};var Pager=Widget.extend({template:"Pager",events:{'click .o_pager_next':'_onNext','click .o_pager_previous':'_onPrevious','click .o_pager_value':'_onEdit',},init:function(parent,size,current_min,limit,options){this.state={size:size,current_min:current_min,limit:limit,};Object.defineProperty(this.state,'current_max',{get:function(){return Math.min(this.current_min+this.limit-1,this.size);}});this.options=_.defaults({},options,{can_edit:true,single_page_hidden:false,validate:function(){return Promise.resolve();},withAccessKey:true,});this._super(parent);},start:function(){this.$value=this.$('.o_pager_value');this.$limit=this.$('.o_pager_limit');this._render();return this._super();},disable:function(){this.disabled=true;this._updateArrows();},enable:function(){this.disabled=false;this._updateArrows();},next:function(){this._changeSelection(direction.next);},previous:function(){this._changeSelection(direction.previous);},updateState:function(state,options){_.extend(this.state,state);this._render();if(options&&options.notifyChange){this.trigger('pager_changed',_.clone(this.state));}},_changeSelection:function(direction){var self=this;this.options.validate().then(function(){var size=self.state.size;var current_min=self.state.current_min;var limit=self.state.limit;current_min=(current_min+limit*direction);if(current_min>size){current_min=1;}else if((current_min<1)&&(limit===1)){current_min=size;}else if((current_min<1)&&(limit>1)){current_min=size-((size%limit)||limit)+1;}
self.state.current_min=current_min;self._render();self.trigger('pager_changed',_.clone(self.state));});},_edit:function(){if(this.options.can_edit){var self=this;var $input=$('<input>',{class:'o_input',type:'text',value:this.$value.html()});this.$value.html($input);$input.focus();$input.click(function(ev){ev.stopPropagation();});$input.blur(function(ev){self._save($(ev.target));});$input.on('keydown',function(ev){ev.stopPropagation();if(ev.which===$.ui.keyCode.ENTER){self._save($(ev.target));}else if(ev.which===$.ui.keyCode.ESCAPE){self._render();}});}},_render:function(){var size=this.state.size;var current_min=this.state.current_min;var current_max=this.state.current_max;if(size===0||(this.options.single_page_hidden&&this._singlePage())){this.do_hide();this.$value.html('');}else{this.do_show();this._updateArrows();var value=""+current_min;if(this.state.limit>1){value+="-"+current_max;}
this.$value.html(value);this.$limit.html(size);}},_save:function($input){var self=this;this.options.validate().then(function(){var value=$input.val().split("-");var min=utils.confine(parseInt(value[0],10),1,self.state.size);var max=utils.confine(parseInt(value[1],10),1,self.state.size);if(!isNaN(min)){self.state.current_min=min;if(!isNaN(max)){self.state.limit=utils.confine(max-min+1,1,self.state.size);}else{self.state.limit=1;}
self.trigger('pager_changed',_.clone(self.state));}
self._render();});},_singlePage:function(){var state=this.state;return(1===state.current_min)&&(state.current_max===state.size);},_updateArrows:function(){var disabled=this.disabled||this._singlePage();this.$('button').prop('disabled',disabled);},_onEdit:function(event){event.stopPropagation();if(!this.disabled){this._edit();}},_onNext:function(event){event.stopPropagation();this.next();},_onPrevious:function(event){event.stopPropagation();this.previous();},});return Pager;});;

/* /web/static/src/js/chrome/systray_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.SystrayMenu',function(require){"use strict";var dom=require('web.dom');var Widget=require('web.Widget');var SystrayMenu=Widget.extend({init:function(parent){this._super(parent);this.items=[];this.widgets=[];},willStart:function(){var self=this;var proms=[];SystrayMenu.Items=_.sortBy(SystrayMenu.Items,function(item){return!_.isUndefined(item.prototype.sequence)?item.prototype.sequence:50;});SystrayMenu.Items.forEach(function(WidgetClass){var cur_systray_item=new WidgetClass(self);self.widgets.push(cur_systray_item);proms.push(cur_systray_item.appendTo($('<div>')));});return this._super.apply(this,arguments).then(function(){return Promise.all(proms);});},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.widgets.forEach(function(widget){dom.prepend(self.$el,widget.$el);});});},});SystrayMenu.Items=[];return SystrayMenu;});;

/* /web/static/src/js/widgets/switch_company_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.SwitchCompanyMenu',function(require){"use strict";var config=require('web.config');var core=require('web.core');var session=require('web.session');var SystrayMenu=require('web.SystrayMenu');var Widget=require('web.Widget');var _t=core._t;var SwitchCompanyMenu=Widget.extend({template:'SwitchCompanyMenu',events:{'click .dropdown-item[data-menu] div.log_into':'_onSwitchCompanyClick','keydown .dropdown-item[data-menu] div.log_into':'_onSwitchCompanyClick','click .dropdown-item[data-menu] div.toggle_company':'_onToggleCompanyClick','keydown .dropdown-item[data-menu] div.toggle_company':'_onToggleCompanyClick',},init:function(){this._super.apply(this,arguments);this.isMobile=config.device.isMobile;this._onSwitchCompanyClick=_.debounce(this._onSwitchCompanyClick,1500,true);},willStart:function(){var self=this;this.allowed_company_ids=String(session.user_context.allowed_company_ids).split(',').map(function(id){return parseInt(id);});this.user_companies=session.user_companies.allowed_companies;this.current_company=this.allowed_company_ids[0];this.current_company_name=_.find(session.user_companies.allowed_companies,function(company){return company[0]===self.current_company;})[1];return this._super.apply(this,arguments);},_onSwitchCompanyClick:function(ev){if(ev.type=='keydown'&&ev.which!=$.ui.keyCode.ENTER&&ev.which!=$.ui.keyCode.SPACE){return;}
ev.preventDefault();ev.stopPropagation();var dropdownItem=$(ev.currentTarget).parent();var dropdownMenu=dropdownItem.parent();var companyID=dropdownItem.data('company-id');var allowed_company_ids=this.allowed_company_ids;if(dropdownItem.find('.fa-square-o').length){if(this.allowed_company_ids.length===1){if(this.isMobile){dropdownMenu=dropdownMenu.parent();}
dropdownMenu.find('.fa-check-square').removeClass('fa-check-square').addClass('fa-square-o');dropdownItem.find('.fa-square-o').removeClass('fa-square-o').addClass('fa-check-square');allowed_company_ids=[companyID];}else{allowed_company_ids.push(companyID);dropdownItem.find('.fa-square-o').removeClass('fa-square-o').addClass('fa-check-square');}}
$(ev.currentTarget).attr('aria-pressed','true');session.setCompanies(companyID,allowed_company_ids);},_onToggleCompanyClick:function(ev){if(ev.type=='keydown'&&ev.which!=$.ui.keyCode.ENTER&&ev.which!=$.ui.keyCode.SPACE){return;}
ev.preventDefault();ev.stopPropagation();var dropdownItem=$(ev.currentTarget).parent();var companyID=dropdownItem.data('company-id');var allowed_company_ids=this.allowed_company_ids;var current_company_id=allowed_company_ids[0];if(dropdownItem.find('.fa-square-o').length){allowed_company_ids.push(companyID);dropdownItem.find('.fa-square-o').removeClass('fa-square-o').addClass('fa-check-square');$(ev.currentTarget).attr('aria-checked','true');}else{allowed_company_ids.splice(allowed_company_ids.indexOf(companyID),1);dropdownItem.find('.fa-check-square').addClass('fa-square-o').removeClass('fa-check-square');$(ev.currentTarget).attr('aria-checked','false');}
session.setCompanies(current_company_id,allowed_company_ids);},});if(session.display_switch_company_menu){SystrayMenu.Items.push(SwitchCompanyMenu);}
return SwitchCompanyMenu;});;

/* /web/static/src/js/chrome/user_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.UserMenu',function(require){"use strict";var config=require('web.config');var core=require('web.core');var framework=require('web.framework');var Dialog=require('web.Dialog');var Widget=require('web.Widget');var _t=core._t;var QWeb=core.qweb;var UserMenu=Widget.extend({template:'UserMenu',start:function(){var self=this;var session=this.getSession();this.$el.on('click','[data-menu]',function(ev){ev.preventDefault();var menu=$(this).data('menu');self['_onMenu'+menu.charAt(0).toUpperCase()+menu.slice(1)]();});return this._super.apply(this,arguments).then(function(){var $avatar=self.$('.oe_topbar_avatar');if(!session.uid){$avatar.attr('src',$avatar.data('default-src'));return Promise.resolve();}
var topbar_name=session.name;if(config.isDebug()){topbar_name=_.str.sprintf("%s (%s)",topbar_name,session.db);}
self.$('.oe_topbar_name').text(topbar_name);var avatar_src=session.url('/web/image',{model:'res.users',field:'image_128',id:session.uid,});$avatar.attr('src',avatar_src);});},_onMenuAccount:function(){var self=this;this.trigger_up('clear_uncommitted_changes',{callback:function(){self._rpc({route:'/web/session/account'}).then(function(url){framework.redirect(url);}).guardedCatch(function(result,ev){ev.preventDefault();framework.redirect('https://accounts.odoo.com/account');});},});},_onMenuDocumentation:function(){window.open('https://www.odoo.com/documentation/13.0','_blank');},_onMenuLogout:function(){this.trigger_up('clear_uncommitted_changes',{callback:this.do_action.bind(this,'logout'),});},_onMenuSettings:function(){var self=this;var session=this.getSession();this.trigger_up('clear_uncommitted_changes',{callback:function(){self._rpc({model:"res.users",method:"action_get"}).then(function(result){result.res_id=session.uid;self.do_action(result);});},});},_onMenuSupport:function(){window.open('https://www.odoo.com/buy','_blank');},_onMenuShortcuts:function(){new Dialog(this,{size:'large',dialogClass:'o_act_window',title:_t("Keyboard Shortcuts"),$content:$(QWeb.render("UserMenu.shortcuts"))}).open();},});return UserMenu;});;

/* /web_enterprise/static/src/js/menu.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.Menu',function(require){"use strict";var config=require('web.config');var core=require('web.core');var dom=require('web.dom');var Widget=require('web.Widget');var SystrayMenu=require('web.SystrayMenu');var UserMenu=require('web.UserMenu');UserMenu.prototype.sequence=0;SystrayMenu.Items.push(UserMenu);var QWeb=core.qweb;var Menu=Widget.extend({template:'Menu',menusTemplate:'Menu.sections',events:{'click .o_menu_toggle':'_onToggleHomeMenu','mouseover .o_menu_sections > li:not(.show)':'_onMouseOverMenu','click .o_menu_brand':'_onAppNameClicked',},init:function(parent,menu_data){var self=this;this._super.apply(this,arguments);this.home_menu_displayed=false;this.backbutton_displayed=false;this.$menu_sections={};this.menu_data=menu_data;var $menu_sections=$(QWeb.render(this.menusTemplate,{menu_data:this.menu_data,}));$menu_sections.filter('section').each(function(){self.$menu_sections[parseInt(this.className,10)]=$(this).children('li');});core.bus.on('change_menu_section',this,this.change_menu_section);core.bus.on('toggle_mode',this,this.toggle_mode);},start:function(){var self=this;this.$menu_toggle=this.$('.o_menu_toggle');this.$menu_brand_placeholder=this.$('.o_menu_brand');this.$section_placeholder=this.$('.o_menu_sections');var on_secondary_menu_click=function(ev){ev.preventDefault();var menu_id=$(ev.currentTarget).data('menu');var action_id=$(ev.currentTarget).data('action-id');self._on_secondary_menu_click(menu_id,action_id);};var menu_ids=_.keys(this.$menu_sections);var primary_menu_id,$section;for(var i=0;i<menu_ids.length;i++){primary_menu_id=menu_ids[i];$section=this.$menu_sections[primary_menu_id];$section.on('click','a[data-menu]',self,on_secondary_menu_click.bind(this));}
this.systray_menu=new SystrayMenu(this);var autoMoreMenu=this.systray_menu.attachTo(this.$('.o_menu_systray')).then(function(){dom.initAutoMoreMenu(self.$section_placeholder,{maxWidth:function(){return self.$el.width()-(self.$menu_toggle.outerWidth(true)+self.$menu_brand_placeholder.outerWidth(true)+self.systray_menu.$el.outerWidth(true));},});});return Promise.all([this._super.apply(this,arguments),autoMoreMenu]);},toggle_mode:function(home_menu,overapp){this.home_menu_displayed=!!home_menu;this.backbutton_displayed=this.home_menu_displayed&&!!overapp;this.$menu_toggle.toggleClass('fa-chevron-left',this.home_menu_displayed).toggleClass('fa-th',!this.home_menu_displayed);this.$menu_toggle.toggleClass('d-none',this.home_menu_displayed&&!this.backbutton_displayed);this.$menu_brand_placeholder.toggleClass('d-none',this.home_menu_displayed);this.$section_placeholder.toggleClass('d-none',this.home_menu_displayed);if(!home_menu){core.bus.trigger('resize');}},change_menu_section:function(primary_menu_id){if(!this.$menu_sections[primary_menu_id]){this._updateMenuBrand();return;}
if(this.current_primary_menu===primary_menu_id){return;}
if(this.current_primary_menu){this.$menu_sections[this.current_primary_menu].detach();}
for(var i=0;i<this.menu_data.children.length;i++){if(this.menu_data.children[i].id===primary_menu_id){this._updateMenuBrand(this.menu_data.children[i].name);break;}}
this.$menu_sections[primary_menu_id].appendTo(this.$section_placeholder);this.current_primary_menu=primary_menu_id;core.bus.trigger('resize');},_trigger_menu_clicked:function(menu_id,action_id){this.trigger_up('menu_clicked',{id:menu_id,action_id:action_id,previous_menu_id:this.current_secondary_menu||this.current_primary_menu,});},_updateMenuBrand:function(brandName){if(brandName){this.$menu_brand_placeholder.text(brandName).show();this.$section_placeholder.show();}else{this.$menu_brand_placeholder.hide()
this.$section_placeholder.hide();}},_on_secondary_menu_click:function(menu_id,action_id){var self=this;if(action_id){self._trigger_menu_clicked(menu_id,action_id);this.current_secondary_menu=menu_id;}},action_id_to_primary_menu_id:function(action_id){var primary_menu_id,found;for(var i=0;i<this.menu_data.children.length&&!primary_menu_id;i++){found=this._action_id_in_subtree(this.menu_data.children[i],action_id);if(found){primary_menu_id=this.menu_data.children[i].id;}}
return primary_menu_id;},_action_id_in_subtree:function(root,action_id){if(root.action&&root.action.split(',')[1]===String(action_id)){return true;}
var found;for(var i=0;i<root.children.length&&!found;i++){found=this._action_id_in_subtree(root.children[i],action_id);}
return found;},menu_id_to_action_id:function(menu_id,root){if(!root){root=$.extend(true,{},this.menu_data);}
if(root.id===menu_id){return root.action.split(',')[1];}
for(var i=0;i<root.children.length;i++){var action_id=this.menu_id_to_action_id(menu_id,root.children[i]);if(action_id!==undefined){return action_id;}}
return undefined;},getCurrentPrimaryMenu:function(){return this.current_primary_menu;},_onAppNameClicked:function(ev){ev.preventDefault();var actionID=this.menu_id_to_action_id(this.current_primary_menu);this._trigger_menu_clicked(this.current_primary_menu,actionID);},_onMouseOverMenu:function(ev){if(config.device.isMobile){return;}
var $target=$(ev.currentTarget);var $opened=$target.siblings('.show');if($opened.length){$opened.find('[data-toggle="dropdown"]:first').dropdown('toggle');$opened.removeClass('show');$target.find('[data-toggle="dropdown"]:first').dropdown('toggle');$target.addClass('show');}},_onToggleHomeMenu:function(ev){ev.preventDefault();this.trigger_up(this.home_menu_displayed?'hide_home_menu':'show_home_menu');this.$el.parent().removeClass('o_mobile_menu_opened');},});return Menu;});;

/* /web/static/src/js/chrome/apps_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.AppsMenu',function(require){"use strict";var Widget=require('web.Widget');var AppsMenu=Widget.extend({template:'AppsMenu',events:{'click .o_app':'_onAppsMenuItemClicked',},init:function(parent,menuData){this._super.apply(this,arguments);this._activeApp=undefined;this._apps=_.map(menuData.children,function(appMenuData){return{actionID:parseInt(appMenuData.action.split(',')[1]),menuID:appMenuData.id,name:appMenuData.name,xmlID:appMenuData.xmlid,};});},getApps:function(){return this._apps;},openFirstApp:function(){if(!this._apps.length){return}
var firstApp=this._apps[0];this._openApp(firstApp);},_openApp:function(app){this._setActiveApp(app);this.trigger_up('app_clicked',{action_id:app.actionID,menu_id:app.menuID,});},_setActiveApp:function(app){var $oldActiveApp=this.$('.o_app.active');$oldActiveApp.removeClass('active');var $newActiveApp=this.$('.o_app[data-action-id="'+app.actionID+'"]');$newActiveApp.addClass('active');},_onAppsMenuItemClicked:function(ev){var $target=$(ev.currentTarget);var actionID=$target.data('action-id');var menuID=$target.data('menu-id');var app=_.findWhere(this._apps,{actionID:actionID,menuID:menuID});this._openApp(app);},});return AppsMenu;});;

/* /web/static/src/js/widgets/dropdown_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.DropdownMenu',function(require){"use strict";var core=require('web.core');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var DropdownMenu=Widget.extend({template:'web.DropdownMenu',events:{'click .o_menu_item':'_onItemClick','click .o_item_option':'_onOptionClick','click span.o_trash_button':'_onTrashButtonClick','hidden.bs.dropdown':'_onBootstrapClose','click .dropdown-item-text':'_onDropDownItemTextClick',},init:function(parent,items){this._super(parent);this.dropdownCategory=null;this.dropdownTitle=null;this.dropdownIcon=null;this.dropdownSymbol=false;this.dropdownStyle={el:{class:'btn-group o_dropdown',attrs:{}},mainButton:{class:'o_dropdown_toggler_btn btn btn-secondary '+'dropdown-toggle '+
(this.dropdownSymbol?'o-no-caret':'')},};this.items=items;this.openItems={};},start:function(){this.$menu=this.$('.o_dropdown_menu');this.$dropdownReference=this.$('.o_dropdown_toggler_btn');if(_t.database.parameters.direction==='rtl'){this.$menu.addClass('dropdown-menu-right');}
return this._super.apply(this,arguments);},update:function(items){this.items=items;this._renderMenuItems();},_renderMenuItems:function(){var newMenuItems=QWeb.render('DropdownMenu.MenuItems',{widget:this});this.$el.find('.o_menu_item, .dropdown-divider[data-removable="1"]').remove();this.$('.o_dropdown_menu').prepend(newMenuItems);},_onBootstrapClose:function(){this.openItems={};this._renderMenuItems();},_onDropDownItemTextClick:function(ev){ev.stopPropagation();},_onItemClick:function(event){event.preventDefault();event.stopPropagation();var id=$(event.currentTarget).data('id');var item=this.items.find(function(item){return item.id===id;});if(item.hasOptions){this.openItems[id]=!this.openItems[id];this._renderMenuItems();}else{this.trigger_up('menu_item_clicked',{id:id});}},_onOptionClick:function(event){event.preventDefault();event.stopPropagation();var optionId=$(event.currentTarget).data('option_id');var id=$(event.currentTarget).data('item_id');this.trigger_up('item_option_clicked',{id:id,optionId:optionId});},_onTrashButtonClick:function(event){},});return DropdownMenu;});;

/* /web/static/src/js/widgets/pie_chart.js defined in bundle 'web.assets_backend' */
odoo.define('web.PieChart',function(require){"use strict";var core=require('web.core');var Domain=require('web.Domain');var viewRegistry=require('web.view_registry');var Widget=require('web.Widget');var widgetRegistry=require('web.widget_registry');var qweb=core.qweb;var PieChart=Widget.extend({className:'o_pie_chart',xmlDependencies:['/web/static/src/xml/chart.xml'],init:function(parent,record,node){this._super.apply(this,arguments);var modifiers=node.attrs.modifiers;var domain=record.domain.concat(Domain.prototype.stringToArray(modifiers.domain||'[]'));var arch=qweb.render('web.PieChart',{modifiers:modifiers,title:node.attrs.title||modifiers.title||modifiers.measure,});var pieChartContext=JSON.parse(JSON.stringify(record.context));delete pieChartContext.graph_mode;delete pieChartContext.graph_measure;delete pieChartContext.graph_groupbys;this.subViewParams={modelName:record.model,withControlPanel:false,isEmbedded:true,mode:'pie',};this.subViewParams.searchQuery={context:pieChartContext,domain:domain,groupBy:[],};this.viewInfo={arch:arch,fields:record.fields,viewFields:record.fieldsInfo.dashboard,};},willStart:function(){var self=this;var def1=this._super.apply(this,arguments);var SubView=viewRegistry.get('graph');var subView=new SubView(this.viewInfo,this.subViewParams);var def2=subView.getController(this).then(function(controller){self.controller=controller;return self.controller.appendTo(document.createDocumentFragment());});return Promise.all([def1,def2]);},start:function(){this.$el.append(this.controller.$el);return this._super.apply(this,arguments);},on_attach_callback:function(){this.controller.on_attach_callback();},});widgetRegistry.add('pie_chart',PieChart);return PieChart;});;

/* /web/static/src/js/widgets/ribbon.js defined in bundle 'web.assets_backend' */
odoo.define('web.ribbon',function(require){'use strict';var widgetRegistry=require('web.widget_registry');var Widget=require('web.Widget');var RibbonWidget=Widget.extend({template:'web.ribbon',xmlDependencies:['/web/static/src/xml/ribbon.xml'],init:function(parent,data,options){this._super.apply(this,arguments);this.text=options.attrs.title||options.attrs.text;this.bgColor=options.attrs.bg_color;}});widgetRegistry.add('web_ribbon',RibbonWidget);return RibbonWidget;});;

/* /web/static/src/js/apps.js defined in bundle 'web.assets_backend' */
odoo.define('web.Apps',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var config=require('web.config');var core=require('web.core');var framework=require('web.framework');var session=require('web.session');var _t=core._t;var apps_client=null;var Apps=AbstractAction.extend({contentTemplate:'EmptyComponent',remote_action_tag:'loempia.embed',failback_action_id:'base.open_module_tree',init:function(parent,action){this._super(parent,action);var options=action.params||{};this.params=options;},get_client:function(){var check_client_available=function(client){var i=new Image();var def=new Promise(function(resolve,reject){i.onerror=function(){reject(client);};i.onload=function(){resolve(client);};});var ts=new Date().getTime();i.src=_.str.sprintf('%s/web/static/src/img/sep-a.gif?%s',client.origin,ts);return def;};if(apps_client){return check_client_available(apps_client);}else{return this._rpc({model:'ir.module.module',method:'get_apps_server'}).then(function(u){var link=$(_.str.sprintf('<a href="%s"></a>',u))[0];var host=_.str.sprintf('%s//%s',link.protocol,link.host);var dbname=link.pathname;if(dbname[0]==='/'){dbname=dbname.substr(1);}
var client={origin:host,dbname:dbname};apps_client=client;return check_client_available(client);});}},destroy:function(){$(window).off("message."+this.uniq);if(this.$ifr){this.$ifr.remove();this.$ifr=null;}
return this._super();},_on_message:function($e){var self=this,client=this.client,e=$e.originalEvent;if(e.origin!==client.origin){return;}
var dispatcher={'event':function(m){self.trigger('message:'+m.event,m);},'action':function(m){self.do_action(m.action).then(function(r){var w=self.$ifr[0].contentWindow;w.postMessage({id:m.id,result:r},client.origin);});},'rpc':function(m){return self._rpc({route:m.args[0],params:m.args[1]}).then(function(r){var w=self.$ifr[0].contentWindow;w.postMessage({id:m.id,result:r},client.origin);});},'Model':function(m){return self._rpc({model:m.model,method:m.args[0],args:m.args[1]}).then(function(r){var w=self.$ifr[0].contentWindow;w.postMessage({id:m.id,result:r},client.origin);});},};if(!_.isObject(e.data)){return;}
if(dispatcher[e.data.type]){dispatcher[e.data.type](e.data);}},start:function(){var self=this;return new Promise(function(resolve,reject){self.get_client().then(function(client){self.client=client;var qs={db:client.dbname};if(config.isDebug()){qs.debug=odoo.debug;}
var u=$.param.querystring(client.origin+"/apps/embed/client",qs);var css={width:'100%',height:'750px'};self.$ifr=$('<iframe>').attr('src',u);self.uniq=_.uniqueId('apps');$(window).on("message."+self.uniq,self.proxy('_on_message'));self.on('message:ready',self,function(m){var w=this.$ifr[0].contentWindow;var act={type:'ir.actions.client',tag:this.remote_action_tag,params:_.extend({},this.params,{db:session.db,origin:session.origin,})};w.postMessage({type:'action',action:act},client.origin);});self.on('message:set_height',self,function(m){this.$ifr.height(m.height);});self.on('message:blockUI',self,function(){framework.blockUI();});self.on('message:unblockUI',self,function(){framework.unblockUI();});self.on('message:warn',self,function(m){self.do_warn(m.title,m.message,m.sticky);});self.$ifr.appendTo(self.$('.o_content')).css(css).addClass('apps-client');resolve();},function(){self.do_warn(_t('Odoo Apps will be available soon'),_t('Showing locally available modules'),true);return self._rpc({route:'/web/action/load',params:{action_id:self.failback_action_id},}).then(function(action){return self.do_action(action);}).then(reject,reject);});});}});var AppsUpdates=Apps.extend({remote_action_tag:'loempia.embed.updates',});core.action_registry.add("apps",Apps);core.action_registry.add("apps.updates",AppsUpdates);return Apps;});;

/* /web/static/src/js/fields/abstract_field.js defined in bundle 'web.assets_backend' */
odoo.define('web.AbstractField',function(require){"use strict";var field_utils=require('web.field_utils');var Widget=require('web.Widget');var AbstractField=Widget.extend({events:{'keydown':'_onKeydown',},custom_events:{navigation_move:'_onNavigationMove',},fieldDependencies:{},resetOnAnyFieldChange:false,specialData:false,supportedFieldTypes:[],description:"",noLabel:false,init:function(parent,name,record,options){this._super(parent);options=options||{};this.name=name;this.record=record;this.field=record.fields[name];this.viewType=options.viewType||'default';var fieldsInfo=record.fieldsInfo[this.viewType];this.attrs=options.attrs||(fieldsInfo&&fieldsInfo[name])||{};this.additionalContext=options.additionalContext||{};this.value=record.data[name];this.recordData=record.data;this.string=this.attrs.string||this.field.string||this.name;this.nodeOptions=this.attrs.options||{};this.dataPointID=record.id;this.res_id=record.res_id;this.model=record.model;this.mode=options.mode||"readonly";this._isValid=true;this.lastSetValue=undefined;this.formatType=this.attrs.widget in field_utils.format?this.attrs.widget:this.field.type;this.formatOptions={};this.parseOptions={};if(this.attrs.decorations){this.resetOnAnyFieldChange=true;}},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.$el.attr('name',self.name);self.$el.addClass('o_field_widget');return self._render();});},activate:function(options){if(this.isFocusable()){var $focusable=this.getFocusableElement();$focusable.focus();if($focusable.is('input[type="text"], textarea')){$focusable[0].selectionStart=$focusable[0].selectionEnd=$focusable[0].value.length;if(options&&!options.noselect){$focusable.select();}}
return true;}
return false;},commitChanges:function(){},getFocusableElement:function(){return $();},isFocusable:function(){var $focusable=this.getFocusableElement();return $focusable.length&&$focusable.is(':visible');},isSet:function(){return!!this.value;},isValid:function(){return this._isValid;},reset:function(record,event){this._reset(record,event);return this._render()||Promise.resolve();},removeInvalidClass:function(){this.$el.removeClass('o_field_invalid');this.$el.removeAttr('aria-invalid');},setIDForLabel:function(id){this.getFocusableElement().attr('id',id);},setInvalidClass:function(){this.$el.addClass('o_field_invalid');this.$el.attr('aria-invalid','true');},updateModifiersValue:function(modifiers){this.attrs.modifiersValue=modifiers||{};},_applyDecorations:function(){var self=this;this.attrs.decorations.forEach(function(dec){var isToggled=py.PY_isTrue(py.evaluate(dec.expression,self.record.evalContext));self.$el.toggleClass(dec.className,isToggled);});},_formatValue:function(value){var options=_.extend({},this.nodeOptions,{data:this.recordData},this.formatOptions);return field_utils.format[this.formatType](value,this.field,options);},_isSameValue:function(value){return this.value===value;},_parseValue:function(value){return field_utils.parse[this.formatType](value,this.field,this.parseOptions);},_render:function(){if(this.attrs.decorations){this._applyDecorations();}
if(this.mode==='edit'){return this._renderEdit();}else if(this.mode==='readonly'){return this._renderReadonly();}},_renderEdit:function(){},_renderReadonly:function(){},_reset:function(record,event){this.lastSetValue=undefined;this.record=record;this.value=record.data[this.name];this.recordData=record.data;},_setValue:function(value,options){if(this.lastSetValue===value||(this.value===false&&value==='')){return Promise.resolve();}
this.lastSetValue=value;try{value=this._parseValue(value);this._isValid=true;}catch(e){this._isValid=false;this.trigger_up('set_dirty',{dataPointID:this.dataPointID});return Promise.reject({message:"Value set is not valid"});}
if(!(options&&options.forceChange)&&this._isSameValue(value)){return Promise.resolve();}
var self=this;return new Promise(function(resolve,reject){var changes={};changes[self.name]=value;self.trigger_up('field_changed',{dataPointID:self.dataPointID,changes:changes,viewType:self.viewType,doNotSetDirty:options&&options.doNotSetDirty,notifyChange:!options||options.notifyChange!==false,allowWarning:options&&options.allowWarning,onSuccess:resolve,onFailure:reject,});});},_onKeydown:function(ev){switch(ev.which){case $.ui.keyCode.TAB:var event=this.trigger_up('navigation_move',{direction:ev.shiftKey?'previous':'next',});if(event.is_stopped()){ev.preventDefault();ev.stopPropagation();}
break;case $.ui.keyCode.ENTER:ev.preventDefault();ev.stopPropagation();this.trigger_up('navigation_move',{direction:'next_line'});break;case $.ui.keyCode.ESCAPE:this.trigger_up('navigation_move',{direction:'cancel',originalEvent:ev});break;case $.ui.keyCode.UP:ev.stopPropagation();this.trigger_up('navigation_move',{direction:'up'});break;case $.ui.keyCode.RIGHT:ev.stopPropagation();this.trigger_up('navigation_move',{direction:'right'});break;case $.ui.keyCode.DOWN:ev.stopPropagation();this.trigger_up('navigation_move',{direction:'down'});break;case $.ui.keyCode.LEFT:ev.stopPropagation();this.trigger_up('navigation_move',{direction:'left'});break;}},_onNavigationMove:function(ev){ev.data.target=this;},});return AbstractField;});;

/* /web/static/src/js/fields/basic_fields.js defined in bundle 'web.assets_backend' */
odoo.define('web.basic_fields',function(require){"use strict";var AbstractField=require('web.AbstractField');var config=require('web.config');var core=require('web.core');var datepicker=require('web.datepicker');var dom=require('web.dom');var Domain=require('web.Domain');var DomainSelector=require('web.DomainSelector');var DomainSelectorDialog=require('web.DomainSelectorDialog');var framework=require('web.framework');var py_utils=require('web.py_utils');var session=require('web.session');var utils=require('web.utils');var view_dialogs=require('web.view_dialogs');var field_utils=require('web.field_utils');var time=require('web.time');var ColorpickerDialog=require('web.ColorpickerDialog');require("web.zoomodoo");var qweb=core.qweb;var _t=core._t;var _lt=core._lt;var TranslatableFieldMixin={_renderTranslateButton:function(){if(_t.database.multi_lang&&this.field.translate){var lang=_t.database.parameters.code.split('_')[0].toUpperCase();return $(`<span class="o_field_translate btn btn-link">${lang}</span>`).on('click',this._onTranslate.bind(this));}
return $();},_onTranslate:function(ev){ev.preventDefault();this.trigger_up('translate',{fieldName:this.name,id:this.dataPointID,isComingFromTranslationAlert:false,});},};var DebouncedField=AbstractField.extend({DEBOUNCE:1000000000,init:function(){this._super.apply(this,arguments);this._isDirty=false;if(this.mode==='edit'){if(this.DEBOUNCE){this._doDebouncedAction=_.debounce(this._doAction,this.DEBOUNCE);}else{this._doDebouncedAction=this._doAction;}
var self=this;var debouncedFunction=this._doDebouncedAction;this._doDebouncedAction=function(){self._isDirty=true;debouncedFunction.apply(self,arguments);};}},commitChanges:function(){if(this._isDirty&&this.mode==='edit'){return this._doAction();}},_doAction:function(){if(!this.isDestroyed()){return this._setValue(this._getValue());}},_getValue:function(){},});var InputField=DebouncedField.extend({custom_events:_.extend({},DebouncedField.prototype.custom_events,{field_changed:'_onFieldChanged',}),events:_.extend({},DebouncedField.prototype.events,{'input':'_onInput','change':'_onChange',}),init:function(){this._super.apply(this,arguments);this.nodeOptions.isPassword='password'in this.attrs;if(this.mode==='edit'){this.tagName='input';}
this.isDirty=false;this.lastChangeEvent=undefined;},getFocusableElement:function(){return this.$input||$();},reset:function(record,event){this._reset(record,event);if(!event||event===this.lastChangeEvent){this.isDirty=false;}
if(this.isDirty||(event&&event.target===this&&event.data.changes&&event.data.changes[this.name]===this.value)){if(this.attrs.decorations){this._applyDecorations();}
return Promise.resolve();}else{return this._render();}},_getValue:function(){return this.$input.val();},_prepareInput:function($input){this.$input=$input||$("<input/>");this.$input.addClass('o_input');var inputAttrs={placeholder:this.attrs.placeholder||""};var inputVal;if(this.nodeOptions.isPassword){inputAttrs=_.extend(inputAttrs,{type:'password',autocomplete:'new-password'});inputVal=this.value||'';}else{inputAttrs=_.extend(inputAttrs,{type:'text',autocomplete:this.attrs.autocomplete});inputVal=this._formatValue(this.value);}
this.$input.attr(inputAttrs);this.$input.val(inputVal);return this.$input;},_renderEdit:function(){this._prepareInput(this.$el);},_renderReadonly:function(){this.$el.text(this._formatValue(this.value));},_onChange:function(){this._doAction();},_onFieldChanged:function(event){this.lastChangeEvent=event;},_onInput:function(){this.isDirty=true;this._doDebouncedAction();},_onNavigationMove:function(ev){this._super.apply(this,arguments);if(this.mode==='edit'&&ev.data.direction!=='cancel'){var input=this.$input[0];var selecting=(input.selectionEnd!==input.selectionStart);if((ev.data.direction==="left"&&(selecting||input.selectionStart!==0))||(ev.data.direction==="right"&&(selecting||input.selectionStart!==input.value.length))){ev.stopPropagation();}
if(ev.data.direction==='next'&&this.attrs.modifiersValue&&this.attrs.modifiersValue.required&&this.viewType!=='list'){if(!this.$input.val()){this.setInvalidClass();ev.stopPropagation();}else{this.removeInvalidClass();}}}},});var NumericField=InputField.extend({tagName:'span',isSet:function(){return this.value===0||this._super.apply(this,arguments);},_evalFormula:function(expr,context){var val=expr.replace(new RegExp(/( )/g),'');var safeEvalString='';for(let v of val.split(new RegExp(/([-+*/()^])/g))){if(!['+','-','*','/','(',')','^'].includes(v)&&v.length){v=field_utils.parse.float(v);}
if(v==='^'){v='**';}
safeEvalString+=v;};return py_utils.py_eval(safeEvalString,context);},_formatValue:function(value){if(this.mode==='edit'&&this.nodeOptions.type==='number'){return value;}
return this._super.apply(this,arguments);},_parseValue:function(value){if(this.mode==='edit'&&this.nodeOptions.type==='number'){return Number(value);}
return this._super.apply(this,arguments);},_prepareInput:function($input){var result=this._super.apply(this,arguments);if(this.nodeOptions.type==='number'){this.$input.attr({type:'number'});}
if(this.nodeOptions.step){this.$input.attr({step:this.nodeOptions.step});}
return result;},_setValue:function(value,options){var originalValue=value;value=value.trim();if(value.startsWith('=')){try{value=this._evalFormula(value.substr(1));value=this._formatValue(value);this.$input.val(value);}catch(err){value=originalValue;}}
return this._super(value,options);},});var FieldChar=InputField.extend(TranslatableFieldMixin,{description:_lt("Text"),className:'o_field_char',tagName:'span',supportedFieldTypes:['char'],_renderEdit:function(){var def=this._super.apply(this,arguments);if(this.field.size&&this.field.size>0){this.$el.attr('maxlength',this.field.size);}
if(this.field.translate){this.$el=this.$el.add(this._renderTranslateButton());this.$el.addClass('o_field_translate');}
return def;},_setValue:function(value,options){if(this.field.trim){value=value.trim();}
return this._super(value,options);},});var LinkButton=AbstractField.extend({events:_.extend({},AbstractField.prototype.events,{'click':'_onClick'}),_render:function(){if(this.value){var className=this.attrs.icon||'fa-globe';this.$el.html("<span role='img'/>");this.$el.addClass("fa "+className);this.$el.attr('title',this.value);this.$el.attr('aria-label',this.value);}},_onClick:function(event){event.stopPropagation();window.open(this.value,'_blank');},});var FieldDateRange=InputField.extend({className:'o_field_date_range',tagName:'span',jsLibs:['/web/static/lib/daterangepicker/daterangepicker.js','/web/static/src/js/libs/daterangepicker.js',],cssLibs:['/web/static/lib/daterangepicker/daterangepicker.css',],supportedFieldTypes:['date','datetime'],init:function(){this._super.apply(this,arguments);this.isDateField=this.formatType==='date';this.dateRangePickerOptions=_.defaults({},this.nodeOptions.picker_options||{},{timePicker:!this.isDateField,timePicker24Hour:_t.database.parameters.time_format.search('%H')!==-1,autoUpdateInput:false,timePickerIncrement:5,locale:{applyLabel:_t('Apply'),cancelLabel:_t('Cancel'),format:this.isDateField?time.getLangDateFormat():time.getLangDatetimeFormat(),},});this.relatedEndDate=this.nodeOptions.related_end_date;this.relatedStartDate=this.nodeOptions.related_start_date;},destroy:function(){if(this.$pickerContainer){this.$pickerContainer.remove();}
if(this._onScroll){window.removeEventListener('scroll',this._onScroll,true);}
this._super.apply(this,arguments);},isValid:function(){const value=this.mode==="readonly"?this.value:this.$input.val();try{return field_utils.parse[this.formatType](value,this.field,{timezone:true})||true;}catch(error){return false;}},_getValue:function(){try{this.removeInvalidClass();return field_utils.parse[this.formatType](this.$input.val(),this.field,{timezone:true});}catch(error){this.setInvalidClass();return false;}},_applyChanges:function(ev,picker){var changes={};var displayStartDate=field_utils.format[this.formatType](picker.startDate,{},{timezone:false});var displayEndDate=field_utils.format[this.formatType](picker.endDate,{},{timezone:false});var changedStartDate=picker.startDate;var changedEndDate=picker.endDate;if(this.isDateField){changedStartDate=picker.startDate.add(session.getTZOffset(picker.startDate),'minutes');changedEndDate=picker.endDate.startOf('day').add(session.getTZOffset(picker.endDate),'minutes');}
if(this.relatedEndDate){this.$el.val(displayStartDate);changes[this.name]=this._parseValue(changedStartDate);changes[this.relatedEndDate]=this._parseValue(changedEndDate);}
if(this.relatedStartDate){this.$el.val(displayEndDate);changes[this.name]=this._parseValue(changedEndDate);changes[this.relatedStartDate]=this._parseValue(changedStartDate);}
this.trigger_up('field_changed',{dataPointID:this.dataPointID,viewType:this.viewType,changes:changes,});},_renderEdit:function(){this._super.apply(this,arguments);var self=this;var startDate;var endDate;if(this.relatedEndDate){startDate=this._formatValue(this.value);endDate=this._formatValue(this.recordData[this.relatedEndDate]);}
if(this.relatedStartDate){startDate=this._formatValue(this.recordData[this.relatedStartDate]);endDate=this._formatValue(this.value);}
this.dateRangePickerOptions.startDate=startDate||moment();this.dateRangePickerOptions.endDate=endDate||moment();this.$el.daterangepicker(this.dateRangePickerOptions);this.$el.on('apply.daterangepicker',this._applyChanges.bind(this));this.$el.on('show.daterangepicker',this._onDateRangePickerShow.bind(this));this.$el.on('hide.daterangepicker',this._onDateRangePickerHide.bind(this));this.$el.off('keyup.daterangepicker');this.$pickerContainer=this.$el.data('daterangepicker').container;this.$pickerContainer.on('click',function(ev){ev.stopPropagation();if($(ev.target).hasClass('applyBtn')){self.$el.data('daterangepicker').hide();}});this.$pickerContainer.on('focusin.bs.modal','select',function(ev){ev.stopPropagation();});},_onDateRangePickerHide(){if(this._onScroll){window.removeEventListener('scroll',this._onScroll,true);}},_onDateRangePickerShow(){this._onScroll=ev=>{if(!config.device.isMobile&&!this.$pickerContainer.get(0).contains(ev.target)){let data=this.$el.data('daterangepicker');if(data){data.hide();}}};window.addEventListener('scroll',this._onScroll,true);},});var FieldDate=InputField.extend({description:_lt("Date"),className:"o_field_date",tagName:"span",supportedFieldTypes:['date','datetime'],events:AbstractField.prototype.events,init:function(){this._super.apply(this,arguments);this.formatOptions.timezone=true;this.datepickerOptions=_.defaults({},this.nodeOptions.datepicker||{},{defaultDate:this.value});},start:function(){var self=this;var prom;if(this.mode==='edit'){this.datewidget=this._makeDatePicker();this.datewidget.on('datetime_changed',this,function(){var value=this._getValue();if((!value&&this.value)||(value&&!this._isSameValue(value))){this._setValue(value);}});prom=this.datewidget.appendTo('<div>').then(function(){self.datewidget.$el.addClass(self.$el.attr('class'));self._prepareInput(self.datewidget.$input);self._replaceElement(self.datewidget.$el);});}
return Promise.resolve(prom).then(this._super.bind(this));},activate:function(){if(this.isFocusable()&&this.datewidget){this.datewidget.$input.select();return true;}
return false;},_doDebouncedAction:function(){this.datewidget.changeDatetime();},_getValue:function(){return this.datewidget.getValue();},_isSameValue:function(value){if(value===false){return this.value===false;}
return value.isSame(this.value,'day');},_makeDatePicker:function(){return new datepicker.DateWidget(this,this.datepickerOptions);},_renderEdit:function(){this.datewidget.setValue(this.value);this.$input=this.datewidget.$input;},});var FieldDateTime=FieldDate.extend({description:_lt("Date & Time"),supportedFieldTypes:['datetime'],init:function(){this._super.apply(this,arguments);if(this.value){var offset=this.getSession().getTZOffset(this.value);var displayedValue=this.value.clone().add(offset,'minutes');this.datepickerOptions.defaultDate=displayedValue;}},_getValue:function(){var value=this.datewidget.getValue();return value&&value.add(-this.getSession().getTZOffset(value),'minutes');},_isSameValue:function(value){if(value===false){return this.value===false;}
return value.isSame(this.value);},_makeDatePicker:function(){return new datepicker.DateTimeWidget(this,this.datepickerOptions);},_renderEdit:function(){var value=this.value&&this.value.clone().add(this.getSession().getTZOffset(this.value),'minutes');this.datewidget.setValue(value);this.$input=this.datewidget.$input;},});var FieldMonetary=NumericField.extend({description:_lt("Monetary"),className:'o_field_monetary o_field_number',tagName:'span',supportedFieldTypes:['float','monetary'],resetOnAnyFieldChange:true,init:function(){this._super.apply(this,arguments);this._setCurrency();if(this.mode==='edit'){this.tagName='div';this.className+=' o_input';this.formatOptions.noSymbol=true;}
this.formatOptions.currency=this.currency;this.formatOptions.digits=[16,2];this.formatOptions.field_digits=this.nodeOptions.field_digits;},isSet:function(){return this.value===0||this._super.apply(this,arguments);},_renderEdit:function(){this.$el.empty();var def=this._prepareInput(this.$input).appendTo(this.$el);if(this.currency){var $currencySymbol=$('<span>',{text:this.currency.symbol});if(this.currency.position==="after"){this.$el.append($currencySymbol);}else{this.$el.prepend($currencySymbol);}}
return def;},_renderReadonly:function(){this.$el.html(this._formatValue(this.value));},_reset:function(){this._super.apply(this,arguments);this._setCurrency();},_setCurrency:function(){var currencyField=this.nodeOptions.currency_field||this.field.currency_field||'currency_id';var currencyID=this.record.data[currencyField]&&this.record.data[currencyField].res_id;this.currency=session.get_currency(currencyID);this.formatOptions.currency=this.currency;},});var FieldBoolean=AbstractField.extend({className:'o_field_boolean',description:_lt("Checkbox"),events:_.extend({},AbstractField.prototype.events,{change:'_onChange',}),supportedFieldTypes:['boolean'],activate:function(options){var activated=this._super.apply(this,arguments);if(activated&&options&&options.event&&$(options.event.target).closest('.custom-control.custom-checkbox').length){this._setValue(!this.value);}
return activated;},getFocusableElement:function(){return this.mode==='readonly'?$():this.$input;},isSet:function(){return true;},reset:function(record,event){var rendered=this._super.apply(this,arguments);if(event&&event.target.name===this.name){this.activate();}
return rendered;},setIDForLabel:function(id){this._super.apply(this,arguments);this.$('.custom-control-label').attr('for',id);},_render:function(){var $checkbox=this._formatValue(this.value);this.$input=$checkbox.find('input');this.$input.prop('disabled',this.mode==='readonly');this.$el.addClass($checkbox.attr('class'));this.$el.empty().append($checkbox.contents());},_onChange:function(){this._setValue(this.$input[0].checked);},_onKeydown:function(ev){switch(ev.which){case $.ui.keyCode.ENTER:ev.preventDefault();this.$input.prop('checked',!this.value);this._setValue(!this.value);return;case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:ev.preventDefault();}
this._super.apply(this,arguments);},});var FieldInteger=NumericField.extend({description:_lt("Integer"),className:'o_field_integer o_field_number',supportedFieldTypes:['integer'],_formatValue:function(value){if(typeof value==='string'){if(!/^[0-9]+-/.test(value)){throw new Error('"'+value+'" is not an integer or a virtual id');}
return value;}
return this._super.apply(this,arguments);},});var FieldFloat=NumericField.extend({description:_lt("Decimal"),className:'o_field_float o_field_number',supportedFieldTypes:['float'],init:function(){this._super.apply(this,arguments);if(this.attrs.digits){this.nodeOptions.digits=JSON.parse(this.attrs.digits);}},});var FieldFloatTime=FieldFloat.extend({description:_lt("Time"),formatType:'float_time',init:function(){this._super.apply(this,arguments);this.formatType='float_time';}});var FieldFloatFactor=FieldFloat.extend({supportedFieldTypes:['float'],className:'o_field_float_factor',formatType:'float_factor',init:function(){this._super.apply(this,arguments);if(!this.nodeOptions.factor){this.nodeOptions.factor=1;}
this.parseOptions=this.nodeOptions;}});var FieldFloatToggle=AbstractField.extend({supportedFieldTypes:['float'],formatType:'float_factor',className:'o_field_float_toggle',tagName:'span',events:{click:'_onClick'},init:function(){this._super.apply(this,arguments);this.formatType='float_factor';if(this.mode==='edit'){this.tagName='button';}
if(this.attrs.digits){this.nodeOptions.digits=JSON.parse(this.attrs.digits);}
if(!this.nodeOptions.factor){this.nodeOptions.factor=1;}
if(!this.nodeOptions.range){this.nodeOptions.range=[0.0,0.5,1.0];}
this.parseOptions=this.nodeOptions;},_getDisplayedValue:function(){var usrFormatValue=this._formatValue(this.value);return field_utils.parse['float'](usrFormatValue);},_renderEdit:function(){this.$el.text(this._formatValue(this.value));},_renderReadonly:function(){this.$el.text(this._formatValue(this.value));},_nextValue:function(){var range=this.nodeOptions.range;var val=utils.closestNumber(this._getDisplayedValue(),range);var index=_.indexOf(range,val);if(index!==-1){if(index+1<range.length){return range[index+1];}}
return range[0];},_onClick:function(ev){if(this.mode==='edit'){ev.stopPropagation();var next_val=this._nextValue();next_val=field_utils.format['float'](next_val);this._setValue(next_val);}},});var FieldPercentage=FieldFloat.extend({description:_lt("Percentage"),formatType:'percentage',});var FieldText=InputField.extend(TranslatableFieldMixin,{description:_lt("Multiline Text"),className:'o_field_text',supportedFieldTypes:['text','html'],tagName:'span',init:function(){this._super.apply(this,arguments);if(this.mode==='edit'){this.tagName='textarea';}
this.autoResizeOptions={parent:this};},start:function(){if(this.mode==='edit'){dom.autoresize(this.$el,this.autoResizeOptions);if(this.field.translate){this.$el=this.$el.add(this._renderTranslateButton());this.$el.addClass('o_field_translate');}}
return this._super();},reset:function(){var self=this;return Promise.resolve(this._super.apply(this,arguments)).then(function(){if(self.mode==='edit'){self.$input.trigger('change');}});},_onKeydown:function(ev){if(ev.which===$.ui.keyCode.ENTER){ev.stopPropagation();return;}
this._super.apply(this,arguments);},});var ListFieldText=FieldText.extend({init:function(){this._super.apply(this,arguments);this.autoResizeOptions.min_height=0;},});var HandleWidget=AbstractField.extend({description:_lt("Handle"),noLabel:true,className:'o_row_handle fa fa-arrows ui-sortable-handle',widthInList:'33px',tagName:'span',supportedFieldTypes:['integer'],isSet:function(){return true;},});var FieldEmail=InputField.extend({description:_lt("Email"),className:'o_field_email',events:_.extend({},InputField.prototype.events,{'click':'_onClick',}),prefix:'mailto',supportedFieldTypes:['char'],init:function(){this._super.apply(this,arguments);this.tagName=this.mode==='readonly'?'a':'input';},getFocusableElement:function(){return this.mode==='readonly'?this.$el:this._super.apply(this,arguments);},_renderReadonly:function(){this.$el.text(this.value).addClass('o_form_uri o_text_overflow').attr('href',this.prefix+':'+this.value);},_onClick:function(ev){ev.stopPropagation();},});var FieldPhone=FieldEmail.extend({description:_lt("Phone"),className:'o_field_phone',prefix:'tel',_renderReadonly:function(){this._super();this.$el.removeClass('o_text_overflow');},});var UrlWidget=InputField.extend({description:_lt("URL"),className:'o_field_url',events:_.extend({},InputField.prototype.events,{'click':'_onClick',}),supportedFieldTypes:['char'],init:function(){this._super.apply(this,arguments);this.tagName=this.mode==='readonly'?'a':'input';},getFocusableElement:function(){return this.mode==='readonly'?this.$el:this._super.apply(this,arguments);},_renderReadonly:function(){this.$el.text(this.attrs.text||this.value).addClass('o_form_uri o_text_overflow').attr('target','_blank').attr('href',this.value);},_onClick:function(ev){ev.stopPropagation();},});var CopyClipboard={destroy:function(){this._super.apply(this,arguments);if(this.clipboard){this.clipboard.destroy();}},_initClipboard:function(){var self=this;var $clipboardBtn=this.$('.o_clipboard_button');$clipboardBtn.tooltip({title:_t('Copied !'),trigger:'manual',placement:'right'});this.clipboard=new ClipboardJS($clipboardBtn[0],{text:function(){return self.value.trim();},container:self.$el[0]});this.clipboard.on('success',function(){_.defer(function(){$clipboardBtn.tooltip('show');_.delay(function(){$clipboardBtn.tooltip('hide');},800);});});},_renderReadonly:function(){this._super.apply(this,arguments);if(this.value){this.$el.append($(qweb.render(this.clipboardTemplate)));this._initClipboard();}}};var TextCopyClipboard=FieldText.extend(CopyClipboard,{description:_lt("Copy to Clipboard"),clipboardTemplate:'CopyClipboardText',className:"o_field_copy",});var CharCopyClipboard=FieldChar.extend(CopyClipboard,{description:_lt("Copy to Clipboard"),clipboardTemplate:'CopyClipboardChar',className:'o_field_copy o_text_overflow',});var AbstractFieldBinary=AbstractField.extend({events:_.extend({},AbstractField.prototype.events,{'change .o_input_file':'on_file_change','click .o_select_file_button':function(){this.$('.o_input_file').click();},'click .o_clear_file_button':'_onClearClick',}),init:function(parent,name,record){this._super.apply(this,arguments);this.fields=record.fields;this.useFileAPI=!!window.FileReader;this.max_upload_size=session.max_file_upload_size||128*1024*1024;if(!this.useFileAPI){var self=this;this.fileupload_id=_.uniqueId('o_fileupload');$(window).on(this.fileupload_id,function(){var args=[].slice.call(arguments).slice(1);self.on_file_uploaded.apply(self,args);});}},destroy:function(){if(this.fileupload_id){$(window).off(this.fileupload_id);}
this._super.apply(this,arguments);},on_file_change:function(e){var self=this;var file_node=e.target;if((this.useFileAPI&&file_node.files.length)||(!this.useFileAPI&&$(file_node).val()!=='')){if(this.useFileAPI){var file=file_node.files[0];if(file.size>this.max_upload_size){var msg=_t("The selected file exceed the maximum file size of %s.");this.do_warn(_t("File upload"),_.str.sprintf(msg,utils.human_size(this.max_upload_size)));return false;}
utils.getDataURLFromFile(file).then(function(data){data=data.split(',')[1];self.on_file_uploaded(file.size,file.name,file.type,data);});}else{this.$('form.o_form_binary_form').submit();}
this.$('.o_form_binary_progress').show();this.$('button').hide();}},on_file_uploaded:function(size,name){if(size===false){this.do_warn(_t("File Upload"),_t("There was a problem while uploading your file"));console.warn("Error while uploading file : ",name);}else{this.on_file_uploaded_and_valid.apply(this,arguments);}
this.$('.o_form_binary_progress').hide();this.$('button').show();},on_file_uploaded_and_valid:function(size,name,content_type,file_base64){this.set_filename(name);this._setValue(file_base64);this._render();},set_filename:function(value){var filename=this.attrs.filename;if(filename&&filename in this.fields){var changes={};changes[filename]=value;this.trigger_up('field_changed',{dataPointID:this.dataPointID,changes:changes,viewType:this.viewType,});}},_clearFile:function(){var self=this;this.$('.o_input_file').val('');this.set_filename('');if(!this.isDestroyed()){this._setValue(false).then(function(){self._render();});}},_onClearClick:function(ev){this._clearFile();},});var FieldBinaryImage=AbstractFieldBinary.extend({description:_lt("Image"),fieldDependencies:_.extend({},AbstractFieldBinary.prototype.fieldDependencies,{__last_update:{type:'datetime'},}),template:'FieldBinaryImage',placeholder:"/web/static/src/img/placeholder.png",events:_.extend({},AbstractFieldBinary.prototype.events,{'click img':function(){if(this.mode==="readonly"){this.trigger_up('bounce_edit');}},}),supportedFieldTypes:['binary'],file_type_magic_word:{'/':'jpg','R':'gif','i':'png','P':'svg+xml',},_getImageUrl:function(model,res_id,field,unique){return session.url('/web/image',{model:model,id:JSON.stringify(res_id),field:field,unique:field_utils.format.datetime(unique).replace(/[^0-9]/g,''),});},_render:function(){var self=this;var url=this.placeholder;if(this.value){if(!utils.is_bin_size(this.value)){url='data:image/'+(this.file_type_magic_word[this.value[0]]||'png')+';base64,'+this.value;}else{var field=this.nodeOptions.preview_image||this.name;var unique=this.recordData.__last_update;url=this._getImageUrl(this.model,this.res_id,field,unique);}}
var $img=$(qweb.render("FieldBinaryImage-img",{widget:this,url:url}));var width=this.nodeOptions.size?this.nodeOptions.size[0]:this.attrs.width;var height=this.nodeOptions.size?this.nodeOptions.size[1]:this.attrs.height;if(width){$img.attr('width',width);$img.css('max-width',width+'px');if(!height){$img.css('height','auto');$img.css('max-height','100%');}}
if(height){$img.attr('height',height);$img.css('max-height',height+'px');if(!width){$img.css('width','auto');$img.css('max-width','100%');}}
this.$('> img').remove();this.$el.prepend($img);$img.one('error',function(){$img.attr('src',self.placeholder);self.do_warn(_t("Image"),_t("Could not display the selected image."));});return this._super.apply(this,arguments);},_renderReadonly:function(){this._super.apply(this,arguments);if(this.nodeOptions.zoom){var unique=this.recordData.__last_update;var url=this._getImageUrl(this.model,this.res_id,'image_1920',unique);var $img;var imageField=_.find(Object.keys(this.recordData),function(o){return o.startsWith('image_');});if(this.nodeOptions.background)
{if('tag'in this.nodeOptions){this.tagName=this.nodeOptions.tag;}
if('class'in this.attrs){this.$el.addClass(this.attrs.class);}
var urlThumb=this._getImageUrl(this.model,this.res_id,'image_128',unique);this.$el.empty();$img=this.$el;$img.css('backgroundImage','url('+urlThumb+')');}else{$img=this.$('img');}
var zoomDelay=0;if(this.nodeOptions.zoom_delay){zoomDelay=this.nodeOptions.zoom_delay;}
if(this.recordData[imageField]){$img.attr('data-zoom',1);$img.attr('data-zoom-image',url);$img.zoomOdoo({event:'mouseenter',timer:zoomDelay,attach:'.o_content',attachToTarget:true,onShow:function(){var zoomHeight=Math.ceil(this.$zoom.height());var zoomWidth=Math.ceil(this.$zoom.width());if(zoomHeight<128&&zoomWidth<128){this.hide();}},beforeAttach:function(){this.$flyout.css({width:'512px',height:'512px'});},preventClicks:this.nodeOptions.preventClicks,});}}},});var KanbanFieldBinaryImage=FieldBinaryImage.extend({events:{},});var FieldBinaryFile=AbstractFieldBinary.extend({description:_lt("File"),template:'FieldBinaryFile',events:_.extend({},AbstractFieldBinary.prototype.events,{'click':function(event){if(this.mode==='readonly'&&this.value&&this.recordData.id){this.on_save_as(event);}},'click .o_input':function(){this.$('.o_input_file').click();},}),supportedFieldTypes:['binary'],init:function(){this._super.apply(this,arguments);this.filename_value=this.recordData[this.attrs.filename];},_renderReadonly:function(){var visible=!!(this.value&&this.res_id);this.$el.empty().css('cursor','not-allowed');this.do_toggle(visible);if(visible){this.$el.css('cursor','pointer').text(this.filename_value||'').prepend($('<span class="fa fa-download"/>'),' ');}},_renderEdit:function(){if(this.value){this.$el.children().removeClass('o_hidden');this.$('.o_select_file_button').first().addClass('o_hidden');this.$('.o_input').eq(0).val(this.filename_value||this.value);}else{this.$el.children().addClass('o_hidden');this.$('.o_select_file_button').first().removeClass('o_hidden');}},set_filename:function(value){this._super.apply(this,arguments);this.filename_value=value;this.$('.o_save_file_button').prop('disabled',true);},on_save_as:function(ev){if(!this.value){this.do_warn(_t("Save As..."),_t("The field is empty, there's nothing to save !"));ev.stopPropagation();}else if(this.res_id){framework.blockUI();var filename_fieldname=this.attrs.filename;this.getSession().get_file({complete:framework.unblockUI,data:{'model':this.model,'id':this.res_id,'field':this.name,'filename_field':filename_fieldname,'filename':this.recordData[filename_fieldname]||"",'download':true,'data':utils.is_bin_size(this.value)?null:this.value,},error:(error)=>this.call('crash_manager','rpc_error',error),url:'/web/content',});ev.stopPropagation();}},});var FieldPdfViewer=FieldBinaryFile.extend({description:_lt("PDF Viewer"),supportedFieldTypes:['binary'],template:'FieldPdfViewer',init:function(){this._super.apply(this,arguments);this.PDFViewerApplication=false;},_disableButtons:function(iframe){$(iframe).contents().find('button#openFile').hide();},_getURI:function(fileURI){var page=this.recordData[this.name+'_page']||1;if(!fileURI){var queryObj={model:this.model,field:this.name,id:this.res_id,};var queryString=$.param(queryObj);fileURI='/web/content?'+queryString;}
fileURI=encodeURIComponent(fileURI);var viewerURL='/web/static/lib/pdfjs/web/viewer.html?file=';return viewerURL+fileURI+'#page='+page;},_render:function(){var self=this;var $pdfViewer=this.$('.o_form_pdf_controls').children().add(this.$('.o_pdfview_iframe'));var $selectUpload=this.$('.o_select_file_button').first();var $iFrame=this.$('.o_pdfview_iframe');$iFrame.on('load',function(){self.PDFViewerApplication=this.contentWindow.window.PDFViewerApplication;self._disableButtons(this);});if(this.mode==="readonly"&&this.value){$iFrame.attr('src',this._getURI());}else{if(this.value){var binSize=utils.is_bin_size(this.value);$pdfViewer.removeClass('o_hidden');$selectUpload.addClass('o_hidden');if(binSize){$iFrame.attr('src',this._getURI());}}else{$pdfViewer.addClass('o_hidden');$selectUpload.removeClass('o_hidden');}}},on_file_change:function(ev){this._super.apply(this,arguments);var files=ev.target.files;if(!files||files.length===0){return;}
var fileURI=URL.createObjectURL(files[0]);if(this.PDFViewerApplication){this.PDFViewerApplication.open(fileURI,0);}else{this.$('.o_pdfview_iframe').attr('src',this._getURI(fileURI));}},on_save_as:function(ev){ev.stopPropagation();},});var PriorityWidget=AbstractField.extend({description:_lt("Priority"),className:"o_priority",attributes:{'role':'radiogroup',},events:{'mouseover > a':'_onMouseOver','mouseout > a':'_onMouseOut','click > a':'_onClick','keydown > a':'_onKeydown',},supportedFieldTypes:['selection'],isSet:function(){return true;},getFocusableElement:function(){var checked=this.$("[aria-checked='true']");return checked.length?checked:this.$("[data-index='1']");},_render:function(){var self=this;var index_value=this.value?_.findIndex(this.field.selection,function(v){return v[0]===self.value;}):0;this.$el.empty();this.empty_value=this.field.selection[0][0];this.$el.attr('aria-label',this.string);const isReadonly=this.record.evalModifiers(this.attrs.modifiers).readonly;_.each(this.field.selection.slice(1),function(choice,index){const tag=isReadonly?'<span>':'<a href="#">';self.$el.append(self._renderStar(tag,index_value>=index+1,index+1,choice[1],index_value));});},_renderStar:function(tag,isFull,index,tip,indexValue){var isChecked=indexValue===index;var defaultFocus=indexValue===0&&index===1;return $(tag).attr('role','radio').attr('aria-checked',isChecked).attr('title',tip).attr('aria-label',tip).attr('tabindex',isChecked||defaultFocus?0:-1).attr('data-index',index).addClass('o_priority_star fa').toggleClass('fa-star',isFull).toggleClass('fa-star-o',!isFull);},_onClick:function(event){event.preventDefault();event.stopPropagation();var index=$(event.currentTarget).data('index');var newValue=this.field.selection[index][0];if(newValue===this.value){newValue=this.empty_value;}
this._setValue(newValue);},_onMouseOut:function(){clearTimeout(this.hoverTimer);var self=this;this.hoverTimer=setTimeout(function(){self._render();},200);},_onMouseOver:function(event){clearTimeout(this.hoverTimer);this.$('.o_priority_star').removeClass('fa-star-o').addClass('fa-star');$(event.currentTarget).nextAll().removeClass('fa-star').addClass('fa-star-o');},_onKeydown:function(event){if(event.which===$.ui.keyCode.ENTER){return;}
this._super.apply(this,arguments);},_onNavigationMove:function(ev){var $curControl=this.$('a:focus');var $nextControl;if(ev.data.direction==='right'||ev.data.direction==='down'){$nextControl=$curControl.next('a');}else if(ev.data.direction==='left'||ev.data.direction==='up'){$nextControl=$curControl.prev('a');}
if($nextControl&&$nextControl.length){ev.stopPropagation();$nextControl.focus();return;}
this._super.apply(this,arguments);},});var AttachmentImage=AbstractField.extend({className:'o_attachment_image',_render:function(){if(this.value){this.$el.empty().append($('<img>/',{src:"/web/image/"+this.value.data.id+"?unique=1",title:this.value.data.display_name,alt:_t("Image")}));}}});var StateSelectionWidget=AbstractField.extend({template:'FormSelection',events:{'click .dropdown-item':'_setSelection',},supportedFieldTypes:['selection'],getFocusableElement:function(){return this.$("a[data-toggle='dropdown']");},_prepareDropdownValues:function(){var self=this;var _data=[];var current_stage_id=self.recordData.stage_id&&self.recordData.stage_id[0];var stage_data={id:current_stage_id,legend_normal:this.recordData.legend_normal||undefined,legend_blocked:this.recordData.legend_blocked||undefined,legend_done:this.recordData.legend_done||undefined,};_.map(this.field.selection||[],function(selection_item){var value={'name':selection_item[0],'tooltip':selection_item[1],};if(selection_item[0]==='normal'){value.state_name=stage_data.legend_normal?stage_data.legend_normal:selection_item[1];}else if(selection_item[0]==='done'){value.state_class='o_status_green';value.state_name=stage_data.legend_done?stage_data.legend_done:selection_item[1];}else{value.state_class='o_status_red';value.state_name=stage_data.legend_blocked?stage_data.legend_blocked:selection_item[1];}
_data.push(value);});return _data;},_render:function(){var states=this._prepareDropdownValues();var currentState=_.findWhere(states,{name:this.value})||states[0];this.$('.o_status').removeClass('o_status_red o_status_green').addClass(currentState.state_class).prop('special_click',true).parent().attr('title',currentState.state_name).attr('aria-label',this.string+": "+currentState.state_name);var $items=$(qweb.render('FormSelection.items',{states:_.without(states,currentState)}));var $dropdown=this.$('.dropdown-menu');$dropdown.children().remove();$items.appendTo($dropdown);var isReadonly=this.record.evalModifiers(this.attrs.modifiers).readonly;this.$('a[data-toggle=dropdown]').toggleClass('disabled',isReadonly||false);},_setSelection:function(ev){ev.preventDefault();var $item=$(ev.currentTarget);var value=String($item.data('value'));this._setValue(value);if(this.mode==='edit'){this._render();}},});var FavoriteWidget=AbstractField.extend({className:'o_favorite',events:{'click':'_setFavorite'},supportedFieldTypes:['boolean'],isSet:function(){return true;},_render:function(){var tip=this.value?_t('Remove from Favorites'):_t('Add to Favorites');var template=this.attrs.nolabel?'<a href="#"><i class="fa %s" title="%s" aria-label="%s" role="img"></i></a>':'<a href="#"><i class="fa %s" role="img" aria-label="%s"></i> %s</a>';this.$el.empty().append(_.str.sprintf(template,this.value?'fa-star':'fa-star-o',tip,tip));},_setFavorite:function(event){event.preventDefault();event.stopPropagation();this._setValue(!this.value);},});var LabelSelection=AbstractField.extend({supportedFieldTypes:['selection'],_render:function(){this.classes=this.nodeOptions&&this.nodeOptions.classes||{};var labelClass=this.classes[this.value]||'primary';this.$el.addClass('badge badge-'+labelClass).text(this._formatValue(this.value));},});var BooleanToggle=FieldBoolean.extend({description:_lt("Toggle"),className:FieldBoolean.prototype.className+' o_boolean_toggle',events:{'click':'_onClick'},_onClick:function(event){event.stopPropagation();this._setValue(!this.value);this.$el.closest(".o_data_row").toggleClass('text-muted',this.value);},});var StatInfo=AbstractField.extend({supportedFieldTypes:['integer','float'],isSet:function(){return true;},_render:function(){var options={value:this._formatValue(this.value||0),};if(!this.attrs.nolabel){if(this.nodeOptions.label_field&&this.recordData[this.nodeOptions.label_field]){options.text=this.recordData[this.nodeOptions.label_field];}else{options.text=this.string;}}
this.$el.html(qweb.render("StatInfo",options));this.$el.addClass('o_stat_info');},});var FieldPercentPie=AbstractField.extend({description:_lt("Percentage Pie"),template:'FieldPercentPie',supportedFieldTypes:['integer','float'],start:function(){this.$leftMask=this.$('.o_mask').first();this.$rightMask=this.$('.o_mask').last();this.$pieValue=this.$('.o_pie_value');return this._super();},isSet:function(){return true;},_render:function(){var value=this.value||0;var degValue=360*value/100;this.$rightMask.toggleClass('o_full',degValue>=180);var leftDeg='rotate('+((degValue<180)?180:degValue)+'deg)';var rightDeg='rotate('+((degValue<180)?degValue:0)+'deg)';this.$leftMask.css({transform:leftDeg,msTransform:leftDeg,mozTransform:leftDeg,webkitTransform:leftDeg});this.$rightMask.css({transform:rightDeg,msTransform:rightDeg,mozTransform:rightDeg,webkitTransform:rightDeg});this.$pieValue.text(Math.round(value)+'%');},});var FieldProgressBar=AbstractField.extend({description:_lt("Progress Bar"),template:"ProgressBar",events:{'change input':'on_change_input','input input':'on_change_input','keyup input':function(e){if(e.which===$.ui.keyCode.ENTER){this.on_change_input(e);}},},supportedFieldTypes:['integer','float'],init:function(){this._super.apply(this,arguments);if(this.recordData[this.nodeOptions.current_value]){this.value=this.recordData[this.nodeOptions.current_value];}
this.editable_readonly=!!this.nodeOptions.editable_readonly;this.readonly=this.nodeOptions.readonly||!this.nodeOptions.editable;this.canWrite=!this.readonly&&(this.mode==='edit'||(this.editable_readonly&&this.mode==='readonly')||(this.viewType==='kanban'));this.edit_max_value=!!this.nodeOptions.edit_max_value;this.max_value=this.recordData[this.nodeOptions.max_value]||100;this.title=_t(this.attrs.title||this.nodeOptions.title)||'';this.enableBarAsInput=false;this.edit_on_click=this.enableBarAsInput&&this.mode==='readonly'&&!this.edit_max_value;this.write_mode=false;},_render:function(){var self=this;this._render_value();if(this.canWrite){if(this.edit_on_click){this.$el.on('click','.o_progress',function(e){var $target=$(e.currentTarget);var numValue=Math.floor((e.pageX-$target.offset().left)/$target.outerWidth()*self.max_value);self.on_update(numValue);self._render_value();});}else{this.$el.on('click',function(){if(!self.write_mode){var $input=$('<input>',{type:'text',class:'o_progressbar_value o_input'});$input.on('blur',self.on_change_input.bind(self));self.$('.o_progressbar_value').replaceWith($input);self.write_mode=true;self._render_value();}});}}
return this._super();},on_update:function(value){if(this.edit_max_value){this.max_value=value;this._isValid=true;var changes={};changes[this.nodeOptions.max_value]=this.max_value;this.trigger_up('field_changed',{dataPointID:this.dataPointID,changes:changes,});}else{var formattedValue=this._formatValue(value);this._setValue(formattedValue);}},on_change_input:function(e){var $input=$(e.target);if(e.type==='change'&&!$input.is(':focus')){return;}
var parsedValue;try{parsedValue=field_utils.parse.float($input.val());}catch(error){this.do_warn(_t("Wrong value entered!"),_t("Only Integer or Float Value should be valid."));}
if(parsedValue!==undefined){if(e.type==='input'){this._render_value(parsedValue);if(parsedValue===0){$input.select();}}else{if(this.edit_max_value){parsedValue=parsedValue||100;}
var $div=$('<div>',{class:'o_progressbar_value'});this.$('.o_progressbar_value').replaceWith($div);this.write_mode=false;this.on_update(parsedValue);this._render_value();}}},_render_value:function(v){var value=this.value;var max_value=this.max_value;if(!isNaN(v)){if(this.edit_max_value){max_value=v;}else{value=v;}}
value=value||0;max_value=max_value||0;var widthComplete;if(value<=max_value){widthComplete=value/max_value*100;}else{widthComplete=100;}
this.$('.o_progress').toggleClass('o_progress_overflow',value>max_value).attr('aria-valuemin','0').attr('aria-valuemax',max_value).attr('aria-valuenow',value);this.$('.o_progressbar_complete').css('width',widthComplete+'%');if(!this.write_mode){if(max_value!==100){this.$('.o_progressbar_value').text(utils.human_number(value)+" / "+utils.human_number(max_value));}else{this.$('.o_progressbar_value').text(utils.human_number(value)+"%");}}else if(isNaN(v)){this.$('.o_progressbar_value').val(this.edit_max_value?max_value:value);this.$('.o_progressbar_value').focus().select();}},_reset:function(){this._super.apply(this,arguments);var new_max_value=this.recordData[this.nodeOptions.max_value];this.max_value=new_max_value!==undefined?new_max_value:this.max_value;},isSet:function(){return true;},});var FieldToggleBoolean=AbstractField.extend({description:_lt("Button"),template:"toggle_button",events:{'click':'_onToggleButton'},supportedFieldTypes:['boolean'],isSet:function(){return true;},_render:function(){this.$('i').toggleClass('o_toggle_button_success',!!this.value).toggleClass('text-muted',!this.value);var isReadonly=this.record.evalModifiers(this.attrs.modifiers).readonly;this.$el.prop('disabled',isReadonly);var title=this.value?this.attrs.options.active:this.attrs.options.inactive;this.$el.attr('title',title);this.$el.attr('aria-pressed',this.value);},_onToggleButton:function(event){event.stopPropagation();this._setValue(!this.value);},});var JournalDashboardGraph=AbstractField.extend({className:"o_dashboard_graph",jsLibs:['/web/static/lib/Chart/Chart.js',],init:function(){this._super.apply(this,arguments);this.graph_type=this.attrs.graph_type;this.data=JSON.parse(this.value);},on_attach_callback:function(){this._isInDOM=true;this._renderInDOM();},on_detach_callback:function(){this._isInDOM=false;},_render:function(){if(this._isInDOM){return this._renderInDOM();}
return Promise.resolve();},_renderInDOM:function(){this.$el.empty();var config,cssClass;if(this.graph_type==='line'){config=this._getLineChartConfig();cssClass='o_graph_linechart';}else if(this.graph_type==='bar'){config=this._getBarChartConfig();cssClass='o_graph_barchart';}
this.$canvas=$('<canvas/>');this.$el.addClass(cssClass);this.$el.empty();this.$el.append(this.$canvas);var context=this.$canvas[0].getContext('2d');this.chart=new Chart(context,config);},_getLineChartConfig:function(){var labels=this.data[0].values.map(function(pt){return pt.x;});var borderColor=this.data[0].is_sample_data?'#dddddd':'#875a7b';var backgroundColor=this.data[0].is_sample_data?'#ebebeb':'#dcd0d9';return{type:'line',data:{labels:labels,datasets:[{data:this.data[0].values,fill:'start',label:this.data[0].key,backgroundColor:backgroundColor,borderColor:borderColor,borderWidth:2,}]},options:{legend:{display:false},scales:{yAxes:[{display:false}],xAxes:[{display:false}]},maintainAspectRatio:false,elements:{line:{tension:0.000001}},tooltips:{intersect:false,position:'nearest',caretSize:0,},},};},_getBarChartConfig:function(){var data=[];var labels=[];var backgroundColor=[];this.data[0].values.forEach(function(pt){data.push(pt.value);labels.push(pt.label);var color=pt.type==='past'?'#ccbdc8':(pt.type==='future'?'#a5d8d7':'#ebebeb');backgroundColor.push(color);});return{type:'bar',data:{labels:labels,datasets:[{data:data,fill:'start',label:this.data[0].key,backgroundColor:backgroundColor,}]},options:{legend:{display:false},scales:{yAxes:[{display:false}],},maintainAspectRatio:false,tooltips:{intersect:false,position:'nearest',caretSize:0,},elements:{line:{tension:0.000001}},},};},});var FieldDomain=AbstractField.extend({specialData:"_fetchSpecialDomain",events:_.extend({},AbstractField.prototype.events,{"click .o_domain_show_selection_button":"_onShowSelectionButtonClick","click .o_field_domain_dialog_button":"_onDialogEditButtonClick",}),custom_events:_.extend({},AbstractField.prototype.custom_events,{domain_changed:"_onDomainSelectorValueChange",domain_selected:"_onDomainSelectorDialogValueChange",open_record:"_onOpenRecord",}),init:function(){this._super.apply(this,arguments);this.inDialog=!!this.nodeOptions.in_dialog;this.fsFilters=this.nodeOptions.fs_filters||{};this.className="o_field_domain";if(this.mode==="edit"){this.className+=" o_edit_mode";}
if(!this.inDialog){this.className+=" o_inline_mode";}
this._setState();},isSet:function(){return true;},isValid:function(){return(this._super.apply(this,arguments)&&(!this.domainSelector||this.domainSelector.isValid())&&this._isValidForModel);},_render:function(){if(!this._domainModel){this._replaceContent();return Promise.resolve();}
var value=this.value||"[]";var def;if(!this.domainSelector){this.domainSelector=new DomainSelector(this,this._domainModel,value,{readonly:this.mode==="readonly"||this.inDialog,filters:this.fsFilters,debugMode:config.isDebug(),});def=this.domainSelector.prependTo(this.$el);}else{def=this.domainSelector.setDomain(value);}
return def.then(this._replaceContent.bind(this));},_replaceContent:function(){if(this._$content){this._$content.remove();}
this._$content=$(qweb.render("FieldDomain.content",{hasModel:!!this._domainModel,isValid:!!this._isValidForModel,nbRecords:this.record.specialData[this.name].nbRecords||0,inDialogEdit:this.inDialog&&this.mode==="edit",}));this._$content.appendTo(this.$el);},_reset:function(){this._super.apply(this,arguments);var oldDomainModel=this._domainModel;this._setState();if(this.domainSelector&&this._domainModel!==oldDomainModel){this.domainSelector.destroy();this.domainSelector=null;}},_setState:function(){var specialData=this.record.specialData[this.name];this._domainModel=specialData.model;this._isValidForModel=(specialData.nbRecords!==false);},_onShowSelectionButtonClick:function(e){e.preventDefault();new view_dialogs.SelectCreateDialog(this,{title:_t("Selected records"),res_model:this._domainModel,context:this.record.getContext({fieldName:this.name,viewType:this.viewType}),domain:this.value||"[]",no_create:true,readonly:true,disable_multiple_selection:true,}).open();},_onDialogEditButtonClick:function(e){e.preventDefault();new DomainSelectorDialog(this,this._domainModel,this.value||"[]",{readonly:this.mode==="readonly",filters:this.fsFilters,debugMode:config.isDebug(),}).open();},_onDomainSelectorValueChange:function(e){if(this.inDialog)return;this._setValue(Domain.prototype.arrayToString(this.domainSelector.getDomain()));},_onDomainSelectorDialogValueChange:function(e){this._setValue(Domain.prototype.arrayToString(e.data.domain));},_onOpenRecord:function(event){event.stopPropagation();},});var AceEditor=DebouncedField.extend({template:"AceEditor",jsLibs:['/web/static/lib/ace/ace.js',['/web/static/lib/ace/mode-python.js','/web/static/lib/ace/mode-xml.js']],events:{},start:function(){this._startAce(this.$('.ace-view-editor')[0]);return this._super.apply(this,arguments);},destroy:function(){if(this.aceEditor){this.aceEditor.destroy();}
this._super.apply(this,arguments);},_formatValue:function(value){return this._super.apply(this,arguments)||'';},_getValue:function(){return this.aceSession.getValue();},_render:function(){var newValue=this._formatValue(this.value);if(this.aceSession.getValue()!==newValue){this.aceSession.setValue(newValue);}},_startAce:function(node){this.aceEditor=ace.edit(node);this.aceEditor.setOptions({maxLines:Infinity,showPrintMargin:false,});if(this.mode==='readonly'){this.aceEditor.renderer.setOptions({displayIndentGuides:false,showGutter:false,});this.aceEditor.setOptions({highlightActiveLine:false,highlightGutterLine:false,readOnly:true,});this.aceEditor.renderer.$cursorLayer.element.style.display="none";}
this.aceEditor.$blockScrolling=true;this.aceSession=this.aceEditor.getSession();this.aceSession.setOptions({useWorker:false,mode:"ace/mode/"+(this.nodeOptions.mode||'xml'),tabSize:2,useSoftTabs:true,});if(this.mode==="edit"){this.aceEditor.on("change",this._doDebouncedAction.bind(this));this.aceEditor.on("blur",this._doAction.bind(this));}},});var FieldColor=AbstractField.extend({template:'FieldColor',events:_.extend({},AbstractField.prototype.events,{'click .o_field_color':'_onColorClick',}),custom_events:_.extend({},AbstractField.prototype.custom_events,{'colorpicker:saved':'_onColorpickerSaved',}),getFocusableElement:function(){return this.$('.o_field_color');},_render:function(){this.$('.o_field_color').data('value',this.value).css('background-color',this.value).attr('title',this.value);return this._super.apply(this,arguments);},_onColorClick:function(){if(this.mode==='edit'){const dialog=new ColorpickerDialog(this,{defaultColor:this.value,noTransparency:true,}).open();dialog.on('closed',this,()=>{Promise.resolve().then(()=>{this.getFocusableElement().focus();});});}},_onColorpickerSaved:function(ev){this._setValue(ev.data.hex);},_onKeydown:function(ev){if(ev.which===$.ui.keyCode.ENTER){ev.preventDefault();ev.stopPropagation();this._onColorClick(ev);}else{this._super.apply(this,arguments);}},});return{TranslatableFieldMixin:TranslatableFieldMixin,DebouncedField:DebouncedField,FieldEmail:FieldEmail,FieldBinaryFile:FieldBinaryFile,FieldPdfViewer:FieldPdfViewer,AbstractFieldBinary:AbstractFieldBinary,FieldBinaryImage:FieldBinaryImage,KanbanFieldBinaryImage:KanbanFieldBinaryImage,FieldBoolean:FieldBoolean,BooleanToggle:BooleanToggle,FieldChar:FieldChar,LinkButton:LinkButton,FieldDate:FieldDate,FieldDateTime:FieldDateTime,FieldDateRange:FieldDateRange,FieldDomain:FieldDomain,FieldFloat:FieldFloat,FieldFloatTime:FieldFloatTime,FieldFloatFactor:FieldFloatFactor,FieldFloatToggle:FieldFloatToggle,FieldPercentage:FieldPercentage,FieldInteger:FieldInteger,FieldMonetary:FieldMonetary,FieldPercentPie:FieldPercentPie,FieldPhone:FieldPhone,FieldProgressBar:FieldProgressBar,FieldText:FieldText,ListFieldText:ListFieldText,FieldToggleBoolean:FieldToggleBoolean,HandleWidget:HandleWidget,InputField:InputField,NumericField:NumericField,AttachmentImage:AttachmentImage,LabelSelection:LabelSelection,StateSelectionWidget:StateSelectionWidget,FavoriteWidget:FavoriteWidget,PriorityWidget:PriorityWidget,StatInfo:StatInfo,UrlWidget:UrlWidget,TextCopyClipboard:TextCopyClipboard,CharCopyClipboard:CharCopyClipboard,JournalDashboardGraph:JournalDashboardGraph,AceEditor:AceEditor,FieldColor:FieldColor,};});;

/* /web/static/src/js/fields/field_registry.js defined in bundle 'web.assets_backend' */
odoo.define('web.field_registry',function(require){"use strict";var Registry=require('web.Registry');return new Registry();});odoo.define('web._field_registry',function(require){"use strict";var AbstractField=require('web.AbstractField');var basic_fields=require('web.basic_fields');var relational_fields=require('web.relational_fields');var registry=require('web.field_registry');var special_fields=require('web.special_fields');registry.add('abstract',AbstractField).add('input',basic_fields.InputField).add('integer',basic_fields.FieldInteger).add('boolean',basic_fields.FieldBoolean).add('date',basic_fields.FieldDate).add('datetime',basic_fields.FieldDateTime).add('daterange',basic_fields.FieldDateRange).add('domain',basic_fields.FieldDomain).add('text',basic_fields.FieldText).add('list.text',basic_fields.ListFieldText).add('html',basic_fields.FieldText).add('float',basic_fields.FieldFloat).add('char',basic_fields.FieldChar).add('link_button',basic_fields.LinkButton).add('handle',basic_fields.HandleWidget).add('email',basic_fields.FieldEmail).add('phone',basic_fields.FieldPhone).add('url',basic_fields.UrlWidget).add('CopyClipboardText',basic_fields.TextCopyClipboard).add('CopyClipboardChar',basic_fields.CharCopyClipboard).add('image',basic_fields.FieldBinaryImage).add('kanban.image',basic_fields.KanbanFieldBinaryImage).add('binary',basic_fields.FieldBinaryFile).add('pdf_viewer',basic_fields.FieldPdfViewer).add('monetary',basic_fields.FieldMonetary).add('percentage',basic_fields.FieldPercentage).add('priority',basic_fields.PriorityWidget).add('attachment_image',basic_fields.AttachmentImage).add('label_selection',basic_fields.LabelSelection).add('kanban_label_selection',basic_fields.LabelSelection).add('state_selection',basic_fields.StateSelectionWidget).add('kanban_state_selection',basic_fields.StateSelectionWidget).add('boolean_favorite',basic_fields.FavoriteWidget).add('boolean_toggle',basic_fields.BooleanToggle).add('statinfo',basic_fields.StatInfo).add('percentpie',basic_fields.FieldPercentPie).add('float_time',basic_fields.FieldFloatTime).add('float_factor',basic_fields.FieldFloatFactor).add('float_toggle',basic_fields.FieldFloatToggle).add('progressbar',basic_fields.FieldProgressBar).add('toggle_button',basic_fields.FieldToggleBoolean).add('dashboard_graph',basic_fields.JournalDashboardGraph).add('ace',basic_fields.AceEditor).add('color',basic_fields.FieldColor).add('many2one_reference',basic_fields.FieldInteger);registry.add('selection',relational_fields.FieldSelection).add('radio',relational_fields.FieldRadio).add('selection_badge',relational_fields.FieldSelectionBadge).add('many2one',relational_fields.FieldMany2One).add('many2one_barcode',relational_fields.Many2oneBarcode).add('list.many2one',relational_fields.ListFieldMany2One).add('kanban.many2one',relational_fields.KanbanFieldMany2One).add('many2many',relational_fields.FieldMany2Many).add('many2many_binary',relational_fields.FieldMany2ManyBinaryMultiFiles).add('many2many_tags',relational_fields.FieldMany2ManyTags).add('many2many_tags_avatar',relational_fields.FieldMany2ManyTagsAvatar).add('form.many2many_tags',relational_fields.FormFieldMany2ManyTags).add('kanban.many2many_tags',relational_fields.KanbanFieldMany2ManyTags).add('many2many_checkboxes',relational_fields.FieldMany2ManyCheckBoxes).add('one2many',relational_fields.FieldOne2Many).add('statusbar',relational_fields.FieldStatus).add('reference',relational_fields.FieldReference).add('font',relational_fields.FieldSelectionFont);registry.add('timezone_mismatch',special_fields.FieldTimezoneMismatch).add('report_layout',special_fields.FieldReportLayout);});;

/* /web/static/src/js/views/basic/widget_registry.js defined in bundle 'web.assets_backend' */
odoo.define('web.widget_registry',function(require){"use strict";var Registry=require('web.Registry');return new Registry();});;

/* /web/static/src/js/fields/field_utils.js defined in bundle 'web.assets_backend' */
odoo.define('web.field_utils',function(require){"use strict";var core=require('web.core');var dom=require('web.dom');var session=require('web.session');var time=require('web.time');var utils=require('web.utils');var _t=core._t;function formatBinary(value,field,options){if(!value){return'';}
return utils.binaryToBinsize(value);}
function formatBoolean(value,field,options){if(options&&options.forceString){return value?_t('True'):_t('False');}
return dom.renderCheckbox({prop:{checked:value,disabled:true,},});}
function formatChar(value,field,options){value=typeof value==='string'?value:'';if(options&&options.isPassword){return _.str.repeat('*',value?value.length:0);}
if(options&&options.escape){value=_.escape(value);}
return value;}
function formatDate(value,field,options){if(value===false||isNaN(value)){return"";}
if(field&&field.type==='datetime'){if(!options||!('timezone'in options)||options.timezone){value=value.clone().add(session.getTZOffset(value),'minutes');}}
var date_format=time.getLangDateFormat();return value.format(date_format);}
function formatDateTime(value,field,options){if(value===false){return"";}
if(!options||!('timezone'in options)||options.timezone){value=value.clone().add(session.getTZOffset(value),'minutes');}
return value.format(time.getLangDatetimeFormat());}
function formatFloat(value,field,options){options=options||{};if(value===false){return"";}
if(options.humanReadable&&options.humanReadable(value)){return utils.human_number(value,options.decimals,options.minDigits,options.formatterCallback);}
var l10n=core._t.database.parameters;var precision;if(options.digits){precision=options.digits[1];}else if(field&&field.digits){precision=field.digits[1];}else{precision=2;}
var formatted=_.str.sprintf('%.'+precision+'f',value||0).split('.');formatted[0]=utils.insert_thousand_seps(formatted[0]);return formatted.join(l10n.decimal_point);}
function formatFloatFactor(value,field,options){var factor=options.factor||1;return formatFloat(value*factor,field,options);}
function formatFloatTime(value){var pattern='%02d:%02d';if(value<0){value=Math.abs(value);pattern='-'+pattern;}
var hour=Math.floor(value);var min=Math.round((value%1)*60);if(min===60){min=0;hour=hour+1;}
return _.str.sprintf(pattern,hour,min);}
function formatInteger(value,field,options){options=options||{};if(options.isPassword){return _.str.repeat('*',String(value).length);}
if(!value&&value!==0){return"";}
if(options.humanReadable&&options.humanReadable(value)){return utils.human_number(value,options.decimals,options.minDigits,options.formatterCallback);}
return utils.insert_thousand_seps(_.str.sprintf('%d',value));}
function formatMany2one(value,field,options){if(!value){value='';}else if(_.isArray(value)){value=value[1];}else{while(value.data){value=value.data.display_name||'';}}
if(options&&options.escape){value=_.escape(value);}
return value;}
function formatX2Many(value){if(value.data.length===0){return _t('No records');}else if(value.data.length===1){return _t('1 record');}else{return value.data.length+_t(' records');}}
function formatMonetary(value,field,options){if(value===false){return"";}
options=options||{};var currency=options.currency;if(!currency){var currency_id=options.currency_id;if(!currency_id&&options.data){var currency_field=options.currency_field||field.currency_field||'currency_id';currency_id=options.data[currency_field]&&options.data[currency_field].res_id;}
currency=session.get_currency(currency_id);}
var digits=(currency&&currency.digits)||options.digits;if(options.field_digits===true){digits=field.digits||digits;}
var formatted_value=formatFloat(value,field,_.extend({},options,{digits:digits}));if(!currency||options.noSymbol){return formatted_value;}
if(currency.position==="after"){return formatted_value+='&nbsp;'+currency.symbol;}else{return currency.symbol+'&nbsp;'+formatted_value;}}
function formatPercentage(value,field,options){options=options||{};var result=formatFloat(value*100,field,options)||'0';if(options.humanReadable&&options.humanReadable(value*100)){return result+"%";}
return(parseFloat(result)+"%").replace('.',_t.database.parameters.decimal_point);}
function formatSelection(value,field,options){var val=_.find(field.selection,function(option){return option[0]===value;});if(!val){return'';}
value=val[1];if(options&&options.escape){value=_.escape(value);}
return value;}
function parseDate(value,field,options){if(!value){return false;}
var datePattern=time.getLangDateFormat();var datePatternWoZero=datePattern.replace('MM','M').replace('DD','D');var date;if(options&&options.isUTC){date=moment.utc(value);}else{date=moment.utc(value,[datePattern,datePatternWoZero,moment.ISO_8601]);}
if(date.isValid()){if(date.year()===0){date.year(moment.utc().year());}
if(date.year()>=1900){date.toJSON=function(){return this.clone().locale('en').format('YYYY-MM-DD');};return date;}}
throw new Error(_.str.sprintf(core._t("'%s' is not a correct date"),value));}
function parseDateTime(value,field,options){if(!value){return false;}
var datePattern=time.getLangDateFormat(),timePattern=time.getLangTimeFormat();var datePatternWoZero=datePattern.replace('MM','M').replace('DD','D'),timePatternWoZero=timePattern.replace('HH','H').replace('mm','m').replace('ss','s');var pattern1=datePattern+' '+timePattern;var pattern2=datePatternWoZero+' '+timePatternWoZero;var datetime;if(options&&options.isUTC){datetime=moment.utc(value.replace(' ','T')+'Z');}else{datetime=moment.utc(value,[pattern1,pattern2,moment.ISO_8601]);if(options&&options.timezone){datetime.add(-session.getTZOffset(datetime),'minutes');}}
if(datetime.isValid()){if(datetime.year()===0){datetime.year(moment.utc().year());}
if(datetime.year()>=1900){datetime.toJSON=function(){return this.clone().locale('en').format('YYYY-MM-DD HH:mm:ss');};return datetime;}}
throw new Error(_.str.sprintf(core._t("'%s' is not a correct datetime"),value));}
function parseNumber(value){if(core._t.database.parameters.thousands_sep){var escapedSep=_.str.escapeRegExp(core._t.database.parameters.thousands_sep);value=value.replace(new RegExp(escapedSep,'g'),'');}
if(core._t.database.parameters.decimal_point){value=value.replace(core._t.database.parameters.decimal_point,'.');}
return Number(value);}
function parseFloat(value){var parsed=parseNumber(value);if(isNaN(parsed)){throw new Error(_.str.sprintf(core._t("'%s' is not a correct float"),value));}
return parsed;}
function parseMonetary(value,field,options){var values=value.split('&nbsp;');if(values.length===1){return parseFloat(value);}
else if(values.length!==2){throw new Error(_.str.sprintf(core._t("'%s' is not a correct monetary field"),value));}
options=options||{};var currency=options.currency;if(!currency){var currency_id=options.currency_id;if(!currency_id&&options.data){var currency_field=options.currency_field||field.currency_field||'currency_id';currency_id=options.data[currency_field]&&options.data[currency_field].res_id;}
currency=session.get_currency(currency_id);}
return parseFloat(values[0]===currency.symbol?values[1]:values[0]);}
function parseFloatFactor(value,field,options){var parsed=parseFloat(value);var factor=options.factor||1.0;return parsed/factor;}
function parseFloatTime(value){var factor=1;if(value[0]==='-'){value=value.slice(1);factor=-1;}
var float_time_pair=value.split(":");if(float_time_pair.length!==2)
return factor*parseFloat(value);var hours=parseInteger(float_time_pair[0]);var minutes=parseInteger(float_time_pair[1]);return factor*(hours+(minutes/60));}
function parsePercentage(value){if(value.slice(-1)==='%'){return parseFloat(value.slice(0,-1))/100;}
return parseFloat(value);}
function parseInteger(value){var parsed=parseNumber(value);if(isNaN(parsed)||parsed%1||parsed<-2147483648||parsed>2147483647){throw new Error(_.str.sprintf(core._t("'%s' is not a correct integer"),value));}
return parsed;}
function parseMany2one(value){if(_.isArray(value)){return{id:value[0],display_name:value[1],};}
if(_.isNumber(value)||_.isString(value)){return{id:parseInt(value,10),};}
return value;}
return{format:{binary:formatBinary,boolean:formatBoolean,char:formatChar,date:formatDate,datetime:formatDateTime,float:formatFloat,float_factor:formatFloatFactor,float_time:formatFloatTime,html:_.identity,integer:formatInteger,many2many:formatX2Many,many2one:formatMany2one,many2one_reference:formatInteger,monetary:formatMonetary,one2many:formatX2Many,percentage:formatPercentage,reference:formatMany2one,selection:formatSelection,text:formatChar,},parse:{binary:_.identity,boolean:_.identity,char:_.identity,date:parseDate,datetime:parseDateTime,float:parseFloat,float_factor:parseFloatFactor,float_time:parseFloatTime,html:_.identity,integer:parseInteger,many2many:_.identity,many2one:parseMany2one,many2one_reference:parseInteger,monetary:parseMonetary,one2many:_.identity,percentage:parsePercentage,reference:parseMany2one,selection:_.identity,text:_.identity,},};});;

/* /web/static/src/js/fields/relational_fields.js defined in bundle 'web.assets_backend' */
odoo.define('web.relational_fields',function(require){"use strict";var AbstractField=require('web.AbstractField');var basicFields=require('web.basic_fields');var concurrency=require('web.concurrency');var ControlPanelView=require('web.ControlPanelView');var core=require('web.core');var data=require('web.data');var Dialog=require('web.Dialog');var dialogs=require('web.view_dialogs');var dom=require('web.dom');var KanbanRecord=require('web.KanbanRecord');var KanbanRenderer=require('web.KanbanRenderer');var ListRenderer=require('web.ListRenderer');var Pager=require('web.Pager');var _t=core._t;var _lt=core._lt;var qweb=core.qweb;var M2ODialog=Dialog.extend({template:"M2ODialog",init:function(parent,name,value){this.name=name;this.value=value;this._super(parent,{title:_.str.sprintf(_t("Create a %s"),this.name),size:'medium',buttons:[{text:_t('Create'),classes:'btn-primary',click:function(){if(this.$("input").val()!==''){this.trigger_up('quick_create',{value:this.$('input').val()});this.close(true);}else{this.$("input").focus();}},},{text:_t('Create and edit'),classes:'btn-primary',close:true,click:function(){this.trigger_up('search_create_popup',{view_type:'form',value:this.$('input').val(),});},},{text:_t('Cancel'),close:true,}],});},start:function(){this.$("p").text(_.str.sprintf(_t("You are creating a new %s, are you sure it does not exist yet?"),this.name));this.$("input").val(this.value);},close:function(isSet){this.isSet=isSet;this._super.apply(this,arguments);},destroy:function(){if(!this.isSet){this.trigger_up('closed_unset');}
this._super.apply(this,arguments);},});var FieldMany2One=AbstractField.extend({description:_lt("Many2one"),supportedFieldTypes:['many2one'],template:'FieldMany2One',custom_events:_.extend({},AbstractField.prototype.custom_events,{'closed_unset':'_onDialogClosedUnset','field_changed':'_onFieldChanged','quick_create':'_onQuickCreate','search_create_popup':'_onSearchCreatePopup',}),events:_.extend({},AbstractField.prototype.events,{'click input':'_onInputClick','focusout input':'_onInputFocusout','keyup input':'_onInputKeyup','click .o_external_button':'_onExternalButtonClick','click':'_onClick',}),AUTOCOMPLETE_DELAY:200,SEARCH_MORE_LIMIT:320,init:function(parent,name,record,options){this._super.apply(this,arguments);this.limit=7;this.orderer=new concurrency.DropMisordered();this.can_create=('can_create'in this.attrs?JSON.parse(this.attrs.can_create):true)&&!this.nodeOptions.no_create;this.can_write='can_write'in this.attrs?JSON.parse(this.attrs.can_write):true;this.nodeOptions=_.defaults(this.nodeOptions,{quick_create:true,});this.noOpen='noOpen'in(options||{})?options.noOpen:this.nodeOptions.no_open;this.m2o_value=this._formatValue(this.value);this.recordParams={fieldName:this.name,viewType:this.viewType};this.isDirty=false;this.lastChangeEvent=undefined;this._autocompleteSources=[];this._addAutocompleteSource(this._search,{placeholder:_t('Loading...'),order:1});this.dp=new concurrency.DropPrevious();this.createDef=undefined;},start:function(){this.floating=false;this.$input=this.$('input');this.$external_button=this.$('.o_external_button');return this._super.apply(this,arguments);},destroy:function(){if(this._onScroll){window.removeEventListener('scroll',this._onScroll,true);}
this._super.apply(this,arguments);},commitChanges:function(){return Promise.resolve(this.createDef);},getFocusableElement:function(){return this.mode==='edit'&&this.$input||this.$el;},reinitialize:function(value){this.isDirty=false;this.floating=false;return this._setValue(value);},reset:function(record,event){this._reset(record,event);if(!event||event===this.lastChangeEvent){this.isDirty=false;}
if(this.isDirty){return Promise.resolve();}else{return this._render();}},_addAutocompleteSource:function(method,params){this._autocompleteSources.push({method:method,placeholder:(params.placeholder?_t(params.placeholder):_t('Loading...'))+'<i class="fa fa-spinner fa-spin pull-right"></i>',validation:params.validation,loading:false,order:params.order||999});this._autocompleteSources=_.sortBy(this._autocompleteSources,'order');},_bindAutoComplete:function(){var self=this;if($.browser.chrome&&this.$input.attr('placeholder')){this.$input.attr('placeholder',function(index,val){return val.split('').join('\ufeff');});}
this.$input.autocomplete({source:function(req,resp){_.each(self._autocompleteSources,function(source){source.results=[];if(!source.validation||source.validation.call(self,req.term)){source.loading=true;Promise.resolve(source.method.call(self,req.term)).then(function(results){source.results=results;source.loading=false;resp(self._concatenateAutocompleteResults());});}});},select:function(event,ui){event.stopImmediatePropagation();event.preventDefault();var item=ui.item;self.floating=false;if(item.id){self.reinitialize({id:item.id,display_name:item.name});}else if(item.action){item.action();}
return false;},focus:function(event){event.preventDefault();},open:function(event){self._onScroll=function(ev){if(ev.target!==self.$input.get(0)&&self.$input.hasClass('ui-autocomplete-input')){self.$input.autocomplete('close');}};window.addEventListener('scroll',self._onScroll,true);},close:function(event){if(event.which===$.ui.keyCode.ESCAPE){event.stopPropagation();}
if(self._onScroll){window.removeEventListener('scroll',self._onScroll,true);}},autoFocus:true,html:true,minLength:0,delay:this.AUTOCOMPLETE_DELAY,});this.$input.autocomplete("option","position",{my:"left top",at:"left bottom"});this.autocomplete_bound=true;},_concatenateAutocompleteResults:function(){var results=[];_.each(this._autocompleteSources,function(source){if(source.results&&source.results.length){results=results.concat(source.results);}else if(source.loading){results.push({label:source.placeholder});}});return results;},_createContext:function(name){var tmp={};var field=this.nodeOptions.create_name_field;if(field===undefined){field="name";}
if(field!==false&&name&&this.nodeOptions.quick_create!==false){tmp["default_"+field]=name;}
return tmp;},_getSearchBlacklist:function(){return[];},_getDisplayName:function(value){return value.split('\n')[0];},_getSearchCreatePopupOptions:function(view,ids,context,dynamicFilters){var self=this;return{res_model:this.field.relation,domain:this.record.getDomain({fieldName:this.name}),context:_.extend({},this.record.getContext(this.recordParams),context||{}),_createContext:this._createContext.bind(this),dynamicFilters:dynamicFilters||[],title:(view==='search'?_t("Search: "):_t("Create: "))+this.string,initial_ids:ids,initial_view:view,disable_multiple_selection:true,no_create:!self.can_create,kanban_view_ref:this.attrs.kanban_view_ref,on_selected:function(records){self.reinitialize(records[0]);},on_closed:function(){self.activate();},};},_manageSearchMore:function(values,search_val,domain,context){var self=this;values=values.slice(0,this.limit);values.push({label:_t("Search More..."),action:function(){var prom;if(search_val!==''){prom=self._rpc({model:self.field.relation,method:'name_search',kwargs:{name:search_val,args:domain,operator:"ilike",limit:self.SEARCH_MORE_LIMIT,context:context,},});}
Promise.resolve(prom).then(function(results){var dynamicFilters;if(results){var ids=_.map(results,function(x){return x[0];});dynamicFilters=[{description:_.str.sprintf(_t('Quick search: %s'),search_val),domain:[['id','in',ids]],}];}
self._searchCreatePopup("search",false,{},dynamicFilters);});},classname:'o_m2o_dropdown_option',});return values;},_onFieldChanged:function(event){this.lastChangeEvent=event;},_quickCreate:function(name){var self=this;var createDone;var def=new Promise(function(resolve,reject){self.createDef=new Promise(function(innerResolve){createDone=function(){innerResolve();resolve();self.createDef=undefined;};});var slowCreate=function(){var dialog=self._searchCreatePopup("form",false,self._createContext(name));dialog.on('closed',self,createDone);};if(self.nodeOptions.quick_create){var nameCreateDef=self._rpc({model:self.field.relation,method:'name_create',args:[name],context:self.record.getContext(self.recordParams),}).guardedCatch(function(reason){reason.event.preventDefault();slowCreate();});self.dp.add(nameCreateDef).then(function(result){if(self.mode==="edit"){self.reinitialize({id:result[0],display_name:result[1]});}
createDone();}).guardedCatch(reject);}else{slowCreate();}});return def;},_renderEdit:function(){var value=this.m2o_value;if(this.nodeOptions.always_reload){value=this._getDisplayName(value);}
this.$input.val(value);if(!this.autocomplete_bound){this._bindAutoComplete();}
this._updateExternalButton();},_renderReadonly:function(){var escapedValue=_.escape((this.m2o_value||"").trim());var value=escapedValue.split('\n').map(function(line){return'<span>'+line+'</span>';}).join('<br/>');this.$el.html(value);if(!this.noOpen&&this.value){this.$el.attr('href',_.str.sprintf('#id=%s&model=%s',this.value.res_id,this.field.relation));this.$el.addClass('o_form_uri');}},_reset:function(){this._super.apply(this,arguments);this.floating=false;this.m2o_value=this._formatValue(this.value);},_search:function(search_val){var self=this;var def=new Promise(function(resolve,reject){var context=self.record.getContext(self.recordParams);var domain=self.record.getDomain(self.recordParams);_.extend(context,self.additionalContext);var blacklisted_ids=self._getSearchBlacklist();if(blacklisted_ids.length>0){domain.push(['id','not in',blacklisted_ids]);}
self._rpc({model:self.field.relation,method:"name_search",kwargs:{name:search_val,args:domain,operator:"ilike",limit:self.limit+1,context:context,}}).then(function(result){var values=_.map(result,function(x){x[1]=self._getDisplayName(x[1]);return{label:_.str.escapeHTML(x[1].trim())||data.noDisplayContent,value:x[1],name:x[1],id:x[0],};});if(values.length>self.limit){values=self._manageSearchMore(values,search_val,domain,context);}
var create_enabled=self.can_create&&!self.nodeOptions.no_create;var raw_result=_.map(result,function(x){return x[1];});if(create_enabled&&!self.nodeOptions.no_quick_create&&search_val.length>0&&!_.contains(raw_result,search_val)){values.push({label:_.str.sprintf(_t('Create "<strong>%s</strong>"'),$('<span />').text(search_val).html()),action:self._quickCreate.bind(self,search_val),classname:'o_m2o_dropdown_option'});}
if(create_enabled&&!self.nodeOptions.no_create_edit){var createAndEditAction=function(){self.$('input').val('');return self._searchCreatePopup("form",false,self._createContext(search_val));};values.push({label:_t("Create and Edit..."),action:createAndEditAction,classname:'o_m2o_dropdown_option',});}else if(values.length===0){values.push({label:_t("No results to show..."),});}
resolve(values);});});this.orderer.add(def);return def;},_searchCreatePopup:function(view,ids,context,dynamicFilters){var options=this._getSearchCreatePopupOptions(view,ids,context,dynamicFilters);return new dialogs.SelectCreateDialog(this,_.extend({},this.nodeOptions,options)).open();},_updateExternalButton:function(){var has_external_button=!this.noOpen&&!this.floating&&this.isSet();this.$external_button.toggle(has_external_button);this.$el.toggleClass('o_with_button',has_external_button);},_onClick:function(event){var self=this;if(this.mode==='readonly'&&!this.noOpen){event.preventDefault();event.stopPropagation();this._rpc({model:this.field.relation,method:'get_formview_action',args:[[this.value.res_id]],context:this.record.getContext(this.recordParams),}).then(function(action){self.trigger_up('do_action',{action:action});});}},_onDialogClosedUnset:function(){this.isDirty=false;this.floating=false;this._render();},_onExternalButtonClick:function(){if(!this.value){this.activate();return;}
var self=this;var context=this.record.getContext(this.recordParams);this._rpc({model:this.field.relation,method:'get_formview_id',args:[[this.value.res_id]],context:context,}).then(function(view_id){new dialogs.FormViewDialog(self,{res_model:self.field.relation,res_id:self.value.res_id,context:context,title:_t("Open: ")+self.string,view_id:view_id,readonly:!self.can_write,on_saved:function(record,changed){if(changed){const _setValue=self._setValue.bind(self,self.value.data,{forceChange:true,});self.trigger_up('reload',{db_id:self.value.id,onSuccess:_setValue,onFailure:_setValue,});}},}).open();});},_onInputClick:function(){if(this.$input.autocomplete("widget").is(":visible")){this.$input.autocomplete("close");}else if(this.floating){this.$input.autocomplete("search");}else{this.$input.autocomplete("search",'');}},_onInputFocusout:function(){if(this.can_create&&this.floating){new M2ODialog(this,this.string,this.$input.val()).open();}},_onInputKeyup:function(ev){if(ev.which===$.ui.keyCode.ENTER||ev.which===$.ui.keyCode.TAB){return;}
this.isDirty=true;if(this.$input.val()===""){this.reinitialize(false);}else if(this._getDisplayName(this.m2o_value)!==this.$input.val()){this.floating=true;this._updateExternalButton();}},_onKeydown:function(){this.floating=false;this._super.apply(this,arguments);},_onNavigationMove:function(ev){basicFields.InputField.prototype._onNavigationMove.apply(this,arguments);if(this.mode==='edit'&&$(this.$input.autocomplete('widget')).is(':visible')){ev.stopPropagation();}},_onQuickCreate:function(event){this._quickCreate(event.data.value);},_onSearchCreatePopup:function(event){var data=event.data;this._searchCreatePopup(data.view_type,false,this._createContext(data.value));},});var Many2oneBarcode=FieldMany2One.extend({});var ListFieldMany2One=FieldMany2One.extend({events:_.extend({},FieldMany2One.prototype.events,{'focusin input':'_onInputFocusin',}),init:function(){this._super.apply(this,arguments);this.mustSetValue=false;this.m2oDialogFocused=false;},activate:function(){if(this.mode==='readonly'){return false;}
return this._super.apply(this,arguments);},reinitialize:function(){this.mustSetValue=false;return this._super.apply(this,arguments);},_renderReadonly:function(){this.$el.text(this.m2o_value);},_searchCreatePopup:function(){this.m2oDialogFocused=true;return this._super.apply(this,arguments);},_onInputFocusin:function(){this.m2oDialogFocused=false;},_onInputFocusout:function(){if(this.can_create&&this.floating){var attachedEvents=['click','mousedown'];var stopNextClick=(function(ev){ev.stopPropagation();attachedEvents.forEach(function(eventName){window.removeEventListener(eventName,stopNextClick,true);});}).bind(this);attachedEvents.forEach(function(eventName){window.addEventListener(eventName,stopNextClick,true);});}
this._super.apply(this,arguments);if(!this.m2oDialogFocused&&this.$input.val()===""&&this.mustSetValue){this.reinitialize(false);}},_onInputKeyup:function(){if(this.$input.val()!==""){this._super.apply(this,arguments);}else{this.mustSetValue=true;}},});var KanbanFieldMany2One=AbstractField.extend({tagName:'span',init:function(){this._super.apply(this,arguments);this.m2o_value=this._formatValue(this.value);},_render:function(){this.$el.text(this.m2o_value);},});var FieldX2Many=AbstractField.extend({tagName:'div',custom_events:_.extend({},AbstractField.prototype.custom_events,{add_record:'_onAddRecord',discard_changes:'_onDiscardChanges',edit_line:'_onEditLine',field_changed:'_onFieldChanged',open_record:'_onOpenRecord',kanban_record_delete:'_onRemoveRecord',list_record_remove:'_onRemoveRecord',resequence_records:'_onResequenceRecords',save_line:'_onSaveLine',toggle_column_order:'_onToggleColumnOrder',activate_next_widget:'_onActiveNextWidget',navigation_move:'_onNavigationMove',save_optional_fields:'_onSaveOrLoadOptionalFields',load_optional_fields:'_onSaveOrLoadOptionalFields',}),resetOnAnyFieldChange:true,useSubview:true,init:function(parent,name,record,options){this._super.apply(this,arguments);this.nodeOptions=_.defaults(this.nodeOptions,{create_text:_t('Add'),});this.operations=[];this.isReadonly=this.mode==='readonly';this.view=this.attrs.views[this.attrs.mode];this.isMany2Many=this.field.type==='many2many'||this.attrs.widget==='many2many';this.activeActions={};this.recordParams={fieldName:this.name,viewType:this.viewType};var arch=this.view&&this.view.arch;if(arch){this.activeActions.create=arch.attrs.create?!!JSON.parse(arch.attrs.create):true;this.activeActions.delete=arch.attrs.delete?!!JSON.parse(arch.attrs.delete):true;this.editable=arch.attrs.editable;}
if(this.attrs.columnInvisibleFields){this._processColumnInvisibleFields();}},start:function(){return this._renderControlPanel().then(this._super.bind(this));},on_attach_callback:function(){this.isInDOM=true;if(this.renderer){this.renderer.on_attach_callback();}},on_detach_callback:function(){this.isInDOM=false;},commitChanges:function(){var self=this;var inEditionRecordID=this.renderer&&this.renderer.viewType==="list"&&this.renderer.getEditableRecordID();if(inEditionRecordID){return this.renderer.commitChanges(inEditionRecordID).then(function(){return self._saveLine(inEditionRecordID);});}
return this._super.apply(this,arguments);},isSet:function(){return true;},reset:function(record,ev,fieldChanged){if(!fieldChanged){var newEval=this._evalColumnInvisibleFields();if(_.isEqual(this.currentColInvisibleFields,newEval)){return Promise.resolve();}}else if(ev&&ev.target===this&&ev.data.changes&&this.view.arch.tag==='tree'){var command=ev.data.changes[this.name];if(command&&command.operation==='UPDATE'&&command.data){var state=record.data[this.name];var fieldNames=state.getFieldNames({viewType:'list'});this._reset(record,ev);return this.renderer.confirmUpdate(state,command.id,fieldNames,ev.initialEvent);}}
return this._super.apply(this,arguments);},getFocusableElement:function(){return(this.mode==='edit'&&this.$input)||this.$el;},activate:function(options){if(!this.activeActions.create||this.isReadonly||!this.$el.is(":visible")){return false;}
if(this.view.type==='kanban'){this.$buttons.find(".o-kanban-button-new").focus();}
if(this.view.arch.tag==='tree'){if(options&&options.noAutomaticCreate){this.renderer.$('.o_field_x2many_list_row_add a:first').focus();}else{this.renderer.$('.o_field_x2many_list_row_add a:first').click();}}
return true;},_evalColumnInvisibleFields:function(){var self=this;return _.mapObject(this.columnInvisibleFields,function(domains){return self.record.evalModifiers({column_invisible:domains,}).column_invisible;});},_getRenderer:function(){if(this.view.arch.tag==='tree'){return ListRenderer;}
if(this.view.arch.tag==='kanban'){return KanbanRenderer;}},_render:function(){var self=this;if(!this.view){return this._super();}
if(this.renderer){this.currentColInvisibleFields=this._evalColumnInvisibleFields();return this.renderer.updateState(this.value,{columnInvisibleFields:this.currentColInvisibleFields,keepWidths:true,}).then(function(){self.pager.updateState({size:self.value.count});});}
var arch=this.view.arch;var viewType;var rendererParams={arch:arch,};if(arch.tag==='tree'){viewType='list';this.currentColInvisibleFields=this._evalColumnInvisibleFields();_.extend(rendererParams,{editable:this.mode==='edit'&&arch.attrs.editable,addCreateLine:!this.isReadonly&&this.activeActions.create,addTrashIcon:!this.isReadonly&&this.activeActions.delete,isMany2Many:this.isMany2Many,columnInvisibleFields:this.currentColInvisibleFields,});}
if(arch.tag==='kanban'){viewType='kanban';var record_options={editable:false,deletable:false,read_only_mode:this.isReadonly,};_.extend(rendererParams,{record_options:record_options,readOnlyMode:this.isReadonly,});}
_.extend(rendererParams,{viewType:viewType,});var Renderer=this._getRenderer();this.renderer=new Renderer(this,this.value,rendererParams);this.$el.addClass('o_field_x2many o_field_x2many_'+viewType);if(this.renderer){return this.renderer.appendTo(document.createDocumentFragment()).then(function(){dom.append(self.$el,self.renderer.$el,{in_DOM:self.isInDOM,callbacks:[{widget:self.renderer}],});});}else{return this._super();}},_renderControlPanel:function(){if(!this.view){return Promise.resolve();}
var self=this;var defs=[];var controlPanelView=new ControlPanelView({template:'X2ManyControlPanel',withSearchBar:false,});var cpDef=controlPanelView.getController(this).then(function(controlPanel){self._controlPanel=controlPanel;return self._controlPanel.prependTo(self.$el);});this.pager=new Pager(this,this.value.count,this.value.offset+1,this.value.limit,{single_page_hidden:true,withAccessKey:false,validate:function(){var isList=self.view.arch.tag==='tree';return isList?self.renderer.unselectRow():Promise.resolve();},});this.pager.on('pager_changed',this,function(new_state){self.trigger_up('load',{id:self.value.id,limit:new_state.limit,offset:new_state.current_min-1,on_success:function(value){self.value=value;self._render();},});});this._renderButtons();defs.push(this.pager.appendTo($('<div>')));defs.push(cpDef);return Promise.all(defs).then(function(){self._controlPanel.updateContents({cp_content:{$buttons:self.$buttons,$pager:self.pager.$el,}});});},_renderButtons:function(){if(!this.isReadonly&&this.view.arch.tag==='kanban'){this.$buttons=$(qweb.render('KanbanView.buttons',{btnClass:'btn-secondary',create_text:this.nodeOptions.create_text,}));this.$buttons.on('click','button.o-kanban-button-new',this._onAddRecord.bind(this));}},_saveLine:function(recordID){var self=this;return new Promise(function(resolve,reject){var fieldNames=self.renderer.canBeSaved(recordID);if(fieldNames.length){self.trigger_up('discard_changes',{recordID:recordID,onSuccess:resolve,onFailure:reject,});}else{self.renderer.setRowMode(recordID,'readonly').then(resolve);}}).then(function(){self.pager.updateState({size:self.value.count});var newEval=self._evalColumnInvisibleFields();if(!_.isEqual(self.currentColInvisibleFields,newEval)){self.currentColInvisibleFields=newEval;self.renderer.updateState(self.value,{columnInvisibleFields:self.currentColInvisibleFields,});}});},_processColumnInvisibleFields:function(){var columnInvisibleFields={};_.each(this.attrs.columnInvisibleFields,function(domains,fieldName){if(_.isArray(domains)){columnInvisibleFields[fieldName]=_.map(domains,function(domain){if(_.isArray(domain)){return[domain[0].split('.')[1]].concat(domain.slice(1));}
return domain;});}});this.columnInvisibleFields=columnInvisibleFields;},_onAddRecord:function(){},_onRemoveRecord:function(ev){ev.stopPropagation();var operation=this.isMany2Many?'FORGET':'DELETE';this._setValue({operation:operation,ids:[ev.data.id],});},_onDiscardChanges:function(ev){if(ev.target!==this){ev.stopPropagation();this.trigger_up('discard_changes',_.extend({},ev.data,{fieldName:this.name}));}},_onEditLine:function(ev){ev.stopPropagation();this.trigger_up('edited_list',{id:this.value.id});this.renderer.setRowMode(ev.data.recordId,'edit').then(ev.data.onSuccess);},_onFieldChanged:function(ev){if(ev.target===this){ev.initialEvent=this.lastInitialEvent;return;}
ev.stopPropagation();var changes=ev.data.changes;this.lastInitialEvent=undefined;if(Object.keys(changes).length){this.lastInitialEvent=ev;this._setValue({operation:'UPDATE',id:ev.data.dataPointID,data:changes,}).then(function(){if(ev.data.onSuccess){ev.data.onSuccess();}}).guardedCatch(function(){if(ev.data.onFailure){ev.data.onFailure();}});}},_onNavigationMove:function(ev){if(this.view.arch.tag==='tree'){var $curControl=this.renderer.$('.o_field_x2many_list_row_add a:focus');if($curControl.length){var $nextControl;if(ev.data.direction==='right'){$nextControl=$curControl.next('a');}else if(ev.data.direction==='left'){$nextControl=$curControl.prev('a');}
if($nextControl&&$nextControl.length){ev.stopPropagation();$nextControl.focus();return;}}}
this._super.apply(this,arguments);},_onOpenRecord:function(){},_onSaveLine:function(ev){var self=this;ev.stopPropagation();this.renderer.commitChanges(ev.data.recordID).then(function(){self.trigger_up('mutexify',{action:function(){return self._saveLine(ev.data.recordID).then(ev.data.onSuccess).guardedCatch(ev.data.onFailure);},});});},_onSaveOrLoadOptionalFields:function(ev){ev.data.keyParts.relationalField=this.name;ev.data.keyParts.subViewId=this.view.view_id;ev.data.keyParts.subViewType=this.view.type;},_onResequenceRecords:function(ev){ev.stopPropagation();var self=this;if(this.view.arch.tag==='tree'){this.trigger_up('edited_list',{id:this.value.id});}
var handleField=ev.data.handleField;var offset=ev.data.offset;var recordIds=ev.data.recordIds.slice();var recordId=recordIds.pop();var proms=recordIds.map(function(recordId,index){var data={};data[handleField]=offset+index;return self._setValue({operation:'UPDATE',id:recordId,data:data,},{notifyChange:false,});});Promise.all(proms).then(function(){function always(){if(self.view.arch.tag==='tree'){self.trigger_up('toggle_column_order',{id:self.value.id,name:handleField,});}}
var data={};data[handleField]=offset+recordIds.length;self._setValue({operation:'UPDATE',id:recordId,data:data,}).then(always).guardedCatch(always);});},_onToggleColumnOrder:function(ev){ev.data.field=this.name;},_onActiveNextWidget:function(e){e.stopPropagation();this.renderer.unselectRow();this.trigger_up('navigation_move',{direction:e.data.direction||'next',});},});var One2ManyKanbanRecord=KanbanRecord.extend({_postProcessObjectButtons:function(){var self=this;if(!this.state.res_id){this.$('.oe_kanban_action[data-type=object]').each(function(index,button){var $button=$(button);if($button.attr('warn')){$button.on('click',function(e){e.stopPropagation();self.do_warn(_t('Warning'),_t('Please click on the "save" button first.'));});}else{$button.attr('disabled','disabled');}});}},_render:function(){var self=this;return this._super.apply(this,arguments).then(function(){self._postProcessObjectButtons();});},});var One2ManyKanbanRenderer=KanbanRenderer.extend({config:_.extend({},KanbanRenderer.prototype.config,{KanbanRecord:One2ManyKanbanRecord,}),});var FieldOne2Many=FieldX2Many.extend({description:_lt("One2many"),className:'o_field_one2many',supportedFieldTypes:['one2many'],init:function(){this._super.apply(this,arguments);this.creatingRecord=false;},reset:function(record,ev){var self=this;return this._super.apply(this,arguments).then(function(){if(ev&&ev.target===self&&ev.data.changes&&self.view.arch.tag==='tree'){if(ev.data.changes[self.name]&&ev.data.changes[self.name].operation==='CREATE'){var index=0;if(self.editable!=='top'){index=self.value.data.length-1;self.pager.updateState({size:self.value.count-1});}
var newID=self.value.data[index].id;self.renderer.editRecord(newID);}}});},_getRenderer:function(){if(this.view.arch.tag==='kanban'){return One2ManyKanbanRenderer;}
return this._super.apply(this,arguments);},_renderButtons:function(){if(this.activeActions.create){this._super.apply(this,arguments);}},_openFormDialog:function(params){var context=this.record.getContext(_.extend({},this.recordParams,{additionalContext:params.context}));this.trigger_up('open_one2many_record',_.extend(params,{domain:this.record.getDomain(this.recordParams),context:context,field:this.field,fields_view:this.attrs.views&&this.attrs.views.form,parentID:this.value.id,viewInfo:this.view,deletable:this.activeActions.delete&&params.deletable,}));},_onAddRecord:function(ev){var self=this;var data=ev.data||{};ev.stopPropagation();if(this.editable||data.forceEditable){if(!this.activeActions.create){if(data.onFail){data.onFail();}}else if(!this.creatingRecord){this.creatingRecord=true;this.trigger_up('edited_list',{id:this.value.id});this._setValue({operation:'CREATE',position:this.editable||data.forceEditable,context:data.context,},{allowWarning:data.allowWarning}).then(function(){self.creatingRecord=false;}).then(function(){if(data.onSuccess){data.onSuccess();}}).guardedCatch(function(){self.creatingRecord=false;});}}else{this._openFormDialog({context:data.context&&data.context[0],on_saved:function(record){self._setValue({operation:'ADD',id:record.id});},});}},_onOpenRecord:function(ev){var self=this;ev.stopPropagation();var id=ev.data.id;var onSaved=function(record){if(_.some(self.value.data,{id:record.id})){self._setValue({operation:'UPDATE',id:record.id});}else{self._setValue({operation:'ADD',id:record.id});}};this._openFormDialog({id:id,on_saved:onSaved,on_remove:function(){self._setValue({operation:'DELETE',ids:[id]});},deletable:this.activeActions.delete&&this.view.arch.tag!=='tree',readonly:this.mode==='readonly',});},});var FieldMany2Many=FieldX2Many.extend({description:_lt("Many2many"),className:'o_field_many2many',supportedFieldTypes:['many2many'],onAddRecordOpenDialog:function(){var self=this;var domain=this.record.getDomain({fieldName:this.name});new dialogs.SelectCreateDialog(this,{res_model:this.field.relation,domain:domain.concat(["!",["id","in",this.value.res_ids]]),context:this.record.getContext(this.recordParams),title:_t("Add: ")+this.string,no_create:this.nodeOptions.no_create||!this.activeActions.create,fields_view:this.attrs.views.form,kanban_view_ref:this.attrs.kanban_view_ref,on_selected:function(records){var resIDs=_.pluck(records,'id');var newIDs=_.difference(resIDs,self.value.res_ids);if(newIDs.length){var values=_.map(newIDs,function(id){return{id:id};});self._setValue({operation:'ADD_M2M',ids:values,});}}}).open();},_onAddRecord:function(ev){ev.stopPropagation();this.onAddRecordOpenDialog();},_onOpenRecord:function(ev){var self=this;_.extend(ev.data,{context:this.record.getContext(this.recordParams),domain:this.record.getDomain(this.recordParams),fields_view:this.attrs.views&&this.attrs.views.form,on_saved:function(){self._setValue({operation:'TRIGGER_ONCHANGE'},{forceChange:true}).then(function(){self.trigger_up('reload',{db_id:ev.data.id});});},on_remove:function(){self._setValue({operation:'FORGET',ids:[ev.data.id]});},readonly:this.mode==='readonly',deletable:this.activeActions.delete&&this.view.arch.tag!=='tree',string:this.string,});},});var FieldMany2ManyBinaryMultiFiles=AbstractField.extend({template:"FieldBinaryFileUploader",template_files:"FieldBinaryFileUploader.files",supportedFieldTypes:['many2many'],fieldsToFetch:{name:{type:'char'},mimetype:{type:'char'},},events:{'click .o_attach':'_onAttach','click .o_attachment_delete':'_onDelete','change .o_input_file':'_onFileChanged',},init:function(){this._super.apply(this,arguments);if(this.field.type!=='many2many'||this.field.relation!=='ir.attachment'){var msg=_t("The type of the field '%s' must be a many2many field with a relation to 'ir.attachment' model.");throw _.str.sprintf(msg,this.field.string);}
this.uploadedFiles={};this.uploadingFiles=[];this.fileupload_id=_.uniqueId('oe_fileupload_temp');$(window).on(this.fileupload_id,this._onFileLoaded.bind(this));this.metadata={};},destroy:function(){this._super();$(window).off(this.fileupload_id);},_getFileUrl:function(attachment){return'/web/content/'+attachment.id+'?download=true';},_generatedMetadata:function(){var self=this;_.each(this.value.data,function(record){self.metadata[record.id]={allowUnlink:self.uploadedFiles[record.data.id]||false,url:self._getFileUrl(record.data),};});},_render:function(){this._generatedMetadata();this.$('.oe_placeholder_files, .o_attachments').replaceWith($(qweb.render(this.template_files,{widget:this,})));this.$('.oe_fileupload').show();this.$('.o_image[data-mimetype^="image"]').each(function(){var $img=$(this);if(/gif|jpe|jpg|png/.test($img.data('mimetype'))&&$img.data('src')){$img.css('background-image',"url('"+$img.data('src')+"')");}});},_onAttach:function(){this.$('.o_input_file').click();},_onDelete:function(ev){ev.preventDefault();ev.stopPropagation();var fileID=$(ev.currentTarget).data('id');var record=_.findWhere(this.value.data,{res_id:fileID});if(record){this._setValue({operation:'FORGET',ids:[record.id],});var metadata=this.metadata[record.id];if(!metadata||metadata.allowUnlink){this._rpc({model:'ir.attachment',method:'unlink',args:[record.res_id],});}}},_onFileChanged:function(ev){var self=this;ev.stopPropagation();var files=ev.target.files;var attachment_ids=this.value.res_ids;if(files.length===0)
return;_.each(files,function(file){var record=_.find(self.value.data,function(attachment){return attachment.data.name===file.name;});if(record){var metadata=self.metadata[record.id];if(!metadata||metadata.allowUnlink){attachment_ids=_.without(attachment_ids,record.res_id);self._rpc({model:'ir.attachment',method:'unlink',args:[record.res_id],});}}
self.uploadingFiles.push(file);});this._setValue({operation:'REPLACE_WITH',ids:attachment_ids,});this.$('form.o_form_binary_form').submit();this.$('.oe_fileupload').hide();ev.target.value="";},_onFileLoaded:function(){var self=this;var files=Array.prototype.slice.call(arguments,1);this.uploadingFiles=[];var attachment_ids=this.value.res_ids;_.each(files,function(file){if(file.error){self.do_warn(_t('Uploading Error'),file.error);}else{attachment_ids.push(file.id);self.uploadedFiles[file.id]=true;}});this._setValue({operation:'REPLACE_WITH',ids:attachment_ids,});},});var FieldMany2ManyTags=AbstractField.extend({description:_lt("Tags"),tag_template:"FieldMany2ManyTag",className:"o_field_many2manytags",supportedFieldTypes:['many2many'],custom_events:_.extend({},AbstractField.prototype.custom_events,{field_changed:'_onFieldChanged',}),events:_.extend({},AbstractField.prototype.events,{'click .o_delete':'_onDeleteTag',}),fieldsToFetch:{display_name:{type:'char'},},limit:1000,init:function(){this._super.apply(this,arguments);if(this.mode==='edit'){this.className+=' o_input';}
this.colorField=this.nodeOptions.color_field;this.hasDropdown=false;},activate:function(){return this.many2one?this.many2one.activate():false;},getFocusableElement:function(){return this.many2one?this.many2one.getFocusableElement():$();},isSet:function(){return!!this.value&&this.value.count;},reset:function(record,event){var self=this;return this._super.apply(this,arguments).then(function(){if(event&&event.target===self){self.activate();}});},_addTag:function(data){if(!_.contains(this.value.res_ids,data.id)){this._setValue({operation:'ADD_M2M',ids:data});}},_getRenderTagsContext:function(){var elements=this.value?_.pluck(this.value.data,'data'):[];return{colorField:this.colorField,elements:elements,hasDropdown:this.hasDropdown,readonly:this.mode==="readonly",};},_removeTag:function(id){var record=_.findWhere(this.value.data,{res_id:id});this._setValue({operation:'FORGET',ids:[record.id],});},_renderEdit:function(){var self=this;this._renderTags();if(this.many2one){this.many2one.destroy();}
this.many2one=new FieldMany2One(this,this.name,this.record,{mode:'edit',noOpen:true,viewType:this.viewType,attrs:this.attrs,});this.many2one.value=false;this.many2one.m2o_value='';this.many2one._getSearchBlacklist=function(){return self.value.res_ids;};var _getSearchCreatePopupOptions=this.many2one._getSearchCreatePopupOptions;this.many2one._getSearchCreatePopupOptions=function(view,ids,context,dynamicFilters){var options=_getSearchCreatePopupOptions.apply(this,arguments);var domain=this.record.getDomain({fieldName:this.name});var m2mRecords=[];return _.extend({},options,{domain:domain.concat(["!",["id","in",self.value.res_ids]]),disable_multiple_selection:false,on_selected:function(records){m2mRecords.push(...records);},on_closed:function(){self.many2one.reinitialize(m2mRecords);},});};return this.many2one.appendTo(this.$el);},_renderReadonly:function(){this._renderTags();},_renderTags:function(){this.$el.html(qweb.render(this.tag_template,this._getRenderTagsContext()));},_onDeleteTag:function(event){event.preventDefault();event.stopPropagation();this._removeTag($(event.target).parent().data('id'));},_onFieldChanged:function(ev){if(ev.target!==this.many2one){return;}
ev.stopPropagation();var newValue=ev.data.changes[this.name];if(newValue){this._addTag(newValue);this.many2one.reinitialize(false);}},_onKeydown:function(ev){if(ev.which===$.ui.keyCode.BACKSPACE&&this.$('input').val()===""){var $badges=this.$('.badge');if($badges.length){this._removeTag($badges.last().data('id'));return;}}
this._super.apply(this,arguments);},_onQuickCreate:function(event){this._quickCreate(event.data.value);},});var FieldMany2ManyTagsAvatar=FieldMany2ManyTags.extend({tag_template:'FieldMany2ManyTagAvatar',className:'o_field_many2manytags avatar',_getRenderTagsContext:function(){var result=this._super.apply(this,arguments);result.avatarModel=this.nodeOptions.avatarModel||this.field.relation;result.avatarField=this.nodeOptions.avatarField||'image_128';return result;},});var FormFieldMany2ManyTags=FieldMany2ManyTags.extend({events:_.extend({},FieldMany2ManyTags.prototype.events,{'click .dropdown-toggle':'_onOpenColorPicker','mousedown .o_colorpicker a':'_onUpdateColor','mousedown .o_colorpicker .o_hide_in_kanban':'_onUpdateColor',}),init:function(){this._super.apply(this,arguments);this.hasDropdown=!!this.colorField;},_onOpenColorPicker:function(ev){ev.preventDefault();if(this.nodeOptions.no_edit_color){ev.stopPropagation();return;}
var tagID=$(ev.currentTarget).parent().data('id');var tagColor=$(ev.currentTarget).parent().data('color');var tag=_.findWhere(this.value.data,{res_id:tagID});if(tag&&this.colorField in tag.data){this.$color_picker=$(qweb.render('FieldMany2ManyTag.colorpicker',{'widget':this,'tag_id':tagID,}));$(ev.currentTarget).after(this.$color_picker);this.$color_picker.dropdown();this.$color_picker.attr("tabindex",1).focus();if(!tagColor){this.$('.custom-checkbox input').prop('checked',true);}}},_onUpdateColor:function(ev){ev.preventDefault();var $target=$(ev.currentTarget);var color=$target.data('color');var id=$target.data('id');var $tag=this.$(".badge[data-id='"+id+"']");var currentColor=$tag.data('color');var changes={};if($target.is('.o_hide_in_kanban')){var $checkbox=$('.o_hide_in_kanban .custom-checkbox input');$checkbox.prop('checked',!$checkbox.prop('checked'));this.prevColors=this.prevColors?this.prevColors:{};if($checkbox.is(':checked')){this.prevColors[id]=currentColor;}else{color=this.prevColors[id]?this.prevColors[id]:1;}}else if($target.is('[class^="o_tag_color"]')){if(color===currentColor){return;}}
changes[this.colorField]=color;this.trigger_up('field_changed',{dataPointID:_.findWhere(this.value.data,{res_id:id}).id,changes:changes,force_save:true,});},});var KanbanFieldMany2ManyTags=FieldMany2ManyTags.extend({events:AbstractField.prototype.events,_render:function(){var self=this;if(this.$el){this.$el.empty().addClass('o_field_many2manytags o_kanban_tags');}
_.each(this.value.data,function(m2m){if(self.colorField in m2m.data&&!m2m.data[self.colorField]){return;}
$('<span>',{class:'o_tag o_tag_color_'+(m2m.data[self.colorField]||0),text:m2m.data.display_name,}).prepend('<span>').appendTo(self.$el);});},});var FieldMany2ManyCheckBoxes=AbstractField.extend({description:_lt("Checkboxes"),template:'FieldMany2ManyCheckBoxes',events:_.extend({},AbstractField.prototype.events,{change:'_onChange',}),specialData:"_fetchSpecialRelation",supportedFieldTypes:['many2many'],limit:100000,init:function(){this._super.apply(this,arguments);this.m2mValues=this.record.specialData[this.name];},isSet:function(){return true;},_renderCheckboxes:function(){var self=this;this.m2mValues=this.record.specialData[this.name];this.$el.html(qweb.render(this.template,{widget:this}));_.each(this.value.res_ids,function(id){self.$('input[data-record-id="'+id+'"]').prop('checked',true);});},_renderEdit:function(){this._renderCheckboxes();},_renderReadonly:function(){this._renderCheckboxes();this.$("input").prop("disabled",true);},_onChange:function(){var ids=_.map(this.$('input:checked'),function(input){return $(input).data("record-id");});const displayedIds=this.m2mValues.map(v=>v[0]);const idsInRelation=this.value.res_ids;ids=ids.concat(idsInRelation.filter(a=>!displayedIds.includes(a)));this._setValue({operation:'REPLACE_WITH',ids:ids,});},});var FieldStatus=AbstractField.extend({className:'o_statusbar_status',events:{'click button:not(.dropdown-toggle)':'_onClickStage',},specialData:"_fetchSpecialStatus",supportedFieldTypes:['selection','many2one'],init:function(){this._super.apply(this,arguments);this._setState();this._onClickStage=_.debounce(this._onClickStage,300,true);try{this.isClickable=!!JSON.parse(this.attrs.clickable);}catch(_){this.isClickable=!!this.nodeOptions.clickable;}},_reset:function(){this._super.apply(this,arguments);this._setState();},_setState:function(){var self=this;if(this.field.type==='many2one'){this.status_information=_.map(this.record.specialData[this.name],function(info){return _.extend({selected:info.id===self.value.res_id,},info);});}else{var selection=this.field.selection;if(this.attrs.statusbar_visible){var restriction=this.attrs.statusbar_visible.split(",");selection=_.filter(selection,function(val){return _.contains(restriction,val[0])||val[0]===self.value;});}
this.status_information=_.map(selection,function(val){return{id:val[0],display_name:val[1],selected:val[0]===self.value,fold:false};});}},_render:function(){var selections=_.partition(this.status_information,function(info){return(info.selected||!info.fold);});this.$el.html(qweb.render("FieldStatus.content",{selection_unfolded:selections[0],selection_folded:selections[1],clickable:this.isClickable,}));},_onClickStage:function(e){this._setValue($(e.currentTarget).data("value"));},});var FieldSelection=AbstractField.extend({description:_lt("Selection"),template:'FieldSelection',specialData:"_fetchSpecialRelation",supportedFieldTypes:['selection'],events:_.extend({},AbstractField.prototype.events,{'change':'_onChange',}),init:function(){this._super.apply(this,arguments);this._setValues();},getFocusableElement:function(){return this.$el&&this.$el.is('select')?this.$el:$();},isSet:function(){return this.value!==false;},updateModifiersValue:function(){this._super.apply(this,arguments);if(!this.attrs.modifiersValue.invisible&&this.mode!=='readonly'){this._setValues();this._renderEdit();}},_renderEdit:function(){this.$el.empty();var required=this.attrs.modifiersValue&&this.attrs.modifiersValue.required;for(var i=0;i<this.values.length;i++){var disabled=required&&this.values[i][0]===false;this.$el.append($('<option/>',{value:JSON.stringify(this.values[i][0]),text:this.values[i][1],style:disabled?"display: none":"",}));}
var value=this.value;if(this.field.type==='many2one'&&value){value=value.data.id;}
this.$el.val(JSON.stringify(value));},_renderReadonly:function(){this.$el.empty().text(this._formatValue(this.value));},_reset:function(){this._super.apply(this,arguments);this._setValues();},_setValues:function(){if(this.field.type==='many2one'){this.values=this.record.specialData[this.name];this.formatType='many2one';}else{this.values=_.reject(this.field.selection,function(v){return v[0]===false&&v[1]==='';});}
this.values=[[false,this.attrs.placeholder||'']].concat(this.values);},_onChange:function(){var res_id=JSON.parse(this.$el.val());if(this.field.type==='many2one'){var value=_.find(this.values,function(val){return val[0]===res_id;});this._setValue({id:res_id,display_name:value[1]});}else{this._setValue(res_id);}},});var FieldRadio=FieldSelection.extend({description:_lt("Radio"),template:null,className:'o_field_radio',tagName:'span',specialData:"_fetchSpecialMany2ones",supportedFieldTypes:['selection','many2one'],events:_.extend({},AbstractField.prototype.events,{'click input':'_onInputClick',}),init:function(){this._super.apply(this,arguments);if(this.mode==='edit'){this.tagName='div';this.className+=this.nodeOptions.horizontal?' o_horizontal':' o_vertical';}
this.unique_id=_.uniqueId("radio");this._setValues();},isSet:function(){return true;},getFocusableElement:function(){var checked=this.$("[checked='true']");return checked.length?checked:this.$("[data-index='0']");},setIDForLabel:function(id){this.$el.attr('id',id);},_renderEdit:function(){var self=this;var currentValue;if(this.field.type==='many2one'){currentValue=this.value&&this.value.data.id;}else{currentValue=this.value;}
this.$el.empty();this.$el.attr('role','radiogroup').attr('aria-label',this.string);_.each(this.values,function(value,index){self.$el.append(qweb.render('FieldRadio.button',{checked:value[0]===currentValue,id:self.unique_id+'_'+value[0],index:index,name:self.unique_id,value:value,}));});},_reset:function(){this._super.apply(this,arguments);this._setValues();},_setValues:function(){if(this.field.type==='selection'){this.values=this.field.selection||[];}else if(this.field.type==='many2one'){this.values=_.map(this.record.specialData[this.name],function(val){return[val.id,val.display_name];});}},_onInputClick:function(event){var index=$(event.target).data('index');var value=this.values[index];if(this.field.type==='many2one'){this._setValue({id:value[0],display_name:value[1]});}else{this._setValue(value[0]);}},});var FieldSelectionBadge=FieldSelection.extend({description:_lt("Badges"),template:null,className:'o_field_selection_badge',tagName:'span',specialData:"_fetchSpecialMany2ones",events:_.extend({},AbstractField.prototype.events,{'click span.o_selection_badge':'_onBadgeClicked',}),_renderEdit:function(){this.currentValue=this.value;if(this.field.type==='many2one'){this.currentValue=this.value&&this.value.data.id;}
this.$el.empty();this.$el.html(qweb.render('FieldSelectionBadge',{'values':this.values,'current_value':this.currentValue}));},_setValues:function(){if(this.field.type==='selection'){this.values=this.field.selection||[];}else if(this.field.type==='many2one'){this.values=_.map(this.record.specialData[this.name],function(val){return[val.id,val.display_name];});}},_onBadgeClicked:function(event){var index=$(event.target).data('index');var value=this.values[index];if(value[0]!==this.currentValue){if(this.field.type==='many2one'){this._setValue({id:value[0],display_name:value[1]});}else{this._setValue(value[0]);}}else{this._setValue(false);}},});var FieldSelectionFont=FieldSelection.extend({_renderEdit:function(){this._super.apply(this,arguments);this.$('option').each(function(i,option){if(!option.label){$(option).remove();}
$(option).css('font-family',option.value);});this.$el.css('font-family',this.value);},});var FieldReference=FieldMany2One.extend({specialData:"_fetchSpecialReference",supportedFieldTypes:['reference'],template:'FieldReference',events:_.extend({},FieldMany2One.prototype.events,{'change select':'_onSelectionChange',}),init:function(){this._super.apply(this,arguments);this.field=_.extend({},this.field);this._setState();},start:function(){this.$('select').val(this.field.relation);return this._super.apply(this,arguments);},getFocusableElement:function(){if(this.mode==='edit'&&!this.field.relation){return this.$('select');}
return this._super.apply(this,arguments);},_formatValue:function(){var value;if(this.field.type==='char'){value=this.record.specialData[this.name];}else{value=this.value;}
return value&&value.data&&value.data.display_name||'';},_renderEdit:function(){this._super.apply(this,arguments);if(this.$('select').val()){this.$('.o_input_dropdown').show();this.$el.addClass('o_row');}else{this.$('.o_input_dropdown').hide();}},_reset:function(){this._super.apply(this,arguments);var value=this.$('select').val();this._setState();this.$('select').val(this.value&&this.value.model||value);},_setRelation:function(model){this.field.relation=model;},_setState:function(){if(this.field.type==='char'){this.value=this.record.specialData[this.name];}
if(this.value){this._setRelation(this.value.model);}},_setValue:function(value,options){value=value||{};value.model=this.$('select').val();return this._super(value,options);},_onSelectionChange:function(){var value=this.$('select').val();this.reinitialize(false);this._setRelation(value);},});return{FieldMany2One:FieldMany2One,Many2oneBarcode:Many2oneBarcode,KanbanFieldMany2One:KanbanFieldMany2One,ListFieldMany2One:ListFieldMany2One,FieldX2Many:FieldX2Many,FieldOne2Many:FieldOne2Many,FieldMany2Many:FieldMany2Many,FieldMany2ManyBinaryMultiFiles:FieldMany2ManyBinaryMultiFiles,FieldMany2ManyCheckBoxes:FieldMany2ManyCheckBoxes,FieldMany2ManyTags:FieldMany2ManyTags,FieldMany2ManyTagsAvatar:FieldMany2ManyTagsAvatar,FormFieldMany2ManyTags:FormFieldMany2ManyTags,KanbanFieldMany2ManyTags:KanbanFieldMany2ManyTags,FieldRadio:FieldRadio,FieldSelectionBadge:FieldSelectionBadge,FieldSelection:FieldSelection,FieldStatus:FieldStatus,FieldSelectionFont:FieldSelectionFont,FieldReference:FieldReference,};});;

/* /web/static/src/js/fields/special_fields.js defined in bundle 'web.assets_backend' */
odoo.define('web.special_fields',function(require){"use strict";var core=require('web.core');var field_utils=require('web.field_utils');var relational_fields=require('web.relational_fields');var FieldSelection=relational_fields.FieldSelection;var _t=core._t;var FieldTimezoneMismatch=FieldSelection.extend({start:function(){var interval=navigator.platform.toUpperCase().indexOf('MAC')>=0?60000:1000;this._datetime=setInterval(this._renderDateTimeTimezone.bind(this),interval);return this._super.apply(this,arguments);},destroy:function(){clearInterval(this._datetime);return this._super();},_render:function(){this._super.apply(this,arguments);this._renderTimezoneMismatch();},_renderDateTimeTimezone:function(){if(!this.mismatch||!this.$option.html()){return;}
var offset=this.recordData.tz_offset.match(/([+-])([0-9]{2})([0-9]{2})/);offset=(offset[1]==='-'?-1:1)*(parseInt(offset[2])*60+parseInt(offset[3]));var datetime=field_utils.format.datetime(moment.utc().add(offset,'minutes'),this.field,{timezone:false});var content=this.$option.html().split(' ')[0];content+='    ('+datetime+')';this.$option.html(content);},_renderTimezoneMismatch:function(){this.$el.last().filter('.o_tz_warning').remove();this.$el=this.$el.first();var value=this.$el.val();var $span=$('<span class="fa fa-exclamation-triangle o_tz_warning"/>');if(this.$option&&this.$option.html()){this.$option.html(this.$option.html().split(' ')[0]);}
var userOffset=this.recordData.tz_offset;this.mismatch=false;if(userOffset&&value!==""&&value!=="false"){var offset=-(new Date().getTimezoneOffset());var browserOffset=(offset<0)?"-":"+";browserOffset+=_.str.sprintf("%02d",Math.abs(offset/60));browserOffset+=_.str.sprintf("%02d",Math.abs(offset%60));this.mismatch=(browserOffset!==userOffset);}
if(this.mismatch){$span.insertAfter(this.$el);$span.attr('title',_t("Timezone Mismatch : This timezone is different from that of your browser.\nPlease, set the same timezone as your browser's to avoid time discrepancies in your system."));this.$el=this.$el.add($span);this.$option=this.$('option').filter(function(){return $(this).attr('value')===value;});this._renderDateTimeTimezone();}else if(value=="false"){$span.insertAfter(this.$el);$span.attr('title',_t("Set a timezone on your user"));this.$el=this.$el.add($span);}},_renderEdit:function(){var $otherEl=this.$el.not('select');this.$el=this.$el.first();this._super.apply(this,arguments);$otherEl.insertAfter(this.$el);this.$el=this.$el.add($otherEl);},});var FieldReportLayout=relational_fields.FieldMany2One.extend({events:_.extend({},relational_fields.FieldMany2One.prototype.events,{'click img':'_onImgClicked',}),willStart:function(){var self=this;this.previews={};return this._super().then(function(){return self._rpc({model:'report.layout',method:"search_read"}).then(function(values){self.previews=values;});});},_render:function(){var self=this;this.$el.empty();var value=_.isObject(this.value)?this.value.data.id:this.value;_.each(this.previews,function(val){var $container=$('<div>').addClass('col-3 text-center');var $img=$('<img>').addClass('img img-fluid img-thumbnail ml16').toggleClass('btn-info',val.view_id[0]===value).attr('src',val.image).data('key',val.view_id[0]);$container.append($img);if(val.pdf){var $previewLink=$('<a>').text('Example').attr('href',val.pdf).attr('target','_blank');$container.append($previewLink);}
self.$el.append($container);});},_onImgClicked:function(event){this._setValue($(event.currentTarget).data('key'));},});return{FieldTimezoneMismatch:FieldTimezoneMismatch,FieldReportLayout:FieldReportLayout,};});;

/* /web/static/src/js/views/abstract_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.AbstractView',function(require){"use strict";var AbstractModel=require('web.AbstractModel');var AbstractRenderer=require('web.AbstractRenderer');var AbstractController=require('web.AbstractController');var ControlPanelView=require('web.ControlPanelView');var mvc=require('web.mvc');var SearchPanel=require('web.SearchPanel');var viewUtils=require('web.viewUtils');var Factory=mvc.Factory;var AbstractView=Factory.extend({display_name:'',mobile_friendly:false,icon:'fa-question',multi_record:true,viewType:undefined,withSearchBar:true,searchMenuTypes:['filter','groupBy','favorite'],withControlPanel:true,withSearchPanel:true,config:_.extend({},Factory.prototype.config,{Model:AbstractModel,Renderer:AbstractRenderer,Controller:AbstractController,SearchPanel:SearchPanel,}),init:function(viewInfo,params){this._super.apply(this,arguments);var action=params.action||{};params=_.defaults(params,this._extractParamsFromAction(action));if(typeof viewInfo.arch==='string'){this.fieldsView=this._processFieldsView(viewInfo);}else{this.fieldsView=viewInfo;}
this.arch=this.fieldsView.arch;this.fields=this.fieldsView.viewFields;this.userContext=params.userContext||{};this.withControlPanel=this.withControlPanel&&params.withControlPanel;const searchPanelDisabled='search_panel'in params.context&&!params.search_panel;this.withSearchPanel=this.withSearchPanel&&this.multi_record&&params.withSearchPanel&&!searchPanelDisabled;var isEmbedded=params.isEmbedded||false;var help=params.noContentHelp||"";var htmlHelp=document.createElement("div");htmlHelp.innerHTML=help;this.rendererParams={arch:this.arch,isEmbedded:isEmbedded,noContentHelp:htmlHelp.innerText.trim()?help:"",};this.controllerParams={actionViews:params.actionViews,activeActions:{edit:this.arch.attrs.edit?!!JSON.parse(this.arch.attrs.edit):true,create:this.arch.attrs.create?!!JSON.parse(this.arch.attrs.create):true,delete:this.arch.attrs.delete?!!JSON.parse(this.arch.attrs.delete):true,duplicate:this.arch.attrs.duplicate?!!JSON.parse(this.arch.attrs.duplicate):true,},bannerRoute:this.arch.attrs.banner_route,controllerID:params.controllerID,displayName:params.displayName,isEmbedded:isEmbedded,isMultiRecord:this.multi_record,modelName:params.modelName,viewType:this.viewType,};var controllerState=params.controllerState||{};var currentId=controllerState.currentId||params.currentId;this.loadParams={context:params.context,count:params.count||((this.controllerParams.ids!==undefined)&&this.controllerParams.ids.length)||0,domain:params.domain,modelName:params.modelName,res_id:currentId,res_ids:controllerState.resIds||params.ids||(currentId?[currentId]:undefined),};var defaultOrder=this.arch.attrs.default_order;if(defaultOrder){this.loadParams.orderedBy=_.map(defaultOrder.split(','),function(order){order=order.trim().split(' ');return{name:order[0],asc:order[1]!=='desc'};});}
if(params.searchQuery){this._updateMVCParams(params.searchQuery);}
this.controlPanelParams={action:action,activateDefaultFavorite:params.activateDefaultFavorite,dynamicFilters:params.dynamicFilters,breadcrumbs:params.breadcrumbs,context:this.loadParams.context,domain:this.loadParams.domain,modelName:params.modelName,searchMenuTypes:params.searchMenuTypes,state:controllerState.cpState,viewInfo:params.controlPanelFieldsView,withBreadcrumbs:params.withBreadcrumbs,withSearchBar:params.withSearchBar,};this.searchPanelParams={defaultNoFilter:params.searchPanelDefaultNoFilter,fields:this.fields,model:this.loadParams.modelName,state:controllerState.spState,};},getController:function(parent){var self=this;var cpDef=this.withControlPanel&&this._createControlPanel(parent);var spDef;if(this.withSearchPanel){var spProto=this.config.SearchPanel.prototype;var viewInfo=this.controlPanelParams.viewInfo;var searchPanelParams=spProto.computeSearchPanelParams(viewInfo,this.viewType);if(searchPanelParams.sections){this.searchPanelParams.sections=searchPanelParams.sections;this.rendererParams.withSearchPanel=true;spDef=Promise.resolve(cpDef).then(this._createSearchPanel.bind(this,parent,searchPanelParams));}}
var _super=this._super.bind(this);return Promise.all([cpDef,spDef]).then(function([controlPanel,searchPanel]){var modelParent=self.model&&self.model.getParent();var prom=_super(parent);prom.then(function(controller){if(controlPanel){controlPanel.setParent(controller);}
if(searchPanel){searchPanel.setParent(controller);}
if(modelParent){self.model.setParent(modelParent);}});return prom;});},getModel:function(){if(!this.model){this.model=this._super.apply(this,arguments);}
return this.model;},setController:function(Controller){this.Controller=Controller;},_createControlPanel:function(parent){var self=this;var controlPanelView=new ControlPanelView(this.controlPanelParams);return controlPanelView.getController(parent).then(function(controlPanel){self.controllerParams.controlPanel=controlPanel;return controlPanel.appendTo(document.createDocumentFragment()).then(function(){self._updateMVCParams(controlPanel.getSearchQuery());return controlPanel;});});},_createSearchPanel:async function(parent,params){var defaultValues={};Object.keys(this.loadParams.context).forEach((key)=>{let match=/^searchpanel_default_(.*)$/.exec(key);if(match){defaultValues[match[1]]=this.loadParams.context[key];}});var controlPanelDomain=this.loadParams.domain;const viewDomain=await this._getViewDomain(parent);var spParams=_.extend({},this.searchPanelParams,{defaultValues:defaultValues,searchDomain:controlPanelDomain,viewDomain,classes:params.classes||[],});var searchPanel=new this.config.SearchPanel(parent,spParams);this.controllerParams.searchPanel=searchPanel;this.controllerParams.controlPanelDomain=controlPanelDomain;await searchPanel.appendTo(document.createDocumentFragment());var searchPanelDomain=searchPanel.getDomain();this.loadParams.domain=controlPanelDomain.concat(searchPanelDomain);return searchPanel;},_extractParamsFromAction:function(action){action=action||{};var context=action.context||{};var inline=action.target==='inline';return{actionId:action.id||false,actionViews:action.views||[],activateDefaultFavorite:!context.active_id&&!context.active_ids,context:action.context||{},controlPanelFieldsView:action.controlPanelFieldsView,currentId:action.res_id?action.res_id:undefined,displayName:action.display_name||action.name,domain:action.domain||[],limit:action.limit,modelName:action.res_model,noContentHelp:action.help,searchMenuTypes:inline?[]:this.searchMenuTypes,withBreadcrumbs:'no_breadcrumbs'in context?!context.no_breadcrumbs:true,withControlPanel:this.withControlPanel,withSearchBar:inline?false:this.withSearchBar,withSearchPanel:this.withSearchPanel,};},_getViewDomain:async function(parent){return[];},_processFieldsView:function(fieldsView){var fv=_.extend({},fieldsView);fv.arch=viewUtils.parseArch(fv.arch);fv.viewFields=_.defaults({},fv.viewFields,fv.fields);return fv;},_updateMVCParams:function(searchQuery){var timeRangeMenuData=searchQuery.context.timeRangeMenuData||{};var comparisonTimeRange=timeRangeMenuData.comparisonTimeRange||[];var comparisonTimeRangeDescription=timeRangeMenuData.comparisonTimeRangeDescription||'';var timeRangeDescription=timeRangeMenuData.timeRangeDescription||'';this.loadParams=_.extend(this.loadParams,{compare:comparisonTimeRange.length>0,comparisonField:timeRangeMenuData.comparisonField,comparisonTimeRange:comparisonTimeRange,comparisonTimeRangeDescription:comparisonTimeRangeDescription,context:searchQuery.context,domain:searchQuery.domain,groupedBy:searchQuery.groupBy,timeRange:timeRangeMenuData.timeRange||[],timeRangeDescription:timeRangeMenuData.timeRangeDescription||'',});this.loadParams.orderedBy=searchQuery.orderedBy?searchQuery.orderedBy:this.loadParams.orderedBy;this.rendererParams.timeRangeDescription=timeRangeDescription;this.rendererParams.comparisonTimeRangeDescription=comparisonTimeRangeDescription;},});return AbstractView;});;

/* /web/static/src/js/views/abstract_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.AbstractRenderer',function(require){"use strict";var mvc=require('web.mvc');return mvc.Renderer.extend({init:function(parent,state,params){this._super.apply(this,arguments);this.arch=params.arch;this.noContentHelp=params.noContentHelp;this.withSearchPanel=params.withSearchPanel;},start:function(){this.$el.addClass(this.arch.attrs.class);if(this.withSearchPanel){this.$el.addClass('o_renderer_with_searchpanel');}
return Promise.all([this._render(),this._super()]);},on_attach_callback:function(){},on_detach_callback:function(){},getLocalState:function(){},giveFocus:function(){},setLocalState:function(localState){},updateState:function(state,params){this.state=state;return params.noRender?Promise.resolve():this._render();},_render:function(){return Promise.resolve();},});});;

/* /web/static/src/js/views/abstract_model.js defined in bundle 'web.assets_backend' */
odoo.define('web.AbstractModel',function(require){"use strict";var fieldUtils=require('web.field_utils');var mvc=require('web.mvc');var AbstractModel=mvc.Model.extend({reload:function(params){return Promise.resolve();},_parseServerValue:function(field,value){if(field.type==='date'||field.type==='datetime'){value=fieldUtils.parse[field.type](value,field,{isUTC:true});}else if(field.type==='selection'&&value===false){var hasKey0=_.find(field.selection,function(option){return option[0]===0;});value=hasKey0?0:value;}
return value;},});return AbstractModel;});;

/* /web/static/src/js/views/abstract_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.AbstractController',function(require){"use strict";var ActionMixin=require('web.ActionMixin');var ajax=require('web.ajax');var concurrency=require('web.concurrency');var config=require('web.config');var core=require('web.core');var mvc=require('web.mvc');var session=require('web.session');var QWeb=core.qweb;var AbstractController=mvc.Controller.extend(ActionMixin,{custom_events:_.extend({},ActionMixin.custom_events,{navigation_move:'_onNavigationMove',open_record:'_onOpenRecord',search:'_onSearch',switch_view:'_onSwitchView',search_panel_domain_updated:'_onSearchPanelDomainUpdated',}),events:{'click a[type="action"]':'_onActionClicked',},init:function(parent,model,renderer,params){this._super.apply(this,arguments);this._controlPanel=params.controlPanel;this._title=params.displayName;this.modelName=params.modelName;this.activeActions=params.activeActions;this.controllerID=params.controllerID;this.initialState=params.initialState;this.bannerRoute=params.bannerRoute;this.isMultiRecord=params.isMultiRecord;this.actionViews=params.actionViews;this.viewType=params.viewType;this.dp=new concurrency.DropPrevious();this._searchPanel=params.searchPanel;this.controlPanelDomain=params.controlPanelDomain||[];this.searchPanelDomain=this._searchPanel?this._searchPanel.getDomain():[];},start:function(){var self=this;if(this._searchPanel){this.$('.o_content').addClass('o_controller_with_searchpanel').prepend(this._searchPanel.$el);}
this.$el.addClass('o_view_controller');return this._super.apply(this,arguments).then(function(){var prom;if(self._controlPanel){prom=self._renderControlPanelElements().then(function(elements){self.controlPanelElements=elements;self._controlPanel.$el.prependTo(self.$el);});}
return Promise.resolve(prom);}).then(function(){return self._update(self.initialState);});},destroy:function(){if(this.$buttons){this.$buttons.off();}
if(this.controlPanelElements&&this.controlPanelElements.$switch_buttons){this.controlPanelElements.$switch_buttons.off();}
this._super.apply(this,arguments);},on_attach_callback:function(){if(this._controlPanel){this._controlPanel.on_attach_callback();}
if(this._searchPanel){this._searchPanel.on_attach_callback();}
this.renderer.on_attach_callback();},on_detach_callback:function(){if(this._controlPanel){this._controlPanel.on_detach_callback();}
this.renderer.on_detach_callback();},canBeRemoved:function(){return this.discardChanges(undefined,{noAbandon:true,readonlyIfRealDiscard:true,});},discardChanges:function(recordID,options){return Promise.resolve();},exportState:function(){var state={};if(this._controlPanel){state.cpState=this._controlPanel.exportState();}
if(this._searchPanel){state.spState=this._searchPanel.exportState();}
return state;},giveFocus:function(){this.renderer.giveFocus();},is_action_enabled:function(action){return this.activeActions[action];},reload:async function(params){params=params||{};var searchPanelUpdateProm;var controllerState=params.controllerState||{};var cpState=controllerState.cpState;if(this._controlPanel&&cpState){await this._controlPanel.importState(cpState).then(function(searchQuery){params=_.extend({},params,searchQuery);});}
var postponeRendering=false;if(this._searchPanel){this.controlPanelDomain=params.domain||this.controlPanelDomain;if(controllerState.spState){this._searchPanel.importState(controllerState.spState);this.searchPanelDomain=this._searchPanel.getDomain();}else{const viewDomain=await this._getViewDomain();searchPanelUpdateProm=this._searchPanel.update({searchDomain:this.controlPanelDomain,viewDomain,});postponeRendering=!params.noRender;params.noRender=true;}
params.domain=this.controlPanelDomain.concat(this.searchPanelDomain);}
await Promise.all([this.update(params,{}),searchPanelUpdateProm]);if(postponeRendering){return this.renderer._render();}},renderPager:function($node){return Promise.resolve();},renderSidebar:function($node){return Promise.resolve();},update:function(params,options){var self=this;var shouldReload=(options&&'reload'in options)?options.reload:true;var def=shouldReload?this.model.reload(this.handle,params):Promise.resolve();var cpUpdateIndex=this._controlPanel&&this._controlPanel.updateIndex;return this.dp.add(def).then(function(handle){if(self._controlPanel&&cpUpdateIndex!==self._controlPanel.updateIndex){return;}
self.handle=handle||self.handle;var state=self.model.get(self.handle);var localState=self.renderer.getLocalState();return self.dp.add(self.renderer.updateState(state,params)).then(function(){if(self._controlPanel&&cpUpdateIndex!==self._controlPanel.updateIndex){return;}
self.renderer.setLocalState(localState);return self._update(state,params);});});},_getViewDomain:async function(){return[];},_pushState:function(state){this.trigger_up('push_state',{controllerID:this.controllerID,state:state||{},});},_renderBanner:function(){if(this.bannerRoute!==undefined){var self=this;return this.dp.add(this._rpc({route:this.bannerRoute,params:{context:session.user_context},})).then(function(response){if(!response.html){self.$el.removeClass('o_has_banner');return Promise.resolve();}
self.$el.addClass('o_has_banner');var $banner=$(response.html);if(self._$banner&&self._$banner.remove){self._$banner.remove();}
var defs=[];$('link[rel="stylesheet"]',$banner).each(function(i,link){defs.push(ajax.loadCSS(link.href));link.remove();});$('script[type="text/javascript"]',$banner).each(function(i,js){defs.push(ajax.loadJS(js.src));js.remove();});return Promise.all(defs).then(function(){$banner.insertBefore(self.$('> .o_content'));self._$banner=$banner;});});}
return Promise.resolve();},_renderControlPanelElements:function(){var self=this;var elements={$buttons:$('<div>'),$sidebar:$('<div>'),$pager:$('<div>'),};this.renderButtons(elements.$buttons);var sidebarProm=this.renderSidebar(elements.$sidebar);var pagerProm=this.renderPager(elements.$pager);return Promise.all([sidebarProm,pagerProm]).then(function(){elements=_.mapObject(elements,function($node){return $node&&$node.contents();});elements.$switch_buttons=self._renderSwitchButtons();return elements;});},_renderSwitchButtons:function(){var self=this;var views=_.filter(this.actionViews,{multiRecord:this.isMultiRecord});if(views.length<=1){return $();}
var template=config.device.isMobile?'ControlPanel.SwitchButtons.Mobile':'ControlPanel.SwitchButtons';var $switchButtons=$(QWeb.render(template,{viewType:this.viewType,views:views,}));_.each(views,function(view){$switchButtons.filter('.o_cp_switch_'+view.type).tooltip();});var $switchButtonsFiltered=config.device.isMobile?$switchButtons.find('button'):$switchButtons.filter('button');$switchButtonsFiltered.click(_.debounce(function(event){var viewType=$(event.target).data('view-type');self.trigger_up('switch_view',{view_type:viewType});},200,true));if(config.device.isMobile){var activeView=_.findWhere(views,{type:this.viewType});$switchButtons.find('.o_switch_view_button_icon').addClass('fa fa-lg '+activeView.icon);}
return $switchButtons;},_startRenderer:function(){return this.renderer.appendTo(this.$('.o_content'));},_update:function(state,params){var cpContent=_.extend({},this.controlPanelElements);this.updateControlPanel({breadcrumbs:params&&params.breadcrumbs,cp_content:cpContent,title:this.getTitle(),});this._pushState();return this._renderBanner();},_onActionClicked:function(ev){ev.preventDefault();var $target=$(ev.currentTarget);var self=this;var data=$target.data();if(data.method!==undefined&&data.model!==undefined){var options={};if(data.reloadOnClose){options.on_close=function(){self.trigger_up('reload');};}
this.dp.add(this._rpc({model:data.model,method:data.method,context:session.user_context,})).then(function(action){if(action!==undefined){self.do_action(action,options);}});}else if($target.attr('name')){this.do_action($target.attr('name'),data.context&&{additional_context:data.context});}else{this.do_action({name:$target.attr('title')||_.str.strip($target.text()),type:'ir.actions.act_window',res_model:data.model||this.modelName,res_id:data.resId,target:'current',views:data.views||(data.resId?[[false,'form']]:[[false,'list'],[false,'form']]),domain:data.domain||[],},{additional_context:_.extend({},data.context)});}},_onNavigationMove:function(ev){switch(ev.data.direction){case'up':ev.stopPropagation();this._controlPanel.focusSearchBar();break;case'down':ev.stopPropagation();this.giveFocus();break;}},_onOpenRecord:function(ev){ev.stopPropagation();var record=this.model.get(ev.data.id,{raw:true});this.trigger_up('switch_view',{view_type:'form',res_id:record.res_id,mode:ev.data.mode||'readonly',model:this.modelName,});},_onSearch:function(ev){ev.stopPropagation();this.reload(_.extend({offset:0,groupsOffset:0},ev.data));},_onSearchPanelDomainUpdated:function(ev){this.searchPanelDomain=ev.data.domain;this.reload({offset:0});},_onSwitchView:function(ev){ev.data.controllerID=this.controllerID;},});return AbstractController;});;

/* /web/static/src/js/views/basic/basic_model.js defined in bundle 'web.assets_backend' */
odoo.define('web.BasicModel',function(require){"use strict";var AbstractModel=require('web.AbstractModel');var concurrency=require('web.concurrency');var Context=require('web.Context');var core=require('web.core');var Domain=require('web.Domain');var session=require('web.session');var utils=require('web.utils');var viewUtils=require('web.viewUtils');var _t=core._t;const AGGREGATABLE_TYPES=['float','integer','monetary'];var x2ManyCommands={CREATE:0,create:function(virtualID,values){delete values.id;return[x2ManyCommands.CREATE,virtualID||false,values];},UPDATE:1,update:function(id,values){delete values.id;return[x2ManyCommands.UPDATE,id,values];},DELETE:2,delete:function(id){return[x2ManyCommands.DELETE,id,false];},FORGET:3,forget:function(id){return[x2ManyCommands.FORGET,id,false];},LINK_TO:4,link_to:function(id){return[x2ManyCommands.LINK_TO,id,false];},DELETE_ALL:5,delete_all:function(){return[5,false,false];},REPLACE_WITH:6,replace_with:function(ids){return[6,false,ids];}};var BasicModel=AbstractModel.extend({OPEN_GROUP_LIMIT:10,noCacheModels:['ir.actions.act_window','ir.filters','ir.ui.view',],init:function(){this.mutex=new concurrency.Mutex();this.batchedRPCsRequests=[];this.localData=Object.create(null);this._super.apply(this,arguments);},addDefaultRecord:function(listID,options){var self=this;var list=this.localData[listID];var context=_.extend({},this._getDefaultContext(list),this._getContext(list));var position=(options&&options.position)||'top';var params={context:context,fields:list.fields,fieldsInfo:list.fieldsInfo,parentID:list.id,position:position,viewType:list.viewType,};return this._makeDefaultRecord(list.model,params).then(function(id){list.count++;if(position==='top'){list.data.unshift(id);}else{list.data.push(id);}
var record=self.localData[id];list._cache[record.res_id]=id;return id;});},addFieldsInfo:function(dataPointID,viewInfo){var dataPoint=this.localData[dataPointID];dataPoint.fields=_.extend({},dataPoint.fields,viewInfo.fields);dataPoint.fieldsInfo=dataPoint.fieldsInfo||{};const mainFieldInfo=dataPoint.fieldsInfo[dataPoint[viewInfo.viewType]];dataPoint.fieldsInfo[viewInfo.viewType]=_.defaults({},viewInfo.fieldInfo,mainFieldInfo);if(dataPoint.type==='list'){const proms=[];Object.values(dataPoint._cache).forEach(subDataPointID=>{proms.push(this.addFieldsInfo(subDataPointID,{fields:dataPoint.fields,fieldInfo:dataPoint.fieldsInfo[viewInfo.viewType],viewType:viewInfo.viewType,}));});return Promise.all(proms);}else{return this.applyRawChanges(dataPointID,viewInfo.viewType).then(()=>{const proms=[];const fieldInfo=dataPoint.fieldsInfo[viewInfo.viewType];const values=_.extend({},dataPoint.data,dataPoint._changes);Object.keys(fieldInfo).forEach(fieldName=>{const fieldType=dataPoint.fields[fieldName].type;if(fieldType==='one2many'||fieldType==='many2many'){const mode=fieldInfo[fieldName].mode;const views=fieldInfo[fieldName].views;const x2mDataPointID=values[fieldName];if(views[mode]&&x2mDataPointID){proms.push(this.addFieldsInfo(x2mDataPointID,{fields:views[mode].fields,fieldInfo:views[mode].fieldsInfo[mode],viewType:mode,}));}}});return Promise.all(proms);});}},applyDefaultValues:function(recordID,values,options){options=options||{};var record=this.localData[recordID];var viewType=options.viewType||record.viewType;var fieldNames=options.fieldNames||Object.keys(record.fieldsInfo[viewType]);var field;var fieldName;record._changes=record._changes||{};values=_.pick(values,fieldNames);for(var i=0;i<fieldNames.length;i++){fieldName=fieldNames[i];if(!(fieldName in values)&&!(fieldName in record._changes)){field=record.fields[fieldName];if(field.type==='float'||field.type==='integer'||field.type==='monetary'){values[fieldName]=0;}else if(field.type==='one2many'||field.type==='many2many'){values[fieldName]=[];}else{values[fieldName]=null;}}}
var defs=[];for(fieldName in values){field=record.fields[fieldName];record.data[fieldName]=null;var dp;if(field.type==='many2one'&&values[fieldName]){dp=this._makeDataPoint({context:record.context,data:{id:values[fieldName]},modelName:field.relation,parentID:record.id,});record._changes[fieldName]=dp.id;}else if(field.type==='reference'&&values[fieldName]){var ref=values[fieldName].split(',');dp=this._makeDataPoint({context:record.context,data:{id:parseInt(ref[1])},modelName:ref[0],parentID:record.id,});defs.push(this._fetchNameGet(dp));record._changes[fieldName]=dp.id;}else if(field.type==='one2many'||field.type==='many2many'){defs.push(this._processX2ManyCommands(record,fieldName,values[fieldName],options));}else{record._changes[fieldName]=this._parseServerValue(field,values[fieldName]);}}
return Promise.all(defs);},applyRawChanges:function(recordID,viewType){var record=this.localData[recordID];return this._applyOnChange(record._rawChanges,record,viewType).then(function(){return record.id;});},canBeAbandoned:function(id){if(this.localData[id]._noAbandon){return false;}
var record=this.localData[id];var parent=this.localData[record.parentID];if(parent){var entry=_.findWhere(parent._savePoint,{operation:'ADD',id:id});if(entry){if(!entry.isNew){return false;}
var lastEntry=_.last(parent._savePoint);if(lastEntry.operation==='UPDATE'&&lastEntry.id===id){return false;}}}
return this.isNew(id);},deleteRecords:function(recordIds,modelName){var self=this;var records=_.map(recordIds,function(id){return self.localData[id];});var context=_.extend(records[0].getContext(),session.user_context);return this._rpc({model:modelName,method:'unlink',args:[_.pluck(records,'res_id')],context:context,}).then(function(){_.each(records,function(record){var parent=record.parentID&&self.localData[record.parentID];if(parent&&parent.type==='list'){parent.data=_.without(parent.data,record.id);delete self.localData[record.id];if(!parent.data.length&&parent.offset>0){parent.offset=Math.max(parent.offset-parent.limit,0);}}else{record.res_ids.splice(record.offset,1);record.offset=Math.min(record.offset,record.res_ids.length-1);record.res_id=record.res_ids[record.offset];record.count--;}});self._invalidateCache(records[0]);});},discardChanges:function(id,options){options=options||{};var element=this.localData[id];var isNew=this.isNew(id);var rollback='rollback'in options?options.rollback:isNew;var initialOffset=element.offset;element._domains={};this._visitChildren(element,function(elem){if(rollback&&elem._savePoint){if(elem._savePoint instanceof Array){elem._changes=elem._savePoint.slice(0);}else{elem._changes=_.extend({},elem._savePoint);}
elem._isDirty=!isNew;}else{elem._changes=null;elem._isDirty=false;}
elem.offset=0;if(elem.tempLimitIncrement){elem.limit-=elem.tempLimitIncrement;delete elem.tempLimitIncrement;}});element.offset=initialOffset;},duplicateRecord:function(recordID){var self=this;var record=this.localData[recordID];var context=this._getContext(record);return this._rpc({model:record.model,method:'copy',args:[record.data.id],context:context,}).then(function(res_id){var index=record.res_ids.indexOf(record.res_id);record.res_ids.splice(index+1,0,res_id);return self.load({fieldsInfo:record.fieldsInfo,fields:record.fields,modelName:record.model,res_id:res_id,res_ids:record.res_ids.slice(0),viewType:record.viewType,context:context,});});},freezeOrder:function(listID){var list=this.localData[listID];if(list.type==='record'){return;}
list=this._applyX2ManyOperations(list);this._sortList(list);this.localData[listID].orderedResIDs=list.res_ids;},get:function(id,options){var self=this;options=options||{};if(!(id in this.localData)){return null;}
var element=this.localData[id];if(options.env){var env={ids:element.res_ids?element.res_ids.slice(0):[],};if(element.type==='record'){env.currentId=this.isNew(element.id)?undefined:element.res_id;}
return env;}
if(element.type==='record'){var data=_.extend({},element.data,element._changes);var relDataPoint;for(var fieldName in data){var field=element.fields[fieldName];if(data[fieldName]===null){data[fieldName]=false;}
if(!field){continue;}
if(field.type==='many2one'){if(options.raw){relDataPoint=this.localData[data[fieldName]];data[fieldName]=relDataPoint?relDataPoint.res_id:false;}else{data[fieldName]=this.get(data[fieldName])||false;}}else if(field.type==='reference'){if(options.raw){relDataPoint=this.localData[data[fieldName]];data[fieldName]=relDataPoint?relDataPoint.model+','+relDataPoint.res_id:false;}else{data[fieldName]=this.get(data[fieldName])||false;}}else if(field.type==='one2many'||field.type==='many2many'){if(options.raw){if(typeof data[fieldName]==='string'){relDataPoint=this.localData[data[fieldName]];relDataPoint=this._applyX2ManyOperations(relDataPoint);data[fieldName]=relDataPoint.res_ids;}else{data[fieldName]=data[fieldName]||[];}}else{data[fieldName]=this.get(data[fieldName])||[];}}}
var record={context:_.extend({},element.context),count:element.count,data:data,domain:element.domain.slice(0),evalModifiers:element.evalModifiers,fields:element.fields,fieldsInfo:element.fieldsInfo,getContext:element.getContext,getDomain:element.getDomain,getFieldNames:element.getFieldNames,id:element.id,isDirty:element.isDirty,limit:element.limit,model:element.model,offset:element.offset,ref:element.ref,res_ids:element.res_ids.slice(0),specialData:_.extend({},element.specialData),type:'record',viewType:element.viewType,};if(!this.isNew(element.id)){record.res_id=element.res_id;}
var evalContext;Object.defineProperty(record,'evalContext',{get:function(){evalContext=evalContext||self._getEvalContext(element);return evalContext;},});return record;}
element=this._applyX2ManyOperations(element);this._sortList(element);if(!element.orderedResIDs&&element._changes){_.each(element._changes,function(change){if(change.operation==='ADD'&&change.isNew){element.data=_.without(element.data,change.id);if(change.position==='top'){element.data.unshift(change.id);}else{element.data.push(change.id);}}});}
var list={aggregateValues:_.extend({},element.aggregateValues),context:_.extend({},element.context),count:element.count,data:_.map(element.data,function(elemID){return self.get(elemID,options);}),domain:element.domain.slice(0),fields:element.fields,getContext:element.getContext,getDomain:element.getDomain,getFieldNames:element.getFieldNames,groupedBy:element.groupedBy,groupsCount:element.groupsCount,groupsLimit:element.groupsLimit,groupsOffset:element.groupsOffset,id:element.id,isDirty:element.isDirty,isOpen:element.isOpen,limit:element.limit,model:element.model,offset:element.offset,orderedBy:element.orderedBy,res_id:element.res_id,res_ids:element.res_ids.slice(0),type:'list',value:element.value,viewType:element.viewType,};if(element.fieldsInfo){list.fieldsInfo=element.fieldsInfo;}
return list;},getName:function(id){var record=this.localData[id];var returnValue='';if(record._changes&&'display_name'in record._changes){returnValue=record._changes.display_name;}
else if('display_name'in record.data){returnValue=record.data.display_name;}
return returnValue||_t("New");},isDirty:function(id){var isDirty=false;this._visitChildren(this.localData[id],function(r){if(r._isDirty){isDirty=true;}});return isDirty;},isNew:function(id){var data=this.localData[id];if(data.type!=="record"){return false;}
var res_id=data.res_id;if(typeof res_id==='number'){return false;}else if(typeof res_id==='string'&&/^[0-9]+-/.test(res_id)){return false;}
return true;},load:function(params){params.type=params.type||(params.res_id!==undefined?'record':'list');params.viewType=params.viewType||'default';if(!params.fieldsInfo){var fieldsInfo={};for(var fieldName in params.fieldNames){fieldsInfo[params.fieldNames[fieldName]]={};}
params.fieldsInfo={};params.fieldsInfo[params.viewType]=fieldsInfo;}
if(params.type==='record'&&params.res_id===undefined){params.allowWarning=true;return this._makeDefaultRecord(params.modelName,params);}
var dataPoint=this._makeDataPoint(params);return this._load(dataPoint).then(function(){return dataPoint.id;});},makeRecord:function(model,fields,fieldInfo){var self=this;var defs=[];var record_fields={};_.each(fields,function(field){record_fields[field.name]=_.pick(field,'type','relation','domain','selection');});fieldInfo=fieldInfo||{};var fieldsInfo={};fieldsInfo.default={};_.each(fields,function(field){fieldsInfo.default[field.name]=fieldInfo[field.name]||{};});var record=this._makeDataPoint({modelName:model,fields:record_fields,fieldsInfo:fieldsInfo,viewType:'default',});_.each(fields,function(field){var dataPoint;record.data[field.name]=null;if(field.type==='many2one'){if(field.value){var id=_.isArray(field.value)?field.value[0]:field.value;var display_name=_.isArray(field.value)?field.value[1]:undefined;dataPoint=self._makeDataPoint({modelName:field.relation,data:{id:id,display_name:display_name,},parentID:record.id,});record.data[field.name]=dataPoint.id;if(display_name===undefined){defs.push(self._fetchNameGet(dataPoint));}}}else if(field.type==='reference'&&field.value){const ref=field.value.split(',');dataPoint=self._makeDataPoint({context:record.context,data:{id:parseInt(ref[1],10)},modelName:ref[0],parentID:record.id,});defs.push(self._fetchNameGet(dataPoint));record.data[field.name]=dataPoint.id;}else if(field.type==='one2many'||field.type==='many2many'){var relatedFieldsInfo={};relatedFieldsInfo.default={};_.each(field.fields,function(field){relatedFieldsInfo.default[field.name]={};});var dpParams={fieldsInfo:relatedFieldsInfo,modelName:field.relation,parentID:record.id,static:true,type:'list',viewType:'default',};var needLoad=false;if(field.value&&field.value.length){if(_.isObject(field.value[0])){dpParams.res_ids=_.pluck(field.value,'id');dataPoint=self._makeDataPoint(dpParams);_.each(field.value,function(data){var recordDP=self._makeDataPoint({data:data,modelName:field.relation,parentID:dataPoint.id,type:'record',});dataPoint.data.push(recordDP.id);dataPoint._cache[recordDP.res_id]=recordDP.id;});}else{dpParams.res_ids=field.value;dataPoint=self._makeDataPoint(dpParams);needLoad=true;}}else{dpParams.res_ids=[];dataPoint=self._makeDataPoint(dpParams);}
if(needLoad){defs.push(self._load(dataPoint));}
record.data[field.name]=dataPoint.id;}else if(field.value){record.data[field.name]=field.value;}});return Promise.all(defs).then(function(){return record.id;});},notifyChanges:function(record_id,changes,options){return this.mutex.exec(this._applyChange.bind(this,record_id,changes,options));},reload:function(id,options){return this.mutex.exec(this._reload.bind(this,id,options));},removeLine:function(elementID){var record=this.localData[elementID];var parent=this.localData[record.parentID];if(parent.static){parent._changes=_.filter(parent._changes,function(change){if(change.id===elementID&&change.operation==='ADD'&&parent.tempLimitIncrement){parent.tempLimitIncrement--;parent.limit--;}
return change.id!==elementID;});}else{parent.data=_.without(parent.data,elementID);parent.count--;}},resequence:function(modelName,resIDs,parentID,options){options=options||{};if((resIDs.length<=1)){return Promise.resolve(parentID);}
var self=this;var data=this.localData[parentID];var params={model:modelName,ids:resIDs,context:data.getContext(),};if(options.offset){params.offset=options.offset;}
if(options.field){params.field=options.field;}
return this._rpc({route:'/web/dataset/resequence',params:params,}).then(function(wasResequenced){if(!wasResequenced){return Promise.resolve();}
var field=params.field?params.field:'sequence';return self._rpc({model:modelName,method:'read',args:[resIDs,[field]],context:data.getContext(),}).then(function(records){if(data.data.length){var dataType=self.localData[data.data[0]].type;if(dataType==='record'){_.each(data.data,function(dataPoint){var recordData=self.localData[dataPoint].data;var inRecords=_.findWhere(records,{id:recordData.id});if(inRecords){recordData[field]=inRecords[field];}});data.data=_.sortBy(data.data,function(d){return self.localData[d].data[field];});}
if(dataType==='list'){data.data=_.sortBy(data.data,function(d){return _.indexOf(resIDs,self.localData[d].res_id)});}}
data.res_ids=[];_.each(data.data,function(d){var dataPoint=self.localData[d];if(dataPoint.type==='record'){data.res_ids.push(dataPoint.res_id);}else{data.res_ids=data.res_ids.concat(dataPoint.res_ids);}});self._updateParentResIDs(data);return parentID;})});},save:function(recordID,options){var self=this;return this.mutex.exec(function(){options=options||{};var record=self.localData[recordID];if(options.savePoint){self._visitChildren(record,function(rec){var newValue=rec._changes||rec.data;if(newValue instanceof Array){rec._savePoint=newValue.slice(0);}else{rec._savePoint=_.extend({},newValue);}});_.each((record._changes||{}),function(value,fieldName){record._editionViewType[fieldName]=options.viewType;});}
var shouldReload='reload'in options?options.reload:true;var method=self.isNew(recordID)?'create':'write';if(record._changes){delete record._changes.id;}
var changes=self._generateChanges(record,{viewType:options.viewType,changesOnly:method!=='create'});delete changes.id;if(method==='create'){var fieldNames=record.getFieldNames();_.each(fieldNames,function(name){if(changes[name]===null){delete changes[name];}});}
var prom=new Promise(function(resolve,reject){var changedFields=Object.keys(changes);if(options.savePoint){resolve(changedFields);return;}
if(method==='create'||changedFields.length){var args=method==='write'?[[record.data.id],changes]:[changes];self._rpc({model:record.model,method:method,args:args,context:record.getContext(),}).then(function(id){if(method==='create'){record.res_id=id;record.data.id=id;record.offset=record.res_ids.length;record.res_ids.push(id);record.count++;}
var _changes=record._changes;record._changes={};self._invalidateCache(record);self.unfreezeOrder(record.id);if(shouldReload){self._fetchRecord(record).then(function(){resolve(changedFields);});}else{_.extend(record.data,_changes);resolve(changedFields);}}).guardedCatch(reject);}else{resolve(changedFields);}});prom.then(function(){record._isDirty=false;});return prom;});},setDirty:function(id){this.localData[id]._isDirty=true;},setSort:function(list_id,fieldName){var list=this.localData[list_id];if(list.type==='record'){return;}else if(list._changes){_.each(list._changes,function(change){delete change.isNew;});}
if(list.orderedBy.length===0){list.orderedBy.push({name:fieldName,asc:true});}else if(list.orderedBy[0].name===fieldName){if(!list.orderedResIDs){list.orderedBy[0].asc=!list.orderedBy[0].asc;}}else{var orderedBy=_.reject(list.orderedBy,function(o){return o.name===fieldName;});list.orderedBy=[{name:fieldName,asc:true}].concat(orderedBy);}
list.orderedResIDs=null;if(list.static){return this._fetchUngroupedList(list);}
return Promise.resolve();},toggleActive:function(recordIDs,parentID){var self=this;var parent=this.localData[parentID];var resIDs=_.map(recordIDs,function(recordID){return self.localData[recordID].res_id;});return this._rpc({model:parent.model,method:'toggle_active',args:[resIDs],}).then(function(action){self._invalidateCache(parent);if(!_.isEmpty(action)){return self.do_action(action,{on_close:function(){return self.trigger_up('reload');}});}else{return self.reload(parentID);}});},actionArchive:function(recordIDs,parentID){var self=this;var parent=this.localData[parentID];var resIDs=_.map(recordIDs,function(recordID){return self.localData[recordID].res_id;});return this._rpc({model:parent.model,method:'action_archive',args:[resIDs],}).then(function(action){self._invalidateCache(parent);if(!_.isEmpty(action)){return new Promise(function(resolve,reject){self.do_action(action,{on_close:function(result){return self.trigger_up('reload',{onSuccess:resolve,});}});});}else{return self.reload(parentID);}}).then(function(datapoint){if(parent&&parent.type==='list'&&!parent.data.length&&parent.offset>0){parent.offset=Math.max(parent.offset-parent.limit,0);return self.reload(parentID);}
return datapoint;});},actionUnarchive:function(recordIDs,parentID){var self=this;var parent=this.localData[parentID];var resIDs=_.map(recordIDs,function(recordID){return self.localData[recordID].res_id;});return this._rpc({model:parent.model,method:'action_unarchive',args:[resIDs],}).then(function(action){self._invalidateCache(parent);if(!_.isEmpty(action)){return new Promise(function(resolve,reject){self.do_action(action,{on_close:function(){return self.trigger_up('reload',{onSuccess:resolve,});}});});}else{return self.reload(parentID);}}).then(function(datapoint){if(parent&&parent.type==='list'&&!parent.data.length&&parent.offset>0){parent.offset=Math.max(parent.offset-parent.limit,0);return self.reload(parentID);}
return datapoint;});},toggleGroup:function(groupId){var self=this;var group=this.localData[groupId];if(group.isOpen){group.isOpen=false;group.data=[];group.res_ids=[];group.offset=0;this._updateParentResIDs(group);return Promise.resolve(groupId);}
if(!group.isOpen){group.isOpen=true;var def;if(group.count>0){def=this._load(group).then(function(){self._updateParentResIDs(group);});}
return Promise.resolve(def).then(function(){return groupId;});}},unfreezeOrder:function(elementID){var list=this.localData[elementID];if(list.type==='record'){var data=_.extend({},list.data,list._changes);for(var fieldName in data){var field=list.fields[fieldName];if(!field||!data[fieldName]){continue;}
if(field.type==='one2many'||field.type==='many2many'){var recordlist=this.localData[data[fieldName]];recordlist.orderedResIDs=null;for(var index in recordlist.data){this.unfreezeOrder(recordlist.data[index]);}}}
return;}
list.orderedResIDs=null;this._sortList(list);},_addX2ManyDefaultRecord:function(list,options){var self=this;var position=options&&options.position||'top';var params={fields:list.fields,fieldsInfo:list.fieldsInfo,parentID:list.id,position:position,viewType:options.viewType||list.viewType,allowWarning:options&&options.allowWarning};var additionalContexts=options&&options.context;var makeDefaultRecords=[];if(additionalContexts){_.each(additionalContexts,function(context){params.context=self._getContext(list,{additionalContext:context,sanitize_default_values:true});makeDefaultRecords.push(self._makeDefaultRecord(list.model,params));});}else{params.context=self._getContext(list,{sanitize_default_values:true});makeDefaultRecords.push(self._makeDefaultRecord(list.model,params));}
return Promise.all(makeDefaultRecords).then(function(resultIds){var ids=[];_.each(resultIds,function(id){ids.push(id);list._changes.push({operation:'ADD',id:id,position:position,isNew:true});var record=self.localData[id];list._cache[record.res_id]=id;if(list.orderedResIDs){var index=list.offset+(position!=='top'?list.limit:0);list.orderedResIDs.splice(index,0,record.res_id);self.localData[list.id].orderedResIDs=list.orderedResIDs;}});return ids;});},_applyChange:function(recordID,changes,options){var self=this;var record=this.localData[recordID];var field;var defs=[];options=options||{};record._changes=record._changes||{};if(!options.doNotSetDirty){record._isDirty=true;}
var initialData={};this._visitChildren(record,function(elem){initialData[elem.id]=$.extend(true,{},_.pick(elem,'data','_changes'));});for(var fieldName in changes){field=record.fields[fieldName];if(field&&(field.type==='one2many'||field.type==='many2many')){defs.push(this._applyX2ManyChange(record,fieldName,changes[fieldName],options));}else if(field&&(field.type==='many2one'||field.type==='reference')){defs.push(this._applyX2OneChange(record,fieldName,changes[fieldName]));}else{record._changes[fieldName]=changes[fieldName];}}
if(options.notifyChange===false){return Promise.all(defs).then(function(){return Promise.resolve(_.keys(changes));});}
return Promise.all(defs).then(function(){var onChangeFields=[];for(var fieldName in changes){field=record.fields[fieldName];if(field&&field.onChange){var isX2Many=field.type==='one2many'||field.type==='many2many';if(!isX2Many||(self._isX2ManyValid(record._changes[fieldName]||record.data[fieldName]))){onChangeFields.push(fieldName);}}}
return new Promise(function(resolve,reject){if(onChangeFields.length){self._performOnChange(record,onChangeFields,options.viewType).then(function(result){delete record._warning;resolve(_.keys(changes).concat(Object.keys(result&&result.value||{})));}).guardedCatch(function(){self._visitChildren(record,function(elem){_.extend(elem,initialData[elem.id]);});if(!options.force_fail){resolve({});}else{reject({});}});}else{resolve(_.keys(changes));}}).then(function(fieldNames){return self._fetchSpecialData(record).then(function(fieldNames2){return _.union(fieldNames,fieldNames2);});});});},_applyX2OneChange:function(record,fieldName,data){var self=this;if(!data||!data.id){record._changes[fieldName]=false;return Promise.resolve();}
var relatedID;if(record._changes&&fieldName in record._changes){relatedID=record._changes[fieldName];}else{relatedID=record.data[fieldName];}
var relatedRecord=this.localData[relatedID];if(relatedRecord&&(data.id===this.localData[relatedID].res_id)){return Promise.resolve();}
var rel_data=_.pick(data,'id','display_name');var field=record.fields[fieldName];var coModel=field.type==='reference'?data.model:field.relation;var def;if(rel_data.display_name===undefined){def=this._rpc({model:coModel,method:'name_get',args:[data.id],context:record.context,}).then(function(result){rel_data.display_name=result[0][1];});}
return Promise.resolve(def).then(function(){var rec=self._makeDataPoint({context:record.context,data:rel_data,fields:{},fieldsInfo:{},modelName:coModel,parentID:record.id,});record._changes[fieldName]=rec.id;});},_applyOnChange:function(values,record,viewType){var self=this;var defs=[];var rec;viewType=viewType||record.viewType;record._changes=record._changes||{};_.each(values,function(val,name){var field=record.fields[name];if(!field){record._rawChanges[name]=val;return;}
if(record._rawChanges[name]){delete record._rawChanges[name];}
var oldValue=name in record._changes?record._changes[name]:record.data[name];var id;if(field.type==='many2one'){id=false;if(val){var data=_.isArray(val)?{id:val[0],display_name:val[1]}:{id:val};if(!oldValue||(self.localData[oldValue].res_id!==data.id)){rec=self._makeDataPoint({context:record.context,data:data,modelName:field.relation,parentID:record.id,});id=rec.id;record._changes[name]=id;}}else{record._changes[name]=false;}}else if(field.type==='reference'){id=false;if(val){var ref=val.split(',');var modelName=ref[0];var resID=parseInt(ref[1]);if(!oldValue||self.localData[oldValue].res_id!==resID||self.localData[oldValue].model!==modelName){rec=self._makeDataPoint({context:record.context,data:{id:parseInt(ref[1])},modelName:modelName,parentID:record.id,});defs.push(self._fetchNameGet(rec));id=rec.id;record._changes[name]=id;}}else{record._changes[name]=id;}}else if(field.type==='one2many'||field.type==='many2many'){var listId=record._changes[name]||record.data[name];var list;if(listId){list=self.localData[listId];}else{var fieldInfo=record.fieldsInfo[viewType][name];if(!fieldInfo){return;}
var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];list=self._makeDataPoint({fields:view?view.fields:fieldInfo.relatedFields,fieldsInfo:view?view.fieldsInfo:fieldInfo.fieldsInfo,limit:fieldInfo.limit,modelName:field.relation,parentID:record.id,static:true,type:'list',viewType:view?view.type:fieldInfo.viewType,});}
record._changes[name]=list.id;list._changes=list._changes||[];var oldChanges=list._changes;_.each(val,function(command){var rec,recID;if(command[0]===0||command[0]===1){if(command[0]===0&&command[1]){var previousChange=_.find(oldChanges,function(operation){var child=self.localData[operation.id];return child&&(child.ref===command[1]);});recID=previousChange&&previousChange.id;rec=self.localData[recID];}
if(command[0]===1&&command[1]){rec=self.localData[list._cache[command[1]]];}
if(!rec){var params={context:list.context,fields:list.fields,fieldsInfo:list.fieldsInfo,modelName:list.model,parentID:list.id,viewType:list.viewType,ref:command[1],};if(command[0]===1){params.res_id=command[1];}
rec=self._makeDataPoint(params);list._cache[rec.res_id]=rec.id;}
rec._noAbandon=!list._savePoint;list._changes.push({operation:'ADD',id:rec.id});if(command[0]===1){list._changes.push({operation:'UPDATE',id:rec.id});}
defs.push(self._applyOnChange(command[2],rec));}else if(command[0]===4){linkRecord(list,command[1]);}else if(command[0]===5){list._changes=[{operation:'REMOVE_ALL'}];}else if(command[0]===6){list._changes=[{operation:'REMOVE_ALL'}];_.each(command[2],function(resID){linkRecord(list,resID);});}});var def=self._readUngroupedList(list).then(function(){var x2ManysDef=self._fetchX2ManysBatched(list);var referencesDef=self._fetchReferencesBatched(list);return Promise.all([x2ManysDef,referencesDef]);});defs.push(def);}else{var newValue=self._parseServerValue(field,val);if(newValue!==oldValue){record._changes[name]=newValue;}}});return Promise.all(defs);function linkRecord(list,resID){rec=self.localData[list._cache[resID]];if(rec){self.discardChanges(rec.id);}
list._changes.push({operation:'ADD',id:rec?rec.id:null,resID:resID,});}},_applyX2ManyChange:function(record,fieldName,command,options){if(command.operation==='TRIGGER_ONCHANGE'){return Promise.resolve();}
var self=this;var localID=(record._changes&&record._changes[fieldName])||record.data[fieldName];var list=this.localData[localID];var field=record.fields[fieldName];var viewType=(options&&options.viewType)||record.viewType;var fieldInfo=record.fieldsInfo[viewType][fieldName];var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];var def,rec;var defs=[];list._changes=list._changes||[];switch(command.operation){case'ADD':var newRecord=this.localData[command.id];_.defaults(list.fields,newRecord.fields);_.defaults(list.fieldsInfo,newRecord.fieldsInfo);newRecord.fields=list.fields;newRecord.fieldsInfo=list.fieldsInfo;newRecord.viewType=list.viewType;list._cache[newRecord.res_id]=newRecord.id;list._changes.push(command);break;case'ADD_M2M':list._forceM2MLink=true;var data=_.isArray(command.ids)?command.ids:[command.ids];if(data.length+list.res_ids.length>list.limit){list.limit=data.length+list.res_ids.length;}
var list_records={};_.each(data,function(d){rec=self._makeDataPoint({context:record.context,modelName:field.relation,fields:view?view.fields:fieldInfo.relatedFields,fieldsInfo:view?view.fieldsInfo:fieldInfo.fieldsInfo,res_id:d.id,data:d,viewType:view?view.type:fieldInfo.viewType,parentID:list.id,});list_records[d.id]=rec;list._cache[rec.res_id]=rec.id;list._changes.push({operation:'ADD',id:rec.id});});var fieldNames=list.getFieldNames();if(fieldNames.length){def=this._rpc({model:list.model,method:'read',args:[_.pluck(data,'id'),fieldNames],context:_.extend({},record.context,field.context),}).then(function(records){_.each(records,function(record){list_records[record.id].data=record;self._parseServerData(fieldNames,list,record);});return Promise.all([self._fetchX2ManysBatched(list),self._fetchReferencesBatched(list)]);});defs.push(def);}
break;case'CREATE':var createOptions=_.extend({context:command.context,position:command.position},options||{});createOptions.viewType=fieldInfo.mode;def=this._addX2ManyDefaultRecord(list,createOptions).then(function(ids){_.each(ids,function(id){if(command.position==='bottom'&&list.orderedResIDs&&list.orderedResIDs.length>=list.limit){list.tempLimitIncrement=(list.tempLimitIncrement||0)+1;list.limit+=1;}
if(command.data){return self._applyChange(id,command.data);}});});defs.push(def);break;case'UPDATE':list._changes.push({operation:'UPDATE',id:command.id});if(command.data){defs.push(this._applyChange(command.id,command.data,{viewType:view&&view.type,}));}
break;case'FORGET':list._forceM2MUnlink=true;case'DELETE':var idsToRemove=command.ids;list._changes=_.reject(list._changes,function(change,index){var idInCommands=_.contains(command.ids,change.id);if(idInCommands&&change.operation==='ADD'){idsToRemove=_.without(idsToRemove,change.id);}
return idInCommands;});_.each(idsToRemove,function(id){var operation=list._forceM2MUnlink?'FORGET':'DELETE';list._changes.push({operation:operation,id:id});});break;case'DELETE_ALL':list._changes=_.reject(list._changes,function(change){return change.operation==='ADD';});return this._applyX2ManyChange(record,fieldName,{operation:'DELETE',ids:list.res_ids},options);case'REPLACE_WITH':list._changes=[];var newIds=_.difference(command.ids,list.res_ids);var removedIds=_.difference(list.res_ids,command.ids);var addDef,removedDef,values;if(newIds.length){values=_.map(newIds,function(id){return{id:id};});addDef=this._applyX2ManyChange(record,fieldName,{operation:'ADD_M2M',ids:values},options);}
if(removedIds.length){var listData=_.map(list.data,function(localId){return self.localData[localId];});removedDef=this._applyX2ManyChange(record,fieldName,{operation:'DELETE',ids:_.map(removedIds,function(resID){if(resID in list._cache){return list._cache[resID];}
return _.findWhere(listData,{res_id:resID}).id;}),},options);}
return Promise.all([addDef,removedDef]);case'MULTI':_.each(command.commands,function(innerCommand){defs.push(self._applyX2ManyChange(record,fieldName,innerCommand,options));});break;}
return Promise.all(defs).then(function(){return self._readUngroupedList(list).then(function(){return self._fetchX2ManysBatched(list);});});},_applyX2ManyOperations:function(list,options){if(!list.static){return list;}
var self=this;list=_.extend({},list);list.res_ids=list.res_ids.slice(0);var changes=list._changes||[];if(options){var to=options.to===0?0:(options.to||changes.length);changes=changes.slice(options.from||0,to);}
_.each(changes,function(change){var relRecord;if(change.id){relRecord=self.localData[change.id];}
switch(change.operation){case'ADD':list.count++;var resID=relRecord?relRecord.res_id:change.resID;if(change.position==='top'&&(options?options.position!=='bottom':true)){list.res_ids.unshift(resID);}else{list.res_ids.push(resID);}
break;case'FORGET':case'DELETE':list.count--;var deletedResID=relRecord?relRecord.res_id:change.id;list.res_ids=_.without(list.res_ids,deletedResID);break;case'REMOVE_ALL':list.count=0;list.res_ids=[];break;case'UPDATE':break;}});this._setDataInRange(list);return list;},_buildOnchangeSpecs:function(record,viewType){var hasOnchange=false;var specs={};var fieldsInfo=record.fieldsInfo[viewType||record.viewType];generateSpecs(fieldsInfo,record.fields);function generateSpecs(fieldsInfo,fields,prefix){prefix=prefix||'';_.each(Object.keys(fieldsInfo),function(name){var field=fields[name];var fieldInfo=fieldsInfo[name];var key=prefix+name;specs[key]=(field.onChange)||"";if(field.onChange){hasOnchange=true;}
if(field.type==='one2many'||field.type==='many2many'){_.each(fieldInfo.views,function(view){generateSpecs(view.fieldsInfo[view.type],view.fields,key+'.');});}});}
return hasOnchange?specs:false;},_computeOverrideDefaultFields:function(listID,position){var list=this.localData[listID];var handleField;if(!list){return{};}
position=position||'bottom';if(!list.fieldsInfo){return{};}
for(var field in list.fieldsInfo.list){if(list.fieldsInfo.list[field].widget==='handle'){handleField=field;break;}}
if(!handleField){return{};}
var isOrderedByHandle=list.orderedBy&&list.orderedBy.length&&list.orderedBy[0].asc===true&&list.orderedBy[0].name===handleField;if(!isOrderedByHandle){return{};}
var computedList=this.get(list.id,{raw:true});if(!computedList||!computedList.data||!computedList.data.length){return{};}
var index=Math.min(computedList.data.length-1,position!=='top'?list.limit-1:0);var handleFieldValue=computedList.data[index].data[handleField];if(position==='top'){handleFieldValue--;}else if(list.count<=list.offset+list.limit-(list.tempLimitIncrement||0)){handleFieldValue++;}
return{field:handleField,value:handleFieldValue,};},_evalModifiers:function(element,modifiers){var result={};var self=this;var evalContext;function evalModifier(mod){if(mod===undefined||mod===false||mod===true){return!!mod;}
evalContext=evalContext||self._getEvalContext(element);return new Domain(mod,evalContext).compute(evalContext);}
if('invisible'in modifiers){result.invisible=evalModifier(modifiers.invisible);}
if('column_invisible'in modifiers){result.column_invisible=evalModifier(modifiers.column_invisible);}
if('readonly'in modifiers){result.readonly=evalModifier(modifiers.readonly);}
if('required'in modifiers){result.required=evalModifier(modifiers.required);}
return result;},_fetchMany2OneGroup:function(groups){var ids=_.uniq(_.pluck(_.pluck(groups,'record'),'res_id'));return this._rpc({model:groups[0].record.model,method:'name_get',args:[ids],context:groups[0].context}).then(function(name_gets){_.each(groups,function(obj){var nameGet=_.find(name_gets,function(n){return n[0]===obj.record.res_id;});obj.record.data.display_name=nameGet[1];});});},_fetchNameGet:function(dataPoint){return this._rpc({model:dataPoint.model,method:'name_get',args:[dataPoint.res_id],context:dataPoint.getContext(),}).then(function(result){dataPoint.data.display_name=result[0][1];});},_fetchNameGets:function(list,fieldName){var self=this;var model=list.fields[fieldName].relation;var records=[];var ids=[];list=this._applyX2ManyOperations(list);_.each(list.data,function(localId){var record=self.localData[localId];var data=record._changes||record.data;var many2oneId=data[fieldName];if(!many2oneId){return;}
var many2oneRecord=self.localData[many2oneId];records.push(many2oneRecord);ids.push(many2oneRecord.res_id);model=many2oneRecord.model;});if(!ids.length){return Promise.resolve();}
return this._rpc({model:model,method:'name_get',args:[_.uniq(ids)],context:list.context,}).then(function(name_gets){_.each(records,function(record){var nameGet=_.find(name_gets,function(nameGet){return nameGet[0]===record.data.id;});record.data.display_name=nameGet[1];});});},_fetchRecord:function(record,options){var self=this;options=options||{};var fieldNames=options.fieldNames||record.getFieldNames(options);fieldNames=_.uniq(fieldNames.concat(['display_name']));return this._rpc({model:record.model,method:'read',args:[[record.res_id],fieldNames],context:_.extend({bin_size:true},record.getContext()),}).then(function(result){if(result.length===0){return Promise.reject();}
result=result[0];record.data=_.extend({},record.data,result);}).then(function(){self._parseServerData(fieldNames,record,record.data);}).then(function(){return Promise.all([self._fetchX2Manys(record,options),self._fetchReferences(record,options)]).then(function(){return self._postprocess(record,options);});});},_fetchReference:function(record,fieldName){var self=this;var def;var value=record._changes&&record._changes[fieldName]||record.data[fieldName];var model=value&&value.split(',')[0];var resID=value&&parseInt(value.split(',')[1]);if(model&&model!=='False'&&resID){def=self._rpc({model:model,method:'name_get',args:[resID],context:record.getContext({fieldName:fieldName}),}).then(function(result){return self._makeDataPoint({data:{id:result[0][0],display_name:result[0][1],},modelName:model,parentID:record.id,});});}
return Promise.resolve(def);},_fetchReferenceData:function(datapoints,model,fieldName){var self=this;var ids=_.map(Object.keys(datapoints),function(id){return parseInt(id);});var parent=datapoints[ids[0]][0];var def=self._rpc({model:model,method:'name_get',args:[ids],context:self.localData[parent].getContext({fieldName:fieldName}),}).then(function(result){_.each(result,function(el){var parentIDs=datapoints[el[0]];_.each(parentIDs,function(parentID){var parent=self.localData[parentID];var referenceDp=self._makeDataPoint({data:{id:el[0],display_name:el[1],},modelName:model,parentID:parent.id,});parent.data[fieldName]=referenceDp.id;});});});return def;},_fetchReferences:function(record,options){var self=this;var defs=[];var fieldNames=options&&options.fieldNames||record.getFieldNames();_.each(fieldNames,function(fieldName){var field=record.fields[fieldName];if(field.type==='reference'){var def=self._fetchReference(record,fieldName).then(function(dataPoint){if(dataPoint){record.data[fieldName]=dataPoint.id;}});defs.push(def);}});return Promise.all(defs);},_fetchReferenceBatched:function(list,fieldName){var self=this;list=this._applyX2ManyOperations(list);this._sortList(list);var toFetch=this._getDataToFetchByModel(list,fieldName);var defs=[];_.each(toFetch,function(datapoints,model){defs.push(self._fetchReferenceData(datapoints,model,fieldName));});return Promise.all(defs);},_fetchReferencesBatched:function(list){var defs=[];var fieldNames=list.getFieldNames();for(var i=0;i<fieldNames.length;i++){var field=list.fields[fieldNames[i]];if(field.type==='reference'){defs.push(this._fetchReferenceBatched(list,fieldNames[i]));}}
return Promise.all(defs);},_fetchReferenceSingleBatch:function(list,fieldName){var self=this;var toFetch={};_.each(list.data,function(groupIndex){var group=self.localData[groupIndex];self._getDataToFetchByModel(group,fieldName,toFetch);});var defs=[];_.each(toFetch,function(datapoints,model){defs.push(self._fetchReferenceData(datapoints,model,fieldName));});return Promise.all(defs);},_fetchReferencesSingleBatch:function(list){var defs=[];var fieldNames=list.getFieldNames();for(var fIndex in fieldNames){var field=list.fields[fieldNames[fIndex]];if(field.type==='reference'){defs.push(this._fetchReferenceSingleBatch(list,fieldNames[fIndex]));}}
return Promise.all(defs);},_fetchRelatedData:function(list,toFetch,fieldName){var self=this;var ids=_.keys(toFetch);for(var i=0;i<ids.length;i++){ids[i]=Number(ids[i]);}
var fieldInfo=list.fieldsInfo[list.viewType][fieldName];if(!ids.length||fieldInfo.__no_fetch){return Promise.resolve();}
var def;var fieldNames=_.keys(fieldInfo.relatedFields);if(fieldNames.length){var field=list.fields[fieldName];def=this._rpc({model:field.relation,method:'read',args:[ids,fieldNames],context:list.getContext()||{},});}else{def=Promise.resolve(_.map(ids,function(id){return{id:id};}));}
return def.then(function(result){var records=_.uniq(_.flatten(_.values(toFetch)));self._updateRecordsData(records,fieldName,result);});},_fetchRelationalData:function(record){var self=this;var toBeFetched=[];_.each(record.getFieldNames(),function(name){var field=record.fields[name];if(field.type==='many2one'&&!record.fieldsInfo[record.viewType][name].__no_fetch){var localId=(record._changes&&record._changes[name])||record.data[name];var relatedRecord=self.localData[localId];if(!relatedRecord||relatedRecord.data.display_name){return;}
toBeFetched.push({context:record.getContext({fieldName:name,viewType:record.viewType}),record:relatedRecord});}});var groups=_.groupBy(toBeFetched,function(elem){return[elem.record.model,JSON.stringify(elem.context)].join();});return Promise.all(_.map(groups,this._fetchMany2OneGroup.bind(this)));},_fetchSpecialData:function(record,options){var self=this;var specialFieldNames=[];var fieldNames=(options&&options.fieldNames)||record.getFieldNames();return Promise.all(_.map(fieldNames,function(name){var viewType=(options&&options.viewType)||record.viewType;var fieldInfo=record.fieldsInfo[viewType][name]||{};var Widget=fieldInfo.Widget;if(Widget&&Widget.prototype.specialData){return self[Widget.prototype.specialData](record,name,fieldInfo).then(function(data){if(data===undefined){return;}
record.specialData[name]=data;specialFieldNames.push(name);});}})).then(function(){return specialFieldNames;});},_fetchSpecialMany2ones:function(record,fieldName,fieldInfo,fieldsToRead){var field=record.fields[fieldName];if(field.type!=="many2one"){return Promise.resolve();}
var context=record.getContext({fieldName:fieldName});var domain=record.getDomain({fieldName:fieldName});if(domain.length){var localID=(record._changes&&fieldName in record._changes)?record._changes[fieldName]:record.data[fieldName];if(localID){var element=this.localData[localID];domain=["|",["id","=",element.data.id]].concat(domain);}}
var hasChanged=this._saveSpecialDataCache(record,fieldName,{context:context,domain:domain,});if(!hasChanged){return Promise.resolve();}
var self=this;return this._rpc({model:field.relation,method:'search_read',fields:["id"].concat(fieldsToRead||[]),context:context,domain:domain,}).then(function(records){var ids=_.pluck(records,'id');return self._rpc({model:field.relation,method:'name_get',args:[ids],context:context,}).then(function(name_gets){_.each(records,function(rec){var name_get=_.find(name_gets,function(n){return n[0]===rec.id;});rec.display_name=name_get[1];});return records;});});},_fetchSpecialRelation:function(record,fieldName){var field=record.fields[fieldName];if(!_.contains(["many2one","many2many","one2many"],field.type)){return Promise.resolve();}
var context=record.getContext({fieldName:fieldName});var domain=record.getDomain({fieldName:fieldName});var hasChanged=this._saveSpecialDataCache(record,fieldName,{context:context,domain:domain,});if(!hasChanged){return Promise.resolve();}
return this._rpc({model:field.relation,method:'name_search',args:["",domain],context:context});},_fetchSpecialReference:function(record,fieldName){var def;var field=record.fields[fieldName];if(field.type==='char'){def=this._fetchReference(record,fieldName);}
return Promise.resolve(def);},_fetchSpecialStatus:function(record,fieldName,fieldInfo){var foldField=fieldInfo.options.fold_field;var fieldsToRead=foldField?[foldField]:[];return this._fetchSpecialMany2ones(record,fieldName,fieldInfo,fieldsToRead).then(function(m2os){_.each(m2os,function(m2o){m2o.fold=foldField?m2o[foldField]:false;});return m2os;});},_fetchSpecialDomain:function(record,fieldName,fieldInfo){var self=this;var context=record.getContext({fieldName:fieldName});var domainModel=fieldInfo.options.model;if(record.data.hasOwnProperty(domainModel)){domainModel=record._changes&&record._changes[domainModel]||record.data[domainModel];}
var domainValue=record._changes&&record._changes[fieldName]||record.data[fieldName]||[];var hasChanged=this._saveSpecialDataCache(record,fieldName,{context:context,domainModel:domainModel,domainValue:domainValue,});if(!hasChanged){return Promise.resolve();}else if(!domainModel){return Promise.resolve({model:domainModel,nbRecords:0,});}
return new Promise(function(resolve){var evalContext=self._getEvalContext(record);self._rpc({model:domainModel,method:'search_count',args:[Domain.prototype.stringToArray(domainValue,evalContext)],context:context}).then(function(nbRecords){resolve({model:domainModel,nbRecords:nbRecords,});}).guardedCatch(function(reason){var e=reason.event;e.preventDefault();resolve({model:domainModel,nbRecords:0,});});});},_fetchUngroupedList:function(list,options){options=_.defaults(options||{},{enableRelationalFetch:true});var self=this;var def;if(list.static){def=this._readUngroupedList(list).then(function(){if(list.parentID&&self.isNew(list.parentID)){var many2ones=self._getMany2OneFieldNames(list);var defs=_.map(many2ones,function(name){return self._fetchNameGets(list,name);});return Promise.all(defs);}});}else{def=this._searchReadUngroupedList(list);}
return def.then(function(){if(options.enableRelationalFetch){return Promise.all([self._fetchX2ManysBatched(list),self._fetchReferencesBatched(list)]);}}).then(function(){return list;});},_fetchX2ManyBatched:function(list,fieldName){list=this._applyX2ManyOperations(list);this._sortList(list);var toFetch=this._getDataToFetch(list,fieldName);return this._fetchRelatedData(list,toFetch,fieldName);},_fetchX2Manys:function(record,options){var self=this;var defs=[];options=options||{};var fieldNames=options.fieldNames||record.getFieldNames(options);var viewType=options.viewType||record.viewType;_.each(fieldNames,function(fieldName){var field=record.fields[fieldName];if(field.type==='one2many'||field.type==='many2many'){var fieldInfo=record.fieldsInfo[viewType][fieldName];var rawContext=fieldInfo&&fieldInfo.context;var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];var fieldsInfo=view?view.fieldsInfo:(fieldInfo.fieldsInfo||{});var ids=record.data[fieldName]||[];var list=self._makeDataPoint({count:ids.length,context:_.extend({},record.context,field.context),fieldsInfo:fieldsInfo,fields:view?view.fields:fieldInfo.relatedFields,limit:fieldInfo.limit,modelName:field.relation,res_ids:ids,static:true,type:'list',orderedBy:fieldInfo.orderedBy,parentID:record.id,rawContext:rawContext,relationField:field.relation_field,viewType:view?view.type:fieldInfo.viewType,});record.data[fieldName]=list.id;if(!fieldInfo.__no_fetch){var def=self._readUngroupedList(list).then(function(){return Promise.all([self._fetchX2ManysBatched(list),self._fetchReferencesBatched(list)]);});defs.push(def);}}});return Promise.all(defs);},_fetchX2ManysBatched:function(list){var defs=[];var fieldNames=list.getFieldNames();for(var i=0;i<fieldNames.length;i++){var field=list.fields[fieldNames[i]];if(field.type==='many2many'||field.type==='one2many'){defs.push(this._fetchX2ManyBatched(list,fieldNames[i]));}}
return Promise.all(defs);},_fetchX2ManySingleBatch:function(list,fieldName){var self=this;var toFetch={};_.each(list.data,function(groupIndex){var group=self.localData[groupIndex];var nextDataToFetch=self._getDataToFetch(group,fieldName);_.each(_.keys(nextDataToFetch),function(id){if(toFetch[id]){toFetch[id]=toFetch[id].concat(nextDataToFetch[id]);}else{toFetch[id]=nextDataToFetch[id];}});});return self._fetchRelatedData(list,toFetch,fieldName);},_fetchX2ManysSingleBatch:function(list){var defs=[];var fieldNames=list.getFieldNames();for(var i=0;i<fieldNames.length;i++){var field=list.fields[fieldNames[i]];if(field.type==='many2many'||field.type==='one2many'){defs.push(this._fetchX2ManySingleBatch(list,fieldNames[i]));}}
return Promise.all(defs);},_generateChanges:function(record,options){options=options||{};var viewType=options.viewType||record.viewType;var changes;if('changesOnly'in options&&!options.changesOnly){changes=_.extend({},record.data,record._changes);}else{changes=_.extend({},record._changes);}
var withReadonly=options.withReadonly||false;var commands=this._generateX2ManyCommands(record,{changesOnly:'changesOnly'in options?options.changesOnly:true,withReadonly:withReadonly,});for(var fieldName in record.fields){if(!withReadonly&&fieldName in changes||fieldName in commands){var editionViewType=record._editionViewType[fieldName]||viewType;if(this._isFieldProtected(record,fieldName,editionViewType)){delete changes[fieldName];continue;}}
var type=record.fields[fieldName].type;var value;if(type==='one2many'||type==='many2many'){if(commands[fieldName]&&commands[fieldName].length){changes[fieldName]=commands[fieldName];}else{delete changes[fieldName];}}else if(type==='many2one'&&fieldName in changes){value=changes[fieldName];changes[fieldName]=value?this.localData[value].res_id:false;}else if(type==='reference'&&fieldName in changes){value=changes[fieldName];changes[fieldName]=value?this.localData[value].model+','+this.localData[value].res_id:false;}else if(type==='char'&&changes[fieldName]===''){changes[fieldName]=false;}else if(changes[fieldName]===null){changes[fieldName]=false;}}
return changes;},_generateOnChangeData:function(record,options){options=_.extend({},options||{},{withReadonly:true});var commands=this._generateX2ManyCommands(record,options);var data=_.extend(this.get(record.id,{raw:true}).data,commands);var hasDisplayName=_.some(record.fieldsInfo,function(fieldsInfo){return'display_name'in fieldsInfo;});if(!hasDisplayName){delete data.display_name;}
if(record.parentID){var parent=this.localData[record.parentID];if(parent.parentID&&parent.relationField){var parentRecord=this.localData[parent.parentID];data[parent.relationField]=this._generateOnChangeData(parentRecord);}}
return data;},_generateX2ManyCommands:function(record,options){var self=this;options=options||{};var fields=record.fields;if(options.fieldNames){fields=_.pick(fields,options.fieldNames);}
var commands={};var data=_.extend({},record.data,record._changes);var type;for(var fieldName in fields){type=fields[fieldName].type;if(type==='many2many'||type==='one2many'){if(!data[fieldName]){continue;}
commands[fieldName]=[];var list=this.localData[data[fieldName]];if(options.changesOnly&&(!list._changes||!list._changes.length)){continue;}
var oldResIDs=list.res_ids.slice(0);var relRecordAdded=[];var relRecordUpdated=[];_.each(list._changes,function(change){if(change.operation==='ADD'&&change.id){relRecordAdded.push(self.localData[change.id]);}else if(change.operation==='UPDATE'&&!self.isNew(change.id)){relRecordUpdated.push(self.localData[change.id]);}});list=this._applyX2ManyOperations(list);this._sortList(list);if(type==='many2many'||list._forceM2MLink){var relRecordCreated=_.filter(relRecordAdded,function(rec){return typeof rec.res_id==='string';});var realIDs=_.difference(list.res_ids,_.pluck(relRecordCreated,'res_id'));commands[fieldName].push(x2ManyCommands.replace_with(realIDs));_.each(relRecordCreated,function(relRecord){var changes=self._generateChanges(relRecord,options);commands[fieldName].push(x2ManyCommands.create(relRecord.ref,changes));});_.each(relRecordUpdated,function(relRecord){var changes=self._generateChanges(relRecord,options);if(!_.isEmpty(changes)){var command=x2ManyCommands.update(relRecord.res_id,changes);commands[fieldName].push(command);}});}else if(type==='one2many'){var removedIds=_.difference(oldResIDs,list.res_ids);var addedIds=_.difference(list.res_ids,oldResIDs);var keptIds=_.intersection(oldResIDs,list.res_ids);var didChange=false;var changes,command,relRecord;for(var i=0;i<list.res_ids.length;i++){if(_.contains(keptIds,list.res_ids[i])){relRecord=_.findWhere(relRecordUpdated,{res_id:list.res_ids[i]});changes=relRecord?this._generateChanges(relRecord,options):{};if(!_.isEmpty(changes)){command=x2ManyCommands.update(relRecord.res_id,changes);didChange=true;}else{command=x2ManyCommands.link_to(list.res_ids[i]);}
commands[fieldName].push(command);}else if(_.contains(addedIds,list.res_ids[i])){relRecord=_.findWhere(relRecordAdded,{res_id:list.res_ids[i]});if(!relRecord){commands[fieldName].push(x2ManyCommands.link_to(list.res_ids[i]));continue;}
changes=this._generateChanges(relRecord,_.extend({},options,{changesOnly:true}));if(!this.isNew(relRecord.id)){commands[fieldName].push(x2ManyCommands.link_to(relRecord.res_id));delete changes.id;if(!_.isEmpty(changes)){commands[fieldName].push(x2ManyCommands.update(relRecord.res_id,changes));}}else{const rawChangesEntries=Object.entries(relRecord._rawChanges);for(const[fieldName,value]of rawChangesEntries){const isMany2OneValue=Array.isArray(value)&&value.length===2&&Number.isInteger(value[0])&&typeof value[1]==='string';changes[fieldName]=isMany2OneValue?value[0]:value;}
commands[fieldName].push(x2ManyCommands.create(relRecord.ref,changes));}}}
if(options.changesOnly&&!didChange&&addedIds.length===0&&removedIds.length===0){commands[fieldName]=[];}
for(i=0;i<removedIds.length;i++){if(list._forceM2MUnlink){commands[fieldName].push(x2ManyCommands.forget(removedIds[i]));}else{commands[fieldName].push(x2ManyCommands.delete(removedIds[i]));}}}}}
return commands;},_getContext:function(element,options){options=options||{};var context=new Context(session.user_context);context.set_eval_context(this._getEvalContext(element));if(options.full||!(options.fieldName||options.additionalContext)){var context_to_add=options.sanitize_default_values?_.omit(element.context,function(val,key){return _.str.startsWith(key,'default_');}):element.context;context.add(context_to_add);}
if(options.fieldName){var viewType=options.viewType||element.viewType;var fieldInfo=element.fieldsInfo[viewType][options.fieldName];if(fieldInfo&&fieldInfo.context){context.add(fieldInfo.context);}else{var fieldParams=element.fields[options.fieldName];if(fieldParams.context){context.add(fieldParams.context);}}}
if(options.additionalContext){context.add(options.additionalContext);}
if(element.rawContext){var rawContext=new Context(element.rawContext);var evalContext=this._getEvalContext(this.localData[element.parentID]);evalContext.id=evalContext.id||false;rawContext.set_eval_context(evalContext);context.add(rawContext);}
return context.eval();},_getDataToFetch:function(list,fieldName){var self=this;var field=list.fields[fieldName];var fieldInfo=list.fieldsInfo[list.viewType][fieldName];var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];var fieldsInfo=view?view.fieldsInfo:fieldInfo.fieldsInfo;var fields=view?view.fields:fieldInfo.relatedFields;var viewType=view?view.type:fieldInfo.viewType;var toFetch={};let dataPointIds=list.data;for(let i=0;i<list.groupedBy.length;i++){dataPointIds=dataPointIds.reduce((acc,groupId)=>acc.concat(this.localData[groupId].data),[]);}
dataPointIds.forEach(function(dataPoint){var record=self.localData[dataPoint];if(typeof record.data[fieldName]==='string'){return;}
_.each(record.data[fieldName],function(id){toFetch[id]=toFetch[id]||[];toFetch[id].push(record);});var m2mList=self._makeDataPoint({fieldsInfo:fieldsInfo,fields:fields,modelName:field.relation,parentID:record.id,res_ids:record.data[fieldName],static:true,type:'list',viewType:viewType,});record.data[fieldName]=m2mList.id;});return toFetch;},_getDataToFetchByModel:function(list,fieldName,toFetchAcc){var self=this;var toFetch=toFetchAcc||{};_.each(list.data,function(dataPoint){var record=self.localData[dataPoint];var value=record.data[fieldName];if(value&&!self.localData[value]){var model=value.split(',')[0];var resID=value.split(',')[1];if(!(model in toFetch)){toFetch[model]={};}
if(toFetch[model][resID]){toFetch[model][resID].push(dataPoint);}else{toFetch[model][resID]=[dataPoint];}}});return toFetch;},_getDefaultContext:function(dataPoint){var defaultContext={};while(dataPoint.parentID){var parent=this.localData[dataPoint.parentID];var groupByField=parent.groupedBy[0].split(':')[0];var value=viewUtils.getGroupValue(dataPoint,groupByField);if(value){defaultContext['default_'+groupByField]=value;}
dataPoint=parent;}
return defaultContext;},_getDomain:function(element,options){if(options&&options.fieldName){if(element._domains[options.fieldName]){return Domain.prototype.stringToArray(element._domains[options.fieldName],this._getEvalContext(element,true));}
var viewType=options.viewType||element.viewType;var fieldInfo=element.fieldsInfo[viewType][options.fieldName];if(fieldInfo&&fieldInfo.domain){return Domain.prototype.stringToArray(fieldInfo.domain,this._getEvalContext(element,true));}
var fieldParams=element.fields[options.fieldName];if(fieldParams.domain){return Domain.prototype.stringToArray(fieldParams.domain,this._getEvalContext(element,true));}
return[];}
return Domain.prototype.stringToArray(element.domain,this._getEvalContext(element,true));},_getEvalContext:function(element,forDomain){var evalContext=element.type==='record'?this._getRecordEvalContext(element,forDomain):{};if(element.parentID){var parent=this.localData[element.parentID];if(parent.type==='list'&&parent.parentID){parent=this.localData[parent.parentID];}
if(parent.type==='record'){evalContext.parent=this._getRecordEvalContext(parent,forDomain);}}
if(session.user_context.allowed_company_ids){var current_company=session.user_context.allowed_company_ids[0];}else{var current_company=session.user_companies?session.user_companies.current_company[0]:false;}
return _.extend({active_id:evalContext.id||false,active_ids:evalContext.id?[evalContext.id]:[],active_model:element.model,current_date:moment().format('YYYY-MM-DD'),id:evalContext.id||false,current_company_id:current_company,},session.user_context,element.context,evalContext);},_getFieldNames:function(element,options){var fieldsInfo=element.fieldsInfo;var viewType=options&&options.viewType||element.viewType;return Object.keys(fieldsInfo&&fieldsInfo[viewType]||{});},_getMany2OneFieldNames:function(datapoint){var many2ones=[];_.each(datapoint.fields,function(field,name){if(field.type==='many2one'){many2ones.push(name);}});return many2ones;},_getRecordEvalContext:function(record,forDomain){var self=this;var relDataPoint;var context=_.extend({},record.data,record._changes);function _generateX2ManyCommands(fieldName){var commands=self._generateX2ManyCommands(record,{fieldNames:[fieldName]});return commands[fieldName];}
for(var fieldName in context){var field=record.fields[fieldName];if(context[fieldName]===null){context[fieldName]=false;}
if(!field||field.name==='id'){continue;}
if(field.type==='date'||field.type==='datetime'){if(context[fieldName]){context[fieldName]=JSON.parse(JSON.stringify(context[fieldName]));}
continue;}
if(field.type==='many2one'){relDataPoint=this.localData[context[fieldName]];context[fieldName]=relDataPoint?relDataPoint.res_id:false;continue;}
if(field.type==='one2many'||field.type==='many2many'){var ids;if(!context[fieldName]||_.isArray(context[fieldName])){ids=context[fieldName]?context[fieldName].slice(0):[];}else{relDataPoint=this._applyX2ManyOperations(this.localData[context[fieldName]]);ids=relDataPoint.res_ids.slice(0);}
if(!forDomain){ids.toJSON=_generateX2ManyCommands.bind(null,fieldName);}else if(field.type==='one2many'){ids=_.filter(ids,function(id){return typeof id!=='string';});}
context[fieldName]=ids;}}
return context;},_invalidateCache:function(dataPoint){while(dataPoint.parentID){dataPoint=this.localData[dataPoint.parentID];}
if(dataPoint.model==='res.currency'){session.reloadCurrencies();}
if(_.contains(this.noCacheModels,dataPoint.model)){core.bus.trigger('clear_cache');}},_isFieldProtected:function(record,fieldName,viewType){viewType=viewType||record.viewType;var fieldInfo=viewType&&record.fieldsInfo&&record.fieldsInfo[viewType][fieldName];if(fieldInfo){var rawModifiers=fieldInfo.modifiers||{};var modifiers=this._evalModifiers(record,_.pick(rawModifiers,'readonly'));return modifiers.readonly&&!fieldInfo.force_save;}else{return false;}},_isFieldSet:function(value,fieldType){switch(fieldType){case'boolean':return true;case'one2many':case'many2many':return value.length>0;default:return value!==false;}},_isX2ManyValid:function(id){var self=this;var isValid=true;var element=this.localData[id];_.each(element._changes,function(command){if(command.operation==='DELETE'||command.operation==='FORGET'||(command.operation==='ADD'&&!command.isNew)||command.operation==='REMOVE_ALL'){return;}
var recordData=self.get(command.id,{raw:true}).data;var record=self.localData[command.id];_.each(element.getFieldNames(),function(fieldName){var field=element.fields[fieldName];var fieldInfo=element.fieldsInfo[element.viewType][fieldName];var rawModifiers=fieldInfo.modifiers||{};var modifiers=self._evalModifiers(record,_.pick(rawModifiers,'required'));if(modifiers.required&&!self._isFieldSet(recordData[fieldName],field.type)){isValid=false;}});});return isValid;},_load:function(dataPoint,options){if(options&&options.onlyGroups&&!(dataPoint.type==='list'&&dataPoint.groupedBy.length)){return Promise.resolve(dataPoint);}
if(dataPoint.type==='record'){return this._fetchRecord(dataPoint,options);}
if(dataPoint.type==='list'&&dataPoint.groupedBy.length){return this._readGroup(dataPoint,options);}
if(dataPoint.type==='list'&&!dataPoint.groupedBy.length){return this._fetchUngroupedList(dataPoint,options);}},_makeDataPoint:function(params){var type=params.type||('domain'in params&&'list')||'record';var res_id,value;var res_ids=params.res_ids||[];var data=params.data||(type==='record'?{}:[]);var context=params.context;if(type==='record'){res_id=params.res_id||(params.data&&params.data.id);if(res_id){data.id=res_id;}else{res_id=_.uniqueId('virtual_');}
context=_.omit(context,['orderedBy','group_by']);}else{var isValueArray=params.value instanceof Array;res_id=isValueArray?params.value[0]:undefined;value=isValueArray?params.value[1]:params.value;}
var fields=_.extend({display_name:{type:'char'},id:{type:'integer'},},params.fields);var dataPoint={_cache:type==='list'?{}:undefined,_changes:null,_domains:{},_rawChanges:{},aggregateValues:params.aggregateValues||{},context:context,count:params.count||res_ids.length,data:data,domain:params.domain||[],fields:fields,fieldsInfo:params.fieldsInfo,groupedBy:params.groupedBy||[],groupsCount:0,groupsLimit:type==='list'&&params.groupsLimit||null,groupsOffset:0,id:_.uniqueId(params.modelName+'_'),isOpen:params.isOpen,limit:type==='record'?1:(params.limit||Number.MAX_SAFE_INTEGER),loadMoreOffset:0,model:params.modelName,offset:params.offset||(type==='record'?_.indexOf(res_ids,res_id):0),openGroupByDefault:params.openGroupByDefault,orderedBy:params.orderedBy||[],orderedResIDs:params.orderedResIDs,parentID:params.parentID,rawContext:params.rawContext,ref:params.ref||res_id,relationField:params.relationField,res_id:res_id,res_ids:res_ids,specialData:{},_specialDataCache:{},static:params.static||false,type:type,value:value,viewType:params.viewType,};dataPoint._editionViewType={};dataPoint.evalModifiers=this._evalModifiers.bind(this,dataPoint);dataPoint.getContext=this._getContext.bind(this,dataPoint);dataPoint.getDomain=this._getDomain.bind(this,dataPoint);dataPoint.getFieldNames=this._getFieldNames.bind(this,dataPoint);dataPoint.isDirty=this.isDirty.bind(this,dataPoint.id);this.localData[dataPoint.id]=dataPoint;return dataPoint;},_makeDefaultRecord:function(modelName,params){var self=this;var targetView=params.viewType;var fields=params.fields;var fieldsInfo=params.fieldsInfo;var fieldNames=Object.keys(fieldsInfo[targetView]);var fields_key=_.without(fieldNames,'__last_update');var parentRecord=params.parentID&&this.localData[params.parentID].type==='list'?this.localData[params.parentID]:null;if(parentRecord&&parentRecord.viewType in parentRecord.fieldsInfo){var originView=parentRecord.viewType;fieldNames=_.union(fieldNames,Object.keys(parentRecord.fieldsInfo[originView]));fieldsInfo[targetView]=_.defaults({},fieldsInfo[targetView],parentRecord.fieldsInfo[originView]);fields=_.defaults({},fields,parentRecord.fields);}
return this._rpc({model:modelName,method:'default_get',args:[fields_key],context:params.context,}).then(function(result){var record=self._makeDataPoint({modelName:modelName,fields:fields,fieldsInfo:fieldsInfo,context:params.context,parentID:params.parentID,res_ids:params.res_ids,viewType:targetView,});var overrideDefaultFields=self._computeOverrideDefaultFields(params.parentID,params.position);if(overrideDefaultFields){result[overrideDefaultFields.field]=overrideDefaultFields.value;}
return self.applyDefaultValues(record.id,result,{fieldNames:fieldNames}).then(function(){var def=new Promise(function(resolve,reject){var always=function(){if(record._warning){if(params.allowWarning){delete record._warning;}else{reject();}}
resolve();};self._performOnChange(record,fields_key).then(always).guardedCatch(always);});return def;}).then(function(){return self._fetchRelationalData(record);}).then(function(){return self._postprocess(record);}).then(function(){self.save(record.id,{savePoint:true});return record.id;});});},_parseServerData:function(fieldNames,element,data){var self=this;_.each(fieldNames,function(fieldName){var field=element.fields[fieldName];var val=data[fieldName];if(field.type==='many2one'){if(val!==false){var r=self._makeDataPoint({modelName:field.relation,fields:{display_name:{type:'char'},id:{type:'integer'},},data:{display_name:val[1],id:val[0],},parentID:element.id,});data[fieldName]=r.id;}else{data[fieldName]=false;}}else{data[fieldName]=self._parseServerValue(field,val);}});},_performOnChange:function(record,fields,viewType){var self=this;var onchangeSpec=this._buildOnchangeSpecs(record,viewType);if(!onchangeSpec){return Promise.resolve();}
var idList=record.data.id?[record.data.id]:[];var options={full:true,};if(fields.length===1){fields=fields[0];options.fieldName=fields;}
var context=this._getContext(record,options);var currentData=this._generateOnChangeData(record,{changesOnly:false});return self._rpc({model:record.model,method:'onchange',args:[idList,currentData,fields,onchangeSpec],context:context,}).then(function(result){if(!record._changes){return;}
if(result.warning){self.trigger_up('warning',result.warning);record._warning=true;}
if(result.domain){record._domains=_.extend(record._domains,result.domain);}
return self._applyOnChange(result.value,record).then(function(){return result;});});},_performRPC:function(params){var self=this;var request=_.extend({},params);var prom=new Promise(function(resolve,reject){request.resolve=resolve;request.reject=reject;});this.batchedRPCsRequests.push(request);Promise.resolve().then(function(){if(!self.batchedRPCsRequests.length){return;}
var batchedRPCsRequests=self.batchedRPCsRequests;self.batchedRPCsRequests=[];var batches={};var key;for(var i=0;i<batchedRPCsRequests.length;i++){var request=batchedRPCsRequests[i];key=request.model+','+JSON.stringify(request.context);if(!batches[key]){batches[key]=_.extend({},request,{requests:[request]});}else{batches[key].ids=_.uniq(batches[key].ids.concat(request.ids));batches[key].fieldNames=_.uniq(batches[key].fieldNames.concat(request.fieldNames));batches[key].requests.push(request);}}
function onSuccess(batch,results){for(var i=0;i<batch.requests.length;i++){var request=batch.requests[i];var fieldNames=request.fieldNames.concat(['id']);var filteredResults=results.filter(function(record){return request.ids.indexOf(record.id)>=0;}).map(function(record){return _.pick(record,fieldNames);});request.resolve(filteredResults);}}
function onFailure(batch,error){for(var i=0;i<batch.requests.length;i++){var request=batch.requests[i];request.reject(error);}}
for(key in batches){var batch=batches[key];self._rpc({model:batch.model,method:'read',args:[batch.ids,batch.fieldNames],context:batch.context,}).then(onSuccess.bind(null,batch)).guardedCatch(onFailure.bind(null,batch));}});return prom;},_postprocess:function(record,options){var self=this;var viewType=options&&options.viewType||record.viewType;var defs=[];_.each(record.getFieldNames(options),function(name){var field=record.fields[name];var fieldInfo=record.fieldsInfo[viewType][name]||{};var options=fieldInfo.options||{};if(options.always_reload){if(record.fields[name].type==='many2one'&&record.data[name]){var element=self.localData[record.data[name]];defs.push(self._rpc({model:field.relation,method:'name_get',args:[element.data.id],context:self._getContext(record,{fieldName:name,viewType:viewType}),}).then(function(result){element.data.display_name=result[0][1];}));}}});defs.push(this._fetchSpecialData(record,options));return Promise.all(defs).then(function(){return record;});},_processX2ManyCommands:function(record,fieldName,commands,options){var self=this;options=options||{};var defs=[];var field=record.fields[fieldName];var fieldInfo=record.fieldsInfo[options.viewType||record.viewType][fieldName]||{};var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];var fieldsInfo=view?view.fieldsInfo:fieldInfo.fieldsInfo;var fields=view?view.fields:fieldInfo.relatedFields;var viewType=view?view.type:fieldInfo.viewType;var parentContext=_.omit(record.context,function(val,key){return _.str.startsWith(key,'default_');});var x2manyList=self._makeDataPoint({context:parentContext,fieldsInfo:fieldsInfo,fields:fields,limit:fieldInfo.limit,modelName:field.relation,parentID:record.id,rawContext:fieldInfo&&fieldInfo.context,relationField:field.relation_field,res_ids:[],static:true,type:'list',viewType:viewType,});record._changes[fieldName]=x2manyList.id;x2manyList._changes=[];var many2ones={};var r;commands=commands||[];var isCommandList=commands.length&&_.isArray(commands[0]);if(!isCommandList){commands=[[6,false,commands]];}
_.each(commands,function(value){if(value[0]===0){r=self._makeDataPoint({modelName:x2manyList.model,context:x2manyList.context,fieldsInfo:fieldsInfo,fields:fields,parentID:x2manyList.id,viewType:viewType,});r._noAbandon=true;x2manyList._changes.push({operation:'ADD',id:r.id});x2manyList._cache[r.res_id]=r.id;_.each(r.getFieldNames(),function(fieldName){r.data[fieldName]=null;});r._changes=_.defaults(value[2],r.data);for(var fieldName in r._changes){if(!r._changes[fieldName]){continue;}
var isFieldInView=fieldName in r.fields;if(isFieldInView){var field=r.fields[fieldName];var fieldType=field.type;var rec;if(fieldType==='many2one'){rec=self._makeDataPoint({context:r.context,modelName:field.relation,data:{id:r._changes[fieldName]},parentID:r.id,});r._changes[fieldName]=rec.id;many2ones[fieldName]=true;}else if(fieldType==='reference'){var reference=r._changes[fieldName].split(',');rec=self._makeDataPoint({context:r.context,modelName:reference[0],data:{id:parseInt(reference[1])},parentID:r.id,});r._changes[fieldName]=rec.id;many2ones[fieldName]=true;}else if(_.contains(['one2many','many2many'],fieldType)){var x2mCommands=value[2][fieldName];defs.push(self._processX2ManyCommands(r,fieldName,x2mCommands));}else{r._changes[fieldName]=self._parseServerValue(field,r._changes[fieldName]);}}}}
if(value[0]===6){_.each(value[2],function(res_id){x2manyList._changes.push({operation:'ADD',resID:res_id});});var def=self._readUngroupedList(x2manyList).then(function(){return Promise.all([self._fetchX2ManysBatched(x2manyList),self._fetchReferencesBatched(x2manyList)]);});defs.push(def);}});_.each(_.keys(many2ones),function(name){defs.push(self._fetchNameGets(x2manyList,name));});return Promise.all(defs);},_readMissingFields:function(list,resIDs,fieldNames){var self=this;var missingIDs=[];for(var i=0,len=resIDs.length;i<len;i++){var resId=resIDs[i];var dataPointID=list._cache[resId];if(!dataPointID){missingIDs.push(resId);continue;}
var record=self.localData[dataPointID];var data=_.extend({},record.data,record._changes);if(_.difference(fieldNames,_.keys(data)).length){missingIDs.push(resId);}}
var def;if(missingIDs.length&&fieldNames.length){def=self._performRPC({context:list.getContext(),fieldNames:fieldNames,ids:missingIDs,method:'read',model:list.model,});}else{def=Promise.resolve(_.map(missingIDs,function(id){return{id:id};}));}
return def.then(function(records){_.each(resIDs,function(id){var dataPoint;var data=_.findWhere(records,{id:id});if(id in list._cache){dataPoint=self.localData[list._cache[id]];if(data){self._parseServerData(fieldNames,dataPoint,data);_.extend(dataPoint.data,data);}}else{dataPoint=self._makeDataPoint({context:list.getContext(),data:data,fieldsInfo:list.fieldsInfo,fields:list.fields,modelName:list.model,parentID:list.id,viewType:list.viewType,});self._parseServerData(fieldNames,dataPoint,dataPoint.data);list._cache[id]=dataPoint.id;}
_.each(list._changes,function(change){if(change.operation==='ADD'&&!change.id&&change.resID===id){change.id=dataPoint.id;}});});return list;});},_readGroup:function(list,options){var self=this;options=options||{};var groupByField=list.groupedBy[0];var rawGroupBy=groupByField.split(':')[0];var fields=_.uniq(list.getFieldNames().concat(rawGroupBy));var orderedBy=_.filter(list.orderedBy,function(order){return order.name===rawGroupBy||list.fields[order.name].group_operator!==undefined;});var openGroupsLimit=list.groupsLimit||self.OPEN_GROUP_LIMIT;var expand=list.openGroupByDefault&&options.fetchRecordsWithGroups;return this._rpc({model:list.model,method:'web_read_group',fields:fields,domain:list.domain,context:list.context,groupBy:list.groupedBy,limit:list.groupsLimit,offset:list.groupsOffset,orderBy:orderedBy,lazy:true,expand:expand,expand_limit:expand?list.limit:null,expand_orderby:expand?list.orderedBy:null,}).then(function(result){var groups=result.groups;list.groupsCount=result.length;var previousGroups=_.map(list.data,function(groupID){return self.localData[groupID];});list.data=[];list.count=0;var defs=[];var openGroupCount=0;_.each(groups,function(group){var aggregateValues={};_.each(group,function(value,key){if(_.contains(fields,key)&&key!==groupByField&&AGGREGATABLE_TYPES.includes(list.fields[key].type)){aggregateValues[key]=value;}});var value=group[groupByField];if(list.fields[rawGroupBy].type==="selection"){var choice=_.find(list.fields[rawGroupBy].selection,function(c){return c[0]===value;});value=choice?choice[1]:false;}
var newGroup=self._makeDataPoint({modelName:list.model,count:group[rawGroupBy+'_count'],domain:group.__domain,context:list.context,fields:list.fields,fieldsInfo:list.fieldsInfo,value:value,aggregateValues:aggregateValues,groupedBy:list.groupedBy.slice(1),orderedBy:list.orderedBy,orderedResIDs:list.orderedResIDs,limit:list.limit,openGroupByDefault:list.openGroupByDefault,parentID:list.id,type:'list',viewType:list.viewType,});var oldGroup=_.find(previousGroups,function(g){return g.res_id===newGroup.res_id&&g.value===newGroup.value;});if(oldGroup){delete self.localData[newGroup.id];var updatedProps=_.pick(oldGroup,'isOpen','offset','id');if(options.onlyGroups||oldGroup.isOpen&&newGroup.groupedBy.length){updatedProps.data=oldGroup.data;}
_.extend(newGroup,updatedProps);newGroup.limit=oldGroup.limit+oldGroup.loadMoreOffset;self.localData[newGroup.id]=newGroup;}else if(!newGroup.openGroupByDefault||openGroupCount>=openGroupsLimit){newGroup.isOpen=false;}else if('__fold'in group){newGroup.isOpen=!group.__fold;}else{newGroup.isOpen=!self.localData[newGroup.parentID].parentID;}
list.data.push(newGroup.id);list.count+=newGroup.count;if(newGroup.isOpen&&newGroup.count>0){openGroupCount++;if(group.__data){newGroup.__data=group.__data;}
options=_.defaults({enableRelationalFetch:false},options);defs.push(self._load(newGroup,options));}});if(options.keepEmptyGroups){var emptyGroupsIDs=_.difference(_.pluck(previousGroups,'id'),list.data);_.each(emptyGroupsIDs,function(groupID){list.data.push(groupID);var emptyGroup=self.localData[groupID];emptyGroup.aggregateValues={};});}
return Promise.all(defs).then(function(groups){if(!options.onlyGroups){list.res_ids=_.flatten(_.map(groups,function(group){return group?group.res_ids:[];}));}
return list;}).then(function(){return Promise.all([self._fetchX2ManysSingleBatch(list),self._fetchReferencesSingleBatch(list)]).then(function(){return list;});});});},_readUngroupedList:function(list){var self=this;var def=Promise.resolve();list=this._applyX2ManyOperations(list);if(list.res_ids.length>list.limit&&list.orderedBy.length){if(!list.orderedResIDs){var fieldNames=_.pluck(list.orderedBy,'name');def=this._readMissingFields(list,_.filter(list.res_ids,_.isNumber),fieldNames);}
def.then(function(){self._sortList(list);});}
return def.then(function(){var resIDs=[];var currentResIDs=list.res_ids;if(list.orderedResIDs){currentResIDs=list.orderedResIDs.filter(function(resID){return list.res_ids.indexOf(resID)>=0;});}
var currentCount=currentResIDs.length;var upperBound=list.limit?Math.min(list.offset+list.limit,currentCount):currentCount;var fieldNames=list.getFieldNames();for(var i=list.offset;i<upperBound;i++){var resId=currentResIDs[i];if(_.isNumber(resId)){resIDs.push(resId);}}
return self._readMissingFields(list,resIDs,fieldNames).then(function(){if(list.res_ids.length<=list.limit){self._sortList(list);}else{self._setDataInRange(list);}
return list;});});},_reload:function(id,options){options=options||{};var element=this.localData[id];if(element.type==='record'){if(!options.currentId&&(('currentId'in options)||this.isNew(id))){var params={context:element.context,fieldsInfo:element.fieldsInfo,fields:element.fields,viewType:element.viewType,allowWarning:true,};return this._makeDefaultRecord(element.model,params);}
if(!options.keepChanges){this.discardChanges(id,{rollback:false});}}else if(element._changes){delete element.tempLimitIncrement;_.each(element._changes,function(change){delete change.isNew;});}
if(options.context!==undefined){element.context=options.context;}
if(options.orderedBy!==undefined){element.orderedBy=options.orderedBy||element.orderedBy;}
if(options.domain!==undefined){element.domain=options.domain;}
if(options.groupBy!==undefined){element.groupedBy=options.groupBy;}
if(options.limit!==undefined){element.limit=options.limit;}
if(options.offset!==undefined){this._setOffset(element.id,options.offset);}
if(options.groupsLimit!==undefined){element.groupsLimit=options.groupsLimit;}
if(options.groupsOffset!==undefined){element.groupsOffset=options.groupsOffset;}
if(options.loadMoreOffset!==undefined){element.loadMoreOffset=options.loadMoreOffset;}else{element.loadMoreOffset=0;}
if(options.currentId!==undefined){element.res_id=options.currentId;}
if(options.ids!==undefined){element.res_ids=options.ids;element.count=element.res_ids.length;}
if(element.type==='record'){element.offset=_.indexOf(element.res_ids,element.res_id);}
var loadOptions=_.pick(options,'fieldNames','viewType');return this._load(element,loadOptions).then(function(result){return result.id;});},_saveSpecialDataCache:function(record,fieldName,value){if(_.isEqual(record._specialDataCache[fieldName],value)){return false;}
record._specialDataCache[fieldName]=value;return true;},_searchReadUngroupedList:function(list){var self=this;var fieldNames=list.getFieldNames();var prom;if(list.__data){const fieldNameSet=new Set(fieldNames);fieldNameSet.add("id");list.__data.records.forEach(record=>Object.keys(record).filter(fieldName=>!fieldNameSet.has(fieldName)).forEach(fieldName=>delete record[fieldName]));prom=Promise.resolve(list.__data);}else{prom=this._rpc({route:'/web/dataset/search_read',model:list.model,fields:fieldNames,context:_.extend({},list.getContext(),{bin_size:true}),domain:list.domain||[],limit:list.limit,offset:list.loadMoreOffset+list.offset,orderBy:list.orderedBy,});}
return prom.then(function(result){delete list.__data;list.count=result.length;var ids=_.pluck(result.records,'id');var data=_.map(result.records,function(record){var dataPoint=self._makeDataPoint({context:list.context,data:record,fields:list.fields,fieldsInfo:list.fieldsInfo,modelName:list.model,parentID:list.id,viewType:list.viewType,});self._parseServerData(fieldNames,dataPoint,dataPoint.data);return dataPoint.id;});if(list.loadMoreOffset){list.data=list.data.concat(data);list.res_ids=list.res_ids.concat(ids);}else{list.data=data;list.res_ids=ids;}
self._updateParentResIDs(list);return list;});},_setDataInRange:function(list){var idsInRange;if(list.limit){idsInRange=list.res_ids.slice(list.offset,list.offset+list.limit);}else{idsInRange=list.res_ids;}
list.data=[];_.each(idsInRange,function(id){if(list._cache[id]){list.data.push(list._cache[id]);}});if(list.limit){for(var i=list.offset+list.limit;i<list.res_ids.length;i++){var id=list.res_ids[i];var dataPointID=list._cache[id];if(_.findWhere(list._changes,{isNew:true,id:dataPointID})){list.data.push(dataPointID);}else{break;}}}},_setOffset:function(elementId,offset){var element=this.localData[elementId];element.offset=offset;if(element.type==='record'&&element.res_ids.length){element.res_id=element.res_ids[offset];}},_sortList:function(list){if(!list.static){return;}
var self=this;if(list.orderedResIDs){var orderedResIDs={};for(var k=0;k<list.orderedResIDs.length;k++){orderedResIDs[list.orderedResIDs[k]]=k;}
utils.stableSort(list.res_ids,function compareResIdIndexes(resId1,resId2){if(!(resId1 in orderedResIDs)&&!(resId2 in orderedResIDs)){return 0;}
if(!(resId1 in orderedResIDs)){return Infinity;}
if(!(resId2 in orderedResIDs)){return-Infinity;}
return orderedResIDs[resId1]-orderedResIDs[resId2];});}else if(list.orderedBy.length){var compareRecords=function(resId1,resId2,level){if(!level){level=0;}
if(list.orderedBy.length<level+1){return 0;}
var order=list.orderedBy[level];var record1ID=list._cache[resId1];var record2ID=list._cache[resId2];if(!record1ID&&!record2ID){return 0;}
if(!record1ID){return Infinity;}
if(!record2ID){return-Infinity;}
var r1=self.localData[record1ID];var r2=self.localData[record2ID];var data1=_.extend({},r1.data,r1._changes);var data2=_.extend({},r2.data,r2._changes);var orderData1=data1[order.name];var orderData2=data2[order.name];if(list.fields[order.name].type==='many2one'){orderData1=orderData1?self.localData[orderData1].data.display_name:"";orderData2=orderData2?self.localData[orderData2].data.display_name:"";}
if(orderData1<orderData2){return order.asc?-1:1;}
if(orderData1>orderData2){return order.asc?1:-1;}
return compareRecords(resId1,resId2,level+1);};utils.stableSort(list.res_ids,compareRecords);}
this._setDataInRange(list);},_updateParentResIDs:function(element){var self=this;if(element.parentID){var parent=this.localData[element.parentID];parent.res_ids=_.flatten(_.map(parent.data,function(dataPointID){return self.localData[dataPointID].res_ids;}));this._updateParentResIDs(parent);}},_updateRecordsData:function(records,fieldName,values){if(!records.length||!values){return;}
var self=this;var field=records[0].fields[fieldName];var fieldInfo=records[0].fieldsInfo[records[0].viewType][fieldName];var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];var fieldsInfo=view?view.fieldsInfo:fieldInfo.fieldsInfo;var fields=view?view.fields:fieldInfo.relatedFields;var viewType=view?view.type:fieldInfo.viewType;var id2Values=new Map(values.map((value)=>[value.id,value]))
_.each(records,function(record){var x2mList=self.localData[record.data[fieldName]];x2mList.data=[];_.each(x2mList.res_ids,function(res_id){var dataPoint=self._makeDataPoint({modelName:field.relation,data:id2Values.get(res_id),fields:fields,fieldsInfo:fieldsInfo,parentID:x2mList.id,viewType:viewType,});x2mList.data.push(dataPoint.id);x2mList._cache[res_id]=dataPoint.id;});});},_visitChildren:function(element,fn){var self=this;fn(element);if(element.type==='record'){for(var fieldName in element.data){var field=element.fields[fieldName];if(!field){continue;}
if(_.contains(['one2many','many2one','many2many'],field.type)){var hasChange=element._changes&&fieldName in element._changes;var value=hasChange?element._changes[fieldName]:element.data[fieldName];var relationalElement=this.localData[value];if(relationalElement){self._visitChildren(relationalElement,fn);}}}}
if(element.type==='list'){element=this._applyX2ManyOperations(element);_.each(element.data,function(elemId){var elem=self.localData[elemId];self._visitChildren(elem,fn);});}},});return BasicModel;});;

/* /web/static/src/js/views/basic/basic_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.BasicView',function(require){"use strict";var AbstractView=require('web.AbstractView');var BasicController=require('web.BasicController');var BasicModel=require('web.BasicModel');var config=require('web.config');var fieldRegistry=require('web.field_registry');var pyUtils=require('web.py_utils');var utils=require('web.utils');var BasicView=AbstractView.extend({config:_.extend({},AbstractView.prototype.config,{Model:BasicModel,Controller:BasicController,}),viewType:undefined,init:function(viewInfo,params){this._super.apply(this,arguments);this.fieldsInfo={};this.fieldsInfo[this.viewType]=this.fieldsView.fieldsInfo[this.viewType];this.rendererParams.viewType=this.viewType;this.controllerParams.confirmOnDelete=true;this.controllerParams.archiveEnabled='active'in this.fields;this.controllerParams.hasButtons='action_buttons'in params?params.action_buttons:true;this.controllerParams.viewId=viewInfo.view_id;this.loadParams.fieldsInfo=this.fieldsInfo;this.loadParams.fields=this.fields;this.loadParams.limit=parseInt(this.arch.attrs.limit,10)||params.limit;this.loadParams.parentID=params.parentID;this.loadParams.viewType=this.viewType;this.recordID=params.recordID;this.model=params.model;},_getFieldWidgetClass:function(viewType,field,attrs){var FieldWidget;if(attrs.widget){FieldWidget=fieldRegistry.getAny([viewType+"."+attrs.widget,attrs.widget]);if(!FieldWidget){console.warn("Missing widget: ",attrs.widget," for field",attrs.name,"of type",field.type);}}else if(viewType==='kanban'&&field.type==='many2many'){FieldWidget=fieldRegistry.get('kanban.many2many_tags');}
return FieldWidget||fieldRegistry.getAny([viewType+"."+field.type,field.type,"abstract"]);},_loadData:async function(model){if(this.recordID){await model.addFieldsInfo(this.recordID,{fields:this.fields,fieldInfo:this.fieldsInfo[this.viewType],viewType:this.viewType,});var record=model.get(this.recordID);var viewType=this.viewType;var viewFields=Object.keys(record.fieldsInfo[viewType]);var fieldNames=_.difference(viewFields,Object.keys(record.data));var fieldsInfo=record.fieldsInfo[viewType];_.each(viewFields,(name)=>{if(!_.contains(fieldNames,name)){var fieldType=record.fields[name].type;var fieldInfo=fieldsInfo[name];if(fieldInfo.Widget){var requiresSpecialData=fieldInfo.Widget.prototype.specialData;if(requiresSpecialData&&!(name in record.specialData)){fieldNames.push(name);return;}}
if((fieldType==='one2many'||fieldType==='many2many')){if(!('fieldsInfo'in record.data[name])){fieldNames.push(name);}else{var x2mFieldInfo=record.fieldsInfo[this.viewType][name];var viewType=x2mFieldInfo.viewType||x2mFieldInfo.mode;var knownFields=Object.keys(record.data[name].fieldsInfo[record.data[name].viewType]||{});var newFields=Object.keys(record.data[name].fieldsInfo[viewType]||{});if(_.difference(newFields,knownFields).length){fieldNames.push(name);}
if(record.data[name].viewType==='default'){var fieldViews=fieldInfo.views||fieldInfo.fieldsInfo||{};var defaultFieldInfo=record.data[name].fieldsInfo.default;_.each(fieldViews,function(fieldView){_.each(fieldView.fieldsInfo,function(x2mFieldInfo){_.defaults(x2mFieldInfo,defaultFieldInfo);});});}}}
if(fieldType==='many2one'){if(JSON.stringify(record.data[name].context)!==JSON.stringify(fieldInfo.context)){fieldNames.push(name);}}}});var def;if(fieldNames.length){if(model.isNew(record.id)){def=model.applyDefaultValues(record.id,{},{fieldNames:fieldNames,viewType:viewType,});}else{def=model.reload(record.id,{fieldNames:fieldNames,keepChanges:true,viewType:viewType,});}}
return Promise.resolve(def).then(function(){return model.get(record.id);});}
return this._super.apply(this,arguments);},_processArch:function(arch,fv){var self=this;utils.traverse(arch,function(node){return self._processNode(node,fv);});},_processField:function(viewType,field,attrs){var self=this;attrs.Widget=this._getFieldWidgetClass(viewType,field,attrs);_.each(attrs,function(value,key){var splitKey=key.split('-');if(splitKey[0]==='decoration'){attrs.decorations=attrs.decorations||[];attrs.decorations.push({className:'text-'+splitKey[1],expression:pyUtils._getPyJSAST(value),});}});if(!_.isObject(attrs.options)){attrs.options=attrs.options?pyUtils.py_eval(attrs.options):{};}
if(attrs.on_change&&attrs.on_change!=="0"&&!field.onChange){field.onChange="1";}
if(attrs.modifiers.invisible===true||attrs.modifiers.column_invisible===true){attrs.__no_fetch=true;}
if(!_.isEmpty(field.views)){attrs.views={};_.each(field.views,function(innerFieldsView,viewType){viewType=viewType==='tree'?'list':viewType;attrs.views[viewType]=self._processFieldsView(innerFieldsView,viewType);});}
attrs.views=attrs.views||{};attrs.mode=attrs.mode==='tree'?'list':attrs.mode;if(!attrs.views.list&&attrs.views.tree){attrs.views.list=attrs.views.tree;}
if(field.type==='one2many'||field.type==='many2many'){if(attrs.Widget.prototype.useSubview){var mode=attrs.mode;if(!mode){if(attrs.views.list&&!attrs.views.kanban){mode='list';}else if(!attrs.views.list&&attrs.views.kanban){mode='kanban';}else{mode='list,kanban';}}
if(mode.indexOf(',')!==-1){mode=config.device.isMobile?'kanban':'list';}
attrs.mode=mode;if(mode in attrs.views){var view=attrs.views[mode];this._processSubViewAttrs(view,attrs);}}
if(attrs.Widget.prototype.fieldsToFetch){attrs.viewType='default';attrs.relatedFields=_.extend({},attrs.Widget.prototype.fieldsToFetch);attrs.fieldsInfo={default:_.mapObject(attrs.Widget.prototype.fieldsToFetch,function(){return{};}),};if(attrs.options.color_field){attrs.relatedFields[attrs.options.color_field]={type:'integer'};attrs.fieldsInfo.default[attrs.options.color_field]={};}}}
if(attrs.Widget.prototype.fieldDependencies){attrs.fieldDependencies=attrs.Widget.prototype.fieldDependencies;}
return attrs;},_processFieldsView:function(fieldsView,viewType){var fv=this._super.apply(this,arguments);viewType=viewType||this.viewType;fv.type=viewType;fv.fieldsInfo=Object.create(null);fv.fieldsInfo[viewType]=Object.create(null);this._processArch(fv.arch,fv);return fv;},_processNode:function(node,fv){if(typeof node==='string'){return false;}
if(!_.isObject(node.attrs.modifiers)){node.attrs.modifiers=node.attrs.modifiers?JSON.parse(node.attrs.modifiers):{};}
if(!_.isObject(node.attrs.options)&&node.tag==='button'){node.attrs.options=node.attrs.options?JSON.parse(node.attrs.options):{};}
if(node.tag==='field'){var viewType=fv.type;var fieldsInfo=fv.fieldsInfo[viewType];var fields=fv.viewFields;fieldsInfo[node.attrs.name]=this._processField(viewType,fields[node.attrs.name],node.attrs?_.clone(node.attrs):{});if(fieldsInfo[node.attrs.name].fieldDependencies){var deps=fieldsInfo[node.attrs.name].fieldDependencies;for(var dependency_name in deps){var dependency_dict={name:dependency_name,type:deps[dependency_name].type};if(!(dependency_name in fieldsInfo)){fieldsInfo[dependency_name]=_.extend({},dependency_dict,{options:deps[dependency_name].options||{},});}
if(!(dependency_name in fields)){fields[dependency_name]=dependency_dict;}
if(fv.fields&&!(dependency_name in fv.fields)){fv.fields[dependency_name]=dependency_dict;}}}
return false;}
return node.tag!=='arch';},_processSubViewAttrs:function(view,attrs){var defaultOrder=view.arch.attrs.default_order;if(defaultOrder){attrs.orderedBy=_.map(defaultOrder.split(','),function(order){order=order.trim().split(' ');return{name:order[0],asc:order[1]!=='desc'};});}else{var handleField=_.find(view.arch.children,function(child){return child.attrs&&child.attrs.widget==='handle';});if(handleField){attrs.orderedBy=[{name:handleField.attrs.name,asc:true}];}}
attrs.columnInvisibleFields={};_.each(view.arch.children,function(child){if(child.attrs&&child.attrs.modifiers){attrs.columnInvisibleFields[child.attrs.name]=child.attrs.modifiers.column_invisible||false;}});},});return BasicView;});;

/* /web/static/src/js/views/basic/basic_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.BasicController',function(require){"use strict";var AbstractController=require('web.AbstractController');var core=require('web.core');var Dialog=require('web.Dialog');var FieldManagerMixin=require('web.FieldManagerMixin');var Pager=require('web.Pager');var TranslationDialog=require('web.TranslationDialog');var _t=core._t;var BasicController=AbstractController.extend(FieldManagerMixin,{custom_events:_.extend({},AbstractController.prototype.custom_events,FieldManagerMixin.custom_events,{discard_changes:'_onDiscardChanges',reload:'_onReload',resequence_records:'_onResequenceRecords',set_dirty:'_onSetDirty',load_optional_fields:'_onLoadOptionalFields',save_optional_fields:'_onSaveOptionalFields',sidebar_data_asked:'_onSidebarDataAsked',translate:'_onTranslate',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.archiveEnabled=params.archiveEnabled;this.confirmOnDelete=params.confirmOnDelete;this.hasButtons=params.hasButtons;FieldManagerMixin.init.call(this,this.model);this.mode=params.mode||'readonly';this.handle=this.initialState.id;this.savingDef=Promise.resolve();this.viewId=params.viewId;},start:function(){this.$el.toggleClass('o_cannot_create',!this.activeActions.create);return this._super.apply(this,arguments).then(this._updateEnv.bind(this));},canBeDiscarded:function(recordID){var self=this;if(!this.isDirty(recordID)){return Promise.resolve(false);}
var message=_t("The record has been modified, your changes will be discarded. Do you want to proceed?");var def;def=new Promise(function(resolve,reject){var dialog=Dialog.confirm(self,message,{title:_t("Warning"),confirm_callback:resolve.bind(self,true),cancel_callback:reject,});dialog.on('closed',def,reject);});return def;},canBeSaved:function(recordID){var fieldNames=this.renderer.canBeSaved(recordID||this.handle);if(fieldNames.length){this._notifyInvalidFields(fieldNames);return false;}
return true;},discardChanges:function(recordID,options){return Promise.all([this.mutex.getUnlockedDef(),this.savingDef]).then(this._discardChanges.bind(this,recordID||this.handle,options));},getSelectedIds:function(){return[];},giveFocus:function(){this.renderer.giveFocus();},isDirty:function(recordID){return this.model.isDirty(recordID||this.handle);},renderPager:function($node,options){var self=this;var params=this._getPagerParams();this.pager=new Pager(this,params.size,params.current_min,params.limit,options);this.pager.on('pager_changed',this,function(newState){this.pager.disable();var data=this.model.get(this.handle,{raw:true});var limitChanged=(data.limit!==newState.limit);var reloadParams;if(data.groupedBy&&data.groupedBy.length){reloadParams={groupsLimit:newState.limit,groupsOffset:newState.current_min-1};}else{reloadParams={limit:newState.limit,offset:newState.current_min-1};}
this.reload(reloadParams).then(function(){if(!limitChanged){self.trigger_up('scrollTo',{top:0});}}).then(this.pager.enable.bind(this.pager));});return this.pager.appendTo($node).then(function(){self._updatePager();});},saveRecord:function(recordID,options){var self=this;var unlockedMutex=this.mutex.getUnlockedDef().then(function(){return self.renderer.commitChanges(recordID||self.handle);}).then(function(){return self.mutex.exec(self._saveRecord.bind(self,recordID,options));});this.savingDef=new Promise(function(resolve){unlockedMutex.then(resolve).guardedCatch(resolve);});return unlockedMutex;},update:function(params,options){var self=this;this.mode=params.mode||this.mode;return this._super(params,options).then(function(){self._updateEnv();self._updatePager();});},reload:function(params){if(params&&params.controllerState){if(params.controllerState.currentId){params.currentId=params.controllerState.currentId;}
params.ids=params.controllerState.resIds;}
return this._super.apply(this,arguments);},_abandonRecord:function(recordID){recordID=recordID||this.handle;if(recordID===this.handle){this.trigger_up('history_back');}else{this.model.removeLine(recordID);}},_applyChanges:function(dataPointID,changes,event){var _super=FieldManagerMixin._applyChanges.bind(this);return this.mutex.exec(function(){return _super(dataPointID,changes,event);});},_callButtonAction:function(attrs,record){var self=this;var def=new Promise(function(resolve,reject){var reload=function(){return self.isDestroyed()?Promise.resolve():self.reload();};record=record||self.model.get(self.handle);self.trigger_up('execute_action',{action_data:_.extend({},attrs,{context:record.getContext({additionalContext:attrs.context||{}}),}),env:{context:record.getContext(),currentID:record.data.id,model:record.model,resIDs:record.res_ids,},on_success:resolve,on_fail:function(){self.update({},{reload:false}).then(reject).guardedCatch(reject);},on_closed:reload,});});return this.alive(def);},_confirmChange:function(id,fields,e){if(e.name==='discard_changes'&&e.target.reset){return e.target.reset(this.model.get(e.target.dataPointID),e,true);}
var state=this.model.get(this.handle);return this.renderer.confirmChange(state,id,fields,e);},_confirmSaveNewRecord:function(){var self=this;var def=new Promise(function(resolve,reject){var message=_t("You need to save this new record before editing the translation. Do you want to proceed?");var dialog=Dialog.confirm(self,message,{title:_t("Warning"),confirm_callback:resolve.bind(self,true),cancel_callback:reject,});dialog.on('closed',self,reject);});return def;},_deleteRecords:function(ids){var self=this;function doIt(){return self.model.deleteRecords(ids,self.modelName).then(self._onDeletedRecords.bind(self,ids));}
if(this.confirmOnDelete){Dialog.confirm(this,_t("Are you sure you want to delete this record ?"),{confirm_callback:doIt,});}else{doIt();}},_disableButtons:function(){if(this.$buttons){this.$buttons.find('button').attr('disabled',true);}},_discardChanges:function(recordID,options){var self=this;recordID=recordID||this.handle;options=options||{};return this.canBeDiscarded(recordID).then(function(needDiscard){if(options.readonlyIfRealDiscard&&!needDiscard){return;}
self.model.discardChanges(recordID);if(options.noAbandon){return;}
if(self.model.canBeAbandoned(recordID)){self._abandonRecord(recordID);return;}
return self._confirmSave(recordID);});},_enableButtons:function(){if(this.$buttons){this.$buttons.find('button').removeAttr('disabled');}},exportState:function(){var state=this._super.apply(this,arguments);var env=this.model.get(this.handle,{env:true});return _.extend(state,{currentId:env.currentId,resIds:env.ids,});},_getOptionalFieldsLocalStorageKey:function(keyParts){keyParts.model=this.modelName;keyParts.viewType=this.viewType;keyParts.viewId=this.viewId;var parts=['model','viewType','viewId','relationalField','subViewType','subViewId',];var viewIdentifier=parts.reduce(function(identifier,partName){if(partName in keyParts){return identifier+','+keyParts[partName];}
return identifier;},'optional_fields');viewIdentifier=keyParts.fields.sort(this._nameSortComparer).reduce(function(identifier,field){return identifier+','+field.name;},viewIdentifier);return viewIdentifier;},_getPagerParams:function(){var state=this.model.get(this.handle,{raw:true});var isGrouped=state.groupedBy&&state.groupedBy.length;return{current_min:(isGrouped?state.groupsOffset:state.offset)+1,limit:isGrouped?state.groupsLimit:state.limit,size:isGrouped?state.groupsCount:state.count,};},_getSidebarEnv:function(){return{context:this.model.get(this.handle).getContext(),activeIds:this.getSelectedIds(),model:this.modelName,};},_isPagerVisible:function(){return true;},_nameSortComparer:function(left,right){return left.name<right.name?-1:1;},_notifyInvalidFields:function(invalidFields){var record=this.model.get(this.handle,{raw:true});var fields=record.fields;var warnings=invalidFields.map(function(fieldName){var fieldStr=fields[fieldName].string;return _.str.sprintf('<li>%s</li>',_.escape(fieldStr));});warnings.unshift('<ul>');warnings.push('</ul>');this.do_warn(_t("The following fields are invalid:"),warnings.join(''));},_onDeletedRecords:function(ids){this.update({});},_saveRecord:function(recordID,options){recordID=recordID||this.handle;options=_.defaults(options||{},{stayInEdit:false,reload:true,savePoint:false,});if(this.canBeSaved(recordID)){var self=this;var saveDef=this.model.save(recordID,{reload:options.reload,savePoint:options.savePoint,viewType:options.viewType,});if(!options.stayInEdit){saveDef=saveDef.then(function(fieldNames){var def=fieldNames.length?self._confirmSave(recordID):self._setMode('readonly',recordID);return def.then(function(){return fieldNames;});});}
return saveDef;}else{return Promise.reject("SaveRecord: this.canBeSave is false");}},_setMode:function(mode,recordID){if((recordID||this.handle)===this.handle){return this.update({mode:mode},{reload:false}).then(function(){core.bus.trigger('DOM_updated');});}
return Promise.resolve();},_updateEnv:function(){var env=this.model.get(this.handle,{env:true});if(this.sidebar){var sidebarEnv=this._getSidebarEnv();this.sidebar.updateEnv(sidebarEnv);}},_updatePager:function(){if(this.pager){this.pager.updateState(this._getPagerParams());this.pager.do_toggle(this._isPagerVisible());}},_onDiscardChanges:function(ev){var self=this;ev.stopPropagation();var recordID=ev.data.recordID;this._discardChanges(recordID).then(function(){self._confirmChange(recordID,[ev.data.fieldName],ev).then(ev.data.onSuccess).guardedCatch(ev.data.onSuccess);}).guardedCatch(ev.data.onFailure);},_onFieldChanged:function(ev){if(this.mode==='readonly'&&!('force_save'in ev.data)){ev.data.force_save=true;}
FieldManagerMixin._onFieldChanged.apply(this,arguments);},_onReload:function(ev){ev.stopPropagation();var data=ev&&ev.data||{};var handle=data.db_id;var prom;if(handle){prom=this.model.reload(handle).then(this._confirmSave.bind(this,handle));}else{prom=this.reload({fieldNames:data.fieldNames,keepChanges:data.keepChanges||false,});}
prom.then(ev.data.onSuccess).guardedCatch(ev.data.onFailure);},_onResequenceRecords:function(ev){ev.stopPropagation();var self=this;this.trigger_up('mutexify',{action:function(){var state=self.model.get(self.handle);var resIDs=_.map(ev.data.recordIds,function(recordID){return _.findWhere(state.data,{id:recordID}).res_id;});var options={offset:ev.data.offset,field:ev.data.handleField,};return self.model.resequence(self.modelName,resIDs,self.handle,options).then(function(){self._updateEnv();state=self.model.get(self.handle);return self.renderer.updateState(state,{noRender:true});});},});},_onLoadOptionalFields:function(ev){var res=this.call('local_storage','getItem',this._getOptionalFieldsLocalStorageKey(ev.data.keyParts));ev.data.callback(res);},_onSaveOptionalFields:function(ev){this.call('local_storage','setItem',this._getOptionalFieldsLocalStorageKey(ev.data.keyParts),ev.data.optionalColumnsEnabled);},_onSetDirty:function(ev){ev.stopPropagation();this.model.setDirty(ev.data.dataPointID);},_onSidebarDataAsked:function(ev){var sidebarEnv=this._getSidebarEnv();ev.data.callback(sidebarEnv);},_onTranslate:async function(ev){ev.stopPropagation();if(this.model.isNew(ev.data.id)){await this._confirmSaveNewRecord();var updatedFields=await this.saveRecord(ev.data.id,{stayInEdit:true});await this._confirmChange(ev.data.id,updatedFields,ev);}
var record=this.model.get(ev.data.id,{raw:true});var res_id=record.res_id||record.res_ids[0];var result=await this._rpc({route:'/web/dataset/call_button',params:{model:'ir.translation',method:'translate_fields',args:[record.model,res_id,ev.data.fieldName],kwargs:{context:record.getContext()},}});this.translationDialog=new TranslationDialog(this,{domain:result.domain,searchName:result.context.search_default_name,fieldName:ev.data.fieldName,userLanguageValue:ev.target.value||'',dataPointID:record.id,isComingFromTranslationAlert:ev.data.isComingFromTranslationAlert,isText:result.context.translation_type==='text',showSrc:result.context.translation_show_src,});return this.translationDialog.open();},});return BasicController;});;

/* /web/static/src/js/views/basic/basic_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.BasicRenderer',function(require){"use strict";var AbstractRenderer=require('web.AbstractRenderer');var config=require('web.config');var core=require('web.core');var dom=require('web.dom');var widgetRegistry=require('web.widget_registry');var qweb=core.qweb;var BasicRenderer=AbstractRenderer.extend({custom_events:{navigation_move:'_onNavigationMove',},init:function(parent,state,params){this._super.apply(this,arguments);this.activeActions=params.activeActions;this.viewType=params.viewType;this.mode=params.mode||'readonly';this.widgets=[];this.handleField=null;},canBeSaved:function(recordID){var self=this;var invalidFields=[];_.each(this.allFieldWidgets[recordID],function(widget){var canBeSaved=self._canWidgetBeSaved(widget);if(!canBeSaved){invalidFields.push(widget.name);}
if(widget.el){widget.$el.toggleClass('o_field_invalid',!canBeSaved);widget.$el.attr('aria-invalid',!canBeSaved);}});return invalidFields;},commitChanges:function(recordID){var defs=_.map(this.allFieldWidgets[recordID],function(widget){return widget.commitChanges();});return Promise.all(defs);},confirmChange:function(state,id,fields,ev){var self=this;this.state=state;var record=this._getRecord(id);if(!record){return this._render().then(_.constant([]));}
_.invoke(this.widgets,'updateState',state);var defs=[];_.each(this.allFieldWidgets[id],function(widget){var fieldChanged=_.contains(fields,widget.name);if(fieldChanged||widget.resetOnAnyFieldChange){defs.push(widget.reset(record,ev,fieldChanged));}});defs.push(this._updateAllModifiers(record));return Promise.all(defs).then(function(){return _.filter(self.allFieldWidgets[id],function(widget){var fieldChanged=_.contains(fields,widget.name);return fieldChanged||widget.resetOnAnyFieldChange;});});},focusField:function(id,fieldName,offset){this.editRecord(id);if(typeof offset==="number"){var field=_.findWhere(this.allFieldWidgets[id],{name:fieldName});dom.setSelectionRange(field.getFocusableElement().get(0),{start:offset,end:offset});}},_activateFieldWidget:function(record,currentIndex,options){options=options||{};_.defaults(options,{inc:1,wrap:false});currentIndex=Math.max(0,currentIndex);var recordWidgets=this.allFieldWidgets[record.id]||[];for(var i=0;i<recordWidgets.length;i++){var activated=recordWidgets[currentIndex].activate({event:options.event,noAutomaticCreate:options.noAutomaticCreate||false});if(activated){return currentIndex;}
currentIndex+=options.inc;if(currentIndex>=recordWidgets.length){if(options.wrap){currentIndex-=recordWidgets.length;}else{return-1;}}else if(currentIndex<0){if(options.wrap){currentIndex+=recordWidgets.length;}else{return-1;}}}
return-1;},_activateNextFieldWidget:function(record,currentIndex,options){currentIndex=(currentIndex+1)%(this.allFieldWidgets[record.id]||[]).length;return this._activateFieldWidget(record,currentIndex,_.extend({inc:1},options));},_activatePreviousFieldWidget:function(record,currentIndex){currentIndex=currentIndex?(currentIndex-1):((this.allFieldWidgets[record.id]||[]).length-1);return this._activateFieldWidget(record,currentIndex,{inc:-1});},_addFieldTooltip:function(widget,$node){$node=$node.length?$node:widget.$el;$node.tooltip({title:function(){return qweb.render('WidgetLabel.tooltip',{debug:config.isDebug(),widget:widget,});}});},_applyModifiers:function(modifiersData,record,element){var self=this;var modifiers=modifiersData.evaluatedModifiers[record.id]||{};if(element){_apply(element);}else{_.each(_.clone(modifiersData.elementsByRecord[record.id]),_apply);}
function _apply(element){if('readonly'in modifiers&&element.widget){var mode=modifiers.readonly?'readonly':modifiersData.baseModeByRecord[record.id];if(mode!==element.widget.mode){self._rerenderFieldWidget(element.widget,record,{keepBaseMode:true,mode:mode,});return;}}
element.$el.toggleClass("o_invisible_modifier",!!modifiers.invisible);element.$el.toggleClass("o_readonly_modifier",!!modifiers.readonly);element.$el.toggleClass("o_required_modifier",!!modifiers.required);if(element.widget&&element.widget.updateModifiersValue){element.widget.updateModifiersValue(modifiers);}
if(element.callback){element.callback(element,modifiers,record);}}},_canWidgetBeSaved:function(widget){var modifiers=this._getEvaluatedModifiers(widget.__node,widget.record);return widget.isValid()&&(widget.isSet()||!modifiers.required);},_destroyFieldWidget:function(recordID,widget){var recordWidgets=this.allFieldWidgets[recordID];var index=recordWidgets.indexOf(widget);if(index>=0){recordWidgets.splice(index,1);}
this._unregisterModifiersElement(widget.__node,recordID,widget);widget.destroy();return index;},_getEvaluatedModifiers:function(node,record){var element=this._getModifiersData(node);if(!element){return{};}
return element.evaluatedModifiers[record.id]||{};},_getModifiersData:function(node){return _.findWhere(this.allModifiersData,{node:node});},_getRecord:function(recordId){return null;},_handleAttributes:function($el,node){if($el.is('button')){return;}
if(node.attrs.class){$el.addClass(node.attrs.class);}
if(node.attrs.style){$el.attr('style',node.attrs.style);}
if(node.attrs.placeholder){$el.attr('placeholder',node.attrs.placeholder);}},_hasContent:function(){return this.state.count!==0;},_moveRecord:function(recordId,toIndex){var self=this;var records=this.state.data;var record=_.findWhere(records,{id:recordId});var fromIndex=records.indexOf(record);var lowerIndex=Math.min(fromIndex,toIndex);var upperIndex=Math.max(fromIndex,toIndex)+1;var order=_.findWhere(this.state.orderedBy,{name:this.handleField});var asc=!order||order.asc;var reorderAll=false;var sequence=(asc?-1:1)*Infinity;_.each(records,function(record,index){if(((index<lowerIndex||index>=upperIndex)&&((asc&&sequence>=record.data[self.handleField])||(!asc&&sequence<=record.data[self.handleField])))||(index>=lowerIndex&&index<upperIndex&&sequence===record.data[self.handleField])){reorderAll=true;}
sequence=record.data[self.handleField];});if(reorderAll){records=_.without(records,record);records.splice(toIndex,0,record);}else{records=records.slice(lowerIndex,upperIndex);records=_.without(records,record);if(fromIndex>toIndex){records.unshift(record);}else{records.push(record);}}
var sequences=_.pluck(_.pluck(records,'data'),this.handleField);var recordIds=_.pluck(records,'id');if(!asc){recordIds.reverse();}
this.trigger_up('resequence_records',{handleField:this.handleField,offset:_.min(sequences),recordIds:recordIds,});},_postProcessField:function(widget,node){this._handleAttributes(widget.$el,node);},_registerModifiers:function(node,record,element,options){options=options||{};var modifiersData=this._getModifiersData(node);if(!modifiersData){var modifiers=node.attrs.modifiers||{};modifiersData={node:node,modifiers:modifiers,evaluatedModifiers:{},elementsByRecord:{},baseModeByRecord:{},};if(!_.isEmpty(modifiers)){this.allModifiersData.push(modifiersData);}}
if(!modifiersData.baseModeByRecord[record.id]||!options.keepBaseMode){modifiersData.baseModeByRecord[record.id]=options.mode||this.mode;}
if(!modifiersData.evaluatedModifiers[record.id]){modifiersData.evaluatedModifiers[record.id]=record.evalModifiers(modifiersData.modifiers);}
if(element){var newElement={};if(element instanceof jQuery){newElement.$el=element;}else{newElement.widget=element;newElement.$el=element.$el;}
if(options&&options.callback){newElement.callback=options.callback;}
if(!modifiersData.elementsByRecord[record.id]){modifiersData.elementsByRecord[record.id]=[];}
modifiersData.elementsByRecord[record.id].push(newElement);this._applyModifiers(modifiersData,record,newElement,options);}
return modifiersData.evaluatedModifiers[record.id];},_render:function(){var oldAllFieldWidgets=this.allFieldWidgets;this.allFieldWidgets={};this.allModifiersData=[];var oldWidgets=this.widgets;this.widgets=[];return this._renderView().then(function(){_.each(oldAllFieldWidgets,function(recordWidgets){_.each(recordWidgets,function(widget){widget.destroy();});});_.invoke(oldWidgets,'destroy');});},_renderFieldWidget:function(node,record,options){options=options||{};var fieldName=node.attrs.name;var mode=options.mode||this.mode;var modifiers=this._registerModifiers(node,record,null,options);var Widget=record.fieldsInfo[this.viewType][fieldName].Widget;var widget=new Widget(this,fieldName,record,{mode:modifiers.readonly?'readonly':mode,viewType:this.viewType,});if(this.allFieldWidgets[record.id]===undefined){this.allFieldWidgets[record.id]=[];}
this.allFieldWidgets[record.id].push(widget);widget.__node=node;var def=widget._widgetRenderAndInsert(function(){});var $el=$('<div>');this.defs.push(def);var self=this;def.then(function(){widget.$el.addClass($el.attr('class'));$el.replaceWith(widget.$el);self._registerModifiers(node,record,widget,{callback:function(element,modifiers,record){element.$el.toggleClass('o_field_empty',!!(record.data.id&&(modifiers.readonly||mode==='readonly')&&!element.widget.isSet()));},keepBaseMode:!!options.keepBaseMode,mode:mode,});self._postProcessField(widget,node);});return $el;},_renderNoContentHelper:function(){var $noContent=$('<div>').html(this.noContentHelp).addClass('o_nocontent_help');return $('<div>').addClass('o_view_nocontent').append($noContent);},_renderView:function(){return Promise.resolve();},_renderWidget:function(record,node){var Widget=widgetRegistry.get(node.attrs.name);var widget=new Widget(this,record,node);this.widgets.push(widget);var def=widget._widgetRenderAndInsert(function(){});this.defs.push(def);var $el=$('<div>');var self=this;def.then(function(){self._handleAttributes(widget.$el,node);self._registerModifiers(node,record,widget);widget.$el.addClass('o_widget');$el.replaceWith(widget.$el);});return $el;},_rerenderFieldWidget:function(widget,record,options){var $el=this._renderFieldWidget(widget.__node,record,options);var recordWidgets=this.allFieldWidgets[record.id];var newWidget=recordWidgets[recordWidgets.length-1];const def=this.defs[this.defs.length-1];const $div=$('<div>');$div.append($el);def.then(()=>{widget.$el.replaceWith($div.children());recordWidgets.splice(recordWidgets.indexOf(newWidget),1);var oldIndex=this._destroyFieldWidget(record.id,widget);recordWidgets.splice(oldIndex,0,newWidget);})},_unregisterModifiersElement:function(node,recordID,element){var modifiersData=this._getModifiersData(node);if(modifiersData){var elements=modifiersData.elementsByRecord[recordID];var index=_.findIndex(elements,function(oldElement){return oldElement.widget===element||oldElement.$el[0]===element[0];});if(index>=0){elements.splice(index,1);}}},_updateAllModifiers:function(record){var self=this;var defs=[];this.defs=defs;_.each(this.allModifiersData,function(modifiersData){if(record.id in modifiersData.evaluatedModifiers){modifiersData.evaluatedModifiers[record.id]=record.evalModifiers(modifiersData.modifiers);self._applyModifiers(modifiersData,record);}});delete this.defs;return Promise.all(defs);},_onNavigationMove:function(ev){},});return BasicRenderer;});;

/* /web/static/src/js/views/control_panel/control_panel_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.ControlPanelController',function(require){"use strict";var mvc=require('web.mvc');var ControlPanelController=mvc.Controller.extend({className:'o_cp_controller',custom_events:{facet_removed:'_onFacetRemoved',get_search_query:'_onGetSearchQuery',item_option_clicked:'_onItemOptionClicked',item_trashed:'_onItemTrashed',menu_item_clicked:'_onMenuItemClicked',new_favorite:'_onNewFavorite',new_filters:'_onNewFilters',new_groupBy:'_onNewGroupBy',activate_time_range:'_onActivateTimeRange',autocompletion_filter:'_onAutoCompletionFilter',reload:'_onReload',reset:'_onReset',},init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.modelName=params.modelName;},on_attach_callback:function(){this.renderer.on_attach_callback();},on_detach_callback:function(){this.renderer.on_detach_callback();},exportState:function(){return this.model.exportState();},focusSearchBar:function(){if(this.renderer.searchBar){this.renderer.searchBar.focus();}},getSearchQuery:function(){return this.model.getQuery();},importState:function(state){var defs=[];this.model.importState(state);defs.push(this.getSearchQuery());defs.push(this.renderer.updateState(this.model.get()));return Promise.all(defs).then(function(defsResults){return defsResults[0];});},setControllerID:function(controllerID){this.controllerID=controllerID;},updateContents:function(status,options){this.renderer.updateContents(status,options);},updateFilters:function(newFilters,filtersToRemove){var newFilterIDS=this.model.createNewFilters(newFilters);this.model.deactivateFilters(filtersToRemove);this._reportNewQueryAndRender();return newFilterIDS;},_getSubMenus:function(){return this.renderer.$subMenus;},_reportNewQueryAndRender:function(){this.trigger_up('search',this.model.getQuery());var state=this.model.get();return this.renderer.updateState(state);},_onActivateTimeRange:function(ev){ev.stopPropagation();this.model.activateTimeRange(ev.data.id,ev.data.timeRangeId,ev.data.comparisonTimeRangeId);this._reportNewQueryAndRender();},_onAutoCompletionFilter:function(ev){ev.stopPropagation();this.model.toggleAutoCompletionFilter(ev.data);this._reportNewQueryAndRender();},_onFacetRemoved:function(ev){ev.stopPropagation();var group=ev.data.group||this.renderer.getLastFacet();if(group){this.model.deactivateGroup(group.id);this._reportNewQueryAndRender();}},_onGetSearchQuery:function(ev){ev.stopPropagation();var query=this.getSearchQuery();ev.data.callback(query);},_onItemOptionClicked:function(ev){ev.stopPropagation();this.model.toggleFilterWithOptions(ev.data.id,ev.data.optionId);this._reportNewQueryAndRender();},_onItemTrashed:function(ev){ev.stopPropagation();var def=this.model.deleteFilterEverywhere(ev.data.id);def.then(this._reportNewQueryAndRender.bind(this));},_onMenuItemClicked:function(ev){ev.stopPropagation();this.model.toggleFilter(ev.data.id);this._reportNewQueryAndRender();},_onNewFavorite:function(ev){ev.stopPropagation();var def=this.model.createNewFavorite(ev.data);def.then(this._reportNewQueryAndRender.bind(this));},_onNewFilters:function(ev){ev.stopPropagation();this.model.createNewFilters(ev.data.filters);this._reportNewQueryAndRender();},_onNewGroupBy:function(ev){ev.stopPropagation();this.model.createNewGroupBy(ev.data);this._reportNewQueryAndRender();},_onReload:function(ev){ev.stopPropagation();this.trigger_up('search',this.model.getQuery());},_onReset:function(ev){ev.stopPropagation();var state=this.model.get();this.renderer.updateState(state);},});return ControlPanelController;});;

/* /web/static/src/js/views/control_panel/control_panel_model.js defined in bundle 'web.assets_backend' */
odoo.define('web.ControlPanelModel',function(require){"use strict";var controlPanelViewParameters=require('web.controlPanelViewParameters');var core=require('web.core');var Domain=require('web.Domain');var mvc=require('web.mvc');var pyUtils=require('web.py_utils');var searchBarAutocompleteRegistry=require('web.search_bar_autocomplete_sources_registry');var session=require('web.session');var _t=core._t;const DEFAULT_TIMERANGE=controlPanelViewParameters.DEFAULT_TIMERANGE;let TIME_RANGE_OPTIONS=controlPanelViewParameters.TIME_RANGE_OPTIONS;let COMPARISON_TIME_RANGE_OPTIONS=controlPanelViewParameters.COMPARISON_TIME_RANGE_OPTIONS;const OPTION_GENERATORS=controlPanelViewParameters.OPTION_GENERATORS;const YEAR_OPTIONS=controlPanelViewParameters.YEAR_OPTIONS;const{rank}=controlPanelViewParameters;function isEqualTo(array1){if(array1.length===1){return array2=>array2.length===1&&array2[0]===array1[0];}else{return array2=>array2.length===2&&array2[0]===array1[0]&&array2[1]===array1[1];}}
var ControlPanelModel=mvc.Model.extend({init:function(parent,params){this._super.apply(this,arguments);TIME_RANGE_OPTIONS=TIME_RANGE_OPTIONS.map(function(option){return _.extend({},option,{description:option.description.toString()});});COMPARISON_TIME_RANGE_OPTIONS=COMPARISON_TIME_RANGE_OPTIONS.map(function(option){return _.extend({},option,{description:option.description.toString()});});this.modelName=params.modelName;this.fields=params.fields||{};this.actionId=params.actionId;this.actionContext=params.context||{};this.actionDomain=params.domain||[];this.filters={};this.groups={};this.query=[];},activateTimeRange:function(filterId,timeRangeId,comparisonTimeRangeId){var filter=this.filters[filterId];filter.timeRangeId=timeRangeId||filter.defaultTimeRangeId;filter.comparisonTimeRangeId=comparisonTimeRangeId;var group=this.groups[filter.groupId];var groupActive=group.activeFilterIds.length;if(groupActive){group.activeFilterIds=[[filterId]];}else{this.toggleFilter(filterId);}},createNewFavorite:function(newFavorite){return this._saveQuery(_.pick(newFavorite,['description','isDefault','isShared','type'])).then(function(){newFavorite.on_success();});},createNewFilters:function(newFilters){var self=this;var filterIds=[];var groupNumber=this._generateNewGroupNumber();this._createGroupOfFilters(newFilters);newFilters.forEach(function(filter){filter.groupNumber=groupNumber;self.toggleFilter(filter.id);filterIds.push(filter.id);});return filterIds;},createNewGroupBy:function(newGroupBy){var id=_.uniqueId('__filter__');newGroupBy.id=id;newGroupBy.groupId=this._getGroupIdOfType('groupBy');newGroupBy.groupNumber=this._generateNewGroupNumber();this.filters[id]=newGroupBy;if(_.contains(['date','datetime'],newGroupBy.fieldType)){this.toggleFilterWithOptions(newGroupBy.id);}else{this.toggleFilter(newGroupBy.id);}},deactivateFilters:function(filterIds){var self=this;filterIds.forEach(function(filterId){var filter=self.filters[filterId];var group=self.groups[filter.groupId];if(group.activeFilterIds.some(isEqualTo([filterId]))){self.toggleFilter(filterId);}});},deactivateGroup:function(groupId){var self=this;var group=this.groups[groupId];_.each(group.activeFilterIds,id=>{var filter=self.filters[id[0]];if(filter.autoCompleteValues){filter.autoCompleteValues=[];}
if(filter.currentOptionIds){filter.currentOptionIds.clear();}});group.activeFilterIds=[];this.query.splice(this.query.indexOf(groupId),1);},deleteFilterEverywhere:function(filterId){var self=this;var filter=this.filters[filterId];var def=this.deleteFilter(filter.serverSideId).then(function(){const groupOfFavorites=self.groups[filter.groupId];const isActive=groupOfFavorites.activeFilterIds.some(isEqualTo([filterId]));if(isActive){self.toggleFilter(filterId);}
delete self.filters[filterId];});return def;},exportState:function(){return{filters:this.filters,groups:this.groups,query:this.query,};},get:function(){var self=this;var filterFields=[];var filters=[];var groupBys=[];var timeRanges=[];var favorites=[];Object.keys(this.filters).forEach(function(filterId){var filter=_.extend({},self.filters[filterId]);if(filter.invisible){return;}
var group=self.groups[filter.groupId];filter.isActive=group.activeFilterIds.some(id=>id[0]===filterId);if(filter.type==='field'){filterFields.push(filter);}
if(filter.type==='filter'){filters.push(filter);}
if(filter.type==='groupBy'){groupBys.push(filter);}
if(filter.type==='favorite'){favorites.push(filter);}
if(filter.type==='timeRange'){timeRanges.push(filter);}});var facets=this._getFacets();favorites=_.sortBy(favorites,'groupNumber');return{facets:facets,filterFields:filterFields,filters:filters,groupBys:this.searchMenuTypes.includes('groupBy')?groupBys:[],timeRanges:timeRanges,favorites:favorites,groups:this.groups,query:_.extend([],this.query),fields:this.fields,};},getQuery:function(){var userContext=session.user_context;var context=_.extend(pyUtils.eval('contexts',this._getQueryContext(),userContext),this._getTimeRangeMenuData(true));var domain=Domain.prototype.stringToArray(this._getDomain(),userContext);if(context.timeRangeMenuData){if(typeof context.timeRangeMenuData.timeRange==='string'){context.timeRangeMenuData.timeRange=pyUtils.eval('domain',context.timeRangeMenuData.timeRange);}
if(typeof context.timeRangeMenuData.comparisonTimeRange==='string'){context.timeRangeMenuData.comparisonTimeRange=pyUtils.eval('domain',context.timeRangeMenuData.comparisonTimeRange);}}
var action_context=this.actionContext;var results=pyUtils.eval_domains_and_contexts({domains:[this.actionDomain].concat([domain]||[]),contexts:[action_context].concat(context||[]),eval_context:session.user_context,});if(results.error){throw new Error(_.str.sprintf(_t("Failed to evaluate search criterions")+": \n%s",JSON.stringify(results.error)));}
var groupBys=this._getGroupBy();var groupBy=groupBys.length?groupBys:(this.actionContext.group_by||[]);groupBy=(typeof groupBy==='string')?[groupBy]:groupBy;context=_.omit(results.context,'time_ranges');return{context:context,domain:results.domain,groupBy:this.searchMenuTypes.includes('groupBy')?groupBy:[],orderedBy:this._getOrderedBy(),};},importState:function(state){this.filters=state.filters;this.groups=state.groups;this.query=state.query;},load:function(params){var self=this;this.searchMenuTypes=params.searchMenuTypes||[];this.activateDefaultFavorite=params.activateDefaultFavorite;if(!params.withSearchBar&&params.searchMenuTypes.length===0){return Promise.resolve();}
if(params.initialState){this.importState(params.initialState);return Promise.resolve();}else{var groups=params.groups||[];groups.forEach(function(group){self._createGroupOfFilters(group);});if(this._getGroupIdOfType('groupBy')===undefined){this._createEmptyGroup('groupBy');}
this._createGroupOfTimeRanges();return Promise.all(self._loadSearchDefaults()).then(function(){return self._loadFavorites().then(function(){if(self.query.length===0){self._activateDefaultFilters();self._activateDefaultTimeRanges(params.timeRanges);}});});}},toggleAutoCompletionFilter:function(params){var filter=this.filters[params.filterId];if(filter.type==='field'){filter.autoCompleteValues=params.autoCompleteValues;filter.domain=this._getAutoCompletionFilterDomain(filter);var group=this.groups[filter.groupId];if(!group.activeFilterIds.some(isEqualTo([filter.id]))){group.activeFilterIds.push([filter.id]);this.query.push(group.id);}}else{if(filter.hasOptions){this.toggleFilterWithOptions(filter.id);}else{this.toggleFilter(filter.id);}}},toggleFilter:function(filterId){var self=this;var filter=this.filters[filterId];var group=this.groups[filter.groupId];var index=group.activeFilterIds.findIndex(isEqualTo([filterId]));var initiaLength=group.activeFilterIds.length;if(index===-1){if(filter.type==='favorite'){this.query.forEach(function(groupId){const group=self.groups[groupId];group.activeFilterIds.forEach(id=>{const filter=self.filters[id[0]];if(filter.autoCompleteValues){filter.autoCompleteValues=[];}
if(filter.currentOptionIds){filter.currentOptionIds.clear();}})
group.activeFilterIds=[];});this.query=[];}
group.activeFilterIds.push([filterId]);if(filter.type==='favorite'||initiaLength===0){this.query.push(group.id);}}else{if(filter.type==='field'&&filter.autoCompleteValues){filter.autoCompleteValues=[];}
group.activeFilterIds.splice(index,1);if(initiaLength===1){this.query.splice(this.query.indexOf(group.id),1);}}},toggleFilterWithOptions:function(filterId,optionId){const filter=this.filters[filterId];optionId=optionId||filter.defaultOptionId;const group=this.groups[filter.groupId];const selectedYears=()=>YEAR_OPTIONS.reduce((acc,y)=>{if(filter.currentOptionIds.has(y.optionId)){acc.push(y.optionId);}
return acc;},[]);const defaultYearId=(optionId)=>{const year=filter.options.find(o=>o.optionId===optionId).defaultYear;return filter.options.find(o=>o.setParam.year===year).optionId;};if(filter.type==='filter'){const alreadyActive=group.activeFilterIds.some(isEqualTo([filterId]));if(alreadyActive){if(filter.currentOptionIds.has(optionId)){filter.currentOptionIds.delete(optionId);if(!selectedYears().length){filter.currentOptionIds.clear();}
if(!filter.currentOptionIds.size){this.toggleFilter(filterId);}}else{filter.currentOptionIds.add(optionId);}}else{this.toggleFilter(filterId);filter.currentOptionIds.add(optionId);if(!selectedYears().length){filter.currentOptionIds.add(defaultYearId(optionId));}}}else if(filter.type==='groupBy'){const combinationId=[filterId,optionId];const initiaLength=group.activeFilterIds.length;const index=group.activeFilterIds.findIndex(isEqualTo(combinationId));if(index===-1){group.activeFilterIds=this._insert(group.activeFilterIds,combinationId);filter.currentOptionIds.add(optionId);if(initiaLength===0){this.query.push(group.id);}}else{group.activeFilterIds.splice(index,1);filter.currentOptionIds.delete(optionId);if(initiaLength===1){this.query.splice(this.query.indexOf(group.id),1);}}}},_activateDefaultFilters:function(){Object.values(this.filters).filter(f=>f.isDefault&&f.type!=='favorite').sort((f1,f2)=>(f1.defaultRank||100)-(f2.defaultRank||100)).forEach(f=>{if(f.hasOptions){this.toggleFilterWithOptions(f.id);}else{this.toggleFilter(f.id);}});},_activateDefaultTimeRanges:function(defaultTimeRanges){if(defaultTimeRanges){var filter=_.find(this.filters,function(filter){return filter.type==='timeRange'&&filter.fieldName===defaultTimeRanges.field;});if(filter){this.activateTimeRange(filter.id,defaultTimeRanges.range,defaultTimeRanges.comparisonRange);}}},_addNewFavorite:function(favorite){var id=_.uniqueId('__filter__');favorite.id=id;favorite.groupId=this._getGroupIdOfType('favorite');this.filters[id]=favorite;this.toggleFilter(favorite.id);},_computeDateFilterDomain:function(filter){const domains=[];const p=_.partition([...filter.currentOptionIds],optionId=>OPTION_GENERATORS.find(o=>o.optionId===optionId).groupId===1);const yearIds=p[1];const otherOptionIds=p[0];if(otherOptionIds.length===0){yearIds.forEach(yearId=>{const d=filter.basicDomains[yearId];domains.push(d.domain);});}else{otherOptionIds.forEach(optionId=>{yearIds.forEach(yearId=>{const d=filter.basicDomains[yearId+'__'+optionId];domains.push(d.domain);});});}
return pyUtils.assembleDomains(domains,'OR');},_createEmptyGroup:function(type){var id=_.uniqueId('__group__');this.groups[id]={id:id,type:type,activeFilterIds:[],};},_createGroupOfFilters:function(group){var self=this;var type;var groupId=_.uniqueId('__group__');group.forEach(function(filter){var id=_.uniqueId('__filter__');filter.id=id;filter.groupId=groupId;type=filter.type;self.filters[id]=filter;});this.groups[groupId]={id:groupId,type:type,activeFilterIds:[],};},_createGroupOfTimeRanges:function(){var self=this;var timeRanges=[];Object.keys(this.fields).forEach(function(fieldName){var field=self.fields[fieldName];var fieldType=field.type;if(_.contains(['date','datetime'],fieldType)&&field.sortable){timeRanges.push({type:'timeRange',description:field.string,fieldName:fieldName,fieldType:fieldType,timeRangeId:false,comparisonTimeRangeId:false,defaultTimeRangeId:DEFAULT_TIMERANGE,timeRangeOptions:TIME_RANGE_OPTIONS,comparisonTimeRangeOptions:COMPARISON_TIME_RANGE_OPTIONS});}});if(timeRanges.length){this._createGroupOfFilters(timeRanges);}else{this._createEmptyGroup('timeRange');}},_generateNewGroupNumber:function(){var self=this;var groupNumber=1+Object.keys(this.filters).reduce(function(max,filterId){var filter=self.filters[filterId];if(filter.groupNumber){max=Math.max(filter.groupNumber,max);}
return max;},1);return groupNumber;},_getAutoCompletionFilterDomain:function(filter){var domain="";var field=this.fields[filter.attrs.name];var Obj=searchBarAutocompleteRegistry.getAny([filter.attrs.widget,field.type]);if(Obj){var obj=new(Obj)(this,filter,field,this.actionContext);domain=obj.getDomain(filter.autoCompleteValues);}
return domain;},_getDomain:function(){var self=this;var domains=this.query.map(function(groupId){var group=self.groups[groupId];return self._getGroupDomain(group);});return pyUtils.assembleDomains(domains,'AND');},_getFacets:function(){var self=this;return this.query.map(groupId=>{var group=self.groups[groupId];var facet=_.extend({},group);if(group.type==='groupBy'){facet.filters=group.activeFilterIds.map(id=>{let filter=_.extend({},self.filters[id[0]]);if(filter.hasOptions){filter.optionId=id[1];}
return filter;});}else{facet.filters=_.compact(group.activeFilterIds.map(id=>self.filters[id[0]]));}
return facet;});},_getFilterContext:function(filter){var context=filter.context||{};if(filter.type==='field'&&filter.attrs.context){context=pyUtils.eval('context',filter.attrs.context,{self:_.map(filter.autoCompleteValues,function(autoCompleteValue){return autoCompleteValue.value;}),});}
if(filter.type==='field'&&filter.isDefault){if(this.fields[filter.attrs.name].type==='many2one'){var value=filter.defaultValue;if(_.isArray(filter.defaultValue)){value=filter.defaultValue[0];}
context['default_'+filter.attrs.name]=value;}}
return context;},_getFilterDomain:function(filter){let domain;if(filter.type==='filter'){domain=filter.domain;if(filter.hasOptions){domain=this._computeDateFilterDomain(filter);}}else if(filter.type==='favorite'){domain=filter.domain;}else if(filter.type==='field'){domain=filter.domain;}
return domain;},_getFilterGroupBys:function(filterId){var groupBys;var filter=this.filters[filterId[0]];if(filter.type==='groupBy'){var optionId=filterId[1];var groupBy=filter.fieldName;if(optionId){groupBy=groupBy+':'+optionId;}
groupBys=[groupBy];}
if(filter.type==='favorite'){groupBys=filter.groupBys;}
return groupBys;},_getGroupBy:function(){var self=this;var groupBys=this.query.reduce(function(acc,groupId){var group=self.groups[groupId];return acc.concat(self._getGroupGroupBys(group));},[]);return groupBys;},_getGroupContexts:function(group){var self=this;var contexts=group.activeFilterIds.map(function(filterId){var filter=self.filters[filterId[0]];return self._getFilterContext(filter);});return _.compact(contexts);},_getGroupDomain:function(group){var self=this;var domains=group.activeFilterIds.map(function(filterId){var filter=self.filters[filterId[0]];return self._getFilterDomain(filter);});return pyUtils.assembleDomains(_.compact(domains),'OR');},_getGroupGroupBys:function(group){var self=this;var groupBys=group.activeFilterIds.reduce(function(acc,filterId){acc=acc.concat(self._getFilterGroupBys(filterId));return acc;},[]);return _.compact(groupBys);},_getGroupIdOfType:function(type){var self=this;return _.find(Object.keys(this.groups),function(groupId){var group=self.groups[groupId];return group.type===type;});},_getOrderedBy:function(){var orderedBy;var id=this._getGroupIdOfType('favorite');if(this.query.indexOf(id)!==-1){var group=this.groups[id];var activeFavoriteId=group.activeFilterIds[0][0];var favorite=this.filters[activeFavoriteId];if(favorite.orderedBy&&favorite.orderedBy.length){orderedBy=favorite.orderedBy;}}
return orderedBy;},_getQueryContext:function(){var self=this;var contexts=this.query.reduce(function(acc,groupId){var group=self.groups[groupId];acc=acc.concat(self._getGroupContexts(group));return acc;},[]);return _.compact(contexts);},_getTimeRangeMenuData:function(evaluation){var context={};var groupOfTimeRanges=this.groups[this._getGroupIdOfType('timeRange')];if(groupOfTimeRanges&&groupOfTimeRanges.activeFilterIds.length){var filter=this.filters[groupOfTimeRanges.activeFilterIds[0][0]];var comparisonTimeRange="[]";var comparisonTimeRangeDescription;var timeRange=Domain.prototype.constructDomain(filter.fieldName,filter.timeRangeId,filter.fieldType);var timeRangeDescription=_.find(filter.timeRangeOptions,function(option){return option.optionId===filter.timeRangeId;}).description.toString();if(filter.comparisonTimeRangeId){comparisonTimeRange=Domain.prototype.constructDomain(filter.fieldName,filter.timeRangeId,filter.fieldType,filter.comparisonTimeRangeId);comparisonTimeRangeDescription=_.find(filter.comparisonTimeRangeOptions,function(comparisonOption){return comparisonOption.optionId===filter.comparisonTimeRangeId;}).description.toString();}
if(evaluation){timeRange=Domain.prototype.stringToArray(timeRange);comparisonTimeRange=Domain.prototype.stringToArray(comparisonTimeRange);}
context={timeRangeMenuData:{comparisonField:filter.fieldName,timeRange:timeRange,timeRangeDescription:timeRangeDescription,comparisonTimeRange:comparisonTimeRange,comparisonTimeRangeDescription:comparisonTimeRangeDescription,}};}
return context;},_insert(activeFilterIds,combinationId){const filterId=combinationId[0];let firstIndex=-1;let lastIndex=-1;activeFilterIds.forEach((cId,i)=>{if(cId[0]===filterId){firstIndex=firstIndex===-1?i:firstIndex;lastIndex=i;}});if(firstIndex===-1){activeFilterIds.push(combinationId);}else{const a1=activeFilterIds.slice(0,firstIndex);const a2=activeFilterIds.slice(firstIndex,lastIndex+1);const a3=activeFilterIds.slice(lastIndex+1);a2.push(combinationId);a2.sort((c1,c2)=>rank(c1[1])-rank(c2[1]));activeFilterIds=[].concat(a1,a2,a3);}
return activeFilterIds;},_loadFavorites:function(){var self=this;var def=this.loadFilters(this.modelName,this.actionId).then(function(favorites){if(favorites.length){favorites=favorites.map(function(favorite){var userId=favorite.user_id?favorite.user_id[0]:false;var groupNumber=userId?1:2;var context=pyUtils.eval('context',favorite.context,session.user_context);var groupBys=[];if(context.group_by){groupBys=context.group_by;delete context.group_by;}
var sort=JSON.parse(favorite.sort);var orderedBy=sort.map(function(order){var fieldName;var asc;var sqlNotation=order.split(' ');if(sqlNotation.length>1){fieldName=sqlNotation[0];asc=sqlNotation[1]==='asc';}else{fieldName=order[0]==='-'?order.slice(1):order;asc=order[0]==='-'?false:true;}
return{name:fieldName,asc:asc,};});return{type:'favorite',description:favorite.name,isRemovable:true,groupNumber:groupNumber,isDefault:favorite.is_default,domain:favorite.domain,groupBys:groupBys,context:context,orderedBy:orderedBy,userId:userId,serverSideId:favorite.id,};});self._createGroupOfFilters(favorites);if(self.activateDefaultFavorite){var defaultFavorite=_.find(self.filters,function(filter){return filter.type==='favorite'&&filter.isDefault;});if(defaultFavorite){self.toggleFilter(defaultFavorite.id);}}}else{self._createEmptyGroup('favorite');}});return def;},_loadSearchDefaults:function(){var self=this;var defs=[];_.each(this.filters,function(filter){if(filter.type==='field'&&filter.isDefault){var def;var field=self.fields[filter.attrs.name];var value=filter.defaultValue;if(field.type==='many2one'){if(value instanceof Array){value=value[0];}
def=self._rpc({model:field.relation,method:'name_get',args:[value],context:self.actionContext,}).then(function(result){var autocompleteValue={label:result[0][1],value:value,};filter.autoCompleteValues.push(autocompleteValue);filter.domain=self._getAutoCompletionFilterDomain(filter);});}else{var autocompleteValue;if(field.type==='selection'){var match=_.find(field.selection,function(sel){return sel[0]===value;});autocompleteValue={label:match[1],value:match[0],};}else{autocompleteValue={label:String(value),value:value,};}
filter.autoCompleteValues.push(autocompleteValue);filter.domain=self._getAutoCompletionFilterDomain(filter);}
if(def){defs.push(def);}}});return defs;},_saveQuery:function(favorite){var self=this;var userContext=session.user_context;var controllerQueryParams;this.trigger_up('get_controller_query_params',{callback:function(state){controllerQueryParams=state;},});var queryContext=this._getQueryContext();var timeRangeMenuInfo=this._getTimeRangeMenuData(false);var context=pyUtils.eval('contexts',[userContext,controllerQueryParams.context,timeRangeMenuInfo].concat(queryContext));context=_.omit(context,Object.keys(userContext));var groupBys=this._getGroupBy();if(groupBys.length){context.group_by=groupBys;}
var domain=this._getDomain();var userId=favorite.isShared?false:session.uid;var orderedBy=this._getOrderedBy()||[];if(controllerQueryParams.orderedBy){orderedBy=controllerQueryParams.orderedBy;}
var sort=orderedBy.map(function(order){return order.name+((order.asc===false)?" desc":"");});var irFilter={name:favorite.description,context:context,domain:domain,is_default:favorite.isDefault,user_id:userId,model_id:this.modelName,action_id:this.actionId,sort:JSON.stringify(sort),};return this.createFilter(irFilter).then(function(serverSideId){delete context.group_by;favorite.isRemovable=true;favorite.groupNumber=userId?1:2;favorite.context=context;favorite.groupBys=groupBys;favorite.domain=domain;favorite.orderedBy=orderedBy;favorite.userId=userId;favorite.serverSideId=serverSideId;self._addNewFavorite(favorite);});},});return ControlPanelModel;});;

/* /web/static/src/js/views/control_panel/control_panel_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.ControlPanelRenderer',function(require){"use strict";var config=require('web.config');var data=require('web.data');var FavoriteMenu=require('web.FavoriteMenu');var FilterMenu=require('web.FilterMenu');var GroupByMenu=require('web.GroupByMenu');var mvc=require('web.mvc');var SearchBar=require('web.SearchBar');var TimeRangeMenu=require('web.TimeRangeMenu');var Renderer=mvc.Renderer;var ControlPanelRenderer=Renderer.extend({template:'ControlPanel',custom_events:{get_action_info:'_onGetActionInfo',},events:_.extend({},Renderer.prototype.events,{'click .o_searchview_more':'_onMore',}),init:function(parent,state,params){this._super.apply(this,arguments);this._breadcrumbs=params.breadcrumbs||[];this._title=params.title||'';this.withBreadcrumbs=params.withBreadcrumbs;this.withSearchBar=params.withSearchBar;if(params.template){this.template=params.template;}
this.context=params.context;this.$subMenus=null;this.action=params.action;this.displaySearchMenu=true;this.isMobile=config.device.isMobile;this.menusSetup=false;this.searchMenuTypes=params.searchMenuTypes||[];this.subMenus={};},start:function(){var self=this;this.nodes={$buttons:this.$('.o_cp_buttons'),$pager:this.$('.o_cp_pager'),$sidebar:this.$('.o_cp_sidebar'),$switch_buttons:this.$('.o_cp_switch_buttons'),};if(!this.withSearchBar){this.nodes.$searchview=this.$('.o_cp_searchview');}
if(this.searchMenuTypes.length===0){this.nodes.$searchview_buttons=this.$('.o_search_options');}
if(this.withBreadcrumbs){this._renderBreadcrumbs();}
var superDef=this._super.apply(this,arguments);var searchDef=this._renderSearch();return Promise.all([superDef,searchDef]).then(function(){self._setSearchMenusVisibility();});},on_attach_callback:function(){this._focusSearchInput();},on_detach_callback:function(){},getLastFacet:function(){return this.state.facets.slice(-1)[0];},updateContents:function(status,options){var new_cp_content=status.cp_content||{};var clear='clear'in(options||{})?options.clear:true;if(this.withBreadcrumbs){this._breadcrumbs=status.breadcrumbs||this._breadcrumbs;this._title=status.title||this._title;this._renderBreadcrumbs();}
if(clear){this._detachContent(this.nodes);}else{this._detachContent(_.pick(this.nodes,_.keys(new_cp_content)));}
this._attachContent(new_cp_content);},updateState:function(state){this.state=state;return this._renderSearch();},_attachContent:function(content){for(var $element in content){var $nodeset=content[$element];if($nodeset&&this.nodes[$element]){this.nodes[$element].append($nodeset);}}},_detachContent:function(content){for(var $element in content){content[$element].contents().detach();}},_focusSearchInput:function(){if(this.withSearchBar&&!config.device.isMobileDevice){this.searchBar.focus();}},_getMenuItems:function(menuType){var menuItems;if(menuType==='filter'){menuItems=this.state.filters;}
if(menuType==='groupBy'){menuItems=this.state.groupBys;}
if(menuType==='timeRange'){menuItems=this.state.timeRanges;}
if(menuType==='favorite'){menuItems=this.state.favorites;}
return menuItems;},_getSubMenusPlace:function(){return $('<div>').appendTo(this.$('.o_search_options'));},_renderBreadcrumbs:function(){var self=this;var breadcrumbsDescriptors=this._breadcrumbs.concat({title:this._title});var breadcrumbs=breadcrumbsDescriptors.map(function(bc,index){return self._renderBreadcrumbsItem(bc,index,breadcrumbsDescriptors.length);});this.$('.breadcrumb').html(breadcrumbs);},_renderBreadcrumbsItem:function(bc,index,length){var self=this;var is_last=(index===length-1);var li_content=bc.title&&_.escape(bc.title.trim())||data.noDisplayContent;var $bc=$('<li>',{class:'breadcrumb-item'}).append(is_last?li_content:$('<a>',{href:'#'}).html(li_content)).toggleClass('active',is_last);if(!is_last){$bc.click(function(ev){ev.preventDefault();self.trigger_up('breadcrumb_clicked',{controllerID:bc.controllerID});});}
var secondLast=index===length-2;if(secondLast){$bc.attr('accessKey','b');}
return $bc;},_renderSearch:function(){var defs=[];if(this.menusSetup){this._updateMenus();}else{this.menusSetup=true;defs=defs.concat(this._setupMenus());}
if(this.withSearchBar){defs.push(this._renderSearchBar());}
return Promise.all(defs).then(this._focusSearchInput.bind(this));},_renderSearchBar:function(){var oldSearchBar=this.searchBar;this.searchBar=new SearchBar(this,{context:this.context,facets:this.state.facets,fields:this.state.fields,filterFields:this.state.filterFields,});return this.searchBar.appendTo(this.$('.o_searchview')).then(function(){if(oldSearchBar){oldSearchBar.destroy();}});},_setSearchMenusVisibility:function(){this.$('.o_searchview_more').toggleClass('fa-search-plus',!this.displaySearchMenu).toggleClass('fa-search-minus',this.displaySearchMenu);this.$('.o_search_options').toggleClass('o_hidden',!this.displaySearchMenu);},_setupMenu:function(menuType){var Menu;var menu;if(menuType==='filter'){Menu=FilterMenu;}
if(menuType==='groupBy'){Menu=GroupByMenu;}
if(menuType==='timeRange'){Menu=TimeRangeMenu;}
if(menuType==='favorite'){Menu=FavoriteMenu;}
if(_.contains(['filter','groupBy','timeRange'],menuType)){menu=new Menu(this,this._getMenuItems(menuType),this.state.fields);}
if(menuType==='favorite'){menu=new Menu(this,this._getMenuItems(menuType),this.action);}
this.subMenus[menuType]=menu;return menu.appendTo(this.$subMenus);},_setupMenus:function(){this.$subMenus=this._getSubMenusPlace();return this.searchMenuTypes.map(this._setupMenu.bind(this));},_updateMenus:function(){var self=this;this.searchMenuTypes.forEach(function(menuType){self.subMenus[menuType].update(self._getMenuItems(menuType));});},_onMore:function(){this.displaySearchMenu=!this.displaySearchMenu;this._setSearchMenusVisibility();},});return ControlPanelRenderer;});;

/* /web/static/src/js/views/control_panel/control_panel_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.ControlPanelView',function(require){"use strict";var ControlPanelController=require('web.ControlPanelController');var ControlPanelModel=require('web.ControlPanelModel');var ControlPanelRenderer=require('web.ControlPanelRenderer');var controlPanelViewParameters=require('web.controlPanelViewParameters');var mvc=require('web.mvc');var pyUtils=require('web.py_utils');var viewUtils=require('web.viewUtils');var Domain=require('web.Domain');var DEFAULT_INTERVAL=controlPanelViewParameters.DEFAULT_INTERVAL;var DEFAULT_PERIOD=controlPanelViewParameters.DEFAULT_PERIOD;var INTERVAL_OPTIONS=controlPanelViewParameters.INTERVAL_OPTIONS;const OPTION_GENERATORS=controlPanelViewParameters.OPTION_GENERATORS;var Factory=mvc.Factory;var ControlPanelView=Factory.extend({config:_.extend({},Factory.prototype.config,{Controller:ControlPanelController,Model:ControlPanelModel,Renderer:ControlPanelRenderer,}),init:function(params){var self=this;this._super();params=params||{};var viewInfo=params.viewInfo||{arch:'<search/>',fields:{}};var context=_.extend({},params.context);var domain=params.domain||[];var action=params.action||{};this.searchDefaults={};Object.keys(context).forEach(function(key){var match=/^search_default_(.*)$/.exec(key);if(match){self.searchDefaults[match[1]]=context[key];delete context[key];}});this.arch=viewUtils.parseArch(viewInfo.arch);this.fields=viewInfo.fields;this.referenceMoment=moment();const setDescriptions=(options)=>{return options.map(o=>{const oClone=JSON.parse(JSON.stringify(o));const description=o.description?o.description.toString():this.referenceMoment.clone().add(o.addParam).format(o.format);return _.extend(oClone,{description:description});});};const process=(options)=>{return options.map(o=>{const date=this.referenceMoment.clone().set(o.setParam).add(o.addParam);delete o.addParam;o.setParam[o.granularity]=date[o.granularity]();o.defaultYear=date.year();return o;});}
this.optionGenerators=process(setDescriptions(OPTION_GENERATORS));this.intervalOptions=setDescriptions(INTERVAL_OPTIONS);this.controllerParams.modelName=params.modelName;this.modelParams.context=context;this.modelParams.domain=domain;this.modelParams.modelName=params.modelName;this.modelParams.actionId=action.id;this.modelParams.fields=this.fields;this.rendererParams.action=action;this.rendererParams.breadcrumbs=params.breadcrumbs;this.rendererParams.context=context;this.rendererParams.searchMenuTypes=params.searchMenuTypes||[];this.rendererParams.template=params.template;this.rendererParams.title=params.title;this.rendererParams.withBreadcrumbs=params.withBreadcrumbs!==false;this.rendererParams.withSearchBar='withSearchBar'in params?params.withSearchBar:true;this.loadParams.withSearchBar='withSearchBar'in params?params.withSearchBar:true;this.loadParams.searchMenuTypes=params.searchMenuTypes||[];this.loadParams.activateDefaultFavorite=params.activateDefaultFavorite;if(this.loadParams.withSearchBar){if(params.state){this.loadParams.initialState=params.state;}else{this.loadParams.groups=[];this.loadParams.timeRanges=context.time_ranges;this._parseSearchArch(this.arch);}}
if(params.dynamicFilters&&params.dynamicFilters.length){var dynamicFiltersGroup=params.dynamicFilters.map(function(filter){return{description:filter.description,domain:JSON.stringify(filter.domain),isDefault:true,type:'filter',};});this.loadParams.groups.unshift(dynamicFiltersGroup);}},_evalArchChild:function(child){if(child.attrs.context){try{var context=pyUtils.eval('context',child.attrs.context);if(context.group_by){child.tag='groupBy';child.attrs.fieldName=context.group_by.split(':')[0];child.attrs.defaultInterval=context.group_by.split(':')[1];}}catch(e){}}
return child;},_extractAttributes:function(filter,attrs){filter.isDefault=this.searchDefaults[attrs.name]?true:false;filter.description=attrs.string||attrs.help||attrs.name||attrs.domain||'Ω';if(filter.type==='filter'){if(filter.isDefault){filter.defaultRank=-5;}
filter.domain=attrs.domain;filter.context=pyUtils.eval('context',attrs.context);if(attrs.date){filter.fieldName=attrs.date;filter.fieldType=this.fields[attrs.date].type;filter.hasOptions=true;filter.options=this.optionGenerators;filter.defaultOptionId=attrs.default_period||DEFAULT_PERIOD;filter.currentOptionIds=new Set();filter.basicDomains=this._getDateFilterBasicDomains(filter);}}else if(filter.type==='groupBy'){if(filter.isDefault){const val=this.searchDefaults[attrs.name];filter.defaultRank=typeof val==='number'?val:100;}
filter.fieldName=attrs.fieldName;filter.fieldType=this.fields[attrs.fieldName].type;if(_.contains(['date','datetime'],filter.fieldType)){filter.hasOptions=true;filter.options=this.intervalOptions;filter.defaultOptionId=attrs.defaultInterval||DEFAULT_INTERVAL;filter.currentOptionIds=new Set();}}else if(filter.type==='field'){if(filter.isDefault){filter.defaultRank=-10;}
var field=this.fields[attrs.name];filter.attrs=attrs;filter.autoCompleteValues=[];if(filter.isDefault){filter.defaultValue=this.searchDefaults[filter.attrs.name];}
if(!attrs.string){attrs.string=field.string;}}},_getDateFilterBasicDomains:function(filter){const _constructBasicDomain=(y,o)=>{const setParam=Object.assign({},y.setParam,o?o.setParam:{});const granularity=o?o.granularity:y.granularity;const date=this.referenceMoment.clone().set(setParam);let leftBound=date.clone().startOf(granularity).locale('en');let rightBound=date.clone().endOf(granularity).locale('en');if(filter.fieldType==='date'){leftBound=leftBound.format("YYYY-MM-DD");rightBound=rightBound.format("YYYY-MM-DD");}else{leftBound=leftBound.utc().format("YYYY-MM-DD HH:mm:ss");rightBound=rightBound.utc().format("YYYY-MM-DD HH:mm:ss");}
const domain=Domain.prototype.arrayToString(['&',[filter.fieldName,">=",leftBound],[filter.fieldName,"<=",rightBound]]);let description;if(o){description=o.description+" "+y.description;}else{description=y.description;}
return{domain,description};};const domains={};this.optionGenerators.filter(y=>y.groupId===2).forEach(y=>{domains[y.optionId]=_constructBasicDomain(y);this.optionGenerators.filter(y=>y.groupId===1).forEach(o=>{domains[y.optionId+"__"+o.optionId]=_constructBasicDomain(y,o);});});return domains;},_parseSearchArch:function(arch){var self=this;var children=arch.children.filter(function(child){return child.tag!=='searchpanel';});var preFilters=_.flatten(children.map(function(child){return child.tag!=='group'?self._evalArchChild(child):child.children.map(self._evalArchChild);}));preFilters.push({tag:'separator'});var filter;var currentTag;var currentGroup=[];var groupOfGroupBys=[];var groupNumber=1;_.each(preFilters,function(preFilter){if(preFilter.tag!==currentTag||_.contains(['separator','field'],preFilter.tag)){if(currentGroup.length){if(currentTag==='groupBy'){groupOfGroupBys=groupOfGroupBys.concat(currentGroup);}else{self.loadParams.groups.push(currentGroup);}}
currentTag=preFilter.tag;currentGroup=[];groupNumber++;}
if(preFilter.tag!=='separator'){filter={type:preFilter.tag,};if(filter.type==='filter'||filter.type==='groupBy'){filter.groupNumber=groupNumber;}
if(preFilter.attrs&&JSON.parse(preFilter.attrs.modifiers||'{}').invisible){filter.invisible=true;var preFilterFieldName=null;if(preFilter.tag=='filter'&&preFilter.attrs.date){preFilterFieldName=preFilter.attrs.date;}else if(preFilter.tag=='groupBy'){preFilterFieldName=preFilter.attrs.fieldName;}
if(preFilterFieldName&&!self.fields[preFilterFieldName]){return;}}
self._extractAttributes(filter,preFilter.attrs);currentGroup.push(filter);}});if(groupOfGroupBys.length){this.loadParams.groups.push(groupOfGroupBys);}},});return ControlPanelView;});;

/* /web/static/src/js/views/control_panel/mobile_control_panel_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.MobileControlPanelController',function(require){"use strict";var config=require('web.config');var ControlPanelController=require('web.ControlPanelController');if(!config.device.isMobile){return;}
ControlPanelController.include({custom_events:_.extend({},ControlPanelController.prototype.custom_events,{'search_bar_cleared':'_onSearchBarCleared',}),_onSearchBarCleared:function(){var self=this;this.model.get().query.forEach(function(groupId){self.model.deactivateGroup(groupId);});this._reportNewQueryAndRender();},});});;

/* /web/static/src/js/views/control_panel/mobile_control_panel_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.MobileControlPanelRenderer',function(require){"use strict";var config=require('web.config');var ControlPanelRenderer=require('web.ControlPanelRenderer');if(!config.device.isMobile){return;}
ControlPanelRenderer.include({events:_.extend({},ControlPanelRenderer.prototype.events,{'click .o_mobile_search_close, .o_mobile_search_show_result, .o_toggle_searchview_full':'_toggleMobileSearchView','click .o_enable_searchview':'_toggleMobileQuickSearchView','click .o_toggle_searchview_full':'_onOpenMobileSearchView','click .o_mobile_search_clear_facets':'_onEmptyAll','show.bs.dropdown .o_mobile_search_filter .o_dropdown':'_onDropdownToggle','hide.bs.dropdown .o_mobile_search_filter .o_dropdown':'_onDropdownToggle',}),_getSubMenusPlace:function(){return this.$('.o_mobile_search_filter');},_render:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.$('.o_mobile_search_clear_facets').toggleClass('o_hidden',!self.state.query.length);});},_renderSearchBar:async function(){await this._super.apply(this,arguments);this._renderSearchviewInput();if(!this.withBreadcrumbs){this._mobileQuickSearchView();}},_renderSearchviewInput:function(){if(!this.withBreadcrumbs||(!this.$('.o_toggle_searchview_full').hasClass('o_hidden')&&this.$('.o_mobile_search').hasClass('o_hidden'))){this.$('.o_toggle_searchview_full').toggleClass('btn-secondary',!!this.state.query.length);this.searchBar.$el.detach().insertAfter(this.$('.o_mobile_search'));}else{this.searchBar.$el.detach().insertAfter(this.$('.o_mobile_search_header'));}},_toggleMobileSearchView:function(){this.$('.o_mobile_search').toggleClass('o_hidden');this._renderSearchviewInput();},_mobileQuickSearchView(){this.$('.o_cp_searchview').addClass('o_searchview_quick');this.$('.breadcrumb').addClass('o_hidden');this.$('.o_toggle_searchview_full').removeClass('o_hidden').toggleClass('btn-secondary',!!this.state.query.length);this._renderSearchviewInput();this.$('.o_enable_searchview').hide();},_toggleMobileQuickSearchView:function(){this.$('.o_cp_searchview').toggleClass('o_searchview_quick');this.$('.breadcrumb').toggleClass('o_hidden',this.$('.o_cp_searchview').hasClass('o_searchview_quick'));this.$('.o_toggle_searchview_full').toggleClass('o_hidden').toggleClass('btn-secondary',!!this.state.query.length);this._renderSearchviewInput();this.$('.o_enable_searchview').toggleClass("fa-search").toggleClass("fa-arrow-left")},_onDropdownToggle:function(ev){$(ev.currentTarget).find('.fa-chevron-right').toggleClass('fa-chevron-down');},_onEmptyAll:function(){this.trigger_up('search_bar_cleared');},_onOpenMobileSearchView:function(ev){if(ev.target===this.el){this._toggleMobileSearchView();}},});});;

/* /web/static/src/js/views/control_panel/search/search_bar_autocomplete_sources.js defined in bundle 'web.assets_backend' */
odoo.define('web.SearchBarAutoCompleteSources',function(require){"use strict";var Class=require('web.Class');var core=require('web.core');var Domain=require('web.Domain');var field_utils=require('web.field_utils');var mixins=require('web.mixins');var pyUtils=require('web.py_utils');var ServicesMixin=require('web.ServicesMixin');var time=require('web.time');var _t=core._t;var _lt=core._lt;var FilterInterface=Class.extend(mixins.EventDispatcherMixin,{completion_label:_lt("%s"),init:function(parent,filter){mixins.EventDispatcherMixin.init.call(this);this.setParent(parent);this.filter=filter;},getAutocompletionValues:function(value){var result;value=value.toLowerCase();if(fuzzy.test(value,this.filter.description)){result=[{label:_.str.sprintf(this.completion_label.toString(),_.escape(this.filter.description)),facet:{filter:this.filter,},}];}
return Promise.resolve(result);},});var Filter=FilterInterface.extend({completion_label:_lt("Filter on: %s"),});var GroupBy=FilterInterface.extend({completion_label:_lt("Group by: %s"),});var Field=FilterInterface.extend(ServicesMixin,{default_operator:'=',init:function(parent,filter,field,context){this._super.apply(this,arguments);this.field=field;this.filter=filter;this.attrs=_.extend({},field,filter.attrs);this.context=context;},getAutocompletionValues:function(value){return Promise.resolve([{label:this._getAutocompletionLabel(value),facet:this._getFacetValue(value),}]);},getDomain:function(values){if(!values.length){return;}
var valueToDomain;var self=this;var domain=this.attrs.filter_domain;if(domain){valueToDomain=function(facetValue){return Domain.prototype.stringToArray(domain,{self:self._valueFrom(facetValue),raw_value:facetValue.value,});};}else{valueToDomain=function(facetValue){return self._makeDomain(self.attrs.name,self.attrs.operator||self.default_operator,facetValue);};}
var domains=values.map(valueToDomain);domains=domains.map(Domain.prototype.arrayToString);return pyUtils.assembleDomains(domains,'OR');},_getAutocompletionLabel:function(value){return _.str.sprintf(_.str.escapeHTML(_t("Search %(field)s for: %(value)s")),{field:'<em>'+_.escape(this.attrs.string)+'</em>',value:'<strong>'+_.escape(value)+'</strong>'});},_getFacetValue:function(value){return{filter:this.filter,values:[{label:value,value:value}],};},_makeDomain:function(name,operator,facet){return[[name,operator,this._valueFrom(facet)]];},_valueFrom:function(facetValue){return facetValue.value;},});var CharField=Field.extend({default_operator:'ilike',getAutocompletionValues:function(value){if(_.isEmpty(value)){return Promise.resolve(null);}
return this._super.apply(this,arguments);},});var NumberField=Field.extend({getAutocompletionValues:function(value){var val=this.parse(value);if(isNaN(val)){return Promise.resolve();}
return this._super.apply(this,arguments);},_valueFrom:function(facetValue){return this.parse(facetValue.value);},});var IntegerField=NumberField.extend({error_message:_t("not a valid integer"),parse:function(value){try{return field_utils.parse.integer(value);}catch(e){return NaN;}},});var FloatField=NumberField.extend({error_message:_t("not a valid number"),parse:function(value){try{return field_utils.parse.float(value);}catch(e){return NaN;}},});var SelectionField=Field.extend({getAutocompletionValues:function(value){var self=this;var results=_(this.attrs.selection).chain().filter(function(sel){var selValue=sel[0],label=sel[1];if(selValue===undefined||!label){return false;}
return label.toLowerCase().indexOf(value.toLowerCase())!==-1;}).map(function(sel){return{label:_.escape(sel[1]),indent:true,facet:self._getFacetValue(sel)};}).value();if(_.isEmpty(results)){return Promise.resolve(null);}
return Promise.resolve([{label:_.escape(this.attrs.string)}].concat(results));},_getFacetValue:function(value){return{filter:this.filter,values:[{label:value[1],value:value[0]}],};},});var BooleanField=SelectionField.extend({init:function(){this._super.apply(this,arguments);this.attrs.selection=[[true,_t("Yes")],[false,_t("No")]];},});var DateField=Field.extend({getAutocompletionValues:function(value){var t,v;try{t=(this.attrs&&this.attrs.type==='datetime')?'datetime':'date';v=field_utils.parse[t](value,{type:t},{timezone:true});}catch(e){return Promise.resolve(null);}
var m=moment(t==='datetime'?v:v.toJSON(),t==='datetime'?'YYYY-MM-DD HH:mm:ss':'YYYY-MM-DD');if(!m.isValid()){return Promise.resolve(null);}
var dateString=field_utils.format[t](m,{type:t});var label=this._getAutocompletionLabel(dateString);var facet=this._getFacetValue(dateString,m.toDate());return Promise.resolve([{label:label,facet:facet,}]);},_getAutocompletionLabel:function(value){return _.str.sprintf(_.str.escapeHTML(_t("Search %(field)s at: %(value)s")),{field:'<em>'+_.escape(this.attrs.string)+'</em>',value:'<strong>'+value+'</strong>'});},_getFacetValue:function(value,rawValue){var facet=this._super.apply(this,arguments);facet.values[0].value=rawValue;return facet;},_valueFrom:function(facetValue){return time.date_to_str(facetValue.value);},});var DateTimeField=DateField.extend({_valueFrom:function(facetValue){return time.datetime_to_str(facetValue.value);},});var ManyToOneField=CharField.extend({default_operator:{},getAutocompletionValues:function(value){if(_.isEmpty(value)){return Promise.resolve(null);}
var label=this._getAutocompletionLabel(value);return Promise.resolve([{label:label,facet:this._getFacetValue(value),expand:this._expand.bind(this),}]);},_getExpandedFacetValue:function(value){return{filter:this.filter,values:[{label:value[1],value:value[0]}],};},_getFacetValue:function(value){return{filter:this.filter,values:[{label:value,value:value,operator:'ilike'}],};},_expand:function(value){var self=this;var args=this.attrs.domain;if(typeof args==='string'){try{args=Domain.prototype.stringToArray(args);}catch(e){args=[];}}
return this._rpc({model:this.attrs.relation,method:'name_search',kwargs:{name:value,args:args,limit:8,context:this.context,},}).then(function(results){if(_.isEmpty(results)){return null;}
return _(results).map(function(result){return{label:_.escape(result[1]),facet:self._getExpandedFacetValue(result)};});});},_makeDomain:function(name,operator,facetValue){operator=facetValue.operator||operator;switch(operator){case this.default_operator:return[[name,'=',facetValue.value]];case'ilike':return[[name,'ilike',facetValue.value]];case'child_of':return[[name,'child_of',facetValue.value]];}
return this._super(name,operator,facetValue);},_valueFrom:function(facetValue){return facetValue.label;},});return{BooleanField:BooleanField,CharField:CharField,DateField:DateField,DateTimeField:DateTimeField,Field:Field,Filter:Filter,FloatField:FloatField,GroupBy:GroupBy,IntegerField:IntegerField,ManyToOneField:ManyToOneField,NumberField:NumberField,SelectionField:SelectionField,};});;

/* /web/static/src/js/views/control_panel/search/search_bar_autocomplete_sources_registry.js defined in bundle 'web.assets_backend' */
odoo.define('web.search_bar_autocomplete_sources_registry',function(require){"use strict";var Registry=require('web.Registry');return new Registry();});odoo.define('web._search_bar_autocomplete_sources_registry',function(require){"use strict";var registry=require('web.search_bar_autocomplete_sources_registry');var SearchBarAutoCompleteSources=require('web.SearchBarAutoCompleteSources');registry.add('char',SearchBarAutoCompleteSources.CharField).add('text',SearchBarAutoCompleteSources.CharField).add('html',SearchBarAutoCompleteSources.CharField).add('boolean',SearchBarAutoCompleteSources.BooleanField).add('integer',SearchBarAutoCompleteSources.IntegerField).add('id',SearchBarAutoCompleteSources.IntegerField).add('float',SearchBarAutoCompleteSources.FloatField).add('monetary',SearchBarAutoCompleteSources.FloatField).add('selection',SearchBarAutoCompleteSources.SelectionField).add('datetime',SearchBarAutoCompleteSources.DateTimeField).add('date',SearchBarAutoCompleteSources.DateField).add('many2one',SearchBarAutoCompleteSources.ManyToOneField).add('many2many',SearchBarAutoCompleteSources.CharField).add('one2many',SearchBarAutoCompleteSources.CharField);registry.add('filter',SearchBarAutoCompleteSources.Filter);registry.add('groupby',SearchBarAutoCompleteSources.GroupBy);});;

/* /web/static/src/js/views/control_panel/search/search_facet.js defined in bundle 'web.assets_backend' */
odoo.define('web.SearchFacet',function(require){"use strict";var core=require('web.core');var Widget=require('web.Widget');var _t=core._t;var SearchFacet=Widget.extend({template:'SearchView.SearchFacet',events:_.extend({},Widget.prototype.events,{'click .o_facet_remove':'_onFacetRemove','compositionend':'_onCompositionend','compositionstart':'_onCompositionstart','keydown':'_onKeydown',}),init:function(parent,facet){this._super.apply(this,arguments);var self=this;this.facet=facet;this.facetValues=_.map(this.facet.filters,function(filter){return self._getFilterDescription(filter);});this.separator=this._getSeparator();this.icon=this._getIcon();this._isComposing=false;},_getFilterDescription:function(filter){if(filter.type==='field'){var values=_.pluck(filter.autoCompleteValues,'label');return values.join(_t(' or '));}
var description=filter.description;if(filter.hasOptions){if(filter.type==='filter'){const optionDescriptions=[];const sortFunction=(o1,o2)=>filter.options.findIndex(o=>o.optionId===o1)-filter.options.findIndex(o=>o.optionId===o2);const p=_.partition([...filter.currentOptionIds],optionId=>filter.options.find(o=>o.optionId===optionId).groupId===1);const yearIds=p[1].sort(sortFunction);const otherOptionIds=p[0].sort(sortFunction);if(otherOptionIds.length===0){yearIds.forEach(yearId=>{const d=filter.basicDomains[yearId];optionDescriptions.push(d.description);});}else{otherOptionIds.forEach(optionId=>{yearIds.forEach(yearId=>{const d=filter.basicDomains[yearId+'__'+optionId];optionDescriptions.push(d.description);});});}
description+=': '+optionDescriptions.join('/');}else{description=description+=': '+
filter.options.find(o=>o.optionId===filter.optionId).description;}}
if(filter.type==='timeRange'){var timeRangeValue=_.findWhere(filter.timeRangeOptions,{optionId:filter.timeRangeId,});description+=': '+timeRangeValue.description;if(filter.comparisonTimeRangeId){var comparisonTimeRangeValue=_.findWhere(filter.comparisonTimeRangeOptions,{optionId:filter.comparisonTimeRangeId,});description+=' / '+comparisonTimeRangeValue.description;}}
return description;},_getIcon:function(){var icon;if(this.facet.type==='filter'){icon='fa-filter';}else if(this.facet.type==='groupBy'){icon='fa-bars';}else if(this.facet.type==='favorite'){icon='fa-star';}else if(this.facet.type==='timeRange'){icon='fa-calendar';}
return icon;},_getSeparator:function(){var separator;if(this.facet.type==='filter'){separator=_t('or');}else if(this.facet.type==='field'){separator=_t('or');}else if(this.facet.type==='groupBy'){separator='>';}
return separator;},_onCompositionend:function(ev){this._isComposing=false;},_onCompositionstart:function(ev){this._isComposing=true;},_onFacetRemove:function(){this.trigger_up('facet_removed',{group:this.facet});},_onKeydown:function(ev){if(this._isComposing){return;}
switch(ev.which){case $.ui.keyCode.BACKSPACE:this.trigger_up('facet_removed',{group:this.facet});break;}},});return SearchFacet;});;

/* /web/static/src/js/views/control_panel/search/search_bar.js defined in bundle 'web.assets_backend' */
odoo.define('web.SearchBar',function(require){"use strict";var AutoComplete=require('web.AutoComplete');var searchBarAutocompleteRegistry=require('web.search_bar_autocomplete_sources_registry');var SearchFacet=require('web.SearchFacet');var Widget=require('web.Widget');var SearchBar=Widget.extend({template:'SearchView.SearchBar',events:_.extend({},Widget.prototype.events,{'compositionend .o_searchview_input':'_onCompositionendInput','compositionstart .o_searchview_input':'_onCompositionstartInput','keydown':'_onKeydown',}),init:function(parent,params){this._super.apply(this,arguments);this.context=params.context;this.facets=params.facets;this.fields=params.fields;this.filterFields=params.filterFields;this.autoCompleteSources=[];this.searchFacets=[];this._isInputComposing=false;},start:function(){this.$input=this.$('input');var self=this;var defs=[this._super.apply(this,arguments)];_.each(this.facets,function(facet){defs.push(self._renderFacet(facet));});defs.push(this._setupAutoCompletion());return Promise.all(defs);},focus:function(){this.$input.focus();},_focusFollowing:function(){var focusedIndex=this._getFocusedFacetIndex();var $toFocus;if(focusedIndex===this.searchFacets.length-1){$toFocus=this.$input;}else{$toFocus=this.searchFacets.length&&this.searchFacets[focusedIndex+1].$el;}
if($toFocus.length){$toFocus.focus();}},_focusPreceding:function(){var focusedIndex=this._getFocusedFacetIndex();var $toFocus;if(focusedIndex===-1){$toFocus=this.searchFacets.length&&_.last(this.searchFacets).$el;}else if(focusedIndex===0){$toFocus=this.$input;}else{$toFocus=this.searchFacets.length&&this.searchFacets[focusedIndex-1].$el;}
if($toFocus.length){$toFocus.focus();}},_getFocusedFacetIndex:function(){return _.findIndex(this.searchFacets,function(searchFacet){return searchFacet.$el[0]===document.activeElement;});},_getAutoCompleteSources:function(req,callback){var defs=this.autoCompleteSources.map(function(source){return source.getAutocompletionValues(req.term);});Promise.all(defs).then(function(result){var resultCleaned=_(result).chain().compact().flatten(true).value();callback(resultCleaned);});},_renderFacet:function(facet){var searchFacet=new SearchFacet(this,facet);this.searchFacets.push(searchFacet);return searchFacet.insertBefore(this.$('input'));},_setupAutoCompletion:function(){var self=this;this._setupAutoCompletionWidgets();this.autoComplete=new AutoComplete(this,{$input:this.$('input'),source:this._getAutoCompleteSources.bind(this),select:this._onAutoCompleteSelected.bind(this),get_search_string:function(){return self.$input.val().trim();},});return this.autoComplete.appendTo(this.$el);},_setupAutoCompletionWidgets:function(){var self=this;var registry=searchBarAutocompleteRegistry;_.each(this.filterFields,function(filter){var field=self.fields[filter.attrs.name];var Obj=registry.getAny([filter.attrs.widget,field.type]);if(Obj){self.autoCompleteSources.push(new(Obj)(self,filter,field,self.context));}});},_onAutoCompleteSelected:function(e,ui){e.preventDefault();var facet=ui.item.facet;if(!facet){this.trigger_up('reset');return;}
var filter=facet.filter;if(filter.type==='field'){var values=filter.autoCompleteValues;values.push(facet.values[0]);this.trigger_up('autocompletion_filter',{filterId:filter.id,autoCompleteValues:values,});}else{this.trigger_up('autocompletion_filter',{filterId:filter.id,});}},_onCompositionendInput:function(){this._isInputComposing=false;},_onCompositionstartInput:function(){this._isInputComposing=true;},_onKeydown:function(e){if(this._isInputComposing){return;}
switch(e.which){case $.ui.keyCode.LEFT:this._focusPreceding();e.preventDefault();break;case $.ui.keyCode.RIGHT:this._focusFollowing();e.preventDefault();break;case $.ui.keyCode.DOWN:const $dropdown=this.$('.o_searchview_autocomplete:visible');if(!$dropdown.length){this.trigger_up('navigation_move',{direction:'down'});e.preventDefault();}
break;case $.ui.keyCode.BACKSPACE:if(this.$input.val()===''){this.trigger_up('facet_removed');}
break;case $.ui.keyCode.ENTER:if(this.$input.val()===''){this.trigger_up('reload');}
break;}},});return SearchBar;});;

/* /web/static/src/js/views/control_panel/search/filter_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.FilterMenu',function(require){"use strict";var config=require('web.config');var core=require('web.core');var Domain=require('web.Domain');var DropdownMenu=require('web.DropdownMenu');var search_filters=require('web.search_filters');var _t=core._t;var QWeb=core.qweb;var FilterMenu=DropdownMenu.extend({custom_events:{confirm_proposition:'_onConfirmProposition',remove_proposition:'_onRemoveProposition',},events:_.extend({},DropdownMenu.prototype.events,{'click .o_add_custom_filter':'_onAddCustomFilterClick','click .o_add_condition':'_onAddCondition','click .o_apply_filter':'_onApplyClick',}),init:function(parent,filters,fields){this._super(parent,filters);this.isMobile=config.device.isMobile;this.generatorMenuIsOpen=false;this.propositions=[];this.fields=_.pick(fields,function(field,name){return field.selectable!==false&&name!=='id';});this.fields.id={string:'ID',type:'id',searchable:true};this.dropdownCategory='filter';this.dropdownTitle=_t('Filters');this.dropdownIcon='fa fa-filter';this.dropdownSymbol=this.isMobile?'fa fa-chevron-right float-right mt4':false;this.dropdownStyle.mainButton.class='o_filters_menu_button '+
this.dropdownStyle.mainButton.class;},start:function(){var superProm=this._super.apply(this,arguments);this.$menu.addClass('o_filters_menu');this._renderGeneratorMenu();return superProm;},_appendProposition:function(){var prop=new search_filters.ExtendedSearchProposition(this,this.fields);this.propositions.push(prop);this.$('.o_apply_filter').prop('disabled',false);return prop.insertBefore(this.$addFilterMenu);},_commitSearch:function(){var filters=_.invoke(this.propositions,'get_filter').map(function(preFilter){return{type:'filter',description:preFilter.attrs.string,domain:Domain.prototype.arrayToString(preFilter.attrs.domain),};});this.trigger_up('new_filters',{filters:filters});_.invoke(this.propositions,'destroy');this.propositions=[];this._toggleCustomFilterMenu();},_renderGeneratorMenu:function(){this.$el.find('.o_generator_menu').remove();if(!this.generatorMenuIsOpen){_.invoke(this.propositions,'destroy');this.propositions=[];}
var $generatorMenu=QWeb.render('FilterMenuGenerator',{widget:this});this.$menu.append($generatorMenu);this.$addFilterMenu=this.$menu.find('.o_add_filter_menu');if(this.generatorMenuIsOpen&&!this.propositions.length){this._appendProposition();}
this.$dropdownReference.dropdown('update');},_toggleCustomFilterMenu:function(){this.generatorMenuIsOpen=!this.generatorMenuIsOpen;this._renderGeneratorMenu();},_onAddCondition:function(ev){ev.stopPropagation();this._appendProposition();},_onAddCustomFilterClick:function(ev){ev.preventDefault();ev.stopPropagation();this._toggleCustomFilterMenu();},_onApplyClick:function(ev){ev.stopPropagation();this._commitSearch();},_onBootstrapClose:function(){this._super.apply(this,arguments);this.generatorMenuIsOpen=false;this._renderGeneratorMenu();},_onConfirmProposition:function(ev){ev.stopPropagation();this._commitSearch();},_onRemoveProposition:function(ev){ev.stopPropagation();this.propositions=_.without(this.propositions,ev.target);if(!this.propositions.length){this.$('.o_apply_filter').prop('disabled',true);}
ev.target.destroy();},});return FilterMenu;});;

/* /web/static/src/js/views/control_panel/search/groupby_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.GroupByMenu',function(require){"use strict";var config=require('web.config');var controlPanelViewParameters=require('web.controlPanelViewParameters');var core=require('web.core');var DropdownMenu=require('web.DropdownMenu');var _t=core._t;var QWeb=core.qweb;var DEFAULT_INTERVAL=controlPanelViewParameters.DEFAULT_INTERVAL;var GROUPABLE_TYPES=controlPanelViewParameters.GROUPABLE_TYPES;var INTERVAL_OPTIONS=controlPanelViewParameters.INTERVAL_OPTIONS;var GroupByMenu=DropdownMenu.extend({events:_.extend({},DropdownMenu.prototype.events,{'click .o_add_custom_group':'_onAddCustomGroupClick','click button.o_apply_group':'_onButtonApplyClick','click .o_group_selector':'_onGroupSelectorClick',}),init:function(parent,groupBys,fields,options){var self=this;options=options||{};this._super(parent,groupBys);this.fields=fields;this.generatorMenuIsOpen=false;this.groupableFields=[];_.each(fields,function(field,name){if(field.sortable&&name!=="id"&&_.contains(GROUPABLE_TYPES,field.type)){self.groupableFields.push(_.extend({},field,{name:name,}));}});this.groupableFields=_.sortBy(this.groupableFields,'string');this.presentedFields=this._setPresentedFields(groupBys);this.isMobile=config.device.isMobile;this.dropdownCategory='groupby';this.dropdownTitle=_t('Group By');this.dropdownIcon='fa fa-bars';this.dropdownSymbol=this.isMobile&&!options.noSymbol?'fa fa-chevron-right float-right mt4':false;if(options.headerStyle==='primary'){this.dropdownStyle={el:{class:'btn-group o_group_by_menu o_dropdown',attrs:{'role':'group'}},mainButton:{class:'btn btn-primary dropdown-toggle'},};}
INTERVAL_OPTIONS=INTERVAL_OPTIONS.map(function(option){return _.extend(option,{description:option.description.toString()});});},start:function(){var superProm=this._super.apply(this,arguments);this.$menu.addClass('o_group_by_menu');this._renderGeneratorMenu();return superProm;},update:function(groupBys){this._super.apply(this,arguments);this.presentedFields=this._setPresentedFields(groupBys);this._renderGeneratorMenu();},_addGroupby:function(fieldName){var field=this.presentedFields.find(function(field){return field.name===fieldName;});var groupBy={type:'groupBy',description:field.string,fieldName:fieldName,fieldType:field.type,};if(_.contains(['date','datetime'],field.type)){groupBy.hasOptions=true;groupBy.options=INTERVAL_OPTIONS;groupBy.defaultOptionId=DEFAULT_INTERVAL;groupBy.currentOptionIds=new Set([]);}
this.trigger_up('new_groupBy',groupBy);},_renderGeneratorMenu:function(){this.$el.find('.o_generator_menu').remove();var $generatorMenu=QWeb.render('GroupByMenuGenerator',{widget:this});this.$menu.append($generatorMenu);this.$addCustomGroup=this.$menu.find('.o_add_custom_group');this.$groupSelector=this.$menu.find('.o_group_selector');this.$dropdownReference.dropdown('update');},_setPresentedFields:function(groupBys){return this.groupableFields.filter(function(field){var groupByFields=_.pluck(groupBys,'fieldName');return!_.contains(groupByFields,field.name);});},_toggleCustomGroupMenu:function(){this.generatorMenuIsOpen=!this.generatorMenuIsOpen;this._renderGeneratorMenu();if(this.generatorMenuIsOpen){this.$groupSelector.focus();}},_onAddCustomGroupClick:function(ev){ev.preventDefault();ev.stopPropagation();this._toggleCustomGroupMenu();},_onBootstrapClose:function(){this._super.apply(this,arguments);this.generatorMenuIsOpen=false;this._renderGeneratorMenu();},_onButtonApplyClick:function(ev){ev.stopPropagation();var fieldName=this.$groupSelector.val();this.generatorMenuIsOpen=false;this._addGroupby(fieldName);},_onGroupSelectorClick:function(ev){ev.stopPropagation();},});return GroupByMenu;});;

/* /web/static/src/js/views/control_panel/search/groupby_menu_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('web.GroupByMenuMixin',function(require){"use strict";var GroupByMenu=require('web.GroupByMenu');var controlPanelViewParameters=require('web.controlPanelViewParameters');var GroupByMenuMixin={init:function(){this.custom_events=_.extend({},this.custom_events,{menu_item_clicked:'_onMenuItemClicked',item_option_clicked:'_onItemOptionClicked',});},_addGroupByMenu:function($node,groupableFields){this.sortedFieldNames=Object.keys(groupableFields).sort();this.groupableFields=groupableFields;const groupBys=this._getGroupBys(this.model.get().groupBy);this.groupByMenu=new GroupByMenu(this,groupBys,this.groupableFields,{noSymbol:true});return this.groupByMenu.insertAfter($node.find('div:first'));},_normalizeActiveGroupBys:function(activeGroupBys){return activeGroupBys.map(gb=>{const fieldName=gb.split(':')[0];const field=this.groupableFields[fieldName];const ngb={fieldName:fieldName};if(_.contains(['date','datetime'],field.type)){ngb.interval=gb.split(':')[1]||controlPanelViewParameters.DEFAULT_INTERVAL;}
return ngb;});},_setGroupby:function(groupBys){},_getGroupBys:function(activeGroupBys){const groupBysNormalized=this._normalizeActiveGroupBys(activeGroupBys);return this.sortedFieldNames.map(fieldName=>{const field=this.groupableFields[fieldName];const groupByActivity=groupBysNormalized.filter(gb=>(gb.fieldName===fieldName));const groupBy={id:fieldName,isActive:groupByActivity.length?true:false,description:field.string,};if(_.contains(['date','datetime'],field.type)){groupBy.hasOptions=true;groupBy.options=controlPanelViewParameters.INTERVAL_OPTIONS;groupBy.currentOptionIds=groupByActivity.length?new Set(groupByActivity.map(gb=>gb.interval)):new Set([]);}
return groupBy;});},_onItemOptionClicked:function(ev){const fieldName=ev.data.id;const optionId=ev.data.optionId;const activeGroupBys=this.model.get().groupBy;const groupBysNormalized=this._normalizeActiveGroupBys(activeGroupBys);const index=groupBysNormalized.findIndex(ngb=>ngb.fieldName===fieldName&&ngb.interval===optionId);if(index===-1){activeGroupBys.push(fieldName+':'+optionId);}else{activeGroupBys.splice(index,1);}
this._setGroupby(activeGroupBys);this.groupByMenu.update(this._getGroupBys(activeGroupBys));},_onMenuItemClicked:function(ev){const fieldName=ev.data.id;const activeGroupBys=this.model.get().groupBy;const groupByFieldNames=activeGroupBys.map(gb=>gb.split(':')[0]);const indexOfGroupby=groupByFieldNames.indexOf(fieldName);if(indexOfGroupby===-1){activeGroupBys.push(fieldName);}else{activeGroupBys.splice(indexOfGroupby,1);}
this._setGroupby(activeGroupBys);this.groupByMenu.update(this._getGroupBys(activeGroupBys));},};return GroupByMenuMixin;});;

/* /web/static/src/js/views/control_panel/search/time_range_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.TimeRangeMenu',function(require){"use strict";var config=require('web.config');var controlPanelViewParameters=require('web.controlPanelViewParameters');var Widget=require('web.Widget');var COMPARISON_TIME_RANGE_OPTIONS=controlPanelViewParameters.COMPARISON_TIME_RANGE_OPTIONS;var PERIOD_OPTIONS=controlPanelViewParameters.PERIOD_OPTIONS;var TimeRangeMenu=Widget.extend({template:'web.TimeRangeMenu',events:{'click .o_apply_range':'_onApplyButtonClick','click .o_comparison_checkbox':'_onCheckBoxClick',},init:function(parent,timeRanges){this._super.apply(this,arguments);this.isMobile=config.device.isMobile;this.symbol=this.isMobile?'fa fa-chevron-right float-right mt4':'caret';this.periodOptions=PERIOD_OPTIONS;this.comparisonTimeRangeOptions=COMPARISON_TIME_RANGE_OPTIONS;this.periodGroups=_.uniq(PERIOD_OPTIONS.map(function(option){return option.groupId;}));this.timeRanges=timeRanges;this.configuration={comparisonIsSelected:false,comparisonTimeRangeId:false,id:false,timeRangeId:false,};this._configure();},update:function(timeRanges){this.timeRanges=timeRanges;this._configure();this.renderElement();},_configure:function(){this.configuration=this.timeRanges.find(function(timeRange){return timeRange.isActive;})||this.configuration;this.configuration.comparisonIsSelected=!!this.configuration.comparisonTimeRangeId;},_onApplyButtonClick:function(){var id=this.$('.o_date_field_selector').val();var timeRangeId=this.$('.o_time_range_selector').val();var comparisonTimeRangeId=false;if(this.configuration.comparisonIsSelected){comparisonTimeRangeId=this.$('.o_comparison_time_range_selector').val();}
this.trigger_up('activate_time_range',{id:id,timeRangeId:timeRangeId,comparisonTimeRangeId:comparisonTimeRangeId});},_onCheckBoxClick:function(ev){ev.stopPropagation();this.configuration.comparisonIsSelected=this.$('.o_comparison_checkbox').prop('checked');this.$('.o_comparison_time_range_selector').toggleClass('o_hidden');this.$el.addClass('open');}});return TimeRangeMenu;});;

/* /web/static/src/js/views/control_panel/search/favorite_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.FavoriteMenu',function(require){"use strict";var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var DropdownMenu=require('web.DropdownMenu');var favorites_submenus_registry=require('web.favorites_submenus_registry');var _t=core._t;var FavoriteMenu=DropdownMenu.extend({custom_events:_.extend({},DropdownMenu.prototype.custom_events,{favorite_submenu_toggled:'_onSubMenuToggled',}),init:function(parent,favorites,action){this._super(parent,favorites);this.action=action;this.isMobile=config.device.isMobile;this.dropdownCategory='favorite';this.dropdownTitle=_t('Favorites');this.dropdownIcon='fa fa-star';this.dropdownSymbol=this.isMobile?'fa fa-chevron-right float-right mt4':false;this.dropdownStyle.mainButton.class='o_favorites_menu_button '+
this.dropdownStyle.mainButton.class;},start:function(){var self=this;var params={favorites:this.items,action:this.action,};var superProm=this._super.apply(this,arguments);this.$menu.addClass('o_favorites_menu');this.subMenus=[];favorites_submenus_registry.values().forEach(function(SubMenu){var subMenu=new SubMenu(self,params);subMenu.appendTo(self.$menu);self.subMenus.push(subMenu);});return superProm;},update:function(items){this._super.apply(this,arguments);_.invoke(this.subMenus,'update',{favorites:this.items});},_closeSubMenus:function(){_.invoke(this.subMenus,'closeMenu');},_onBootstrapClose:function(){this._super.apply(this,arguments);this._closeSubMenus();},_onSubMenuToggled:function(ev){ev.stopPropagation();this.$dropdownReference.dropdown('update');},_onTrashButtonClick:function(event){event.preventDefault();event.stopPropagation();var self=this;var id=$(event.currentTarget).data('id');var favorite=this.items.find(function(favorite){return favorite.id===id;});var globalWarning=_t("This filter is global and will be removed for everybody if you continue.");var warning=_t("Are you sure that you want to remove this filter?");var message=favorite.userId?warning:globalWarning;Dialog.confirm(self,message,{title:_t("Warning"),confirm_callback:function(){self.trigger_up('item_trashed',{id:id});},});},});return FavoriteMenu;});;

/* /web/static/src/js/views/control_panel/search/add_new_favorite_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.AddNewFavoriteMenu',function(require){"use strict";var core=require('web.core');var favoritesSubmenusRegistry=require('web.favorites_submenus_registry');var Widget=require('web.Widget');var _t=core._t;var AddNewFavoriteMenu=Widget.extend({template:'AddNewFavoriteMenu',events:_.extend({},Widget.prototype.events,{'click .o_save_favorite':'_onSaveFavoriteClick','click .o_add_favorite.o_menu_header':'_onMenuHeaderClick','click input[type="checkbox"]':'_onCheckboxClick','keyup .o_save_name input':'_onKeyUp',}),init:function(parent,params){this._super(parent);this.favorites=params.favorites;this.action=params.action;this.isOpen=false;},start:function(){this._render();return this._super.apply(this,arguments);},update:function(params){this.favorites=params.favorites;},closeMenu:function(){this.isOpen=false;this._render();},_render:function(){this.renderElement();if(this.isOpen){var $input=this.$('.o_favorite_name input.o_input');$input.val(this.action.name);$input.focus();}},_saveFavorite:function(){var self=this;var $inputs=this.$('input');var description=$inputs[0].value;var isDefault=$inputs[1].checked;var isShared=$inputs[2].checked;if(!description.length){this.do_warn(_t("Error"),_t("A name for your favorite is required."));$inputs[0].focus();return;}
var descriptionAlreadyExists=!!this.favorites.find(function(favorite){return favorite.description===description;});if(descriptionAlreadyExists){this.do_warn(_t("Error"),_t("Filter with same name already exists."));$inputs[0].focus();return;}
this.trigger_up('new_favorite',{type:'favorite',description:description,isDefault:isDefault,isShared:isShared,on_success:function(){self.generatorMenuIsOpen=false;},});this.closeMenu();},_toggleMenu:function(){this.isOpen=!this.isOpen;this._render();this.trigger_up('favorite_submenu_toggled');},_onCheckboxClick:function(ev){function mutuallyExclusive(elem){if(!elem.id)return false;return['use_by_default','share_all_users'].some(function(str){return elem.id.indexOf(str);});}
var $checkboxes=this.$('input[type="checkbox"]');var currentCheckBox=ev.target;if(mutuallyExclusive(currentCheckBox)){for(var i=0;i<$checkboxes.length;i++){var checkbox=$checkboxes[i];if(checkbox!==currentCheckBox&&mutuallyExclusive(checkbox)){checkbox.checked=false;}}}},_onKeyUp:function(ev){if(ev.which===$.ui.keyCode.ENTER){this._saveFavorite();}},_onMenuHeaderClick:function(ev){ev.preventDefault();ev.stopPropagation();this._toggleMenu();},_onSaveFavoriteClick:function(ev){ev.stopPropagation();this._saveFavorite();},});favoritesSubmenusRegistry.add('add_new_favorite_menu',AddNewFavoriteMenu,0);return AddNewFavoriteMenu;});;

/* /web/static/src/js/views/control_panel/search/control_panel_view_parameters.js defined in bundle 'web.assets_backend' */
odoo.define('web.controlPanelViewParameters',function(require){"use strict";var core=require('web.core');var _lt=core._lt;const DEFAULT_PERIOD='this_month';const PERIOD_OPTIONS=[{description:_lt('Last 7 Days'),optionId:'last_7_days',groupId:1},{description:_lt('Last 30 Days'),optionId:'last_30_days',groupId:1},{description:_lt('Last 365 Days'),optionId:'last_365_days',groupId:1},{description:_lt('Last 5 Years'),optionId:'last_5_years',groupId:1},{description:_lt('Today'),optionId:'today',groupId:2},{description:_lt('This Week'),optionId:'this_week',groupId:2},{description:_lt('This Month'),optionId:'this_month',groupId:2},{description:_lt('This Quarter'),optionId:'this_quarter',groupId:2},{description:_lt('This Year'),optionId:'this_year',groupId:2},{description:_lt('Yesterday'),optionId:'yesterday',groupId:3},{description:_lt('Last Week'),optionId:'last_week',groupId:3},{description:_lt('Last Month'),optionId:'last_month',groupId:3},{description:_lt('Last Quarter'),optionId:'last_quarter',groupId:3},{description:_lt('Last Year'),optionId:'last_year',groupId:3},];const MONTH_OPTIONS=[{optionId:'this_month',groupId:1,format:'MMMM',addParam:{},setParam:{},granularity:'month'},{optionId:'last_month',groupId:1,format:'MMMM',addParam:{months:-1},setParam:{},granularity:'month'},{optionId:'antepenultimate_month',groupId:1,format:'MMMM',addParam:{months:-2},setParam:{},granularity:'month'}]
const QUARTER_OPTIONS=[{optionId:'fourth_quarter',groupId:1,description:_lt("Q4"),addParam:{},setParam:{quarter:4},granularity:'quarter'},{optionId:'third_quarter',groupId:1,description:_lt("Q3"),addParam:{},setParam:{quarter:3},granularity:'quarter'},{optionId:'second_quarter',groupId:1,description:_lt("Q2"),addParam:{},setParam:{quarter:2},granularity:'quarter'},{optionId:'first_quarter',groupId:1,description:_lt("Q1"),addParam:{},setParam:{quarter:1},granularity:'quarter'}]
const YEAR_OPTIONS=[{optionId:'this_year',groupId:2,format:'YYYY',addParam:{},setParam:{},granularity:'year'},{optionId:'last_year',groupId:2,format:'YYYY',addParam:{years:-1},setParam:{},granularity:'year'},{optionId:'antepenultimate_year',groupId:2,format:'YYYY',addParam:{years:-2},setParam:{},granularity:'year'},];const OPTION_GENERATORS=[...MONTH_OPTIONS,...QUARTER_OPTIONS,...YEAR_OPTIONS];const GROUPABLE_TYPES=['many2one','char','boolean','selection','date','datetime','integer'];const DEFAULT_INTERVAL='month';const INTERVAL_OPTIONS=[{description:_lt('Year'),optionId:'year',groupId:1},{description:_lt('Quarter'),optionId:'quarter',groupId:1},{description:_lt('Month'),optionId:'month',groupId:1},{description:_lt('Week'),optionId:'week',groupId:1},{description:_lt('Day'),optionId:'day',groupId:1},];function rank(oId){return INTERVAL_OPTIONS.findIndex(o=>o.optionId===oId);}
const DEFAULT_TIMERANGE=DEFAULT_PERIOD;const TIME_RANGE_OPTIONS=PERIOD_OPTIONS;const COMPARISON_TIME_RANGE_OPTIONS=[{description:_lt('Previous Period'),optionId:'previous_period'},{description:_lt('Previous Year'),optionId:'previous_year'}];return{COMPARISON_TIME_RANGE_OPTIONS:COMPARISON_TIME_RANGE_OPTIONS,DEFAULT_INTERVAL:DEFAULT_INTERVAL,DEFAULT_PERIOD:DEFAULT_PERIOD,DEFAULT_TIMERANGE:DEFAULT_TIMERANGE,GROUPABLE_TYPES:GROUPABLE_TYPES,INTERVAL_OPTIONS:INTERVAL_OPTIONS,OPTION_GENERATORS:OPTION_GENERATORS,PERIOD_OPTIONS:PERIOD_OPTIONS,TIME_RANGE_OPTIONS:TIME_RANGE_OPTIONS,YEAR_OPTIONS:YEAR_OPTIONS,rank:rank,};});;

/* /web/static/src/js/views/control_panel/search/favorites_submenus_registry.js defined in bundle 'web.assets_backend' */
odoo.define('web.favorites_submenus_registry',function(require){"use strict";var Registry=require('web.Registry');return new Registry();});;

/* /web/static/src/js/views/control_panel/search/search_filters.js defined in bundle 'web.assets_backend' */
odoo.define('web.search_filters',function(require){"use strict";var core=require('web.core');var datepicker=require('web.datepicker');var field_utils=require('web.field_utils');var search_filters_registry=require('web.search_filters_registry');var Widget=require('web.Widget');var _t=core._t;var _lt=core._lt;var ExtendedSearchProposition=Widget.extend({template:'SearchView.extended_search.proposition',events:{'change .o_searchview_extended_prop_field':'changed','change .o_searchview_extended_prop_op':'operator_changed','click .o_searchview_extended_delete_prop':function(e){e.stopPropagation();this.trigger_up('remove_proposition');},'keyup .o_searchview_extended_prop_value':function(ev){if(ev.which===$.ui.keyCode.ENTER){this.trigger_up('confirm_proposition');}},},init:function(parent,fields){this._super(parent);this.fields=_(fields).chain().map(function(val,key){return _.extend({},val,{'name':key});}).filter(function(field){return!field.deprecated&&field.searchable;}).sortBy(function(field){return field.string;}).value();this.attrs={_:_,fields:this.fields,selected:null};this.value=null;},start:function(){var parent=this._super();parent.then(this.proxy('changed'));return parent;},changed:function(){var nval=this.$(".o_searchview_extended_prop_field").val();if(this.attrs.selected===null||this.attrs.selected===undefined||nval!==this.attrs.selected.name){this.select_field(_.detect(this.fields,function(x){return x.name===nval;}));}},operator_changed:function(e){this.value.show_inputs($(e.target));},select_field:function(field){var self=this;if(this.attrs.selected!==null&&this.attrs.selected!==undefined){this.value.destroy();this.value=null;this.$('.o_searchview_extended_prop_op').html('');}
this.attrs.selected=field;if(field===null||field===undefined){return;}
var type=field.type;var Field=search_filters_registry.getAny([type,"char"]);this.value=new Field(this,field);_.each(this.value.operators,function(operator){$('<option>',{value:operator.value}).text(String(operator.text)).appendTo(self.$('.o_searchview_extended_prop_op'));});var $value_loc=this.$('.o_searchview_extended_prop_value').show().empty();this.value.appendTo($value_loc);},get_filter:function(){if(this.attrs.selected===null||this.attrs.selected===undefined){return null;}
var field=this.attrs.selected,op_select=this.$('.o_searchview_extended_prop_op')[0],operator=op_select.options[op_select.selectedIndex];return{attrs:{domain:this.value.get_domain(field,operator),string:this.value.get_label(field,operator),},children:[],tag:'filter',};},});var Field=Widget.extend({init:function(parent,field){this._super(parent);this.field=field;},get_label:function(field,operator){var format;switch(operator.value){case'∃':case'∄':format=_t('%(field)s %(operator)s');break;default:format=_t('%(field)s %(operator)s "%(value)s"');break;}
return this.format_label(format,field,operator);},format_label:function(format,field,operator){return _.str.sprintf(format,{field:field.string,operator:operator.label||operator.text,value:this});},get_domain:function(field,operator){switch(operator.value){case'∃':return[[field.name,'!=',false]];case'∄':return[[field.name,'=',false]];default:return[[field.name,operator.value,this.get_value()]];}},show_inputs:function($operator){var $value=this.$el.parent();switch($operator.val()){case'∃':case'∄':$value.hide();break;default:$value.show();}},toString:function(){return this.get_value();}});var Char=Field.extend({tagName:'input',className:'o_input',attributes:{type:'text'},operators:[{value:"ilike",text:_lt("contains")},{value:"not ilike",text:_lt("doesn't contain")},{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],get_value:function(){return this.$el.val();}});var DateTime=Field.extend({tagName:'span',serverFormat:'YYYY-MM-DD HH:mm:ss',attributes:{type:'datetime'},operators:[{value:"between",text:_lt("is between")},{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:">",text:_lt("is after")},{value:"<",text:_lt("is before")},{value:">=",text:_lt("is after or equal to")},{value:"<=",text:_lt("is before or equal to")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],get_value:function(index){if(!this["datewidget_"+(index||0)].getValue()){return false;}
var value=this["datewidget_"+(index||0)].getValue().clone();return value.add(-this.getSession().getTZOffset(value),'minutes');},get_domain:function(field,operator){switch(operator.value){case'∃':return[[field.name,'!=',false]];case'∄':return[[field.name,'=',false]];case'between':return[[field.name,'>=',this._formatMomentToServer(this.get_value(0))],[field.name,'<=',this._formatMomentToServer(this.get_value(1))]];default:return[[field.name,operator.value,this._formatMomentToServer(this.get_value())]];}},show_inputs:function($operator){this._super.apply(this,arguments);if($operator.val()==="between"){this.datewidget_1.do_show();}else{this.datewidget_1.do_hide();}},toString:function(){var str=field_utils.format[this.attributes.type](this.get_value(),{type:this.attributes.type});var date_1_value=this.datewidget_1&&!this.datewidget_1.$el.hasClass('o_hidden')&&this.get_value(1);if(date_1_value){str+=_lt(" and ")+field_utils.format[this.attributes.type](date_1_value,{type:this.attributes.type});}
return str;},start:function(){return Promise.all([this._super.apply(this,arguments),this._create_new_widget("datewidget_0",'00:00:00','hh:mm:ss'),this._create_new_widget("datewidget_1",'23:59:59','hh:mm:ss'),]).then(()=>{if(this.operators[0].value!=="between"){this.datewidget_1.do_hide();}});},_create_new_widget:function(name,...time){this[name]=new(this._get_widget_class())(this);return this[name].appendTo(this.$el).then((function(){this[name].setValue(moment(...time));}).bind(this));},_get_widget_class:function(){return datepicker.DateTimeWidget;},_formatMomentToServer:function(momentValue){if(!momentValue){return false;}
return momentValue.locale('en').format(this.serverFormat);},});var Date=DateTime.extend({serverFormat:'YYYY-MM-DD',attributes:{type:'date'},operators:[{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:">",text:_lt("is after")},{value:"<",text:_lt("is before")},{value:">=",text:_lt("is after or equal to")},{value:"<=",text:_lt("is before or equal to")},{value:"between",text:_lt("is between")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],get_value:function(index){var value=this["datewidget_"+(index||0)].getValue();return value&&value.clone();},_get_widget_class:function(){return datepicker.DateWidget;},});var Integer=Field.extend({tagName:'input',className:'o_input',attributes:{type:'number',value:'0',},operators:[{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:">",text:_lt("greater than")},{value:"<",text:_lt("less than")},{value:">=",text:_lt("greater than or equal to")},{value:"<=",text:_lt("less than or equal to")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],toString:function(){return this.$el.val();},get_value:function(){try{var val=this.$el.val();return field_utils.parse.integer(val===""?0:val);}catch(e){return"";}}});var Id=Integer.extend({operators:[{value:"=",text:_lt("is")},{value:"<=",text:_lt("less than or equal to")},{value:">",text:_lt("greater than")}]});var Float=Field.extend({template:'SearchView.extended_search.proposition.float',operators:[{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:">",text:_lt("greater than")},{value:"<",text:_lt("less than")},{value:">=",text:_lt("greater than or equal to")},{value:"<=",text:_lt("less than or equal to")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],init:function(parent){this._super(parent);this.decimal_point=_t.database.parameters.decimal_point;},toString:function(){return this.$el.val();},get_value:function(){try{var val=this.$el.val();return field_utils.parse.float(val===""?0.0:val);}catch(e){return"";}}});var Selection=Field.extend({template:'SearchView.extended_search.proposition.selection',operators:[{value:"=",text:_lt("is")},{value:"!=",text:_lt("is not")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],toString:function(){var select=this.$el[0];var option=select.options[select.selectedIndex];return option.label||option.text;},get_value:function(){return this.$el.val();}});var Boolean=Field.extend({tagName:'span',operators:[{value:"=",text:_lt("is true")},{value:"!=",text:_lt("is false")}],get_label:function(field,operator){return this.format_label(_t('%(field)s %(operator)s'),field,operator);},get_value:function(){return true;}});return{Boolean:Boolean,Char:Char,Date:Date,DateTime:DateTime,ExtendedSearchProposition:ExtendedSearchProposition,Field:Field,Float:Float,Id:Id,Integer:Integer,Selection:Selection,};});;

/* /web/static/src/js/views/control_panel/search/search_filters_registry.js defined in bundle 'web.assets_backend' */
odoo.define('web.search_filters_registry',function(require){"use strict";var Registry=require('web.Registry');return new Registry();});odoo.define('web._search_filters_registry',function(require){"use strict";var registry=require('web.search_filters_registry');var search_filters=require('web.search_filters');registry.add('boolean',search_filters.Boolean).add('char',search_filters.Char).add('date',search_filters.Date).add('datetime',search_filters.DateTime).add('float',search_filters.Float).add('id',search_filters.Id).add('integer',search_filters.Integer).add('many2many',search_filters.Char).add('many2one',search_filters.Char).add('monetary',search_filters.Float).add('one2many',search_filters.Char).add('text',search_filters.Char).add('selection',search_filters.Selection);});;

/* /web/static/src/js/views/search_panel.js defined in bundle 'web.assets_backend' */
odoo.define('web.SearchPanel',function(require){"use strict";var core=require('web.core');var Domain=require('web.Domain');var pyUtils=require('web.py_utils');var viewUtils=require('web.viewUtils');var Widget=require('web.Widget');var qweb=core.qweb;var defaultViewTypes=['kanban','tree'];const SEARCH_PANEL_LIMIT=200;function _processSearchPanelNode(node,fields){var sections={};node.children.forEach((childNode,index)=>{if(childNode.tag!=='field'){return;}
if(childNode.attrs.invisible==="1"){return;}
var fieldName=childNode.attrs.name;var type=childNode.attrs.select==='multi'?'filter':'category';var sectionId=_.uniqueId('section_');var section={color:childNode.attrs.color,description:childNode.attrs.string||fields[fieldName].string,fieldName:fieldName,icon:childNode.attrs.icon,id:sectionId,index:index,type:type,};if(section.type==='category'){section.icon=section.icon||'fa-folder';}else if(section.type==='filter'){section.disableCounters=!!pyUtils.py_eval(childNode.attrs.disable_counters||'0');section.domain=childNode.attrs.domain||'[]';section.groupBy=childNode.attrs.groupby;section.icon=section.icon||'fa-filter';}
sections[sectionId]=section;});return sections;}
var SearchPanel=Widget.extend({className:'o_search_panel',events:{'click .o_search_panel_category_value header':'_onCategoryValueClicked','click .o_search_panel_category_value .o_toggle_fold':'_onToggleFoldCategory','click .o_search_panel_filter_group .o_toggle_fold':'_onToggleFoldFilterGroup','change .o_search_panel_filter_value > div > input':'_onFilterValueChanged','change .o_search_panel_filter_group > div > input':'_onFilterGroupChanged',},init:function(parent,params){this._super.apply(this,arguments);this.categories=_.pick(params.sections,function(section){return section.type==='category';});this.filters=_.pick(params.sections,function(section){return section.type==='filter';});this.initialState=params.state;this.scrollTop=this.initialState&&this.initialState.scrollTop||null;this.defaultValues=params.defaultValues||{};if(params.defaultNoFilter){Object.keys(this.categories).forEach((categoryId)=>{var fieldName=this.categories[categoryId].fieldName;this.defaultValues[fieldName]=this.defaultValues[fieldName]||false;});}
this.fields=params.fields;this.model=params.model;this.className=params.classes.concat(['o_search_panel']).join(' ');this.searchDomain=params.searchDomain;this.viewDomain=params.viewDomain;},willStart:function(){var self=this;var loadCategoriesProm;if(this.initialState){this.filters=this.initialState.filters;this.categories=this.initialState.categories;}else{loadCategoriesProm=this._fetchCategories().then(function(){return self._fetchFilters().then(self._applyDefaultFilterValues.bind(self));});}
return Promise.all([loadCategoriesProm,this._super.apply(this,arguments)]);},start:function(){this._render();return this._super.apply(this,arguments);},on_attach_callback:function(){if(this.scrollTop!==null){this.el.scrollTop=this.scrollTop;}},computeSearchPanelParams:function(viewInfo,viewType){var searchPanelSections;var classes;if(viewInfo){var arch=viewUtils.parseArch(viewInfo.arch);viewType=viewType==='list'?'tree':viewType;arch.children.forEach(function(node){if(node.tag==='searchpanel'){var attrs=node.attrs;var viewTypes=defaultViewTypes;if(attrs.view_types){viewTypes=attrs.view_types.split(',');}
if(attrs.class){classes=attrs.class.split(' ');}
if(viewTypes.indexOf(viewType)!==-1){searchPanelSections=_processSearchPanelNode(node,viewInfo.fields);}}});}
return{sections:searchPanelSections,classes:classes,};},exportState:function(){return{categories:this.categories,filters:this.filters,scrollTop:this.el?this.el.scrollTop:null,};},getDomain:function(){return this._getCategoryDomain().concat(this._getFilterDomain());},importState:function(state){this.categories=state.categories||this.categories;this.filters=state.filters||this.filters;this.scrollTop=state.scrollTop;this._render();},update:function(params){const currentDomain=JSON.stringify([...this.searchDomain,...this.viewDomain]);const newDomain=JSON.stringify([...params.searchDomain,...params.viewDomain]);var filtersProm;if(this.needReload||(currentDomain!==newDomain)){this.needReload=false;this.searchDomain=params.searchDomain;this.viewDomain=params.viewDomain;filtersProm=this._fetchFilters();}
return Promise.resolve(filtersProm).then(this._render.bind(this));},_applyDefaultFilterValues:function(){var self=this;Object.keys(this.filters).forEach(function(filterId){var filter=self.filters[filterId];var defaultValues=self.defaultValues[filter.fieldName]||[];defaultValues.forEach(function(value){if(filter.values[value]){filter.values[value].checked=true;}});Object.keys(filter.groups||[]).forEach(function(groupId){self._updateFilterGroupState(filter.groups[groupId]);});});},_createCategoryTree:function(categoryId,values){var category=this.categories[categoryId];let parentField=category.parentField;if(values.length===SEARCH_PANEL_LIMIT){category.limitAttained=true;if(parentField){parentField=false;}}
category.values={};_.each(values,function(value){category.values[value.id]=_.extend({},value,{childrenIds:[],folded:true,parentId:value[parentField]&&value[parentField][0]||false,});});_.map(values,function(value){var value=category.values[value.id];var parentCategoryId=value.parentId;if(parentCategoryId&&parentCategoryId in category.values){category.values[parentCategoryId].childrenIds.push(value.id);}});category.rootIds=_.filter(_.map(values,function(value){return value.id;}),function(valueId){var value=category.values[valueId];return value.parentId===false;});var validValues=_.pluck(category.values,'id').concat([false]);var value=this._getCategoryDefaultValue(category,validValues);category.activeValueId=_.contains(validValues,value)?value:false;if(category.activeValueId){var parentValueIds=this._getAncestorValueIds(category,category.activeValueId);parentValueIds.forEach(function(parentValue){category.values[parentValue].folded=false;});}},_createFilterTree:function(filterId,values){var filter=this.filters[filterId];if(values.length===SEARCH_PANEL_LIMIT){filter.limitAttained=true;}
values.forEach(function(value){var oldValue=filter.values&&filter.values[value.id];value.checked=oldValue&&oldValue.checked||false;});filter.values={};var groupIds=[];if(filter.groupBy){var groups={};values.forEach(function(value){var groupId=JSON.stringify(value.group_id);if(!groups[groupId]){if(groupId!=='false'){groupIds.push(groupId);}
groups[groupId]={folded:false,id:groupId,name:value.group_name,values:{},tooltip:value.group_tooltip,sequence:value.group_sequence,hex_color:value.group_hex_color,sortedValueIds:[],};var oldGroup=filter.groups&&filter.groups[groupId];groups[groupId].state=oldGroup&&oldGroup.state||false;groups[groupId].folded=oldGroup&&oldGroup.folded||false;}
groups[groupId].values[value.id]=value;groups[groupId].sortedValueIds.push(value.id);});filter.groups=groups;filter.sortedGroupIds=_.sortBy(groupIds,function(groupId){return groups[groupId].sequence||groups[groupId].name;});Object.keys(filter.groups).forEach(function(groupId){filter.values=_.extend(filter.values,filter.groups[groupId].values);});}else{values.forEach(function(value){filter.values[value.id]=value;});filter.sortedValueIds=values.map(function(value){return value.id;});}},_fetchCategories:function(){var self=this;var proms=Object.keys(this.categories).map(function(categoryId){var category=self.categories[categoryId];var field=self.fields[category.fieldName];var categoriesProm;if(field.type==='selection'){var values=field.selection.map(function(value){return{id:value[0],display_name:value[1]};});categoriesProm=Promise.resolve(values);}else{categoriesProm=self._rpc({method:'search_panel_select_range',model:self.model,args:[category.fieldName],}).then(function(result){category.parentField=result.parent_field;return result.values;});}
return categoriesProm.then(function(values){self._createCategoryTree(categoryId,values);});});return Promise.all(proms);},_fetchFilters:function(){var self=this;var evalContext={};Object.keys(this.categories).forEach(function(categoryId){var category=self.categories[categoryId];evalContext[category.fieldName]=category.activeValueId;});var categoryDomain=this._getCategoryDomain();var filterDomain=this._getFilterDomain();var proms=Object.keys(this.filters).map(function(filterId){var filter=self.filters[filterId];return self._rpc({method:'search_panel_select_multi_range',model:self.model,args:[filter.fieldName],kwargs:{category_domain:categoryDomain,comodel_domain:Domain.prototype.stringToArray(filter.domain,evalContext),disable_counters:filter.disableCounters,filter_domain:filterDomain,group_by:filter.groupBy||false,search_domain:[...self.searchDomain,...self.viewDomain],},}).then(function(values){self._createFilterTree(filterId,values);});});return Promise.all(proms);},_getCategoryDefaultValue:function(category,validValues){var value=this.defaultValues[category.fieldName];if(!_.contains(validValues,value)){var storageKey=this._getLocalStorageKey(category);return this.call('local_storage','getItem',storageKey);}
return value;},_getCategoryDomain:function(){var self=this;function categoryToDomain(domain,categoryId){var category=self.categories[categoryId];if(category.activeValueId){var field=self.fields[category.fieldName];var op=(field.type==='many2one'&&category.parentField)?'child_of':'=';domain.push([category.fieldName,op,category.activeValueId]);}
return domain;}
return Object.keys(this.categories).reduce(categoryToDomain,[]);},_getFilterDomain:function(){var self=this;function getCheckedValueIds(values){return Object.keys(values).reduce(function(checkedValues,valueId){if(values[valueId].checked){checkedValues.push(values[valueId].id);}
return checkedValues;},[]);}
function filterToDomain(domain,filterId){var filter=self.filters[filterId];if(filter.groups){Object.keys(filter.groups).forEach(function(groupId){var group=filter.groups[groupId];var checkedValues=getCheckedValueIds(group.values);if(checkedValues.length){domain.push([filter.fieldName,'in',checkedValues]);}});}else if(filter.values){var checkedValues=getCheckedValueIds(filter.values);if(checkedValues.length){domain.push([filter.fieldName,'in',checkedValues]);}}
return domain;}
return Object.keys(this.filters).reduce(filterToDomain,[]);},_getLocalStorageKey:function(category){return'searchpanel_'+this.model+'_'+category.fieldName;},_getAncestorValueIds:function(category,categoryValueId){var categoryValue=category.values[categoryValueId];var parentId=categoryValue.parentId;if(parentId){return[parentId].concat(this._getAncestorValueIds(category,parentId));}
return[];},_notifyDomainUpdated:function(){this.needReload=true;this.trigger_up('search_panel_domain_updated',{domain:this.getDomain(),});},_render:function(){var self=this;this.$el.empty();var categories=Object.keys(this.categories).map(function(categoryId){return self.categories[categoryId];});var filters=Object.keys(this.filters).map(function(filterId){return self.filters[filterId];});var sections=categories.concat(filters).sort(function(s1,s2){return s1.index-s2.index;});sections.forEach(function(section){if(Object.keys(section.values).length){if(section.type==='category'){self.$el.append(self._renderCategory(section));}else{self.$el.append(self._renderFilter(section));}}});},_renderCategory:function(category){return qweb.render('SearchPanel.Category',{category:category});},_renderFilter:function(filter){var $filter=$(qweb.render('SearchPanel.Filter',{filter:filter}));Object.keys(filter.groups||{}).forEach(function(groupId){var state=filter.groups[groupId].state;if(groupId!=='false'&&state==='indeterminate'){$filter.find('.o_search_panel_filter_group[data-group-id='+groupId+'] input').get(0).indeterminate=true;}});return $filter;},_updateFilterGroupState:function(group){var valuePartition=_.partition(Object.keys(group.values),function(valueId){return group.values[valueId].checked;});if(valuePartition[0].length&&valuePartition[1].length){group.state='indeterminate';}else if(valuePartition[0].length){group.state='checked';}else{group.state='unchecked';}},_onCategoryValueClicked:function(ev){ev.stopPropagation();var $item=$(ev.currentTarget).closest('.o_search_panel_category_value');var category=this.categories[$item.data('categoryId')];var valueId=$item.data('id')||false;category.activeValueId=valueId;if(category.values[valueId]){category.values[valueId].folded=!category.values[valueId].folded;}
var storageKey=this._getLocalStorageKey(category);this.call('local_storage','setItem',storageKey,valueId);this._notifyDomainUpdated();},_onFilterGroupChanged:function(ev){ev.stopPropagation();var $item=$(ev.target).closest('.o_search_panel_filter_group');var filter=this.filters[$item.data('filterId')];var groupId=$item.data('groupId');var group=filter.groups[groupId];group.state=group.state==='checked'?'unchecked':'checked';Object.keys(group.values).forEach(function(valueId){group.values[valueId].checked=group.state==='checked';});this._notifyDomainUpdated();},_onFilterValueChanged:function(ev){ev.stopPropagation();var $item=$(ev.target).closest('.o_search_panel_filter_value');var valueId=$item.data('valueId');var filter=this.filters[$item.data('filterId')];var value=filter.values[valueId];value.checked=!value.checked;var group=filter.groups&&filter.groups[value.group_id];if(group){this._updateFilterGroupState(group);}
this._notifyDomainUpdated();},_onToggleFoldCategory:function(ev){ev.preventDefault();ev.stopPropagation();var $item=$(ev.currentTarget).closest('.o_search_panel_category_value');var category=this.categories[$item.data('categoryId')];var valueId=$item.data('id');category.values[valueId].folded=!category.values[valueId].folded;this._render();},_onToggleFoldFilterGroup:function(ev){ev.preventDefault();ev.stopPropagation();var $item=$(ev.currentTarget).closest('.o_search_panel_filter_group');var filter=this.filters[$item.data('filterId')];var groupId=$item.data('groupId');filter.groups[groupId].folded=!filter.groups[groupId].folded;this._render();},});return SearchPanel;});;

/* /web/static/src/js/views/field_manager_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('web.FieldManagerMixin',function(require){"use strict";var BasicModel=require('web.BasicModel');var concurrency=require('web.concurrency');var FieldManagerMixin={custom_events:{field_changed:'_onFieldChanged',load:'_onLoad',mutexify:'_onMutexify',},init:function(model){this.model=model||new BasicModel(this);this.mutex=new concurrency.Mutex();},_applyChanges:function(dataPointID,changes,event){var self=this;var options=_.pick(event.data,'context','doNotSetDirty','notifyChange','viewType','allowWarning');return this.model.notifyChanges(dataPointID,changes,options).then(function(result){if(event.data.force_save){return self.model.save(dataPointID).then(function(){return self._confirmSave(dataPointID);}).guardedCatch(function(){return self._rejectSave(dataPointID);});}else if(options.notifyChange!==false){return self._confirmChange(dataPointID,result,event);}});},_confirmChange:function(id,fields,event){return Promise.resolve();},_confirmSave:function(id){return Promise.resolve();},_rejectSave:function(id){return Promise.resolve();},_onFieldChanged:function(event){event.stopPropagation();return this._applyChanges(event.data.dataPointID,event.data.changes,event).then(event.data.onSuccess||function(){}).guardedCatch(event.data.onFailure||function(){});},_onLoad:function(event){var self=this;event.stopPropagation();var data=event.data;if(!data.on_success){return;}
var params={};if('limit'in data){params.limit=data.limit;}
if('offset'in data){params.offset=data.offset;}
this.mutex.exec(function(){return self.model.reload(data.id,params).then(function(db_id){data.on_success(self.model.get(db_id));});});},_onMutexify:function(ev){ev.stopPropagation();this.mutex.exec(ev.data.action);},};return FieldManagerMixin;});;

/* /web/static/src/js/views/select_create_controllers_registry.js defined in bundle 'web.assets_backend' */
odoo.define('web.select_create_controllers_registry',function(require){"use strict";return{};});odoo.define('web._select_create_controllers_registry',function(require){"use strict";var KanbanController=require('web.KanbanController');var ListController=require('web.ListController');var select_create_controllers_registry=require('web.select_create_controllers_registry');var SelectCreateKanbanController=KanbanController.extend({_onOpenRecord:function(ev){var selectedRecord=this.model.get(ev.data.id);this.trigger_up('select_record',{id:selectedRecord.res_id,display_name:selectedRecord.data.display_name,});},});var SelectCreateListController=ListController.extend({_onOpenRecord:function(ev){var selectedRecord=this.model.get(ev.data.id);this.trigger_up('select_record',{id:selectedRecord.res_id,display_name:selectedRecord.data.display_name,});},});_.extend(select_create_controllers_registry,{SelectCreateListController:SelectCreateListController,SelectCreateKanbanController:SelectCreateKanbanController,});});;

/* /web/static/src/js/views/standalone_field_manager_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('web.StandaloneFieldManagerMixin',function(require){"use strict";var FieldManagerMixin=require('web.FieldManagerMixin');var StandaloneFieldManagerMixin=_.extend({},FieldManagerMixin,{init:function(){FieldManagerMixin.init.apply(this,arguments);this.registeredWidgets={};},_confirmChange:function(id,fields,event){var result=FieldManagerMixin._confirmChange.apply(this,arguments);var record=this.model.get(id);_.each(this.registeredWidgets[id],function(widget,fieldName){if(_.contains(fields,fieldName)){widget.reset(record,event);}});return result;},_registerWidget:function(datapointID,fieldName,widget){if(!this.registeredWidgets[datapointID]){this.registeredWidgets[datapointID]={};}
this.registeredWidgets[datapointID][fieldName]=widget;},});return StandaloneFieldManagerMixin;});;

/* /web/static/src/js/views/view_registry.js defined in bundle 'web.assets_backend' */
odoo.define('web.view_registry',function(require){"use strict";var Registry=require('web.Registry');return new Registry();});odoo.define('web._view_registry',function(require){"use strict";var FormView=require('web.FormView');var GraphView=require('web.GraphView');var KanbanView=require('web.KanbanView');var ListView=require('web.ListView');var PivotView=require('web.PivotView');var CalendarView=require('web.CalendarView');var view_registry=require('web.view_registry');view_registry.add('form',FormView).add('list',ListView).add('kanban',KanbanView).add('graph',GraphView).add('pivot',PivotView).add('calendar',CalendarView);});;

/* /web/static/src/js/views/view_dialogs.js defined in bundle 'web.assets_backend' */
odoo.define('web.view_dialogs',function(require){"use strict";var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var dom=require('web.dom');var view_registry=require('web.view_registry');var select_create_controllers_registry=require('web.select_create_controllers_registry');var _t=core._t;var ViewDialog=Dialog.extend({custom_events:_.extend({},Dialog.prototype.custom_events,{push_state:'_onPushState',}),init:function(parent,options){options=options||{};options.fullscreen=config.device.isMobile;options.dialogClass=options.dialogClass||''+' o_act_window';this._super(parent,$.extend(true,{},options));this.res_model=options.res_model||null;this.domain=options.domain||[];this.context=options.context||{};this.options=_.extend(this.options||{},options||{});},_onPushState:function(event){event.stopPropagation();},});var FormViewDialog=ViewDialog.extend({init:function(parent,options){var self=this;options=options||{};this.res_id=options.res_id||null;this.on_saved=options.on_saved||(function(){});this.on_remove=options.on_remove||(function(){});this.context=options.context;this._createContext=options._createContext;this.model=options.model;this.parentID=options.parentID;this.recordID=options.recordID;this.shouldSaveLocally=options.shouldSaveLocally;this.readonly=options.readonly;this.deletable=options.deletable;this.disable_multiple_selection=options.disable_multiple_selection;var oBtnRemove='o_btn_remove';var multi_select=!_.isNumber(options.res_id)&&!options.disable_multiple_selection;var readonly=_.isNumber(options.res_id)&&options.readonly;if(!options.buttons){options.buttons=[{text:(readonly?_t("Close"):_t("Discard")),classes:"btn-secondary o_form_button_cancel",close:true,click:function(){if(!readonly){self.form_view.model.discardChanges(self.form_view.handle,{rollback:self.shouldSaveLocally,});}},}];if(!readonly){options.buttons.unshift({text:(multi_select?_t("Save & Close"):_t("Save")),classes:"btn-primary",click:function(){self._save().then(self.close.bind(self));}});if(multi_select){options.buttons.splice(1,0,{text:_t("Save & New"),classes:"btn-primary",click:function(){self._save().then(function(){const additionalContext=self._createContext&&self._createContext(false);self.form_view.createRecord(self.parentID,additionalContext);}).then(function(){if(!self.deletable){return;}
self.deletable=false;self.buttons=self.buttons.filter(function(button){return button.classes.split(' ').indexOf(oBtnRemove)<0;});self.set_buttons(self.buttons);self.set_title(_t("Create ")+_.str.strRight(self.title,_t("Open: ")));});},});}
var multi=options.disable_multiple_selection;if(!multi&&this.deletable){this._setRemoveButtonOption(options,oBtnRemove);}}}
this._super(parent,options);},open:function(){var self=this;var _super=this._super.bind(this);var FormView=view_registry.get('form');var fields_view_def;if(this.options.fields_view){fields_view_def=Promise.resolve(this.options.fields_view);}else{fields_view_def=this.loadFieldView(this.res_model,this.context,this.options.view_id,'form');}
fields_view_def.then(function(viewInfo){var refinedContext=_.pick(self.context,function(value,key){return key.indexOf('_view_ref')===-1;});var formview=new FormView(viewInfo,{modelName:self.res_model,context:refinedContext,ids:self.res_id?[self.res_id]:[],currentId:self.res_id||undefined,index:0,mode:self.res_id&&self.options.readonly?'readonly':'edit',footerToButtons:true,default_buttons:false,withControlPanel:false,model:self.model,parentID:self.parentID,recordID:self.recordID,isFromFormViewDialog:true});return formview.getController(self);}).then(function(formView){self.form_view=formView;var fragment=document.createDocumentFragment();if(self.recordID&&self.shouldSaveLocally){self.model.save(self.recordID,{savePoint:true});}
return self.form_view.appendTo(fragment).then(function(){self.opened().then(function(){var $buttons=$('<div>');self.form_view.renderButtons($buttons);if($buttons.children().length){self.$footer.empty().append($buttons.contents());}
dom.append(self.$el,fragment,{callbacks:[{widget:self.form_view}],in_DOM:true,});});return _super();});});return this;},_focusOnClose:function(){var isFocusSet=false;this.trigger_up('form_dialog_discarded',{callback:function(isFocused){isFocusSet=isFocused;},});return isFocusSet;},_remove:function(){return Promise.resolve(this.on_remove());},_save:function(){var self=this;return this.form_view.saveRecord(this.form_view.handle,{stayInEdit:true,reload:false,savePoint:this.shouldSaveLocally,viewType:'form',}).then(function(changedFields){var record=self.form_view.model.get(self.form_view.handle);return self.on_saved(record,!!changedFields.length);});},_setRemoveButtonOption(options,btnClasses){const self=this;options.buttons.push({text:_t("Remove"),classes:'btn-secondary '+btnClasses,click:function(){self._remove().then(self.close.bind(self));}});},});var SelectCreateDialog=ViewDialog.extend({custom_events:_.extend({},ViewDialog.prototype.custom_events,{select_record:function(event){if(!this.options.readonly){this.on_selected([event.data]);this.close();}},selection_changed:function(event){event.stopPropagation();this.$footer.find(".o_select_button").prop('disabled',!event.data.selection.length);},}),init:function(){this._super.apply(this,arguments);_.defaults(this.options,{initial_view:'search'});this.on_selected=this.options.on_selected||(function(){});this.on_closed=this.options.on_closed||(function(){});this.initialIDs=this.options.initial_ids;this.viewType='list';},open:function(){if(this.options.initial_view!=="search"){return this.create_edit_record();}
var self=this;var _super=this._super.bind(this);var viewRefID=this.viewType==='kanban'?(this.options.kanban_view_ref&&JSON.parse(this.options.kanban_view_ref)||false):false;return this.loadViews(this.res_model,this.context,[[viewRefID,this.viewType],[false,'search']],{}).then(this.setup.bind(this)).then(function(fragment){self.opened().then(function(){dom.append(self.$el,fragment,{callbacks:[{widget:self.viewController}],in_DOM:true,});self.set_buttons(self.__buttons);});return _super();});},setup:function(fieldsViews){var self=this;var fragment=document.createDocumentFragment();var domain=this.domain;if(this.initialIDs){domain=domain.concat([['id','in',this.initialIDs]]);}
var ViewClass=view_registry.get(this.viewType);var viewOptions={};var selectCreateController;if(this.viewType==='list'){_.extend(viewOptions,{hasSelectors:!this.options.disable_multiple_selection,readonly:true,},this.options.list_view_options);selectCreateController=select_create_controllers_registry.SelectCreateListController;}
if(this.viewType==='kanban'){_.extend(viewOptions,{noDefaultGroupby:true,selectionMode:this.options.selectionMode||false,});selectCreateController=select_create_controllers_registry.SelectCreateKanbanController;}
var view=new ViewClass(fieldsViews[this.viewType],_.extend(viewOptions,{action:{controlPanelFieldsView:fieldsViews.search,help:_.str.sprintf("<p>%s</p>",_t("No records found!")),},action_buttons:false,dynamicFilters:this.options.dynamicFilters,context:this.context,domain:domain,modelName:this.res_model,withBreadcrumbs:false,withSearchPanel:false,}));view.setController(selectCreateController);return view.getController(this).then(function(controller){self.viewController=controller;self._prepareButtons();return self.viewController.appendTo(fragment);}).then(function(){return fragment;});},close:function(){this._super.apply(this,arguments);this.on_closed();},create_edit_record:function(){var self=this;var dialog=new FormViewDialog(this,_.extend({},this.options,{on_saved:function(record){var values=[{id:record.res_id,display_name:record.data.display_name||record.data.name,}];self.on_selected(values);},})).open();dialog.on('closed',this,this.close);return dialog;},_focusOnClose:function(){var isFocusSet=false;this.trigger_up('form_dialog_discarded',{callback:function(isFocused){isFocusSet=isFocused;},});return isFocusSet;},_prepareButtons:function(){this.__buttons=[{text:_t("Cancel"),classes:'btn-secondary o_form_button_cancel',close:true,}];if(!this.options.no_create){this.__buttons.unshift({text:_t("Create"),classes:'btn-primary',click:this.create_edit_record.bind(this)});}
if(!this.options.disable_multiple_selection){this.__buttons.unshift({text:_t("Select"),classes:'btn-primary o_select_button',disabled:true,close:true,click:function(){var records=this.viewController.getSelectedRecords();var values=_.map(records,function(record){return{id:record.res_id,display_name:record.data.display_name,};});this.on_selected(values);},});}},});return{FormViewDialog:FormViewDialog,SelectCreateDialog:SelectCreateDialog,};});;

/* /web/static/src/js/views/view_utils.js defined in bundle 'web.assets_backend' */
odoo.define('web.viewUtils',function(require){"use strict";var dom=require('web.dom');var utils=require('web.utils');var viewUtils={getGroupValue:function(group,groupByField){var groupedByField=group.fields[groupByField];switch(groupedByField.type){case'many2one':return group.res_id||false;case'selection':var descriptor=_.find(groupedByField.selection,function(option){return option[1]===group.value;});return descriptor&&descriptor[0];case'char':case'boolean':return group.value;default:return false;}},isQuickCreateEnabled:function(list){var groupByField=list.groupedBy[0]&&list.groupedBy[0].split(':')[0];if(!groupByField){return false;}
var availableTypes=['char','boolean','many2one','selection'];if(!_.contains(availableTypes,list.fields[groupByField].type)){return false;}
return true;},parseArch:function(arch){var doc=$.parseXML(arch).documentElement;var stripWhitespaces=doc.nodeName.toLowerCase()!=='kanban';return utils.xml_to_json(doc,stripWhitespaces);},renderButtonFromNode:function(node,options){var btnOptions={attrs:_.omit(node.attrs,'icon','string','type','attrs','modifiers','options','effect'),icon:node.attrs.icon,};if(options&&options.extraClass){var classes=btnOptions.attrs.class?btnOptions.attrs.class.split(' '):[];btnOptions.attrs.class=_.uniq(classes.concat(options.extraClass.split(' '))).join(' ');}
var str=(node.attrs.string||'').replace(/_/g,'');if(str){if(options&&options.textAsTitle){btnOptions.attrs.title=str;}else{btnOptions.text=str;}}
return dom.renderButton(btnOptions);},};return viewUtils;});;

/* /web/static/src/js/views/form/form_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.FormRenderer',function(require){"use strict";var BasicRenderer=require('web.BasicRenderer');var config=require('web.config');var core=require('web.core');var dom=require('web.dom');var viewUtils=require('web.viewUtils');var _t=core._t;var qweb=core.qweb;var FormRenderer=BasicRenderer.extend({className:"o_form_view",events:_.extend({},BasicRenderer.prototype.events,{'click .o_notification_box .oe_field_translate':'_onTranslate','click .o_notification_box .close':'_onTranslateNotificationClose','click .oe_title, .o_inner_group':'_onClick','shown.bs.tab a[data-toggle="tab"]':'_onNotebookTabChanged',}),custom_events:_.extend({},BasicRenderer.prototype.custom_events,{'navigation_move':'_onNavigationMove','activate_next_widget':'_onActivateNextWidget',}),INNER_GROUP_COL:2,OUTER_GROUP_COL:2,init:function(){this._super.apply(this,arguments);this.idsForLabels={};this.lastActivatedFieldIndex=-1;this.alertFields={};},start:function(){if(config.device.size_class<=config.device.SIZES.XS){this.$el.addClass('o_xxs_form_view');}
return this._super.apply(this,arguments);},on_attach_callback:function(){this._isInDom=true;_.forEach(this.allFieldWidgets,function(widgets){_.invoke(widgets,'on_attach_callback');});this._super.apply(this,arguments);},on_detach_callback:function(){this._isInDom=false;this._super.apply(this,arguments);},autofocus:function(){if(this.mode==='readonly'){var firstPrimaryFormButton=this.$el.find('button.btn-primary:enabled:visible:first()');if(firstPrimaryFormButton.length>0){return firstPrimaryFormButton.focus();}else{return;}}
var focusWidget=this.defaultFocusField;if(!focusWidget||!focusWidget.isFocusable()){var widgets=this.allFieldWidgets[this.state.id];for(var i=0;i<(widgets?widgets.length:0);i++){var widget=widgets[i];if(widget.isFocusable()){focusWidget=widget;break;}}}
if(focusWidget){return focusWidget.activate({noselect:true,noAutomaticCreate:true});}},canBeSaved:function(){var self=this;var fieldNames=this._super.apply(this,arguments);var $labels=this.$('label');$labels.removeClass('o_field_invalid');_.each(fieldNames,function(fieldName){var idForLabel=self.idsForLabels[fieldName];if(idForLabel){$labels.filter('[for='+idForLabel+']').addClass('o_field_invalid');}});return fieldNames;},updateAlertFields:function(alertFields){this.alertFields[this.state.res_id]=_.extend(this.alertFields[this.state.res_id]||{},alertFields);this.displayTranslationAlert();},displayTranslationAlert:function(){this.$('.o_notification_box').remove();if(this.alertFields[this.state.res_id]){var $notification=$(qweb.render('notification-box',{type:'info'})).append(qweb.render('translation-alert',{fields:this.alertFields[this.state.res_id],lang:_t.database.parameters.name}));if(this.$('.o_form_statusbar').length){this.$('.o_form_statusbar').after($notification);}else if(this.$('.o_form_sheet_bg').length){this.$('.o_form_sheet_bg').prepend($notification);}else{this.$el.prepend($notification);}}},confirmChange:function(){var self=this;return this._super.apply(this,arguments).then(function(resetWidgets){_.each(resetWidgets,function(widget){self._setIDForLabel(widget,self.idsForLabels[widget.name]);});if(self.$('.o_field_invalid').length){self.canBeSaved(self.state.id);}
return resetWidgets;});},disableButtons:function(){this.$('.o_statusbar_buttons button, .oe_button_box button').attr('disabled',true);},enableButtons:function(){this.$('.o_statusbar_buttons button, .oe_button_box button').removeAttr('disabled');},focusLastActivatedWidget:function(){if(this.lastActivatedFieldIndex!==-1){return this._activateNextFieldWidget(this.state,this.lastActivatedFieldIndex-1,{noAutomaticCreate:true});}
return false;},getLocalState:function(){var state={};this.$('div.o_notebook').each(function(){var $notebook=$(this);var name=$notebook.data('name');var index=-1;$notebook.find('.nav-link').each(function(i){if($(this).hasClass('active')){index=i;}});state[name]=index;});return state;},resetLastActivatedField:function(){this.lastActivatedFieldIndex=-1;},setLocalState:function(state){this.$('div.o_notebook').each(function(){var $notebook=$(this);var name=$notebook.data('name');if(name in state){var $page=$notebook.find('> .o_notebook_headers > .nav-tabs > .nav-item').eq(state[name]);if(!$page.hasClass('o_invisible_modifier')){$page.find('a[data-toggle="tab"]').click();}}});},updateState:function(state,params){this.mode=(params&&'mode'in params)?params.mode:this.mode;if(params.fieldNames){return this.confirmChange(state,state.id,params.fieldNames);}
return this._super.apply(this,arguments);},_activateFirstVisibleTab(tabs){const visibleTabs=tabs.filter((tab)=>!tab.$header.hasClass("o_invisible_modifier"));const autofocusTab=visibleTabs.findIndex((tab)=>tab.node.attrs.autofocus==="autofocus");const tabToFocus=visibleTabs[Math.max(0,autofocusTab)];if(tabToFocus){tabToFocus.$header.find('.nav-link').addClass('active');tabToFocus.$page.addClass('active');}},_activateNextFieldWidget:function(record,currentIndex){if((currentIndex+1)>=(this.allFieldWidgets[record.id]||[]).length){this.trigger_up('focus_control_button');this.lastActivatedFieldIndex=-1;}else{var activatedIndex=this._super.apply(this,arguments);if(activatedIndex===-1){this.trigger_up('focus_control_button');this.lastActivatedFieldIndex=-1;}
else{this.lastActivatedFieldIndex=activatedIndex;}}
return this.lastActivatedFieldIndex;},_addButtonTooltip:function(node,$button){var self=this;$button.tooltip({title:function(){return qweb.render('WidgetButton.tooltip',{debug:config.isDebug(),state:self.state,node:node,});},});},_addOnClickAction:function($el,node){if(node.attrs.special||node.attrs.confirm||node.attrs.type||$el.hasClass('oe_stat_button')){var self=this;$el.click(function(){self.trigger_up('button_clicked',{attrs:node.attrs,record:self.state,});});}},_getIDForLabel:function(name){var idForLabel=this.idsForLabels[name];if(!idForLabel){idForLabel=_.uniqueId('o_field_input_');this.idsForLabels[name]=idForLabel;}
return idForLabel;},_getRecord:function(recordId){return this.state.id===recordId?this.state:null;},_postProcessField:function(widget,node){this._super.apply(this,arguments);this._setIDForLabel(widget,this._getIDForLabel(node.attrs.name));if(JSON.parse(node.attrs.default_focus||"0")){this.defaultFocusField=widget;}},_renderButtonBox:function(node){var self=this;var $result=$('<'+node.tag+'>',{class:'o_not_full'});var nextDefIndex=this.defs.length;var buttons=_.map(node.children,function(child){if(child.tag==='button'){return self._renderStatButton(child);}else{return self._renderNode(child);}});var $tempWrapper=$('<div>');_.each(buttons,function($button){$button.appendTo($tempWrapper);});var defs=this.defs.slice(nextDefIndex);Promise.all(defs).then(function(){buttons=$tempWrapper.children();var buttons_partition=_.partition(buttons,function(button){return $(button).is('.o_invisible_modifier');});var invisible_buttons=buttons_partition[0];var visible_buttons=buttons_partition[1];var nb_buttons=self._renderButtonBoxNbButtons();var unfolded_buttons=visible_buttons.slice(0,nb_buttons).concat(invisible_buttons);var folded_buttons=visible_buttons.slice(nb_buttons);if(folded_buttons.length===1){unfolded_buttons=buttons;folded_buttons=[];}
var full=(visible_buttons.length>nb_buttons);$result.toggleClass('o_full',full).toggleClass('o_not_full',!full);_.each(unfolded_buttons,function(button){$(button).appendTo($result);});if(folded_buttons.length){$result.append(dom.renderButton({attrs:{'class':'oe_stat_button o_button_more dropdown-toggle','data-toggle':'dropdown',},text:_t("More"),}));var $dropdown=$("<div>",{class:"dropdown-menu o_dropdown_more",role:"menu"});_.each(folded_buttons,function(button){$(button).addClass('dropdown-item').appendTo($dropdown);});$dropdown.appendTo($result);}});this._handleAttributes($result,node);this._registerModifiers(node,this.state,$result);return $result;},_renderButtonBoxNbButtons:function(){return[2,2,2,4][config.device.size_class]||7;},_renderGenericTag:function(node){var $result=$('<'+node.tag+'>',_.omit(node.attrs,'modifiers'));this._handleAttributes($result,node);this._registerModifiers(node,this.state,$result);$result.append(_.map(node.children,this._renderNode.bind(this)));return $result;},_renderHeaderButton:function(node){var $button=viewUtils.renderButtonFromNode(node);if($button.not('.btn-primary, .btn-secondary, .btn-link, .btn-success, .btn-info, .btn-warning, .btn-danger').length){$button.addClass('btn-secondary');}
this._addOnClickAction($button,node);this._handleAttributes($button,node);this._registerModifiers(node,this.state,$button);if(config.isDebug()||node.attrs.help){this._addButtonTooltip(node,$button);}
return $button;},_renderHeaderButtons:function(node){var self=this;var $buttons=$('<div>',{class:'o_statusbar_buttons'});_.each(node.children,function(child){if(child.tag==='button'){$buttons.append(self._renderHeaderButton(child));}
if(child.tag==='widget'){$buttons.append(self._renderTagWidget(child));}});return $buttons;},_renderInnerGroup:function(node){var self=this;var $result=$('<table/>',{class:'o_group o_inner_group'});var $tbody=$('<tbody />').appendTo($result);this._handleAttributes($result,node);this._registerModifiers(node,this.state,$result);var col=parseInt(node.attrs.col,10)||this.INNER_GROUP_COL;if(node.attrs.string){var $sep=$('<tr><td colspan="'+col+'" style="width: 100%;"><div class="o_horizontal_separator">'+node.attrs.string+'</div></td></tr>');$result.append($sep);}
var rows=[];var $currentRow=$('<tr/>');var currentColspan=0;node.children.forEach(function(child){if(child.tag==='newline'){rows.push($currentRow);$currentRow=$('<tr/>');currentColspan=0;return;}
var colspan=parseInt(child.attrs.colspan,10);var isLabeledField=(child.tag==='field'&&child.attrs.nolabel!=='1');if(!colspan){if(isLabeledField){colspan=2;}else{colspan=1;}}
var finalColspan=colspan-(isLabeledField?1:0);currentColspan+=colspan;if(currentColspan>col){rows.push($currentRow);$currentRow=$('<tr/>');currentColspan=colspan;}
var $tds;if(child.tag==='field'){$tds=self._renderInnerGroupField(child);}else if(child.tag==='label'){$tds=self._renderInnerGroupLabel(child);}else{var $td=$('<td/>');var $child=self._renderNode(child);if($child.hasClass('o_td_label')){$td.addClass('o_td_label');$child.removeClass('o_td_label');}
$tds=$td.append($child);}
if(finalColspan>1){$tds.last().attr('colspan',finalColspan);}
$currentRow.append($tds);});rows.push($currentRow);_.each(rows,function($tr){var nonLabelColSize=100/(col-$tr.children('.o_td_label').length);_.each($tr.children(':not(.o_td_label)'),function(el){var $el=$(el);$el.css('width',((parseInt($el.attr('colspan'),10)||1)*nonLabelColSize)+'%');});$tbody.append($tr);});return $result;},_renderInnerGroupField:function(node){var $el=this._renderFieldWidget(node,this.state);var $tds=$('<td/>').append($el);if(node.attrs.nolabel!=='1'){var $labelTd=this._renderInnerGroupLabel(node);$tds=$labelTd.add($tds);}
return $tds;},_renderInnerGroupLabel:function(label){return $('<td/>',{class:'o_td_label'}).append(this._renderTagLabel(label));},_renderNode:function(node){var renderer=this['_renderTag'+_.str.capitalize(node.tag)];if(renderer){return renderer.call(this,node);}
if(node.tag==='div'&&node.attrs.name==='button_box'){return this._renderButtonBox(node);}
if(_.isString(node)){return node;}
return this._renderGenericTag(node);},_renderOuterGroup:function(node){var self=this;var $result=$('<div/>',{class:'o_group'});var nbCols=parseInt(node.attrs.col,10)||this.OUTER_GROUP_COL;var colSize=Math.max(1,Math.round(12/nbCols));if(node.attrs.string){var $sep=$('<div/>',{class:'o_horizontal_separator'}).text(node.attrs.string);$result.append($sep);}
$result.append(_.map(node.children,function(child){if(child.tag==='newline'){return $('<br/>');}
var $child=self._renderNode(child);$child.addClass('o_group_col_'+(colSize*(parseInt(child.attrs.colspan,10)||1)));return $child;}));this._handleAttributes($result,node);this._registerModifiers(node,this.state,$result);return $result;},_renderStatButton:function(node){var $button=viewUtils.renderButtonFromNode(node,{extraClass:'oe_stat_button',});$button.append(_.map(node.children,this._renderNode.bind(this)));if(node.attrs.help){this._addButtonTooltip(node,$button);}
this._addOnClickAction($button,node);this._handleAttributes($button,node);this._registerModifiers(node,this.state,$button);return $button;},_renderTabHeader:function(page,page_id){var $a=$('<a>',{'data-toggle':'tab',disable_anchor:'true',href:'#'+page_id,class:'nav-link',role:'tab',text:page.attrs.string,});return $('<li>',{class:'nav-item'}).append($a);},_renderTabPage:function(page,page_id){var $result=$('<div class="tab-pane" id="'+page_id+'">');$result.append(_.map(page.children,this._renderNode.bind(this)));return $result;},_renderTagButton:function(node){var $button=viewUtils.renderButtonFromNode(node);$button.append(_.map(node.children,this._renderNode.bind(this)));this._addOnClickAction($button,node);this._handleAttributes($button,node);this._registerModifiers(node,this.state,$button);if(config.isDebug()||node.attrs.help){this._addButtonTooltip(node,$button);}
return $button;},_renderTagField:function(node){return this._renderFieldWidget(node,this.state);},_renderTagForm:function(node){var $result=$('<div/>');if(node.attrs.class){$result.addClass(node.attrs.class);}
var allNodes=node.children.map(this._renderNode.bind(this));$result.append(allNodes);return $result;},_renderTagGroup:function(node){var isOuterGroup=_.some(node.children,function(child){return child.tag==='group';});if(!isOuterGroup){return this._renderInnerGroup(node);}
return this._renderOuterGroup(node);},_renderTagHeader:function(node){var self=this;var $statusbar=$('<div>',{class:'o_form_statusbar'});$statusbar.append(this._renderHeaderButtons(node));_.each(node.children,function(child){if(child.tag==='field'){var $el=self._renderFieldWidget(child,self.state);$statusbar.append($el);}});this._handleAttributes($statusbar,node);this._registerModifiers(node,this.state,$statusbar);return $statusbar;},_renderTagLabel:function(node){var self=this;var text;var fieldName=node.tag==='label'?node.attrs.for:node.attrs.name;if('string'in node.attrs){text=node.attrs.string;}else if(fieldName){text=this.state.fields[fieldName].string;}else{return this._renderGenericTag(node);}
var $result=$('<label>',{class:'o_form_label',for:this._getIDForLabel(fieldName),text:text,});if(node.tag==='label'){this._handleAttributes($result,node);}
var modifiersOptions;if(fieldName){modifiersOptions={callback:function(element,modifiers,record){var widgets=self.allFieldWidgets[record.id];var widget=_.findWhere(widgets,{name:fieldName});if(!widget){return;}
element.$el.toggleClass('o_form_label_empty',!!(record.data.id&&(modifiers.readonly||self.mode==='readonly')&&!widget.isSet()));},};}
this._registerModifiers(node,this.state,$result,modifiersOptions);return $result;},_renderTagNotebook:function(node){var self=this;var $headers=$('<ul class="nav nav-tabs">');var $pages=$('<div class="tab-content">');var renderedTabs=_.map(node.children,function(child,index){var pageID=_.uniqueId('notebook_page_');var $header=self._renderTabHeader(child,pageID);var $page=self._renderTabPage(child,pageID);self._handleAttributes($header,child);$headers.append($header);$pages.append($page);return{$header:$header,$page:$page,node:child,};});_.each(renderedTabs,function(tab){self._registerModifiers(tab.node,self.state,tab.$header,{callback:function(element,modifiers){var $link=element.$el.find('.nav-link');if(modifiers.invisible&&$link.hasClass('active')){$link.removeClass('active');tab.$page.removeClass('active');self.inactiveNotebooks.push(renderedTabs);}
if(!modifiers.invisible){var $visibleTabs=$headers.find('li:not(.o_invisible_modifier)');if($visibleTabs.length===1){self.inactiveNotebooks.push(renderedTabs);}}},});});this._activateFirstVisibleTab(renderedTabs);var $notebookHeaders=$('<div class="o_notebook_headers">').append($headers);var $notebook=$('<div class="o_notebook">').data('name',node.attrs.name||'_default_').append($notebookHeaders,$pages);this._registerModifiers(node,this.state,$notebook);this._handleAttributes($notebook,node);return $notebook;},_renderTagSeparator:function(node){var $separator=$('<div/>').addClass('o_horizontal_separator').text(node.attrs.string);this._handleAttributes($separator,node);this._registerModifiers(node,this.state,$separator);return $separator;},_renderTagSheet:function(node){this.has_sheet=true;var $sheet=$('<div>',{class:'clearfix position-relative o_form_sheet'});$sheet.append(node.children.map(this._renderNode.bind(this)));return $sheet;},_renderTagWidget:function(node){return this._renderWidget(this.state,node);},_renderView:function(){var self=this;var defs=[];this.defs=defs;this.inactiveNotebooks=[];var $form=this._renderNode(this.arch).addClass(this.className);delete this.defs;return Promise.all(defs).then(function(){self._updateView($form.contents());if(self.state.res_id in self.alertFields){self.displayTranslationAlert();}}).then(function(){if(self.lastActivatedFieldIndex>=0){self._activateNextFieldWidget(self.state,self.lastActivatedFieldIndex);}
if(self._isInDom){_.forEach(self.allFieldWidgets,function(widgets){_.invoke(widgets,'on_attach_callback');});}}).guardedCatch(function(){$form.remove();});},async _updateAllModifiers(){await this._super(...arguments);for(const tabs of this.inactiveNotebooks){this._activateFirstVisibleTab(tabs);}
this.inactiveNotebooks=[];},_updateView:function($newContent){var self=this;this.$el.html($newContent);this.$el.toggleClass('o_form_nosheet',!this.has_sheet);if(this.has_sheet){this.$el.children().not('.oe_chatter').wrapAll($('<div/>',{class:'o_form_sheet_bg'}));}
this.$el.toggleClass('o_form_editable',this.mode==='edit');this.$el.toggleClass('o_form_readonly',this.mode==='readonly');_.each(this.allFieldWidgets[this.state.id],function(widget){var idForLabel=self.idsForLabels[widget.name];var $widgets=self.$('.o_field_widget[name='+widget.name+']');var $label=idForLabel?self.$('.o_form_label[for='+idForLabel+']'):$();$label=$label.eq($widgets.index(widget.$el));if(config.isDebug()||widget.attrs.help||widget.field.help){self._addFieldTooltip(widget,$label);}
if(widget.attrs.widget==='upgrade_boolean'){widget.renderWithLabel($label);}});},_setIDForLabel:function(widget,idForLabel){widget.setIDForLabel(idForLabel);},_onActivateNextWidget:function(ev){ev.stopPropagation();var index=this.allFieldWidgets[this.state.id].indexOf(ev.data.target);this._activateNextFieldWidget(this.state,index);},_onClick:function(){if(this.mode==='readonly'){this.trigger_up('bounce_edit');}},_onNavigationMove:function(ev){ev.stopPropagation();var index;if(ev.data.direction==="next"){index=this.allFieldWidgets[this.state.id].indexOf(ev.data.target||ev.target);this._activateNextFieldWidget(this.state,index);}else if(ev.data.direction==="previous"){index=this.allFieldWidgets[this.state.id].indexOf(ev.data.target);this._activatePreviousFieldWidget(this.state,index);}},_onNotebookTabChanged:function(){core.bus.trigger('DOM_updated');},_onTranslate:function(ev){ev.preventDefault();this.trigger_up('translate',{fieldName:ev.target.name,id:this.state.id,isComingFromTranslationAlert:true,});},_onTranslateNotificationClose:function(ev){delete this.alertFields[this.state.res_id];},});return FormRenderer;});;

/* /web/static/src/js/views/form/form_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.FormController',function(require){"use strict";var BasicController=require('web.BasicController');var core=require('web.core');var Dialog=require('web.Dialog');var dialogs=require('web.view_dialogs');var Sidebar=require('web.Sidebar');var _t=core._t;var qweb=core.qweb;var FormController=BasicController.extend({custom_events:_.extend({},BasicController.prototype.custom_events,{bounce_edit:'_onBounceEdit',button_clicked:'_onButtonClicked',edited_list:'_onEditedList',open_one2many_record:'_onOpenOne2ManyRecord',open_record:'_onOpenRecord',toggle_column_order:'_onToggleColumnOrder',focus_control_button:'_onFocusControlButton',form_dialog_discarded:'_onFormDialogDiscarded',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.actionButtons=params.actionButtons;this.disableAutofocus=params.disableAutofocus;this.footerToButtons=params.footerToButtons;this.defaultButtons=params.defaultButtons;this.hasSidebar=params.hasSidebar;this.toolbarActions=params.toolbarActions||{};},on_attach_callback:function(){this._super.apply(this,arguments);this.autofocus();},willRestore:function(){this.mode=this.model.isNew(this.handle)?'edit':'readonly';},autofocus:function(){if(!this.disableAutofocus){var isControlActivted=this.renderer.autofocus();if(!isControlActivted){if(this.$buttons&&this.mode==='readonly'){return this.$buttons.find('.o_form_button_edit').focus();}}}},createRecord:function(parentID,additionalContext){var self=this;var record=this.model.get(this.handle,{raw:true});return this.model.load({context:record.getContext({additionalContext:additionalContext}),fields:record.fields,fieldsInfo:record.fieldsInfo,modelName:this.modelName,parentID:parentID,res_ids:record.res_ids,type:'record',viewType:'form',}).then(function(handle){self.handle=handle;self._updateEnv();return self._setMode('edit');});},getSelectedIds:function(){var env=this.model.get(this.handle,{env:true});return env.currentId?[env.currentId]:[];},getTitle:function(){return this.model.getName(this.handle);},renderButtons:function($node){var $footer=this.footerToButtons?this.renderer.$('footer'):null;var mustRenderFooterButtons=$footer&&$footer.length;if(!this.defaultButtons&&!mustRenderFooterButtons){return;}
this.$buttons=$('<div/>');if(mustRenderFooterButtons){this.$buttons.append($footer);}else{this.$buttons.append(qweb.render("FormView.buttons",{widget:this}));this.$buttons.on('click','.o_form_button_edit',this._onEdit.bind(this));this.$buttons.on('click','.o_form_button_create',this._onCreate.bind(this));this.$buttons.on('click','.o_form_button_save',this._onSave.bind(this));this.$buttons.on('click','.o_form_button_cancel',this._onDiscard.bind(this));this._assignSaveCancelKeyboardBehavior(this.$buttons.find('.o_form_buttons_edit'));this.$buttons.find('.o_form_buttons_edit').tooltip({delay:{show:200,hide:0},title:function(){return qweb.render('SaveCancelButton.tooltip');},trigger:'manual',});this._updateButtons();}
this.$buttons.appendTo($node);},renderPager:function($node,options){options=_.extend({},options,{validate:this.canBeDiscarded.bind(this),});return this._super($node,options);},renderSidebar:function($node){var self=this;if(this.hasSidebar){var otherItems=[];if(this.archiveEnabled&&this.initialState.data.active!==undefined){var classname="o_sidebar_item_archive"+(this.initialState.data.active?"":" o_hidden")
otherItems.push({label:_t("Archive"),callback:function(){Dialog.confirm(self,_t("Are you sure that you want to archive this record?"),{confirm_callback:self._toggleArchiveState.bind(self,true),});},classname:classname,});classname="o_sidebar_item_unarchive"+(this.initialState.data.active?" o_hidden":"")
otherItems.push({label:_t("Unarchive"),callback:this._toggleArchiveState.bind(this,false),classname:classname,});}
if(this.is_action_enabled('delete')){otherItems.push({label:_t('Delete'),callback:this._onDeleteRecord.bind(this),});}
if(this.is_action_enabled('create')&&this.is_action_enabled('duplicate')){otherItems.push({label:_t('Duplicate'),callback:this._onDuplicateRecord.bind(this),});}
this.sidebar=new Sidebar(this,{editable:this.is_action_enabled('edit'),viewType:'form',env:{context:this.model.get(this.handle).getContext(),activeIds:this.getSelectedIds(),model:this.modelName,},actions:_.extend(this.toolbarActions,{other:otherItems}),});return this.sidebar.appendTo($node).then(function(){self._updateSidebar();});}
return Promise.resolve();},saveRecord:function(){var self=this;return this._super.apply(this,arguments).then(function(changedFields){self._setTitle(self.getTitle());self._updateEnv();if(_t.database.multi_lang&&changedFields.length){var fields=self.renderer.state.fields;var data=self.renderer.state.data;var alertFields={};for(var k=0;k<changedFields.length;k++){var field=fields[changedFields[k]];var fieldData=data[changedFields[k]];if(field.translate&&fieldData&&fieldData!=='<p><br></p>'){alertFields[changedFields[k]]=field;}}
if(!_.isEmpty(alertFields)){self.renderer.updateAlertFields(alertFields);}}
return changedFields;});},update:function(params,options){if('currentId'in params&&!params.currentId){this.mode='edit';}
params=_.extend({viewType:'form',mode:this.mode},params);return this._super(params,options);},_applyChanges:async function(){const result=await this._super.apply(this,arguments);core.bus.trigger('DOM_updated');return result;},_archive:function(ids,archive){if(ids.length===0){return Promise.resolve();}
if(archive){return this.model.actionArchive(ids,this.handle).then(this.update.bind(this,{},{reload:false}));}else{return this.model.actionUnarchive(ids,this.handle).then(this.update.bind(this,{},{reload:false}));}},_assignSaveCancelKeyboardBehavior:function($saveCancelButtonContainer){var self=this;$saveCancelButtonContainer.children().on('keydown',function(e){switch(e.which){case $.ui.keyCode.ENTER:e.preventDefault();self.saveRecord();break;case $.ui.keyCode.ESCAPE:e.preventDefault();self._discardChanges();break;case $.ui.keyCode.TAB:if(!e.shiftKey&&e.target.classList.contains('btn-primary')){$saveCancelButtonContainer.tooltip('show');e.preventDefault();}
break;}});},_confirmSave:function(id){if(id===this.handle){if(this.mode==='readonly'){return this.reload();}else{return this._setMode('readonly');}}else{var record=this.model.get(this.handle);var containsChangedRecord=function(value){return _.isObject(value)&&(value.id===id||_.find(value.data,containsChangedRecord));};var changedFields=_.findKey(record.data,containsChangedRecord);return this.renderer.confirmChange(record,record.id,[changedFields]);}},_disableButtons:function(){this._super.apply(this,arguments);this.renderer.disableButtons();},_enableButtons:function(){this._super.apply(this,arguments);this.renderer.enableButtons();},_isPagerVisible:function(){return!this.model.isNew(this.handle);},_onDeletedRecords:function(){var state=this.model.get(this.handle,{raw:true});if(!state.res_ids.length){this.trigger_up('history_back');}else{this._super.apply(this,arguments);}},_pushState:function(state){state=state||{};var env=this.model.get(this.handle,{env:true});state.id=env.currentId;this._super(state);},_rejectSave:function(){if(this.mode==='readonly'){return this.reload();}
return this._super.apply(this,arguments);},_setMode:function(mode,recordID){if((recordID||this.handle)===this.handle){this.model.unfreezeOrder(this.handle);}
if(this.mode!==mode){this.renderer.resetLastActivatedField();}
return this._super.apply(this,arguments);},_update:function(){var self=this;return this._super.apply(this,arguments).then(function(){var title=self.getTitle();self._setTitle(title);self._updateButtons();self._updateSidebar();self.autofocus();});},_updateButtons:function(){if(this.$buttons){if(this.footerToButtons){var $footer=this.renderer.$('footer');if($footer.length){this.$buttons.empty().append($footer);}}
var edit_mode=(this.mode==='edit');this.$buttons.find('.o_form_buttons_edit').toggleClass('o_hidden',!edit_mode);this.$buttons.find('.o_form_buttons_view').toggleClass('o_hidden',edit_mode);}},_updateSidebar:function(){if(this.sidebar){this.sidebar.do_toggle(this.mode==='readonly');var archive_item=_.find(this.sidebar.items.other,function(item){return item.classname&&item.classname.includes('o_sidebar_item_archive')})
var unarchive_item=_.find(this.sidebar.items.other,function(item){return item.classname&&item.classname.includes('o_sidebar_item_unarchive')})
if(archive_item&&unarchive_item){if(this.renderer.state.data.active){archive_item.classname='o_sidebar_item_archive';unarchive_item.classname='o_sidebar_item_unarchive o_hidden';}else{archive_item.classname='o_sidebar_item_archive o_hidden';unarchive_item.classname='o_sidebar_item_unarchive';}}}},_onBounceEdit:function(){if(this.$buttons){this.$buttons.find('.o_form_button_edit').odooBounce();}},_onButtonClicked:function(ev){ev.stopPropagation();var self=this;var def;this._disableButtons();function saveAndExecuteAction(){return self.saveRecord(self.handle,{stayInEdit:true,}).then(function(){var record=self.model.get(ev.data.record.id);return self._callButtonAction(attrs,record);});}
var attrs=ev.data.attrs;if(attrs.confirm){def=new Promise(function(resolve,reject){Dialog.confirm(self,attrs.confirm,{confirm_callback:saveAndExecuteAction,}).on("closed",null,resolve);});}else if(attrs.special==='cancel'){def=this._callButtonAction(attrs,ev.data.record);}else if(!attrs.special||attrs.special==='save'){def=saveAndExecuteAction();}else{console.warn('Unhandled button event',ev);return;}
def.then(function(){self._enableButtons();if(attrs.close){self.trigger_up('close_dialog');}}).guardedCatch(this._enableButtons.bind(this));},_onCreate:function(){this.createRecord();},_onDeleteRecord:function(){this._deleteRecords([this.handle]);},_onDiscard:function(){this._discardChanges();},_onDuplicateRecord:function(){var self=this;this.model.duplicateRecord(this.handle).then(function(handle){self.handle=handle;self._updateEnv();self._setMode('edit');});},_onEdit:function(){this.mutex.getUnlockedDef().then(this._setMode.bind(this,'edit'));},_onEditedList:function(ev){ev.stopPropagation();if(ev.data.id){this.model.save(ev.data.id,{savePoint:true});}
this.model.freezeOrder(ev.data.id);},_onFocusControlButton:function(e){if(this.$buttons){e.stopPropagation();this.$buttons.find('.btn-primary:visible:first()').focus();}},_onFormDialogDiscarded:function(ev){ev.stopPropagation();var isFocused=this.renderer.focusLastActivatedWidget();if(ev.data.callback){ev.data.callback(_.str.toBool(isFocused));}},_onOpenOne2ManyRecord:async function(ev){ev.stopPropagation();var data=ev.data;var record;if(data.id){record=this.model.get(data.id,{raw:true});}
await this.model.mutex.getUnlockedDef();new dialogs.FormViewDialog(this,{context:data.context,domain:data.domain,fields_view:data.fields_view,model:this.model,on_saved:data.on_saved,on_remove:data.on_remove,parentID:data.parentID,readonly:data.readonly,deletable:record?data.deletable:false,recordID:record&&record.id,res_id:record&&record.res_id,res_model:data.field.relation,shouldSaveLocally:true,title:(record?_t("Open: "):_t("Create "))+(ev.target.string||data.field.string),}).open();},_onOpenRecord:function(ev){ev.stopPropagation();var self=this;var record=this.model.get(ev.data.id,{raw:true});new dialogs.FormViewDialog(self,{context:ev.data.context,fields_view:ev.data.fields_view,on_saved:ev.data.on_saved,on_remove:ev.data.on_remove,readonly:ev.data.readonly,deletable:ev.data.deletable,res_id:record.res_id,res_model:record.model,title:_t("Open: ")+ev.data.string,}).open();},_onSave:function(ev){ev.stopPropagation();var self=this;this._disableButtons();this.saveRecord().then(this._enableButtons.bind(this)).guardedCatch(this._enableButtons.bind(this));},_onToggleColumnOrder:function(ev){ev.stopPropagation();var self=this;this.model.setSort(ev.data.id,ev.data.name).then(function(){var field=ev.data.field;var state=self.model.get(self.handle);self.renderer.confirmChange(state,state.id,[field]);});},_toggleArchiveState:function(archive){this._archive([this.handle],archive);},});return FormController;});;

/* /web/static/src/js/views/form/form_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.FormView',function(require){"use strict";var BasicView=require('web.BasicView');var config=require('web.config');var Context=require('web.Context');var core=require('web.core');var FormController=require('web.FormController');var FormRenderer=require('web.FormRenderer');var _lt=core._lt;var FormView=BasicView.extend({config:_.extend({},BasicView.prototype.config,{Renderer:FormRenderer,Controller:FormController,}),display_name:_lt('Form'),icon:'fa-edit',multi_record:false,withSearchBar:false,searchMenuTypes:[],viewType:'form',init:function(viewInfo,params){var hasSidebar=params.hasSidebar;this._super.apply(this,arguments);var mode=params.mode||(params.currentId?'readonly':'edit');this.loadParams.type='record';if(hasSidebar===undefined){hasSidebar=params.hasSidebar;}
this.controllerParams.hasSidebar=hasSidebar;this.controllerParams.disableAutofocus=params.disable_autofocus;this.controllerParams.toolbarActions=viewInfo.toolbar;this.controllerParams.footerToButtons=params.footerToButtons;var defaultButtons='default_buttons'in params?params.default_buttons:true;this.controllerParams.defaultButtons=defaultButtons;this.controllerParams.mode=mode;this.rendererParams.mode=mode;this.rendererParams.isFromFormViewDialog=params.isFromFormViewDialog;},getController:function(parent){return this._loadSubviews(parent).then(this._super.bind(this,parent));},_extractParamsFromAction:function(action){var params=this._super.apply(this,arguments);var inDialog=action.target==='new';var inline=action.target==='inline';var fullscreen=action.target==='fullscreen';params.withControlPanel=!(inDialog||inline);params.footerToButtons=inDialog;params.hasSearchView=inDialog?false:params.hasSearchView;params.hasSidebar=!inDialog&&!inline;params.searchMenuTypes=inDialog?[]:params.searchMenuTypes;if(inDialog||inline||fullscreen){params.mode='edit';}else if(action.context&&action.context.form_view_initial_mode){params.mode=action.context.form_view_initial_mode;}
return params;},_loadSubviews:function(parent){var self=this;var defs=[];if(this.loadParams&&this.loadParams.fieldsInfo){var fields=this.loadParams.fields;_.each(this.loadParams.fieldsInfo.form,function(attrs,fieldName){var field=fields[fieldName];if(!field){return;}
if(field.type!=='one2many'&&field.type!=='many2many'){return;}
if(attrs.Widget.prototype.useSubview&&!attrs.__no_fetch&&!attrs.views[attrs.mode]){var context={};var regex=/'([a-z]*_view_ref)' *: *'(.*?)'/g;var matches;while(matches=regex.exec(attrs.context)){context[matches[1]]=matches[2];}
var refinedContext=_.pick(self.loadParams.context,function(value,key){return key.indexOf('_view_ref')===-1;});refinedContext.base_model_name=self.controllerParams.modelName;defs.push(parent.loadViews(field.relation,new Context(context,self.userContext,refinedContext).eval(),[[null,attrs.mode==='tree'?'list':attrs.mode]]).then(function(views){for(var viewName in views){attrs.views[viewName]=self._processFieldsView(views[viewName],viewName);attrs.views[viewName].fields=attrs.views[viewName].viewFields;self._processSubViewAttrs(attrs.views[viewName],attrs);}
self._setSubViewLimit(attrs);}));}else{self._setSubViewLimit(attrs);}});}
return Promise.all(defs);},_setSubViewLimit:function(attrs){var view=attrs.views&&attrs.views[attrs.mode];var limit=view&&view.arch.attrs.limit&&parseInt(view.arch.attrs.limit,10);attrs.limit=limit||attrs.Widget.prototype.limit||40;},});return FormView;});;

/* /web/static/src/js/views/graph/graph_model.js defined in bundle 'web.assets_backend' */
odoo.define('web.GraphModel',function(require){"use strict";var core=require('web.core');const{DEFAULT_INTERVAL,rank}=require('web.controlPanelViewParameters');var _t=core._t;var AbstractModel=require('web.AbstractModel');return AbstractModel.extend({init:function(){this._super.apply(this,arguments);this.chart=null;},get:function(){var self=this;return _.extend({},this.chart,{comparisonFieldIndex:self._getComparisonFieldIndex(),});},load:function(params){var groupBys=params.context.graph_groupbys||params.groupBys;this.initialGroupBys=groupBys;this.fields=params.fields;this.modelName=params.modelName;this.chart={comparisonField:params.comparisonField,comparisonTimeRange:params.comparisonTimeRange,comparisonTimeRangeDescription:params.comparisonTimeRangeDescription,compare:params.compare,context:params.context,dataPoints:[],domain:params.domain,groupBy:params.groupedBy.length?params.groupedBy:groupBys,measure:params.context.graph_measure||params.measure,mode:params.context.graph_mode||params.mode,origins:[],stacked:params.stacked,timeRange:params.timeRange,timeRangeDescription:params.timeRangeDescription,};this.chart.processedGroupBy=this._processGroupBy(this.chart.groupBy);return this._loadGraph(this._getDomains());},reload:function(handle,params){if('context'in params){this.chart.context=params.context;this.chart.groupBy=params.context.graph_groupbys||this.chart.groupBy;this.chart.measure=params.context.graph_measure||this.chart.measure;this.chart.mode=params.context.graph_mode||this.chart.mode;var timeRangeMenuData=params.context.timeRangeMenuData;if(timeRangeMenuData){this.chart.comparisonField=timeRangeMenuData.comparisonField||undefined;this.chart.comparisonTimeRange=timeRangeMenuData.comparisonTimeRange||[];this.chart.compare=this.chart.comparisonTimeRange.length>0;this.chart.comparisonTimeRangeDescription=timeRangeMenuData.comparisonTimeRangeDescription;this.chart.timeRange=timeRangeMenuData.timeRange||[];this.chart.timeRangeDescription=timeRangeMenuData.timeRangeDescription;}else{this.chart.comparisonField=undefined;this.chart.comparisonTimeRange=[];this.chart.compare=false;this.chart.comparisonTimeRangeDescription=undefined;this.chart.timeRange=[];this.chart.timeRangeDescription=undefined;}}
if('domain'in params){this.chart.domain=params.domain;}
if('groupBy'in params){this.chart.groupBy=params.groupBy.length?params.groupBy:this.initialGroupBys;}
if('measure'in params){this.chart.measure=params.measure;}
this.chart.processedGroupBy=this._processGroupBy(this.chart.groupBy);if('mode'in params){this.chart.mode=params.mode;return Promise.resolve();}
if('stacked'in params){this.chart.stacked=params.stacked;return Promise.resolve();}
return this._loadGraph(this._getDomains());},_getComparisonFieldIndex:function(){var groupBys=this.chart.processedGroupBy.map(function(gb){return gb.split(":")[0];});return groupBys.indexOf(this.chart.comparisonField);},_getDomains:function(){var domains=[this.chart.domain.concat(this.chart.timeRange)];this.chart.origins=[this.chart.timeRangeDescription||""];if(this.chart.compare){domains.push(this.chart.domain.concat(this.chart.comparisonTimeRange));this.chart.origins.push(this.chart.comparisonTimeRangeDescription);}
return domains;},_loadGraph:function(domains){var self=this;this.chart.dataPoints=[];var groupBy=this.chart.processedGroupBy;var fields=_.map(groupBy,function(groupBy){return groupBy.split(':')[0];});const loadId=this.loadId?++this.loadId:1;this.loadId=loadId;if(this.chart.measure!=='__count__'){if(this.fields[this.chart.measure].type==='many2one'){fields=fields.concat(this.chart.measure+":count_distinct");}
else{fields=fields.concat(this.chart.measure);}}
var context=_.extend({fill_temporal:true},this.chart.context);var defs=[];domains.forEach(function(domain,originIndex){defs.push(self._rpc({model:self.modelName,method:'read_group',context:context,domain:domain,fields:fields,groupBy:groupBy,lazy:false,}).then(self._processData.bind(self,originIndex,loadId)));});return Promise.all(defs);},_processData:function(originIndex,loadId,rawData){if(loadId<this.loadId){return;}
var self=this;var isCount=this.chart.measure==='__count__';var labels;function getLabels(dataPt){return self.chart.processedGroupBy.map(function(field){return self._sanitizeValue(dataPt[field],field.split(":")[0]);});}
rawData.forEach(function(dataPt){labels=getLabels(dataPt);var count=dataPt.__count||dataPt[self.chart.processedGroupBy[0]+'_count']||0;var value=isCount?count:dataPt[self.chart.measure];if(value instanceof Array){value=1;}
self.chart.dataPoints.push({resId:dataPt[self.chart.groupBy[0]]instanceof Array?dataPt[self.chart.groupBy[0]][0]:-1,count:count,value:value,labels:labels,originIndex:originIndex,});});},_processGroupBy:function(groupBy){const groupBysMap=new Map();for(const gb of groupBy){let[fieldName,interval]=gb.split(':');const field=this.fields[fieldName];if(['date','datetime'].includes(field.type)){interval=interval||DEFAULT_INTERVAL;}
if(groupBysMap.has(fieldName)){const registeredInterval=groupBysMap.get(fieldName);if(rank(registeredInterval)<rank(interval)){groupBysMap.set(fieldName,interval);}}else{groupBysMap.set(fieldName,interval);}}
return[...groupBysMap].map(([fieldName,interval])=>{if(interval){return`${fieldName}:${interval}`;}
return fieldName;});},_sanitizeValue:function(value,fieldName){if(value===false&&this.fields[fieldName].type!=='boolean'){return _t("Undefined");}
if(value instanceof Array){return value[1];}
if(fieldName&&(this.fields[fieldName].type==='selection')){var selected=_.where(this.fields[fieldName].selection,{0:value})[0];return selected?selected[1]:value;}
return value;},});});;

/* /web/static/src/js/views/graph/graph_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.GraphController',function(require){"use strict";var core=require('web.core');var AbstractController=require('web.AbstractController');var GroupByMenuMixin=require('web.GroupByMenuMixin');var qweb=core.qweb;var GraphController=AbstractController.extend(GroupByMenuMixin,{init:function(parent,model,renderer,params){GroupByMenuMixin.init.call(this);this._super.apply(this,arguments);this.measures=params.measures;this.isEmbedded=params.isEmbedded;this.groupableFields=params.groupableFields;},start:function(){this.$el.addClass('o_graph_controller');return this._super.apply(this,arguments);},destroy:function(){if(this.$buttons){this.$buttons.find('button').off().tooltip('dispose');}
this._super.apply(this,arguments);},getOwnedQueryParams:function(){var state=this.model.get();return{context:{graph_measure:state.measure,graph_mode:state.mode,graph_groupbys:state.groupBy,}};},renderButtons:function($node){if($node){var context={measures:_.sortBy(_.pairs(_.omit(this.measures,'__count__')),function(x){return x[1].string.toLowerCase();}),};this.$buttons=$(qweb.render('GraphView.buttons',context));this.$measureList=this.$buttons.find('.o_graph_measures_list');this.$buttons.find('button').tooltip();this.$buttons.click(this._onButtonClick.bind(this));this._updateButtons();this.$buttons.appendTo($node);if(this.isEmbedded){this._addGroupByMenu($node,this.groupableFields).then(function(){var groupByButton=$node.find('.o_dropdown_toggler_btn');groupByButton.removeClass("o_dropdown_toggler_btn btn btn-secondary dropdown-toggle");groupByButton.addClass("btn dropdown-toggle btn-outline-secondary");});}}},_setGroupby:function(groupBy){this.update({groupBy:groupBy});},_setMode:function(mode){this.update({mode:mode});this._updateButtons();},_setMeasure:function(measure){var self=this;this.update({measure:measure}).then(function(){self._updateButtons();});},_toggleStackMode:function(stacked){this.update({stacked:stacked});this._updateButtons();},_update:function(){this._updateButtons();return this._super.apply(this,arguments);},_updateButtons:function(){if(!this.$buttons){return;}
var state=this.model.get();this.$buttons.find('.o_graph_button').removeClass('active');this.$buttons.find('.o_graph_button[data-mode="'+state.mode+'"]').addClass('active');this.$buttons.find('.o_graph_button[data-mode="stack"]').data('stacked',state.stacked).toggleClass('active',state.stacked).toggleClass('o_hidden',state.mode!=='bar');_.each(this.$measureList.find('.dropdown-item'),function(item){var $item=$(item);$item.toggleClass('selected',$item.data('field')===state.measure);});},_onButtonClick:function(ev){var $target=$(ev.target);var field;if($target.hasClass('o_graph_button')){if(_.contains(['bar','line','pie'],$target.data('mode'))){this._setMode($target.data('mode'));}else if($target.data('mode')==='stack'){this._toggleStackMode(!$target.data('stacked'));}}else if($target.parents('.o_graph_measures_list').length){ev.preventDefault();ev.stopPropagation();field=$target.data('field');this._setMeasure(field);}},});return GraphController;});;

/* /web/static/src/js/views/graph/graph_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.GraphRenderer',function(require){"use strict";var AbstractRenderer=require('web.AbstractRenderer');var config=require('web.config');var core=require('web.core');var dataComparisonUtils=require('web.dataComparisonUtils');var fieldUtils=require('web.field_utils');var _t=core._t;var DateClasses=dataComparisonUtils.DateClasses;var qweb=core.qweb;var CHART_TYPES=['pie','bar','line'];var COLORS=["#1f77b4","#ff7f0e","#aec7e8","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"];var COLOR_NB=COLORS.length;function hexToRGBA(hex,opacity){var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);var rgb=result.slice(1,4).map(function(n){return parseInt(n,16);}).join(',');return'rgba('+rgb+','+opacity+')';}
var FORMAT_OPTIONS={humanReadable:function(value){return Math.abs(value)>=1000;},minDigits:1,decimals:2,formatterCallback:function(str){return str;},};var NO_DATA=[_t('No data')];NO_DATA.isNoData=true;var MAX_LEGEND_LENGTH=4*(Math.max(1,config.device.size_class));return AbstractRenderer.extend({className:"o_graph_renderer",init:function(parent,state,params){this._super.apply(this,arguments);this.isEmbedded=params.isEmbedded||false;this.title=params.title||'';this.fields=params.fields||{};this.chart=null;this.chartId=_.uniqueId('chart');this.$legendTooltip=null;this.$tooltip=null;},updateState:function(){return this._super.apply(this,arguments);},on_attach_callback:function(){this._super.apply(this,arguments);this.isInDOM=true;this._render();},on_detach_callback:function(){this._super.apply(this,arguments);this.isInDOM=false;},_adjustTooltipHeight:function(maxTooltipHeight){var sizeOneLine=this.$tooltip.find('tbody tr')[0].clientHeight;var tbodySize=this.$tooltip.find('tbody')[0].clientHeight;var toKeep=Math.floor((maxTooltipHeight-(this.$tooltip[0].clientHeight-tbodySize))/sizeOneLine)-1;var $lines=this.$tooltip.find('tbody tr');var toRemove=$lines.length-toKeep;if(toRemove>0){$lines.slice(toKeep).remove();var tr=document.createElement('tr');var td=document.createElement('td');tr.classList.add('o_show_more');td.innerHTML=_t("...");tr.appendChild(td);this.$tooltip.find('tbody').append(tr);}},_customTooltip:function(tooltipModel){if(this.$tooltip){this.$tooltip.remove();}
if(tooltipModel.opacity===0){return;}
if(tooltipModel.dataPoints.length===0){return;}
const chartArea=this.chart.chartArea;const chartAreaLeft=chartArea.left;const chartAreaRight=chartArea.right;const chartAreaTop=chartArea.top;const rendererTop=this.$el[0].getBoundingClientRect().top;const maxTooltipLabelWidth=Math.floor((chartAreaRight-chartAreaLeft)/1.68)+'px';const tooltipItems=this._getTooltipItems(tooltipModel);this.$tooltip=$(qweb.render('GraphView.CustomTooltip',{measure:this.fields[this.state.measure].string,tooltipItems:tooltipItems,maxWidth:maxTooltipLabelWidth,})).css({top:'2px',left:'2px'});const $container=this.$el.find('.o_graph_canvas_container');$container.append(this.$tooltip);let top;const tooltipHeight=this.$tooltip[0].clientHeight;const minTopAllowed=Math.floor(chartAreaTop);const maxTopAllowed=Math.floor(window.innerHeight-rendererTop-tooltipHeight)-2;const y=Math.floor(tooltipModel.y);if(minTopAllowed<=maxTopAllowed){if(y<=maxTopAllowed){if(y>=minTopAllowed){top=y;}else{top=minTopAllowed;}}else{top=maxTopAllowed;}}else{top=minTopAllowed;const maxTooltipHeight=window.innerHeight-(rendererTop+chartAreaTop)-2;this._adjustTooltipHeight(maxTooltipHeight);}
this.$tooltip[0].style.top=Math.floor(top)+'px';this._fixTooltipLeftPosition(this.$tooltip[0],tooltipModel.x);},_filterDataPoints:function(){var dataPoints=[];if(_.contains(['bar','pie'],this.state.mode)){dataPoints=this.state.dataPoints.filter(function(dataPt){return dataPt.count>0;});}else if(this.state.mode==='line'){var counts=0;this.state.dataPoints.forEach(function(dataPt){if(dataPt.labels[0]!==_t("Undefined")){dataPoints.push(dataPt);}
counts+=dataPt.count;});if(counts===0){dataPoints=[];}}
return dataPoints;},_fixTooltipLeftPosition:function(tooltip,x){let left;const tooltipWidth=tooltip.clientWidth;const minLeftAllowed=Math.floor(this.chart.chartArea.left+2);const maxLeftAllowed=Math.floor(this.chart.chartArea.right-tooltipWidth-2);x=Math.floor(x);if(x<=maxLeftAllowed){if(x>=minLeftAllowed){left=x;}else{left=minLeftAllowed;}}else{left=maxLeftAllowed;}
tooltip.style.left=left+'px';},_formatValue:function(value){var measureField=this.fields[this.state.measure];var formatter=fieldUtils.format.float;var formatedValue=formatter(value,measureField,FORMAT_OPTIONS);return formatedValue;},_getColor:function(index){return COLORS[index%COLOR_NB];},_getDatasetDataLength:function(originIndex,defaultLength){if(_.contains(['bar','line'],this.state.mode)&&this.state.comparisonFieldIndex===0){return this.dateClasses.dateSets[originIndex].length;}
return defaultLength;},_getDatasetLabel:function(dataPt){if(_.contains(['bar','line'],this.state.mode)){var datasetLabel=dataPt.labels.slice(1).join("/");if(this.state.origins.length>1){datasetLabel=this.state.origins[dataPt.originIndex]+
(datasetLabel?('/'+datasetLabel):'');}
datasetLabel=datasetLabel||this.fields[this.state.measure].string;return datasetLabel;}
return this.state.origins[dataPt.originIndex];},_getElementOptions:function(){var elementOptions={};if(this.state.mode==='bar'){elementOptions.rectangle={borderWidth:1};}else if(this.state.mode==='line'){elementOptions.line={tension:0,fill:false,};}
return elementOptions;},_getDateClasses:function(dataPoints){var self=this;var dateSets=this.state.origins.map(function(){return[];});dataPoints.forEach(function(dataPt){dateSets[dataPt.originIndex].push(dataPt.labels[self.state.comparisonFieldIndex]);});dateSets=dateSets.map(function(dateSet){return _.uniq(dateSet);});return new DateClasses(dateSets);},_getLabel:function(dataPt){var i=this.state.comparisonFieldIndex;if(_.contains(['bar','line'],this.state.mode)){if(i===0){return[this.dateClasses.dateClass(dataPt.originIndex,dataPt.labels[i])];}else{return dataPt.labels.slice(0,1);}}else if(i===0){return Array.prototype.concat.apply([],[this.dateClasses.dateClass(dataPt.originIndex,dataPt.labels[i]),dataPt.labels.slice(i+1)]);}else{return dataPt.labels;}},_getLegendOptions:function(datasetsCount){var legendOptions={display:datasetsCount<=MAX_LEGEND_LENGTH,position:'top',onHover:this._onlegendTooltipHover.bind(this),onLeave:this._onLegendTootipLeave.bind(this),};var self=this;if(_.contains(['bar','line'],this.state.mode)){var referenceColor;if(this.state.mode==='bar'){referenceColor='backgroundColor';}else{referenceColor='borderColor';}
legendOptions.labels={generateLabels:function(chart){var data=chart.data;return data.datasets.map(function(dataset,i){return{text:self._shortenLabel(dataset.label),fullText:dataset.label,fillStyle:dataset[referenceColor],hidden:!chart.isDatasetVisible(i),lineCap:dataset.borderCapStyle,lineDash:dataset.borderDash,lineDashOffset:dataset.borderDashOffset,lineJoin:dataset.borderJoinStyle,lineWidth:dataset.borderWidth,strokeStyle:dataset[referenceColor],pointStyle:dataset.pointStyle,datasetIndex:i,};});},};}else{legendOptions.labels={generateLabels:function(chart){var data=chart.data;var metaData=data.datasets.map(function(dataset,index){return chart.getDatasetMeta(index).data;});return data.labels.map(function(label,i){var hidden=metaData.reduce(function(hidden,data){if(data[i]){hidden=hidden||data[i].hidden;}
return hidden;},false);var fullText=self._relabelling(label);var text=self._shortenLabel(fullText);return{text:text,fullText:fullText,fillStyle:label.isNoData?'#d3d3d3':self._getColor(i),hidden:hidden,index:i,};});},};}
return legendOptions;},_getScaleOptions:function(){var self=this;if(_.contains(['bar','line'],this.state.mode)){return{xAxes:[{type:'category',scaleLabel:{display:this.state.processedGroupBy.length&&!this.isEmbedded,labelString:this.state.processedGroupBy.length?this.fields[this.state.processedGroupBy[0].split(':')[0]].string:'',},ticks:{callback:function(label){return self._relabelling(label);},},}],yAxes:[{type:'linear',scaleLabel:{display:!this.isEmbedded,labelString:this.fields[this.state.measure].string,},ticks:{callback:this._formatValue.bind(this),suggestedMax:0,suggestedMin:0,}}],};}
return{};},_getTooltipItemContent:function(item,data){var dataset=data.datasets[item.datasetIndex];var label=data.labels[item.index];var value;var boxColor;if(this.state.mode==='bar'){label=this._relabelling(label,dataset.originIndex);if(this.state.processedGroupBy.length>1||this.state.origins.length>1){label=label+"/"+dataset.label;}
value=this._formatValue(item.yLabel);boxColor=dataset.backgroundColor;}else if(this.state.mode==='line'){label=this._relabelling(label,dataset.originIndex);if(this.state.processedGroupBy.length>1||this.state.origins.length>1){label=label+"/"+dataset.label;}
value=this._formatValue(item.yLabel);boxColor=dataset.borderColor;}else{if(label.isNoData){value=this._formatValue(0);}else{value=this._formatValue(dataset.data[item.index]);}
label=this._relabelling(label,dataset.originIndex);if(this.state.origins.length>1){label=dataset.label+"/"+label;}
boxColor=dataset.backgroundColor[item.index];}
return{label:label,value:value,boxColor:boxColor,};},_getTooltipItems:function(tooltipModel){var self=this;var data=this.chart.config.data;var orderedItems=tooltipModel.dataPoints.sort(function(dPt1,dPt2){return dPt2.yLabel-dPt1.yLabel;});return orderedItems.reduce(function(acc,item){acc.push(self._getTooltipItemContent(item,data));return acc;},[]);},_getTooltipOptions:function(){var tooltipOptions={enabled:false,custom:this._customTooltip.bind(this),};if(this.state.mode==='line'){tooltipOptions.mode='index';tooltipOptions.intersect=false;}
return tooltipOptions;},_indexOf:function(list,label){var index=-1;for(var j=0;j<list.length;j++){var otherLabel=list[j];if(label.length===otherLabel.length){var equal=true;for(var i=0;i<label.length;i++){if(label[i]!==otherLabel[i]){equal=false;}}
if(equal){index=j;break;}}}
return index;},_prepareData:function(dataPoints){var self=this;var labelMap={};var labels=dataPoints.reduce(function(acc,dataPt){var label=self._getLabel(dataPt);var labelKey=dataPt.resId+':'+JSON.stringify(label);var index=labelMap[labelKey];if(index===undefined){labelMap[labelKey]=dataPt.labelIndex=acc.length;acc.push(label);}
else{dataPt.labelIndex=index;}
return acc;},[]);var newDataset=function(datasetLabel,originIndex){var data=new Array(self._getDatasetDataLength(originIndex,labels.length)).fill(0);return{label:datasetLabel,data:data,originIndex:originIndex,};};var datasets=_.values(dataPoints.reduce(function(acc,dataPt){var datasetLabel=self._getDatasetLabel(dataPt);if(!(datasetLabel in acc)){acc[datasetLabel]=newDataset(datasetLabel,dataPt.originIndex);}
var labelIndex=dataPt.labelIndex;acc[datasetLabel].data[labelIndex]=dataPt.value;return acc;},{}));datasets=datasets.sort(function(dataset1,dataset2){return dataset1.originIndex-dataset2.originIndex;});return{datasets:datasets,labels:labels,};},_prepareOptions:function(datasetsCount){return{maintainAspectRatio:false,scales:this._getScaleOptions(),legend:this._getLegendOptions(datasetsCount),tooltips:this._getTooltipOptions(),elements:this._getElementOptions(),};},_relabelling:function(label,originIndex){if(label.isNoData){return label[0];}
var i=this.state.comparisonFieldIndex;if(_.contains(['bar','line'],this.state.mode)&&i===0){return this.dateClasses.representative(label,originIndex)||'';}else if(this.state.mode==='pie'&&i===0){var labelCopy=label.slice(0);if(originIndex!==undefined){labelCopy.splice(i,1,this.dateClasses.representative(label[i],originIndex));}else{labelCopy.splice(i,1,this.dateClasses.dateClassMembers(label[i]));}
return labelCopy.join('/');}
return label.join('/')||_t('Total');},_render:function(){if(this.chart){this.chart.destroy();}
this.$el.empty();if(!_.contains(CHART_TYPES,this.state.mode)){this.trigger_up('warning',{title:_t('Invalid mode for chart'),message:_t('Cannot render chart with mode : ')+this.state.mode});}
var dataPoints=this._filterDataPoints();if(!dataPoints.length&&this.state.mode!=='pie'){this.$el.append(qweb.render('View.NoContentHelper'));}else if(this.isInDOM){var $canvasContainer=$('<div/>',{class:'o_graph_canvas_container'});var $canvas=$('<canvas/>').attr('id',this.chartId);$canvasContainer.append($canvas);this.$el.append($canvasContainer);var i=this.state.comparisonFieldIndex;if(i===0){this.dateClasses=this._getDateClasses(dataPoints);}
if(this.state.mode==='bar'){this._renderBarChart(dataPoints);}else if(this.state.mode==='line'){this._renderLineChart(dataPoints);}else if(this.state.mode==='pie'){this._renderPieChart(dataPoints);}
this._renderTitle();}
return this._super.apply(this,arguments);},_renderBarChart:function(dataPoints){var self=this;var data=this._prepareData(dataPoints);data.datasets.forEach(function(dataset,index){dataset.stack=self.state.stacked?self.state.origins[dataset.originIndex]:undefined;var color=self._getColor(index);dataset.backgroundColor=color;});var options=this._prepareOptions(data.datasets.length);var ctx=document.getElementById(this.chartId);this.chart=new Chart(ctx,{type:'bar',data:data,options:options,});},_renderLineChart:function(dataPoints){var self=this;var data=this._prepareData(dataPoints);data.datasets.forEach(function(dataset,index){if(self.state.processedGroupBy.length<=1&&self.state.origins.length>1){if(dataset.originIndex===0){dataset.fill='origin';dataset.backgroundColor=hexToRGBA(COLORS[0],0.4);dataset.borderColor=hexToRGBA(COLORS[0],1);}else if(dataset.originIndex===1){dataset.borderColor=hexToRGBA(COLORS[1],1);}else{dataset.borderColor=self._getColor(index);}}else{dataset.borderColor=self._getColor(index);}
if(data.labels.length===1){dataset.data.unshift(undefined);}
dataset.pointBackgroundColor=dataset.borderColor;dataset.pointBorderColor='rgba(0,0,0,0.2)';});if(data.datasets.length===1){const dataset=data.datasets[0];dataset.fill='origin';dataset.backgroundColor=hexToRGBA(COLORS[0],0.4);}
data.labels=data.labels.length>1?data.labels:Array.prototype.concat.apply([],[[['']],data.labels,[['']]]);var options=this._prepareOptions(data.datasets.length);var ctx=document.getElementById(this.chartId);this.chart=new Chart(ctx,{type:'line',data:data,options:options,});},_renderPieChart:function(dataPoints){var self=this;var allNegative=true;var someNegative=false;var allZero=true;dataPoints.forEach(function(datapt){allNegative=allNegative&&(datapt.value<0);someNegative=someNegative||(datapt.value<0);allZero=allZero&&(datapt.value===0);});if(someNegative&&!allNegative){this.$el.empty();this.$el.append(qweb.render('View.NoContentHelper',{title:_t("Invalid data"),description:_t("Pie chart cannot mix positive and negative numbers. "+"Try to change your domain to only display positive results"),}));return;}
if(allZero&&!this.isEmbedded&&this.state.origins.length===1){this.$el.empty();this.$el.append(qweb.render('View.NoContentHelper',{title:_t("Invalid data"),description:_t("Pie chart cannot display all zero numbers.. "+"Try to change your domain to display positive results"),}));return;}
var data={};var colors=[];if(allZero){data.labels=[NO_DATA];data.datasets=this.state.origins.map(function(origin){return{label:origin,data:[1],backgroundColor:['#d3d3d3'],};});}else{data=this._prepareData(dataPoints);colors=data.labels.map(function(label,index){return self._getColor(index);});data.datasets.forEach(function(dataset){dataset.backgroundColor=colors;dataset.borderColor='rgba(255,255,255,0.6)';});var representedOriginIndexes=data.datasets.map(function(dataset){return dataset.originIndex;});var addNoDataToLegend=false;var fakeData=(new Array(data.labels.length)).concat([1]);this.state.origins.forEach(function(origin,originIndex){if(!_.contains(representedOriginIndexes,originIndex)){data.datasets.splice(originIndex,0,{label:origin,data:fakeData,backgroundColor:colors.concat(['#d3d3d3']),});addNoDataToLegend=true;}});if(addNoDataToLegend){data.labels.push(NO_DATA);}}
var options=this._prepareOptions(data.datasets.length);var ctx=document.getElementById(this.chartId);this.chart=new Chart(ctx,{type:'pie',data:data,options:options,});},_renderTitle:function(){if(this.title){this.$el.prepend($('<label/>',{text:this.title,}));}},_shortenLabel:function(label){var groups=label.split("/");var shortLabel=groups.slice(0,3).join("/");if(shortLabel.length>30){shortLabel=shortLabel.slice(0,30)+'...';}else if(groups.length>3){shortLabel=shortLabel+'/...';}
return shortLabel;},_onlegendTooltipHover:function(e,legendItem){if(legendItem.text===legendItem.fullText||this.$legendTooltip){return;}
const chartAreaLeft=this.chart.chartArea.left;const chartAreaRight=this.chart.chartArea.right;const rendererTop=this.$el[0].getBoundingClientRect().top;this.$legendTooltip=$('<div>',{class:"o_tooltip_legend",text:legendItem.fullText,css:{maxWidth:Math.floor((chartAreaRight-chartAreaLeft)/1.68)+'px',top:(e.clientY-rendererTop)+'px',}});const $container=this.$el.find('.o_graph_canvas_container');$container.append(this.$legendTooltip);this._fixTooltipLeftPosition(this.$legendTooltip[0],e.clientX);},_onLegendTootipLeave:function(){if(this.$legendTooltip){this.$legendTooltip.remove();this.$legendTooltip=null;}},});});;

/* /web/static/src/js/views/graph/graph_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.GraphView',function(require){"use strict";var AbstractView=require('web.AbstractView');var core=require('web.core');var GraphModel=require('web.GraphModel');var Controller=require('web.GraphController');var GraphRenderer=require('web.GraphRenderer');var _t=core._t;var _lt=core._lt;var controlPanelViewParameters=require('web.controlPanelViewParameters');var GROUPABLE_TYPES=controlPanelViewParameters.GROUPABLE_TYPES;var GraphView=AbstractView.extend({display_name:_lt('Graph'),icon:'fa-bar-chart',jsLibs:['/web/static/lib/Chart/Chart.js',],config:_.extend({},AbstractView.prototype.config,{Model:GraphModel,Controller:Controller,Renderer:GraphRenderer,}),viewType:'graph',searchMenuTypes:['filter','groupBy','timeRange','favorite'],init:function(viewInfo,params){this._super.apply(this,arguments);var self=this;var measure;var groupBys=[];var measures={__count__:{string:_t("Count"),type:"integer"}};var groupableFields={};this.fields.__count__={string:_t("Count"),type:"integer"};this.arch.children.forEach(function(field){var fieldName=field.attrs.name;if(fieldName==="id"){return;}
var interval=field.attrs.interval;if(interval){fieldName=fieldName+':'+interval;}
if(field.attrs.type==='measure'){measure=fieldName;measures[fieldName]=self.fields[fieldName];}else{groupBys.push(fieldName);}});_.each(this.fields,function(field,name){if(name!=='id'&&field.store===true){if(_.contains(['integer','float','monetary'],field.type)||_.contains(params.additionalMeasures,name)){measures[name]=field;}
if(_.contains(GROUPABLE_TYPES,field.type)){groupableFields[name]=field;}}});this.controllerParams.measures=measures;this.controllerParams.groupableFields=groupableFields;this.rendererParams.fields=this.fields;this.rendererParams.title=this.arch.attrs.title;this.loadParams.mode=this.arch.attrs.type||'bar';this.loadParams.measure=measure||'__count__';this.loadParams.groupBys=groupBys;this.loadParams.fields=this.fields;this.loadParams.comparisonDomain=params.comparisonDomain;this.loadParams.stacked=this.arch.attrs.stacked!=="False";},});return GraphView;});;

/* /web/static/src/js/views/kanban/kanban_column.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanColumn',function(require){"use strict";var config=require('web.config');var core=require('web.core');var session=require('web.session');var Dialog=require('web.Dialog');var KanbanRecord=require('web.KanbanRecord');var RecordQuickCreate=require('web.kanban_record_quick_create');var view_dialogs=require('web.view_dialogs');var viewUtils=require('web.viewUtils');var Widget=require('web.Widget');var KanbanColumnProgressBar=require('web.KanbanColumnProgressBar');var _t=core._t;var QWeb=core.qweb;var KanbanColumn=Widget.extend({template:'KanbanView.Group',custom_events:{cancel_quick_create:'_onCancelQuickCreate',quick_create_add_record:'_onQuickCreateAddRecord',tweak_column:'_onTweakColumn',tweak_column_records:'_onTweakColumnRecords',},events:{'click .o_column_edit':'_onEditColumn','click .o_column_delete':'_onDeleteColumn','click .o_kanban_quick_add':'_onAddQuickCreate','click .o_kanban_load_more':'_onLoadMore','click .o_kanban_toggle_fold':'_onToggleFold','click .o_column_archive_records':'_onArchiveRecords','click .o_column_unarchive_records':'_onUnarchiveRecords'},init:function(parent,data,options,recordOptions){this._super(parent);this.db_id=data.id;this.data_records=data.data;this.data=data;var value=data.value;this.id=data.res_id;this.folded=!data.isOpen;this.has_active_field='active'in data.fields;this.fields=data.fields;this.records=[];this.modelName=data.model;this.quick_create=options.quick_create;this.quickCreateView=options.quickCreateView;this.groupedBy=options.groupedBy;this.grouped_by_m2o=options.grouped_by_m2o;this.editable=options.editable;this.deletable=options.deletable;this.archivable=options.archivable;this.draggable=options.draggable;this.KanbanRecord=options.KanbanRecord||KanbanRecord;this.records_editable=options.records_editable;this.records_deletable=options.records_deletable;this.recordsDraggable=options.recordsDraggable;this.relation=options.relation;this.offset=0;this.remaining=data.count-this.data_records.length;if(options.hasProgressBar){this.barOptions={columnID:this.db_id,progressBarStates:options.progressBarStates,};}
this.record_options=_.clone(recordOptions);if(options.grouped_by_m2o){this.title=value?value:_t('Undefined');}else{this.title=value===undefined?_t('Undefined'):value;}
if(options.group_by_tooltip){this.tooltipInfo=_.compact(_.map(options.group_by_tooltip,function(help,field){help=help?help+"</br>":'';return(data.tooltipData&&data.tooltipData[field]&&"<div>"+help+data.tooltipData[field]+"</div>")||'';}));this.tooltipInfo=this.tooltipInfo.join("<div class='dropdown-divider' role='separator' />");}},start:function(){var self=this;var defs=[this._super.apply(this,arguments)];this.$header=this.$('.o_kanban_header');for(var i=0;i<this.data_records.length;i++){defs.push(this._addRecord(this.data_records[i]));}
if(this.recordsDraggable&&!config.device.isMobile){this.$el.sortable({connectWith:'.o_kanban_group',containment:this.draggable?false:'parent',revert:0,delay:0,items:'> .o_kanban_record:not(.o_updating)',cursor:'move',over:function(){self.$el.addClass('o_kanban_hover');},out:function(){self.$el.removeClass('o_kanban_hover');},start:function(event,ui){ui.item.addClass('o_currently_dragged');},stop:function(event,ui){var item=ui.item;setTimeout(function(){item.removeClass('o_currently_dragged');});},update:function(event,ui){var record=ui.item.data('record');var index=self.records.indexOf(record);record.$el.removeAttr('style');if(index>=0){if($.contains(self.$el[0],record.$el[0])){self.trigger_up('kanban_column_resequence',{ids:self._getIDs()});}}else{ui.item.addClass('o_updating');self.trigger_up('kanban_column_add_record',{record:record,ids:self._getIDs()});}}});}
this.$el.click(function(event){if(self.folded){self._onToggleFold(event);}});if(this.barOptions){this.$el.addClass('o_kanban_has_progressbar');this.progressBar=new KanbanColumnProgressBar(this,this.barOptions,this.data);defs.push(this.progressBar.appendTo(this.$header));}
var title=this.folded?this.title+' ('+this.data.count+')':this.title;this.$header.find('.o_column_title').text(title);this.$el.toggleClass('o_column_folded',this.folded&&!config.device.isMobile);if(this.tooltipInfo){this.$header.find('.o_kanban_header_title').tooltip({}).attr('data-original-title',this.tooltipInfo);}
if(!this.remaining){this.$('.o_kanban_load_more').remove();}else{this.$('.o_kanban_load_more').html(QWeb.render('KanbanView.LoadMore',{widget:this}));}
return Promise.all(defs);},on_attach_callback:function(){_.invoke(this.records,'on_attach_callback');if(this.quickCreateWidget){this.quickCreateWidget.on_attach_callback();}},addQuickCreate:function(){if(this.folded){this.trigger_up('column_toggle_fold',{openQuickCreate:true,});return;}
if(this.quickCreateWidget){return Promise.reject();}
this.trigger_up('close_quick_create');this.trigger_up('start_quick_create');var context=this.data.getContext();context['default_'+this.groupedBy]=viewUtils.getGroupValue(this.data,this.groupedBy);this.quickCreateWidget=new RecordQuickCreate(this,{context:context,formViewRef:this.quickCreateView,model:this.modelName,});return this.quickCreateWidget.insertAfter(this.$header);},cancelQuickCreate:function(){if(this.quickCreateWidget){this.quickCreateWidget.cancel();}},isEmpty:function(){return!this.records.length;},_addRecord:function(recordState,options){var record=new this.KanbanRecord(this,recordState,this.record_options);this.records.push(record);if(options&&options.position==='before'){return record.insertAfter(this.quickCreateWidget?this.quickCreateWidget.$el:this.$header);}else{var $load_more=this.$('.o_kanban_load_more');if($load_more.length){return record.insertBefore($load_more);}else{return record.appendTo(this.$el);}}},_cancelQuickCreate:function(){this.quickCreateWidget.destroy();this.quickCreateWidget=undefined;},_getIDs:function(){var ids=[];this.$('.o_kanban_record').each(function(index,r){ids.push($(r).data('record').id);});return ids;},_onAddQuickCreate:function(){this.addQuickCreate();},_onCancelQuickCreate:function(){this._cancelQuickCreate();},_onDeleteColumn:function(event){event.preventDefault();var buttons=[{text:_t("Ok"),classes:'btn-primary',close:true,click:this.trigger_up.bind(this,'kanban_column_delete'),},{text:_t("Cancel"),close:true}];new Dialog(this,{size:'medium',buttons:buttons,$content:$('<div>',{text:_t("Are you sure that you want to remove this column ?")}),}).open();},_onEditColumn:function(event){event.preventDefault();new view_dialogs.FormViewDialog(this,{res_model:this.relation,res_id:this.id,context:session.user_context,title:_t("Edit Column"),on_saved:this.trigger_up.bind(this,'reload'),}).open();},_onLoadMore:function(event){event.preventDefault();this.trigger_up('kanban_load_more');},_onQuickCreateAddRecord:function(event){this.trigger_up('quick_create_record',event.data);},_onToggleFold:function(event){event.preventDefault();this.trigger_up('column_toggle_fold');},_onTweakColumn:function(ev){ev.data.callback(this.$el);},_onTweakColumnRecords:function(ev){_.each(this.records,function(record){ev.data.callback(record.$el,record.state.data);});},_onArchiveRecords:function(event){event.preventDefault();Dialog.confirm(this,_t("Are you sure that you want to archive all the records from this column?"),{confirm_callback:this.trigger_up.bind(this,'kanban_column_records_toggle_active',{archive:true,}),});},_onUnarchiveRecords:function(event){event.preventDefault();this.trigger_up('kanban_column_records_toggle_active',{archive:false,});}});return KanbanColumn;});;

/* /web/static/src/js/views/kanban/kanban_column_progressbar.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanColumnProgressBar',function(require){'use strict';const core=require('web.core');var session=require('web.session');var utils=require('web.utils');var Widget=require('web.Widget');const _t=core._t;var KanbanColumnProgressBar=Widget.extend({template:'KanbanView.ColumnProgressBar',events:{'click .o_kanban_counter_progress':'_onProgressBarParentClick','click .progress-bar':'_onProgressBarClick',},ANIMATE:true,init:function(parent,options,columnState){this._super.apply(this,arguments);this.columnID=options.columnID;this.columnState=columnState;this.fieldName=columnState.progressBarValues.field;this.colors=_.extend({},columnState.progressBarValues.colors,{__false:'muted',});this.sumField=columnState.progressBarValues.sum_field;var state=options.progressBarStates[this.columnID];if(state){this.groupCount=state.groupCount;this.subgroupCounts=state.subgroupCounts;this.totalCounterValue=state.totalCounterValue;this.activeFilter=state.activeFilter;}
var sumFieldInfo=this.sumField&&columnState.fieldsInfo.kanban[this.sumField];var currencyField=sumFieldInfo&&sumFieldInfo.options&&sumFieldInfo.options.currency_field;if(currencyField&&columnState.data.length){this.currency=session.currencies[columnState.data[0].data[currencyField].res_id];}},start:function(){var self=this;this.$bars={};_.each(this.colors,function(val,key){self.$bars[key]=self.$(`.progress-bar[data-filter=${key}]`);});this.$counter=this.$('.o_kanban_counter_side');this.$number=this.$counter.find('b');if(this.currency){var $currency=$('<span/>',{text:this.currency.symbol,});if(this.currency.position==='before'){$currency.prependTo(this.$counter);}else{$currency.appendTo(this.$counter);}}
return this._super.apply(this,arguments).then(function(){var subgroupCounts={};let allSubgroupCount=0;_.each(self.colors,function(val,key){var subgroupCount=self.columnState.progressBarValues.counts[key]||0;if(self.activeFilter===key&&subgroupCount===0){self.activeFilter=false;}
subgroupCounts[key]=subgroupCount;allSubgroupCount+=subgroupCount;});subgroupCounts.__false=self.columnState.count-allSubgroupCount;self.groupCount=self.columnState.count;self.subgroupCounts=subgroupCounts;self.prevTotalCounterValue=self.totalCounterValue;self.totalCounterValue=self.sumField?(self.columnState.aggregateValues[self.sumField]||0):self.columnState.count;self._notifyState();self._render();});},_render:function(){var self=this;this.trigger_up('tweak_column',{callback:function($el){$el.removeClass('o_kanban_group_show');_.each(self.colors,function(val,key){$el.removeClass('o_kanban_group_show_'+val);});if(self.activeFilter){$el.addClass('o_kanban_group_show o_kanban_group_show_'+self.colors[self.activeFilter]);}},});this.trigger_up('tweak_column_records',{callback:function($el,recordData){var categoryValue=recordData[self.fieldName]?recordData[self.fieldName]:'__false';_.each(self.colors,function(val,key){$el.removeClass('oe_kanban_card_'+val);});if(self.colors[categoryValue]){$el.addClass('oe_kanban_card_'+self.colors[categoryValue]);}},});var barNumber=0;var barMinWidth=6;const selection=self.columnState.fields[self.fieldName].selection;_.each(self.colors,function(val,key){var $bar=self.$bars[key];var count=self.subgroupCounts&&self.subgroupCounts[key]||0;if(!$bar){return;}
let value;if(selection){const option=selection.find(option=>option[0]===key);value=option&&option[1]||_t('Other');}else{value=key;}
$bar.attr('data-original-title',count+' '+value);$bar.tooltip({delay:0,trigger:'hover',});$bar.toggleClass('progress-bar-animated progress-bar-striped',key===self.activeFilter);$bar.removeClass('o_bar_has_records transition-off');window.getComputedStyle($bar[0]).getPropertyValue('width');if(count>0){$bar.addClass('o_bar_has_records');var maxWidth=100-barMinWidth*barNumber;self.$('.progress-bar.o_bar_has_records').css('max-width',maxWidth+'%');$bar.css('width',(count*100/self.groupCount)+'%');barNumber++;$bar.attr('aria-valuemin',0);$bar.attr('aria-valuemax',self.groupCount);$bar.attr('aria-valuenow',count);}else{$bar.css('width','');}});this.$('.progress-bar.o_bar_has_records').css('min-width',barMinWidth+'%');var start=this.prevTotalCounterValue;var end=this.totalCounterValue;if(this.activeFilter){if(this.sumField){end=0;_.each(self.columnState.data,function(record){var recordData=record.data;if(self.activeFilter===recordData[self.fieldName]||(self.activeFilter==='__false'&&!recordData[self.fieldName])){end+=parseFloat(recordData[self.sumField]);}});}else{end=this.subgroupCounts[this.activeFilter];}}
this.prevTotalCounterValue=end;var animationClass=start>999?'o_kanban_grow':'o_kanban_grow_huge';if(start!==undefined&&(end>start||this.activeFilter)&&this.ANIMATE){$({currentValue:start}).animate({currentValue:end},{duration:1000,start:function(){self.$counter.addClass(animationClass);},step:function(){self.$number.html(_getCounterHTML(this.currentValue));},complete:function(){self.$number.html(_getCounterHTML(this.currentValue));self.$counter.removeClass(animationClass);},});}else{this.$number.html(_getCounterHTML(end));}
function _getCounterHTML(value){return utils.human_number(value,0,3);}},_notifyState:function(){this.trigger_up('set_progress_bar_state',{columnID:this.columnID,values:{groupCount:this.groupCount,subgroupCounts:this.subgroupCounts,totalCounterValue:this.totalCounterValue,activeFilter:this.activeFilter,},});},_onProgressBarClick:function(ev){this.$clickedBar=$(ev.currentTarget);var filter=this.$clickedBar.data('filter');this.activeFilter=(this.activeFilter===filter?false:filter);this._notifyState();this._render();},_onProgressBarParentClick:function(ev){if(ev.target!==ev.currentTarget){return;}
this.activeFilter=false;this._notifyState();this._render();},});return KanbanColumnProgressBar;});;

/* /web/static/src/js/views/kanban/kanban_column_quick_create.js defined in bundle 'web.assets_backend' */
odoo.define('web.kanban_column_quick_create',function(require){"use strict";var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var Widget=require('web.Widget');var _t=core._t;var QWeb=core.qweb;var ColumnQuickCreate=Widget.extend({template:'KanbanView.ColumnQuickCreate',events:{'click .o_quick_create_folded':'_onUnfold','click .o_kanban_add':'_onAddClicked','click .o_kanban_examples':'_onShowExamples','keydown':'_onKeydown','keypress input':'_onKeypress','blur input':'_onInputBlur','focus input':'_onInputFocus',},init:function(parent,options){this._super.apply(this,arguments);this.examples=options.examples;this.folded=true;this.isMobile=config.device.isMobile;},start:function(){this.$quickCreateFolded=this.$('.o_quick_create_folded');this.$quickCreateUnfolded=this.$('.o_quick_create_unfolded');this.$input=this.$('input');core.bus.on('click',this,this._onWindowClicked);this._update();return this._super.apply(this,arguments);},on_attach_callback:function(){if(!this.folded){this.$input.focus();}},toggleFold:function(){this.folded=!this.folded;this._update();if(!this.folded){this.$input.focus();this.trigger_up('scrollTo',{selector:'.o_column_quick_create'});}},_add:function(){var value=this.$input.val().trim();if(!value.length){this._cancel();return;}
this.$input.val('');this.trigger_up('quick_create_add_column',{value:value});this.$input.focus();},_cancel:function(){if(!this.folded){this.$input.val('');if(!this.isMobile){this.folded=true;this._update();}}},_update:function(){this.$quickCreateFolded.toggle(this.folded);this.$quickCreateUnfolded.toggle(!this.folded);this.trigger_up('quick_create_column_updated');},_onAddClicked:function(event){event.stopPropagation();this._add();},_onInputBlur:function(){this.$('.o_discard_msg').hide();},_onInputFocus:function(){this.$('.o_discard_msg').show();},_onKeydown:function(event){if(event.keyCode===$.ui.keyCode.ESCAPE){this._cancel();}},_onKeypress:function(event){if(event.keyCode===$.ui.keyCode.ENTER){this._add();}},_onShowExamples:function(){var self=this;var dialog=new Dialog(this,{$content:$(QWeb.render('KanbanView.ExamplesDialog',{examples:this.examples,})),buttons:[{classes:'btn-primary float-right',close:true,text:_t('Got it'),}],size:"large",title:"Kanban Examples",}).open();dialog.on('closed',this,function(){self.$input.focus();});},_onUnfold:function(){if(this.folded){this.toggleFold();}},_onWindowClicked:function(event){if(!document.contains(this.el)){return;}
if($(event.target).closest('.modal').length){return;}
if(this.el.contains(event.target)){return;}
this._cancel();},});return ColumnQuickCreate;});;

/* /web/static/src/js/views/kanban/kanban_model.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanModel',function(require){"use strict";var BasicModel=require('web.BasicModel');var viewUtils=require('web.viewUtils');var KanbanModel=BasicModel.extend({addRecordToGroup:function(groupID,resId){var self=this;var group=this.localData[groupID];var new_record=this._makeDataPoint({res_id:resId,modelName:group.model,fields:group.fields,fieldsInfo:group.fieldsInfo,viewType:group.viewType,parentID:groupID,});var def=this._fetchRecord(new_record).then(function(result){group.data.unshift(new_record.id);group.res_ids.unshift(resId);group.count++;self.localData[group.parentID].count++;self._updateParentResIDs(group);return result.id;});return this._reloadProgressBarGroupFromRecord(new_record.id,def);},createGroup:function(name,parentID){var self=this;var parent=this.localData[parentID];var groupBy=parent.groupedBy[0];var groupByField=parent.fields[groupBy];if(!groupByField||groupByField.type!=='many2one'){return Promise.reject();}
return this._rpc({model:groupByField.relation,method:'name_create',args:[name],context:parent.context,}).then(function(result){var newGroup=self._makeDataPoint({modelName:parent.model,context:parent.context,domain:parent.domain.concat([[groupBy,"=",result[0]]]),fields:parent.fields,fieldsInfo:parent.fieldsInfo,isOpen:true,limit:parent.limit,parentID:parent.id,openGroupByDefault:true,orderedBy:parent.orderedBy,value:result,viewType:parent.viewType,});if(parent.progressBar){newGroup.progressBarValues=_.extend({counts:{},},parent.progressBar);}
parent.data.push(newGroup.id);return newGroup.id;});},createRecordInGroup:function(groupID,values){var self=this;var group=this.localData[groupID];var context=this._getContext(group);var parent=this.localData[group.parentID];var groupedBy=parent.groupedBy;context['default_'+groupedBy]=viewUtils.getGroupValue(group,groupedBy);var def;if(Object.keys(values).length===1&&'display_name'in values){def=this._rpc({model:parent.model,method:'name_create',args:[values.display_name],context:context,}).then(function(records){return records[0];});}else{def=this._rpc({model:parent.model,method:'create',args:[values],context:context,});}
return def.then(function(resID){return self.addRecordToGroup(group.id,resID);});},get:function(){var result=this._super.apply(this,arguments);var dp=result&&this.localData[result.id];if(dp){if(dp.tooltipData){result.tooltipData=$.extend(true,{},dp.tooltipData);}
if(dp.progressBarValues){result.progressBarValues=$.extend(true,{},dp.progressBarValues);}
if(dp.fields[dp.groupedBy[0]]){var groupedByM2O=dp.fields[dp.groupedBy[0]].type==='many2one';result.isGroupedByM2ONoColumn=!dp.data.length&&groupedByM2O;}else{result.isGroupedByM2ONoColumn=false;}}
return result;},getColumn:function(id){var element=this.localData[id];if(element){return this.get(element.parentID);}
return null;},load:function(params){this.defaultGroupedBy=params.groupBy;params.groupedBy=(params.groupedBy&&params.groupedBy.length)?params.groupedBy:this.defaultGroupedBy;return this._super(params);},loadColumnRecords:function(groupID){var dataPoint=this.localData[groupID];dataPoint.isOpen=true;return this.reload(groupID);},loadMore:function(groupID){var group=this.localData[groupID];var offset=group.loadMoreOffset+group.limit;return this.reload(group.id,{loadMoreOffset:offset,});},moveRecord:function(recordID,groupID,parentID){var self=this;var parent=this.localData[parentID];var new_group=this.localData[groupID];var changes={};var groupedFieldName=parent.groupedBy[0];var groupedField=parent.fields[groupedFieldName];if(groupedField.type==='many2one'){changes[groupedFieldName]={id:new_group.res_id,display_name:new_group.value,};}else if(groupedField.type==='selection'){var value=_.findWhere(groupedField.selection,{1:new_group.value});changes[groupedFieldName]=value&&value[0]||false;}else{changes[groupedFieldName]=new_group.value;}
var record=self.localData[recordID];var resID=record.res_id;var old_group;for(var i=0;i<parent.data.length;i++){old_group=self.localData[parent.data[i]];var index=_.indexOf(old_group.data,recordID);if(index>=0){old_group.data.splice(index,1);old_group.count--;old_group.res_ids=_.without(old_group.res_ids,resID);self._updateParentResIDs(old_group);break;}}
new_group.data.push(recordID);new_group.res_ids.push(resID);new_group.count++;return this.notifyChanges(recordID,changes,{force_fail:true}).then(function(){return self.save(recordID);}).then(function(){record.parentID=new_group.id;return[old_group.id,new_group.id];});},reload:function(id,options){if(options&&options.groupBy&&!options.groupBy.length){options.groupBy=this.defaultGroupedBy;}
var def=this._super(id,options);if(options&&options.loadMoreOffset){return def;}
return this._reloadProgressBarGroupFromRecord(id,def);},save:function(recordID){var def=this._super.apply(this,arguments);return this._reloadProgressBarGroupFromRecord(recordID,def);},_makeDataPoint:function(params){var dataPoint=this._super.apply(this,arguments);if(params.progressBar){dataPoint.progressBar=params.progressBar;}
return dataPoint;},_load:function(dataPoint,options){if(dataPoint.groupedBy.length&&dataPoint.progressBar){return this._readProgressBarGroup(dataPoint,options);}
return this._super.apply(this,arguments);},_readGroup:function(list){var self=this;if(list.groupedBy.length>1){list.groupedBy=[list.groupedBy[0]];}
return this._super.apply(this,arguments).then(function(result){return self._readTooltipFields(list).then(_.constant(result));});},_readProgressBarGroup:function(list,options){var self=this;var groupsDef=this._readGroup(list,options);var progressBarDef=this._rpc({model:list.model,method:'read_progress_bar',kwargs:{domain:list.domain,group_by:list.groupedBy[0],progress_bar:list.progressBar,context:list.context,},});return Promise.all([groupsDef,progressBarDef]).then(function(results){var data=results[1];_.each(list.data,function(groupID){var group=self.localData[groupID];group.progressBarValues=_.extend({counts:data[group.value]||{},},list.progressBar);});return list;});},_readTooltipFields:function(list){var self=this;var groupedByField=list.fields[list.groupedBy[0].split(':')[0]];if(groupedByField.type!=='many2one'){return Promise.resolve();}
var groupIds=_.reduce(list.data,function(groupIds,id){var res_id=self.get(id,{raw:true}).res_id;if(res_id){groupIds.push(res_id);}
return groupIds;},[]);var tooltipFields=[];var groupedByFieldInfo=list.fieldsInfo.kanban[list.groupedBy[0]];if(groupedByFieldInfo&&groupedByFieldInfo.options){tooltipFields=Object.keys(groupedByFieldInfo.options.group_by_tooltip||{});}
if(groupIds.length&&tooltipFields.length){var fieldNames=_.union(['display_name'],tooltipFields);return this._rpc({model:groupedByField.relation,method:'read',args:[groupIds,fieldNames],context:list.context,}).then(function(result){_.each(list.data,function(id){var dp=self.localData[id];dp.tooltipData=_.findWhere(result,{id:dp.res_id});});});}
return Promise.resolve();},_reloadProgressBarGroupFromRecord:function(recordID,def){var element=this.localData[recordID];if(element.type==='list'&&!element.parentID){return def;}
var self=this;while(element){if(element.progressBar){return def.then(function(data){return self._load(element,{keepEmptyGroups:true,onlyGroups:true,}).then(function(){return data;});});}
element=this.localData[element.parentID];}
return def;},});return KanbanModel;});;

/* /web/static/src/js/views/kanban/kanban_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanController',function(require){"use strict";var BasicController=require('web.BasicController');var Context=require('web.Context');var core=require('web.core');var Dialog=require('web.Dialog');var Domain=require('web.Domain');var view_dialogs=require('web.view_dialogs');var viewUtils=require('web.viewUtils');var _t=core._t;var qweb=core.qweb;var KanbanController=BasicController.extend({buttons_template:'KanbanView.buttons',custom_events:_.extend({},BasicController.prototype.custom_events,{quick_create_add_column:'_onAddColumn',quick_create_record:'_onQuickCreateRecord',resequence_columns:'_onResequenceColumn',button_clicked:'_onButtonClicked',kanban_record_delete:'_onRecordDelete',kanban_record_update:'_onUpdateRecord',kanban_column_delete:'_onDeleteColumn',kanban_column_add_record:'_onAddRecordToColumn',kanban_column_resequence:'_onColumnResequence',kanban_load_more:'_onLoadMore',kanban_load_records:'_onLoadColumnRecords',column_toggle_fold:'_onToggleColumn',kanban_column_records_toggle_active:'_onToggleActiveRecords',}),events:_.extend({},BasicController.prototype.events,{click:'_onClick',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.on_create=params.on_create;this.hasButtons=params.hasButtons;this.quickCreateEnabled=params.quickCreateEnabled;},renderButtons:function($node){if(this.hasButtons&&this.is_action_enabled('create')){this.$buttons=$(qweb.render(this.buttons_template,{btnClass:'btn-primary',widget:this,}));this.$buttons.on('click','button.o-kanban-button-new',this._onButtonNew.bind(this));this.$buttons.on('keydown',this._onButtonsKeyDown.bind(this));this._updateButtons();return Promise.resolve(this.$buttons.appendTo($node));}
return Promise.resolve();},_confirmSave:function(id){var data=this.model.get(this.handle,{raw:true});var grouped=data.groupedBy.length;if(grouped){var columnState=this.model.getColumn(id);return this.renderer.updateColumn(columnState.id,columnState);}
return this.renderer.updateRecord(this.model.get(id));},_isPagerVisible:function(){var state=this.model.get(this.handle,{raw:true});return!!(state.count&&!state.groupedBy.length);},_reloadAfterButtonClick:function(kanbanRecord,params){var self=this;var recordModel=this.model.localData[params.record.id];var group=this.model.localData[recordModel.parentID];var parent=this.model.localData[group.parentID];this.model.reload(params.record.id).then(function(db_id){var data=self.model.get(db_id);kanbanRecord.update(data);var domain=(parent?parent.domain:group.domain)||[];var domInData=_.every(domain,function(d){return d[0]in data.data;});var activeInDomain=_.pluck(domain,0).indexOf('active')!==-1;var activeInData='active'in data.data;if(domInData&&!activeInDomain&&activeInData){domain=domain.concat([['active','=',true]]);}else if(!domInData&&!activeInDomain&&activeInData){domain=[['active','=',true]];}
try{var visible=new Domain(domain).compute(data.evalContext);}catch(e){return;}
if(!visible){kanbanRecord.destroy();}});},_resequenceColumns:function(ids){var state=this.model.get(this.handle,{raw:true});var model=state.fields[state.groupedBy[0]].relation;return this.model.resequence(model,ids,this.handle);},_resequenceRecords:function(column_id,ids){var self=this;return this.model.resequence(this.modelName,ids,column_id).then(function(){self._updateEnv();});},_update:function(){this._updateButtons();return this._super.apply(this,arguments);},_updateButtons:function(){if(this.$buttons){var state=this.model.get(this.handle,{raw:true});var createHidden=this.is_action_enabled('group_create')&&state.isGroupedByM2ONoColumn;this.$buttons.find('.o-kanban-button-new').toggleClass('o_hidden',createHidden);}},_onAddColumn:function(ev){var self=this;this.mutex.exec(function(){return self.model.createGroup(ev.data.value,self.handle).then(function(){var state=self.model.get(self.handle,{raw:true});var ids=_.pluck(state.data,'res_id').filter(_.isNumber);return self._resequenceColumns(ids);}).then(function(){return self.update({},{reload:false});}).then(function(){self._updateButtons();self.renderer.quickCreateToggleFold();self.renderer.trigger_up("quick_create_column_created");});});},_onAddRecordToColumn:function(ev){var self=this;var record=ev.data.record;var column=ev.target;this.alive(this.model.moveRecord(record.db_id,column.db_id,this.handle)).then(function(column_db_ids){return self._resequenceRecords(column.db_id,ev.data.ids).then(function(){_.each(column_db_ids,function(db_id){var data=self.model.get(db_id);self.renderer.updateColumn(db_id,data);});});}).guardedCatch(this.reload.bind(this));},_onButtonClicked:function(ev){var self=this;ev.stopPropagation();var attrs=ev.data.attrs;var record=ev.data.record;var def=Promise.resolve();if(attrs.context){attrs.context=new Context(attrs.context).set_eval_context({active_id:record.res_id,active_ids:[record.res_id],active_model:record.model,});}
if(attrs.confirm){def=new Promise(function(resolve,reject){Dialog.confirm(this,attrs.confirm,{confirm_callback:resolve,cancel_callback:reject,}).on("closed",null,reject);});}
def.then(function(){self.trigger_up('execute_action',{action_data:attrs,env:{context:record.getContext(),currentID:record.res_id,model:record.model,resIDs:record.res_ids,},on_closed:self._reloadAfterButtonClick.bind(self,ev.target,ev.data),});});},_onButtonNew:function(){var self=this;var state=this.model.get(this.handle,{raw:true});var quickCreateEnabled=this.quickCreateEnabled&&viewUtils.isQuickCreateEnabled(state);if(this.on_create==='quick_create'&&quickCreateEnabled&&state.data.length){this.mutex.getUnlockedDef().then(function(){self.renderer.addQuickCreate();});}else if(this.on_create&&this.on_create!=='quick_create'){this.do_action(this.on_create,{on_close:this.reload.bind(this,{}),additional_context:state.context,});}else{this.trigger_up('switch_view',{view_type:'form',res_id:undefined});}},_onButtonsKeyDown:function(ev){switch(ev.keyCode){case $.ui.keyCode.DOWN:this.$('.o_kanban_record:first').focus();}},_onClick:function(ev){var state=this.model.get(this.handle,{raw:true});if(!state.count&&this.buttons){var classesList=['o_kanban_view','o_kanban_group','o_column_quick_create','o_view_nocontent_smiling_face'];var $target=$(ev.target);var hasClassList=_.map(classesList,function(klass){return $target.hasClass(klass)});if(_.some(hasClassList)){this.$buttons.find('.o-kanban-button-new').odooBounce();}}},_onColumnResequence:function(ev){this._resequenceRecords(ev.target.db_id,ev.data.ids);},_onDeleteColumn:function(ev){var self=this;var column=ev.target;var state=this.model.get(this.handle,{raw:true});var relatedModelName=state.fields[state.groupedBy[0]].relation;this.model.deleteRecords([column.db_id],relatedModelName).then(function(){self.update({},{reload:!column.isEmpty()});});},_onLoadColumnRecords:function(ev){var self=this;this.model.loadColumnRecords(ev.data.columnID).then(function(dbID){var data=self.model.get(dbID);return self.renderer.updateColumn(dbID,data).then(function(){self._updateEnv();if(ev.data.onSuccess){ev.data.onSuccess();}});});},_onLoadMore:function(ev){var self=this;var column=ev.target;this.model.loadMore(column.db_id).then(function(db_id){var data=self.model.get(db_id);self.renderer.updateColumn(db_id,data);self._updateEnv();});},_onQuickCreateRecord:function(ev){var self=this;var values=ev.data.values;var column=ev.target;var onFailure=ev.data.onFailure||function(){};var update=function(db_id){self._updateEnv();var columnState=self.model.getColumn(db_id);var state=self.model.get(self.handle);return self.renderer.updateColumn(columnState.id,columnState,{openQuickCreate:true,state:state}).then(function(){if(ev.data.openRecord){self.trigger_up('open_record',{id:db_id,mode:'edit'});}});};this.model.createRecordInGroup(column.db_id,values).then(update).guardedCatch(function(reason){reason.event.preventDefault();var columnState=self.model.get(column.db_id,{raw:true});var context=columnState.getContext();var state=self.model.get(self.handle,{raw:true});var groupedBy=state.groupedBy[0];context['default_'+groupedBy]=viewUtils.getGroupValue(columnState,groupedBy);new view_dialogs.FormViewDialog(self,{res_model:state.model,context:_.extend({default_name:values.name||values.display_name},context),title:_t("Create"),disable_multiple_selection:true,on_saved:function(record){self.model.addRecordToGroup(column.db_id,record.res_id).then(update);},}).open().opened(onFailure);});},_onRecordDelete:function(ev){this._deleteRecords([ev.data.id]);},_onResequenceColumn:function(ev){var self=this;this._resequenceColumns(ev.data.ids).then(function(){self._updateEnv();});},_onToggleColumn:function(ev){var self=this;var column=ev.target;this.model.toggleGroup(column.db_id).then(function(db_id){var data=self.model.get(db_id);var options={openQuickCreate:!!ev.data.openQuickCreate,};self.renderer.updateColumn(db_id,data,options);self._updateEnv();});},_onUpdateRecord:function(ev){var onSuccess=ev.data.onSuccess;delete ev.data.onSuccess;var changes=_.clone(ev.data);ev.data.force_save=true;this._applyChanges(ev.target.db_id,changes,ev).then(onSuccess);},_onToggleActiveRecords:function(ev){var self=this;var archive=ev.data.archive;var column=ev.target;var recordIds=_.pluck(column.records,'db_id');if(recordIds.length){var prom=archive?this.model.actionArchive(recordIds,column.db_id):this.model.actionUnarchive(recordIds,column.db_id);prom.then(function(dbID){if(_.isString(dbID)){var data=self.model.get(dbID);self.renderer.updateColumn(dbID,data);self._updateEnv();}});}},});return KanbanController;});;

/* /web/static/src/js/views/kanban/kanban_examples_registry.js defined in bundle 'web.assets_backend' */
odoo.define('web.kanban_examples_registry',function(require){"use strict";var Registry=require('web.Registry');return new Registry();});;

/* /web/static/src/js/views/kanban/kanban_record.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanRecord',function(require){"use strict";var config=require('web.config');var core=require('web.core');var Domain=require('web.Domain');var Dialog=require('web.Dialog');var field_utils=require('web.field_utils');var utils=require('web.utils');var Widget=require('web.Widget');var widgetRegistry=require('web.widget_registry');var _t=core._t;var QWeb=core.qweb;var KANBAN_RECORD_COLORS=[_t('No color'),_t('Red'),_t('Orange'),_t('Yellow'),_t('Light blue'),_t('Dark purple'),_t('Salmon pink'),_t('Medium blue'),_t('Dark blue'),_t('Fushia'),_t('Green'),_t('Purple'),];var NB_KANBAN_RECORD_COLORS=KANBAN_RECORD_COLORS.length;var KanbanRecord=Widget.extend({events:{'click .oe_kanban_action':'_onKanbanActionClicked','click .o_kanban_manage_toggle_button':'_onManageTogglerClicked',},init:function(parent,state,options){this._super(parent);this.fields=state.fields;this.fieldsInfo=state.fieldsInfo.kanban;this.modelName=state.model;this.options=options;this.editable=options.editable;this.deletable=options.deletable;this.read_only_mode=options.read_only_mode;this.selectionMode=options.selectionMode;this.qweb=options.qweb;this.subWidgets={};this._setState(state);this._onKanbanActionClicked=_.debounce(this._onKanbanActionClicked,300,true);},start:function(){return Promise.all([this._super.apply(this,arguments),this._render()]);},on_attach_callback:function(){this.isInDOM=true;_.invoke(this.subWidgets,'on_attach_callback');},on_detach_callback:function(){this.isInDOM=false;_.invoke(this.subWidgets,'on_detach_callback');},update:function(state){_.invoke(_.pluck(this.subWidgets,'$el'),'detach');this._setState(state);return this._render();},_attachTooltip:function(){var self=this;this.$('[tooltip]').each(function(){var $el=$(this);var tooltip=$el.attr('tooltip');if(tooltip){$el.tooltip({title:self.qweb.render(tooltip,self.qweb_context)});}});},_computeDomain:function(d){return new Domain(d).compute(this.state.evalContext);},_getColorClassname:function(variable){var color=this._getColorID(variable);return'oe_kanban_color_'+color;},_getColorID:function(variable){if(typeof variable==='number'){return Math.round(variable)%NB_KANBAN_RECORD_COLORS;}
if(typeof variable==='string'){var index=0;for(var i=0;i<variable.length;i++){index+=variable.charCodeAt(i);}
return index%NB_KANBAN_RECORD_COLORS;}
return 0;},_getColorname:function(variable){var colorID=this._getColorID(variable);return KANBAN_RECORD_COLORS[colorID];},file_type_magic_word:{'/':'jpg','R':'gif','i':'png','P':'svg+xml',},_getImageURL:function(model,field,id,placeholder){id=(_.isArray(id)?id[0]:id)||false;placeholder=placeholder||"/web/static/src/img/placeholder.png";var isCurrentRecord=this.modelName===model&&this.recordData.id===id;var url;if(isCurrentRecord&&this.record[field]&&this.record[field].raw_value&&!utils.is_bin_size(this.record[field].raw_value)){url='data:image/'+this.file_type_magic_word[this.record[field].raw_value[0]]+';base64,'+this.record[field].raw_value;}else if(!model||!field||!id||(isCurrentRecord&&this.record[field]&&!this.record[field].raw_value)){url=placeholder;}else{var session=this.getSession();var params={model:model,field:field,id:id};if(isCurrentRecord){params.unique=this.record.__last_update&&this.record.__last_update.value.replace(/[^0-9]/g,'');}
url=session.url('/web/image',params);}
return url;},_openRecord:function(){if(this.$el.hasClass('o_currently_dragged')){return;}
var editMode=this.$el.hasClass('oe_kanban_global_click_edit');this.trigger_up('open_record',{id:this.db_id,mode:editMode?'edit':'readonly',});},_processFields:function(){var self=this;this.$("field").each(function(){var $field=$(this);var field_name=$field.attr("name");var field_widget=$field.attr("widget");if(field_widget||self.fields[field_name].type==='many2many'){var widget=self.subWidgets[field_name];if(!widget){var Widget=self.fieldsInfo[field_name].Widget;if(Widget){widget=self._processWidget($field,field_name,Widget);self.subWidgets[field_name]=widget;}else if(config.isDebug()){$field.replaceWith($('<span>',{text:_.str.sprintf(_t('[No widget %s]'),field_widget),}));}}else{widget.reset(self.state);$field.replaceWith(widget.$el);if(self.isInDOM&&widget.on_attach_callback){widget.on_attach_callback();}}}else{self._processField($field,field_name);}});},_processField:function($field,field_name){var field=this.fields[field_name];var value=this.recordData[field_name];var options={data:this.recordData};var formatted_value=field_utils.format[field.type](value,field,options);var $result=$('<span>',{text:formatted_value,});$field.replaceWith($result);this._setFieldDisplay($result,field_name);return $result;},_processWidget:function($field,field_name,Widget){var self=this;var attrs=Object.create(null);_.each(this.fieldsInfo[field_name],function(value,key){if(_.str.startsWith(key,'t-att-')){key=key.slice(6);value=$field.attr(key);}
attrs[key]=value;});var options=_.extend({},this.options,{attrs:attrs});var widget=new Widget(this,field_name,this.state,options);var def=widget.replace($field);this.defs.push(def);def.then(function(){self._setFieldDisplay(widget.$el,field_name);});return widget;},_processWidgets:function(){var self=this;this.$("widget").each(function(){var $field=$(this);var Widget=widgetRegistry.get($field.attr('name'));var widget=new Widget(self,self.state);var def=widget._widgetRenderAndInsert(function(){});self.defs.push(def);def.then(function(){$field.replaceWith(widget.$el);widget.$el.addClass('o_widget');});});},_render:function(){this.defs=[];_.invoke(this.subWidgets,'on_detach_callback');this._replaceElement(this.qweb.render('kanban-box',this.qweb_context));this.$el.addClass('o_kanban_record').attr("tabindex",0);this.$el.attr('role','article');this.$el.data('record',this);if(this.selectionMode){this.$el.addClass('oe_kanban_global_click');}
if(this.$el.hasClass('oe_kanban_global_click')||this.$el.hasClass('oe_kanban_global_click_edit')){this.$el.on('click',this._onGlobalClick.bind(this));this.$el.on('keydown',this._onKeyDownCard.bind(this));}else{this.$el.on('keydown',this._onKeyDownOpenFirstLink.bind(this));}
this._processFields();this._processWidgets();this._setupColor();this._setupColorPicker();this._attachTooltip();this.$('span.o_tag').tooltip({delay:{'show':50}});return Promise.all(this.defs);},_setCoverImage:function(fieldName){var self=this;this._rpc({model:'ir.attachment',method:'search_read',domain:[['res_model','=',this.modelName],['res_id','=',this.id],['mimetype','ilike','image']],fields:['id','name'],}).then(function(attachmentIds){self.imageUploadID=_.uniqueId('o_cover_image_upload');self.image_only=true;var coverId=self.record[fieldName]&&self.record[fieldName].raw_value;var $content=$(QWeb.render('KanbanView.SetCoverModal',{coverId:coverId,attachmentIds:attachmentIds,widget:self,}));var $imgs=$content.find('.o_kanban_cover_image');var dialog=new Dialog(self,{title:_t("Set a Cover Image"),$content:$content,buttons:[{text:_t("Select"),classes:attachmentIds.length?'btn-primary':'d-none',close:true,disabled:!coverId,click:function(){var $img=$imgs.filter('.o_selected').find('img');var data={};data[fieldName]={id:$img.data('id'),display_name:$img.data('name')};self.trigger_up('kanban_record_update',data);},},{text:_t('Upload and Set'),classes:attachmentIds.length?'':'btn-primary',close:false,click:function(){$content.find('input.o_input_file').click();},},{text:_t("Remove Cover Image"),classes:coverId?'':'d-none',close:true,click:function(){var data={};data[fieldName]=false;self.trigger_up('kanban_record_update',data);},},{text:_t("Discard"),close:true,}],});dialog.opened().then(function(){var $selectBtn=dialog.$footer.find('.btn-primary');$content.on('click','.o_kanban_cover_image',function(ev){$imgs.not(ev.currentTarget).removeClass('o_selected');$selectBtn.prop('disabled',!$(ev.currentTarget).toggleClass('o_selected').hasClass('o_selected'));});$content.on('dblclick','.o_kanban_cover_image',function(ev){var $img=$(ev.currentTarget).find('img');var data={};data[fieldName]={id:$img.data('id'),display_name:$img.data('name')};self.trigger_up('kanban_record_update',data);dialog.close();});$content.on('change','input.o_input_file',function(){$content.find('form.o_form_binary_form').submit();});$(window).on(self.imageUploadID,function(){var images=Array.prototype.slice.call(arguments,1);var data={};data[fieldName]={id:images[0].id,display_name:images[0].filename};self.trigger_up('kanban_record_update',data);dialog.close();});});dialog.open();});},_setFieldDisplay:function($el,fieldName){if(this.fieldsInfo[fieldName].display==='right'){$el.addClass('float-right');}else if(this.fieldsInfo[fieldName].display==='full'){$el.addClass('o_text_block');}
if(this.fieldsInfo[fieldName].bold){$el.addClass('o_text_bold');}},_setState:function(recordState){this.state=recordState;this.id=recordState.res_id;this.db_id=recordState.id;this.recordData=recordState.data;this.record=this._transformRecord(recordState.data);this.qweb_context={context:this.state.getContext(),kanban_image:this._getImageURL.bind(this),kanban_color:this._getColorClassname.bind(this),kanban_getcolor:this._getColorID.bind(this),kanban_getcolorname:this._getColorname.bind(this),kanban_compute_domain:this._computeDomain.bind(this),selection_mode:this.selectionMode,read_only_mode:this.read_only_mode,record:this.record,user_context:this.getSession().user_context,widget:this,};},_setupColor:function(){var color_field=this.$el.attr('color');if(color_field&&color_field in this.fields){var colorHelp=_.str.sprintf(_t("Card color: %s"),this._getColorname(this.recordData[color_field]));var colorClass=this._getColorClassname(this.recordData[color_field]);this.$el.addClass(colorClass);this.$el.prepend('<span title="'+colorHelp+'" aria-label="'+colorHelp+'" role="img" class="oe_kanban_color_help"/>');}},_setupColorPicker:function(){var $colorpicker=this.$('ul.oe_kanban_colorpicker');if(!$colorpicker.length){return;}
$colorpicker.html(QWeb.render('KanbanColorPicker'));$colorpicker.on('click','a',this._onColorChanged.bind(this));},_transformRecord:function(recordData){var self=this;var new_record={};_.each(this.state.getFieldNames(),function(name){var value=recordData[name];var r=_.clone(self.fields[name]||{});if((r.type==='date'||r.type==='datetime')&&value){r.raw_value=value.toDate();}else if(r.type==='one2many'||r.type==='many2many'){r.raw_value=value.count?value.res_ids:[];}else if(r.type==='many2one'){r.raw_value=value&&value.res_id||false;}else{r.raw_value=value;}
if(r.type){var formatter=field_utils.format[r.type];r.value=formatter(value,self.fields[name],recordData,self.state);}else{r.value=value;}
new_record[name]=r;});return new_record;},_updateRecord:function(data){this.trigger_up('kanban_record_update',data);},_onColorChanged:function(event){event.preventDefault();var data={};var color_field=$(event.delegateTarget).data('field')||'color';data[color_field]=$(event.currentTarget).data('color');this.trigger_up('kanban_record_update',data);},_onGlobalClick:function(event){if($(event.target).parents('.o_dropdown_kanban').length){return;}
var trigger=true;var elem=event.target;var ischild=true;var children=[];while(elem){var events=$._data(elem,'events');if(elem===event.currentTarget){ischild=false;}
var test_event=events&&events.click&&(events.click.length>1||events.click[0].namespace!=='bs.tooltip');var testLinkWithHref=elem.nodeName.toLowerCase()==='a'&&elem.href;if(ischild){children.push(elem);if(test_event||testLinkWithHref){trigger=false;}}
if(trigger&&test_event){_.each(events.click,function(click_event){if(click_event.selector){_.each(children,function(child){if($(child).is(click_event.selector)){trigger=false;}});}});}
elem=elem.parentElement;}
if(trigger){this._openRecord();}},_onKanbanActionClicked:function(event){event.preventDefault();var $action=$(event.currentTarget);var type=$action.data('type')||'button';switch(type){case'edit':this.trigger_up('open_record',{id:this.db_id,mode:'edit'});break;case'open':this.trigger_up('open_record',{id:this.db_id});break;case'delete':this.trigger_up('kanban_record_delete',{id:this.db_id,record:this});break;case'action':case'object':var attrs=$action.data();attrs.confirm=$action.attr('confirm');this.trigger_up('button_clicked',{attrs:attrs,record:this.state,});break;case'set_cover':var fieldName=$action.data('field');if(this.fields[fieldName].type==='many2one'&&this.fields[fieldName].relation==='ir.attachment'&&this.fieldsInfo[fieldName].widget==='attachment_image'){this._setCoverImage(fieldName);}else{var warning=_.str.sprintf(_t('Could not set the cover image: incorrect field ("%s") is provided in the view.'),fieldName);this.do_warn(warning);}
break;default:this.do_warn("Kanban: no action for type : "+type);}},_onKeyDownCard:function(event){switch(event.keyCode){case $.ui.keyCode.ENTER:if($(event.target).hasClass('oe_kanban_global_click')){event.preventDefault();this._onGlobalClick(event);break;}}},_onKeyDownOpenFirstLink:function(event){switch(event.keyCode){case $.ui.keyCode.ENTER:event.preventDefault();$(event.target).find('a, button').first().click();break;}},_onManageTogglerClicked:function(event){event.preventDefault();this.$el.toggleClass('o_dropdown_open');var colorClass=this._getColorClassname(this.recordData.color||0);this.$('.o_kanban_manage_button_section').toggleClass(colorClass);},});return KanbanRecord;});;

/* /web/static/src/js/views/kanban/kanban_record_quick_create.js defined in bundle 'web.assets_backend' */
odoo.define('web.kanban_record_quick_create',function(require){"use strict";var core=require('web.core');var QuickCreateFormView=require('web.QuickCreateFormView');const session=require('web.session');var Widget=require('web.Widget');var qweb=core.qweb;var RecordQuickCreate=Widget.extend({className:'o_kanban_quick_create',custom_events:{add:'_onAdd',cancel:'_onCancel',},events:{'click .o_kanban_add':'_onAddClicked','click .o_kanban_edit':'_onEditClicked','click .o_kanban_cancel':'_onCancelClicked','mousedown':'_onMouseDown',},mouseDownInside:false,init:function(parent,options){this._super.apply(this,arguments);this.context=options.context;this.formViewRef=options.formViewRef;this.model=options.model;this._disabled=false;},willStart:function(){var self=this;var superWillStart=this._super.apply(this,arguments);var viewsLoaded;if(this.formViewRef){var views=[[false,'form']];var context=_.extend({},this.context,{form_view_ref:this.formViewRef,});viewsLoaded=this.loadViews(this.model,context,views);}else{var fieldsView={};fieldsView.arch='<form>'+'<field name="display_name" placeholder="Title" modifiers=\'{"required": true}\'/>'+'</form>';var fields={display_name:{string:'Display name',type:'char'},};fieldsView.fields=fields;fieldsView.viewFields=fields;viewsLoaded=Promise.resolve({form:fieldsView});}
viewsLoaded=viewsLoaded.then(function(fieldsViews){var formView=new QuickCreateFormView(fieldsViews.form,{context:self.context,modelName:self.model,userContext:session.user_context,});return formView.getController(self).then(function(controller){self.controller=controller;return self.controller.appendTo(document.createDocumentFragment());});});return Promise.all([superWillStart,viewsLoaded]);},start:function(){this.$el.append(this.controller.$el);this.$el.append(qweb.render('KanbanView.RecordQuickCreate.buttons'));this.controller.autofocus();core.bus.on('click',this,this._onWindowClicked);return this._super.apply(this,arguments);},on_attach_callback:function(){if(this.controller){this.controller.autofocus();}},cancel:function(){var self=this;return this.controller.commitChanges().then(function(){if(!self.controller.isDirty()){self._cancel();}});},_add:function(options){var self=this;if(this._disabled){return;}
this._disableQuickCreate();this.controller.commitChanges().then(function(){var canBeSaved=self.controller.canBeSaved();if(canBeSaved){self.trigger_up('quick_create_add_record',{openRecord:options&&options.openRecord||false,values:self.controller.getChanges(),onFailure:self._enableQuickCreate.bind(self),});}else{self._enableQuickCreate();}}).guardedCatch(this._enableQuickCreate.bind(this));},_cancel:function(){this.trigger_up('cancel_quick_create');},_disableQuickCreate:function(){this._disabled=true;this.$el.addClass('o_disabled');this.$('input:not(:disabled)').addClass('o_temporarily_disabled').attr('disabled','disabled');},_enableQuickCreate:function(){this._disabled=false;this.$el.removeClass('o_disabled');this.$('input.o_temporarily_disabled').removeClass('o_temporarily_disabled').attr('disabled',false);},_onAdd:function(ev){ev.stopPropagation();this._add();},_onAddClicked:function(ev){ev.stopPropagation();this._add();},_onCancel:function(ev){ev.stopPropagation();this._cancel();},_onCancelClicked:function(ev){ev.stopPropagation();this._cancel();},_onEditClicked:function(ev){ev.stopPropagation();this._add({openRecord:true});},_onWindowClicked:function(ev){var mouseDownInside=this.mouseDownInside;this.mouseDownInside=false;if(!document.contains(this.el)){return;}
if($(ev.target).closest('.o-kanban-button-new, .o_kanban_quick_add').length){return;}
if($(ev.target).parents('.ui-autocomplete').length){return;}
if($(ev.target).closest('.modal').length){return;}
if($(document.body).hasClass('modal-open')){return;}
if(!document.contains(ev.target)){return;}
if(this.el.contains(ev.target)||this.el===ev.target||mouseDownInside){return;}
this.cancel();},_onMouseDown:function(ev){this.mouseDownInside=true;}});return RecordQuickCreate;});;

/* /web/static/src/js/views/kanban/kanban_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanRenderer',function(require){"use strict";var BasicRenderer=require('web.BasicRenderer');var ColumnQuickCreate=require('web.kanban_column_quick_create');var config=require('web.config');var core=require('web.core');var KanbanColumn=require('web.KanbanColumn');var KanbanRecord=require('web.KanbanRecord');var QWeb=require('web.QWeb');var session=require('web.session');var utils=require('web.utils');var viewUtils=require('web.viewUtils');var qweb=core.qweb;var _t=core._t;function findInNode(node,predicate){if(predicate(node)){return node;}
if(!node.children){return undefined;}
for(var i=0;i<node.children.length;i++){if(findInNode(node.children[i],predicate)){return node.children[i];}}}
function qwebAddIf(node,condition){if(node.attrs[qweb.prefix+'-if']){condition=_.str.sprintf("(%s) and (%s)",node.attrs[qweb.prefix+'-if'],condition);}
node.attrs[qweb.prefix+'-if']=condition;}
function transformQwebTemplate(node,fields){if(node.tag&&node.attrs.modifiers){var modifiers=node.attrs.modifiers||{};if(modifiers.invisible){qwebAddIf(node,_.str.sprintf("!kanban_compute_domain(%s)",JSON.stringify(modifiers.invisible)));}}
switch(node.tag){case'button':case'a':var type=node.attrs.type||'';if(_.indexOf('action,object,edit,open,delete,url,set_cover'.split(','),type)!==-1){_.each(node.attrs,function(v,k){if(_.indexOf('icon,type,name,args,string,context,states,kanban_states'.split(','),k)!==-1){node.attrs['data-'+k]=v;delete(node.attrs[k]);}});if(node.attrs['data-string']){node.attrs.title=node.attrs['data-string'];}
if(node.tag==='a'&&node.attrs['data-type']!=="url"){node.attrs.href='#';}else{node.attrs.type='button';}
var action_classes=" oe_kanban_action oe_kanban_action_"+node.tag;if(node.attrs['t-attf-class']){node.attrs['t-attf-class']+=action_classes;}else if(node.attrs['t-att-class']){node.attrs['t-att-class']+=" + '"+action_classes+"'";}else{node.attrs['class']=(node.attrs['class']||'')+action_classes;}}
break;}
if(node.children){for(var i=0,ii=node.children.length;i<ii;i++){transformQwebTemplate(node.children[i],fields);}}}
var KanbanRenderer=BasicRenderer.extend({className:'o_kanban_view',config:{KanbanColumn:KanbanColumn,KanbanRecord:KanbanRecord,},custom_events:_.extend({},BasicRenderer.prototype.custom_events||{},{close_quick_create:'_onCloseQuickCreate',cancel_quick_create:'_onCancelQuickCreate',set_progress_bar_state:'_onSetProgressBarState',start_quick_create:'_onStartQuickCreate',quick_create_column_updated:'_onQuickCreateColumnUpdated',}),events:_.extend({},BasicRenderer.prototype.events||{},{'keydown .o_kanban_record':'_onRecordKeyDown'}),init:function(parent,state,params){this._super.apply(this,arguments);this.widgets=[];this.qweb=new QWeb(config.isDebug(),{_s:session.origin},false);var templates=findInNode(this.arch,function(n){return n.tag==='templates';});transformQwebTemplate(templates,state.fields);this.qweb.add_template(utils.json_node_to_xml(templates));this.examples=params.examples;this.recordOptions=_.extend({},params.record_options,{qweb:this.qweb,viewType:'kanban',});this.columnOptions=_.extend({KanbanRecord:this.config.KanbanRecord},params.column_options);if(this.columnOptions.hasProgressBar){this.columnOptions.progressBarStates={};}
this.quickCreateEnabled=params.quickCreateEnabled;if(!params.readOnlyMode){var handleField=_.findWhere(this.state.fieldsInfo.kanban,{widget:'handle'});this.handleField=handleField&&handleField.name;}
this._setState(state);},on_attach_callback:function(){this._isInDom=true;_.invoke(this.widgets,'on_attach_callback');if(this.quickCreate){this.quickCreate.on_attach_callback();}},on_detach_callback:function(){this._isInDom=false;_.invoke(this.widgets,'on_detach_callback');},addQuickCreate:function(){return this.widgets[0].addQuickCreate();},giveFocus:function(){this.$('.o_kanban_record:first').focus();},quickCreateToggleFold:function(){this.quickCreate.toggleFold();this._toggleNoContentHelper();},updateColumn:function(localID,columnState,options){var self=this;var KanbanColumn=this.config.KanbanColumn;var newColumn=new KanbanColumn(this,columnState,this.columnOptions,this.recordOptions);var index=_.findIndex(this.widgets,{db_id:localID});var column=this.widgets[index];this.widgets[index]=newColumn;if(options&&options.state){this.state=options.state;}
return newColumn.appendTo(document.createDocumentFragment()).then(function(){var def;if(options&&options.openQuickCreate){def=newColumn.addQuickCreate();}
return Promise.resolve(def).then(function(){newColumn.$el.insertAfter(column.$el);self._toggleNoContentHelper();newColumn.on_attach_callback();column.destroy();});});},updateRecord:function(recordState){var isGrouped=!!this.state.groupedBy.length;var record;if(isGrouped){_.each(this.widgets,function(widget){record=record||_.findWhere(widget.records,{db_id:recordState.id,});});}else{record=_.findWhere(this.widgets,{db_id:recordState.id});}
if(record){return record.update(recordState);}
return Promise.resolve();},updateState:function(state){this._setState(state);return this._super.apply(this,arguments);},_focusOnNextCard:function(currentCardElement){var nextCard=currentCardElement.nextElementSibling;if(nextCard){nextCard.focus();}},_focusOnPreviousCard:function(currentCardElement){var previousCard=currentCardElement.previousElementSibling;if(previousCard&&previousCard.classList.contains("o_kanban_record")){previousCard.focus();return true;}},_getGhostColumns:function(){if(this.examples&&this.examples.ghostColumns){return this.examples.ghostColumns;}
return _.map(_.range(1,5),function(num){return _.str.sprintf(_t("Column %s"),num);});},_renderExampleBackground:function(fragment){var $background=$(qweb.render('KanbanView.ExamplesBackground',{ghostColumns:this._getGhostColumns()}));$background.appendTo(fragment);},_renderGhostDivs:function(fragment,nbDivs,options){var ghostDefs=[];for(var $ghost,i=0;i<nbDivs;i++){$ghost=$('<div>').addClass('o_kanban_record o_kanban_ghost');if(options&&options.inlineStyle){$ghost.attr('style',options.inlineStyle);}
var def=$ghost.appendTo(fragment);ghostDefs.push(def);}
return Promise.all(ghostDefs);},_renderGrouped:function(fragment){var self=this;var KanbanColumn=this.config.KanbanColumn;_.each(this.state.data,function(group){var column=new KanbanColumn(self,group,self.columnOptions,self.recordOptions);var def;if(!group.value){def=column.prependTo(fragment);self.widgets.unshift(column);}else{def=column.appendTo(fragment);self.widgets.push(column);}
self.defs.push(def);});if(this.$el.sortable('instance')!==undefined){this.$el.sortable('destroy');}
if(this.groupedByM2O){this.$el.sortable({axis:'x',items:'> .o_kanban_group',handle:'.o_kanban_header_title',cursor:'move',revert:150,delay:100,tolerance:'pointer',forcePlaceholderSize:true,stop:function(){var ids=[];self.$('.o_kanban_group').each(function(index,u){if(_.isNumber($(u).data('id'))){ids.push($(u).data('id'));}});self.trigger_up('resequence_columns',{ids:ids});},});if(this.createColumnEnabled){this.quickCreate=new ColumnQuickCreate(this,{examples:this.examples&&this.examples.examples,});this.defs.push(this.quickCreate.appendTo(fragment).then(function(){if(!self.state.data.length){self.quickCreate.toggleFold();self._renderExampleBackground(fragment);}}));}}},_renderUngrouped:function(fragment){var self=this;var KanbanRecord=this.config.KanbanRecord;var kanbanRecord;_.each(this.state.data,function(record){kanbanRecord=new KanbanRecord(self,record,self.recordOptions);self.widgets.push(kanbanRecord);var def=kanbanRecord.appendTo(fragment);self.defs.push(def);});var orderedBy=this.state.orderedBy;var hasHandle=this.handleField&&(orderedBy.length===0||orderedBy[0].name===this.handleField);if(hasHandle){this.$el.sortable({items:'.o_kanban_record:not(.o_kanban_ghost)',cursor:'move',revert:0,delay:0,tolerance:'pointer',forcePlaceholderSize:true,stop:function(event,ui){self._moveRecord(ui.item.data('record').db_id,ui.item.index());},});}
var prom=Promise.all(self.defs).then(function(){var options={};if(kanbanRecord){options.inlineStyle=kanbanRecord.$el.attr('style');}
return self._renderGhostDivs(fragment,6,options);});this.defs.push(prom);},_renderView:function(){var self=this;var isGrouped=!!this.state.groupedBy.length;var fragment=document.createDocumentFragment();var defs=[];this.defs=defs;if(isGrouped){this._renderGrouped(fragment);}else{this._renderUngrouped(fragment);}
delete this.defs;return this._super.apply(this,arguments).then(function(){return Promise.all(defs).then(function(){self.$el.empty();self.$el.toggleClass('o_kanban_grouped',isGrouped);self.$el.toggleClass('o_kanban_ungrouped',!isGrouped);self.$el.append(fragment);self._toggleNoContentHelper();if(self._isInDom){_.invoke(self.widgets,'on_attach_callback');}});});},_toggleNoContentHelper:function(remove){var displayNoContentHelper=!remove&&!this._hasContent()&&!!this.noContentHelp&&!(this.quickCreate&&!this.quickCreate.folded)&&!this.state.isGroupedByM2ONoColumn;var $noContentHelper=this.$('.o_view_nocontent');if(displayNoContentHelper&&!$noContentHelper.length){this.$el.append(this._renderNoContentHelper());}
if(!displayNoContentHelper&&$noContentHelper.length){$noContentHelper.remove();}},_setState:function(state){this.state=state;var groupByField=state.groupedBy[0];var cleanGroupByField=this._cleanGroupByField(groupByField);var groupByFieldAttrs=state.fields[cleanGroupByField];var groupByFieldInfo=state.fieldsInfo.kanban[cleanGroupByField];var draggable=true;if(groupByFieldAttrs){if(groupByFieldAttrs.type==="date"||groupByFieldAttrs.type==="datetime"){draggable=false;}else if(groupByFieldAttrs.readonly!==undefined){draggable=!(groupByFieldAttrs.readonly);}}
if(groupByFieldInfo){if(draggable&&groupByFieldInfo.readonly!==undefined){draggable=!(groupByFieldInfo.readonly);}}
this.groupedByM2O=groupByFieldAttrs&&(groupByFieldAttrs.type==='many2one');var relation=this.groupedByM2O&&groupByFieldAttrs.relation;var groupByTooltip=groupByFieldInfo&&groupByFieldInfo.options.group_by_tooltip;this.columnOptions=_.extend(this.columnOptions,{draggable:draggable,group_by_tooltip:groupByTooltip,groupedBy:groupByField,grouped_by_m2o:this.groupedByM2O,relation:relation,quick_create:this.quickCreateEnabled&&viewUtils.isQuickCreateEnabled(state),});this.createColumnEnabled=this.groupedByM2O&&this.columnOptions.group_creatable;},_cleanGroupByField:function(groupByField){var cleanGroupByField=groupByField;if(cleanGroupByField&&cleanGroupByField.indexOf(':')>-1){cleanGroupByField=cleanGroupByField.substring(0,cleanGroupByField.indexOf(':'));}
return cleanGroupByField;},_focusOnCardInColumn:function(eventTarget,direction){var currentColumn=eventTarget.parentElement;var hasSelectedACard=false;var cannotSelectAColumn=false;while(!hasSelectedACard&&!cannotSelectAColumn){var candidateColumn=direction==='LEFT'?currentColumn.previousElementSibling:currentColumn.nextElementSibling;currentColumn=candidateColumn;if(candidateColumn){var allCardsOfCandidateColumn=candidateColumn.getElementsByClassName('o_kanban_record');if(allCardsOfCandidateColumn.length){allCardsOfCandidateColumn[0].focus();hasSelectedACard=true;}}
else{direction==='LEFT'?this._focusOnPreviousCard(eventTarget):this._focusOnNextCard(eventTarget);cannotSelectAColumn=true;}}},_onCancelQuickCreate:function(){this._toggleNoContentHelper();},_onCloseQuickCreate:function(){if(this.state.groupedBy.length){_.invoke(this.widgets,'cancelQuickCreate');}
this._toggleNoContentHelper();},_onQuickCreateColumnUpdated:function(ev){ev.stopPropagation();this._toggleNoContentHelper();this._updateExampleBackground();},_onRecordKeyDown:function(e){switch(e.which){case $.ui.keyCode.DOWN:this._focusOnNextCard(e.currentTarget);e.stopPropagation();e.preventDefault();break;case $.ui.keyCode.UP:const previousFocused=this._focusOnPreviousCard(e.currentTarget);if(!previousFocused){this.trigger_up('navigation_move',{direction:'up'});}
e.stopPropagation();e.preventDefault();break;case $.ui.keyCode.RIGHT:this._focusOnCardInColumn(e.currentTarget,'RIGHT');e.stopPropagation();e.preventDefault();break;case $.ui.keyCode.LEFT:this._focusOnCardInColumn(e.currentTarget,'LEFT');e.stopPropagation();e.preventDefault();break;}},_onSetProgressBarState:function(ev){if(!this.columnOptions.progressBarStates[ev.data.columnID]){this.columnOptions.progressBarStates[ev.data.columnID]={};}
_.extend(this.columnOptions.progressBarStates[ev.data.columnID],ev.data.values);},_onStartQuickCreate:function(){this._toggleNoContentHelper(true);},_updateExampleBackground:function(){var $elem=this.$('.o_kanban_example_background_container');if(!this.state.data.length&&!$elem.length){this._renderExampleBackground(this.$el);}else{$elem.remove();}},});return KanbanRenderer;});;

/* /web/static/src/js/views/kanban/kanban_renderer_mobile.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanRendererMobile',function(require){"use strict";var config=require('web.config');var core=require('web.core');var KanbanRenderer=require('web.KanbanRenderer');var _t=core._t;var qweb=core.qweb;if(!config.device.isMobile){return;}
KanbanRenderer.include({custom_events:_.extend({},KanbanRenderer.prototype.custom_events||{},{quick_create_column_created:'_onColumnAdded',}),events:_.extend({},KanbanRenderer.prototype.events,{'click .o_kanban_mobile_tab':'_onMobileTabClicked','click .o_kanban_mobile_add_column':'_onMobileQuickCreateClicked',}),ANIMATE:true,init:function(){this._super.apply(this,arguments);this.activeColumnIndex=0;this._scrollPosition=null;},on_attach_callback:function(){if(this._scrollPosition&&this.state.groupedBy.length&&this.widgets.length){var $column=this.widgets[this.activeColumnIndex].$el;$column.scrollLeft(this._scrollPosition.left);$column.scrollTop(this._scrollPosition.top);}
this._computeTabPosition();this._super.apply(this,arguments);},on_detach_callback:function(){if(this.state.groupedBy.length&&this.widgets.length){var $column=this.widgets[this.activeColumnIndex].$el;this._scrollPosition={left:$column.scrollLeft(),top:$column.scrollTop(),};}else{this._scrollPosition=null;}
this._super.apply(this,arguments);},addQuickCreate:function(){if(this._canCreateColumn()&&!this.quickCreate.folded){this._onMobileQuickCreateClicked();}
return this.widgets[this.activeColumnIndex].addQuickCreate();},updateColumn:function(localID){var index=_.findIndex(this.widgets,{db_id:localID});var $column=this.widgets[index].$el;var scrollTop=$column.scrollTop();return this._super.apply(this,arguments).then(()=>this._layoutUpdate(false)).then(()=>$column.scrollTop(scrollTop)).then(()=>this._enableSwipe());},_canCreateColumn:function(){return this.quickCreateEnabled&&this.quickCreate&&this.widgets.length;},_computeColumnPosition:function(animate){if(this.widgets.length){const rtl=_t.database.parameters.direction==='rtl';this.$('.o_kanban_group').show();const $columnAfter=this._toNode(this.widgets.filter((widget,index)=>index>this.activeColumnIndex));const promiseAfter=this._updateColumnCss($columnAfter,rtl?{right:'100%'}:{left:'100%'},animate);const $columnBefore=this._toNode(this.widgets.filter((widget,index)=>index<this.activeColumnIndex));const promiseBefore=this._updateColumnCss($columnBefore,rtl?{right:'-100%'}:{left:'-100%'},animate);const $columnCurrent=this._toNode(this.widgets.filter((widget,index)=>index===this.activeColumnIndex));const promiseCurrent=this._updateColumnCss($columnCurrent,rtl?{right:'0%'}:{left:'0%'},animate);promiseAfter.then(promiseBefore).then(promiseCurrent).then(()=>{$columnAfter.hide();$columnBefore.hide();});}},_computeCurrentColumn:function(){if(this.widgets.length){var column=this.widgets[this.activeColumnIndex];if(!column){return;}
var columnID=column.id||column.db_id;this.$('.o_kanban_mobile_tab.o_current, .o_kanban_group.o_current').removeClass('o_current');this.$('.o_kanban_group[data-id="'+columnID+'"], '+'.o_kanban_mobile_tab[data-id="'+columnID+'"]').addClass('o_current');}},_computeTabPosition:function(){this._computeTabJustification();this._computeTabScrollPosition();},_computeTabScrollPosition:function(){if(this.widgets.length){var lastItemIndex=this.widgets.length-1;var moveToIndex=this.activeColumnIndex;var scrollToLeft=0;for(var i=0;i<moveToIndex;i++){var columnWidth=this._getTabWidth(this.widgets[i]);if(moveToIndex!==lastItemIndex&&i===moveToIndex-1){var partialWidth=0.75;scrollToLeft+=columnWidth*partialWidth;}else{scrollToLeft+=columnWidth;}}
this.$('.o_kanban_mobile_tabs').scrollLeft(scrollToLeft);}},_computeTabJustification:function(){if(this.widgets.length){var self=this;var widthChilds=this.widgets.reduce(function(total,column){return total+self._getTabWidth(column);},0);var $tabs=this.$('.o_kanban_mobile_tabs');$tabs.toggleClass('justify-content-between',$tabs.outerWidth()>=widthChilds);}},_enableSwipe:function(){var self=this;var step=_t.database.parameters.direction==='rtl'?-1:1;this.$el.swipe({excludedElements:".o_kanban_mobile_tabs",swipeLeft:function(){var moveToIndex=self.activeColumnIndex+step;if(moveToIndex<self.widgets.length){self._moveToGroup(moveToIndex,self.ANIMATE);}},swipeRight:function(){var moveToIndex=self.activeColumnIndex-step;if(moveToIndex>-1){self._moveToGroup(moveToIndex,self.ANIMATE);}}});},_getTabWidth:function(column){var columnID=column.id||column.db_id;return this.$('.o_kanban_mobile_tab[data-id="'+columnID+'"]').outerWidth();},_layoutUpdate:function(animate){this._computeCurrentColumn();this._computeTabPosition();this._computeColumnPosition(animate);},_moveToGroup:function(moveToIndex,animate){var self=this;if(moveToIndex<0||moveToIndex>=this.widgets.length){this._layoutUpdate(animate);return Promise.resolve();}
this.activeColumnIndex=moveToIndex;var column=this.widgets[this.activeColumnIndex];return new Promise(function(resolve){self.trigger_up('kanban_load_records',{columnID:column.db_id,onSuccess:function(){self._layoutUpdate(animate);resolve();},});});},_renderExampleBackground:function(){},_renderGrouped:function(fragment){var self=this;var newFragment=document.createDocumentFragment();this._super.apply(this,[newFragment]);this.defs.push(Promise.all(this.defs).then(function(){var data=[];_.each(self.state.data,function(group){if(!group.value){group=_.extend({},group,{value:_t('Undefined')});data.unshift(group);}else{data.push(group);}});var kanbanColumnContainer=document.createElement('div');kanbanColumnContainer.classList.add('o_kanban_columns_content');kanbanColumnContainer.appendChild(newFragment);fragment.appendChild(kanbanColumnContainer);$(qweb.render('KanbanView.MobileTabs',{data:data,quickCreateEnabled:self._canCreateColumn()})).prependTo(fragment);}));},_renderView:function(){var self=this;return this._super.apply(this,arguments).then(function(){if(self.state.groupedBy.length){return self._moveToGroup(0);}else{if(self._canCreateColumn()){self._onMobileQuickCreateClicked();}
return Promise.resolve();}});},_toNode:function(widgets){const selectorCss=widgets.map(widget=>'.o_kanban_group[data-id="'+(widget.id||widget.db_id)+'"]').join(', ');return this.$(selectorCss);},_updateColumnCss:function($column,cssProperties,animate){if(animate){return new Promise(resolve=>$column.animate(cssProperties,'fast',resolve));}else{$column.css(cssProperties);return Promise.resolve();}},_onColumnAdded:function(){this._computeTabPosition();if(this._canCreateColumn()&&!this.quickCreate.folded){this.quickCreate.toggleFold();}},_onMobileQuickCreateClicked:function(){this.$('.o_kanban_group').toggle();this.quickCreate.toggleFold();},_onMobileTabClicked:function(event){if(this._canCreateColumn()&&!this.quickCreate.folded){this.quickCreate.toggleFold();}
this._moveToGroup($(event.currentTarget).index(),true);},});});;

/* /web/static/src/js/views/kanban/kanban_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanView',function(require){"use strict";var BasicView=require('web.BasicView');var config=require('web.config');var core=require('web.core');var KanbanController=require('web.KanbanController');var kanbanExamplesRegistry=require('web.kanban_examples_registry');var KanbanModel=require('web.KanbanModel');var KanbanRenderer=require('web.KanbanRenderer');var utils=require('web.utils');var _lt=core._lt;var KanbanView=BasicView.extend({accesskey:"k",display_name:_lt("Kanban"),icon:'fa-th-large',mobile_friendly:true,config:_.extend({},BasicView.prototype.config,{Model:KanbanModel,Controller:KanbanController,Renderer:KanbanRenderer,}),jsLibs:[],viewType:'kanban',init:function(viewInfo,params){this._super.apply(this,arguments);this.loadParams.limit=this.loadParams.limit||40;this.loadParams.openGroupByDefault=config.device.isMobile?false:true;this.loadParams.type='list';this.noDefaultGroupby=params.noDefaultGroupby;var progressBar;utils.traverse(this.arch,function(n){var isProgressBar=(n.tag==='progressbar');if(isProgressBar){progressBar=_.clone(n.attrs);progressBar.colors=JSON.parse(progressBar.colors);progressBar.sum_field=progressBar.sum_field||false;}
return!isProgressBar;});if(progressBar){this.loadParams.progressBar=progressBar;}
var activeActions=this.controllerParams.activeActions;var archAttrs=this.arch.attrs;activeActions=_.extend(activeActions,{group_create:this.arch.attrs.group_create?!!JSON.parse(archAttrs.group_create):true,group_edit:archAttrs.group_edit?!!JSON.parse(archAttrs.group_edit):true,group_delete:archAttrs.group_delete?!!JSON.parse(archAttrs.group_delete):true,});this.rendererParams.column_options={editable:activeActions.group_edit,deletable:activeActions.group_delete,archivable:archAttrs.archivable?!!JSON.parse(archAttrs.archivable):true,group_creatable:activeActions.group_create,quickCreateView:archAttrs.quick_create_view||null,recordsDraggable:archAttrs.records_draggable?!!JSON.parse(archAttrs.records_draggable):true,hasProgressBar:!!progressBar,};this.rendererParams.record_options={editable:activeActions.edit,deletable:activeActions.delete,read_only_mode:params.readOnlyMode,selectionMode:params.selectionMode,};this.rendererParams.quickCreateEnabled=this._isQuickCreateEnabled();this.rendererParams.readOnlyMode=params.readOnlyMode;var examples=archAttrs.examples;if(examples){this.rendererParams.examples=kanbanExamplesRegistry.get(examples);}
this.controllerParams.on_create=archAttrs.on_create;this.controllerParams.hasButtons=!params.selectionMode?true:false;this.controllerParams.quickCreateEnabled=this.rendererParams.quickCreateEnabled;if(config.device.isMobile){this.jsLibs.push('/web/static/lib/jquery.touchSwipe/jquery.touchSwipe.js');}},_isQuickCreateEnabled:function(){if(!this.controllerParams.activeActions.create){return false;}
if(this.arch.attrs.quick_create!==undefined){return!!JSON.parse(this.arch.attrs.quick_create);}
return true;},_updateMVCParams:function(){this._super.apply(this,arguments);var defaultGroupBy=this.arch.attrs.default_group_by;if(this.searchMenuTypes.includes('groupBy')&&!this.noDefaultGroupby){this.loadParams.groupBy=defaultGroupBy?[defaultGroupBy]:(this.loadParams.groupedBy||[]);}else{this.loadParams.groupBy=[];}},});return KanbanView;});;

/* /web/static/src/js/views/kanban/quick_create_form_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.QuickCreateFormView',function(require){"use strict";var BasicModel=require('web.BasicModel');var FormController=require('web.FormController');var FormRenderer=require('web.FormRenderer');var FormView=require('web.FormView');var QuickCreateFormRenderer=FormRenderer.extend({start:function(){this.$el.addClass('o_xxs_form_view');return this._super.apply(this,arguments);},_onNavigationMove:function(ev){var direction=ev.data.direction;if(direction==='cancel'||direction==='next_line'){ev.stopPropagation();this.trigger_up(direction==='cancel'?'cancel':'add');}else{this._super.apply(this,arguments);}},});var QuickCreateFormModel=BasicModel.extend({getChanges:function(localID){var record=this.localData[localID];return this._generateChanges(record,{changesOnly:false});},});var QuickCreateFormController=FormController.extend({commitChanges:function(){var mutexDef=this.mutex.getUnlockedDef();return Promise.all([mutexDef,this.renderer.commitChanges(this.handle)]);},getChanges:function(){return this.model.getChanges(this.handle);},});var QuickCreateFormView=FormView.extend({withControlPanel:false,config:_.extend({},FormView.prototype.config,{Model:QuickCreateFormModel,Renderer:QuickCreateFormRenderer,Controller:QuickCreateFormController,}),});return QuickCreateFormView;});;

/* /web/static/src/js/views/list/list_editable_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.EditableListRenderer',function(require){"use strict";var core=require('web.core');var dom=require('web.dom');var ListRenderer=require('web.ListRenderer');var utils=require('web.utils');var _t=core._t;ListRenderer.include({RESIZE_DELAY:200,custom_events:_.extend({},ListRenderer.prototype.custom_events,{navigation_move:'_onNavigationMove',}),events:_.extend({},ListRenderer.prototype.events,{'click .o_field_x2many_list_row_add a':'_onAddRecord','click .o_group_field_row_add a':'_onAddRecordToGroup','keydown .o_field_x2many_list_row_add a':'_onKeyDownAddRecord','click tbody td.o_data_cell':'_onCellClick','click tbody tr:not(.o_data_row)':'_onEmptyRowClick','click tfoot':'_onFooterClick','click tr .o_list_record_remove':'_onRemoveIconClick',}),init:function(parent,state,params){var self=this;this._super.apply(this,arguments);this.editable=params.editable;this.isMultiEditable=params.isMultiEditable;this.columnWidths=false;this.addCreateLine=params.addCreateLine;this.addCreateLineInGroups=params.addCreateLineInGroups;if(this.addCreateLine){this.creates=[];_.each(this.arch.children,function(child){if(child.tag!=='control'){return;}
_.each(child.children,function(child){if(child.tag!=='create'||child.attrs.invisible){return;}
self.creates.push({context:child.attrs.context,string:child.attrs.string,});});});if(this.creates.length===0){this.creates.push({string:_t("Add a line"),});}}
this.addTrashIcon=params.addTrashIcon;this.isMany2Many=params.isMany2Many;this.currentRow=null;this.currentFieldIndex=null;this.isResizing=false;this.eventListeners=[];},start:function(){core.bus.on('click',this,this._onWindowClicked.bind(this));core.bus.on('resize',this,_.debounce(this._onResize.bind(this),this.RESIZE_DELAY));core.bus.on('DOM_updated',this,()=>this._freezeColumnWidths());return this._super();},destroy:function(){this.eventListeners.forEach(listener=>{const{type,el,callback,options}=listener;el.removeEventListener(type,callback,options);});return this._super.apply(this,arguments);},on_attach_callback:function(){this.isInDOM=true;this._freezeColumnWidths();this._super();},on_detach_callback:function(){this.isInDOM=false;this._super();},canBeSaved:function(recordID){if((recordID||this.state.id)===this.state.id){recordID=this.getEditableRecordID();if(recordID===null){return[];}}
var fieldNames=this._super(recordID);this.$('.o_selected_row .o_data_cell').removeClass('o_invalid_cell');this.$('.o_selected_row .o_data_cell:has(> .o_field_invalid)').addClass('o_invalid_cell');return fieldNames;},confirmChange:function(state,recordID){var self=this;return this._super.apply(this,arguments).then(function(widgets){if(widgets.length){var $row=self._getRow(recordID);var record=self._getRecord(recordID);self._setDecorationClasses(record,$row);self._updateFooter();}
return widgets;});},confirmUpdate:function(state,id,fields,ev){var self=this;var oldData=this.state.data;this.state=state;return this.confirmChange(state,id,fields,ev).then(function(){var record=self._getRecord(id);if(!record){return;}
_.each(oldData,function(rec){if(rec.id!==id){self._destroyFieldWidgets(rec.id);}});self.defs=[];var $newBody=self._renderBody();var defs=self.defs;delete self.defs;return Promise.all(defs).then(function(){_.each(self.columns,function(node){self._registerModifiers(node,record,null,{mode:'edit'});});var currentRowID;var currentWidget;var focusedElement;var selectionRange;if(self.currentRow!==null){currentRowID=self._getRecordID(self.currentRow);currentWidget=self.allFieldWidgets[currentRowID][self.currentFieldIndex];if(currentWidget){focusedElement=currentWidget.getFocusableElement().get(0);if(currentWidget.formatType!=='boolean'&&focusedElement){selectionRange=dom.getSelectionRange(focusedElement);}}}
var $editedRow=self._getRow(id);$editedRow.nextAll('.o_data_row').remove();$editedRow.prevAll('.o_data_row').remove();var $newRow=$newBody.find('.o_data_row[data-id="'+id+'"]');$newRow.prevAll('.o_data_row').get().reverse().forEach(function(row){$(row).insertBefore($editedRow);});$newRow.nextAll('.o_data_row').get().reverse().forEach(function(row){$(row).insertAfter($editedRow);});if(self.currentRow!==null){var newRowIndex=$editedRow.prop('rowIndex')-1;self.currentRow=newRowIndex;return self._selectCell(newRowIndex,self.currentFieldIndex,{force:true}).then(function(){currentWidget=self.allFieldWidgets[currentRowID][self.currentFieldIndex];if(currentWidget){focusedElement=currentWidget.getFocusableElement().get(0);if(selectionRange){dom.setSelectionRange(focusedElement,selectionRange);}}});}});});},editFirstRecord:function(ev){const $borderRow=this._getBorderRow(ev.data.side||'first');this._selectCell($borderRow.prop('rowIndex')-1,ev.data.cellIndex||0);},editRecord:function(recordID){var $row=this._getRow(recordID);var rowIndex=$row.prop('rowIndex')-1;this._selectCell(rowIndex,0);},focusCell:function(recordId,column){var $row=this._getRow(recordId);var cellIndex=this.columns.indexOf(column);$row.find('.o_data_cell')[cellIndex].focus();},getEditableRecordID:function(){if(this.currentRow!==null){return this._getRecordID(this.currentRow);}
return null;},isInMultipleRecordEdition:function(recordId){return this.isEditable()&&this.isMultiEditable&&this.selection.includes(recordId);},isEditable:function(){return this.editable||(this.isMultiEditable&&this.selection.length);},removeLine:function(state,recordID){this.state=state;var $row=this._getRow(recordID);if($row.length===0){return;}
if($row.prop('rowIndex')-1===this.currentRow){this.currentRow=null;this._enableRecordSelectors();}
this._destroyFieldWidgets(recordID);if(this.state.count>=4){$row.remove();}else{var $emptyRow=this._renderEmptyRow();$row.replaceWith($emptyRow);const $lastDataRow=this.$('.o_data_row:last');if($lastDataRow.length){$emptyRow.insertAfter($lastDataRow);}}},setRowMode:function(recordID,mode){var self=this;var record=self._getRecord(recordID);if(!record){return Promise.resolve();}
var editMode=(mode==='edit');var $row=this._getRow(recordID);this.currentRow=editMode?$row.prop('rowIndex')-1:null;var $tds=$row.children('.o_data_cell');var oldWidgets=_.clone(this.allFieldWidgets[record.id]);var options={renderInvisible:editMode,renderWidgets:editMode,};options.mode=editMode?'edit':'readonly';var defs=[];this.defs=defs;_.each(this.columns,function(node,colIndex){var $td=$tds.eq(colIndex);var $newTd=self._renderBodyCell(record,node,colIndex,options);if($td.hasClass('o_list_button')){self._unregisterModifiersElement(node,recordID,$td.children());}
if(editMode){$td.empty().append($newTd.contents());}else{self._unregisterModifiersElement(node,recordID,$td);$td.replaceWith($newTd);}});delete this.defs;_.each(oldWidgets,this._destroyFieldWidget.bind(this,recordID));$row.toggleClass('o_selected_row',editMode);if(editMode){this._disableRecordSelectors();}else{this._enableRecordSelectors();}
return Promise.all(defs).then(function(){core.bus.trigger('DOM_updated');});},unselectRow:function(){if(this.currentRow===null){return Promise.resolve();}
var recordID=this._getRecordID(this.currentRow);var recordWidgets=this.allFieldWidgets[recordID];function toggleWidgets(disabled){_.each(recordWidgets,function(widget){var $el=widget.getFocusableElement();$el.prop('disabled',disabled);});}
toggleWidgets(true);return new Promise((resolve,reject)=>{this.trigger_up('save_line',{recordID:recordID,onSuccess:resolve,onFailure:reject,});}).then(changedFields=>{this._enableRecordSelectors();return changedFields&&changedFields.length&&this.isInMultipleRecordEdition(recordID);}).guardedCatch(()=>{toggleWidgets(false);});},updateState:function(state,params){if(params.keepWidths&&this.$el.is(':visible')){this._storeColumnWidths();}
if(params.noRender){this.allModifiersData=[];}
return this._super.apply(this,arguments);},_addEventListener:function(type,el,callback,options){el.addEventListener(type,callback,options);this.eventListeners.push({type,el,callback,options});},_computeDefaultWidths:function(){const isListEmpty=!this._hasVisibleRecords(this.state);const relativeWidths=[];this.columns.forEach(column=>{const th=this._getColumnHeader(column);if(th.offsetParent===null){relativeWidths.push(false);}else{const width=this._getColumnWidth(column);if(width.match(/[a-zA-Z]/)){if(isListEmpty){th.style.width=width;}else{th.style.minWidth=width;}
relativeWidths.push(false);}else{relativeWidths.push(parseFloat(width,10));}}});if(isListEmpty){const totalWidth=this._getColumnsTotalWidth(relativeWidths);for(let i in this.columns){if(relativeWidths[i]){const th=this._getColumnHeader(this.columns[i]);th.style.width=(relativeWidths[i]/totalWidth*100)+'%';}}
const trashHeader=this.el.getElementsByClassName('o_list_record_remove_header')[0];if(trashHeader){trashHeader.style.width='32px';}}},_destroyFieldWidgets:function(recordID){if(recordID in this.allFieldWidgets){var widgetsToDestroy=this.allFieldWidgets[recordID].slice();_.each(widgetsToDestroy,this._destroyFieldWidget.bind(this,recordID));delete this.allFieldWidgets[recordID];}},_disableRecordSelectors:function(){this.$('.o_list_record_selector input').attr('disabled','disabled');},_enableRecordSelectors:function(){this.$('.o_list_record_selector input').attr('disabled',false);},_freezeColumnWidths:function(){if(!this.columnWidths&&this.el.offsetParent===null){return;}
const thElements=[...this.el.querySelectorAll('table thead th')];if(!thElements.length){return;}
const table=this.el.getElementsByTagName('table')[0];let columnWidths=this.columnWidths;if(!columnWidths||!columnWidths.length){table.style.tableLayout='auto';thElements.forEach(th=>{th.style.width=null;th.style.maxWidth=null;});this._computeDefaultWidths();columnWidths=this._squeezeTable();}
thElements.forEach((th,index)=>{if(!th.style.width){th.style.width=`${columnWidths[index]}px`;}});table.style.tableLayout='fixed';},_getBorderRow:function(side){let $borderDataRow=this.$(`.o_data_row:${side}`);if(!this._isRecordEditable($borderDataRow.data('id'))){$borderDataRow=this._getNearestEditableRow($borderDataRow,side==='first');}
return $borderDataRow;},_getColumnsTotalWidth(relativeWidths){return relativeWidths.reduce((acc,width)=>acc+width,0);},_getColumnWidth:function(column){if(column.attrs.width){return column.attrs.width;}
const fieldsInfo=this.state.fieldsInfo.list;const name=column.attrs.name;if(!fieldsInfo[name]){return'1';}
const widget=fieldsInfo[name].Widget.prototype;if('widthInList'in widget){return widget.widthInList;}
const field=this.state.fields[name];if(!field){return'1';}
const fixedWidths={boolean:'50px',date:'92px',datetime:'146px',float:'92px',integer:'74px',monetary:'104px',};let type=field.type;if(fieldsInfo[name].widget in fixedWidths){type=fieldsInfo[name].widget;}
return fixedWidths[type]||'1';},_getColumnHeader:function(column){const{icon,name,string}=column.attrs;if(name){return this.el.querySelector(`thead th[data-name="${name}"]`);}else if(string){return this.el.querySelector(`thead th[data-string="${string}"]`);}else if(icon){return this.el.querySelector(`thead th[data-icon="${icon}"]`);}},_getNearestEditableRow:function($row,next){const direction=next?'next':'prev';let $nearestRow;if(this.editable){$nearestRow=$row[direction]();if(!$nearestRow.hasClass('o_data_row')){var $nextBody=$row.closest('tbody')[direction]();while($nextBody.length&&!$nextBody.find('.o_data_row').length){$nextBody=$nextBody[direction]();}
$nearestRow=$nextBody.find(`.o_data_row:${next ? 'first' : 'last'}`);}}else{const recordId=$row.data('id');const rowSelectionIndex=this.selection.indexOf(recordId);let nextRowIndex;if(rowSelectionIndex<0){nextRowIndex=next?0:this.selection.length-1;}else{nextRowIndex=rowSelectionIndex+(next?1:-1);}
$nearestRow=this._getRow(this.selection[nextRowIndex]);}
return $nearestRow;},_getNumberOfCols:function(){var n=this._super();if(this.addTrashIcon){n++;}
return n;},_getRecord:function(recordId){var record;utils.traverse_records(this.state,function(r){if(r.id===recordId){record=r;}});return record;},_getRecordID:function(rowIndex){var $tr=this.$('table.o_list_table > tbody > tr').eq(rowIndex);return $tr.data('id');},_getRow:function(recordId){return this.$('.o_data_row[data-id="'+recordId+'"]');},_hasVisibleRecords:function(list){if(!list.groupedBy.length){return!!list.data.length;}else{var hasVisibleRecords=false;for(var i=0;i<list.data.length;i++){hasVisibleRecords=hasVisibleRecords||this._hasVisibleRecords(list.data[i]);}
return hasVisibleRecords;}},_isRecordEditable:function(recordID){return this.editable||(this.isMultiEditable&&this.selection.includes(recordID));},_moveToNextLine:function(options){this._moveToSideLine(true,options);},_moveToPreviousLine:function(options){this._moveToSideLine(false,options);},_moveToSideLine:function(next,options){options=options||{};const recordID=this._getRecordID(this.currentRow);this.commitChanges(recordID).then(()=>{const record=this._getRecord(recordID);const multiEdit=this.isInMultipleRecordEdition(recordID);if(!multiEdit){const fieldNames=this.canBeSaved(recordID);if(fieldNames.length&&(record.isDirty()||options.forceCreate)){return;}}
const side=next?'first':'last';const borderRowIndex=this._getBorderRow(side).prop('rowIndex')-1;const cellIndex=next?0:this.allFieldWidgets[recordID].length-1;const cellOptions={inc:next?1:-1,force:true};const $currentRow=this._getRow(recordID);const $nextRow=this._getNearestEditableRow($currentRow,next);let nextRowIndex=null;let groupId;if(!this.isGrouped){if($nextRow.length){nextRowIndex=$nextRow.prop('rowIndex')-1;}else if(!this.editable){nextRowIndex=borderRowIndex;}else if(!options.forceCreate&&!record.isDirty()){this.trigger_up('discard_changes',{recordID:recordID,onSuccess:this.trigger_up.bind(this,'activate_next_widget',{side:side}),});return;}}else{var $directNextRow=$currentRow.next();if(next&&this.editable==="bottom"&&$directNextRow.hasClass('o_add_record_row')){if(options.forceCreate||record.isDirty()){groupId=$directNextRow.data('group-id');}else{nextRowIndex=($nextRow.prop('rowIndex')-1)||null;this.trigger_up('discard_changes',{recordID:recordID,onSuccess:()=>{if(nextRowIndex!==null){if(!record.res_id){nextRowIndex--;}
this._selectCell(nextRowIndex,cellIndex,cellOptions);}else{this._selectCell(borderRowIndex,cellIndex,cellOptions);}},});return;}}else{nextRowIndex=$nextRow.length?($nextRow.prop('rowIndex')-1):borderRowIndex;}}
if(nextRowIndex!==null){this._selectCell(nextRowIndex,cellIndex,cellOptions);}else if(this.editable){this.unselectRow().then(this.trigger_up.bind(this,'add_record',{groupId:groupId,onFail:this._selectCell.bind(this,borderRowIndex,cellIndex,cellOptions),}));}});},_processColumns:function(){const oldColumns=this.columns;this._super.apply(this,arguments);if(this.columnWidths&&oldColumns&&oldColumns.length===this.columns.length){for(let i=0;i<oldColumns.length;i++){if(oldColumns[i]!==this.columns[i]){this.columnWidths=false;break;}}}else{this.columnWidths=false;}},_render:function(){this.currentRow=null;this.currentFieldIndex=null;return this._super.apply(this,arguments);},_renderGroup:function(group){var result=this._super.apply(this,arguments);if(!group.groupedBy.length&&this.addCreateLineInGroups){var $groupBody=result[0];var $a=$('<a href="#" role="button">').text(_t("Add a line")).attr('data-group-id',group.id);var $td=$('<td>').attr('colspan',this._getNumberOfCols()).addClass('o_group_field_row_add').attr('tabindex',-1).append($a);var $tr=$('<tr>',{class:'o_add_record_row'}).attr('data-group-id',group.id).append($td);$groupBody.append($tr.prepend($('<td>').html('&nbsp;')));}
return result;},_renderBody:function(){var self=this;var $body=this._super.apply(this,arguments);if(this.hasHandle){$body.sortable({axis:'y',items:'> tr.o_data_row',helper:'clone',handle:'.o_row_handle',stop:function(event,ui){if(self.currentRow!==null){var currentID=self.state.data[self.currentRow].id;self.currentRow=self._getRow(currentID).index();}
self.unselectRow().then(function(){self._moveRecord(ui.item.data('id'),ui.item.index());});},});}
return $body;},_renderFooter:function(){const $footer=this._super.apply(this,arguments);if(this.addTrashIcon){$footer.find('tr').append($('<td>'));}
return $footer;},_renderHeader:function(){var $thead=this._super.apply(this,arguments);if(this.addTrashIcon){$thead.find('tr').append($('<th>',{class:'o_list_record_remove_header'}));}
return $thead;},_renderHeaderCell:function(){const $th=this._super.apply(this,arguments);if($th[0].innerHTML.length&&this._hasVisibleRecords(this.state)){const resizeHandle=document.createElement('span');resizeHandle.classList='o_resize';resizeHandle.onclick=this._onClickResize.bind(this);resizeHandle.onmousedown=this._onStartResize.bind(this);$th.append(resizeHandle);}
return $th;},_renderRow:function(record,index){var $row=this._super.apply(this,arguments);if(this.addTrashIcon){var $icon=this.isMany2Many?$('<button>',{'class':'fa fa-times','name':'unlink','aria-label':_t('Unlink row ')+(index+1)}):$('<button>',{'class':'fa fa-trash-o','name':'delete','aria-label':_t('Delete row ')+(index+1)});var $td=$('<td>',{class:'o_list_record_remove'}).append($icon);$row.append($td);}
return $row;},_renderRows:function(){var $rows=this._super();if(this.addCreateLine){var $tr=$('<tr>');var colspan=this._getNumberOfCols();if(this.handleField){colspan=colspan-1;$tr.append('<td>');}
var $td=$('<td>').attr('colspan',colspan).addClass('o_field_x2many_list_row_add');$tr.append($td);$rows.push($tr);_.each(this.creates,function(create,index){var $a=$('<a href="#" role="button">').attr('data-context',create.context).text(create.string);if(index>0){$a.addClass('ml16');}
$td.append($a);});}
return $rows;},_renderView:function(){this.currentRow=null;return this._super.apply(this,arguments).then(()=>{const table=this.el.getElementsByTagName('table')[0];if(table){table.classList.toggle('o_empty_list',!this._hasVisibleRecords(this.state));this._freezeColumnWidths();}});},_selectCell:function(rowIndex,fieldIndex,options){options=options||{};if(!options.force&&rowIndex===this.currentRow&&fieldIndex===this.currentFieldIndex){return Promise.resolve();}
var wrap=options.wrap===undefined?true:options.wrap;var recordID=this._getRecordID(rowIndex);var self=this;return this._selectRow(rowIndex).then(function(){var record=self._getRecord(recordID);if(fieldIndex>=(self.allFieldWidgets[record.id]||[]).length){return Promise.reject();}
var oldFieldIndex=self.currentFieldIndex;self.currentFieldIndex=fieldIndex;fieldIndex=self._activateFieldWidget(record,fieldIndex,{inc:options.inc||1,wrap:wrap,event:options&&options.event,});if(fieldIndex<0){self.currentFieldIndex=oldFieldIndex;return Promise.reject();}
self.currentFieldIndex=fieldIndex;});},_selectRow:function(rowIndex){if(rowIndex===this.currentRow){return Promise.resolve();}
if(!this.columnWidths){this._storeColumnWidths();}
var recordId=this._getRecordID(rowIndex);var self=this;return this.unselectRow().then(noSelectNext=>{if(noSelectNext){return Promise.resolve();}
if(!recordId){return Promise.reject();}
return new Promise(function(resolve){self.trigger_up('edit_line',{recordId:recordId,onSuccess:function(){self._disableRecordSelectors();resolve();},});});});},_squeezeTable:function(){const table=this.el.getElementsByTagName('table')[0];table.classList.add('o_list_computing_widths');const thead=table.getElementsByTagName('thead')[0];const thElements=[...thead.getElementsByTagName('th')];const columnWidths=thElements.map(th=>th.offsetWidth);const getWidth=th=>columnWidths[thElements.indexOf(th)]||0;const getTotalWidth=()=>thElements.reduce((tot,th,i)=>tot+columnWidths[i],0);const shrinkColumns=(columns,width)=>{let thresholdReached=false;columns.forEach(th=>{const index=thElements.indexOf(th);let maxWidth=columnWidths[index]-Math.ceil(width/columns.length);if(maxWidth<92){maxWidth=92;thresholdReached=true;}
th.style.maxWidth=`${maxWidth}px`;columnWidths[index]=maxWidth;});return thresholdReached;};const sortedThs=[...thead.getElementsByTagName('th')].sort((a,b)=>getWidth(b)-getWidth(a));const allowedWidth=table.parentNode.offsetWidth;let totalWidth=getTotalWidth();let stop=false;let index=0;while(totalWidth>allowedWidth&&!stop){index++;const largests=sortedThs.slice(0,index);while(getWidth(largests[0])===getWidth(sortedThs[index])){largests.push(sortedThs[index]);index++;}
const nextLargest=sortedThs[index];const totalToRemove=totalWidth-allowedWidth;const canRemove=(getWidth(largests[0])-getWidth(nextLargest))*largests.length;stop=shrinkColumns(largests,Math.min(totalToRemove,canRemove));totalWidth=getTotalWidth();}
table.classList.remove('o_list_computing_widths');return columnWidths;},_storeColumnWidths:function(){this.columnWidths=this.$('thead th').toArray().map(function(th){return $(th).outerWidth();});},_onAddRecordToGroup:function(ev){ev.preventDefault();ev.stopPropagation();var self=this;const target=ev.target.tagName!=='A'?ev.target.getElementsByTagName('A')[0]:ev.target;const groupId=target.dataset.groupId;this.currentGroupId=groupId;this.unselectRow().then(function(){self.trigger_up('add_record',{groupId:groupId,});});},_onAddRecord:function(ev){ev.preventDefault();ev.stopPropagation();var self=this;this.unselectRow().then(function(){self.trigger_up('add_record',{context:ev.currentTarget.dataset.context&&[ev.currentTarget.dataset.context]});});},_onCellClick:function(event){var $td=$(event.currentTarget);var $tr=$td.parent();var rowIndex=$tr.prop('rowIndex')-1;if(!this._isRecordEditable($tr.data('id'))||$(event.target).prop('special_click')){return;}
var fieldIndex=Math.max($tr.find('.o_field_cell').index($td),0);this._selectCell(rowIndex,fieldIndex,{event:event});},_onClickResize:function(ev){ev.stopPropagation();ev.preventDefault();},_onEmptyRowClick:function(){this.unselectRow();},_onFooterClick:function(){this.unselectRow();},_onKeyDown:function(ev){const $target=$(ev.currentTarget);const $tr=$target.closest('tr');const recordEditable=this._isRecordEditable($tr.data('id'));if(recordEditable&&ev.keyCode===$.ui.keyCode.ENTER&&$tr.hasClass('o_selected_row')){return;}
if(recordEditable&&ev.keyCode===$.ui.keyCode.ENTER&&!$tr.hasClass('o_selected_row')&&!$tr.hasClass('o_group_header')){ev.stopPropagation();ev.preventDefault();if($target.closest('td').hasClass('o_group_field_row_add')){this._onAddRecordToGroup(ev);}else{this._onCellClick(ev);}}else{this._super.apply(this,arguments);}},_onKeyDownAddRecord:function(e){switch(e.keyCode){case $.ui.keyCode.ENTER:e.stopPropagation();e.preventDefault();this._onAddRecord(e);break;}},_onNavigationMove:function(ev){var self=this;if(this.currentRow===null&&ev.data.direction==='up'){return;}
ev.stopPropagation();switch(ev.data.direction){case'previous':if(this.currentFieldIndex>0){this._selectCell(this.currentRow,this.currentFieldIndex-1,{inc:-1,wrap:false}).guardedCatch(this._moveToPreviousLine.bind(this));}else{this._moveToPreviousLine();}
break;case'next':if(this.currentFieldIndex+1<this.columns.length){this._selectCell(this.currentRow,this.currentFieldIndex+1,{wrap:false}).guardedCatch(this._moveToNextLine.bind(this));}else{this._moveToNextLine();}
break;case'next_line':if(!this.editable&&this.selection.length===1&&this._getRecordID(this.currentRow)===ev.target.dataPointID){this.unselectRow();}else{this._moveToNextLine({forceCreate:true});}
break;case'cancel':ev.data.originalEvent.stopPropagation();var rowIndex=this.currentRow;var cellIndex=this.currentFieldIndex+1;this.trigger_up('discard_changes',{recordID:ev.target.dataPointID,onSuccess:function(){self._enableRecordSelectors();var recordId=self._getRecordID(rowIndex);if(recordId){var correspondingRow=self._getRow(recordId);correspondingRow.children().eq(cellIndex).focus();}else if(self.currentGroupId){self.$('a[data-group-id="'+self.currentGroupId+'"]').focus();}else{self.$('.o_field_x2many_list_row_add a:first').focus();}}});break;}},_onRemoveIconClick:function(event){event.stopPropagation();var $row=$(event.target).closest('tr');var id=$row.data('id');if($row.hasClass('o_selected_row')){this.trigger_up('list_record_remove',{id:id});}else{var self=this;this.unselectRow().then(function(){self.trigger_up('list_record_remove',{id:id});});}},_onResize:function(){this.columnWidths=false;this._freezeColumnWidths();},_onRowClicked:function(ev){if(!this._isRecordEditable(ev.currentTarget.dataset.id)){if(this.getEditableRecordID()){this.unselectRow();}else{this._super.apply(this,arguments);}}},_onSortColumn:function(){if(this.currentRow===null&&!this.isResizing){this._super.apply(this,arguments);}},_onStartResize:function(ev){if(ev.which!==1){return;}
ev.preventDefault();ev.stopPropagation();this.isResizing=true;const table=this.el.getElementsByTagName('table')[0];const th=ev.target.closest('th');table.style.width=`${table.offsetWidth}px`;const thPosition=[...th.parentNode.children].indexOf(th);const resizingColumnElements=[...table.getElementsByTagName('tr')].filter(tr=>tr.children.length===th.parentNode.children.length).map(tr=>tr.children[thPosition]);const optionalDropdown=this.el.getElementsByClassName('o_optional_columns')[0];const initialX=ev.pageX;const initialWidth=th.offsetWidth;const initialTableWidth=table.offsetWidth;const initialDropdownX=optionalDropdown?optionalDropdown.offsetLeft:null;const resizeStoppingEvents=['keydown','mousedown','mouseup',];table.classList.add('o_resizing');resizingColumnElements.forEach(el=>el.classList.add('o_column_resizing'));const resizeHeader=ev=>{ev.preventDefault();ev.stopPropagation();const delta=ev.pageX-initialX;const newWidth=Math.max(10,initialWidth+delta);const tableDelta=newWidth-initialWidth;th.style.width=`${newWidth}px`;th.style.maxWidth=`${newWidth}px`;table.style.width=`${initialTableWidth + tableDelta}px`;if(optionalDropdown){optionalDropdown.style.left=`${initialDropdownX + tableDelta}px`;}};this._addEventListener('mousemove',window,resizeHeader);const stopResize=ev=>{if(ev.type==='mousedown'&&ev.which===1){return;}
ev.preventDefault();ev.stopPropagation();clearTimeout(this.resizeTimeout);this.resizeTimeout=setTimeout(()=>{this.isResizing=false;},100);window.removeEventListener('mousemove',resizeHeader);table.classList.remove('o_resizing');resizingColumnElements.forEach(el=>el.classList.remove('o_column_resizing'));resizeStoppingEvents.forEach(stoppingEvent=>{window.removeEventListener(stoppingEvent,stopResize);});document.activeElement.blur();};resizeStoppingEvents.forEach(stoppingEvent=>{this._addEventListener(stoppingEvent,window,stopResize);});},_onToggleOptionalColumnDropdown:function(ev){this.unselectRow().then(this._super.bind(this,ev));},_onWindowClicked:function(event){if(!this.isEditable()){return;}
if(!document.contains(this.el)){return;}
if(this.currentRow===null){return;}
if($(event.target).closest('.ui-autocomplete').length){return;}
var $clickModal=$(event.target).closest('.modal');if($clickModal.length){var $listModal=this.$el.closest('.modal');if($clickModal.prop('id')!==$listModal.prop('id')){return;}}
if(!document.contains(event.target)){return;}
if(this.el.contains(event.target)&&this.el!==event.target){return;}
this.unselectRow();},});});;

/* /web/static/src/js/views/list/list_model.js defined in bundle 'web.assets_backend' */
odoo.define('web.ListModel',function(require){"use strict";var BasicModel=require('web.BasicModel');var ListModel=BasicModel.extend({init:function(parent,params){this._super.apply(this,arguments);this.groupbys=params.groupbys;},get:function(){var result=this._super.apply(this,arguments);var dp=result&&this.localData[result.id];if(dp&&dp.groupData){result.groupData=this.get(dp.groupData);}
return result;},saveRecords:function(listDatapointId,referenceRecordId,recordIds,fieldName){var self=this;var referenceRecord=this.localData[referenceRecordId];var list=this.localData[listDatapointId];var allChanges=this._generateChanges(referenceRecord,{changesOnly:false});var changes=_.pick(allChanges,fieldName);var records=recordIds.map(function(recordId){return self.localData[recordId];});var model=records[0].model;var recordResIds=_.pluck(records,'res_id');var fieldNames=records[0].getFieldNames();var context=records[0].getContext();return this._rpc({model:model,method:'write',args:[recordResIds,changes],context:context,}).then(function(){return self._rpc({model:model,method:'read',args:[recordResIds,fieldNames],context:context,});}).then(function(results){results.forEach(function(data){var record=_.findWhere(records,{res_id:data.id});record.data=_.extend({},record.data,data);record._changes={};record._isDirty=false;self._parseServerData(fieldNames,record,record.data);});}).then(function(){if(!list.groupedBy.length){return Promise.all([self._fetchX2ManysBatched(list),self._fetchReferencesBatched(list)]);}else{return Promise.all([self._fetchX2ManysSingleBatch(list),self._fetchReferencesSingleBatch(list)]);}});},_readGroup:function(list,options){var self=this;options=options||{};options.fetchRecordsWithGroups=true;return this._super(list,options).then(function(result){return self._readGroupExtraFields(list).then(_.constant(result));});},_readGroupExtraFields:function(list){var self=this;var groupByFieldName=list.groupedBy[0].split(':')[0];var groupedByField=list.fields[groupByFieldName];if(groupedByField.type!=='many2one'||!this.groupbys[groupByFieldName]){return Promise.resolve();}
var groupIds=_.reduce(list.data,function(groupIds,id){var resId=self.get(id,{raw:true}).res_id;if(resId){groupIds.push(resId);}
return groupIds;},[]);var groupFields=Object.keys(this.groupbys[groupByFieldName].viewFields);var prom;if(groupIds.length&&groupFields.length){prom=this._rpc({model:groupedByField.relation,method:'read',args:[groupIds,groupFields],context:list.context,});}
return Promise.resolve(prom).then(function(result){var fvg=self.groupbys[groupByFieldName];_.each(list.data,function(id){var dp=self.localData[id];var groupData=result&&_.findWhere(result,{id:dp.res_id,});var groupDp=self._makeDataPoint({context:dp.context,data:groupData,fields:fvg.fields,fieldsInfo:fvg.fieldsInfo,modelName:groupedByField.relation,parentID:dp.id,res_id:dp.res_id,viewType:'groupby',});dp.groupData=groupDp.id;self._parseServerData(groupFields,groupDp,groupDp.data);});});},});return ListModel;});;

/* /web/static/src/js/views/list/list_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.ListRenderer',function(require){"use strict";var BasicRenderer=require('web.BasicRenderer');var config=require('web.config');var core=require('web.core');var dom=require('web.dom');var field_utils=require('web.field_utils');var Pager=require('web.Pager');var utils=require('web.utils');var viewUtils=require('web.viewUtils');var _t=core._t;var DECORATIONS=['decoration-bf','decoration-it','decoration-danger','decoration-info','decoration-muted','decoration-primary','decoration-success','decoration-warning'];var FIELD_CLASSES={char:'o_list_char',float:'o_list_number',integer:'o_list_number',monetary:'o_list_number',text:'o_list_text',many2one:'o_list_many2one',};var ListRenderer=BasicRenderer.extend({events:{"mousedown":"_onMouseDown","click .o_optional_columns_dropdown .dropdown-item":"_onToggleOptionalColumn","click .o_optional_columns_dropdown_toggle":"_onToggleOptionalColumnDropdown",'click tbody tr':'_onRowClicked','change tbody .o_list_record_selector':'_onSelectRecord','click thead th.o_column_sortable':'_onSortColumn','click .o_group_header':'_onToggleGroup','change thead .o_list_record_selector input':'_onToggleSelection','keypress thead tr td':'_onKeyPress','keydown td':'_onKeyDown','keydown th':'_onKeyDown',},init:function(parent,state,params){this._super.apply(this,arguments);this.columnInvisibleFields=params.columnInvisibleFields;this.rowDecorations=_.chain(this.arch.attrs).pick(function(value,key){return DECORATIONS.indexOf(key)>=0;}).mapObject(function(value){return py.parse(py.tokenize(value));}).value();this.hasSelectors=params.hasSelectors;this.selection=params.selectedRecords||[];this.pagers=[];this.isGrouped=this.state.groupedBy.length>0;this.groupbys=params.groupbys;},willStart:function(){this._processColumns(this.columnInvisibleFields||{});return this._super.apply(this,arguments);},giveFocus:function(){this.$('th:eq(0) input, th:eq(1)').first().focus();},updateState:function(state,params){this.isGrouped=state.groupedBy.length>0;this._processColumns(params.columnInvisibleFields||{});if(params.selectedRecords){this.selection=params.selectedRecords;}
return this._super.apply(this,arguments);},_computeAggregates:function(){var self=this;var data=[];if(this.selection.length){utils.traverse_records(this.state,function(record){if(_.contains(self.selection,record.id)){data.push(record);}});}else{data=this.state.data;}
_.each(this.columns,this._computeColumnAggregates.bind(this,data));},_computeColumnAggregates:function(data,column){var attrs=column.attrs;var field=this.state.fields[attrs.name];if(!field){return;}
var type=field.type;if(type!=='integer'&&type!=='float'&&type!=='monetary'){return;}
var func=(attrs.sum&&'sum')||(attrs.avg&&'avg')||(attrs.max&&'max')||(attrs.min&&'min');if(func){var count=0;var aggregateValue=0;if(func==='max'){aggregateValue=-Infinity;}else if(func==='min'){aggregateValue=Infinity;}
_.each(data,function(d){count+=1;var value=(d.type==='record')?d.data[attrs.name]:d.aggregateValues[attrs.name];if(func==='avg'){aggregateValue+=value;}else if(func==='sum'){aggregateValue+=value;}else if(func==='max'){aggregateValue=Math.max(aggregateValue,value);}else if(func==='min'){aggregateValue=Math.min(aggregateValue,value);}});if(func==='avg'){aggregateValue=count?aggregateValue/count:aggregateValue;}
column.aggregate={help:attrs[func],value:aggregateValue,};}},_findConnectedCell:function($cell,direction,colIndex){var $connectedRow=$cell.closest('tr')[direction]('tr');if(!$connectedRow.length){var tbody=$cell.closest('tbody, thead');var $connectedGroup=tbody[direction]('tbody, thead');if($connectedGroup.length){var $connectedRows=$connectedGroup.find('tr');var rowIndex;if(direction==='prev'){rowIndex=$connectedRows.length-1;}else{rowIndex=0;}
$connectedRow=$connectedRows.eq(rowIndex);}else{return;}}
var $connectedCell;if($connectedRow.hasClass('o_group_header')){$connectedCell=$connectedRow.children();this.currentColIndex=colIndex;}else if($connectedRow.has('td.o_group_field_row_add').length){$connectedCell=$connectedRow.find('.o_group_field_row_add');this.currentColIndex=colIndex;}else{var connectedRowChildren=$connectedRow.children();if(colIndex===-1){colIndex=connectedRowChildren.length-1;}
$connectedCell=connectedRowChildren.eq(colIndex);}
return $connectedCell;},_getNumberOfCols:function(){var n=this.columns.length;return this.hasSelectors?n+1:n;},_getOptionalColumnsStorageKeyParts:function(){var self=this;return{fields:_.map(this.state.fieldsInfo[this.viewType],function(_,fieldName){return{name:fieldName,type:self.state.fields[fieldName].type};}),};},_processColumns:function(columnInvisibleFields){var self=this;this.handleField=null;this.columns=[];this.optionalColumns=[];this.optionalColumnsEnabled=[];var storedOptionalColumns;this.trigger_up('load_optional_fields',{keyParts:this._getOptionalColumnsStorageKeyParts(),callback:function(res){storedOptionalColumns=res;},});_.each(this.arch.children,function(c){if(c.tag!=='control'&&c.tag!=='groupby'){var reject=c.attrs.modifiers.column_invisible;if(c.attrs.name in columnInvisibleFields){reject=columnInvisibleFields[c.attrs.name];}
if(c.attrs.class){if(c.attrs.class.match(/\boe_edit_only\b/)){c.attrs.editOnly=true;}
if(c.attrs.class.match(/\boe_read_only\b/)){c.attrs.readOnly=true;}}
if(!reject&&c.attrs.widget==='handle'){self.handleField=c.attrs.name;if(self.isGrouped){reject=true;}}
if(!reject&&c.attrs.optional){self.optionalColumns.push(c);var enabled;if(storedOptionalColumns===undefined){enabled=c.attrs.optional==='show';}else{enabled=_.contains(storedOptionalColumns,c.attrs.name);}
if(enabled){self.optionalColumnsEnabled.push(c.attrs.name);}
reject=!enabled;}
if(!reject){self.columns.push(c);}}});},_renderAggregateCells:function(aggregateValues){var self=this;return _.map(this.columns,function(column){var $cell=$('<td>');if(config.isDebug()){$cell.addClass(column.attrs.name);}
if(column.attrs.editOnly){$cell.addClass('oe_edit_only');}
if(column.attrs.readOnly){$cell.addClass('oe_read_only');}
if(column.attrs.name in aggregateValues){var field=self.state.fields[column.attrs.name];var value=aggregateValues[column.attrs.name].value;var help=aggregateValues[column.attrs.name].help;var formatFunc=field_utils.format[column.attrs.widget];if(!formatFunc){formatFunc=field_utils.format[field.type];}
var formattedValue=formatFunc(value,field,{escape:true,digits:column.attrs.digits?JSON.parse(column.attrs.digits):undefined,});$cell.addClass('o_list_number').attr('title',help).html(formattedValue);}
return $cell;});},_renderBody:function(){var self=this;var $rows=this._renderRows();while($rows.length<4){$rows.push(self._renderEmptyRow());}
return $('<tbody>').append($rows);},_renderBodyCell:function(record,node,colIndex,options){var tdClassName='o_data_cell';if(node.tag==='button'){tdClassName+=' o_list_button';}else if(node.tag==='field'){tdClassName+=' o_field_cell';var typeClass=FIELD_CLASSES[this.state.fields[node.attrs.name].type];if(typeClass){tdClassName+=(' '+typeClass);}
if(node.attrs.widget){tdClassName+=(' o_'+node.attrs.widget+'_cell');}}
if(node.attrs.editOnly){tdClassName+=' oe_edit_only';}
if(node.attrs.readOnly){tdClassName+=' oe_read_only';}
var $td=$('<td>',{class:tdClassName,tabindex:-1});var modifiers=this._registerModifiers(node,record,$td,_.pick(options,'mode'));if(modifiers.invisible&&!(options&&options.renderInvisible)){return $td;}
if(node.tag==='button'){return $td.append(this._renderButton(record,node));}else if(node.tag==='widget'){return $td.append(this._renderWidget(record,node));}
if(node.attrs.widget||(options&&options.renderWidgets)){var $el=this._renderFieldWidget(node,record,_.pick(options,'mode'));return $td.append($el);}
this._handleAttributes($td,node);var name=node.attrs.name;var field=this.state.fields[name];var value=record.data[name];var formatter=field_utils.format[field.type];var formatOptions={escape:true,data:record.data,isPassword:'password'in node.attrs,digits:node.attrs.digits&&JSON.parse(node.attrs.digits),};var formattedValue=formatter(value,field,formatOptions);var title='';if(field.type!=='boolean'){title=formatter(value,field,_.extend(formatOptions,{escape:false}));}
return $td.html(formattedValue).attr('title',title);},_renderButton:function(record,node){var self=this;var nodeWithoutWidth=Object.assign({},node);delete nodeWithoutWidth.attrs.width;var $button=viewUtils.renderButtonFromNode(nodeWithoutWidth,{extraClass:node.attrs.icon?'o_icon_button':undefined,textAsTitle:!!node.attrs.icon,});this._handleAttributes($button,node);this._registerModifiers(node,record,$button);if(record.res_id){$button.on("click",function(e){e.stopPropagation();self.trigger_up('button_clicked',{attrs:node.attrs,record:record,});});}else{if(node.attrs.options.warn){$button.on("click",function(e){e.stopPropagation();self.do_warn(_t("Warning"),_t('Please click on the "save" button first.'));});}else{$button.prop('disabled',true);}}
return $button;},_renderEmptyRow:function(){var $td=$('<td>&nbsp;</td>').attr('colspan',this._getNumberOfCols());return $('<tr>').append($td);},_renderFooter:function(){var aggregates={};_.each(this.columns,function(column){if('aggregate'in column){aggregates[column.attrs.name]=column.aggregate;}});var $cells=this._renderAggregateCells(aggregates);if(this.hasSelectors){$cells.unshift($('<td>'));}
return $('<tfoot>').append($('<tr>').append($cells));},_renderGroupButton:function(list,node){var $button=viewUtils.renderButtonFromNode(node,{extraClass:node.attrs.icon?'o_icon_button':undefined,textAsTitle:!!node.attrs.icon,});this._handleAttributes($button,node);this._registerModifiers(node,list.groupData,$button);$button.on("click",this._onGroupButtonClicked.bind(this,list.groupData,node));$button.on("keydown",this._onGroupButtonKeydown.bind(this));return $button;},_renderGroupButtons:function(list,group){var self=this;var $buttons=$();if(list.value){group.arch.children.forEach(function(child){if(child.tag==='button'){$buttons=$buttons.add(self._renderGroupButton(list,child));}});}
return $buttons;},_renderGroupPager:function(group){var pager=new Pager(this,group.count,group.offset+1,group.limit);pager.on('pager_changed',this,function(newState){var self=this;pager.disable();this.trigger_up('load',{id:group.id,limit:newState.limit,offset:newState.current_min-1,on_success:function(reloadedGroup){_.extend(group,reloadedGroup);self._renderView();},on_fail:pager.enable.bind(pager),});});this.pagers.push(pager);var pagerProm=pager._widgetRenderAndInsert(function(){});this.defs.push(pagerProm);var $el=$('<div>');pagerProm.then(function(){$el.replaceWith(pager.$el);});return $el;},_renderGroupRow:function(group,groupLevel){var cells=[];var name=group.value===undefined?_t('Undefined'):group.value;var groupBy=this.state.groupedBy[groupLevel];if(group.fields[groupBy.split(':')[0]].type!=='boolean'){name=name||_t('Undefined');}
var $th=$('<th>').addClass('o_group_name').attr('tabindex',-1).text(name+' ('+group.count+')');var $arrow=$('<span>').css('padding-left',(groupLevel*20)+'px').css('padding-right','5px').addClass('fa');if(group.count>0){$arrow.toggleClass('fa-caret-right',!group.isOpen).toggleClass('fa-caret-down',group.isOpen);}
$th.prepend($arrow);cells.push($th);var aggregateKeys=Object.keys(group.aggregateValues);var aggregateValues=_.mapObject(group.aggregateValues,function(value){return{value:value};});var aggregateCells=this._renderAggregateCells(aggregateValues);var firstAggregateIndex=_.findIndex(this.columns,function(column){return column.tag==='field'&&_.contains(aggregateKeys,column.attrs.name);});var colspanBeforeAggregate;if(firstAggregateIndex!==-1){colspanBeforeAggregate=firstAggregateIndex;var lastAggregateIndex=_.findLastIndex(this.columns,function(column){return column.tag==='field'&&_.contains(aggregateKeys,column.attrs.name);});cells=cells.concat(aggregateCells.slice(firstAggregateIndex,lastAggregateIndex+1));var colSpan=this.columns.length-1-lastAggregateIndex;if(colSpan>0){cells.push($('<th>').attr('colspan',colSpan));}}else{var colN=this.columns.length;colspanBeforeAggregate=colN>1?colN-1:1;if(colN>1){cells.push($('<th>'));}}
if(this.hasSelectors){colspanBeforeAggregate+=1;}
$th.attr('colspan',colspanBeforeAggregate);if(group.isOpen&&!group.groupedBy.length&&(group.count>group.data.length)){var $pager=this._renderGroupPager(group);var $lastCell=cells[cells.length-1];$lastCell.append($pager);}
if(group.isOpen&&this.groupbys[groupBy]){var $buttons=this._renderGroupButtons(group,this.groupbys[groupBy]);if($buttons.length){var $buttonSection=$('<div>',{class:'o_group_buttons',}).append($buttons);$th.append($buttonSection);}}
return $('<tr>').addClass('o_group_header').toggleClass('o_group_open',group.isOpen).toggleClass('o_group_has_content',group.count>0).data('group',group).append(cells);},_renderGroup:function(group,groupLevel){var self=this;if(group.groupedBy.length){return this._renderGroups(group.data,groupLevel+1);}else{var $records=_.map(group.data,function(record){return self._renderRow(record);});return[$('<tbody>').append($records)];}},_renderGroups:function(data,groupLevel){var self=this;groupLevel=groupLevel||0;var result=[];var $tbody=$('<tbody>');_.each(data,function(group){if(!$tbody){$tbody=$('<tbody>');}
$tbody.append(self._renderGroupRow(group,groupLevel));if(group.data.length){result.push($tbody);result=result.concat(self._renderGroup(group,groupLevel));$tbody=null;}});if($tbody){result.push($tbody);}
return result;},_renderHeader:function(){var $tr=$('<tr>').append(_.map(this.columns,this._renderHeaderCell.bind(this)));if(this.hasSelectors){$tr.prepend(this._renderSelector('th'));}
return $('<thead>').append($tr);},_renderHeaderCell:function(node){const{icon,name,string}=node.attrs;var order=this.state.orderedBy;var isNodeSorted=order[0]&&order[0].name===name;var field=this.state.fields[name];var $th=$('<th>');if(name){$th.attr('data-name',name);}else if(string){$th.attr('data-string',string);}else if(icon){$th.attr('data-icon',icon);}
if(node.attrs.editOnly){$th.addClass('oe_edit_only');}
if(node.attrs.readOnly){$th.addClass('oe_read_only');}
if(!field){return $th;}
var description=string||field.string;if(node.attrs.widget){$th.addClass(' o_'+node.attrs.widget+'_cell');if(this.state.fieldsInfo.list[name].Widget.prototype.noLabel){description='';}}
$th.text(description).attr('tabindex',-1).toggleClass('o-sort-down',isNodeSorted?!order[0].asc:false).toggleClass('o-sort-up',isNodeSorted?order[0].asc:false).addClass(field.sortable&&'o_column_sortable');if(isNodeSorted){$th.attr('aria-sort',order[0].asc?'ascending':'descending');}
if(field.type==='float'||field.type==='integer'||field.type==='monetary'){$th.addClass('o_list_number_th');}
if(config.isDebug()){var fieldDescr={field:field,name:name,string:description||name,record:this.state,attrs:_.extend({},node.attrs,this.state.fieldsInfo.list[name]),};this._addFieldTooltip(fieldDescr,$th);}else{$th.attr('title',description);}
return $th;},_renderRow:function(record){var self=this;var $cells=this.columns.map(function(node,index){return self._renderBodyCell(record,node,index,{mode:'readonly'});});var $tr=$('<tr/>',{class:'o_data_row'}).attr('data-id',record.id).append($cells);if(this.hasSelectors){$tr.prepend(this._renderSelector('td',!record.res_id));}
this._setDecorationClasses(record,$tr);return $tr;},_renderRows:function(){return this.state.data.map(this._renderRow.bind(this));},_renderOptionalColumnsDropdown:function(){var self=this;var $optionalColumnsDropdown=$('<div>',{class:'o_optional_columns text-center dropdown',});var $a=$("<a>",{'class':"dropdown-toggle text-dark o-no-caret",'href':"#",'role':"button",'data-toggle':"dropdown",'data-display':"static",'aria-expanded':false,'aria-label':_t('Optional columns'),});$a.appendTo($optionalColumnsDropdown);var direction=_t.database.parameters.direction;var dropdownMenuClass=direction==='rtl'?'dropdown-menu-left':'dropdown-menu-right';var $dropdown=$("<div>",{class:'dropdown-menu o_optional_columns_dropdown '+dropdownMenuClass,role:'menu',});this.optionalColumns.forEach(function(col){var txt=(col.attrs.string||self.state.fields[col.attrs.name].string)+
(config.isDebug()?(' ('+col.attrs.name+')'):'');var $checkbox=dom.renderCheckbox({text:txt,role:"menuitemcheckbox",prop:{name:col.attrs.name,checked:_.contains(self.optionalColumnsEnabled,col.attrs.name),}});$dropdown.append($("<div>",{class:"dropdown-item",}).append($checkbox));});$dropdown.appendTo($optionalColumnsDropdown);return $optionalColumnsDropdown;},_renderSelector:function(tag,disableInput){var $content=dom.renderCheckbox();if(disableInput){$content.find("input[type='checkbox']").prop('disabled',disableInput);}
return $('<'+tag+'>').addClass('o_list_record_selector').append($content);},_renderView:function(){var self=this;var oldPagers=this.pagers;this.pagers=[];var displayNoContentHelper=!this._hasContent()&&!!this.noContentHelp;this.$el.toggleClass('o_list_view',!displayNoContentHelper);if(displayNoContentHelper){_.invoke(oldPagers,'destroy');this.$el.removeClass('table-responsive');this.$el.html(this._renderNoContentHelper());return this._super.apply(this,arguments);}
var orderedBy=this.state.orderedBy;this.hasHandle=orderedBy.length===0||orderedBy[0].name===this.handleField;this._computeAggregates();var $table=$('<table>').addClass('o_list_table table table-sm table-hover table-striped');$table.toggleClass('o_list_table_grouped',this.isGrouped);$table.toggleClass('o_list_table_ungrouped',!this.isGrouped);var defs=[];this.defs=defs;if(this.isGrouped){$table.append(this._renderHeader());$table.append(this._renderGroups(this.state.data));$table.append(this._renderFooter());}else{$table.append(this._renderHeader());$table.append(this._renderBody());$table.append(this._renderFooter());}
delete this.defs;var prom=Promise.all(defs).then(function(){_.invoke(oldPagers,'destroy');self.$el.html($('<div>',{class:'table-responsive',html:$table}));if(self.optionalColumns.length){self.$el.addClass('o_list_optional_columns');self.$('table').append($('<i class="o_optional_columns_dropdown_toggle fa fa-ellipsis-v"/>'));self.$el.append(self._renderOptionalColumnsDropdown());}
if(self.selection.length){var $checked_rows=self.$('tr').filter(function(index,el){return _.contains(self.selection,$(el).data('id'));});$checked_rows.find('.o_list_record_selector input').prop('checked',true);}});return Promise.all([this._super.apply(this,arguments),prom]);},_setDecorationClasses:function(record,$tr){_.each(this.rowDecorations,function(expr,decoration){var cssClass=decoration.replace('decoration','text');$tr.toggleClass(cssClass,py.PY_isTrue(py.evaluate(expr,record.evalContext)));});},_updateFooter:function(){this._computeAggregates();this.$('tfoot').replaceWith(this._renderFooter());},_updateSelection:function(){this.selection=[];var self=this;var $inputs=this.$('tbody .o_list_record_selector input:visible:not(:disabled)');var allChecked=$inputs.length>0;$inputs.each(function(index,input){if(input.checked){self.selection.push($(input).closest('tr').data('id'));}else{allChecked=false;}});this.$('thead .o_list_record_selector input').prop('checked',allChecked);this.trigger_up('selection_changed',{selection:this.selection});this._updateFooter();},_onGroupButtonClicked:function(record,node,ev){ev.stopPropagation();if(node.attrs.type==='edit'){this.trigger_up('group_edit_button_clicked',{record:record,});}else{this.trigger_up('button_clicked',{attrs:node.attrs,record:record,});}},_onGroupButtonKeydown:function(ev){if(ev.keyCode===$.ui.keyCode.ENTER){ev.stopPropagation();}},_onToggleOptionalColumn:function(ev){var self=this;ev.stopPropagation();ev.preventDefault();var input=ev.currentTarget.querySelector('input');var fieldIndex=this.optionalColumnsEnabled.indexOf(input.name);if(fieldIndex>=0){this.optionalColumnsEnabled.splice(fieldIndex,1);}else{this.optionalColumnsEnabled.push(input.name);}
this.trigger_up('save_optional_fields',{keyParts:this._getOptionalColumnsStorageKeyParts(),optionalColumnsEnabled:this.optionalColumnsEnabled,});this._processColumns(this.columnInvisibleFields||{});this._renderView().then(function(){self._onToggleOptionalColumnDropdown(ev);});},_onToggleOptionalColumnDropdown:function(ev){ev.stopPropagation();this.$('.o_optional_columns .dropdown-toggle').dropdown('toggle');if(_t.database.parameters.direction==='rtl'){var left=this.$('.o_optional_columns .o_optional_columns_dropdown').width();this.$('.o_optional_columns').css("left",left);}},_onKeyDown:function(ev){var $cell=$(ev.currentTarget);var $tr;var $futureCell;var colIndex;switch(ev.keyCode){case $.ui.keyCode.LEFT:ev.preventDefault();$tr=$cell.closest('tr');$tr.closest('tbody').addClass('o_keyboard_navigation');if($tr.hasClass('o_group_header')&&$tr.hasClass('o_group_open')){this._onToggleGroup(ev);}else{$futureCell=$cell.prev();}
break;case $.ui.keyCode.RIGHT:ev.preventDefault();$tr=$cell.closest('tr');$tr.closest('tbody').addClass('o_keyboard_navigation');if($tr.hasClass('o_group_header')&&!$tr.hasClass('o_group_open')){this._onToggleGroup(ev);}else{$futureCell=$cell.next();}
break;case $.ui.keyCode.UP:ev.preventDefault();$cell.closest('tbody').addClass('o_keyboard_navigation');colIndex=this.currentColIndex||$cell.index();$futureCell=this._findConnectedCell($cell,'prev',colIndex);if(!$futureCell){this.trigger_up('navigation_move',{direction:'up'});}
break;case $.ui.keyCode.DOWN:ev.preventDefault();$cell.closest('tbody').addClass('o_keyboard_navigation');colIndex=this.currentColIndex||$cell.index();$futureCell=this._findConnectedCell($cell,'next',colIndex);break;case $.ui.keyCode.ENTER:ev.preventDefault();$tr=$cell.closest('tr');if($tr.hasClass('o_group_header')){this._onToggleGroup(ev);}else{var id=$tr.data('id');if(id){this.trigger_up('open_record',{id:id,target:ev.target});}}
break;}
if($futureCell){var isInGroupHeader=$futureCell.closest('tr').hasClass('o_group_header');var $activables=!isInGroupHeader&&$futureCell.find(':focusable');if($activables.length){$activables[0].focus();}else{$futureCell.focus();}}},_onMouseDown:function(){$('.o_keyboard_navigation').removeClass('o_keyboard_navigation');},_onRowClicked:function(ev){if(!ev.target.closest('.o_list_record_selector')&&!$(ev.target).prop('special_click')){var id=$(ev.currentTarget).data('id');if(id){this.trigger_up('open_record',{id:id,target:ev.target});}}},_onSelectRecord:function(ev){ev.stopPropagation();this._updateSelection();},_onSortColumn:function(ev){var name=$(ev.currentTarget).data('name');this.trigger_up('toggle_column_order',{id:this.state.id,name:name});},_onToggleGroup:function(ev){ev.preventDefault();ev.stopPropagation();var group=$(ev.currentTarget).closest('tr').data('group');if(group.count){this.trigger_up('toggle_group',{group:group,onSuccess:()=>{this._updateSelection();if(document.activeElement.tagName==='BODY'){var groupHeaders=$('tr.o_group_header:data("group")');var header=groupHeaders.filter(function(){return $(this).data('group').id===group.id;});header.find('.o_group_name').focus();}},});}},_onToggleSelection:function(ev){var checked=$(ev.currentTarget).prop('checked')||false;this.$('tbody .o_list_record_selector input:not(":disabled")').prop('checked',checked);this._updateSelection();},});return ListRenderer;});;

/* /web/static/src/js/views/list/list_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.ListView',function(require){"use strict";var BasicView=require('web.BasicView');var core=require('web.core');var ListModel=require('web.ListModel');var ListRenderer=require('web.ListRenderer');var ListController=require('web.ListController');var pyUtils=require('web.py_utils');var _lt=core._lt;var ListView=BasicView.extend({accesskey:"l",display_name:_lt('List'),icon:'fa-list-ul',config:_.extend({},BasicView.prototype.config,{Model:ListModel,Renderer:ListRenderer,Controller:ListController,}),viewType:'list',init:function(viewInfo,params){var self=this;this._super.apply(this,arguments);var selectedRecords=[];var pyevalContext=py.dict.fromJSON(_.pick(params.context,function(value,key,object){return!_.isUndefined(value)})||{});var expandGroups=!!JSON.parse(pyUtils.py_eval(this.arch.attrs.expand||"0",{'context':pyevalContext}));this.groupbys={};this.arch.children.forEach(function(child){if(child.tag==='groupby'){self._extractGroup(child);}});let editable=false;if((!this.arch.attrs.edit||!!JSON.parse(this.arch.attrs.edit))&&!params.readonly){editable=this.arch.attrs.editable;}
this.controllerParams.activeActions.export_xlsx=this.arch.attrs.export_xlsx?!!JSON.parse(this.arch.attrs.export_xlsx):true;this.controllerParams.editable=editable;this.controllerParams.hasSidebar=params.hasSidebar;this.controllerParams.toolbarActions=viewInfo.toolbar;this.controllerParams.mode='readonly';this.controllerParams.selectedRecords=selectedRecords;this.rendererParams.arch=this.arch;this.rendererParams.groupbys=this.groupbys;this.rendererParams.hasSelectors='hasSelectors'in params?params.hasSelectors:true;this.rendererParams.editable=editable;this.rendererParams.selectedRecords=selectedRecords;this.rendererParams.addCreateLine=false;this.rendererParams.addCreateLineInGroups=editable&&this.controllerParams.activeActions.create;this.rendererParams.isMultiEditable=this.arch.attrs.multi_edit&&!!JSON.parse(this.arch.attrs.multi_edit);this.modelParams.groupbys=this.groupbys;this.loadParams.limit=this.loadParams.limit||80;this.loadParams.openGroupByDefault=expandGroups;this.loadParams.type='list';var groupsLimit=parseInt(this.arch.attrs.groups_limit,10);this.loadParams.groupsLimit=groupsLimit||(expandGroups?10:80);},_extractGroup:function(node){var innerView=this.fields[node.attrs.name].views.groupby;this.groupbys[node.attrs.name]=this._processFieldsView(innerView,'groupby');},_extractParamsFromAction:function(action){var params=this._super.apply(this,arguments);var inDialog=action.target==='new';var inline=action.target==='inline';params.hasSidebar=!inDialog&&!inline;return params;},_updateMVCParams:function(){this._super.apply(this,arguments);this.controllerParams.noLeaf=!!this.loadParams.context.group_by_no_leaf;},});return ListView;});;

/* /web/static/src/js/views/list/list_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.ListController',function(require){"use strict";var core=require('web.core');var config=require('web.config');var BasicController=require('web.BasicController');var DataExport=require('web.DataExport');var Dialog=require('web.Dialog');var ListConfirmDialog=require('web.ListConfirmDialog');var Sidebar=require('web.Sidebar');var _t=core._t;var qweb=core.qweb;var ListController=BasicController.extend({buttons_template:'ListView.buttons',events:_.extend({},BasicController.prototype.events,{'click .o_list_export_xlsx':'_onDirectExportData',}),custom_events:_.extend({},BasicController.prototype.custom_events,{activate_next_widget:'_onActivateNextWidget',add_record:'_onAddRecord',button_clicked:'_onButtonClicked',group_edit_button_clicked:'_onEditGroupClicked',edit_line:'_onEditLine',save_line:'_onSaveLine',selection_changed:'_onSelectionChanged',toggle_column_order:'_onToggleColumnOrder',toggle_group:'_onToggleGroup',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.hasSidebar=params.hasSidebar;this.toolbarActions=params.toolbarActions||{};this.editable=params.editable;this.noLeaf=params.noLeaf;this.selectedRecords=params.selectedRecords||[];this.multipleRecordsSavingPromise=null;this.fieldChangedPrevented=false;this.lastFieldChangedEvent=null;},getActiveDomain:function(){var self=this;const $closedHeaders=this.$('tbody .o_group_header.o_group_has_content:not(.o_group_open)');if(this.$('thead .o_list_record_selector input').prop('checked')&&$closedHeaders.length===0){var searchQuery=this._controlPanel?this._controlPanel.getSearchQuery():{};var record=self.model.get(self.handle,{raw:true});return record.getDomain().concat(searchQuery.domain||[]);}},getOwnedQueryParams:function(){var state=this._super.apply(this,arguments);var orderedBy=this.model.get(this.handle,{raw:true}).orderedBy||[];return _.extend({},state,{orderedBy:orderedBy});},getSelectedIds:function(){return _.map(this.getSelectedRecords(),function(record){return record.res_id;});},getSelectedRecords:function(){var self=this;return _.map(this.selectedRecords,function(db_id){return self.model.get(db_id,{raw:true});});},renderButtons:function($node){if(!this.noLeaf&&this.hasButtons){this.$buttons=$(qweb.render(this.buttons_template,{widget:this}));this.$buttons.on('click','.o_list_button_add',this._onCreateRecord.bind(this));this._assignCreateKeyboardBehavior(this.$buttons.find('.o_list_button_add'));this.$buttons.find('.o_list_button_add').tooltip({delay:{show:200,hide:0},title:function(){return qweb.render('CreateButton.tooltip');},trigger:'manual',});this.$buttons.on('mousedown','.o_list_button_discard',this._onDiscardMousedown.bind(this));this.$buttons.on('click','.o_list_button_discard',this._onDiscard.bind(this));this.$buttons.find('.o_list_export_xlsx').toggle(!config.device.isMobile);this.$buttons.appendTo($node);}},renderSidebar:function($node){var self=this;if(this.hasSidebar){var other=[{label:_t("Export"),callback:this._onExportData.bind(this)}];if(this.archiveEnabled){other.push({label:_t("Archive"),callback:function(){Dialog.confirm(self,_t("Are you sure that you want to archive all the selected records?"),{confirm_callback:self._toggleArchiveState.bind(self,true),});}});other.push({label:_t("Unarchive"),callback:this._toggleArchiveState.bind(this,false)});}
if(this.is_action_enabled('delete')){other.push({label:_t('Delete'),callback:this._onDeleteSelectedRecords.bind(this)});}
this.sidebar=new Sidebar(this,{editable:this.is_action_enabled('edit'),env:{context:this.model.get(this.handle,{raw:true}).getContext(),activeIds:this.getSelectedIds(),model:this.modelName,},actions:_.extend(this.toolbarActions,{other:other}),});return this.sidebar.appendTo($node).then(function(){self._toggleSidebar();});}
return Promise.resolve();},update:function(params,options){var self=this;if(options&&options.keepSelection){var res_ids=this.model.get(this.handle).res_ids;this.selectedRecords=_.filter(this.selectedRecords,function(id){return _.contains(res_ids,self.model.get(id).res_id);});}else{this.selectedRecords=[];}
params.selectedRecords=this.selectedRecords;return this._super.apply(this,arguments);},_abandonRecord:function(recordID){this._super.apply(this,arguments);if((recordID||this.handle)!==this.handle){var state=this.model.get(this.handle);this.renderer.removeLine(state,recordID);this._updatePager();}},_addRecord:function(dataPointId){var self=this;this._disableButtons();return this.renderer.unselectRow().then(function(){return self.model.addDefaultRecord(dataPointId,{position:self.editable,});}).then(function(recordID){var state=self.model.get(self.handle);self.renderer.updateState(state,{keepWidths:true}).then(function(){self.renderer.editRecord(recordID);}).then(self._updatePager.bind(self));}).then(this._enableButtons.bind(this)).guardedCatch(this._enableButtons.bind(this));},_archive:function(ids,archive){if(ids.length===0){return Promise.resolve();}
if(archive){return this.model.actionArchive(ids,this.handle).then(this.update.bind(this,{},{reload:false}));}else{return this.model.actionUnarchive(ids,this.handle).then(this.update.bind(this,{},{reload:false}));}},_assignCreateKeyboardBehavior:function($createButton){var self=this;$createButton.on('keydown',function(e){$createButton.tooltip('hide');switch(e.which){case $.ui.keyCode.ENTER:e.preventDefault();self._onCreateRecord.apply(self);break;case $.ui.keyCode.DOWN:e.preventDefault();self.renderer.giveFocus();break;case $.ui.keyCode.TAB:if(!e.shiftKey&&e.target.classList.contains("btn-primary")){e.preventDefault();$createButton.tooltip('show');}
break;}});},_confirmSave:function(id){var state=this.model.get(this.handle);return this.renderer.updateState(state,{noRender:true}).then(this._setMode.bind(this,'readonly',id));},_discardChanges:function(recordID){if((recordID||this.handle)===this.handle){recordID=this.renderer.getEditableRecordID();if(recordID===null){return Promise.resolve();}}
var self=this;return this._super(recordID).then(function(){self._updateButtons('readonly');});},_getExportDialogWidget(){let state=this.model.get(this.handle);let defaultExportFields=this.renderer.columns.filter(field=>field.tag==='field'&&state.fields[field.attrs.name].exportable!==false).map(field=>field.attrs.name);let groupedBy=this.renderer.state.groupedBy;return new DataExport(this,state,defaultExportFields,groupedBy,this.getActiveDomain(),this.getSelectedIds());},_getSidebarEnv:function(){var env=this._super.apply(this,arguments);var record=this.model.get(this.handle);return _.extend(env,{domain:record.getDomain()});},_isPagerVisible:function(){var state=this.model.get(this.handle,{raw:true});return!!state.count;},_saveMultipleRecords:function(recordId,node,changes){var fieldName=Object.keys(changes)[0];var value=Object.values(changes)[0];var recordIds=_.union([recordId],this.selectedRecords);var validRecordIds=recordIds.reduce((result,nextRecordId)=>{var record=this.model.get(nextRecordId);var modifiers=this.renderer._registerModifiers(node,record);if(!modifiers.readonly&&(!modifiers.required||value)){result.push(nextRecordId);}
return result;},[]);return new Promise((resolve,reject)=>{const discardAndReject=()=>{this.model.discardChanges(recordId);this._confirmSave(recordId).then(()=>{this.renderer.focusCell(recordId,node);reject();});};if(validRecordIds.length>0){const dialogOptions={confirm_callback:()=>{this.model.saveRecords(this.handle,recordId,validRecordIds,fieldName).then(async()=>{this._updateButtons('readonly');const state=this.model.get(this.handle);await this.renderer.updateState(state,{keepWidths:true});await this.renderer.focusCell(recordId,node);resolve(Object.keys(changes));}).guardedCatch(discardAndReject);},cancel_callback:discardAndReject,};const record=this.model.get(recordId);const dialogChanges={fieldLabel:node.attrs.string||record.fields[fieldName].string,fieldName:node.attrs.name,nbRecords:recordIds.length,nbValidRecords:validRecordIds.length,};new ListConfirmDialog(this,record,dialogChanges,dialogOptions).open({shouldFocusButtons:true});}else{Dialog.alert(this,_t("No valid record to save"),{confirm_callback:discardAndReject,});}});},_saveRecord:function(recordId){var record=this.model.get(recordId,{raw:true});if(record.isDirty()&&this.renderer.isInMultipleRecordEdition(recordId)){if(!this.multipleRecordsSavingPromise&&this.lastFieldChangedEvent){this._onFieldChanged(this.lastFieldChangedEvent);this.lastFieldChangedEvent=null;}
const prom=this.multipleRecordsSavingPromise||Promise.reject();this.multipleRecordsSavingPromise=null;return prom;}
return this._super.apply(this,arguments);},_setMode:function(mode,recordID){if((recordID||this.handle)!==this.handle){this.mode=mode;this._updateButtons(mode);return this.renderer.setRowMode(recordID,mode);}else{return this._super.apply(this,arguments);}},_toggleArchiveState:function(archive){this._archive(this.selectedRecords,archive);},_toggleCreateButton:function(){if(this.$buttons){var state=this.model.get(this.handle);var createHidden=this.renderer.isEditable()&&state.groupedBy.length&&state.data.length;this.$buttons.find('.o_list_button_add').toggleClass('o_hidden',!!createHidden);}},_toggleSidebar:function(){if(this.sidebar){this.sidebar.do_toggle(this.selectedRecords.length>0);}},_update:function(){return this._super.apply(this,arguments).then(this._toggleSidebar.bind(this)).then(this._toggleCreateButton.bind(this)).then(this._updateButtons.bind(this,'readonly'));},_updateButtons:function(mode){if(this.$buttons){this.$buttons.toggleClass('o-editing',mode==='edit');const state=this.model.get(this.handle,{raw:true});if(state.count&&!config.device.isMobile){this.$('.o_list_export_xlsx').show();}else{this.$('.o_list_export_xlsx').hide();}}},_onActivateNextWidget:function(ev){ev.stopPropagation();this.renderer.editFirstRecord(ev);},_onAddRecord:function(ev){ev.stopPropagation();var dataPointId=ev.data.groupId||this.handle;if(this.activeActions.create){this._addRecord(dataPointId);}else if(ev.data.onFail){ev.data.onFail();}},_onButtonClicked:function(ev){ev.stopPropagation();this._callButtonAction(ev.data.attrs,ev.data.record);},_onCreateRecord:function(ev){if(ev){ev.stopPropagation();}
var state=this.model.get(this.handle,{raw:true});if(this.editable&&!state.groupedBy.length){this._addRecord(this.handle);}else{this.trigger_up('switch_view',{view_type:'form',res_id:undefined});}},_onDeleteSelectedRecords:function(){this._deleteRecords(this.selectedRecords);},_onDiscard:function(ev){ev.stopPropagation();this._discardChanges().then(()=>{this.lastFieldChangedEvent=null;});},_onDiscardMousedown:function(ev){var self=this;this.fieldChangedPrevented=true;window.addEventListener('mouseup',function(mouseupEvent){var preventedEvent=self.fieldChangedPrevented;self.fieldChangedPrevented=false;if(ev.target!==mouseupEvent.target&&preventedEvent.constructor.name==='OdooEvent'){self._onFieldChanged(preventedEvent);}},{capture:true,once:true});},_onEditLine:function(ev){var self=this;ev.stopPropagation();this.trigger_up('mutexify',{action:function(){self._setMode('edit',ev.data.recordId).then(ev.data.onSuccess);},});},_onExportData:function(){this._getExportDialogWidget().open();},_onDirectExportData(){return this._rpc({model:'ir.exports',method:'search_read',args:[[],['id']],limit:1,}).then(()=>this._getExportDialogWidget().export())},_onEditGroupClicked:function(ev){ev.stopPropagation();this.do_action({context:{create:false},type:'ir.actions.act_window',views:[[false,'form']],res_model:ev.data.record.model,res_id:ev.data.record.res_id,flags:{mode:'edit'},});},_onFieldChanged:function(ev){ev.stopPropagation();const recordId=ev.data.dataPointID;this.lastFieldChangedEvent=ev;if(this.fieldChangedPrevented){this.fieldChangedPrevented=ev;}else if(this.renderer.isInMultipleRecordEdition(recordId)){const saveMulti=()=>{this.multipleRecordsSavingPromise=this._saveMultipleRecords(ev.data.dataPointID,ev.target.__node,ev.data.changes);};ev.data.onSuccess=saveMulti;ev.data.onFailure=saveMulti;ev.data.notifyChange=false;ev.data.force_save=false;}
this._super.apply(this,arguments);},_onSaveLine:function(ev){this.saveRecord(ev.data.recordID).then(ev.data.onSuccess).guardedCatch(ev.data.onFailure);},_onSelectionChanged:function(ev){this.selectedRecords=ev.data.selection;this._toggleSidebar();},_onSetDirty:function(ev){var recordId=ev.data.dataPointID;if(this.renderer.isInMultipleRecordEdition(recordId)){ev.stopPropagation();Dialog.alert(this,_t("No valid record to save"),{confirm_callback:async()=>{this.model.discardChanges(recordId);await this._confirmSave(recordId);this.renderer.focusCell(recordId,ev.target.__node);},});}else{this._super.apply(this,arguments);}},_onToggleColumnOrder:function(ev){ev.stopPropagation();var data=this.model.get(this.handle);if(!data.groupedBy){this.pager.updateState({current_min:1});}
var self=this;this.model.setSort(data.id,ev.data.name).then(function(){self.update({});});},_onToggleGroup:function(ev){ev.stopPropagation();var self=this;this.model.toggleGroup(ev.data.group.id).then(function(){self.update({},{keepSelection:true,reload:false}).then(function(){if(ev.data.onSuccess){ev.data.onSuccess();}});});},});return ListController;});;

/* /web/static/src/js/views/list/list_confirm_dialog.js defined in bundle 'web.assets_backend' */
odoo.define('web.ListConfirmDialog',function(require){"use strict";const core=require('web.core');const Dialog=require('web.Dialog');const _t=core._t;const qweb=core.qweb;const ListConfirmDialog=Dialog.extend({init:function(parent,record,changes,options){options=Object.assign({},options,{$content:$(qweb.render('ListView.confirmModal',{changes})),buttons:options.buttons||[{text:_t("Ok"),classes:'btn-primary',close:true,click:options.confirm_callback,},{text:_t("Cancel"),close:true,click:options.cancel_callback,}],onForceClose:options.cancel_callback,size:options.size||'medium',title:options.title||_t("Confirmation"),});this._super(parent,options);const Widget=record.fieldsInfo.list[changes.fieldName].Widget;this.fieldWidget=new Widget(this,changes.fieldName,record,{mode:'readonly',viewType:'list',noOpen:true,});},willStart:function(){return Promise.all([this.fieldWidget.appendTo(document.createDocumentFragment()),this._super.apply(this,arguments)]);},start:function(){this.$content.find('.o_changes_widget').replaceWith(this.fieldWidget.$el);this.fieldWidget.el.style.pointerEvents='none';return this._super.apply(this,arguments);},});return ListConfirmDialog;});;

/* /web/static/src/js/views/pivot/pivot_model.js defined in bundle 'web.assets_backend' */
odoo.define('web.PivotModel',function(require){"use strict";var AbstractModel=require('web.AbstractModel');var concurrency=require('web.concurrency');var core=require('web.core');var dataComparisonUtils=require('web.dataComparisonUtils');var mathUtils=require('web.mathUtils');var session=require('web.session');var _t=core._t;var cartesian=mathUtils.cartesian;var computeVariation=dataComparisonUtils.computeVariation;var sections=mathUtils.sections;var PivotModel=AbstractModel.extend({init:function(){this._super.apply(this,arguments);this.numbering={};this.data=null;this._loadDataDropPrevious=new concurrency.DropPrevious();},addGroupBy:function(groupBy,type){if(type==='row'){this.data.expandedRowGroupBys.push(groupBy);}else{this.data.expandedColGroupBys.push(groupBy);}},closeGroup:function(groupId,type){var groupBys;var expandedGroupBys;let keyPart;var group;var tree;if(type==='row'){groupBys=this.data.rowGroupBys;expandedGroupBys=this.data.expandedRowGroupBys;tree=this.rowGroupTree;group=this._findGroup(this.rowGroupTree,groupId[0]);keyPart=0;}else{groupBys=this.data.colGroupBys;expandedGroupBys=this.data.expandedColGroupBys;tree=this.colGroupTree;group=this._findGroup(this.colGroupTree,groupId[1]);keyPart=1;}
const groupIdPart=groupId[keyPart];const range=groupIdPart.map((_,index)=>index);function keep(key){const idPart=JSON.parse(key)[keyPart];return range.some(index=>groupIdPart[index]!==idPart[index])||idPart.length===groupIdPart.length;}
function omitKeys(object){const newObject={};for(const key in object){if(keep(key)){newObject[key]=object[key];}}
return newObject;}
this.measurements=omitKeys(this.measurements);this.counts=omitKeys(this.counts);this.groupDomains=omitKeys(this.groupDomains);group.directSubTrees.clear();delete group.sortedKeys;var newGroupBysLength=this._getTreeHeight(tree)-1;if(newGroupBysLength<=groupBys.length){expandedGroupBys.splice(0);groupBys.splice(newGroupBysLength);}else{expandedGroupBys.splice(newGroupBysLength-groupBys.length);}},expandAll:function(){return this._loadData();},expandGroup:function(group,groupBy){var leftDivisors;var rightDivisors;if(group.type==='row'){leftDivisors=[[groupBy]];rightDivisors=sections(this._getGroupBys().colGroupBys);}else{leftDivisors=sections(this._getGroupBys().rowGroupBys);rightDivisors=[[groupBy]];}
var divisors=cartesian(leftDivisors,rightDivisors);delete group.type;return this._subdivideGroup(group,divisors);},exportData:function(){var measureCount=this.data.measures.length;var originCount=this.data.origins.length;var table=this._getTable();var headers=table.headers;var colGroupHeaderRows;var measureRow=[];var originRow=[];function processHeader(header){var inTotalColumn=header.groupId[1].length===0;return{title:header.title,width:header.width,height:header.height,is_bold:!!header.measure&&inTotalColumn};}
if(originCount>1){colGroupHeaderRows=headers.slice(0,headers.length-2);measureRow=headers[headers.length-2].map(processHeader);originRow=headers[headers.length-1].map(processHeader);}else{colGroupHeaderRows=headers.slice(0,headers.length-1);if(measureCount>1){measureRow=headers[headers.length-1].map(processHeader);}}
colGroupHeaderRows[0].splice(0,1);colGroupHeaderRows=colGroupHeaderRows.map(function(headerRow){return headerRow.map(processHeader);});var tableRows=table.rows.map(function(row){return{title:row.title,indent:row.indent,values:row.subGroupMeasurements.map(function(measurement){var value=measurement.value;if(value===undefined){value="";}else if(measurement.originIndexes.length>1){value=value*100;}
return{is_bold:measurement.isBold,value:value,};}),};});return{col_group_headers:colGroupHeaderRows,measure_headers:measureRow,origin_headers:originRow,rows:tableRows,measure_count:measureCount,origin_count:originCount,};},flip:function(){var temp=this.rowGroupTree;this.rowGroupTree=this.colGroupTree;this.colGroupTree=temp;temp=this.data.rowGroupBys;this.data.groupedBy=this.data.colGroupBys;this.data.rowGroupBys=this.data.colGroupBys;this.data.colGroupBys=temp;temp=this.data.expandedColGroupBys;this.data.expandedColGroupBys=this.data.expandedRowGroupBys;this.data.expandedRowGroupBys=temp;function twistKey(key){return JSON.stringify(JSON.parse(key).reverse());}
function twist(object){var newObject={};Object.keys(object).forEach(function(key){var value=object[key];newObject[twistKey(key)]=value;});return newObject;}
this.measurements=twist(this.measurements);this.counts=twist(this.counts);this.groupDomains=twist(this.groupDomains);},get:function(options){options=options||{};var raw=options.raw||false;var groupBys=this._getGroupBys();var state={colGroupBys:groupBys.colGroupBys,context:this.data.context,domain:this.data.domain,fields:this.fields,hasData:this._hasData(),measures:this.data.measures,origins:this.data.origins,rowGroupBys:groupBys.rowGroupBys,};if(!raw&&state.hasData){state.table=this._getTable();}
return state;},getTableWidth:function(){var leafCounts=this._getLeafCounts(this.colGroupTree);return leafCounts[JSON.stringify(this.colGroupTree.root.values)]+2;},load:function(params){this.initialDomain=params.domain;this.initialRowGroupBys=params.context.pivot_row_groupby||params.rowGroupBys;this.defaultGroupedBy=params.groupedBy;this.fields=params.fields;this.modelName=params.modelName;this.data={expandedRowGroupBys:[],expandedColGroupBys:[],domain:this.initialDomain,timeRange:params.timeRange||[],timeRangeDescription:params.timeRangeDescription||"",comparisonTimeRange:params.comparisonTimeRange||[],comparisonTimeRangeDescription:params.comparisonTimeRangeDescription||"",compare:params.compare||false,context:_.extend({},session.user_context,params.context),groupedBy:params.context.pivot_row_groupby||params.groupedBy,colGroupBys:params.context.pivot_column_groupby||params.colGroupBys,measures:this._processMeasures(params.context.pivot_measures)||params.measures,};this.data.domains=this._getDomains();this.data.origins=this._getOrigins();this.data.rowGroupBys=!_.isEmpty(this.data.groupedBy)?this.data.groupedBy:this.initialRowGroupBys;var defaultOrder=params.default_order&&params.default_order.split(' ');if(defaultOrder){this.data.sortedColumn={groupId:[[],[]],measure:defaultOrder[0],order:defaultOrder[1]?defaultOrder[1]:'asc',};}
return this._loadData();},reload:function(handle,params){var self=this;var oldColGroupBys=this.data.colGroupBys;var oldRowGroupBys=this.data.rowGroupBys;if('context'in params){this.data.context=params.context;this.data.colGroupBys=params.context.pivot_column_groupby||this.data.colGroupBys;this.data.groupedBy=params.context.pivot_row_groupby||this.data.groupedBy;this.data.measures=this._processMeasures(params.context.pivot_measures)||this.data.measures;this.defaultGroupedBy=this.data.groupedBy.length?this.data.groupedBy:this.defaultGroupedBy;var timeRangeMenuData=params.context.timeRangeMenuData;if(timeRangeMenuData){this.data.timeRange=timeRangeMenuData.timeRange||[];this.data.timeRangeDescription=timeRangeMenuData.timeRangeDescription||"";this.data.comparisonTimeRange=timeRangeMenuData.comparisonTimeRange||[];this.data.comparisonTimeRangeDescription=timeRangeMenuData.comparisonTimeRangeDescription||"";this.data.compare=this.data.comparisonTimeRange.length>0;}else{this.data.timeRange=[];this.data.timeRangeDescription="";this.data.comparisonTimeRange=[];this.data.comparisonTimeRangeDescription="";this.data.compare=false;this.data.context=_.omit(this.data.context,'timeRangeMenuData');}}
if('domain'in params){this.data.domain=params.domain;this.initialDomain=params.domain;}else{this.data.domain=this.initialDomain;}
if('groupBy'in params){this.data.groupedBy=params.groupBy.length?params.groupBy:this.defaultGroupedBy;}
this.data.domains=this._getDomains();this.data.origins=this._getOrigins();this.data.rowGroupBys=!_.isEmpty(this.data.groupedBy)?this.data.groupedBy:this.initialRowGroupBys;if(!_.isEqual(oldRowGroupBys,self.data.rowGroupBys)){this.data.expandedRowGroupBys=[];}
if(!_.isEqual(oldColGroupBys,self.data.colGroupBys)){this.data.expandedColGroupBys=[];}
if(!this._hasData()){return this._loadData();}
var oldRowGroupTree=this.rowGroupTree;var oldColGroupTree=this.colGroupTree;return this._loadData().then(function(){if(_.isEqual(oldRowGroupBys,self.data.rowGroupBys)){self._pruneTree(self.rowGroupTree,oldRowGroupTree);}
if(_.isEqual(oldColGroupBys,self.data.colGroupBys)){self._pruneTree(self.colGroupTree,oldColGroupTree);}});},sortRows:function(sortedColumn){var self=this;var colGroupValues=sortedColumn.groupId[1];sortedColumn.originIndexes=sortedColumn.originIndexes||[0];this.data.sortedColumn=sortedColumn;var sortFunction=function(tree){return function(subTreeKey){var subTree=tree.directSubTrees.get(subTreeKey);var groupIntersectionId=[subTree.root.values,colGroupValues];var value=self._getCellValue(groupIntersectionId,sortedColumn.measure,sortedColumn.originIndexes)||0;return sortedColumn.order==='asc'?value:-value;};};this._sortTree(sortFunction,this.rowGroupTree);},toggleMeasure:function(fieldName){var index=this.data.measures.indexOf(fieldName);if(index!==-1){this.data.measures.splice(index,1);return Promise.resolve();}else{this.data.measures.push(fieldName);}
return this._loadData();},_addGroup:function(groupTree,labels,values){var tree=groupTree;values.slice(0,values.length-1).forEach(function(value){tree=tree.directSubTrees.get(value);});const value=values[values.length-1];if(tree.directSubTrees.has(value)){return;}
tree.directSubTrees.set(value,{root:{labels:labels,values:values,},directSubTrees:new Map(),});},_computeRowGroupBys:function(){return!_.isEmpty(this.data.groupedBy)?this.data.groupedBy:this.initialRowGroupBys;},_findGroup:function(groupTree,values){var tree=groupTree;values.slice(0,values.length).forEach(function(value){tree=tree.directSubTrees.get(value);});return tree;},_getCellValue:function(groupId,measure,originIndexes){var self=this;var key=JSON.stringify(groupId);if(!self.measurements[key]){return;}
var values=originIndexes.map(function(originIndex){return self.measurements[key][originIndex][measure];});if(originIndexes.length>1){return computeVariation(values[0],values[1]);}else{return values[0];}},_getDomains:function(){var domains=[this.data.domain.concat(this.data.timeRange)];if(this.data.compare){domains.push(this.data.domain.concat(this.data.comparisonTimeRange));}
return domains;},_getGroupBys:function(){return{colGroupBys:this.data.colGroupBys.concat(this.data.expandedColGroupBys),rowGroupBys:this.data.rowGroupBys.concat(this.data.expandedRowGroupBys),};},_getGroupDomain:function(group){var key=JSON.stringify([group.rowValues,group.colValues]);return this.groupDomains[key][group.originIndex];},_getGroupLabels:function(group,groupBys){var self=this;return groupBys.map(function(groupBy){return self._sanitizeLabel(group[groupBy],groupBy);});},_getGroupSubdivision:function(group,rowGroupBy,colGroupBy){var groupDomain=this._getGroupDomain(group);var measureSpecs=this._getMeasureSpecs();var groupBy=rowGroupBy.concat(colGroupBy);return this._rpc({model:this.modelName,method:'read_group',context:this.data.context,domain:groupDomain,fields:measureSpecs,groupBy:groupBy,lazy:false,}).then(function(subGroups){return{group:group,subGroups:subGroups,rowGroupBy:rowGroupBy,colGroupBy:colGroupBy};});},_getGroupValues:function(group,groupBys){var self=this;return groupBys.map(function(groupBy){return self._sanitizeValue(group[groupBy]);});},_getLeafCounts:function(tree){var self=this;var leafCounts={};var leafCount;if(!tree.directSubTrees.size){leafCount=1;}else{leafCount=[...tree.directSubTrees.values()].reduce(function(acc,subTree){var subLeafCounts=self._getLeafCounts(subTree);_.extend(leafCounts,subLeafCounts);return acc+leafCounts[JSON.stringify(subTree.root.values)];},0);}
leafCounts[JSON.stringify(tree.root.values)]=leafCount;return leafCounts;},_getMeasurements:function(group){var self=this;return this.data.measures.reduce(function(measurements,fieldName){var measurement=group[fieldName];if(measurement instanceof Array){measurement=1;}
if(self.fields[fieldName].type==='boolean'&&measurement instanceof Boolean){measurement=measurement?1:0;}
if(self.data.origins.length>1&&!measurement){measurement=0;}
measurements[fieldName]=measurement;return measurements;},{});},_getMeasuresRow:function(columns){var self=this;var sortedColumn=this.data.sortedColumn||{};var measureRow=[];columns.forEach(function(column){self.data.measures.forEach(function(measure){var measureCell={groupId:column.groupId,height:1,measure:measure,title:self.fields[measure].string,width:2*self.data.origins.length-1,};if(sortedColumn.measure===measure&&_.isEqual(sortedColumn.groupId,column.groupId)){measureCell.order=sortedColumn.order;}
measureRow.push(measureCell);});});return measureRow;},_getMeasureSpecs:function(){var self=this;return this.data.measures.reduce(function(acc,measure){if(measure==='__count'){acc.push(measure);return acc;}
var type=self.fields[measure].type;var groupOperator=self.fields[measure].group_operator;if(type==='many2one'){groupOperator='count_distinct';}
if(groupOperator===undefined){throw new Error("No aggregate function has been provided for the measure '"+measure+"'");}
acc.push(measure+':'+groupOperator);return acc;},[]);},_getNumberedLabel:function(label,fieldName){var id=label[0];var name=label[1];this.numbering[fieldName]=this.numbering[fieldName]||{};this.numbering[fieldName][name]=this.numbering[fieldName][name]||{};var numbers=this.numbering[fieldName][name];numbers[id]=numbers[id]||_.size(numbers)+1;return name+(numbers[id]>1?"  ("+numbers[id]+")":"");},_getOriginsRow:function(columns){var self=this;var sortedColumn=this.data.sortedColumn||{};var originRow=[];columns.forEach(function(column){var groupId=column.groupId;var measure=column.measure;var isSorted=sortedColumn.measure===measure&&_.isEqual(sortedColumn.groupId,groupId);var isSortedByOrigin=isSorted&&!sortedColumn.originIndexes[1];var isSortedByVariation=isSorted&&sortedColumn.originIndexes[1];self.data.origins.forEach(function(origin,originIndex){var originCell={groupId:groupId,height:1,measure:measure,originIndexes:[originIndex],title:origin,width:1,};if(isSortedByOrigin&&sortedColumn.originIndexes[0]===originIndex){originCell.order=sortedColumn.order;}
originRow.push(originCell);if(originIndex>0){var variationCell={groupId:groupId,height:1,measure:measure,originIndexes:[originIndex-1,originIndex],title:_t('Variation'),width:1,};if(isSortedByVariation&&sortedColumn.originIndexes[1]===originIndex){variationCell.order=sortedColumn.order;}
originRow.push(variationCell);}});});return originRow;},_getOrigins:function(){var origins=[this.data.timeRangeDescription||""];if(this.data.compare){origins.push(this.data.comparisonTimeRangeDescription);}
return origins;},_getTable:function(){var headers=this._getTableHeaders();return{headers:headers,rows:this._getTableRows(this.rowGroupTree,headers[headers.length-1]),};},_getTableHeaders:function(){var colGroupBys=this._getGroupBys().colGroupBys;var height=colGroupBys.length+1;var measureCount=this.data.measures.length;var originCount=this.data.origins.length;var leafCounts=this._getLeafCounts(this.colGroupTree);var headers=[];var measureColumns=[];var colGroupRows=(new Array(height)).fill(0).map(function(){return[];});colGroupRows[0].push({height:height+1+(originCount>1?1:0),title:"",width:1,});function generateTreeHeaders(tree){var group=tree.root;var rowIndex=group.values.length;var row=colGroupRows[rowIndex];var groupId=[[],group.values];var isLeaf=!tree.directSubTrees.size;var leafCount=leafCounts[JSON.stringify(tree.root.values)];var cell={groupId:groupId,height:isLeaf?(colGroupBys.length+1-rowIndex):1,isLeaf:isLeaf,title:group.labels[group.labels.length-1]||_t('Total'),width:leafCount*measureCount*(2*originCount-1),};row.push(cell);if(isLeaf){measureColumns.push(cell);}
[...tree.directSubTrees.values()].forEach(function(subTree){generateTreeHeaders(subTree);});}
generateTreeHeaders(this.colGroupTree);if(leafCounts[JSON.stringify(this.colGroupTree.root.values)]>1){var groupId=[[],[]];var totalTopRightCell={groupId:groupId,height:height,title:"",width:measureCount*(2*originCount-1),};colGroupRows[0].push(totalTopRightCell);measureColumns.push(totalTopRightCell);}
headers=headers.concat(colGroupRows);var measuresRow=this._getMeasuresRow(measureColumns);headers.push(measuresRow);if(originCount>1){headers.push(this._getOriginsRow(measuresRow));}
return headers;},_getTableRows:function(tree,columns){var self=this;var rows=[];var group=tree.root;var rowGroupId=[group.values,[]];var title=group.labels[group.labels.length-1]||_t('Total');var indent=group.labels.length;var isLeaf=!tree.directSubTrees.size;var subGroupMeasurements=columns.map(function(column){var colGroupId=column.groupId;var groupIntersectionId=[rowGroupId[0],colGroupId[1]];var measure=column.measure;var originIndexes=column.originIndexes||[0];var value=self._getCellValue(groupIntersectionId,measure,originIndexes);var measurement={groupId:groupIntersectionId,originIndexes:originIndexes,measure:measure,value:value,isBold:!groupIntersectionId[0].length||!groupIntersectionId[1].length,};return measurement;});rows.push({title:title,groupId:rowGroupId,indent:indent,isLeaf:isLeaf,subGroupMeasurements:subGroupMeasurements});var subTreeKeys=tree.sortedKeys||[...tree.directSubTrees.keys()];subTreeKeys.forEach(function(subTreeKey){var subTree=tree.directSubTrees.get(subTreeKey);rows=rows.concat(self._getTableRows(subTree,columns));});return rows;},_getTreeHeight:function(tree){var subTreeHeights=[...tree.directSubTrees.values()].map(this._getTreeHeight.bind(this));return Math.max(0,Math.max.apply(null,subTreeHeights))+1;},_hasData:function(){return(this.counts[JSON.stringify([[],[]])]||[]).some(function(count){return count>0;});},_loadData:function(){var self=this;this.rowGroupTree={root:{labels:[],values:[]},directSubTrees:new Map(),};this.colGroupTree={root:{labels:[],values:[]},directSubTrees:new Map(),};this.measurements={};this.counts={};var key=JSON.stringify([[],[]]);this.groupDomains={};this.groupDomains[key]=this.data.domains.slice(0);var group={rowValues:[],colValues:[]};var groupBys=this._getGroupBys();var leftDivisors=sections(groupBys.rowGroupBys);var rightDivisors=sections(groupBys.colGroupBys);var divisors=cartesian(leftDivisors,rightDivisors);return this._subdivideGroup(group,divisors.slice(0,1)).then(function(){return self._subdivideGroup(group,divisors.slice(1));});},_prepareData:function(group,groupSubdivisions){var self=this;var groupRowValues=group.rowValues;var groupRowLabels=[];var rowSubTree=this.rowGroupTree;var root;if(groupRowValues.length){rowSubTree=this._findGroup(this.rowGroupTree,groupRowValues);root=rowSubTree.root;groupRowLabels=root.labels;}
var groupColValues=group.colValues;var groupColLabels=[];if(groupColValues.length){root=this._findGroup(this.colGroupTree,groupColValues).root;groupColLabels=root.labels;}
groupSubdivisions.forEach(function(groupSubdivision){groupSubdivision.subGroups.forEach(function(subGroup){var rowValues=groupRowValues.concat(self._getGroupValues(subGroup,groupSubdivision.rowGroupBy));var rowLabels=groupRowLabels.concat(self._getGroupLabels(subGroup,groupSubdivision.rowGroupBy));var colValues=groupColValues.concat(self._getGroupValues(subGroup,groupSubdivision.colGroupBy));var colLabels=groupColLabels.concat(self._getGroupLabels(subGroup,groupSubdivision.colGroupBy));if(!colValues.length&&rowValues.length){self._addGroup(self.rowGroupTree,rowLabels,rowValues);}
if(colValues.length&&!rowValues.length){self._addGroup(self.colGroupTree,colLabels,colValues);}
var key=JSON.stringify([rowValues,colValues]);var originIndex=groupSubdivision.group.originIndex;if(!(key in self.measurements)){self.measurements[key]=self.data.origins.map(function(){return self._getMeasurements({});});}
self.measurements[key][originIndex]=self._getMeasurements(subGroup);if(!(key in self.counts)){self.counts[key]=self.data.origins.map(function(){return 0;});}
self.counts[key][originIndex]=subGroup.__count;if(!(key in self.groupDomains)){self.groupDomains[key]=self.data.origins.map(function(){return[[0,'=',1]];});}
if(subGroup.__domain){self.groupDomains[key][originIndex]=subGroup.__domain;}});});if(this.data.sortedColumn){this.sortRows(this.data.sortedColumn,rowSubTree);}},_processMeasures:function(measures){if(measures){return _.map(measures,function(measure){return measure==='__count__'?'__count':measure;});}},_pruneTree:function(tree,oldTree){if(!oldTree.directSubTrees.size){tree.directSubTrees.clear();delete tree.sortedKeys;return;}
var self=this;[...tree.directSubTrees.keys()].forEach(function(subTreeKey){var subTree=tree.directSubTrees.get(subTreeKey);if(!oldTree.directSubTrees.has(subTreeKey)){subTree.directSubTrees.clear();delete subTreeKey.sortedKeys;}else{var oldSubTree=oldTree.directSubTrees.get(subTreeKey);self._pruneTree(subTree,oldSubTree);}});},_sanitizeLabel:function(value,groupBy){var fieldName=groupBy.split(':')[0];if(value===false){return _t("Undefined");}
if(value instanceof Array){return this._getNumberedLabel(value,fieldName);}
if(fieldName&&this.fields[fieldName]&&(this.fields[fieldName].type==='selection')){var selected=_.where(this.fields[fieldName].selection,{0:value})[0];return selected?selected[1]:value;}
return value;},_sanitizeValue:function(value){if(value instanceof Array){return value[0];}
return value;},_subdivideGroup:function(group,divisors){var self=this;var key=JSON.stringify([group.rowValues,group.colValues]);var proms=this.data.origins.reduce(function(acc,origin,originIndex){if(!self.counts[key]||self.counts[key][originIndex]>0){var subGroup={rowValues:group.rowValues,colValues:group.colValues,originIndex:originIndex};divisors.forEach(function(divisor){acc.push(self._getGroupSubdivision(subGroup,divisor[0],divisor[1]));});}
return acc;},[]);return this._loadDataDropPrevious.add(Promise.all(proms)).then(function(groupSubdivisions){if(groupSubdivisions.length){self._prepareData(group,groupSubdivisions);}});},_sortTree:function(sortFunction,tree){var self=this;tree.sortedKeys=_.sortBy([...tree.directSubTrees.keys()],sortFunction(tree));[...tree.directSubTrees.values()].forEach(function(subTree){self._sortTree(sortFunction,subTree);});},});return PivotModel;});;

/* /web/static/src/js/views/pivot/pivot_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.PivotController',function(require){"use strict";var AbstractController=require('web.AbstractController');var core=require('web.core');var framework=require('web.framework');var session=require('web.session');var _t=core._t;var QWeb=core.qweb;var PivotController=AbstractController.extend({contentTemplate:'PivotView',events:{'click .o_pivot_field_menu a':'_onGroupByMenuSelection','click .o_pivot_header_cell_closed':'_onClosedHeaderClick',},custom_events:_.extend({},AbstractController.prototype.custom_events,{close_group:'_onCloseGroup',open_view:'_onOpenView',sort_rows:'_onSortRows',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.measures=params.measures;this.groupableFields=params.groupableFields;this.title=params.title;this.views=params.views;this.groupSelected=null;},start:function(){this.$groupBySelection=this.$('.o_field_selection');core.bus.on('click',this,function(){this.$groupBySelection.empty();});return this._super();},destroy:function(){if(this.$buttons){this.$buttons.find('button').off();}
return this._super.apply(this,arguments);},getOwnedQueryParams:function(){var state=this.model.get({raw:true});return{context:{pivot_measures:state.measures,pivot_column_groupby:state.colGroupBys,pivot_row_groupby:state.rowGroupBys,}};},renderButtons:function($node){if($node){var context={measures:_.sortBy(_.pairs(_.omit(this.measures,'__count')),function(x){return x[1].string.toLowerCase();}),};this.$buttons=$(QWeb.render('PivotView.buttons',context));this.$buttons.click(this._onButtonClick.bind(this));this.$buttons.find('button').tooltip();this.$buttons.appendTo($node);this._updateButtons();}},_downloadTable:function(){var self=this;if(self.model.getTableWidth()>256){this.call('crash_manager','show_message',_t("For Excel compatibility, data cannot be exported if there are more than 256 columns.\n\nTip: try to flip axis, filter further or reduce the number of measures."));framework.unblockUI();return;}
var table=self.model.exportData();table.title=self.title;session.get_file({url:'/web/pivot/export_xls',data:{data:JSON.stringify(table)},complete:framework.unblockUI,error:(error)=>this.call('crash_manager','rpc_error',error),});},_renderGroupBySelection:function(top,shift){var state=this.model.get({raw:true});var groupedFields=state.rowGroupBys.concat(state.colGroupBys).map(function(f){return f.split(':')[0];});var fields=_.chain(this.groupableFields).pairs().sortBy(function(f){return f[1].string;}).map(function(f){return[f[0],f[1],_.contains(groupedFields,f[0])];}).value();this.$groupBySelection.html(QWeb.render('PivotView.GroupBySelection',{fields:fields}));var cssProps={top:top};shift=Math.abs(shift);var isRTL=_t.database.parameters.direction==='rtl';cssProps[isRTL?'right':'left']=shift;this.$groupBySelection.find('.dropdown-menu').first().css(cssProps).addClass('show');},_startRenderer:function(){return this.renderer.appendTo(this.$('.o_pivot'));},_update:function(){this._updateButtons();return this._super.apply(this,arguments);},_updateButtons:function(){if(!this.$buttons){return;}
var self=this;var state=this.model.get({raw:true});_.each(this.measures,function(measure,name){var isSelected=_.contains(state.measures,name);self.$buttons.find('.dropdown-item[data-field="'+name+'"]').toggleClass('selected',isSelected);});var noDataDisplayed=!state.hasData||!state.measures.length;this.$buttons.find('.o_pivot_flip_button').prop('disabled',noDataDisplayed);this.$buttons.find('.o_pivot_expand_button').prop('disabled',noDataDisplayed);this.$buttons.find('.o_pivot_download').prop('disabled',noDataDisplayed);},_onButtonClick:function(ev){var $target=$(ev.target);if($target.hasClass('o_pivot_flip_button')){this.model.flip();this.update({},{reload:false});}
if($target.hasClass('o_pivot_expand_button')){this.model.expandAll().then(this.update.bind(this,{},{reload:false}));}
if(ev.target.closest('.o_pivot_measures_list')){ev.preventDefault();ev.stopPropagation();const field=ev.target.dataset.field;if(field){this.model.toggleMeasure(field).then(this.update.bind(this,{},{reload:false}));}}
if($target.hasClass('o_pivot_download')){this._downloadTable();}},_onCloseGroup:function(ev){this.model.closeGroup(ev.data.groupId,ev.data.type);this.update({},{reload:false});},_onClosedHeaderClick:function(ev){ev.preventDefault();ev.stopPropagation();var $target=$(ev.target);var groupId=$target.data('groupId');var type=$target.data('type');var group={rowValues:groupId[0],colValues:groupId[1],type:type};var state=this.model.get({raw:true});var groupValues=type==='row'?groupId[0]:groupId[1];var groupBys=type==='row'?state.rowGroupBys:state.colGroupBys;this.selectedGroup=group;if(groupValues.length<groupBys.length){var groupBy=groupBys[groupValues.length];this.model.expandGroup(this.selectedGroup,groupBy).then(this.update.bind(this,{},{reload:false}));}else{var position=$target.position();var top=position.top+$target.height();var $container=$target.closest('.o_pivot').find('.o_field_selection');var shift=ev.clientX-$container.position().left;this._renderGroupBySelection(top,shift);}},_onGroupByMenuSelection:function(ev){ev.preventDefault();var $target=$(ev.target);if($target.hasClass('disabled')){ev.stopPropagation();return;}
var groupBy=$target.data('field');var interval=$target.data('interval');if(interval){groupBy=groupBy+':'+interval;}
this.model.addGroupBy(groupBy,this.selectedGroup.type);this.model.expandGroup(this.selectedGroup,groupBy).then(this.update.bind(this,{},{reload:false}));},_onOpenView:function(ev){ev.stopPropagation();var context=ev.data.context;var group=ev.data.group;var domain=this.model._getGroupDomain(group);this.do_action({type:'ir.actions.act_window',name:this.title,res_model:this.modelName,views:this.views,view_mode:'list',target:'current',context:context,domain:domain,});},_onSortRows:function(ev){this.model.sortRows(ev.data.sortedColumn);this.update({},{reload:false});},});return PivotController;});;

/* /web/static/src/js/views/pivot/pivot_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.PivotRenderer',function(require){"use strict";var AbstractRenderer=require('web.AbstractRenderer');var config=require('web.config');var core=require('web.core');var dataComparisonUtils=require('web.dataComparisonUtils');var field_utils=require('web.field_utils');var QWeb=core.qweb;var _t=core._t;var PivotRenderer=AbstractRenderer.extend({tagName:'table',className:'table-hover table-sm table-bordered',events:_.extend({},AbstractRenderer.prototype.events,{'click td.o_pivot_cell_value':'_onCellValueClicked','click .o_pivot_header_cell_opened':'_onOpenHeaderClick','click .o_pivot_measure_row':'_onSpecialRowClick','click .o_pivot_origin_row':'_onSpecialRowClick','mouseenter thead tr:last th':'_onMouseenterCell','mouseenter tbody td':'_onMouseenterCell','mouseleave thead tr:last th':'_onMouseleaveCell','mouseleave tbody td':'_onMouseleaveCell',}),init:function(parent,state,params){this._super.apply(this,arguments);this.enableLinking=params.enableLinking;this.fieldWidgets=params.widgets||{};this.paddingLeftHeaderTabWidth=config.device.isMobile?5:30;},_getGroupByLabels:function(groupBy){var self=this;return _.map(groupBy,function(gb){return self.state.fields[gb.split(':')[0]].string;});},_render:function(){var hasContent=this.state.hasData&&this.state.measures.length;if(!hasContent){this._replaceElement(QWeb.render('View.NoContentHelper',{description:_t("Try to add some records, or make sure that there is at least "+"one measure and no active filter in the search bar."),}));return this._super.apply(this,arguments);}
this.renderElement();this.$el.toggleClass('o_enable_linking',this.enableLinking);var $thead=$('<thead>');var $tbody=$('<tbody>');this._renderHeaders($thead);this._renderRows($tbody);this.$el.empty().append($thead).append($tbody);this.$('.o_pivot_header_cell_opened, .o_pivot_header_cell_closed').tooltip();return this._super.apply(this,arguments);},_renderHeaders:function($thead){var groupbyLabels=this._getGroupByLabels(this.state.colGroupBys);this.state.table.headers.forEach(function(row,rowIndex){var $tr=$('<tr>');row.forEach(function(cell){var cellParams={text:cell.title,colspan:cell.width,rowspan:cell.height,data:{groupId:cell.groupId,type:'col',}}
var className;if(cell.measure){if(cell.originIndexes){cellParams.data.originIndexes=cell.originIndexes
className='o_pivot_origin_row';}else{className='o_pivot_measure_row';}
className+=' text-muted';if(cell.order){className+=' o_pivot_sort_order_'+cell.order;if(cell.order==='asc'){cellParams['aria-sorted']='ascending'}else{cellParams['aria-sorted']='descending'}}
cellParams.data.measure=cell.measure;}else if('isLeaf'in cell){if(rowIndex>0){cellParams.title=groupbyLabels[rowIndex-1];}
className='o_pivot_header_cell'+(cell.isLeaf?'_closed':'_opened');}
cellParams.class=className;$tr.append($('<th>',cellParams));});$thead.append($tr);});},_renderRows:function($tbody){var self=this;var measureTypes=this.state.measures.reduce(function(acc,measureName){var type=self.state.fields[measureName].type;acc[measureName]=type==='many2one'?'integer':type;return acc;},{});var groupbyLabels=this._getGroupByLabels(this.state.rowGroupBys);this.state.table.rows.forEach(function(row){var $tr=$('<tr>');var paddingLeft=5+row.indent*self.paddingLeftHeaderTabWidth;$tr.append($('<th>',{text:row.title,title:row.indent>0?groupbyLabels[row.indent-1]:null,data:{groupId:row.groupId,type:'row',},css:{'padding-left':paddingLeft+'px',},class:'o_pivot_header_cell_'+(row.isLeaf?'closed':'opened'),}));row.subGroupMeasurements.forEach(function(measurement){var cellParams={data:{groupId:measurement.groupId,originIndexes:measurement.originIndexes,},class:'o_pivot_cell_value text-right',};if(measurement.isBold){cellParams.css={'font-weight':'bold',};}
if(measurement.value!==undefined){var measure=measurement.measure;var measureField=self.state.fields[measure];var $value;if(measurement.originIndexes.length>1){$value=dataComparisonUtils.renderVariation(measurement.value,measureField);}else{var formatType=self.fieldWidgets[measure]||measureTypes[measure];var formatter=field_utils.format[formatType];$value=$('<div>',{class:'o_value',html:formatter(measurement.value,measureField),});}
cellParams.html=$value;}else{cellParams.class+=' o_empty'}
$tr.append($('<td>',cellParams));});$tbody.append($tr);});},_onCellValueClicked:function(ev){ev.preventDefault();ev.stopPropagation();var $target=$(ev.currentTarget);if($target.hasClass('o_empty')||!this.enableLinking){return;}
var context=_.omit(this.state.context,function(val,key){return key==='group_by'||_.str.startsWith(key,'search_default_');});var groupId=$target.data('groupId');var originIndexes=$target.data('originIndexes');var group={rowValues:groupId[0],colValues:groupId[1],originIndex:originIndexes[0]};this.trigger_up('open_view',{group:group,context:context,});},_onMouseenterCell:function(ev){var index=$(ev.currentTarget).index();if($(ev.currentTarget).is('th')){index+=1;}
var tds=this.el.querySelectorAll("td:nth-child("+(index+1)+")");for(var td of tds){td.classList.add("o_cell_hover");}},_onMouseleaveCell:function(){this.$('.o_cell_hover').removeClass('o_cell_hover');},_onOpenHeaderClick:function(ev){ev.preventDefault();ev.stopImmediatePropagation();var $target=$(ev.target);var groupId=$target.data('groupId');var type=$target.data('type');this.trigger_up('close_group',{groupId:groupId,type:type,});},_onSpecialRowClick:function(ev){ev.preventDefault();ev.stopImmediatePropagation();var $target=$(ev.target);var groupId=$target.data('groupId');var measure=$target.data('measure');var originIndexes=$target.data('originIndexes');var isAscending=$target.hasClass('o_pivot_sort_order_asc');var order=isAscending?'desc':'asc';this.trigger_up('sort_rows',{sortedColumn:{groupId:groupId,measure:measure,order:order,originIndexes:originIndexes,}});},});return PivotRenderer;});;

/* /web/static/src/js/views/pivot/pivot_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.PivotView',function(require){"use strict";var AbstractView=require('web.AbstractView');var config=require('web.config');var core=require('web.core');var PivotModel=require('web.PivotModel');var PivotController=require('web.PivotController');var PivotRenderer=require('web.PivotRenderer');var _t=core._t;var _lt=core._lt;var controlPanelViewParameters=require('web.controlPanelViewParameters');var GROUPABLE_TYPES=controlPanelViewParameters.GROUPABLE_TYPES;var PivotView=AbstractView.extend({display_name:_lt('Pivot'),icon:'fa-table',config:_.extend({},AbstractView.prototype.config,{Model:PivotModel,Controller:PivotController,Renderer:PivotRenderer,}),viewType:'pivot',searchMenuTypes:['filter','groupBy','timeRange','favorite'],init:function(viewInfo,params){var self=this;this._super.apply(this,arguments);var activeMeasures=[];var colGroupBys=[];var rowGroupBys=[];var measures={};var groupableFields={};var widgets={};this.fields.__count={string:_t("Count"),type:"integer"};_.each(this.fields,function(field,name){if((name!=='id')&&(field.store===true)){if(_.contains(['integer','float','monetary'],field.type)||_.contains(params.additionalMeasures,name)){measures[name]=field;}
if(_.contains(GROUPABLE_TYPES,field.type)){groupableFields[name]=field;}}});measures.__count={string:_t("Count"),type:"integer"};this.arch.children.forEach(function(field){var name=field.attrs.name;if(field.attrs.interval){name+=':'+field.attrs.interval;}
if(field.attrs.widget){widgets[name]=field.attrs.widget;}
if(field.attrs.invisible&&py.eval(field.attrs.invisible)){delete measures[name];return;}
if(field.attrs.type==='measure'&&!(name in measures)){measures[name]=self.fields[name];}
if(field.attrs.string&&name in measures){measures[name].string=field.attrs.string;}
if(field.attrs.type==='measure'||'operator'in field.attrs){activeMeasures.push(name);measures[name]=self.fields[name];}
if(field.attrs.type==='col'){colGroupBys.push(name);}
if(field.attrs.type==='row'){rowGroupBys.push(name);}});if((!activeMeasures.length)||this.arch.attrs.display_quantity){activeMeasures=['__count'].concat(activeMeasures);}
this.loadParams.measures=activeMeasures;this.loadParams.colGroupBys=colGroupBys;this.loadParams.rowGroupBys=rowGroupBys;this.loadParams.fields=this.fields;this.loadParams.default_order=params.default_order||this.arch.attrs.default_order;if(config.device.isMobile){this.loadParams.colGroupBys=[];}
this.rendererParams.widgets=widgets;this.rendererParams.enableLinking=!this.arch.attrs.disable_linking;this.controllerParams.title=params.title||this.arch.attrs.string||_t("Untitled");this.controllerParams.measures=measures;this.controllerParams.groupableFields=groupableFields;this.controllerParams.views=[_findView(params.actionViews,'list'),_findView(params.actionViews,'form'),];function _findView(views,viewType){var view=_.find(views,function(view){return view.type===viewType;});return[view?view.viewID:false,viewType];}},});return PivotView;});;

/* /web/static/src/js/views/calendar/calendar_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.CalendarController',function(require){"use strict";var AbstractController=require('web.AbstractController');var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var dialogs=require('web.view_dialogs');var QuickCreate=require('web.CalendarQuickCreate');var _t=core._t;var QWeb=core.qweb;function dateToServer(date){return date.clone().utc().locale('en').format('YYYY-MM-DD HH:mm:ss');}
var CalendarController=AbstractController.extend({custom_events:_.extend({},AbstractController.prototype.custom_events,{changeDate:'_onChangeDate',changeFilter:'_onChangeFilter',deleteRecord:'_onDeleteRecord',dropRecord:'_onDropRecord',next:'_onNext',openCreate:'_onOpenCreate',openEvent:'_onOpenEvent',prev:'_onPrev',quickCreate:'_onQuickCreate',updateRecord:'_onUpdateRecord',viewUpdated:'_onViewUpdated',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.current_start=null;this.displayName=params.displayName;this.quickAddPop=params.quickAddPop;this.disableQuickCreate=params.disableQuickCreate;this.eventOpenPopup=params.eventOpenPopup;this.formViewId=params.formViewId;this.readonlyFormViewId=params.readonlyFormViewId;this.mapping=params.mapping;this.context=params.context;this.previousOpen=null;this.quickCreating=false;},destroy:function(){this._super.apply(this,arguments);if(this.$todayButton){this.$todayButton.off();}},getTitle:function(){return this._title;},renderButtons:function($node){var self=this;this.$buttons=$(QWeb.render('CalendarView.buttons',{isMobile:config.device.isMobile,}));this.$buttons.on('click','button.o_calendar_button_new',function(){self.trigger_up('switch_view',{view_type:'form'});});_.each(['prev','today','next'],function(action){self.$buttons.on('click','.o_calendar_button_'+action,function(){self._move(action);});});_.each(['day','week','month'],function(scale){self.$buttons.on('click','.o_calendar_button_'+scale,function(){self.model.setScale(scale);self.reload();});});this.$buttons.find('.o_calendar_button_'+this.mode).addClass('active');if($node){this.$buttons.appendTo($node);}else{this.$('.o_calendar_buttons').replaceWith(this.$buttons);}},renderPager:function($node){if(config.device.isMobile){this.$todayButton=$(QWeb.render('CalendarView.TodayButtonMobile'));this.$todayButton.on('click',this._move.bind(this,'today'));$node.append(this.$todayButton);}},_move:function(to){this.model[to]();return this.reload();},_updateRecord:function(record){var reload=this.reload.bind(this,{});return this.model.updateRecord(record).then(reload,reload);},_onChangeDate:function(event){var modelData=this.model.get();if(modelData.target_date.format('YYYY-MM-DD')===event.data.date.format('YYYY-MM-DD')){switch(modelData.scale){case'month':this.model.setScale('week');break;case'week':this.model.setScale('day');break;case'day':this.model.setScale('month');break;}}else if(modelData.target_date.week()===event.data.date.week()){this.model.setScale('day');}else{this.model.setScale('week');}
this.model.setDate(event.data.date);this.reload();},_onChangeFilter:function(event){if(this.model.changeFilter(event.data)&&!event.data.no_reload){this.reload();}},_onDeleteRecord:function(event){var self=this;Dialog.confirm(this,_t("Are you sure you want to delete this record ?"),{confirm_callback:function(){self.model.deleteRecords([event.data.id],self.modelName).then(function(){self.reload();});}});},_onDropRecord:function(event){this._updateRecord(_.extend({},event.data,{'drop':true,}));},_onNext:function(event){event.stopPropagation();this._move('next');},_onOpenCreate:function(event){var self=this;if(this.model.get().scale==="month"){event.data.allDay=true;}
var data=this.model.calendarEventToRecord(event.data);var context=_.extend({},this.context,event.options&&event.options.context);context.default_name=data.name||null;context['default_'+this.mapping.date_start]=data[this.mapping.date_start]||null;if(this.mapping.date_stop){context['default_'+this.mapping.date_stop]=data[this.mapping.date_stop]||null;}
if(this.mapping.date_delay){context['default_'+this.mapping.date_delay]=data[this.mapping.date_delay]||null;}
if(this.mapping.all_day){context['default_'+this.mapping.all_day]=data[this.mapping.all_day]||null;}
for(var k in context){if(context[k]&&context[k]._isAMomentObject){context[k]=dateToServer(context[k]);}}
var options=_.extend({},this.options,event.options,{context:context,title:_.str.sprintf(_t('Create: %s'),(this.displayName||this.renderer.arch.attrs.string))});if(this.quick!=null){this.quick.destroy();this.quick=null;}
if(!options.disableQuickCreate&&!event.data.disableQuickCreate&&this.quickAddPop){this.quick=new QuickCreate(this,true,options,data,event.data);this.quick.open();this.quick.opened(function(){self.quick.focus();});return;}
var title=_t("Create");if(this.renderer.arch.attrs.string){title+=': '+this.renderer.arch.attrs.string;}
if(this.eventOpenPopup){if(this.previousOpen){this.previousOpen.close();}
this.previousOpen=new dialogs.FormViewDialog(self,{res_model:this.modelName,context:context,title:title,view_id:this.formViewId||false,disable_multiple_selection:true,on_saved:function(){if(event.data.on_save){event.data.on_save();}
self.reload();},});this.previousOpen.open();}else{this.do_action({type:'ir.actions.act_window',res_model:this.modelName,views:[[this.formViewId||false,'form']],target:'current',context:context,});}},_onOpenEvent:function(event){var self=this;var id=event.data._id;id=id&&parseInt(id).toString()===id?parseInt(id):id;if(!this.eventOpenPopup){this._rpc({model:self.modelName,method:'get_formview_id',args:[[id]],context:event.context||self.context,}).then(function(viewId){self.do_action({type:'ir.actions.act_window',res_id:id,res_model:self.modelName,views:[[viewId||false,'form']],target:'current',context:event.context||self.context,});});return;}
var options={res_model:self.modelName,res_id:id||null,context:event.context||self.context,title:_t("Open: ")+_.escape(event.data.title),on_saved:function(){if(event.data.on_save){event.data.on_save();}
self.reload();},};if(this.formViewId){options.view_id=parseInt(this.formViewId);}
new dialogs.FormViewDialog(this,options).open();},_onPrev:function(){event.stopPropagation();this._move('prev');},_onQuickCreate:function(event){var self=this;if(this.quickCreating){return;}
this.quickCreating=true;this.model.createRecord(event).then(function(){self.quick.destroy();self.quick=null;self.reload();self.quickCreating=false;}).guardedCatch(function(result){var errorEvent=result.event;errorEvent.preventDefault();event.data.options.disableQuickCreate=true;event.data.data.on_save=self.quick.destroy.bind(self.quick);self._onOpenCreate(event.data);self.quickCreating=false;})},_onUpdateRecord:function(event){this._updateRecord(event.data);},_onViewUpdated:function(event){this.mode=event.data.mode;if(this.$buttons){this.$buttons.find('.active').removeClass('active');this.$buttons.find('.o_calendar_button_'+this.mode).addClass('active');}
this._setTitle(this.displayName+' ('+event.data.title+')');},});return CalendarController;});;

/* /web/static/src/js/views/calendar/calendar_model.js defined in bundle 'web.assets_backend' */
odoo.define('web.CalendarModel',function(require){"use strict";var AbstractModel=require('web.AbstractModel');var Context=require('web.Context');var core=require('web.core');var fieldUtils=require('web.field_utils');var session=require('web.session');var _t=core._t;var scales=['day','week','month'];function dateToServer(date){return date.clone().utc().locale('en').format('YYYY-MM-DD HH:mm:ss');}
return AbstractModel.extend({init:function(){this._super.apply(this,arguments);this.end_date=null;var week_start=_t.database.parameters.week_start;this.week_start=week_start!==undefined&&week_start!==false?week_start%7:moment().startOf('week').day();this.week_stop=this.week_start+6;},calendarEventToRecord:function(event){var data={'name':event.title};var start=event.start.clone();var end=event.end&&event.end.clone();if(event.allDay||(end&&end.diff(start)%86400000===0)){event.allDay=true;}
if(!end||end.diff(start)<0){if(event.allDay){end=start.clone();}else{end=start.clone().add(2,'h');}}else if(event.allDay){end.add(-1,'days');}
var isDateEvent=this.fields[this.mapping.date_start].type==='date';var keepRecordTime=!this.mapping.all_day||(this.data.scale==='month'&&event.record&&!event.record[this.mapping.all_day]);if(event.allDay){if(keepRecordTime&&!isDateEvent){if(event.r_start){start.hours(event.r_start.hours()).minutes(event.r_start.minutes()).seconds(event.r_start.seconds()).utc();end.hours(event.r_end.hours()).minutes(event.r_end.minutes()).seconds(event.r_end.seconds()).utc();}else{start.hours(7);end.hours(19);}
start.add(-this.getSession().getTZOffset(start),'minutes');end.add(-this.getSession().getTZOffset(end),'minutes');}}else{start.add(-this.getSession().getTZOffset(start),'minutes');end.add(-this.getSession().getTZOffset(end),'minutes');}
if(this.mapping.all_day){if(event.record){data[this.mapping.all_day]=(this.data.scale!=='month'&&event.allDay)||event.record[this.mapping.all_day]&&end.diff(start)<10||false;}else{data[this.mapping.all_day]=event.allDay;}}
data[this.mapping.date_start]=start;if(this.mapping.date_stop){data[this.mapping.date_stop]=end;}
if(this.mapping.date_delay){if(this.data.scale!=='month'||(this.data.scale==='month'&&!event.drop)){data[this.mapping.date_delay]=(end.diff(start)<=0?end.endOf('day').diff(start):end.diff(start))/1000/3600;}}
return data;},changeFilter:function(filter){var Filter=this.data.filters[filter.fieldName];if(filter.value==='all'){Filter.all=filter.active;}
var f=_.find(Filter.filters,function(f){return f.value===filter.value;});if(f){if(f.active!==filter.active){f.active=filter.active;}else{return false;}}else if(filter.active){Filter.filters.push({value:filter.value,active:true,});}
return true;},createRecord:function(event){var data=this.calendarEventToRecord(event.data.data);for(var k in data){if(data[k]&&data[k]._isAMomentObject){data[k]=dateToServer(data[k]);}}
return this._rpc({model:this.modelName,method:'create',args:[data],context:event.data.options.context,});},deleteRecords:function(ids,model){return this._rpc({model:model,method:'unlink',args:[ids],context:session.user_context,});},get:function(){return _.extend({},this.data,{fields:this.fields});},load:function(params){var self=this;this.modelName=params.modelName;this.fields=params.fields;this.fieldNames=params.fieldNames;this.fieldsInfo=params.fieldsInfo;this.mapping=params.mapping;this.mode=params.mode;this.scales=params.scales;this.editable=params.editable;this.creatable=params.creatable;this.eventLimit=params.eventLimit;this.fieldColor=params.fieldColor;if(!this.preloadPromise){this.preloadPromise=new Promise(function(resolve,reject){Promise.all([self._rpc({model:self.modelName,method:'check_access_rights',args:["write",false]}),self._rpc({model:self.modelName,method:'check_access_rights',args:["create",false]})]).then(function(result){var write=result[0];var create=result[1];self.write_right=write;self.create_right=create;resolve();}).guardedCatch(reject);});}
this.data={domain:params.domain,context:params.context,filters:params.filters,};this.setDate(params.initialDate);this.setScale(params.mode);_.each(this.data.filters,function(filter){if(filter.avatar_field&&!filter.avatar_model){filter.avatar_model=self.modelName;}});return this.preloadPromise.then(this._loadCalendar.bind(this));},next:function(){this.setDate(this.data.target_date.clone().add(1,this.data.scale));},prev:function(){this.setDate(this.data.target_date.clone().add(-1,this.data.scale));},reload:function(handle,params){if(params.domain){this.data.domain=params.domain;}
if(params.context){this.data.context=params.context;}
return this._loadCalendar();},setDate:function(start){this.data.highlight_date=this.data.target_date=start.clone();this.data.start_date=this.data.end_date=start;switch(this.data.scale){case'month':var monthStart=this.data.start_date.clone().startOf('month');var monthStartDay;if(monthStart.day()>=this.week_start){monthStartDay=this.week_start;}else{monthStartDay=this.week_start-7;}
this.data.start_date=monthStart.day(monthStartDay).startOf('day');this.data.end_date=this.data.start_date.clone().add(5,'week').day(this.week_stop).endOf('day');break;case'week':var weekStart=this.data.start_date.clone().startOf('week');var weekStartDay=this.week_start;if(this.data.start_date.day()<this.week_start){weekStartDay-=7;}
this.data.start_date=this.data.start_date.clone().day(weekStartDay).startOf('day');this.data.end_date=this.data.end_date.clone().day(weekStartDay+6).endOf('day');break;default:this.data.start_date=this.data.start_date.clone().startOf('day');this.data.end_date=this.data.end_date.clone().endOf('day');}
var manualUtcDateStart=this.data.start_date.clone().add(-this.getSession().getTZOffset(this.data.start_date),'minutes');var formattedUtcDateStart=manualUtcDateStart.format('YYYY-MM-DDTHH:mm:ss')+'Z';this.data.start_date=moment.utc(formattedUtcDateStart);var manualUtcDateEnd=this.data.end_date.clone().add(-this.getSession().getTZOffset(this.data.start_date),'minutes');var formattedUtcDateEnd=manualUtcDateEnd.format('YYYY-MM-DDTHH:mm:ss')+'Z';this.data.end_date=moment.utc(formattedUtcDateEnd);},setScale:function(scale){if(!_.contains(scales,scale)){scale="week";}
this.data.scale=scale;this.setDate(this.data.target_date);},today:function(){this.setDate(moment(new Date()));},updateRecord:function(record){var data=_.omit(this.calendarEventToRecord(record),'name');for(var k in data){if(data[k]&&data[k]._isAMomentObject){data[k]=dateToServer(data[k]);}}
var context=new Context(this.data.context,{from_ui:true});return this._rpc({model:this.modelName,method:'write',args:[[record.id],data],context:context});},_getFilterDomain:function(){var authorizedValues={};var avoidValues={};_.each(this.data.filters,function(filter){if(filter.all)return;_.each(filter.filters,function(f){if(filter.write_model){if(!authorizedValues[filter.fieldName])
authorizedValues[filter.fieldName]=[];if(f.active){authorizedValues[filter.fieldName].push(f.value);}}else{if(!f.active){if(!avoidValues[filter.fieldName])
avoidValues[filter.fieldName]=[];avoidValues[filter.fieldName].push(f.value);}}});});var domain=[];for(var field in authorizedValues){domain.push([field,'in',authorizedValues[field]]);}
for(var field in avoidValues){if(avoidValues[field].length>0){domain.push([field,'not in',avoidValues[field]]);}}
return domain;},_getFullCalendarOptions:function(){return{defaultView:(this.mode==="month")?"month":((this.mode==="week")?"agendaWeek":((this.mode==="day")?"agendaDay":"agendaWeek")),header:false,selectable:this.creatable&&this.create_right,selectHelper:true,editable:this.editable,droppable:true,navLinks:false,eventLimit:this.eventLimit,snapMinutes:15,longPressDelay:500,eventResizableFromStart:true,nowIndicator:true,weekNumbers:true,weekNumbersWithinDays:true,weekNumberTitle:_t("Week")+" ",allDayText:_t("All day"),monthNames:moment.months(),monthNamesShort:moment.monthsShort(),dayNames:moment.weekdays(),dayNamesShort:moment.weekdaysShort(),firstDay:this.week_start,slotLabelFormat:_t.database.parameters.time_format.search("%H")!=-1?'H:mm':'h(:mm)a',};},_getRangeDomain:function(){var domain=[[this.mapping.date_start,'<=',dateToServer(this.data.end_date)]];if(this.mapping.date_stop){domain.push([this.mapping.date_stop,'>=',dateToServer(this.data.start_date)]);}else if(!this.mapping.date_delay){domain.push([this.mapping.date_start,'>=',dateToServer(this.data.start_date)]);}
return domain;},_loadCalendar:function(){var self=this;this.data.fc_options=this._getFullCalendarOptions();var defs=_.map(this.data.filters,this._loadFilter.bind(this));return Promise.all(defs).then(function(){return self._rpc({model:self.modelName,method:'search_read',context:self.data.context,fields:self.fieldNames,domain:self.data.domain.concat(self._getRangeDomain()).concat(self._getFilterDomain())}).then(function(events){self._parseServerData(events);self.data.data=_.map(events,self._recordToCalendarEvent.bind(self));return Promise.all([self._loadColors(self.data,self.data.data),self._loadRecordsToFilters(self.data,self.data.data)]);});});},_loadColors:function(element,events){if(this.fieldColor){var fieldName=this.fieldColor;_.each(events,function(event){var value=event.record[fieldName];event.color_index=_.isArray(value)?value[0]:value;});this.model_color=this.fields[fieldName].relation||element.model;}
return Promise.resolve();},_loadFilter:function(filter){if(!filter.write_model){return Promise.resolve();}
var field=this.fields[filter.fieldName];return this._rpc({model:filter.write_model,method:'search_read',domain:[["user_id","=",session.uid]],fields:[filter.write_field],}).then(function(res){var records=_.map(res,function(record){var _value=record[filter.write_field];var value=_.isArray(_value)?_value[0]:_value;var f=_.find(filter.filters,function(f){return f.value===value;});var formater=fieldUtils.format[_.contains(['many2many','one2many'],field.type)?'many2one':field.type];return{'id':record.id,'value':value,'label':formater(_value,field),'active':!f||f.active,};});records.sort(function(f1,f2){return _.string.naturalCmp(f2.label,f1.label);});if(field.relation==='res.partner'||field.relation==='res.users'){var value=field.relation==='res.partner'?session.partner_id:session.uid;var me=_.find(records,function(record){return record.value===value;});if(me){records.splice(records.indexOf(me),1);}else{var f=_.find(filter.filters,function(f){return f.value===value;});me={'value':value,'label':session.name+_t(" [Me]"),'active':!f||f.active,};}
records.unshift(me);}
records.push({'value':'all','label':field.relation==='res.partner'||field.relation==='res.users'?_t("Everybody's calendars"):_t("Everything"),'active':filter.all,});filter.filters=records;});},_loadRecordsToFilters:function(element,events){var self=this;var new_filters={};var to_read={};_.each(this.data.filters,function(filter,fieldName){var field=self.fields[fieldName];new_filters[fieldName]=filter;if(filter.write_model){if(field.relation===self.model_color){_.each(filter.filters,function(f){f.color_index=f.value;});}
return;}
_.each(filter.filters,function(filter){filter.display=!filter.active;});var fs=[];var undefined_fs=[];_.each(events,function(event){var data=event.record[fieldName];if(!_.contains(['many2many','one2many'],field.type)){data=[data];}else{to_read[field.relation]=(to_read[field.relation]||[]).concat(data);}
_.each(data,function(_value){var value=_.isArray(_value)?_value[0]:_value;var f={'color_index':self.model_color===(field.relation||element.model)?value:false,'value':value,'label':fieldUtils.format[field.type](_value,field)||_t("Undefined"),'avatar_model':field.relation||element.model,};value?fs.push(f):undefined_fs.push(f);});});_.each(_.union(fs,undefined_fs),function(f){var f1=_.findWhere(filter.filters,f);if(f1){f1.display=true;}else{f.display=f.active=true;filter.filters.push(f);}});});var defs=[];_.each(to_read,function(ids,model){defs.push(self._rpc({model:model,method:'name_get',args:[_.uniq(ids)],}).then(function(res){to_read[model]=_.object(res);}));});return Promise.all(defs).then(function(){_.each(self.data.filters,function(filter){if(filter.write_model){return;}
if(filter.filters.length&&(filter.filters[0].avatar_model in to_read)){_.each(filter.filters,function(f){f.label=to_read[f.avatar_model][f.value];});}});});},_parseServerData:function(data){var self=this;_.each(data,function(event){_.each(self.fieldNames,function(fieldName){event[fieldName]=self._parseServerValue(self.fields[fieldName],event[fieldName]);});});},_recordToCalendarEvent:function(evt){var date_start;var date_stop;var date_delay=evt[this.mapping.date_delay]||1.0,all_day=this.fields[this.mapping.date_start].type==='date'||this.mapping.all_day&&evt[this.mapping.all_day]||false,the_title='',attendees=[];if(!all_day){date_start=evt[this.mapping.date_start].clone();date_stop=this.mapping.date_stop?evt[this.mapping.date_stop].clone():null;}else{date_start=evt[this.mapping.date_start].clone().startOf('day');date_stop=this.mapping.date_stop?evt[this.mapping.date_stop].clone().startOf('day'):null;}
if(!date_stop&&date_delay){date_stop=date_start.clone().add(date_delay,'hours');}
if(!all_day){date_start.add(this.getSession().getTZOffset(date_start),'minutes');date_stop.add(this.getSession().getTZOffset(date_stop),'minutes');}
if(this.mapping.all_day&&evt[this.mapping.all_day]){date_stop.add(1,'days');}
var r={'record':evt,'start':date_start,'end':date_stop,'r_start':date_start,'r_end':date_stop,'title':the_title,'allDay':all_day,'id':evt.id,'attendees':attendees,};if(this.mapping.all_day&&evt[this.mapping.all_day]){}else if(this.data.scale==='month'&&this.fields[this.mapping.date_start].type!=='date'){r.end=date_stop.clone().add(1,'days').startOf('day').format('YYYY-MM-DD');r.start=date_start.clone().format('YYYY-MM-DD');r.reset_allday=r.allDay;r.allDay=true;}
return r;},});});;

/* /web/static/src/js/views/calendar/calendar_popover.js defined in bundle 'web.assets_backend' */
odoo.define('web.CalendarPopover',function(require){"use strict";var fieldRegistry=require('web.field_registry');var StandaloneFieldManagerMixin=require('web.StandaloneFieldManagerMixin');var Widget=require('web.Widget');var CalendarPopover=Widget.extend(StandaloneFieldManagerMixin,{template:'CalendarView.event.popover',events:{'click .o_cw_popover_edit':'_onClickPopoverEdit','click .o_cw_popover_delete':'_onClickPopoverDelete',},init:function(parent,eventInfo){this._super.apply(this,arguments);StandaloneFieldManagerMixin.init.call(this);this.hideDate=eventInfo.hideDate;this.hideTime=eventInfo.hideTime;this.eventTime=eventInfo.eventTime;this.eventDate=eventInfo.eventDate;this.displayFields=eventInfo.displayFields;this.fields=eventInfo.fields;this.event=eventInfo.event;this.modelName=eventInfo.modelName;},willStart:function(){return Promise.all([this._super.apply(this,arguments),this._processFields()]);},start:function(){var self=this;_.each(this.$fieldsList,function($field){$field.appendTo(self.$('.o_cw_popover_fields_secondary'));});return this._super.apply(this,arguments);},_processFields:function(){var self=this;var fieldsToGenerate=[];var fields=_.keys(this.displayFields);for(var i=0;i<fields.length;i++){var fieldName=fields[i];var displayFieldInfo=self.displayFields[fieldName]||{attrs:{invisible:1}};var fieldInfo=self.fields[fieldName];var field={name:fieldName,string:displayFieldInfo.attrs.string||fieldInfo.string,value:self.event.record[fieldName],type:fieldInfo.type,invisible:displayFieldInfo.attrs.invisible};if(field.type==='selection'){field.selection=fieldInfo.selection;}
if(field.type==='monetary'){var currencyField=field.currency_field||'currency_id';if(!fields.includes(currencyField)&&_.has(self.event.record,currencyField)){fields.push(currencyField);}}
if(fieldInfo.relation){field.relation=fieldInfo.relation;}
if(displayFieldInfo.attrs.widget){field.widget=displayFieldInfo.attrs.widget;}else if(_.contains(['many2many','one2many'],field.type)){field.widget='many2many_tags';}
if(_.contains(['many2many','one2many'],field.type)){field.fields=[{name:'id',type:'integer',},{name:'display_name',type:'char',}];}
fieldsToGenerate.push(field);};this.$fieldsList=[];return this.model.makeRecord(this.modelName,fieldsToGenerate).then(function(recordID){var defs=[];var record=self.model.get(recordID);_.each(fieldsToGenerate,function(field){if(field.invisible)return;var FieldClass=fieldRegistry.getAny([field.widget,field.type]);var fieldWidget=new FieldClass(self,field.name,record,self.displayFields[field.name]);if(fieldWidget.attrs&&!_.isObject(fieldWidget.attrs.modifiers)){fieldWidget.attrs.modifiers=fieldWidget.attrs.modifiers?JSON.parse(fieldWidget.attrs.modifiers):{};}
self._registerWidget(recordID,field.name,fieldWidget);var $field=$('<li>',{class:'list-group-item flex-shrink-0 d-flex flex-wrap'});var $fieldLabel=$('<strong>',{class:'mr-2',text:_.str.sprintf('%s : ',field.string)});$fieldLabel.appendTo($field);var $fieldContainer=$('<div>',{class:'flex-grow-1'});$fieldContainer.appendTo($field);self.$fieldsList.push($field);defs.push(fieldWidget.appendTo($fieldContainer));});return Promise.all(defs);});},_onClickPopoverEdit:function(ev){ev.preventDefault();this.trigger_up('edit_event',{id:this.event.id,title:this.event.record.display_name,});},_onClickPopoverDelete:function(ev){ev.preventDefault();this.trigger_up('delete_event',{id:this.event.id});},});return CalendarPopover;});;

/* /web/static/src/js/views/calendar/calendar_quick_create.js defined in bundle 'web.assets_backend' */
odoo.define('web.CalendarQuickCreate',function(require){"use strict";var core=require('web.core');var Dialog=require('web.Dialog');var _t=core._t;var QWeb=core.qweb;var QuickCreate=Dialog.extend({events:_.extend({},Dialog.events,{'keyup input':'_onkeyup',}),init:function(parent,buttons,options,dataTemplate,dataCalendar){this._buttons=buttons||false;this.options=options;this.dataTemplate=dataTemplate||{};this.dataCalendar=dataCalendar;var self=this;this._super(parent,{title:options.title,size:'small',buttons:this._buttons?[{text:_t("Create"),classes:'btn-primary',click:function(){if(!self._quickAdd(dataCalendar)){self.focus();}}},{text:_t("Edit"),click:function(){dataCalendar.disableQuickCreate=true;dataCalendar.title=self.$('input').val().trim();dataCalendar.on_save=self.destroy.bind(self);self.trigger_up('openCreate',dataCalendar);}},{text:_t("Cancel"),close:true},]:[],$content:QWeb.render('CalendarView.quick_create',{widget:this})});},focus:function(){this.$('input').focus();},_quickAdd:function(dataCalendar){dataCalendar=$.extend({},this.dataTemplate,dataCalendar);var val=this.$('input').val().trim();if(!val){this.$('label, input').addClass('o_field_invalid');var warnings=_.str.sprintf('<ul><li>%s</li></ul>',_t("Summary"));this.do_warn(_t("The following field is invalid:"),warnings);}
dataCalendar.title=val;return(val)?this.trigger_up('quickCreate',{data:dataCalendar,options:this.options}):false;},_onkeyup:function(event){if(this._flagEnter){return;}
if(event.keyCode===$.ui.keyCode.ENTER){this._flagEnter=true;if(!this._quickAdd(this.dataCalendar)){this._flagEnter=false;}}else if(event.keyCode===$.ui.keyCode.ESCAPE&&this._buttons){this.close();}},});return QuickCreate;});;

/* /web/static/src/js/views/calendar/calendar_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.CalendarRenderer',function(require){"use strict";var AbstractRenderer=require('web.AbstractRenderer');var CalendarPopover=require('web.CalendarPopover');var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var field_utils=require('web.field_utils');var FieldManagerMixin=require('web.FieldManagerMixin');var relational_fields=require('web.relational_fields');var session=require('web.session');var Widget=require('web.Widget');var _t=core._t;var qweb=core.qweb;var scales={day:'agendaDay',week:'agendaWeek',month:'month'};var SidebarFilterM2O=relational_fields.FieldMany2One.extend({_getSearchBlacklist:function(){return this._super.apply(this,arguments).concat(this.filter_ids||[]);},});var SidebarFilter=Widget.extend(FieldManagerMixin,{template:'CalendarView.sidebar.filter',custom_events:_.extend({},FieldManagerMixin.custom_events,{field_changed:'_onFieldChanged',}),init:function(parent,options){this._super.apply(this,arguments);FieldManagerMixin.init.call(this);this.title=options.title;this.fields=options.fields;this.fieldName=options.fieldName;this.write_model=options.write_model;this.write_field=options.write_field;this.avatar_field=options.avatar_field;this.avatar_model=options.avatar_model;this.filters=options.filters;this.label=options.label;this.getColor=options.getColor;this.isSwipeEnabled=true;},willStart:function(){var self=this;var defs=[this._super.apply(this,arguments)];if(this.write_model||this.write_field){var def=this.model.makeRecord(this.write_model,[{name:this.write_field,relation:this.fields[this.fieldName].relation,type:'many2one',}]).then(function(recordID){self.many2one=new SidebarFilterM2O(self,self.write_field,self.model.get(recordID),{mode:'edit',attrs:{placeholder:"+ "+_.str.sprintf(_t("Add %s"),self.title),can_create:false},});});defs.push(def);}
return Promise.all(defs);},start:function(){this._super();if(this.many2one){this.many2one.appendTo(this.$el);this.many2one.filter_ids=_.without(_.pluck(this.filters,'value'),'all');}
this.$el.on('click','.o_remove',this._onFilterRemove.bind(this));this.$el.on('click','.o_calendar_filter_items input',this._onFilterActive.bind(this));},_onFieldChanged:function(event){var self=this;event.stopPropagation();var createValues={'user_id':session.uid};var value=event.data.changes[this.write_field].id;createValues[this.write_field]=value;this._rpc({model:this.write_model,method:'create',args:[createValues],}).then(function(){self.trigger_up('changeFilter',{'fieldName':self.fieldName,'value':value,'active':true,});});},_onFilterActive:function(e){var $input=$(e.currentTarget);this.trigger_up('changeFilter',{'fieldName':this.fieldName,'value':$input.closest('.o_calendar_filter_item').data('value'),'active':$input.prop('checked'),});},_onFilterRemove:function(e){var self=this;var $filter=$(e.currentTarget).closest('.o_calendar_filter_item');Dialog.confirm(this,_t("Do you really want to delete this filter from favorites ?"),{confirm_callback:function(){self._rpc({model:self.write_model,method:'unlink',args:[[$filter.data('id')]],}).then(function(){self.trigger_up('changeFilter',{'fieldName':self.fieldName,'id':$filter.data('id'),'active':false,'value':$filter.data('value'),});});},});},});return AbstractRenderer.extend({template:"CalendarView",config:{CalendarPopover:CalendarPopover,},custom_events:_.extend({},AbstractRenderer.prototype.custom_events||{},{edit_event:'_onEditEvent',delete_event:'_onDeleteEvent',}),init:function(parent,state,params){this._super.apply(this,arguments);this.displayFields=params.displayFields;this.model=params.model;this.filters=[];this.color_map={};this.hideDate=params.hideDate;this.hideTime=params.hideTime;},start:function(){this._initSidebar();this._initCalendar();if(config.device.isMobile){this._bindSwipe();}
return this._super();},on_attach_callback:function(){if(config.device.isMobile){this.$el.height($(window).height()-this.$el.offset().top);}
var scrollTop=this.$calendar.find('.fc-scroller').scrollTop();if(scrollTop){this.$calendar.fullCalendar('reinitView');}else{this.$calendar.fullCalendar('render');}
this._renderEvents();},destroy:function(){if(this.$calendar){this.$calendar.fullCalendar('destroy');}
if(this.$small_calendar){this.$small_calendar.datepicker('destroy');$('#ui-datepicker-div:empty').remove();}
this._super.apply(this,arguments);},getAvatars:function(record,fieldName,imageField){var field=this.state.fields[fieldName];if(!record[fieldName]){return[];}
if(field.type==='one2many'||field.type==='many2many'){return _.map(record[fieldName],function(id){return'<img src="/web/image/'+field.relation+'/'+id+'/'+imageField+'" />';});}else if(field.type==='many2one'){return['<img src="/web/image/'+field.relation+'/'+record[fieldName][0]+'/'+imageField+'" />'];}else{var value=this._format(record,fieldName);var color=this.getColor(value);if(isNaN(color)){return['<span class="o_avatar_square" style="background-color:'+color+';"/>'];}
else{return['<span class="o_avatar_square o_calendar_color_'+color+'"/>'];}}},getColor:function(key){if(!key){return;}
if(this.color_map[key]){return this.color_map[key];}
if(typeof key==='string'&&key.match(/^((#[A-F0-9]{3})|(#[A-F0-9]{6})|((hsl|rgb)a?\(\s*(?:(\s*\d{1,3}%?\s*),?){3}(\s*,[0-9.]{1,4})?\))|)$/i)){return this.color_map[key]=key;}
var index=(((_.keys(this.color_map).length+1)*5)%24)+1;this.color_map[key]=index;return index;},getLocalState:function(){var $fcScroller=this.$calendar.find('.fc-scroller');return{scrollPosition:$fcScroller.scrollTop(),};},setLocalState:function(localState){if(localState.scrollPosition){var $fcScroller=this.$calendar.find('.fc-scroller');$fcScroller.scrollTop(localState.scrollPosition);}},_bindSwipe:function(){var self=this;var touchStartX;var touchEndX;this.$calendar.on('touchstart',function(event){touchStartX=event.originalEvent.touches[0].pageX;});this.$calendar.on('touchend',function(event){touchEndX=event.originalEvent.changedTouches[0].pageX;if(!self.isSwipeEnabled){return;}
if(touchStartX-touchEndX>100){self.trigger_up('next');}else if(touchStartX-touchEndX<-100){self.trigger_up('prev');}});},_eventRender:function(event){var qweb_context={event:event,record:event.record,color:this.getColor(event.color_index),};this.qweb_context=qweb_context;if(_.isEmpty(qweb_context.record)){return'';}else{return qweb.render("calendar-box",qweb_context);}},_format:function(record,fieldName){var field=this.state.fields[fieldName];if(field.type==="one2many"||field.type==="many2many"){return field_utils.format[field.type]({data:record[fieldName]},field);}else{return field_utils.format[field.type](record[fieldName],field,{forceString:true});}},_initCalendar:function(){var self=this;this.$calendar=this.$(".o_calendar_widget");var locale=moment.locale();$.fullCalendar.locale(locale);var fc_options=$.extend({},this.state.fc_options,{eventDrop:function(event){self.trigger_up('dropRecord',event);},eventResize:function(event){self._unselectEvent();self.trigger_up('updateRecord',event);},eventClick:function(eventData,ev){self._unselectEvent();self.$calendar.find(_.str.sprintf('[data-event-id=%s]',eventData.id)).addClass('o_cw_custom_highlight');self._renderEventPopover(eventData,$(ev.currentTarget));},select:function(startDate,endDate){self.isSwipeEnabled=false;if(self.$('.o_cw_popover').length){self._unselectEvent();}else{var data={start:startDate,end:endDate};if(self.state.context.default_name){data.title=self.state.context.default_name;}
self.trigger_up('openCreate',data);}
self.$calendar.fullCalendar('unselect');},eventRender:function(event,element,view){self.isSwipeEnabled=false;var $render=$(self._eventRender(event));element.find('.fc-content').html($render.html());element.addClass($render.attr('class'));element.attr('data-event-id',event.id);if(!element.find('.fc-bg').length){element.find('.fc-content').after($('<div/>',{class:'fc-bg'}));}
if(view.name==='month'&&event.record){var start=event.r_start||event.start;var end=event.r_end||event.end;var isSameDayEvent=start.clone().add(1,'minute').isSame(end.clone().subtract(1,'minute'),'day');if(!event.record.allday&&isSameDayEvent){element.addClass('o_cw_nobg');}}
element.on('dblclick',function(){self.trigger_up('edit_event',{id:event.id});});},eventAfterAllRender:function(){self.isSwipeEnabled=true;},viewRender:function(view){var mode=view.name==='month'?'month':(view.name==='agendaWeek'?'week':'day');self.trigger_up('viewUpdated',{mode:mode,title:view.title,});},eventMouseover:function(eventData){self.$calendar.find(_.str.sprintf('[data-event-id=%s]',eventData.id)).addClass('o_cw_custom_hover');},eventMouseout:function(eventData){self.$calendar.find(_.str.sprintf('[data-event-id=%s]',eventData.id)).removeClass('o_cw_custom_hover');},eventDragStart:function(eventData){self.$calendar.find(_.str.sprintf('[data-event-id=%s]',eventData.id)).addClass('o_cw_custom_hover');self._unselectEvent();},eventResizeStart:function(eventData){self.$calendar.find(_.str.sprintf('[data-event-id=%s]',eventData.id)).addClass('o_cw_custom_hover');self._unselectEvent();},eventLimitClick:function(){self._unselectEvent();return'popover';},windowResize:function(){self._render();},views:{day:{columnFormat:'LL'},week:{columnFormat:'ddd D'},month:{columnFormat:config.device.isMobile?'ddd':'dddd'}},height:'parent',unselectAuto:false,isRTL:_t.database.parameters.direction==="rtl",locale:locale,});this.$calendar.fullCalendar(fc_options);},_initCalendarMini:function(){var self=this;this.$small_calendar=this.$(".o_calendar_mini");this.$small_calendar.datepicker({'onSelect':function(datum,obj){self.trigger_up('changeDate',{date:moment(new Date(+obj.currentYear,+obj.currentMonth,+obj.currentDay))});},'showOtherMonths':true,'dayNamesMin':this.state.fc_options.dayNamesShort,'monthNames':this.state.fc_options.monthNamesShort,'firstDay':this.state.fc_options.firstDay,});},_initSidebar:function(){this.$sidebar=this.$('.o_calendar_sidebar');this.$sidebar_container=this.$(".o_calendar_sidebar_container");this._initCalendarMini();},_onPopoverShown:function($popoverElement,calendarPopover){var $popover=$($popoverElement.data('bs.popover').tip);$popover.find('.o_cw_popover_close').on('click',this._unselectEvent.bind(this));$popover.find('.o_cw_body').replaceWith(calendarPopover.$el);},_render:function(){var $calendar=this.$calendar;var $fc_view=$calendar.find('.fc-view');var scrollPosition=$fc_view.scrollLeft();$fc_view.scrollLeft(0);$calendar.fullCalendar('unselect');if(scales[this.state.scale]!==$calendar.data('fullCalendar').getView().type){$calendar.fullCalendar('changeView',scales[this.state.scale]);}
if(this.target_date!==this.state.target_date.toString()){$calendar.fullCalendar('gotoDate',moment(this.state.target_date));this.target_date=this.state.target_date.toString();}
this.$small_calendar.datepicker("setDate",this.state.highlight_date.toDate()).find('.o_selected_range').removeClass('o_color o_selected_range');var $a;switch(this.state.scale){case'month':$a=this.$small_calendar.find('td');break;case'week':$a=this.$small_calendar.find('tr:has(.ui-state-active)');break;case'day':$a=this.$small_calendar.find('a.ui-state-active');break;}
$a.addClass('o_selected_range');setTimeout(function(){$a.not('.ui-state-active').addClass('o_color');});$fc_view.scrollLeft(scrollPosition);this._unselectEvent();var filterProm=this._renderFilters();this._renderEvents();this.$calendar.prependTo(this.$('.o_calendar_view'));return Promise.all([filterProm,this._super.apply(this,arguments)]);},_renderEvents:function(){this.$calendar.fullCalendar('removeEvents');this.$calendar.fullCalendar('addEventSource',this.state.data);},_renderFilters:function(){this.$('.o_calendar_filter_item').popover('dispose');_.each(this.filters||(this.filters=[]),function(filter){filter.destroy();});if(this.state.fullWidth){return;}
return this._renderFiltersOneByOne();},_renderFiltersOneByOne:function(filterIndex){filterIndex=filterIndex||0;var arrFilters=_.toArray(this.state.filters);var prom;if(filterIndex<arrFilters.length){var options=arrFilters[filterIndex];if(!_.find(options.filters,function(f){return f.display==null||f.display;})){return this._renderFiltersOneByOne(filterIndex+1);}
var self=this;options.getColor=this.getColor.bind(this);options.fields=this.state.fields;var filter=new SidebarFilter(self,options);prom=filter.appendTo(this.$sidebar).then(function(){if(options.avatar_field){_.each(options.filters,function(filter){if(filter.value!=='all'){var selector=_.str.sprintf('.o_calendar_filter_item[data-value=%s]',filter.value);self.$sidebar.find(selector).popover({animation:false,trigger:'hover',html:true,placement:'top',title:filter.label,delay:{show:300,hide:0},content:function(){return $('<img>',{src:_.str.sprintf('/web/image/%s/%s/%s',options.avatar_model,filter.value,options.avatar_field),class:'mx-auto',});},});}});}
return self._renderFiltersOneByOne(filterIndex+1);});this.filters.push(filter);}
return Promise.resolve(prom);},_getPopoverContext:function(eventData){var context={hideDate:this.hideDate,hideTime:this.hideTime,eventTime:{},eventDate:{},fields:this.state.fields,displayFields:this.displayFields,event:eventData,modelName:this.model,};var start=moment(eventData.r_start||eventData.start);var end=moment(eventData.r_end||eventData.end);var isSameDayEvent=start.clone().add(1,'minute').isSame(end.clone().subtract(1,'minute'),'day');if(!this.hideTime&&!eventData.record.allday&&isSameDayEvent){var dbTimeFormat=_t.database.parameters.time_format.search('%H')!=-1?'HH:mm':'hh:mm a';context.eventTime.time=start.clone().format(dbTimeFormat)+' - '+end.clone().format(dbTimeFormat);var durationHours=moment.duration(end.diff(start)).hours();var durationHoursKey=(durationHours===1)?'h':'hh';var durationMinutes=moment.duration(end.diff(start)).minutes();var durationMinutesKey=(durationMinutes===1)?'m':'mm';var localeData=moment.localeData();context.eventTime.duration=(durationHours>0?localeData.relativeTime(durationHours,true,durationHoursKey):'')
+(durationHours>0&&durationMinutes>0?', ':'')
+(durationMinutes>0?localeData.relativeTime(durationMinutes,true,durationMinutesKey):'');}
if(!this.hideDate){if(eventData.record.allday&&isSameDayEvent){context.eventDate.duration=_t("All day");}else if(eventData.record.allday&&!isSameDayEvent){var daysLocaleData=moment.localeData();var days=moment.duration(end.diff(start)).days();context.eventDate.duration=daysLocaleData.relativeTime(days,true,'dd');}
if(eventData.allDay){end.subtract(1,'day');}
if(!isSameDayEvent&&start.isSame(end,'month')){context.eventDate.date=start.clone().format('MMMM D')+'-'+end.clone().format('D, YYYY');}else{context.eventDate.date=isSameDayEvent?start.clone().format('dddd, LL'):start.clone().format('LL')+' - '+end.clone().format('LL');}}
return context;},_getPopoverParams:function(eventData){return{animation:false,delay:{show:50,hide:100},trigger:'manual',html:true,title:eventData.record.display_name,template:qweb.render('CalendarView.event.popover.placeholder',{color:this.getColor(eventData.color_index)}),container:eventData.allDay?'.fc-view':'.fc-scroller',}},_renderEventPopover:function(eventData,$eventElement){var self=this;var calendarPopover=new self.config.CalendarPopover(self,self._getPopoverContext(eventData));calendarPopover.appendTo($('<div>')).then(()=>{$eventElement.popover(self._getPopoverParams(eventData)).on('shown.bs.popover',function(){self._onPopoverShown($(this),calendarPopover);}).popover('show');});},_unselectEvent:function(){this.$('.fc-event').removeClass('o_cw_custom_highlight');this.$('.o_cw_popover').popover('dispose');},_onEditEvent:function(event){this._unselectEvent();this.trigger_up('openEvent',{_id:event.data.id,title:event.data.title,});},_onDeleteEvent:function(event){this._unselectEvent();this.trigger_up('deleteRecord',{id:event.data.id});},});});;

/* /web/static/src/js/views/calendar/calendar_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.CalendarView',function(require){"use strict";var AbstractView=require('web.AbstractView');var CalendarModel=require('web.CalendarModel');var CalendarController=require('web.CalendarController');var CalendarRenderer=require('web.CalendarRenderer');var core=require('web.core');var pyUtils=require('web.py_utils');var utils=require('web.utils');var _lt=core._lt;var fieldsToGather=["date_start","date_delay","date_stop","all_day",];var CalendarView=AbstractView.extend({display_name:_lt('Calendar'),icon:'fa-calendar',jsLibs:['/web/static/lib/fullcalendar/js/fullcalendar.js'],cssLibs:['/web/static/lib/fullcalendar/css/fullcalendar.css'],config:_.extend({},AbstractView.prototype.config,{Model:CalendarModel,Controller:CalendarController,Renderer:CalendarRenderer,}),viewType:'calendar',searchMenuTypes:['filter','favorite'],init:function(viewInfo,params){this._super.apply(this,arguments);var arch=this.arch;var fields=this.fields;var attrs=arch.attrs;if(!attrs.date_start){throw new Error(_lt("Calendar view has not defined 'date_start' attribute."));}
var mapping={};var fieldNames=fields.display_name?['display_name']:[];var displayFields={};_.each(fieldsToGather,function(field){if(arch.attrs[field]){var fieldName=attrs[field];mapping[field]=fieldName;fieldNames.push(fieldName);}});var filters={};var eventLimit=attrs.event_limit!==null&&(isNaN(+attrs.event_limit)?_.str.toBool(attrs.event_limit):+attrs.event_limit);var modelFilters=[];_.each(arch.children,function(child){if(child.tag!=='field')return;var fieldName=child.attrs.name;fieldNames.push(fieldName);if(!child.attrs.invisible){child.attrs.options=child.attrs.options?pyUtils.py_eval(child.attrs.options):{};displayFields[fieldName]={attrs:child.attrs};if(params.sidebar===false)return;if(child.attrs.avatar_field){filters[fieldName]=filters[fieldName]||{'title':fields[fieldName].string,'fieldName':fieldName,'filters':[],};filters[fieldName].avatar_field=child.attrs.avatar_field;filters[fieldName].avatar_model=fields[fieldName].relation;}
if(child.attrs.write_model){filters[fieldName]=filters[fieldName]||{'title':fields[fieldName].string,'fieldName':fieldName,'filters':[],};filters[fieldName].write_model=child.attrs.write_model;filters[fieldName].write_field=child.attrs.write_field;modelFilters.push(fields[fieldName].relation);}}});if(attrs.color){var fieldName=attrs.color;fieldNames.push(fieldName);filters[fieldName]={'title':fields[fieldName].string,'fieldName':fieldName,'filters':[],};if(fields[fieldName].relation){if(['res.users','res.partner','hr.employee'].indexOf(fields[fieldName].relation)!==-1){filters[fieldName].avatar_field='image_128';}
filters[fieldName].avatar_model=fields[fieldName].relation;}}
this.controllerParams.quickAddPop=(!('quick_add'in attrs)||utils.toBoolElse(attrs.quick_add+'',true));this.controllerParams.disableQuickCreate=params.disable_quick_create||!this.controllerParams.quickAddPop;this.controllerParams.formViewId=attrs.form_view_id?parseInt(attrs.form_view_id,10):false;if(!this.controllerParams.formViewId&&params.action){var formViewDescr=_.find(params.action.views,function(v){return v.type==='form';});if(formViewDescr){this.controllerParams.formViewId=formViewDescr.viewID;}}
this.controllerParams.eventOpenPopup=utils.toBoolElse(attrs.event_open_popup||'',false);this.controllerParams.mapping=mapping;this.controllerParams.context=params.context||{};this.controllerParams.displayName=params.action&&params.action.name;this.rendererParams.displayFields=displayFields;this.rendererParams.model=viewInfo.model;this.rendererParams.hideDate=utils.toBoolElse(attrs.hide_date||'',false);this.rendererParams.hideTime=utils.toBoolElse(attrs.hide_time||'',false);this.loadParams.fieldNames=_.uniq(fieldNames);this.loadParams.mapping=mapping;this.loadParams.fields=fields;this.loadParams.fieldsInfo=viewInfo.fieldsInfo;this.loadParams.editable=!fields[mapping.date_start].readonly;this.loadParams.creatable=true;this.loadParams.eventLimit=eventLimit;this.loadParams.fieldColor=attrs.color;this.loadParams.filters=filters;this.loadParams.mode=(params.context&&params.context.default_mode)||attrs.mode;this.loadParams.initialDate=moment(params.initialDate||(params.context&&params.context.initial_date)||new Date());},});return CalendarView;});;

/* /web/static/src/js/views/qweb/qweb_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.qweb',function(require){"use strict";var core=require('web.core');var AbstractView=require('web.AbstractView');var AbstractModel=require('web.AbstractModel');var AbstractRenderer=require('web.AbstractRenderer');var AbstractController=require('web.AbstractController');var registry=require('web.view_registry');var _lt=core._lt;var Model=AbstractModel.extend({init:function(){this._super.apply(this,arguments);this._state={viewId:false,modelName:false,body:'',context:{},domain:[],};},_fetch:function(){var state=this._state;return this._rpc({model:state.modelName,method:'qweb_render_view',kwargs:{view_id:state.viewId,domain:state.domain,context:state.context}}).then(function(r){state.body=r;return state.viewId;});},get:function(){return this._state;},load:function(params){_.extend(this._state,_.pick(params,['viewId','modelName','domain','context']));return this._fetch();},reload:function(_id,params){_.extend(this._state,_.pick(params,['domain','context']));return this._fetch();}});var Renderer=AbstractRenderer.extend({_render:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.$el.html(self.state.body);});}});var Controller=AbstractController.extend({events:_.extend({},AbstractController.prototype.events,{'click [type="toggle"]':'_onLazyToggle',}),init:function(){this._super.apply(this,arguments);this._$buttons=$('<nav>').on('click','[type="action"]',this.proxy('_onActionClicked'));},renderButtons:function($node){this._super($node);$node.append(this._$buttons);},_update:function(){var self=this;return this._super.apply(this,arguments).then(function(){var $cp_buttons=self.renderer.$('nav.o_qweb_cp_buttons');$cp_buttons.children().appendTo(self._$buttons.empty());$cp_buttons.remove();});},_onLazyToggle:function(e){var $target=$(e.target);var $t=$target.closest('[data-model]');if(!($target.hasClass('fa-caret-down')||$target.hasClass('fa-caret-right'))){$target=$t.find('.fa-caret-down, .fa-caret-right');}
var data=$t.data();if(this._fold($t)){$target.removeClass('fa-caret-down').addClass('fa-caret-right');return;}
var args=data.args||_.omit(data,'model','method','id');return this._rpc({model:data.model,method:data.method,args:data.id?[data.id]:undefined,kwargs:args}).then(function(s){return $(s);}).then(function($newcontent){$t.data('children',$newcontent).after($newcontent);$target.removeClass('fa-caret-right').addClass('fa-caret-down');});},_fold:function($el){var $children=$el.data('children');if(!$children){return false;}
var self=this;$children.each(function(_i,e){self._fold($(e));}).remove();$el.removeData('children');return true;}});var QWebView=AbstractView.extend({display_name:_lt('Freedom View'),icon:'fa-file-picture-o',viewType:'qweb',enableTimeRangeMenu:true,config:_.extend({},AbstractView.prototype.config,{Model:Model,Renderer:Renderer,Controller:Controller,}),init:function(viewInfo,params){this._super.apply(this,arguments);this.loadParams.viewId=viewInfo.view_id;}});registry.add('qweb',QWebView);return{View:QWebView,Controller:Controller,Renderer:Renderer,Model:Model};});;

/* /web/static/src/js/widgets/attach_document.js defined in bundle 'web.assets_backend' */
odoo.define('web.AttachDocument',function(require){"use static";var core=require('web.core');var framework=require('web.framework');var widgetRegistry=require('web.widget_registry');var Widget=require('web.Widget');var _t=core._t;var AttachDocument=Widget.extend({template:'AttachDocument',events:{'click':'_onClickAttachDocument','change input.o_input_file':'_onFileChanged',},init:function(parent,record,nodeInfo){this._super.apply(this,arguments);this.res_id=record.res_id;this.res_model=record.model;this.state=record;this.node=nodeInfo;this.fileuploadID=_.uniqueId('o_fileupload');},start:function(){$(window).on(this.fileuploadID,this._onFileLoaded.bind(this));return this._super.apply(this,arguments);},destroy:function(){$(window).off(this.fileuploadID);this._super.apply(this,arguments);},_notifyInvalidFields:function(invalidFields){var fields=this.state.fields;var warnings=invalidFields.map(function(fieldName){var fieldStr=fields[fieldName].string;return _.str.sprintf('<li>%s</li>',_.escape(fieldStr));});warnings.unshift('<ul>');warnings.push('</ul>');this.do_warn(_t("The following fields are invalid:"),warnings.join(''));},_onClickAttachDocument:function(ev){if($(ev.target).is('input.o_input_file')){return;}
var fieldNames=this.getParent().canBeSaved(this.state.id);if(fieldNames.length){return this._notifyInvalidFields(fieldNames);}
if(!this.res_id){return this.do_warn(_t('Warning : You have to save first before attaching a file.'));}
this.$('input.o_input_file').trigger('click');},_onFileChanged:function(ev){ev.stopPropagation();this.$('form.o_form_binary_form').trigger('submit');framework.blockUI();},_onFileLoaded:function(){var self=this;var files=Array.prototype.slice.call(arguments,1);return new Promise(function(resolve){if(self.node.attrs.action){self._rpc({model:self.res_model,method:self.node.attrs.action,args:[self.res_id],kwargs:{attachment_ids:_.map(files,function(file){return file.id;}),}}).then(function(){resolve();});}else{resolve();}}).then(function(){self.trigger_up('reload');framework.unblockUI();});},});widgetRegistry.add('attach_document',AttachDocument);});;

/* /web/static/src/js/fields/signature.js defined in bundle 'web.assets_backend' */
odoo.define('web.Signature',function(require){"use strict";var AbstractFieldBinary=require('web.basic_fields').AbstractFieldBinary;var core=require('web.core');var Dialog=require('web.Dialog');var field_utils=require('web.field_utils');var NameAndSignature=require('web.name_and_signature').NameAndSignature;var registry=require('web.field_registry');var session=require('web.session');var utils=require('web.utils');var qweb=core.qweb;var _t=core._t;var _lt=core._lt;var SignatureDialog=Dialog.extend({template:'web.signature_dialog',xmlDependencies:Dialog.prototype.xmlDependencies.concat(['/web/static/src/xml/name_and_signature.xml']),custom_events:{'signature_changed':'_onChangeSignature',},init:function(parent,options){var self=this;options=options||{};options.title=options.title||_t("Adopt Your Signature");options.size=options.size||'medium';options.technical=false;if(!options.buttons){options.buttons=[];options.buttons.push({text:_t("Adopt and Sign"),classes:"btn-primary",disabled:true,click:function(e){self._onConfirm();}});options.buttons.push({text:_t("Cancel"),close:true});}
this._super(parent,options);this.nameAndSignature=new NameAndSignature(this,options.nameAndSignatureOptions);},willStart:function(){return Promise.all([this.nameAndSignature.appendTo($('<div>')),this._super.apply(this,arguments)]);},start:function(){var self=this;this.$primaryButton=this.$footer.find('.btn-primary');this.opened().then(function(){self.$('.o_web_sign_name_and_signature').replaceWith(self.nameAndSignature.$el);self.nameAndSignature.resetSignature();});return this._super.apply(this,arguments);},isSignatureEmpty:function(){return this.nameAndSignature.isSignatureEmpty();},_onChangeSignature:function(){var isEmpty=this.nameAndSignature.isSignatureEmpty();this.$primaryButton.prop('disabled',isEmpty);},_onConfirm:function(fct){this.trigger_up('upload_signature',{name:this.nameAndSignature.getName(),signatureImage:this.nameAndSignature.getSignatureImage(),});},});var FieldBinarySignature=AbstractFieldBinary.extend({description:_lt("Signature"),fieldDependencies:_.extend({},AbstractFieldBinary.prototype.fieldDependencies,{__last_update:{type:'datetime'},}),resetOnAnyFieldChange:true,custom_events:_.extend({},AbstractFieldBinary.prototype.custom_events,{upload_signature:'_onUploadSignature',}),events:_.extend({},AbstractFieldBinary.prototype.events,{'click .o_signature':'_onClickSignature',}),template:null,supportedFieldTypes:['binary'],file_type_magic_word:{'/':'jpg','R':'gif','i':'png','P':'svg+xml',},isSet:function(){if(this.mode==='edit'){return this.value;}
return true;},_render:function(){var self=this;var displaySignatureRatio=3;var url;var $img;var width=this.nodeOptions.size?this.nodeOptions.size[0]:this.attrs.width;var height=this.nodeOptions.size?this.nodeOptions.size[1]:this.attrs.height;if(this.value){if(!utils.is_bin_size(this.value)){url='data:image/'+(this.file_type_magic_word[this.value[0]]||'png')+';base64,'+this.value;}else{url=session.url('/web/image',{model:this.model,id:JSON.stringify(this.res_id),field:this.nodeOptions.preview_image||this.name,unique:field_utils.format.datetime(this.recordData.__last_update).replace(/[^0-9]/g,''),});}
$img=$(qweb.render("FieldBinarySignature-img",{widget:this,url:url}));}else{$img=$('<div class="o_signature o_signature_empty"><svg></svg><p>'+_t('SIGNATURE')+'</p></div>');if(width&&height){width=Math.min(width,displaySignatureRatio*height);height=width/displaySignatureRatio;}else if(width){height=width/displaySignatureRatio;}else if(height){width=height*displaySignatureRatio;}}
if(width){$img.attr('width',width);$img.css('max-width',width+'px');}
if(height){$img.attr('height',height);$img.css('max-height',height+'px');}
this.$('> div').remove();this.$('> img').remove();this.$el.prepend($img);$img.on('error',function(){self._clearFile();$img.attr('src',self.placeholder);self.do_warn(_t("Image"),_t("Could not display the selected image."));});},_onClickSignature:function(){var self=this;if(this.mode==='edit'){var nameAndSignatureOptions={mode:'draw',displaySignatureRatio:3,signatureType:'signature',noInputName:true,};if(this.nodeOptions.full_name){var signName;if(this.fields[this.nodeOptions.full_name].type==='many2one'){signName=this.recordData[this.nodeOptions.full_name]&&this.recordData[this.nodeOptions.full_name].data.display_name;}else{signName=this.recordData[this.nodeOptions.full_name];}
nameAndSignatureOptions.defaultName=(signName==='')?undefined:signName;}
nameAndSignatureOptions.defaultFont=this.nodeOptions.default_font||'';this.signDialog=new SignatureDialog(self,{nameAndSignatureOptions:nameAndSignatureOptions});this.signDialog.open();}},_onUploadSignature:function(ev){var signatureImage=ev.data.signatureImage;if(signatureImage!==this.signDialog.emptySignature){var data=signatureImage[1];var type=signatureImage[0].split('/')[1];this.on_file_uploaded(data.length,ev.data.name,type,data);}
this.signDialog.close();}});registry.add('signature',FieldBinarySignature);});;

/* /web/static/src/js/report/utils.js defined in bundle 'web.assets_backend' */
odoo.define('report.utils',function(require){'use strict';function get_protocol_from_url(url){var a=document.createElement('a');a.href=url;return a.protocol;}
function get_host_from_url(url){var a=document.createElement('a');a.href=url;return a.host;}
function build_origin(protocol,host){return protocol+'//'+host;}
return{'get_protocol_from_url':get_protocol_from_url,'get_host_from_url':get_host_from_url,'build_origin':build_origin,};});;

/* /web/static/src/js/report/client_action.js defined in bundle 'web.assets_backend' */
odoo.define('report.client_action',function(require){'use strict';var AbstractAction=require('web.AbstractAction');var core=require('web.core');var session=require('web.session');var utils=require('report.utils');var QWeb=core.qweb;var AUTHORIZED_MESSAGES=['report:do_action',];var ReportAction=AbstractAction.extend({hasControlPanel:true,contentTemplate:'report.client_action',init:function(parent,action,options){this._super.apply(this,arguments);options=options||{};this.action_manager=parent;this._title=options.display_name||options.name;this.report_url=options.report_url;this.report_name=options.report_name;this.report_file=options.report_file;this.data=options.data||{};this.context=options.context||{};},start:function(){var self=this;this.iframe=this.$('iframe')[0];return Promise.all([this._super.apply(this,arguments),session.is_bound]).then(function(){var web_base_url=session['web.base.url'];var trusted_host=utils.get_host_from_url(web_base_url);var trusted_protocol=utils.get_protocol_from_url(web_base_url);self.trusted_origin=utils.build_origin(trusted_protocol,trusted_host);self.$buttons=$(QWeb.render('report.client_action.ControlButtons',{}));self.$buttons.on('click','.o_report_print',self.on_click_print);self._update_control_panel();self.iframe.src=self.report_url;});},do_show:function(){this._update_control_panel();return this._super.apply(this,arguments);},on_attach_callback:function(){$(window).on('message',this,this.on_message_received);},on_detach_callback:function(){$(window).off('message',this.on_message_received);},_update_control_panel:function(){this.updateControlPanel({cp_content:{$buttons:this.$buttons,},});},on_message_received:function(ev){var message_origin=utils.build_origin(ev.originalEvent.source.location.protocol,ev.originalEvent.source.location.host);if(message_origin===this.trusted_origin){var message=ev.originalEvent.data;if(_.isObject(message)){message=message.message;}
if(!_.isString(message)||(_.isString(message)&&!_.contains(AUTHORIZED_MESSAGES,message))){return;}
switch(message){case'report:do_action':return this.do_action(ev.originalEvent.data.action);default:}}},_post_message:function(message){this.iframe.contentWindow.postMessage(message,this.trusted_origin);},on_click_print:function(){var action={'type':'ir.actions.report','report_type':'qweb-pdf','report_name':this.report_name,'report_file':this.report_file,'data':this.data,'context':this.context,'display_name':this.title,};return this.do_action(action);},});core.action_registry.add('report.client_action',ReportAction);return ReportAction;});;

/* /web_mobile/static/src/js/core/mixins.js defined in bundle 'web.assets_backend' */
odoo.define('web_mobile.mixins',function(require){"use strict";var mobile=require('web_mobile.rpc');var backButtonEventListeners=[];function onGlobalBackButton(){var listener=backButtonEventListeners[backButtonEventListeners.length-1];if(listener){listener._onBackButton.apply(listener,arguments);}}
var BackButtonEventMixin={on_attach_callback:function(){if(mobile.methods.overrideBackButton){backButtonEventListeners.push(this);if(backButtonEventListeners.length===1){document.addEventListener('backbutton',onGlobalBackButton);mobile.methods.overrideBackButton({enabled:true});}}},on_detach_callback:function(){if(mobile.methods.overrideBackButton){backButtonEventListeners=_.without(backButtonEventListeners,this);if(backButtonEventListeners.length===0){document.removeEventListener('backbutton',onGlobalBackButton);mobile.methods.overrideBackButton({enabled:false});}}},_onBackButton:function(){},};return{BackButtonEventMixin:BackButtonEventMixin,};});;

/* /web_mobile/static/src/js/core/dialog.js defined in bundle 'web.assets_backend' */
odoo.define('web_mobile.Dialog',function(require){"use strict";var Dialog=require('web.Dialog');var mobileMixins=require('web_mobile.mixins');Dialog.include(_.extend({},mobileMixins.BackButtonEventMixin,{willStart:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.$modal.on('hidden.bs.modal',self.on_detach_callback.bind(self));});},opened:function(){return this._super.apply(this,arguments).then(this.on_attach_callback.bind(this));},_onBackButton:function(){this.close();},}));});;

/* /web_mobile/static/src/js/action_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web_mobile.ActionManager',function(require){"use strict";var ActionManager=require('web.ActionManager');var mobile=require('web_mobile.rpc');ActionManager.include({ir_actions_act_url:function(action){var url=action.url;var result=this._super.apply(this,arguments);if(!_.isEmpty(mobile.methods)&&!url.startsWith("/web")){return Promise.resolve();}
return result;},});});;

/* /web_mobile/static/src/js/barcode_fields.js defined in bundle 'web.assets_backend' */
odoo.define('web_mobile.barcode_fields',function(require){"use strict";var field_registry=require('web.field_registry');require('web._field_registry');var relational_fields=require('web.relational_fields');var mobile=require('web_mobile.rpc');var FieldMany2OneBarcode=relational_fields.FieldMany2One.extend({template:"FieldMany2OneBarcode",events:_.extend({},relational_fields.FieldMany2One.prototype.events,{'click .o_barcode_mobile':'_onBarcodeButtonClick',}),start:function(){var result=this._super.apply(this,arguments);this._startBarcode();return result;},_isExternalButtonVisible:function(){return this.$external_button.is(':visible');},_renderEdit:function(){this._super.apply(this,arguments);if(this.$barcode_button){this.$barcode_button.toggle(!this._isExternalButtonVisible());}},_startBarcode:function(){this.$barcode_button=this.$('.o_barcode_mobile');this.$barcode_button.toggle(!this.isSet());},_onBarcodeButtonClick:function(){var self=this;mobile.methods.scanBarcode().then(function(response){var barcode=response.data;if(barcode){self._onBarcodeScanned(barcode);mobile.methods.vibrate({duration:100,});}else{mobile.methods.showToast({message:'Please, scan again !!',});}});},_onBarcodeScanned:function(barcode){this._search(barcode);},});if(mobile.methods.scanBarcode){field_registry.add('many2one_barcode',FieldMany2OneBarcode);}
return FieldMany2OneBarcode;});;

/* /web_mobile/static/src/js/contact_sync.js defined in bundle 'web.assets_backend' */
odoo.define('web_mobile.ContactSync',function(require){"use strict";var Widget=require('web.Widget');var mobile=require('web_mobile.rpc');var ContactSync=Widget.extend({template:'ContactSync',events:{'click':'_onClick',},init:function(parent,params){this.res_id=params.res_id;this.res_model=params.res_model;this.is_mobile=mobile.methods.addContact;return this._super.apply(this,arguments);},_onClick:function(){var fieldNames=['name','image_1920','parent_id','phone','mobile','email','street','street2','city','state_id','zip','country_id','website','function',];this._rpc({model:this.res_model,method:'read',args:[this.res_id,fieldNames],}).then(function(r){const contact=Object.assign({},r[0],{image:r[0].image_1920,});delete contact.image_1920;mobile.methods.addContact(contact);});},});return ContactSync;});;

/* /web_mobile/static/src/js/crash_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web_mobile.CrashManager',function(require){"use strict";var CrashManager=require('web.CrashManager').CrashManager;var mobile=require('web_mobile.rpc');CrashManager.include({rpc_error:function(error){if(mobile.methods.crashManager){mobile.methods.crashManager(error);}
return this._super.apply(this,arguments);},});});;

/* /web_mobile/static/src/js/datepicker.js defined in bundle 'web.assets_backend' */
odoo.define('web_mobile.datepicker',function(require){"use strict";var config=require('web.config');var mobile=require('web_mobile.rpc');var web_datepicker=require('web.datepicker');var Widget=require('web.Widget');web_datepicker.DateWidget.include({start:function(){if(!mobile.methods.requestDateTimePicker||(this.type_of_date==='datetime'&&config.device.isIOS)){return this._super.apply(this,arguments);}
this.$input=this.$('input.o_datepicker_input');this.$input.removeClass('datetimepicker-input')
this._setupMobilePicker();},destroy:function(){if(!mobile.methods.requestDateTimePicker||(this.type_of_date==='datetime'&&config.device.isIOS)){return this._super.apply(this,arguments);}
Widget.prototype.destroy.apply(this,arguments);},maxDate:function(){if(!mobile.methods.requestDateTimePicker||(this.type_of_date==='datetime'&&config.device.isIOS)){return this._super.apply(this,arguments);}
console.warn('Unsupported in the mobile applications');},minDate:function(){if(!mobile.methods.requestDateTimePicker||(this.type_of_date==='datetime'&&config.device.isIOS)){return this._super.apply(this,arguments);}
console.warn('Unsupported in the mobile applications');},_setLibInputValue:function(){if(!mobile.methods.requestDateTimePicker||(this.type_of_date==='datetime'&&config.device.isIOS)){return this._super.apply(this,arguments);}},_setupMobilePicker:function(){var self=this;this.$el.on('click',function(){mobile.methods.requestDateTimePicker({'value':self.getValue()?self.getValue().format("YYYY-MM-DD HH:mm:ss"):false,'type':self.type_of_date,'ignore_timezone':true,}).then(function(response){self.$input.val(response.data);self.changeDatetime();});});},_onInputClicked:function(){if(!mobile.methods.requestDateTimePicker){return this._super.apply(this,arguments);}},});});;

/* /web_mobile/static/src/js/form_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web_mobile.FormRenderer',function(require){"use strict";var FormRenderer=require('web.FormRenderer');var ContactSync=require('web_mobile.ContactSync');FormRenderer.include({_renderTagContactsync:function(node){var $el=$('<div>');var widget=new ContactSync(this,{res_id:this.state.res_id,res_model:this.state.model,});var prom=widget._widgetRenderAndInsert(function(){});prom.then(()=>{this._registerModifiers(node,this.state,widget);$el.replaceWith(widget.$el);});this.widgets.push(widget);this.defs.push(prom);return $el;},});});;

/* /web_mobile/static/src/js/form_view.js defined in bundle 'web.assets_backend' */
odoo.define('web_mobile.FormView',function(require){"use strict";var config=require('web.config');var FormView=require('web.FormView');var QuickCreateFormView=require('web.QuickCreateFormView');FormView.include({init:function(){this._super.apply(this,arguments);if(config.device.isMobile){this.controllerParams.disableAutofocus=true;}},});QuickCreateFormView.include({init:function(){this._super.apply(this,arguments);this.controllerParams.disableAutofocus=false;},});});;

/* /web_mobile/static/src/js/notification_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web_mobile.notification_manager',function(require){"use strict";var NotificationService=require('web.NotificationService');var mobile=require('web_mobile.rpc');NotificationService.include({notify:function(){if(mobile.methods.vibrate){mobile.methods.vibrate({'duration':100});}
return this._super.apply(this,arguments);},});});;

/* /web_mobile/static/src/js/pivot_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web_mobile.PivotController',function(require){'use strict';var config=require('web.config');if(!config.device.isMobile){return;}
var PivotController=require('web.PivotController');PivotController.include({_removePseudoCssClass:function(node){var $node=$(node);var $original=$node.clone(true);$node.replaceWith($original);},_renderGroupBySelection:function(){this._super.apply(this,arguments);this.$('.o_pivot_header_cell_opened,.o_pivot_header_cell_closed').tooltip('hide');},_onGroupByMenuSelection:function(ev){var $parent=$(ev.target).closest('.o_pivot_field_menu');if($parent.length){var currentMenu=$parent.get(0).querySelector('.dropdown-item:hover');if(currentMenu===ev.target){var parentNodeItem=currentMenu.parentNode;if(parentNodeItem&&parentNodeItem.classList.contains('o_inline_dropdown')){if(currentMenu.classList.contains('o_dropdown_open')){currentMenu.classList.remove('o_dropdown_open');this._removePseudoCssClass(currentMenu);}else{currentMenu.classList.add('o_dropdown_open');}
ev.stopPropagation();return false;}}}
return this._super.apply(this,arguments);},});});;

/* /web_mobile/static/src/js/rpc.js defined in bundle 'web.assets_backend' */
odoo.define('web_mobile.rpc',function(){"use strict";var available=typeof OdooDeviceUtility!=='undefined';var DeviceUtility;var deferreds={};var methods={};if(available){DeviceUtility=OdooDeviceUtility;delete window.OdooDeviceUtility;}
function native_invoke(name,args){if(_.isUndefined(args)){args={};}
var id=_.uniqueId();var def=new Promise(function(resolve,reject){deferreds[id]={successCallback:function(success){resolve(success);},errorCallback:function(error){reject(error);}};});args=JSON.stringify(args);DeviceUtility.execute(name,args,id);return def;}
window.odoo.native_notify=function(id,result){if(deferreds.hasOwnProperty(id)){if(result.success){deferreds[id].successCallback(result);}else{deferreds[id].errorCallback(result);}}};var plugins=available?JSON.parse(DeviceUtility.list_plugins()):[];_.each(plugins,function(plugin){methods[plugin.name]=function(args){return native_invoke(plugin.action,args);};});return{'methods':methods};});;

/* /web_mobile/static/src/js/session.js defined in bundle 'web.assets_backend' */
odoo.define('web_mobile.session',function(require){"use strict";var core=require('web.core');var session=require('web.Session');var mobile=require('web_mobile.rpc');session.include({get_file:function(options){if(mobile.methods.downloadFile){if(core.csrf_token){options.csrf_token=core.csrf_token;}
mobile.methods.downloadFile(options);if(options.success){options.success();}
if(options.complete){options.complete();}
return true;}else{return this._super.apply(this,arguments);}},});});;

/* /web_mobile/static/src/js/user_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web_mobile.user_menu',function(require){"use strict";var core=require('web.core');var UserMenu=require('web.UserMenu');var web_client=require('web.web_client');var mobile=require('web_mobile.rpc');var _t=core._t;UserMenu.include({start:function(){var self=this;return this._super.apply(this,arguments).then(function(){if(mobile.methods.switchAccount){self.$('a[data-menu="logout"]').addClass('d-none');self.$('a[data-menu="account"]').addClass('d-none');self.$('a[data-menu="switch"]').removeClass('d-none');}
if(mobile.methods.addHomeShortcut){self.$('a[data-menu="shortcut"]').removeClass('d-none');}});},_onMenuSwitch:function(){mobile.methods.switchAccount();},_onMenuShortcut:function(){var urlData=$.bbq.getState();if(urlData.menu_id){var menus=web_client.menu_data;var menu=_.filter(menus.children,function(child){return child.id===parseInt(urlData.menu_id);});mobile.methods.addHomeShortcut({'title':document.title,'shortcut_url':document.URL,'web_icon':menu&&menu[0].web_icon_data});}else{mobile.methods.showToast({"message":_t("No shortcut for Home Menu")});}},});});;

/* /web_mobile/static/src/js/views/control_panel/control_panel_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web_mobile.ControlPanelRenderer',function(require){"use strict";var config=require('web.config');var ControlPanelController=require('web.ControlPanelController');if(!config.device.isMobile){return;}
ControlPanelController.include({SCROLL_DIRECTION:Object.freeze({UP:-1,NONE:0,DOWN:1}),init:function(){this._super.apply(this,arguments);this._throttleMoveControlPanel=_.throttle(this._throttleMoveControlPanel.bind(this),1);},on_attach_callback:function(){if(this._isControlPanel()){this._initScrollControlPanel();document.addEventListener('scroll',this._throttleMoveControlPanel);}
this._super.apply(this,arguments);},on_detach_callback:function(){document.removeEventListener('scroll',this._throttleMoveControlPanel);this._super.apply(this,arguments);},_getControlPanelTop:function(){var pixelRegex=/(-?\d+)px/;var topString=this.el.style.top;var match=pixelRegex.exec(topString);return match?parseInt(match[1],10):undefined;},_getDeltaScroll:function(scrollPosition){return Math.round(scrollPosition-this.oldScrollPositionY);},_getDirection:function(scrollDelta){if(scrollDelta>0){return this.SCROLL_DIRECTION.DOWN;}else if(scrollDelta<0){return this.SCROLL_DIRECTION.UP;}
return this.SCROLL_DIRECTION.NONE;},_hideControlPanelBy:function(delta){var top=this._getControlPanelTop();var controlPanelHeight=this.el.clientHeight;this._setControlPanelTop(Math.max(-controlPanelHeight,top+delta));},_initScrollControlPanel:function(){this.el.style.top='0px';this.oldScrollPositionY=0;this.controlPanelInitialPositionY=this.el.offsetTop;},_isControlPanel:function(){return this.el.querySelector('.o_control_panel')!==null;},_setControlPanelTop:function(top){this.el.style.top=top+'px';},_showControlPanelBy:function(delta){var top=this._getControlPanelTop();this._setControlPanelTop(Math.min(0,top+delta));},_throttleMoveControlPanel:function(){var scrollPosition=document.documentElement.scrollTop||window.pageYOffset;var deltaScroll=this._getDeltaScroll(scrollPosition);var directionScroll=this._getDirection(deltaScroll);var stickyClass='o_mobile_sticky';if(scrollPosition>this.controlPanelInitialPositionY){this.el.classList.add(stickyClass);if(directionScroll===this.SCROLL_DIRECTION.UP){this._showControlPanelBy(-deltaScroll);}else{this._hideControlPanelBy(-deltaScroll);}}else{if(this.el.classList.contains(stickyClass)){this.el.classList.remove(stickyClass);}}
this.oldScrollPositionY=scrollPosition;},});});;

/* /hibou_professional/static/src/js/core.js defined in bundle 'web.assets_backend' */
odoo.define('hibou_professional.core',function(require){"use strict";var Widget=require('web.Widget');var SystrayMenu=require('web.SystrayMenu');var HibouProfessionalSystrayWidget=Widget.extend({template:'HibouProfessionalSystrayWidget',start:function(){var self=this;self.expiration_date=false;self.expiration_reason=false;self.professional_code=false;this.types=[['lead','Sales'],['ticket','Support']];this.message_subjects={'lead':[],'ticket':[],'task':[]};self.expiring=false;self.expired=false;self.dbuuid=false;self.quote_url=false;self.is_admin=false;self.allow_admin_message=false;self.allow_message=false;this._rpc({model:'publisher_warranty.contract',method:'hibou_professional_status',}).then(function(result){self.handleStatusUpdate(result);});return this._super();},get_subjects:function(type){if(this.message_subjects&&this.message_subjects[type]){return this.message_subjects[type]}
return[];},set_error:function(error){this.$('.hibou_professional_error').text(error);},update_message_type:function(el){var selected_type=this.$('select.hibou_message_type').val();if(selected_type&&this.$('.hibou_subject_selection_option.'+selected_type).length>0){this.$('#hibou_subject_selection').show();this.$('.hibou_subject_selection_option').hide().attr('disabled',true);this.$('.hibou_subject_selection_option.'+selected_type).show().attr('disabled',false);var selected_subject=this.$('.hibou_subject_selection_option.'+selected_type)[0];this.$('select.hibou_subject_selection').val(selected_subject.value);}else if(selected_type){this.$('select.hibou_subject_selection').val('0');this.$('#hibou_subject_selection').hide();}else{this.$('#hibou_subject_selection').hide();this.$('#hibou_message_priority').hide();this.$('#hibou_message_subject').hide();}
this.update_subject_selection();},update_subject_selection:function(el){var selected_subject=this.$('select.hibou_subject_selection').val();if(selected_subject=='0'){this.$('#hibou_message_priority').show();this.$('#hibou_message_subject').show();}else{this.$('#hibou_message_priority').hide();this.$('#hibou_message_subject').hide();}},update_message_subjects:function(subjects_by_type){this.message_subjects=subjects_by_type;this.renderElement();},button_update_subscription:function(){var self=this;var professional_code=self.$('input.hibou_professional_code').val();if(!professional_code){alert('Please enter a subscription code first.');return;}
self.$('.update_subscription').prop('disabled','disabled');self._rpc({model:'publisher_warranty.contract',method:'hibou_professional_update',args:[professional_code],}).then(function(result){self.$('.update_subscription').prop('disabled',false);self.handleStatusUpdate(result);});},button_update_message_preferences:function(){var self=this;var allow_admin_message=self.$('input.hibou_allow_admin_message').prop('checked');var allow_message=self.$('input.hibou_allow_message').prop('checked');self.$('.update_message_preferences').prop('disabled','disabled');self._rpc({model:'publisher_warranty.contract',method:'hibou_professional_update_message_preferences',args:[allow_admin_message,allow_message],}).then(function(result){self.$('.update_message_preferences').prop('disabled',false);self.handleStatusUpdate(result);});},button_quote:function(){var self=this;var message_p=self.$('.button-quote-link p');message_p.text('Retrieving URL...');self._rpc({model:'publisher_warranty.contract',method:'hibou_professional_quote',}).then(function(result){if(result&&result['url']){self.quote_url=result.url
self.$('.button-quote-link').attr('href',self.quote_url);message_p.text('Quote URL ready. Click again!');}else{message_p.text('Error with quote url.  Maybe the database token is incorrect.');}});},button_send_message:function(){var self=this;var message_type=self.$('select.hibou_message_type').val();var message_priority=self.$('select.hibou_message_priority').val();var message_subject=self.$('input.hibou_message_subject').val();var message_subject_id=self.$('select.hibou_subject_selection').val();var current_url=window.location.href;if(message_subject_id=='0'&&(!message_subject||message_subject.length<3)){alert('Please enter a longer subject.');return;}
var message_body=self.$('textarea.hibou_message_body').val();self.$('.hibou_send_message').prop('disabled','disabled');self._rpc({model:'publisher_warranty.contract',method:'hibou_professional_send_message',args:[message_type,message_priority,message_subject,message_body,current_url,message_subject_id],}).then(function(result){self.$('.hibou_send_message').prop('disabled',false);var message_response=self.$('.hibou_message_response');var access_link=self.$('.hibou_message_response a');var message_form=self.$('.hibou_message_form');if(!result){access_link.text('An error has occured.')}else{if(result.error){access_link.text(result.error);}else{access_link.text(result.message||'Your message has been received.')}
if(result.access_url){access_link.attr('href',result.access_url);}}
message_response.show();message_form.hide();});},button_get_messages:function(){var self=this;var $button=this.$('.hibou_get_messages');$button.prop('disabled','disabled');self._rpc({model:'publisher_warranty.contract',method:'hibou_professional_get_messages',args:[],}).then(function(result){$button.prop('disabled',false);if(result['message_subjects']){self.update_message_subjects(result.message_subjects);setTimeout(function(){self.$('.dropdown-toggle').click();},100);}else if(result['error']){self.set_error(result['error']);}});},renderElement:function(){var self=this;this._super();this.update_message_type();this.update_subject_selection();this.$('select.hibou_message_type').on('change',function(el){self.update_message_type(el);});this.$('select.hibou_subject_selection').on('change',function(el){self.update_subject_selection(el);});this.$('.update_subscription').on('click',function(e){e.preventDefault();e.stopPropagation();self.button_update_subscription();});this.$('.hibou_get_messages').on('click',function(e){e.preventDefault();e.stopPropagation();self.button_get_messages();});this.$('.button-quote-link').on('click',function(e){if(self.quote_url){return;}
e.preventDefault();e.stopPropagation();self.button_quote();});this.$('.update_message_preferences').on('click',function(e){e.preventDefault();e.stopPropagation();self.button_update_message_preferences();});this.$('.hibou_send_message').on('click',function(e){e.preventDefault();e.stopPropagation();self.button_send_message();});this.$('.hibou_message_form_container').on('click',function(e){e.stopPropagation();})},handleStatusUpdate:function(status){this.expiration_date=status.expiration_date;this.expiration_reason=status.expiration_reason;this.professional_code=status.professional_code;this.types=[['lead','Sales'],['ticket','Support']];if(this.professional_code){this.types.push(['task','Project Manager/Developer'])}
this.expiring=status.expiring;this.expired=status.expired;this.dbuuid=status.dbuuid;this.is_admin=status.is_admin;this.allow_admin_message=status.allow_admin_message;this.allow_message=status.allow_message;this.renderElement();},});SystrayMenu.Items.push(HibouProfessionalSystrayWidget);return{HibouProfessionalSystrayWidget:HibouProfessionalSystrayWidget,};});;

/* /base_import/static/lib/javascript-state-machine/state-machine.js defined in bundle 'web.assets_backend' */
(function(window){StateMachine={VERSION:"2.1.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,ASYNC:4,},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300,},WILDCARD:'*',ASYNC:'async',create:function(cfg,target){var initial=(typeof cfg.initial=='string')?{state:cfg.initial}:cfg.initial;var fsm=target||cfg.target||{};var events=cfg.events||[];var callbacks=cfg.callbacks||{};var map={};var add=function(e){var from=(e.from instanceof Array)?e.from:(e.from?[e.from]:[StateMachine.WILDCARD]);map[e.name]=map[e.name]||{};for(var n=0;n<from.length;n++)
map[e.name][from[n]]=e.to||from[n];};if(initial){initial.event=initial.event||'startup';add({name:initial.event,from:'none',to:initial.state});}
for(var n=0;n<events.length;n++)
add(events[n]);for(var name in map){if(map.hasOwnProperty(name))
fsm[name]=StateMachine.buildEvent(name,map[name]);}
for(var name in callbacks){if(callbacks.hasOwnProperty(name))
fsm[name]=callbacks[name]}
fsm.current='none';fsm.is=function(state){return this.current==state;};fsm.can=function(event){return!this.transition&&(map[event].hasOwnProperty(this.current)||map[event].hasOwnProperty(StateMachine.WILDCARD));}
fsm.cannot=function(event){return!this.can(event);};fsm.error=cfg.error||function(name,from,to,args,error,msg){throw msg;};if(initial&&!initial.defer)
fsm[initial.event]();return fsm;},doCallback:function(fsm,func,name,from,to,args){if(func){try{return func.apply(fsm,[name,from,to].concat(args));}
catch(e){return fsm.error(name,from,to,args,StateMachine.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function");}}},beforeEvent:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onbefore'+name],name,from,to,args);},afterEvent:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onafter'+name]||fsm['on'+name],name,from,to,args);},leaveState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onleave'+from],name,from,to,args);},enterState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onenter'+to]||fsm['on'+to],name,from,to,args);},changeState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onchangestate'],name,from,to,args);},buildEvent:function(name,map){return function(){var from=this.current;var to=map[from]||map[StateMachine.WILDCARD]||from;var args=Array.prototype.slice.call(arguments);if(this.transition)
return this.error(name,from,to,args,StateMachine.Error.PENDING_TRANSITION,"event "+name+" inappropriate because previous transition did not complete");if(this.cannot(name))
return this.error(name,from,to,args,StateMachine.Error.INVALID_TRANSITION,"event "+name+" inappropriate in current state "+this.current);if(false===StateMachine.beforeEvent(this,name,from,to,args))
return StateMachine.CANCELLED;if(from===to){StateMachine.afterEvent(this,name,from,to,args);return StateMachine.NOTRANSITION;}
var fsm=this;this.transition=function(){fsm.transition=null;fsm.current=to;StateMachine.enterState(fsm,name,from,to,args);StateMachine.changeState(fsm,name,from,to,args);StateMachine.afterEvent(fsm,name,from,to,args);};var leave=StateMachine.leaveState(this,name,from,to,args);if(false===leave){this.transition=null;return StateMachine.CANCELLED;}
else if("async"===leave){return StateMachine.ASYNC;}
else{if(this.transition)
this.transition();return StateMachine.SUCCEEDED;}};}};if("function"===typeof define){define("statemachine",[],function(){return StateMachine;});}
else{window.StateMachine=StateMachine;}}(this));;

/* /base_import/static/src/js/import_action.js defined in bundle 'web.assets_backend' */
odoo.define('base_import.import',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var config=require('web.config');var core=require('web.core');var session=require('web.session');var time=require('web.time');var AbstractWebClient=require('web.AbstractWebClient');var Loading=require('web.Loading');var QWeb=core.qweb;var _t=core._t;var _lt=core._lt;var StateMachine=window.StateMachine;function jsonp(form,attributes,callback){attributes=attributes||{};var options={jsonp:_.uniqueId('import_callback_')};window[options.jsonp]=function(){delete window[options.jsonp];callback.apply(null,arguments);};if('data'in attributes){_.extend(attributes.data,options);}else{_.extend(attributes,{data:options});}
_.extend(attributes,{dataType:'script',});$(form).ajaxSubmit(attributes);}
function _make_option(term){return{id:term,text:term};}
function _from_data(data,term){return _.findWhere(data,{id:term})||_make_option(term);}
function dataFilteredQuery(q){var suggestions=_.clone(this.data);if(q.term){var exact=_.filter(suggestions,function(s){return s.id===q.term||s.text===q.term;});if(exact.length){suggestions=exact;}else{suggestions=[_make_option(q.term)].concat(_.filter(suggestions,function(s){return s.id.indexOf(q.term)!==-1||s.text.indexOf(q.term)!==-1}));}}
q.callback({results:suggestions});}
var DataImport=AbstractAction.extend({hasControlPanel:true,contentTemplate:'ImportView',opts:[{name:'encoding',label:_lt("Encoding:"),value:''},{name:'separator',label:_lt("Separator:"),value:''},{name:'quoting',label:_lt("Text Delimiter:"),value:'"'}],parse_opts_formats:[{name:'date_format',label:_lt("Date Format:"),value:''},{name:'datetime_format',label:_lt("Datetime Format:"),value:''},],parse_opts_separators:[{name:'float_thousand_separator',label:_lt("Thousands Separator:"),value:','},{name:'float_decimal_separator',label:_lt("Decimal Separator:"),value:'.'}],events:{'change .oe_import_file':'loaded_file','change input.oe_import_has_header, .js_import_options input':'settings_changed','change input.oe_import_advanced_mode':function(e){this.do_not_change_match=true;this['settings_changed']();},'click a.oe_import_toggle':function(e){e.preventDefault();this.$('.oe_import_options').toggle();},'click .oe_import_report a.oe_import_report_count':function(e){e.preventDefault();$(e.target).parent().parent().toggleClass('oe_import_report_showmore');},'click .oe_import_report_see_possible_value':function(e){e.preventDefault();$(e.target).parent().toggleClass('oe_import_report_showmore');},'click .oe_import_moreinfo_action a':function(e){e.preventDefault();var action=JSON.parse($(e.target).attr('data-action'));action.views=_(action.views).map(function(view){var id=view[0],type=view[1];return[id,type!=='tree'?type:action.view_type==='form'?'list':'tree'];});this.do_action(_.extend(action,{target:'new',flags:{search_view:true,display_title:true,pager:true,list:{selectable:false}}}));},},init:function(parent,action){this._super.apply(this,arguments);this.action_manager=parent;this.res_model=action.params.model;this.parent_context=action.params.context||{};this.id=null;this.session=session;this._title=_t('Import a File');this.do_not_change_match=false;},willStart:function(){var self=this;var def=this._rpc({model:this.res_model,method:'get_import_templates',context:this.parent_context,}).then(function(result){self.importTemplates=result;});return Promise.all([this._super.apply(this,arguments),def]);},start:function(){var self=this;this.$form=this.$('form');this.setup_encoding_picker();this.setup_separator_picker();this.setup_float_format_picker();this.setup_date_format_picker();return Promise.all([this._super(),self.create_model().then(function(id){self.id=id;self.$('input[name=import_id]').val(id);self.renderButtons();var status={cp_content:{$buttons:self.$buttons},};self.updateControlPanel(status);}),]);},create_model:function(){return this._rpc({model:'base_import.import',method:'create',args:[{res_model:this.res_model}],kwargs:{context:session.user_context},});},renderButtons:function(){var self=this;this.$buttons=$(QWeb.render("ImportView.buttons",this));this.$buttons.filter('.o_import_validate').on('click',this.validate.bind(this));this.$buttons.filter('.o_import_import').on('click',this.import.bind(this));this.$buttons.filter('.oe_import_file').on('click',function(){self.$('.o_content .oe_import_file').click();});this.$buttons.filter('.o_import_cancel').on('click',function(e){e.preventDefault();self.exit();});},setup_encoding_picker:function(){this.$('input.oe_import_encoding').select2({width:'50%',data:_.map(('utf-8 utf-16 windows-1252 latin1 latin2 big5 gb18030 shift_jis windows-1251 koir8_r').split(/\s+/),_make_option),query:dataFilteredQuery,initSelection:function($e,c){return c(_make_option($e.val()));}});},setup_separator_picker:function(){var data=[{id:',',text:_t("Comma")},{id:';',text:_t("Semicolon")},{id:'\t',text:_t("Tab")},{id:' ',text:_t("Space")}];this.$('input.oe_import_separator').select2({width:'50%',data:data,query:dataFilteredQuery,initSelection:function($e,c){c(_from_data(data,$e.val())||_make_option($e.val()))}});},setup_float_format_picker:function(){var data_decimal=[{id:',',text:_t("Comma")},{id:'.',text:_t("Dot")},];var data_digits=data_decimal.concat([{id:'',text:_t("No Separator")}]);this.$('input.oe_import_float_thousand_separator').select2({width:'50%',data:data_digits,query:dataFilteredQuery,initSelection:function($e,c){c(_from_data(data_digits,$e.val())||_make_option($e.val()))}});this.$('input.oe_import_float_decimal_separator').select2({width:'50%',data:data_decimal,query:dataFilteredQuery,initSelection:function($e,c){c(_from_data(data_decimal,$e.val())||_make_option($e.val()))}});},setup_date_format_picker:function(){var data=_(['YYYY-MM-DD','DD/MM/YY','DD/MM/YYYY','DD-MM-YYYY','DD-MMM-YY','DD-MMM-YYYY','MM/DD/YY','MM/DD/YYYY','MM-DD-YY','MM-DD-YYYY','DDMMYY','DDMMYYYY','YYMMDD','YYYYMMDD','YY/MM/DD','YYYY/MM/DD','MMDDYY','MMDDYYYY',]).map(_make_option);this.$('input.oe_import_date_format').select2({width:'50%',data:data,query:dataFilteredQuery,initSelection:function($e,c){c(_from_data(data,$e.val())||_make_option($e.val()));}})},import_options:function(){var self=this;var options={headers:this.$('input.oe_import_has_header').prop('checked'),advanced:this.$('input.oe_import_advanced_mode').prop('checked'),keep_matches:this.do_not_change_match,name_create_enabled_fields:{},skip:Number(this.$('#oe_import_row_start').val())-1||0,limit:Number(this.$('#oe_import_batch_limit').val())||null,};_(this.opts).each(function(opt){options[opt.name]=self.$('input.oe_import_'+opt.name).val();});_(this.parse_opts_formats).each(function(opt){options[opt.name]=time.moment_to_strftime_format(self.$('input.oe_import_'+opt.name).val());});_(this.parse_opts_separators).each(function(opt){options[opt.name]=self.$('input.oe_import_'+opt.name).val();});options['fields']=[];if(this.do_not_change_match){options['fields']=this.$('.oe_import_fields input.oe_import_match_field').map(function(index,el){return $(el).select2('val')||false;}).get();}
this.do_not_change_match=false;this.$('input.o_import_create_option').each(function(){var field=this.getAttribute('field');if(field){options.name_create_enabled_fields[field]=this.checked;}});return options;},onfile_loaded:function(event,from,to,arg){if(arg!=null){this.toggle_partial(null);}
this.$buttons.filter('.o_import_import, .o_import_validate').addClass('d-none');if(!this.$('input.oe_import_file').val()){return this['settings_changed']();}
this.$('.oe_import_date_format').select2('val','');this.$('.oe_import_datetime_format').val('');this.$form.removeClass('oe_import_preview oe_import_error');var import_toggle=false;var file=this.$('input.oe_import_file')[0].files[0];if((file.type&&_.last(file.type.split('/'))==="csv")||(_.last(file.name.split('.'))==="csv")){import_toggle=true;}
this.$form.find('.oe_import_box').toggle(import_toggle);jsonp(this.$form,{url:'/base_import/set_file'},this.proxy('settings_changed'));},onpreviewing:function(){var self=this;this.$buttons.filter('.o_import_import, .o_import_validate').addClass('d-none');this.$form.addClass('oe_import_with_file');this.$form.removeClass('oe_import_preview_error oe_import_error');this.$form.toggleClass('oe_import_noheaders text-muted',!this.$('input.oe_import_has_header').prop('checked'));self.$('input.oe_import_file').val('');this._rpc({model:'base_import.import',method:'parse_preview',args:[this.id,this.import_options()],kwargs:{context:session.user_context},}).then(function(result){var signal=result.error?'preview_failed':'preview_succeeded';self[signal](result);});},onpreview_error:function(event,from,to,result){this.$('.oe_import_options').show();this.$form.addClass('oe_import_preview_error oe_import_error');this.$form.find('.oe_import_box, .oe_import_with_file').removeClass('d-none');this.$form.find('.o_view_nocontent').addClass('d-none');this.$('.oe_import_error_report').html(QWeb.render('ImportView.preview.error',result));},onpreview_success:function(event,from,to,result){var self=this;this.$buttons.filter('.oe_import_file').text(_t('Load New File')).removeClass('btn-primary').addClass('btn-secondary').blur();this.$buttons.filter('.o_import_import, .o_import_validate').removeClass('d-none');this.$form.find('.oe_import_box, .oe_import_with_file').removeClass('d-none');this.$form.find('.o_view_nocontent').addClass('d-none');this.$form.addClass('oe_import_preview');this.$('input.oe_import_advanced_mode').prop('checked',result.advanced_mode);this.$('.oe_import_grid').html(QWeb.render('ImportView.preview',result));this.$('.o_import_batch_alert').toggleClass('d-none',!result.batch);var messages=[];if(result.headers.length===1){messages.push({type:'warning',message:_t("A single column was found in the file, this often means the file separator is incorrect")});}
if(!_.isEmpty(messages)){this.$('.oe_import_options').show();this.onresults(null,null,null,{'messages':messages});}
_.each(['encoding','separator','float_thousand_separator','float_decimal_separator'],function(id){self.$('.oe_import_'+id).select2('val',result.options[id])});this.$('.oe_import_date_format').select2('val',time.strftime_to_moment_format(result.options.date_format));this.$('.oe_import_datetime_format').val(time.strftime_to_moment_format(result.options.datetime_format));this.$('.oe_import_debug_option').toggleClass('d-none',!result.debug);var $fields=this.$('.oe_import_fields input');this.render_fields_matches(result,$fields);var data=this.generate_fields_completion(result);var item_finder=function(id,items){items=items||data;for(var i=0;i<items.length;++i){var item=items[i];if(item.id===id){return item;}
var val;if(item.children&&(val=item_finder(id,item.children))){return val;}}
return'';};$fields.each(function(k,v){var filtered_data=self.generate_fields_completion(result,k);var $thing=$();var bind=function(d){};if(config.isDebug()){$thing=$(QWeb.render('ImportView.create_record_option')).insertAfter(v).hide();bind=function(data){switch(data.type){case'many2one':case'many2many':$thing.find('input').attr('field',data.id);$thing.show();break;default:$thing.find('input').attr('field','').prop('checked',false);$thing.hide();}}}
$(v).select2({allowClear:true,minimumInputLength:0,data:filtered_data,initSelection:function(element,callback){var default_value=element.val();if(!default_value){callback('');return;}
var data=item_finder(default_value);bind(data);callback(data);},placeholder:_t('Don\'t import'),width:'resolve',dropdownCssClass:'oe_import_selector'}).on('change',function(e){bind(item_finder(e.currentTarget.value));});});},generate_fields_completion:function(root,index){var self=this;var basic=[];var regulars=[];var o2m=[];var headers_type=root.headers_type;function traverse(field,ancestors,collection,type){var subfields=field.fields;var advanced_mode=self.$('input.oe_import_advanced_mode').prop('checked');var field_path=ancestors.concat(field);var label=_(field_path).pluck('string').join(' / ');var id=_(field_path).pluck('name').join('/');if(type===undefined||(type!==undefined&&(type.indexOf('all')!==-1||type.indexOf(field['type'])!==-1))){if(!collection){if(field.name==='id'){collection=basic;}else if(_.isEmpty(subfields)||_.isEqual(_.pluck(subfields,'name'),['id','.id'])){collection=regulars;}else{collection=o2m;}}
collection.push({id:id,text:label,required:field.required,type:field.type});}
if(advanced_mode){for(var i=0,end=subfields.length;i<end;++i){traverse(subfields[i],field_path,collection,type);}}}
_(root.fields).each(function(field){if(index===undefined){traverse(field,[]);}
else{if(self.$('input.oe_import_advanced_mode').prop('checked')){traverse(field,[],undefined,['all']);}
else{traverse(field,[],undefined,headers_type[index]);}}});var cmp=function(field1,field2){return field1.text.localeCompare(field2.text);};regulars.sort(cmp);o2m.sort(cmp);if(!_.isEmpty(regulars)&&!_.isEmpty(o2m)){basic=basic.concat([{text:_t("Normal Fields"),children:regulars},{text:_t("Relation Fields"),children:o2m},]);}
else if(!_.isEmpty(regulars)){basic=basic.concat(regulars);}
else if(!_.isEmpty(o2m)){basic=basic.concat(o2m);}
return basic;},render_fields_matches:function(result,$fields){if(_(result.matches).isEmpty()){return;}
$fields.each(function(index,input){var match=result.matches[index];if(!match){return;}
var current_field=result;input.value=_(match).chain().map(function(name){return current_field=_(current_field.fields).find(function(subfield){return subfield.name===name;});}).pluck('name').value().join('/');});},call_import:function(kwargs){var fields=this.$('.oe_import_fields input.oe_import_match_field').map(function(index,el){return $(el).select2('val')||false;}).get();var columns=this.$('.oe_import_grid-header .oe_import_grid-cell .o_import_header_name').map(function(){return $(this).text().trim().toLowerCase()||false;}).get();var tracking_disable='tracking_disable'in kwargs?kwargs.tracking_disable:!this.$('#oe_import_tracking').prop('checked')
delete kwargs.tracking_disable;kwargs.context=_.extend({},this.parent_context,{tracking_disable:tracking_disable});var self=this;this.trigger_up('with_client',{callback:function(){this.loading.ignore_events=true;}});$.blockUI({message:QWeb.render('Throbber')});$(document.body).addClass('o_ui_blocked');var opts=this.import_options();var $el=$('.oe_throbber_message');var msg=kwargs.dryrun?_t("%d records tested..."):_t("%d records successfully imported...");opts.callback=function(count){$el.text(_.str.sprintf(msg,count));};return this._batchedImport(opts,[this.id,fields,columns],kwargs,{done:0,prev:0}).then(null,function(reason){var error=reason.message;var event=reason.event;if(event){event.preventDefault();}
var msg;var errordata=error.data||{};if(errordata.type==='xhrerror'){var xhr=errordata.objects[0];switch(xhr.status){case 504:msg=_t("Import timed out. Please retry. If you still encounter this issue, the file may be too big for the system's configuration, try to split it (import less records per file).");break;default:msg=_t("An unknown issue occurred during import (possibly lost connection, data limit exceeded or memory limits exceeded). Please retry in case the issue is transient. If the issue still occurs, try to split the file rather than import it at once.");}}else{msg=errordata.arguments&&(errordata.arguments[1]||errordata.arguments[0])||error.message;}
return Promise.resolve({'messages':[{type:'error',record:false,message:msg,}]});}).finally(function(){$(document.body).removeClass('o_ui_blocked');$.unblockUI();self.trigger_up('with_client',{callback:function(){delete this.loading.ignore_events;}});});},_batchedImport:function(opts,args,kwargs,rec){opts.callback&&opts.callback(rec.done||0);var self=this;return this._rpc({model:'base_import.import',method:'do',args:args.concat([opts]),kwargs:kwargs}).then(function(results){_.each(results.messages,offset_by(opts.skip));if(!kwargs.dryrun&&!results.ids){self.$('#oe_import_row_start').val(opts.skip+1);if(opts.skip){results.messages.push({type:'info',priority:true,message:_.str.sprintf(_t("This file has been successfully imported up to line %d."),opts.skip)});}
return results;}
if(!results.nextrow){return results;}
return self._batchedImport(_.defaults({skip:results.nextrow},opts),args,kwargs,{done:rec.done+(results.ids||[]).length,prev:results.nextrow}).then(function(r2){return{name:_.zip(results.name,r2.name).map(function(names){return names[0]||names[1];}),ids:(results.ids||[]).concat(r2.ids||[]),messages:results.messages.concat(r2.messages),skip:r2.skip||results.nextrow,nextrow:r2.nextrow}});});},onvalidate:function(){var prom=this.call_import({dryrun:true,tracking_disable:true});prom.then(this.proxy('validated'));return prom;},onimport:function(){var self=this;var prom=this.call_import({dryrun:false});prom.then(function(results){var message=results.messages;if(!_.any(message,function(message){return message.type==='error';})){self['import_succeeded'](results);return;}
self['import_failed'](results);});return prom;},onimported:function(event,from,to,results){this.do_notify(_t("Import completed"),_.str.sprintf(_t("%d records were successfully imported"),results.ids.length));this.exit();},exit:function(){this.trigger_up('history_back');},onresults:function(event,from,to,results){var fields=this.$('.oe_import_fields input.oe_import_match_field').map(function(index,el){return $(el).select2('val')||false;}).get();var message=results.messages;var no_messages=_.isEmpty(message);if(no_messages){message.push({type:'info',message:_t("Everything seems valid.")});}else if(event==='import_failed'&&results.ids){this.toggle_partial(results);}
var offset=1;if(this.import_options().headers){offset+=1;}
var messagesSorted=_.sortBy(_(message).groupBy('message'),function(group){if(group[0].priority){return-2;}
var order=0;switch(group[0].type){case'error':order=0;break;case'warning':order=fields.length+1;break;case'info':order=2*(fields.length+1);break;default:order=3*(fields.length+1);break;}
return order+_.indexOf(fields,group[0].field);});this.$form.addClass('oe_import_error');this.$('.oe_import_error_report').html(QWeb.render('ImportView.error',{errors:messagesSorted,at:function(rows){var from=rows.from+offset;var to=rows.to+offset;var rowName='';if(results.name.length>rows.from&&results.name[rows.from]!==''){rowName=_.str.sprintf(' (%s)',results.name[rows.from]);}
if(from===to){return _.str.sprintf(_t("at row %d%s"),from,rowName);}
return _.str.sprintf(_t("between rows %d and %d"),from,to);},at_multi:function(rows){var from=rows.from+offset;var to=rows.to+offset;var rowName='';if(results.name.length>rows.from&&results.name[rows.from]!==''){rowName=_.str.sprintf(' (%s)',results.name[rows.from]);}
if(from===to){return _.str.sprintf(_t("Row %d%s"),from,rowName);}
return _.str.sprintf(_t("Between rows %d and %d"),from,to);},at_multi_header:function(numberLines){return _.str.sprintf(_t("at %d different rows:"),numberLines);},more:function(n){return _.str.sprintf(_t("(%d more)"),n);},info:function(msg){if(typeof msg==='string'){return _.str.sprintf('<div class="oe_import_moreinfo oe_import_moreinfo_message">%s</div>',_.str.escapeHTML(msg));}
if(msg instanceof Array){return _.str.sprintf('<div class="oe_import_moreinfo oe_import_moreinfo_choices"><a href="#" class="oe_import_report_see_possible_value oe_import_see_all"><i class="fa fa-arrow-right"/> %s </a><ul class="oe_import_report_more">%s</ul></div>',_.str.escapeHTML(_t("See possible values")),_(msg).map(function(msg){return'<li>'
+_.str.escapeHTML(msg)
+'</li>';}).join(''));}
return['<div class="oe_import_moreinfo oe_import_moreinfo_action">',_.str.sprintf('<a href="#" data-action="%s" class="oe_import_see_all"><i class="fa fa-arrow-right"/> ',_.str.escapeHTML(JSON.stringify(msg))),_.str.escapeHTML(_t("See possible values")),'</a>','</div>'].join('');},}));},toggle_partial:function(result){var $form=this.$('.oe_import');var $partial_warning=this.$('.o_import_partial_alert');var $partial_count=this.$('.o_import_partial_count');if(result==null){$partial_warning.addClass('d-none');$form.add(this.$buttons).removeClass('o_import_partial_mode');var $skip=this.$('#oe_import_row_start');$skip.val($skip.attr('value'));$partial_count.text('');return;}
this.$('.o_import_batch_alert').addClass('d-none');$partial_warning.removeClass('d-none');$form.add(this.$buttons).addClass('o_import_partial_mode');$partial_count.text((result.skip||0)+1);}});core.action_registry.add('import',DataImport);StateMachine.create({target:DataImport.prototype,events:[{name:'loaded_file',from:['none','file_loaded','preview_error','preview_success','results','imported'],to:'file_loaded'},{name:'settings_changed',from:['file_loaded','preview_error','preview_success','results'],to:'previewing'},{name:'preview_failed',from:'previewing',to:'preview_error'},{name:'preview_succeeded',from:'previewing',to:'preview_success'},{name:'validate',from:'preview_success',to:'validating'},{name:'validate',from:'results',to:'validating'},{name:'validated',from:'validating',to:'results'},{name:'import',from:['preview_success','results'],to:'importing'},{name:'import_succeeded',from:'importing',to:'imported'},{name:'import_failed',from:'importing',to:'results'}],});Loading.include({on_rpc_event:function(){if(this.ignore_events){return}
this._super.apply(this,arguments);}});AbstractWebClient.prototype.custom_events['with_client']=function(ev){ev.data.callback.call(this);};function offset_by(by){return function offset_message(msg){if(msg.rows){msg.rows.from+=by;msg.rows.to+=by;}}}
return{DataImport:DataImport,};});;

/* /base_import/static/src/js/import_buttons.js defined in bundle 'web.assets_backend' */
odoo.define('base_import.import_buttons',function(require){"use strict";var config=require('web.config');var KanbanController=require('web.KanbanController');var KanbanView=require('web.KanbanView');var ListController=require('web.ListController');var ListView=require('web.ListView');var ImportViewMixin={init:function(viewInfo,params){var importEnabled=!!JSON.parse(this.arch.attrs.import||'1')&&('import_enabled'in params?params.import_enabled:true);this.controllerParams.importEnabled=importEnabled&&!config.device.isMobile;},};var ImportControllerMixin={init:function(parent,model,renderer,params){this.importEnabled=params.importEnabled;},_bindImport:function(){if(!this.$buttons){return;}
var self=this;this.$buttons.on('click','.o_button_import',function(){var state=self.model.get(self.handle,{raw:true});self.do_action({type:'ir.actions.client',tag:'import',params:{model:self.modelName,context:state.getContext(),}});});}};ListView.include({init:function(){this._super.apply(this,arguments);ImportViewMixin.init.apply(this,arguments);},});ListController.include({init:function(){this._super.apply(this,arguments);ImportControllerMixin.init.apply(this,arguments);},renderButtons:function(){this._super.apply(this,arguments);ImportControllerMixin._bindImport.call(this);}});KanbanView.include({init:function(){this._super.apply(this,arguments);ImportViewMixin.init.apply(this,arguments);},});KanbanController.include({init:function(){this._super.apply(this,arguments);ImportControllerMixin.init.apply(this,arguments);},renderButtons:function(){this._super.apply(this,arguments);ImportControllerMixin._bindImport.call(this);}});});;

/* /odoo_referral/static/src/js/systray.js defined in bundle 'web.assets_backend' */
;

/* /web_cohort/static/src/js/cohort_view.js defined in bundle 'web.assets_backend' */
odoo.define('web_cohort.CohortView',function(require){'use strict';var AbstractView=require('web.AbstractView');var core=require('web.core');var view_registry=require('web.view_registry');var CohortController=require('web_cohort.CohortController');var CohortModel=require('web_cohort.CohortModel');var CohortRenderer=require('web_cohort.CohortRenderer');var _t=core._t;var _lt=core._lt;var intervals={day:_lt('Day'),week:_lt('Week'),month:_lt('Month'),year:_lt('Year'),};var CohortView=AbstractView.extend({display_name:_lt('Cohort'),icon:'fa-signal',config:_.extend({},AbstractView.prototype.config,{Model:CohortModel,Controller:CohortController,Renderer:CohortRenderer,}),viewType:'cohort',searchMenuTypes:['filter','timeRange','favorite'],init:function(viewInfo,params){this._super.apply(this,arguments);var fields=this.fields;var attrs=this.arch.attrs;if(!attrs.date_start){throw new Error(_lt('Cohort view has not defined "date_start" attribute.'));}
if(!attrs.date_stop){throw new Error(_lt('Cohort view has not defined "date_stop" attribute.'));}
var measures={};_.each(fields,function(field,name){if(name!=='id'&&field.store===true&&_.contains(['integer','float','monetary'],field.type)){measures[name]=field.string;}});measures.__count__=_t('Count');this.rendererParams.measures=measures;this.rendererParams.intervals=intervals;this.controllerParams.measures=_.omit(measures,'__count__');this.controllerParams.intervals=intervals;this.controllerParams.title=params.title||attrs.string||_t('Untitled');this.controllerParams.views=[_findViewID('list'),_findViewID('form'),];function _findViewID(viewType){var action=params.action;if(action===undefined){return[false,viewType];}
var contextID=viewType==='list'?action.context.list_view_id:action.context.form_view_id;var result=_.findWhere(action.views,{type:viewType});return[contextID||(result?result.viewID:false),viewType];}},_updateMVCParams:function(){this._super.apply(this,arguments);var context=this.loadParams.context;var attrs=this.arch.attrs;this.loadParams.dateStart=context.cohort_date_start||attrs.date_start;this.loadParams.dateStop=context.cohort_date_stop||attrs.date_stop;this.loadParams.mode=context.cohort_mode||attrs.mode||'retention';this.loadParams.timeline=context.cohort_timeline||attrs.timeline||'forward';this.loadParams.measure=context.cohort_measure||attrs.measure||'__count__';this.loadParams.interval=context.cohort_interval||attrs.interval||'day';this.rendererParams.mode=this.loadParams.mode;this.rendererParams.timeline=this.loadParams.timeline;this.rendererParams.dateStartString=this.fields[this.loadParams.dateStart].string;this.rendererParams.dateStopString=this.fields[this.loadParams.dateStop].string;this.controllerParams.dateStartString=this.rendererParams.dateStartString;this.controllerParams.dateStopString=this.rendererParams.dateStopString;this.controllerParams.timeline=this.rendererParams.timeline;},});view_registry.add('cohort',CohortView);return CohortView;});;

/* /web_cohort/static/src/js/cohort_model.js defined in bundle 'web.assets_backend' */
odoo.define('web_cohort.CohortModel',function(require){'use strict';var AbstractModel=require('web.AbstractModel');var CohortModel=AbstractModel.extend({get:function(){return this.data;},load:function(params){this.modelName=params.modelName;this.dateStart=params.dateStart;this.dateStop=params.dateStop;this.measure=params.measure;this.interval=params.interval;this.domain=params.domain;this.timeRange=params.timeRange||[];this.comparisonTimeRange=params.comparisonTimeRange||[];this.compare=params.compare;this.mode=params.mode;this.timeline=params.timeline;this.data={measure:this.measure,interval:this.interval,};this.context=params.context;return this._fetchData();},reload:function(handle,params){if(params.context!==undefined){var timeRangeMenuData=params.context.timeRangeMenuData;if(timeRangeMenuData){this.timeRange=timeRangeMenuData.timeRange||[];this.comparisonTimeRange=timeRangeMenuData.comparisonTimeRange||[];this.compare=this.comparisonTimeRange.length>0;}else{this.timeRange=[];this.comparisonTimeRange=[];this.compare=false;}}
if('measure'in params){this.data.measure=params.measure;}
if('interval'in params){this.data.interval=params.interval;}
if('domain'in params){this.domain=params.domain;}
return this._fetchData();},_fetchData:function(){var self=this;var defs=[this._rpc({model:this.modelName,method:'get_cohort_data',kwargs:{date_start:this.dateStart,date_stop:this.dateStop,measure:this.data.measure,interval:this.data.interval,domain:this.domain.concat(this.timeRange),mode:this.mode,timeline:this.timeline,context:this.context,}})];if(this.compare){defs.push(this._rpc({model:this.modelName,method:'get_cohort_data',kwargs:{date_start:this.dateStart,date_stop:this.dateStop,measure:this.data.measure,interval:this.data.interval,domain:this.domain.concat(this.comparisonTimeRange),mode:this.mode,timeline:this.timeline,}}));}
return Promise.all(defs).then(function(){var results=Array.prototype.slice.call(arguments[0]);self.data.report=results[0];if(self.compare){self.data.comparisonReport=results[1];}else{self.data.comparisonReport=undefined;}});},});return CohortModel;});;

/* /web_cohort/static/src/js/cohort_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web_cohort.CohortController',function(require){'use strict';var AbstractController=require('web.AbstractController');var config=require('web.config');var core=require('web.core');var framework=require('web.framework');var session=require('web.session');var qweb=core.qweb;var _t=core._t;var CohortController=AbstractController.extend({custom_events:_.extend({},AbstractController.prototype.custom_events,{'row_clicked':'_onRowClicked',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.title=params.title;this.measures=params.measures;this.intervals=params.intervals;this.dateStartString=params.dateStartString;this.dateStopString=params.dateStopString;this.timeline=params.timeline;this.views=params.views;},getOwnedQueryParams:function(){var state=this.model.get();return{context:{cohort_measure:state.measure,cohort_interval:state.interval,}};},renderButtons:function($node){if($node){this.$buttons=$(qweb.render('CohortView.buttons',{measures:_.sortBy(_.pairs(this.measures),function(x){return x[1].toLowerCase();}),intervals:this.intervals,isMobile:config.device.isMobile}));this.$measureList=this.$buttons.find('.o_cohort_measures_list');this.$buttons.appendTo($node);this._updateButtons();this.$buttons.on('click','button',this._onButtonClick.bind(this));}},_downloadExcel:function(){var data=this.model.get();data=_.extend(data,{title:this.title,interval_string:this.intervals[data.interval].toString(),measure_string:this.measures[data.measure]||_t('Count'),date_start_string:this.dateStartString,date_stop_string:this.dateStopString,timeline:this.timeline,});framework.blockUI();session.get_file({url:'/web/cohort/export',data:{data:JSON.stringify(data)},complete:framework.unblockUI,error:(error)=>this.call('crash_manager','rpc_error',error),});},_setInterval:function(interval){this.update({interval:interval});},_setMeasure:function(measure){this.update({measure:measure});},_update:function(){this._updateButtons();return this._super.apply(this,arguments);},_updateButtons:function(){if(!this.$buttons){return;}
var data=this.model.get();var noData=!data.report.rows.length&&(!data.comparisonReport||!data.comparisonReport.rows.length);this.$buttons.find('.o_cohort_download_button').toggleClass('d-none',noData);if(config.device.isMobile){var $activeInterval=this.$buttons.find('.o_cohort_interval_button[data-interval="'+data.interval+'"]');this.$buttons.find('.dropdown_cohort_content').text($activeInterval.text());}
this.$buttons.find('.o_cohort_interval_button').removeClass('active');this.$buttons.find('.o_cohort_interval_button[data-interval="'+data.interval+'"]').addClass('active');_.each(this.$measureList.find('.dropdown-item'),function(el){var $el=$(el);$el.toggleClass('selected',$el.data('field')===data.measure);});},_onButtonClick:function(ev){var $btn=$(ev.currentTarget);if($btn.hasClass('o_cohort_interval_button')){this._setInterval($btn.data('interval'));}else if($btn.hasClass('o_cohort_download_button')){this._downloadExcel();}else if($btn.closest('.o_cohort_measures_list').length){ev.preventDefault();ev.stopPropagation();this._setMeasure($btn.data('field'));}},_onRowClicked:function(event){this.do_action({type:'ir.actions.act_window',name:this.title,res_model:this.modelName,views:this.views,domain:event.data.domain,});},});return CohortController;});;

/* /web_cohort/static/src/js/cohort_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web_cohort.CohortRenderer',function(require){'use strict';var AbstractRenderer=require('web.AbstractRenderer');var core=require('web.core');var field_utils=require('web.field_utils');var qweb=core.qweb;var CohortRenderer=AbstractRenderer.extend({className:'o_cohort_view',events:_.extend({},AbstractRenderer.prototype.events,{'click .o_cohort_row_clickable':'_onClickRow',}),init:function(parent,state,params){this._super.apply(this,arguments);this.measures=params.measures;this.intervals=params.intervals;this.dateStartString=params.dateStartString;this.dateStopString=params.dateStopString;this.timeRangeDescription=params.timeRangeDescription;this.comparisonTimeRangeDescription=params.comparisonTimeRangeDescription;this.mode=params.mode;this.timeline=params.timeline;},updateState:function(state,params){if(params.context!==undefined){var timeRangeMenuData=params.context.timeRangeMenuData;if(timeRangeMenuData){this.timeRangeDescription=timeRangeMenuData.timeRangeDescription;this.comparisonTimeRangeDescription=timeRangeMenuData.comparisonTimeRangeDescription;}else{this.timeRangeDescription=undefined;this.comparisonTimeRangeDescription=undefined;}}
return this._super.apply(this,arguments);},_hasContent:function(){return this.state.report.rows.length||(this.state.comparisonReport&&this.state.comparisonReport.rows.length);},_render:function(){var self=this;if(!this._hasContent()){this.$el.empty().append(qweb.render('View.NoContentHelper'));return this._super.apply(this,arguments);}
this.$el.empty().append(qweb.render('CohortView',{report:this.state.report,comparisonReport:this.state.comparisonReport,measure:this.measures[this.state.measure],interval:this.intervals[this.state.interval],date_start_string:this.dateStartString,date_stop_string:this.dateStopString,timeRangeDescription:this.timeRangeDescription,comparisonTimeRangeDescription:this.comparisonTimeRangeDescription,mode:this.mode,timeline:this.timeline,format_float:this._format_float,format_percentage:this._format_percentage,}));this.$('.o_cohort_highlight.o_cohort_value').tooltip({title:function(){var $cell=$(this);return qweb.render('CohortView.tooltip',{period:$cell.data('period'),count:$cell.data('count'),measure:self.measures[self.state.measure],});},});return this._super.apply(this,arguments);},_format_float:function(value){return field_utils.format.float(value,null,{digits:[42,1],});},_format_percentage:function(value){return field_utils.format.percentage(value,null,{digits:[42,1],});},_onClickRow:function(event){if(!$(event.target).hasClass('o_cohort_value')){return;}
var rowData=$(event.currentTarget).data();var rowIndex=rowData.row;var colIndex=$(event.target).data().col;var row=(rowData.type==='data')?this.state.report.rows[rowIndex]:this.state.comparisonReport.rows[rowIndex];var rowDomain=row?row.domain:[];var cellContent=row?row.columns[colIndex]:false;var cellDomain=cellContent?cellContent.domain:[];var fullDomain=rowDomain.concat(cellDomain);if(cellDomain.length){fullDomain.unshift('&');}
if(fullDomain.length){this.trigger_up('row_clicked',{domain:fullDomain});}},});return CohortRenderer;});;

/* /web_diagram/static/src/js/vec2.js defined in bundle 'web.assets_backend' */
(function(window){function Vec2(x,y){this.x=x;this.y=y;}
window.Vec2=Vec2;var rad2deg=57.29577951308232;var deg2rad=0.017453292519943295;var epsilon=0.0000001;Vec2.new_polar_deg=function(len,angle){var v=new Vec2(len,0);return v.rotate_deg(angle);};Vec2.new_polar=function(len,angle){var v=new Vec2(len,0);v.rotate(angle);return v;};Vec2.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y);};Vec2.prototype.len_sq=function(){return this.x*this.x+this.y*this.y;};Vec2.prototype.dist=function(v){var dx=this.x-v.x;var dy=this.y-v.y;return Math.sqrt(dx*dx+dy*dy);};Vec2.prototype.dist_xy=function(x,y){var dx=this.x-x;var dy=this.y-y;return Math.sqrt(dx*dx+dy*dy);};Vec2.prototype.dist_sq=function(v){var dx=this.x-v.x;var dy=this.y-v.y;return dx*dx+dy*dy;};Vec2.prototype.dist_sq_xy=function(x,y){var dx=this.x-x;var dy=this.y-y;return dx*dx+dy*dy;};Vec2.prototype.dot=function(v){return this.x*v.x+this.y*v.y;};Vec2.prototype.dot_xy=function(x,y){return this.x*x+this.y*y;};Vec2.prototype.clone=function(){return new Vec2(this.x,this.y);};Vec2.prototype.add=function(v){return new Vec2(this.x+v.x,this.y+v.y);};Vec2.prototype.add_xy=function(x,y){return new Vec2(this.x+x,this.y+y);};Vec2.prototype.sub=function(v){return new Vec2(this.x-v.x,this.y-v.y);};Vec2.prototype.sub_xy=function(x,y){return new Vec2(this.x-x,this.y-y);};Vec2.prototype.mult=function(v){return new Vec2(this.x*v.x,this.y*v.y);};Vec2.prototype.mult_xy=function(x,y){return new Vec2(this.x*x,this.y*y);};Vec2.prototype.scale=function(f){return new Vec2(this.x*f,this.y*f);};Vec2.prototype.neg=function(f){return new Vec2(-this.x,-this.y);};Vec2.prototype.normalize=function(){var len=this.len();if(len==0){return new Vec2(0,1);}else if(len!=1){return this.scale(1.0/len);}
return new Vec2(this.x,this.y);};Vec2.prototype.set_len=function(l){return this.normalize().scale(l);};Vec2.prototype.project=function(v){return v.set_len(this.dot(v));};Vec2.prototype.toString=function(){var str="";str+="[";str+=this.x;str+=",";str+=this.y;str+="]";return str;};Vec2.prototype.rotate=function(rad){var c=Math.cos(rad);var s=Math.sin(rad);var px=this.x*c-this.y*s;var py=this.x*s+this.y*c;return new Vec2(px,py);};Vec2.prototype.rotate_deg=function(deg){return this.rotate(deg*deg2rad);};Vec2.prototype.lerp=function(v,alpha){var inv_alpha=1-alpha;return new Vec2(this.x*inv_alpha+v.x*alpha,this.y*inv_alpha+v.y*alpha);};Vec2.prototype.angle=function(){return Math.atan2(this.y,this.x);};Vec2.prototype.angle_deg=function(){return Math.atan2(this.y,this.x)*rad2deg;};Vec2.prototype.equals=function(v){if(Math.abs(this.x-v.x)>epsilon){return false;}else if(Math.abs(this.y-v.y)>epsilon){return false;}
return true;};Vec2.prototype.equals_xy=function(x,y){if(Math.abs(this.x-x)>epsilon){return false;}else if(Math.abs(this.y-y)>epsilon){return false;}
return true;};})(window);(function(window){function BEllipse(cx,cy,rx,ry){this.type='ellipse';this.x=cx-rx;this.y=cy-ry;this.sx=2*rx;this.sy=2*ry;this.hx=rx;this.hy=ry;this.cx=cx;this.cy=cy;this.mx=cx+rx;this.my=cy+ry;}
window.BEllipse=BEllipse;BEllipse.prototype.collide_segment=function(a,b){var collisions=[];if(a.equals(b)){return collisions;}
var c=new Vec2(this.cx,this.cy);a=a.sub(c).mult_xy(1/this.hx,1/this.hy);b=b.sub(c).mult_xy(1/this.hx,1/this.hy);if(a.len_sq()<1&&b.len_sq()<1){return collisions;}
var ab=b.sub(a);var A=(ab.x*ab.x+ab.y*ab.y);var B=2*(ab.x*a.x+ab.y*a.y);var C=a.x*a.x+a.y*a.y-1;var u=B*B-4*A*C;if(u<0){return collisions;}
u=Math.sqrt(u);var u1=(-B+u)/(2*A);var u2=(-B-u)/(2*A);if(u1>=0&&u1<=1){var pos=a.add(ab.scale(u1));collisions.push(pos);}
if(u1!=u2&&u2>=0&&u2<=1){var pos=a.add(ab.scale(u2));collisions.push(pos);}
for(var i=0;i<collisions.length;i++){collisions[i]=collisions[i].mult_xy(this.hx,this.hy);collisions[i]=collisions[i].add_xy(this.cx,this.cy);}
return collisions;};function BRect(x,y,sx,sy){this.type='rect';this.x=x;this.y=y;this.sx=sx;this.sy=sy;this.hx=sx/2;this.hy=sy/2;this.cx=x+this.hx;this.cy=y+this.hy;this.mx=x+sx;this.my=y+sy;}
window.BRect=BRect;BRect.new_centered=function(cx,cy,sx,sy){return new BRect(cx-sx/2,cy-sy/2,sx,sy);};function line_intersect(a,b,c,d){var f=((d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y));if(f==0){return null;}
f=1/f;var fab=((d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x))*f;if(fab<0||fab>1){return null;}
var fcd=((b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x))*f;if(fcd<0||fcd>1){return null;}
return new Vec2(a.x+fab*(b.x-a.x),a.y+fab*(b.y-a.y));}
BRect.prototype.collide_segment=function(a,b){var collisions=[];var corners=[new Vec2(this.x,this.y),new Vec2(this.x,this.my),new Vec2(this.mx,this.my),new Vec2(this.mx,this.y)];var pos=line_intersect(a,b,corners[0],corners[1]);if(pos)collisions.push(pos);pos=line_intersect(a,b,corners[1],corners[2]);if(pos)collisions.push(pos);pos=line_intersect(a,b,corners[2],corners[3]);if(pos)collisions.push(pos);pos=line_intersect(a,b,corners[3],corners[0]);if(pos)collisions.push(pos);return collisions;};BRect.prototype.contains_vec=function(vec){return(vec.x>=this.x&&vec.x<=this.mx&&vec.y>=this.y&&vec.y<=this.my);};BRect.prototype.contains_xy=function(x,y){return(x>=this.x&&x<=this.mx&&y>=this.y&&y<=this.my);};BEllipse.prototype.contains_vec=function(v){v=v.mult_xy(this.hx,this.hy);return v.len_sq()<=1;};BEllipse.prototype.contains_xy=function(x,y){return this.contains(new Vec2(x,y));};})(window);;

/* /web_diagram/static/src/js/graph.js defined in bundle 'web.assets_backend' */
(function(window){function EdgeEnd(pos_x,pos_y){this.x=pos_x;this.y=pos_y;this.get_pos=function(){return new Vec2(this.x,this.y);}}
function CloseButton(graph,entity,entity_type,pos_x,pos_y){var self=this;var visible=false;var close_button_radius=graph.style.close_button_radius||8;var close_circle=graph.r.circle(entity.get_pos().x+pos_x,entity.get_pos().y+pos_y,close_button_radius);close_circle.attr({'opacity':0,'fill':graph.style.close_button_color||"black",'cursor':'pointer','stroke':'none'});close_circle.transform(graph.get_transform());graph.set_scrolling(close_circle);var close_label=graph.r.text(entity.get_pos().x+pos_x,entity.get_pos().y+pos_y,"x");close_label.attr({'fill':graph.style.close_button_x_color||"white",'font-size':close_button_radius,'cursor':'pointer'});close_label.transform(graph.get_transform());graph.set_scrolling(close_label);var dummy_circle=graph.r.circle(entity.get_pos().x+pos_x,entity.get_pos().y+pos_y,close_button_radius);dummy_circle.attr({'opacity':1,'fill':'transparent','stroke':'none','cursor':'pointer'});dummy_circle.transform(graph.get_transform());graph.set_scrolling(dummy_circle);this.get_pos=function(){return entity.get_pos().add_xy(pos_x,pos_y);};this.update_pos=function(){var pos=self.get_pos();close_circle.attr({'cx':pos.x,'cy':pos.y});dummy_circle.attr({'cx':pos.x,'cy':pos.y});close_label.attr({'x':pos.x,'y':pos.y});};function hover_in(){if(!visible){return;}
close_circle.animate({'r':close_button_radius*1.5},300,'elastic');dummy_circle.animate({'r':close_button_radius*1.5},300,'elastic');}
function hover_out(){if(!visible){return;}
close_circle.animate({'r':close_button_radius},400,'linear');dummy_circle.animate({'r':close_button_radius},400,'linear');}
dummy_circle.hover(hover_in,hover_out);close_circle.hover(hover_in,hover_out);close_label.hover(hover_in,hover_out);function click_action(){if(!visible){return;}
close_circle.attr({'r':close_button_radius*2});dummy_circle.attr({'r':close_button_radius*2});close_circle.animate({'r':close_button_radius},400,'linear');dummy_circle.animate({'r':close_button_radius},400,'linear');if(entity_type=="node"){Promise.resolve(GraphNode.destruction_callback(entity)).then(function(){entity.remove();});}else if(entity_type=="edge"){Promise.resolve(GraphEdge.destruction_callback(entity)).then(function(){entity.remove();});}}
dummy_circle.click(click_action);close_circle.click(click_action);close_label.click(click_action);this.show=function(){if(!visible){close_circle.animate({'opacity':1},100,'linear');close_label.animate({'opacity':1},100,'linear');visible=true;}}
this.hide=function(){if(visible){close_circle.animate({'opacity':0},100,'linear');close_label.animate({'opacity':0},100,'linear');visible=false;}}
this.remove=function(){if(visible){visible=false;close_circle.animate({'opacity':0},100,'linear');close_label.animate({'opacity':0},100,'linear',self.remove);}else{close_circle.remove();close_label.remove();dummy_circle.remove();}}}
function Connector(graph,node,pos_x,pos_y){var visible=false;var conn_circle=graph.r.circle(node.get_pos().x+pos_x,node.get_pos().y+pos_y,4);conn_circle.attr({'opacity':0,'fill':graph.style.node_outline_color,'stroke':'none'});conn_circle.transform(graph.get_transform());graph.set_scrolling(conn_circle);var self=this;this.update_pos=function(){conn_circle.attr({'cx':node.get_pos().x+pos_x,'cy':node.get_pos().y+pos_y});};this.get_pos=function(){return new node.get_pos().add_xy(pos_x,pos_y);};this.remove=function(){conn_circle.remove();}
function hover_in(){if(!visible){return;}
conn_circle.animate({'r':8},300,'elastic');if(graph.creating_edge){graph.target_node=node;conn_circle.animate({'fill':graph.style.connector_active_color,'stroke':graph.style.node_outline_color,'stroke-width':graph.style.node_selected_width,},100,'linear');}}
function hover_out(){if(!visible){return;}
conn_circle.animate({'r':graph.style.connector_radius,'fill':graph.style.node_outline_color,'stroke':'none'},400,'linear');graph.target_node=null;}
conn_circle.hover(hover_in,hover_out);var drag_down=function(){if(!visible){return;}
self.ox=conn_circle.attr("cx");self.oy=conn_circle.attr("cy");self.edge_start=new EdgeEnd(self.ox,self.oy);self.edge_end=new EdgeEnd(self.ox,self.oy);self.edge_tmp=new GraphEdge(graph,'',self.edge_start,self.edge_end,true);graph.creating_edge=true;};var drag_move=function(dx,dy){if(!visible){return;}
self.edge_end.x=self.ox+dx;self.edge_end.y=self.oy+dy;self.edge_tmp.update();};var drag_up=function(){if(!visible){return;}
graph.creating_edge=false;self.edge_tmp.remove();if(graph.target_node){var edge_prop=GraphEdge.creation_callback(node,graph.target_node);if(edge_prop){var new_edge=new GraphEdge(graph,edge_prop.label,node,graph.target_node);GraphEdge.new_edge_callback(new_edge);}}};conn_circle.drag(drag_move,drag_down,drag_up);function show(){if(!visible){conn_circle.animate({'opacity':1},100,'linear');visible=true;}}
function hide(){if(visible){conn_circle.animate({'opacity':0},100,'linear');visible=false;}}
this.show=show;this.hide=hide;}
function Graph(r,style,viewport){var self=this;var nodes=[];var edges=[];var graph={};var links={};var uid=1;var selected_entity=null;self.creating_edge=false;self.target_node=null;self.r=r;self.style=style;var tr_x=0,tr_y=0;var background=r.rect(0,0,'100%','100%').attr({'fill':'white','stroke':'none','opacity':0,'cursor':'move'});this.get_transform=function(){return"T"+tr_x+","+tr_y};var translate_all=function(dx,dy){tr_x+=dx;tr_y+=dy;var tstr=self.get_transform();r.forEach(function(el){if(el!=background){el.transform(tstr);}});};var get_bounds=function(){var minx=Number.MAX_VALUE;var miny=Number.MAX_VALUE;var maxx=Number.MIN_VALUE;var maxy=Number.MIN_VALUE;for(var i=0;i<nodes.length;i++){var pos=nodes[i].get_pos();minx=Math.min(minx,pos.x);miny=Math.min(miny,pos.y);maxx=Math.max(maxx,pos.x);maxy=Math.max(maxy,pos.y);}
minx=minx-style.node_size_x/2+tr_x;miny=miny-style.node_size_y/2+tr_y;maxx=maxx+style.node_size_x/2+tr_x;maxy=maxy+style.node_size_y/2+tr_y;return{minx:minx,miny:miny,maxx:maxx,maxy:maxy};};var translation_respects_viewport=function(dx,dy,margin){if(!viewport){return true;}
margin=margin||0;var b=get_bounds();var width=viewport.offsetWidth;var height=viewport.offsetHeight;if((dy<0&&b.maxy+dy<margin)||(dy>0&&b.miny+dy>height-margin)||(dx<0&&b.maxx+dx<margin)||(dx>0&&b.minx+dx>width-margin)){return false;}
return true;}
this.set_scrolling=function(raph_element){$(raph_element.node).bind('mousewheel',function(event,delta){var dy=delta*20;if(translation_respects_viewport(0,dy,style.viewport_margin)){translate_all(0,dy);}});};var px,py;var bg_drag_down=function(){px=py=0;};var bg_drag_move=function(x,y){var dx=x-px;var dy=y-py;px=x;py=y;if(translation_respects_viewport(dx,dy,style.viewport_margin)){translate_all(dx,dy);}};var bg_drag_up=function(){};background.drag(bg_drag_move,bg_drag_down,bg_drag_up);this.set_scrolling(background);this.add_node=function(n){nodes.push(n);n.uid=uid++;};this.get_node_list=function(){return nodes;};this.add_edge=function(n1,n2,e){edges.push(e);e.uid=uid++;if(!graph[n1.uid])graph[n1.uid]={};if(!graph[n1.uid][n2.uid])graph[n1.uid][n2.uid]=[];if(!links[n1.uid])links[n1.uid]=[];if(!links[n2.uid])links[n2.uid]=[];graph[n1.uid][n2.uid].push(e);links[n1.uid].push(e);if(n1!=n2){links[n2.uid].push(e);}};this.remove_edge=function(edge){edges=_.without(edges,edge);var n1=edge.get_start();var n2=edge.get_end();links[n1.uid]=_.without(links[n1.uid],edge);links[n2.uid]=_.without(links[n2.uid],edge);graph[n1.uid][n2.uid]=_.without(graph[n1.uid][n2.uid],edge);if(selected_entity==edge){selected_entity=null;}};this.remove_node=function(node){var linked_edges=self.get_linked_edge_list(node);for(var i=0;i<linked_edges.length;i++){linked_edges[i].remove();}
nodes=_.without(nodes,node);if(selected_entity==node){selected_entity=null;}}
this.get_edge_list=function(n1,n2){var list=[];if(!graph[n1.uid])return list;if(!graph[n1.uid][n2.uid])return list;return graph[n1.uid][n2.uid];};this.get_linked_edge_list=function(n){if(!links[n.uid])return[];return links[n.uid];};this.get_edge_curvature=function(n1,n2,e){var el_12=this.get_edge_list(n1,n2);var c12=el_12.length;var el_21=this.get_edge_list(n2,n1);var c21=el_21.length;if(c12+c21==1){return 0;}else{var index=0;for(var i=0;i<c12;i++){if(el_12[i].uid<e.uid){index++;}}
if(c21==0){return index-(c12-1)/2.0;}else{return index+0.5;}}};this.get_loop_angle=function(n,e){var loop_list=this.get_edge_list(n,n);var slots=[];for(var angle=0;angle<360;angle+=45){slots.push(Vec2.new_polar_deg(1,angle));}
var links=this.get_linked_edge_list(n);for(var i=0;i<links.length;i++){var edge=links[i];if(!edge.is_loop||edge.is_loop()){continue;}
var end=edge.get_end();if(end==n){end=edge.get_start();}
var dir=end.get_pos().sub(n.get_pos()).normalize();for(var s=0;s<slots.length;s++){var score=slots[s].dot(dir);if(score<0){score=-0.2*Math.pow(score,2);}else{score=Math.pow(score,2);}
if(!slots[s].score){slots[s].score=score;}else{slots[s].score+=score;}}}
slots.sort(function(a,b){return a.score<b.score?-1:1;});var index=0;for(var i=0;i<links.length;i++){var edge=links[i];if(!edge.is_loop||!edge.is_loop()){continue;}
if(edge.uid<e.uid){index++;}}
index%=slots.length;return slots[index].angle_deg();}
this.select=function(entity){if(selected_entity){if(selected_entity==entity){return;}else{if(selected_entity.set_not_selected){selected_entity.set_not_selected();}
selected_entity=null;}}
selected_entity=entity;if(entity&&entity.set_selected){entity.set_selected();}};}
function GraphNode(graph,pos_x,pos_y,label,type,color){var self=this;var r=graph.r;var sy=graph.style.node_size_y;var sx=graph.style.node_size_x;var node_fig=null;var selected=false;this.connectors=[];this.close_button=null;this.uid=0;graph.add_node(this);if(type=='circle'){node_fig=r.ellipse(pos_x,pos_y,sx/2,sy/2);}else{node_fig=r.rect(pos_x-sx/2,pos_y-sy/2,sx,sy);}
node_fig.attr({'fill':color,'stroke':graph.style.node_outline_color,'stroke-width':graph.style.node_outline_width,'cursor':'pointer'});node_fig.transform(graph.get_transform());graph.set_scrolling(node_fig);var node_label=r.text(pos_x,pos_y,label);node_label.attr({'fill':graph.style.node_label_color,'font-size':graph.style.node_label_font_size,'cursor':'pointer'});node_label.transform(graph.get_transform());graph.set_scrolling(node_label);var update_linked_edges=function(){var edges=graph.get_linked_edge_list(self);for(var i=0;i<edges.length;i++){edges[i].update();}};var set_pos=function(pos){if(type=='circle'){node_fig.attr({'cx':pos.x,'cy':pos.y});}else{node_fig.attr({'x':pos.x-sx/2,'y':pos.y-sy/2});}
node_label.attr({'x':pos.x,'y':pos.y});for(var i=0;i<self.connectors.length;i++){self.connectors[i].update_pos();}
if(self.close_button){self.close_button.update_pos();}
update_linked_edges();};var get_fig=function(){return node_fig;};var get_pos=function(){if(type=='circle'){return new Vec2(node_fig.attr('cx'),node_fig.attr('cy'));}else{return new Vec2(node_fig.attr('x')+sx/2,node_fig.attr('y')+sy/2);}};var get_label=function(){return node_label.attr("text");};var set_label=function(text){node_label.attr({'text':text});};var get_bound=function(){if(type=='circle'){return new BEllipse(get_pos().x,get_pos().y,sx/2,sy/2);}else{return BRect.new_centered(get_pos().x,get_pos().y,sx,sy);}};var set_selected=function(){if(!selected){selected=true;node_fig.attr({'stroke':graph.style.node_selected_color,'stroke-width':graph.style.node_selected_width});if(!self.close_button){self.close_button=new CloseButton(graph,self,"node",sx/2,-sy/2);self.close_button.show();}
for(var i=0;i<self.connectors.length;i++){self.connectors[i].show();}}};var set_not_selected=function(){if(selected){node_fig.animate({'stroke':graph.style.node_outline_color,'stroke-width':graph.style.node_outline_width},100,'linear');if(self.close_button){self.close_button.remove();self.close_button=null;}
selected=false;}
for(var i=0;i<self.connectors.length;i++){self.connectors[i].hide();}};var remove=function(){if(self.close_button){self.close_button.remove();}
for(var i=0;i<self.connectors.length;i++){self.connectors[i].remove();}
graph.remove_node(self);node_fig.remove();node_label.remove();}
this.set_pos=set_pos;this.get_pos=get_pos;this.set_label=set_label;this.get_label=get_label;this.get_bound=get_bound;this.get_fig=get_fig;this.set_selected=set_selected;this.set_not_selected=set_not_selected;this.update_linked_edges=update_linked_edges;this.remove=remove;var click_action=function(){if(type=='circle'){node_fig.attr({'rx':sx/2+3,'ry':sy/2+3});node_fig.animate({'rx':sx/2,'ry':sy/2},500,'elastic');}else{var cx=get_pos().x;var cy=get_pos().y;node_fig.attr({'x':cx-(sx/2)-3,'y':cy-(sy/2)-3,'ẃidth':sx+6,'height':sy+6});node_fig.animate({'x':cx-sx/2,'y':cy-sy/2,'ẃidth':sx,'height':sy},500,'elastic');}
graph.select(self);};node_fig.click(click_action);node_label.click(click_action);var drag_down=function(){this.opos=get_pos();};var drag_move=function(dx,dy){var edges=graph.get_linked_edge_list(self);for(var i=0;i<edges.length;i++){edges[i].label_disable();}
if(self.close_button){self.close_button.hide();}
set_pos(this.opos.add_xy(dx,dy));};var drag_up=function(){var edges=graph.get_linked_edge_list(self);for(var i=0;i<edges.length;i++){edges[i].label_enable();}
if(self.close_button){self.close_button.show();}};node_fig.drag(drag_move,drag_down,drag_up);node_label.drag(drag_move,drag_down,drag_up);function hover_in(){if(graph.creating_edge){graph.target_node=self;}}
function hover_out(){graph.target_node=null;}
node_fig.hover(hover_in,hover_out);node_label.hover(hover_in,hover_out);function double_click(){GraphNode.double_click_callback(self);}
node_fig.dblclick(double_click);node_label.dblclick(double_click);this.connectors.push(new Connector(graph,this,-sx/2,0));this.connectors.push(new Connector(graph,this,sx/2,0));this.connectors.push(new Connector(graph,this,0,-sy/2));this.connectors.push(new Connector(graph,this,0,sy/2));this.close_button=new CloseButton(graph,this,"node",sx/2,-sy/2);}
GraphNode.double_click_callback=function(node){console.log("double click from node:",node);};GraphNode.destruction_callback=function(node){return true;};function GraphEdge(graph,label,start,end,tmp){var self=this;var r=graph.r;var curvature=0;var s,e;var mc;var mc1,mc2;var elfs=graph.style.edge_label_font_size||10;var label_enabled=true;this.uid=0;var edge_path="";var selected=false;if(!tmp){graph.add_edge(start,end,this);}
function get_label_pos(path){var cpos=path.getTotalLength()*0.5;var cindex=Math.abs(Math.floor(curvature));var mod=((cindex%3))*(elfs*3.1)-(elfs*0.5);var verticality=Math.abs(end.get_pos().sub(start.get_pos()).normalize().dot_xy(0,1));verticality=Math.max(verticality-0.5,0)*2;var lpos=path.getPointAtLength(cpos+mod*verticality);return new Vec2(lpos.x,lpos.y-elfs*(1-verticality));}
this.get_pos=function(){if(!edge){return start.get_pos().lerp(end.get_pos(),0.5);}
return get_label_pos(edge);}
function make_line(){return"M"+s.x+","+s.y+"L"+e.x+","+e.y;}
function make_curve(){return"M"+s.x+","+s.y+"Q"+mc.x+","+mc.y+" "+e.x+","+e.y;}
function make_loop(){return"M"+s.x+" "+s.y+"C"+mc1.x+" "+mc1.y+" "+mc2.x+" "+mc2.y+" "+e.x+" "+e.y;}
function update_curve(){if(start!=end){if(!tmp){curvature=graph.get_edge_curvature(start,end,self);}else{curvature=0;}
s=start.get_pos();e=end.get_pos();mc=s.lerp(e,0.5);var se=e.sub(s);se=se.normalize();se=se.rotate_deg(-90);se=se.scale(curvature*graph.style.edge_spacing);mc=mc.add(se);if(start.get_bound){var col=start.get_bound().collide_segment(s,mc);if(col.length>0){s=col[0];}}
if(end.get_bound){var col=end.get_bound().collide_segment(mc,e);if(col.length>0){e=col[0];}}
if(curvature!=0){edge_path=make_curve();}else{edge_path=make_line();}}else{var rad=graph.style.edge_loop_radius||100;s=start.get_pos();e=end.get_pos();var r=Vec2.new_polar_deg(rad,graph.get_loop_angle(start,self));mc=s.add(r);var p=r.rotate_deg(90);mc1=mc.add(p.set_len(rad*0.5));mc2=mc.add(p.set_len(-rad*0.5));if(start.get_bound){var col=start.get_bound().collide_segment(s,mc1);if(col.length>0){s=col[0];}
var col=start.get_bound().collide_segment(e,mc2);if(col.length>0){e=col[0];}}
edge_path=make_loop();}}
update_curve();var edge=r.path(edge_path).attr({'stroke':graph.style.edge_color,'stroke-width':graph.style.edge_width,'arrow-end':'block-wide-long','cursor':'pointer'}).insertBefore(graph.get_node_list()[0].get_fig());var labelpos=get_label_pos(edge);var edge_label=r.text(labelpos.x,labelpos.y-elfs,label).attr({'fill':graph.style.edge_label_color,'cursor':'pointer','font-size':elfs});edge.transform(graph.get_transform());graph.set_scrolling(edge);edge_label.transform(graph.get_transform());graph.set_scrolling(edge_label);if(!tmp){var edges_start=graph.get_linked_edge_list(start);var edges_end=graph.get_linked_edge_list(end);var edges=edges_start.length<edges_end.length?edges_start:edges_end;for(var i=0;i<edges.length;i++){if(edges[i]!=self){edges[i].update();}}}
function label_enable(){if(!label_enabled){label_enabled=true;edge_label.animate({'opacity':1},100,'linear');if(self.close_button){self.close_button.show();}
self.update();}}
function label_disable(){if(label_enabled){label_enabled=false;edge_label.animate({'opacity':0},100,'linear');if(self.close_button){self.close_button.hide();}}}
function update(){update_curve();edge.attr({'path':edge_path});if(label_enabled){var labelpos=get_label_pos(edge);edge_label.attr({'x':labelpos.x,'y':labelpos.y-14});}}
function remove(){edge.remove();edge_label.remove();if(!tmp){graph.remove_edge(self);}
if(start.update_linked_edges){start.update_linked_edges();}
if(start!=end&&end.update_linked_edges){end.update_linked_edges();}
if(self.close_button){self.close_button.remove();}}
this.set_selected=function(){if(!selected){selected=true;edge.attr({'stroke':graph.style.node_selected_color,'stroke-width':graph.style.node_selected_width});edge_label.attr({'fill':graph.style.node_selected_color});if(!self.close_button){self.close_button=new CloseButton(graph,self,"edge",0,30);self.close_button.show();}}};this.set_not_selected=function(){if(selected){selected=false;edge.animate({'stroke':graph.style.edge_color,'stroke-width':graph.style.edge_width},100,'linear');edge_label.animate({'fill':graph.style.edge_label_color},100,'linear');if(self.close_button){self.close_button.remove();self.close_button=null;}}};function click_action(){graph.select(self);}
edge.click(click_action);edge_label.click(click_action);function double_click_action(){GraphEdge.double_click_callback(self);}
edge.dblclick(double_click_action);edge_label.dblclick(double_click_action);this.label_enable=label_enable;this.label_disable=label_disable;this.update=update;this.remove=remove;this.is_loop=function(){return start==end;};this.get_start=function(){return start;};this.get_end=function(){return end;};}
GraphEdge.double_click_callback=function(edge){console.log("double click from edge:",edge);};GraphEdge.creation_callback=function(start,end){var edge_prop={};edge_prop.label='new edge!';return edge_prop;};GraphEdge.new_edge_callback=function(new_edge){};GraphEdge.destruction_callback=function(edge){return true;};function wordwrap(str,width){width=width||32;var cut=true;var brk='\n';if(!str){return str;}
var regex='.{1,'+width+'}(\\s|$)'+(cut?'|.{'+width+'}|.+$':'|\\S+?(\\s|$)');return str.match(new RegExp(regex,'g')).join(brk);}
window.CuteGraph=Graph;window.CuteNode=GraphNode;window.CuteEdge=GraphEdge;window.CuteGraph.wordwrap=wordwrap;})(window);;

/* /web_diagram/static/src/js/diagram_model.js defined in bundle 'web.assets_backend' */
odoo.define('web_diagram.DiagramModel',function(require){"use strict";var AbstractModel=require('web.AbstractModel');var DiagramModel=AbstractModel.extend({get:function(){return $.extend(true,{},{labels:this.labels,nodes:this.datanodes,edges:this.edges,node_model:this.node_model,parent_field:this.parent_field,res_id:this.res_id,connector_model:this.connector_model,connectors:this.connectors,});},load:function(params){this.modelName=params.modelName;this.res_id=params.res_id;this.node_model=params.node_model;this.connector_model=params.connector_model;this.connectors=params.connectors;this.nodes=params.nodes;this.visible_nodes=params.visible_nodes;this.invisible_nodes=params.invisible_nodes;this.node_fields_string=params.node_fields_string;this.connector_fields_string=params.connector_fields_string;this.labels=params.labels;return this._fetchDiagramInfo();},reload:function(){return this._fetchDiagramInfo();},_fetchDiagramInfo:function(){var self=this;return this._rpc({route:'/web_diagram/diagram/get_diagram_info',params:{id:this.res_id,model:this.modelName,node:this.node_model,connector:this.connector_model,src_node:this.connectors.attrs.source,des_node:this.connectors.attrs.destination,label:this.connectors.attrs.label||false,bgcolor:this.nodes.attrs.bgcolor,shape:this.nodes.attrs.shape,visible_nodes:this.visible_nodes,invisible_nodes:this.invisible_nodes,node_fields_string:this.node_fields_string,connector_fields_string:this.connector_fields_string,},}).then(function(data){self.datanodes=data.nodes;self.edges=data.conn;self.parent_field=data.parent_field;});},});return DiagramModel;});;

/* /web_diagram/static/src/js/diagram_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web_diagram.DiagramController',function(require){"use strict";var AbstractController=require('web.AbstractController');var core=require('web.core');var Dialog=require('web.Dialog');var view_dialogs=require('web.view_dialogs');var _t=core._t;var QWeb=core.qweb;var FormViewDialog=view_dialogs.FormViewDialog;var DiagramController=AbstractController.extend({className:'o_diagram_view',custom_events:{add_edge:'_onAddEdge',edit_edge:'_onEditEdge',edit_node:'_onEditNode',remove_edge:'_onRemoveEdge',remove_node:'_onRemoveNode',},init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.domain=params.domain||[];this.context=params.context;this.ids=params.ids;this.currentId=params.currentId;},renderButtons:function($node){this.$buttons=$(QWeb.render("DiagramView.buttons",{widget:this}));this.$buttons.on('click','.o_diagram_new_button',this._addNode.bind(this));this.$buttons.appendTo($node);},_addNode:function(){var state=this.model.get();var pop=new FormViewDialog(this,{res_model:state.node_model,domain:this.domain,context:this.context,title:_.str.sprintf("%s %s",_t("Create:"),_t('Activity')),disable_multiple_selection:true,on_saved:this.reload.bind(this,{}),}).open();pop.opened().then(function(){var changes={};changes[state.parent_field]={id:state.res_id};pop.form_view.trigger_up('field_changed',{dataPointID:pop.form_view.handle,changes:changes,});});},_onAddEdge:function(event){var self=this;var state=this.model.get();var pop=new FormViewDialog(self,{res_model:state.connector_model,domain:this.domain,context:this.context,title:_.str.sprintf("%s %s",_t("Create:"),_t('Transition')),disable_multiple_selection:true,}).open();pop.opened().then(function(){var changes={};changes[state.connectors.attrs.source]={id:event.data.source_id};changes[state.connectors.attrs.destination]={id:event.data.dest_id};pop.form_view.trigger_up('field_changed',{dataPointID:pop.form_view.handle,changes:changes,});});pop.on('closed',this,this.reload.bind(this,{}));},_onEditEdge:function(event){var state=this.model.get();new FormViewDialog(this,{res_model:state.connector_model,res_id:parseInt(event.data.id,10),context:this.context,title:_.str.sprintf("%s %s",_t("Open:"),_t('Transition')),on_saved:this.reload.bind(this,{}),}).open();},_onEditNode:function(event){var state=this.model.get();new FormViewDialog(this,{res_model:state.node_model,res_id:event.data.id,context:this.context,title:_.str.sprintf("%s %s",_t("Open:"),_t('Activity')),on_saved:this.reload.bind(this,{}),}).open();},_onRemoveEdge:function(event){var self=this;Dialog.confirm(this,(_t("Are you sure you want to remove this transition?")),{confirm_callback:function(){var state=self.model.get();self._rpc({model:state.connector_model,method:'unlink',args:[event.data.id],}).then(self.reload.bind(self,{}));},});},_onRemoveNode:function(event){var self=this;var msg=_t("Are you sure you want to remove this node ? This will remove its connected transitions as well.");Dialog.confirm(this,(msg),{confirm_callback:function(){var state=self.model.get();self._rpc({model:state.node_model,method:'unlink',args:[event.data.id],}).then(self.reload.bind(self,{}));},});},});return DiagramController;});;

/* /web_diagram/static/src/js/diagram_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web_diagram.DiagramRenderer',function(require){"use strict";var AbstractRenderer=require('web.AbstractRenderer');var DiagramRenderer=AbstractRenderer.extend({template:'DiagramView',start:function(){var $header=this.$el.filter('.o_diagram_header');_.each(this.state.labels,function(label){$header.append($('<span>').html(label));});this.$diagram_container=this.$el.filter('.o_diagram');return this._super.apply(this,arguments);},_render:function(){var self=this;var nodes=this.state.nodes;var edges=this.state.edges;var id_to_node={};var style={edge_color:"#A0A0A0",edge_label_color:"#555",edge_label_font_size:10,edge_width:2,edge_spacing:100,edge_loop_radius:100,node_label_color:"#333",node_label_font_size:12,node_outline_color:"#333",node_outline_width:1,node_selected_color:"#0097BE",node_selected_width:2,node_size_x:110,node_size_y:80,connector_active_color:"#FFF",connector_radius:4,close_button_radius:8,close_button_color:"#333",close_button_x_color:"#FFF",gray:"#DCDCDC",white:"#FFF",viewport_margin:50};this.$diagram_container.empty();var $div=$('<div>').css({position:'absolute',top:-10000,right:-10000}).appendTo($('body'));var r=new Raphael($div[0],'100%','100%');var graph=new CuteGraph(r,style,this.$diagram_container[0]);_.each(nodes,function(node){var n=new CuteNode(graph,node.x+50,node.y+50,CuteGraph.wordwrap(node.name,14),node.shape==='rectangle'?'rect':'circle',node.color==='white'?style.white:style.gray);n.id=node.id;id_to_node[node.id]=n;});_.each(edges,function(edge){var e=new CuteEdge(graph,CuteGraph.wordwrap(edge.signal,32),id_to_node[edge.s_id],id_to_node[edge.d_id]||id_to_node[edge.s_id]);e.id=edge.id;});$div.contents().appendTo(this.$diagram_container);$div.remove();CuteNode.double_click_callback=function(cutenode){self.trigger_up('edit_node',{id:cutenode.id});};CuteNode.destruction_callback=function(cutenode){self.trigger_up('remove_node',{id:cutenode.id});return Promise.reject();};CuteEdge.double_click_callback=function(cuteedge){self.trigger_up('edit_edge',{id:cuteedge.id});};CuteEdge.creation_callback=function(node_start,node_end){return{label:''};};CuteEdge.new_edge_callback=function(cuteedge){self.trigger_up('add_edge',{source_id:cuteedge.get_start().id,dest_id:cuteedge.get_end().id,});};CuteEdge.destruction_callback=function(cuteedge){self.trigger_up('remove_edge',{id:cuteedge.id});return Promise.reject();};return this._super.apply(this,arguments);},});return DiagramRenderer;});;

/* /web_diagram/static/src/js/diagram_view.js defined in bundle 'web.assets_backend' */
odoo.define('web_diagram.DiagramView',function(require){"use strict";var BasicView=require('web.BasicView');var core=require('web.core');var DiagramModel=require('web_diagram.DiagramModel');var DiagramRenderer=require('web_diagram.DiagramRenderer');var DiagramController=require('web_diagram.DiagramController');var _lt=core._lt;var DiagramView=BasicView.extend({display_name:_lt('Diagram'),icon:'fa-code-fork',multi_record:false,withSearchBar:false,searchMenuTypes:[],jsLibs:[['/web_diagram/static/lib/js/jquery.mousewheel.js','/web_diagram/static/lib/js/raphael.js',]],config:_.extend({},BasicView.prototype.config,{Model:DiagramModel,Renderer:DiagramRenderer,Controller:DiagramController,}),viewType:'diagram',init:function(viewInfo,params){this._super.apply(this,arguments);var self=this;var arch=this.arch;function toTitleCase(str){return str.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase();});}
var nodes=arch.children[0];var connectors=arch.children[1];var node_model=nodes.attrs.object;var connector_model=connectors.attrs.object;var labels=_.map(_.where(arch.children,{tag:'label'}),function(label){return label.attrs.string;});var invisible_nodes=[];var visible_nodes=[];var node_fields_string=[];_.each(nodes.children,function(child){if(child.attrs.invisible==='1')
invisible_nodes.push(child.attrs.name);else{var fieldString=self.fields[child.attrs.name].string||toTitleCase(child.attrs.name);visible_nodes.push(child.attrs.name);node_fields_string.push(fieldString);}});var connector_fields_string=_.map(connectors.children,function(conn){return self.fields[conn.attrs.name].string||toTitleCase(conn.attrs.name);});this.loadParams=_.extend({},this.loadParams,{currentId:params.currentId,nodes:nodes,labels:labels,invisible_nodes:invisible_nodes,visible_nodes:visible_nodes,node_fields_string:node_fields_string,node_model:node_model,connectors:connectors,connector_model:connector_model,connector_fields_string:connector_fields_string,});this.controllerParams=_.extend({},this.controllerParams,{domain:params.domain,context:params.context,ids:params.ids,currentId:params.currentId,});},getController:function(){var oldDefine=window.define;delete window.define;return this._super.apply(this,arguments).then(function(view){window.define=oldDefine;return view;});},});return DiagramView;});;

/* /web_diagram/static/src/js/view_registry.js defined in bundle 'web.assets_backend' */
odoo.define('web_diagram.view_registry',function(require){"use strict";var view_registry=require('web.view_registry');var DiagramView=require('web_diagram.DiagramView');view_registry.add('diagram',DiagramView);});;

/* /web_editor/static/src/js/backend/field_html.js defined in bundle 'web.assets_backend' */
odoo.define('web_editor.field.html',function(require){'use strict';var ajax=require('web.ajax');var basic_fields=require('web.basic_fields');var config=require('web.config');var core=require('web.core');var Wysiwyg=require('web_editor.wysiwyg.root');var field_registry=require('web.field_registry');require('web._field_registry');var _lt=core._lt;var TranslatableFieldMixin=basic_fields.TranslatableFieldMixin;var QWeb=core.qweb;var assetsLoaded;var jinjaRegex=/(^|\n)\s*%\s(end|set\s)/;var FieldHtml=basic_fields.DebouncedField.extend(TranslatableFieldMixin,{description:_lt("Html"),className:'oe_form_field oe_form_field_html',supportedFieldTypes:['html'],custom_events:{wysiwyg_focus:'_onWysiwygFocus',wysiwyg_blur:'_onWysiwygBlur',wysiwyg_change:'_onChange',wysiwyg_attachment:'_onAttachmentChange',},willStart:function(){var self=this;this.isRendered=false;this._onUpdateIframeId='onLoad_'+_.uniqueId('FieldHtml');var defAsset;if(this.nodeOptions.cssReadonly){defAsset=ajax.loadAsset(this.nodeOptions.cssReadonly);}
if(!assetsLoaded){assetsLoaded=new Promise(function(resolve){var wysiwyg=new Wysiwyg(self,{});wysiwyg.attachTo($('<textarea>')).then(function(){wysiwyg.destroy();resolve();});});}
return Promise.all([this._super(),assetsLoaded,defAsset]);},destroy:function(){delete window.top[this._onUpdateIframeId];if(this.$iframe){this.$iframe.remove();}
this._super();},activate:function(options){if(this.wysiwyg){this.wysiwyg.focus();return true;}},commitChanges:function(){var self=this;if(config.isDebug()&&this.mode==='edit'){var layoutInfo=$.summernote.core.dom.makeLayoutInfo(this.wysiwyg.$editor);$.summernote.pluginEvents.codeview(undefined,undefined,layoutInfo,false);}
if(this.mode=="readonly"||!this.isRendered){return this._super();}
var _super=this._super.bind(this);return this.wysiwyg.saveCroppedImages(this.$content).then(function(){return self.wysiwyg.save(self.nodeOptions).then(function(result){self._isDirty=result.isDirty;_super();});});},isSet:function(){var value=this.value&&this.value.split('&nbsp;').join('').replace(/\s/g,'');return value&&value!=="<p></p>"&&value!=="<p><br></p>"&&value.match(/\S/);},getFocusableElement:function(){return this.$target||$();},reset:function(record,event){this._reset(record,event);var value=this.value;if(this.nodeOptions.wrapper){value=this._wrap(value);}
value=this._textToHtml(value);if(!event||event.target!==this){if(this.mode==='edit'){this.wysiwyg.setValue(value);}else{this.$content.html(value);}}
return Promise.resolve();},_getValue:function(){var value=this.$target.val();if(this.nodeOptions.wrapper){return this._unWrap(value);}
return value;},_createWysiwygIntance:function(){var self=this;this.wysiwyg=new Wysiwyg(this,this._getWysiwygOptions());this.wysiwyg.__extraAssetsForIframe=this.__extraAssetsForIframe||[];return this.wysiwyg.attachTo(this.$target).then(function(){self.$content=self.wysiwyg.$editor.closest('body, odoo-wysiwyg-container');self._onLoadWysiwyg();self.isRendered=true;});},_getWysiwygOptions:function(){var self=this;return Object.assign({},this.nodeOptions,{recordInfo:{context:this.record.getContext(this.recordParams),res_model:this.model,res_id:this.res_id,},noAttachment:this.nodeOptions['no-attachment'],inIframe:!!this.nodeOptions.cssEdit,iframeCssAssets:this.nodeOptions.cssEdit,snippets:this.nodeOptions.snippets,tabsize:0,height:180,generateOptions:function(options){var toolbar=options.toolbar||options.airPopover||{};var para=_.find(toolbar,function(item){return item[0]==='para';});if(para&&para[1]&&para[1].indexOf('checklist')===-1){para[1].splice(2,0,'checklist');}
if(config.isDebug()){options.codeview=true;var view=_.find(toolbar,function(item){return item[0]==='view';});if(view){if(!view[1].includes('codeview')){view[1].splice(-1,0,'codeview');}}else{toolbar.splice(-1,0,['view',['codeview']]);}}
if(self.model==="mail.compose.message"||self.model==="mailing.mailing"){options.noVideos=true;}
options.prettifyHtml=false;return options;},});},_onAttachmentChange:function(attachments){if(!this.fieldNameAttachment){return;}
this.trigger_up('field_changed',{dataPointID:this.dataPointID,changes:_.object([this.fieldNameAttachment],[{operation:'ADD_M2M',ids:attachments.data,}])});},_renderEdit:function(){var value=this._textToHtml(this.value);if(this.nodeOptions.wrapper){value=this._wrap(value);}
this.$target=$('<textarea>').val(value).hide();this.$target.appendTo(this.$el);var fieldNameAttachment=_.chain(this.recordData).pairs().find(function(value){return _.isObject(value[1])&&value[1].model==="ir.attachment";}).first().value();if(fieldNameAttachment){this.fieldNameAttachment=fieldNameAttachment;}
if(this.nodeOptions.cssEdit){this._createWysiwygIntance();}else{return this._createWysiwygIntance();}},_renderReadonly:function(){var self=this;var value=this._textToHtml(this.value);if(this.nodeOptions.wrapper){value=this._wrap(value);}
this.$el.empty();var resolver;var def=new Promise(function(resolve){resolver=resolve;});if(this.nodeOptions.cssReadonly){this.$iframe=$('<iframe class="o_readonly"/>');this.$iframe.appendTo(this.$el);var avoidDoubleLoad=0;this.$iframe.data('loadDef',def);window.top[this._onUpdateIframeId]=function(_avoidDoubleLoad){if(_avoidDoubleLoad!==avoidDoubleLoad){console.warn('Wysiwyg iframe double load detected');return;}
self.$content=$('#iframe_target',self.$iframe[0].contentWindow.document.body);resolver();};this.$iframe.on('load',function onLoad(){var _avoidDoubleLoad=++avoidDoubleLoad;ajax.loadAsset(self.nodeOptions.cssReadonly).then(function(asset){if(_avoidDoubleLoad!==avoidDoubleLoad){console.warn('Wysiwyg immediate iframe double load detected');return;}
var cwindow=self.$iframe[0].contentWindow;try{cwindow.document;}catch(e){return;}
cwindow.document.open("text/html","replace").write('<head>'+'<meta charset="utf-8"/>'+'<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>\n'+'<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>\n'+
_.map(asset.cssLibs,function(cssLib){return'<link type="text/css" rel="stylesheet" href="'+cssLib+'"/>';}).join('\n')+'\n'+
_.map(asset.cssContents,function(cssContent){return'<style type="text/css">'+cssContent+'</style>';}).join('\n')+'\n'+'</head>\n'+'<body class="o_in_iframe o_readonly">\n'+'<div id="iframe_target">'+value+'</div>\n'+'<script type="text/javascript">'+'if (window.top.'+self._onUpdateIframeId+') {'+'window.top.'+self._onUpdateIframeId+'('+_avoidDoubleLoad+')'+'}'+'</script>\n'+'</body>');var height=cwindow.document.body.scrollHeight;self.$iframe.css('height',Math.max(30,Math.min(height,500))+'px');});});}else{this.$content=$('<div class="o_readonly"/>').html(value);this.$content.appendTo(this.$el);resolver();}
def.then(function(){self.$content.on('click','ul.o_checklist > li',self._onReadonlyClickChecklist.bind(self));});},_textToHtml:function(text){var value=text||"";if(jinjaRegex.test(value)){return value;}
try{$(text)[0].innerHTML;}catch(e){if(value.match(/^\s*$/)){value='<p><br/></p>';}else{value="<p>"+value.split(/<br\/?>/).join("<br/></p><p>")+"</p>";value=value.replace(/<p><\/p>/g,'').replace('<p><p>','<p>').replace('<p><p ','<p ').replace('</p></p>','</p>');}}
return value;},_unWrap:function(html){var $wrapper=$(html).find('#wrapper');return $wrapper.length?$wrapper.html():html;},_wrap:function(html){return $(QWeb.render(this.nodeOptions.wrapper)).find('#wrapper').html(html).end().prop('outerHTML');},_onChange:function(ev){this._doDebouncedAction.apply(this,arguments);var $lis=this.$content.find('.note-editable ul.o_checklist > li:not(:has(> ul.o_checklist))');if(!$lis.length){return;}
var max=0;var ids=[];$lis.map(function(){var checklistId=parseInt(($(this).attr('id')||'0').replace(/^checklist-id-/,''));if(ids.indexOf(checklistId)===-1){if(checklistId>max){max=checklistId;}
ids.push(checklistId);}else{$(this).removeAttr('id');}});$lis.not('[id]').each(function(){$(this).attr('id','checklist-id-'+(++max));});},_onKeydown:function(ev){if(ev.which===$.ui.keyCode.ENTER){ev.stopPropagation();return;}
this._super.apply(this,arguments);},_onReadonlyClickChecklist:function(ev){var self=this;if(ev.offsetX>0){return;}
ev.stopPropagation();ev.preventDefault();var checked=$(ev.target).hasClass('o_checked');var checklistId=parseInt(($(ev.target).attr('id')||'0').replace(/^checklist-id-/,''));this._rpc({route:'/web_editor/checklist',params:{res_model:this.model,res_id:this.res_id,filename:this.name,checklistId:checklistId,checked:!checked,},}).then(function(value){self._setValue(value);});},_onLoadWysiwyg:function(){var $button=this._renderTranslateButton();$button.css({'font-size':'15px',position:'absolute',right:'+5px',top:'+5px',});this.$el.append($button);},_onWysiwygBlur:function(ev){ev.stopPropagation();this._doAction();if(ev.data.key==='TAB'){this.trigger_up('navigation_move',{direction:ev.data.shiftKey?'left':'right',});}},_onWysiwygFocus:function(ev){},});field_registry.add('html',FieldHtml);return FieldHtml;});;

/* /web_editor/static/src/js/backend/convert_inline.js defined in bundle 'web.assets_backend' */
odoo.define('web_editor.convertInline',function(require){'use strict';var FieldHtml=require('web_editor.field.html');function getMatchedCSSRules(a){var i,r,k;var doc=a.ownerDocument;var rulesCache=a.ownerDocument._rulesCache||(a.ownerDocument._rulesCache=[]);if(!rulesCache.length){var sheets=doc.styleSheets;for(i=sheets.length-1;i>=0;i--){var rules;try{rules=sheets[i].rules||sheets[i].cssRules;}catch(e){console.warn("Can't read the css rules of: "+sheets[i].href,e);continue;}
if(rules){for(r=rules.length-1;r>=0;r--){var selectorText=rules[r].selectorText;if(selectorText&&rules[r].cssText&&selectorText!=='*'&&selectorText.indexOf(':hover')===-1&&selectorText.indexOf(':before')===-1&&selectorText.indexOf(':after')===-1&&selectorText.indexOf(':active')===-1&&selectorText.indexOf(':link')===-1&&selectorText.indexOf('::')===-1&&selectorText.indexOf("'")===-1){var st=selectorText.split(/\s*,\s*/);for(k=0;k<st.length;k++){rulesCache.push({'selector':st[k],'style':rules[r].style});}}}}}
rulesCache.reverse();}
var css=[];var style;a.matches=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector;for(r=0;r<rulesCache.length;r++){if(a.matches(rulesCache[r].selector)){style=rulesCache[r].style;if(style.parentRule){var style_obj={};var len;for(k=0,len=style.length;k<len;k++){if(style[k].indexOf('animation')!==-1){continue;}
style_obj[style[k]]=style[style[k].replace(/-(.)/g,function(a,b){return b.toUpperCase();})];if(new RegExp(style[k]+'\s*:[^:;]+!important').test(style.cssText)){style_obj[style[k]]+=' !important';}}
rulesCache[r].style=style=style_obj;}
css.push([rulesCache[r].selector,style]);}}
function specificity(selector){var a=0;selector=selector.replace(/#[a-z0-9_-]+/gi,function(){a++;return'';});var b=0;selector=selector.replace(/(\.[a-z0-9_-]+)|(\[.*?\])/gi,function(){b++;return'';});var c=0;selector=selector.replace(/(^|\s+|:+)[a-z0-9_-]+/gi,function(a){if(a.indexOf(':not(')===-1)c++;return'';});return a*100+b*10+c;}
css.sort(function(a,b){return specificity(a[0])-specificity(b[0]);});style={};_.each(css,function(v,k){_.each(v[1],function(v,k){if(v&&_.isString(v)&&k.indexOf('-webkit')===-1&&(!style[k]||style[k].indexOf('important')===-1||v.indexOf('important')!==-1)){style[k]=v;}});});_.each(style,function(v,k){if(v.indexOf('important')!==-1){style[k]=v.slice(0,v.length-11);}});if(style.display==='block'){delete style.display;}
_.each([{property:'margin'},{property:'padding'},{property:'border',propertyEnd:'-style',defaultValue:'none'},],function(propertyInfo){var p=propertyInfo.property;var e=propertyInfo.propertyEnd||'';var defVal=propertyInfo.defaultValue||0;if(style[p+'-top'+e]||style[p+'-right'+e]||style[p+'-bottom'+e]||style[p+'-left'+e]){if(style[p+'-top'+e]===style[p+'-right'+e]&&style[p+'-top'+e]===style[p+'-bottom'+e]&&style[p+'-top'+e]===style[p+'-left'+e]){style[p+e]=style[p+'-top'+e];}
else{style[p+e]=(style[p+'-top'+e]||defVal)+' '+(style[p+'-right'+e]||defVal)+' '+(style[p+'-bottom'+e]||defVal)+' '+(style[p+'-left'+e]||defVal);if(style[p+e].indexOf('inherit')!==-1||style[p+e].indexOf('initial')!==-1){delete style[p+e];return;}}
delete style[p+'-top'+e];delete style[p+'-right'+e];delete style[p+'-bottom'+e];delete style[p+'-left'+e];}});if(style['border-bottom-left-radius']){style['border-radius']=style['border-bottom-left-radius'];delete style['border-bottom-left-radius'];delete style['border-bottom-right-radius'];delete style['border-top-left-radius'];delete style['border-top-right-radius'];}
_.each(_.keys(style),function(k){if(k.indexOf('border')!==-1&&style[k]==='initial'){delete style[k];}});if(style['text-decoration-line']){style['text-decoration']=style['text-decoration-line'];delete style['text-decoration-line'];delete style['text-decoration-color'];delete style['text-decoration-style'];delete style['text-decoration-thickness'];}
if(style['text-align']==='inherit'){var $el=$(a).parent();do{var align=$el.css('text-align');if(_.indexOf(['left','right','center','justify'],align)>=0){style['text-align']=align;break;}
$el=$el.parent();}while($el.length&&!$el.is('html'));}
return style;}
function fontToImg($editable){var fonts=odoo.__DEBUG__.services["wysiwyg.fonts"];$editable.find('.fa').each(function(){var $font=$(this);var icon,content;_.find(fonts.fontIcons,function(font){return _.find(fonts.getCssSelectors(font.parser),function(data){if($font.is(data.selector.replace(/::?before/g,''))){icon=data.names[0].split('-').shift();content=data.css.match(/content:\s*['"]?(.)['"]?/)[1];return true;}});});if(content){var color=$font.css('color').replace(/\s/g,'');$font.replaceWith($('<img/>',{src:_.str.sprintf('/web_editor/font_to_img/%s/%s/%s',content.charCodeAt(0),window.encodeURI(color),Math.max(1,Math.round($font.height()))),'data-class':$font.attr('class'),'data-style':$font.attr('style'),class:$font.attr('class').replace(new RegExp('(^|\\s+)'+icon+'(-[^\\s]+)?','gi'),''),style:$font.attr('style'),}).css({height:'auto',width:'auto'}));}else{$font.remove();}});}
function imgToFont($editable){$editable.find('img[src*="/web_editor/font_to_img/"]').each(function(){var $img=$(this);$img.replaceWith($('<span/>',{class:$img.data('class'),style:$img.data('style')}));});}
function applyOverDescendants(node,func){node=node.firstChild;while(node){if(node.nodeType===1){func(node);applyOverDescendants(node,func);}
var $node=$(node);if(node.nodeName==='A'&&$node.hasClass('btn')&&!$node.children().length&&$(node).parents('.o_outlook_hack').length){node=$(node).parents('.o_outlook_hack')[0];}
else if(node.nodeName==='IMG'&&$node.parent('p').hasClass('o_outlook_hack')){node=$node.parent()[0];}
node=node.nextSibling;}}
function classToStyle($editable){applyOverDescendants($editable[0],function(node){var $target=$(node);var css=getMatchedCSSRules(node);var style=$target.attr('style')||'';_.each(css,function(v,k){if(!(new RegExp('(^|;)\s*'+k).test(style))){style=k+':'+v+';'+style;}});if(_.isEmpty(style)){$target.removeAttr('style');}else{$target.attr('style',style);}
if(node.nodeName==='TD'&&!node.childNodes.length){node.innerHTML='&nbsp;';}
if(node.nodeName==='A'&&$target.hasClass('btn')&&!$target.hasClass('btn-link')&&!$target.children().length){var $hack=$('<table class="o_outlook_hack" style="display: inline-table;vertical-align:middle"><tr><td></td></tr></table>');$hack.find('td').attr('height',$target.outerHeight()).css({'text-align':$target.parent().css('text-align'),'margin':$target.css('padding'),'border-radius':$target.css('border-radius'),'background-color':$target.css('background-color'),});$target.after($hack);$target.appendTo($hack.find('td'));node=$hack[0].previousSibling;if(node&&node.nodeType===Node.TEXT_NODE&&!node.textContent.match(/\S/)){$(node).remove();}
node=$hack[0].nextSibling;if(node&&node.nodeType===Node.TEXT_NODE&&!node.textContent.match(/\S/)){$(node).remove();}}
else if(node.nodeName==='IMG'&&$target.is('.mx-auto.d-block')){$target.wrap('<p class="o_outlook_hack" style="text-align:center;margin:0"/>');}});}
function styleToClass($editable){$editable.find('.o_outlook_hack').each(function(){$(this).after($('a,img',this));}).remove();var $c=$('<span/>').appendTo($editable[0].ownerDocument.body);applyOverDescendants($editable[0],function(node){var $target=$(node);var css=getMatchedCSSRules(node);var style='';_.each(css,function(v,k){if(!(new RegExp('(^|;)\s*'+k).test(style))){style=k+':'+v+';'+style;}});css=($c.attr('style',style).attr('style')||'').split(/\s*;\s*/);style=($target.attr('style')||'').replace(/\s*:\s*/,':').replace(/\s*;\s*/,';');_.each(css,function(v){style=style.replace(v,'');});style=style.replace(/;+(\s;)*/g,';').replace(/^;/g,'');if(style!==''){$target.attr('style',style);}else{$target.removeAttr('style');}});$c.remove();}
function attachmentThumbnailToLinkImg($editable){$editable.find('a[href*="/web/content/"][data-mimetype]').filter(':empty, :containsExact( )').each(function(){var $link=$(this);var $img=$('<img/>').attr('src',$link.css('background-image').replace(/(^url\(['"])|(['"]\)$)/g,'')).css('height',Math.max(1,$link.height())+'px').css('width',Math.max(1,$link.width())+'px');$link.prepend($img);});}
function linkImgToAttachmentThumbnail($editable){$editable.find('a[href*="/web/content/"][data-mimetype] > img').remove();}
FieldHtml.include({commitChanges:function(){if(this.nodeOptions['style-inline']&&this.mode==="edit"){this._toInline();}
return this._super();},_toInline:function(){var $editable=this.wysiwyg.getEditable();var html=this.wysiwyg.getValue({'style-inline':true});$editable.html(html);attachmentThumbnailToLinkImg($editable);fontToImg($editable);classToStyle($editable);_.each(['width','height'],function(attribute){$editable.find('img[style*="width"], img[style*="height"]').attr(attribute,function(){return $(this)[attribute]();}).css(attribute,function(){return $(this).get(0).style[attribute]||'auto';});});this.wysiwyg.setValue($editable.html(),{notifyChange:false,});},_fromInline:function(){var $editable=this.wysiwyg.getEditable();var html=this.wysiwyg.getValue();$editable.html(html);styleToClass($editable);imgToFont($editable);linkImgToAttachmentThumbnail($editable);$editable.find('img[style*="width"], img[style*="height"]').removeAttr('height width');this.wysiwyg.setValue($editable.html(),{notifyChange:false,});},_onLoadWysiwyg:function(){if(this.nodeOptions['style-inline']&&this.mode==="edit"){this._fromInline();}
this._super();},});return{fontToImg:fontToImg,imgToFont:imgToFont,classToStyle:classToStyle,styleToClass:styleToClass,attachmentThumbnailToLinkImg:attachmentThumbnailToLinkImg,linkImgToAttachmentThumbnail:linkImgToAttachmentThumbnail,};});;

/* /web_enterprise/static/src/js/apps.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.apps',function(require){"use strict";var Apps=require('web.Apps');Apps.include({_on_update_count:function(){},});});;

/* /web_enterprise/static/src/js/control_panel_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.ControlPanelRenderer',function(require){"use strict";var config=require('web.config');var ControlPanelRenderer=require('web.ControlPanelRenderer');ControlPanelRenderer.include({_renderBreadcrumbsItem:function(bc,index,length){var $bc=this._super.apply(this,arguments);var isLast=(index===length-1);var isBeforeLast=(index===length-2);$bc.toggleClass('d-none d-md-inline-block',!isLast&&!isBeforeLast).toggleClass('o_back_button',isBeforeLast).toggleClass('btn btn-secondary',isBeforeLast&&config.device.isMobile);return $bc;},});});;

/* /web_enterprise/static/src/js/home_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.HomeMenu',function(require){"use strict";var config=require('web.config');var core=require('web.core');var utils=require('web.utils');var Widget=require('web.Widget');var QWeb=core.qweb;var NBR_ICONS=6;var HomeMenu=Widget.extend({template:'HomeMenu',events:{'click .o_menuitem':'_onMenuitemClick','input input.o_menu_search_input':'_onMenuSearchInput','compositionstart':'_onCompositionStart','compositionend':'_onCompositionEnd','blur input.o_menu_search_input':'_onInputBlur',},init:function(parent,menuData){this._super.apply(this,arguments);this._menuData=this._processMenuData(menuData);this._state=this._getInitialState();},start:function(){this.$input=this.$('input');this.$menuSearch=this.$('.o_menu_search');this.$mainContent=this.$('.o_home_menu_scrollable');return this._super.apply(this,arguments);},on_attach_callback:function(){core.bus.on("keydown",this,this._onKeydown);this._state=this._getInitialState();this.$input.val('');this.$input.focus();this._render();},on_detach_callback:function(){core.bus.off("keydown",this,this._onKeydown);},getAppIndex:function(){return this._state.focus<this._state.apps.length?this._state.focus:null;},getMenuIndex:function(){var state=this._state;return state.focus>=this._state.apps.length?state.focus-this._state.apps.length:null;},_getInitialState:function(){return{apps:_.where(this._menuData,{is_app:true}),menuItems:[],focus:null,isComposing:false,};},_openMenu:function(menu){this.trigger_up(menu.is_app?'app_clicked':'menu_clicked',{menu_id:menu.id,action_id:menu.action,});if(!menu.is_app){core.bus.trigger('change_menu_section',menu.menu_id);}},_processMenuData:function(menuData){var result=[];utils.traversePath(menuData,function(menuItem,parents){if(!menuItem.id||!menuItem.action){return;}
var item={parents:_.pluck(parents.slice(1),'name').join(' / '),label:menuItem.name,id:menuItem.id,xmlid:menuItem.xmlid,action:menuItem.action?menuItem.action.split(',')[1]:'',is_app:!menuItem.parent_id,web_icon:menuItem.web_icon,};if(!menuItem.parent_id){if(menuItem.web_icon_data){item.web_icon_data=('data:image/png;base64,'+menuItem.web_icon_data).replace(/\s/g,"");}else if(item.web_icon){var iconData=item.web_icon.split(',');item.web_icon={class:iconData[0],color:iconData[1],background:iconData[2],};}else{item.web_icon_data='/web_enterprise/static/src/img/default_icon_app.png';}}else{item.menu_id=parents[1].id;}
result.push(item);});return result;},_render:function(){this.$menuSearch.toggleClass('o_bar_hidden',!this._state.isSearching);this.$mainContent.html(QWeb.render('HomeMenu.Content',{widget:this}));var $focused=this.$mainContent.find('.o_focused');if($focused.length&&!config.device.isMobile){this.$el.scrollTo($focused,{offset:{top:-0.5*this.$el.height()}});}
var offset=window.innerWidth-
(this.$mainContent.offset().left*2+this.$mainContent.outerWidth());if(offset){this.$el.css('padding-left',"+="+offset);}},_update:function(data){var self=this;if(data.search){var options={extract:function(el){return(el.parents+' / '+el.label).split('/').reverse().join('/');}};var searchResults=fuzzy.filter(data.search,this._menuData,options);var results=_.map(searchResults,function(result){return self._menuData[result.index];});this._state=_.extend(this._state,{apps:_.where(results,{is_app:true}),menuItems:_.where(results,{is_app:false}),focus:results.length?0:null,isSearching:true,});}
if(this._state.focus!==null&&'focus'in data){var state=this._state;var nbrApps=state.apps.length;var nbrMenus=state.menuItems.length;var newIndex=data.focus+(state.focus||0);if(newIndex<0){newIndex=nbrApps+nbrMenus-1;}
if(newIndex>=nbrApps+nbrMenus){newIndex=0;}
if(newIndex>=nbrApps&&state.focus<nbrApps&&data.focus>0){if(state.focus+data.focus-(state.focus%data.focus)<nbrApps){newIndex=nbrApps-1;}else{newIndex=nbrApps;}}
if(newIndex<nbrApps&&state.focus>=nbrApps&&data.focus<0){newIndex=nbrApps-(nbrApps%NBR_ICONS);if(newIndex===nbrApps){newIndex=nbrApps-NBR_ICONS;}}
state.focus=newIndex;}
this._render();},_onKeydown:function(ev){var isEditable=ev.target.tagName==="INPUT"||ev.target.tagName==="TEXTAREA"||ev.target.isContentEditable;if(isEditable&&ev.target!==this.$input[0]){return;}
var state=this._state;var elemFocused=state.focus!==null;var appFocused=elemFocused&&state.focus<state.apps.length;var delta=appFocused?NBR_ICONS:1;var $input=this.$input;switch(ev.which){case $.ui.keyCode.DOWN:this._update({focus:elemFocused?delta:0});ev.preventDefault();break;case $.ui.keyCode.RIGHT:if(!elemFocused&&$input.is(':focus')&&$input[0].selectionEnd<$input.val().length){return;}
this._update({focus:elemFocused?1:0});ev.preventDefault();break;case $.ui.keyCode.TAB:if($input.val()===""){return;}
ev.preventDefault();var f=elemFocused?(ev.shiftKey?-1:1):0;this._update({focus:f});break;case $.ui.keyCode.UP:this._update({focus:elemFocused?-delta:0});ev.preventDefault();break;case $.ui.keyCode.LEFT:if(!elemFocused&&$input.is(':focus')&&$input[0].selectionStart>0){return;}
this._update({focus:elemFocused?-1:0});ev.preventDefault();break;case $.ui.keyCode.ENTER:if(elemFocused){var menus=appFocused?state.apps:state.menuItems;var index=appFocused?state.focus:state.focus-state.apps.length;this._openMenu(menus[index]);ev.preventDefault();}
return;case $.ui.keyCode.PAGE_DOWN:case $.ui.keyCode.PAGE_UP:case 16:case 17:case 18:break;case $.ui.keyCode.ESCAPE:this._state=this._getInitialState();this._state.isSearching=$input.val().length>0;$input.val("");this._update({focus:0,search:$input.val()});if(!this._state.isSearching){this.trigger_up('hide_home_menu');}
break;case 67:case 88:if(ev.ctrlKey||ev.metaKey){break;}
default:if(!this.$input.is(':focus')){this.$input.focus();}}},_onCompositionStart:function(ev){this._state.isComposing=true;},_onCompositionEnd:function(ev){this._state.isComposing=false;},_onInputBlur:function(ev){setTimeout(()=>{if(document.activeElement===document.body){this.$input.focus();}},0);},_onMenuitemClick:function(ev){ev.preventDefault();var menuId=$(ev.currentTarget).data('menu');this._openMenu(_.findWhere(this._menuData,{id:menuId}));},_onMenuSearchInput:function(ev){if(!ev.target.value){this._state=this._getInitialState();this._state.isSearching=true;}
this._update({search:ev.target.value,focus:0});}});return HomeMenu;});odoo.define('web_enterprise.ExpirationPanel',function(require){"use strict";var ajax=require('web.ajax');var core=require('web.core');var session=require('web.session');var utils=require('web.utils');var HomeMenu=require('web_enterprise.HomeMenu');var QWeb=core.qweb;HomeMenu.include({events:_.extend(HomeMenu.prototype.events,{'click .oe_instance_buy':'_onEnterpriseBuy','click .oe_instance_renew':'_onEnterpriseRenew','click .oe_instance_upsell':'_onEnterpriseUpsell','click a.oe_instance_register_show':'_onEnterpriseRegisterShow','click #confirm_enterprise_code':'_onEnterpriseCodeSubmit','click .oe_instance_hide_panel':'_onEnterpriseHidePanel','click .check_enterprise_status':'_onEnterpriseCheckStatus','click .oe_contract_send_mail':'_onEnterpriseSendUnlinkEmail',}),start:function(){return this._super.apply(this,arguments).then(this._enterpriseExpirationCheck.bind(this));},_enterpriseExpirationCheck:function(){var self=this;if(!(session.warning)){return;}
var today=new moment();var dbexpirationDate=new moment(session.expiration_date||new moment().add(30,'d'));var duration=moment.duration(dbexpirationDate.diff(today));var options={'diffDays':Math.round(duration.asDays()),'dbexpiration_reason':session.expiration_reason,'warning':session.warning,};self._enterpriseShowPanel(options);},_enterpriseShowPanel:function(options){var self=this;var hideCookie=utils.get_cookie('oe_instance_hide_panel');if((options.diffDays<=30&&!hideCookie)||options.diffDays<=0){var expirationPanel=$(QWeb.render('WebClient.database_expiration_panel',{has_mail:_.includes(session.module_list,'mail'),diffDays:options.diffDays,dbexpiration_reason:options.dbexpiration_reason,warning:options.warning})).insertBefore(self.$menuSearch);if(options.diffDays<=0){expirationPanel.children().addClass('alert-danger');expirationPanel.find('.oe_instance_buy').on('click.widget_events',self.proxy('_onEnterpriseBuy'));expirationPanel.find('.oe_instance_renew').on('click.widget_events',self.proxy('_onEnterpriseRenew'));expirationPanel.find('.oe_instance_upsell').on('click.widget_events',self.proxy('_onEnterpriseUpsell'));expirationPanel.find('.check_enterprise_status').on('click.widget_events',self.proxy('_onEnterpriseCheckStatus'));expirationPanel.find('.oe_instance_hide_panel').hide();$.blockUI({message:expirationPanel.find('.database_expiration_panel')[0],css:{cursor:'auto'},overlayCSS:{cursor:'auto'}});}}},_onEnterpriseBuy:function(){var limitDate=new moment().subtract(15,'days').format("YYYY-MM-DD");this._rpc({model:'res.users',method:'search_count',args:[[["share","=",false],["login_date",">=",limitDate]]],}).then(function(users){window.location=$.param.querystring("https://www.odoo.com/odoo-enterprise/upgrade",{num_users:users});});},_onEnterpriseCheckStatus:function(ev){ev.preventDefault();var self=this;this._rpc({model:'ir.config_parameter',method:'get_param',args:['database.expiration_date'],}).then(function(oldDate){var dbexpirationDate=new moment(oldDate);var duration=moment.duration(dbexpirationDate.diff(new moment()));if(Math.round(duration.asDays())<30){self._rpc({model:'publisher_warranty.contract',method:'update_notification',args:[[]],}).then(function(){self._rpc({model:'ir.config_parameter',method:'get_param',args:['database.expiration_date']}).then(function(dbexpiration_date){$('.oe_instance_register').hide();$('.database_expiration_panel .alert').removeClass('alert-info alert-warning alert-danger');if(dbexpirationDate!==oldDate&&new moment(dbexpirationDate)>new moment()){$.unblockUI();$('.oe_instance_hide_panel').show();$('.database_expiration_panel .alert').addClass('alert-success');$('.valid_date').html(moment(dbexpirationDate).format('LL'));$('.oe_subscription_updated').show();}else{window.location.reload();}});});}});},_onEnterpriseSendUnlinkEmail:function(ev){ev.preventDefault();this._rpc({model:'ir.config_parameter',method:'get_param',args:['database.already_linked_send_mail_url']}).then(function(unlink_mail_send_url){$('.oe_contract_sending_mail').show();$('.oe_contract_sending_mail_success, .oe_contract_sending_mail_fail').hide();ajax.jsonRpc(unlink_mail_send_url,'call',{}).then(function(result){if(result.result){$('.oe_contract_sending_mail').hide();$('.oe_contract_sending_mail_success').show();}
else{$('.oe_contract_sending_mail').hide();$('.oe_contract_sending_mail_fail_reason').text(result.reason);$('.oe_contract_sending_mail_fail').show();}});});},_onEnterpriseCodeSubmit:function(ev){ev.preventDefault();var self=this;var enterpriseCode=$('.database_expiration_panel').find('#enterprise_code').val();if(!enterpriseCode){var $c=$('#enterprise_code');$c.attr('placeholder',$c.attr('title'));return;}
Promise.all([this._rpc({model:'ir.config_parameter',method:'get_param',args:['database.expiration_date']}),this._rpc({model:'ir.config_parameter',method:'set_param',args:['database.enterprise_code',enterpriseCode]})]).then(function(results){var oldDate=results[0];utils.set_cookie('oe_instance_hide_panel','',-1);self._rpc({model:'publisher_warranty.contract',method:'update_notification',args:[[]],}).then(function(){$.unblockUI();Promise.all([self._rpc({model:'ir.config_parameter',method:'get_param',args:['database.expiration_date']}),self._rpc({model:'ir.config_parameter',method:'get_param',args:['database.expiration_reason']}),self._rpc({model:'ir.config_parameter',method:'get_param',args:['database.already_linked_subscription_url']}),self._rpc({model:'ir.config_parameter',method:'get_param',args:['database.already_linked_email']})]).then(function(results){var dbexpirationDate=results[0];var dbalready_linked_subscription_url=results[2];var dbalready_linked_email=results[3];$('.oe_instance_register').hide();$('.oe_contract_email_block').hide();$('.oe_contract_no_email_block').hide();$('.database_expiration_panel .alert').removeClass('alert-info alert-warning alert-danger');if(dbexpirationDate!==oldDate&&!dbalready_linked_subscription_url){$('.oe_instance_hide_panel').show();$('.database_expiration_panel .alert').addClass('alert-success');$('.valid_date').html(moment(dbexpirationDate).format('LL'));$('.oe_instance_success').show();}else if(dbalready_linked_subscription_url){$('.database_expiration_panel .alert').addClass('alert-danger');$('.oe_database_already_linked, .oe_instance_register_form').show();$('.oe_contract_sending_mail, .oe_contract_sending_mail_success, .oe_contract_sending_mail_fail').hide();$('.oe_contract_link').attr('href',dbalready_linked_subscription_url).text(dbalready_linked_subscription_url);if(dbalready_linked_email.length>0){$('.oe_contract_email_block').show();$('.oe_contract_email').text(dbalready_linked_email);}else{$('.oe_contract_no_email_block').show();}
$('#confirm_enterprise_code').html('Retry');}else{$('.database_expiration_panel .alert').addClass('alert-danger');$('.oe_instance_error, .oe_instance_register_form').show();$('#confirm_enterprise_code').html('Retry');}});});});},_onEnterpriseHidePanel:function(ev){ev.preventDefault();utils.set_cookie('oe_instance_hide_panel',true,24*60*60);$('.database_expiration_panel').hide();},_onEnterpriseRegisterShow:function(){this.$('.oe_instance_register_form').slideToggle();},_onEnterpriseRenew:function(){var self=this;this._rpc({model:'ir.config_parameter',method:'get_param',args:['database.expiration_date'],}).then(function(oldDate){utils.set_cookie('oe_instance_hide_panel','',-1);self._rpc({model:'publisher_warranty.contract',method:'update_notification',args:[[]],}).then(function(){Promise.all([self._rpc({model:'ir.config_parameter',method:'get_param',args:['database.expiration_date']}),self._rpc({model:'ir.config_parameter',method:'get_param',args:['database.expiration_reason']}),self._rpc({model:'ir.config_parameter',method:'get_param',args:['database.enterprise_code']})]).then(function(results){var newDate=results[0];var dbexpirationDate=results[1];var enterpriseCode=results[2];var mtNewDate=new moment(newDate);if(newDate!==oldDate&&mtNewDate>new moment()){$.unblockUI();$('.oe_instance_register').hide();$('.database_expiration_panel .alert').removeClass('alert-info alert-warning alert-danger');$('.database_expiration_panel .alert').addClass('alert-success');$('.valid_date').html(moment(newDate).format('LL'));$('.oe_instance_success, .oe_instance_hide_panel').show();}else{var params=enterpriseCode?{contract:enterpriseCode}:{};window.location=$.param.querystring("https://www.odoo.com/odoo-enterprise/renew",params);}});});});},_onEnterpriseUpsell:function(){var self=this;var limitDate=new moment().subtract(15,'days').format("YYYY-MM-DD");this._rpc({model:'ir.config_parameter',method:'get_param',args:['database.enterprise_code'],}).then(function(contract){self._rpc({model:'res.users',method:'search_count',args:[[["share","=",false],["login_date",">=",limitDate]]],}).then(function(users){var params=contract?{contract:contract,num_users:users}:{num_users:users};window.location=$.param.querystring("https://www.odoo.com/odoo-enterprise/upsell",params);});});},});});;

/* /web_enterprise/static/src/js/menu_mobile.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.MenuMobile',function(require){"use strict";var config=require('web.config');if(!config.device.isMobile){return;}
var core=require('web.core');var session=require('web.session');var Menu=require('web_enterprise.Menu');const{SwitchCompanyMenuMobile}=require('web_enterprise.SwitchCompanyMenu');var QWeb=core.qweb;Menu.include({events:_.extend({},Menu.prototype.events,{'click .o_mobile_menu_toggle':'_onOpenBurgerMenu',}),menusTemplate:'Menu.sections.mobile',animationDuration:200,start:function(){return this._super.apply(this,arguments).then(this._renderBurgerMenu.bind(this));},destroy:function(){this.$burgerMenu.remove();this._super.apply(this,arguments);},do_action(){return this._super(...arguments).then(resp=>{this._closeBurgerMenu();return resp;});},_closeBurgerMenu:function(){var self=this;this.$burgerMenu.animate({left:'100%'},this.animationDuration,function(){self.$burgerMenu.addClass("o_hidden");});},_renderBurgerMenu:function(){this.$burgerMenu=$(QWeb.render('BurgerMenu',{session:session}));this.$burgerMenu.addClass("o_hidden");this.$('.o_user_menu_mobile').appendTo(this.$burgerMenu.find('.o_burger_menu_user'));this.$section_placeholder.appendTo(this.$burgerMenu.find('.o_burger_menu_app'));const companySwitcher=new SwitchCompanyMenuMobile();companySwitcher.appendTo('.o_burger_menu_companies');this.$burgerMenu.on('click','.o_burger_menu_close',this._onCloseBurgerMenu.bind(this));this.$burgerMenu.on('click','.o_burger_menu_topbar.o_toggler',this._onTopbarClicked.bind(this));this.$burgerMenu.on('click','.o_burger_menu_section',this._onBurgerMenuSectionClick.bind(this));core.bus.on('close_o_burger_menu',null,this._closeBurgerMenu.bind(this));$('body').append(this.$burgerMenu);},_onBurgerMenuSectionClick:function(ev){ev.preventDefault();ev.stopPropagation();var $target=$(ev.currentTarget);$target.toggleClass('show');$target.find('> a .toggle_icon').toggleClass('fa-chevron-down fa-chevron-right');},_onCloseBurgerMenu:function(ev){ev.stopPropagation();this._closeBurgerMenu();},_onOpenBurgerMenu:function(ev){ev.preventDefault();var displaySubMenus=!this.home_menu_displayed;if(displaySubMenus){var app=_.findWhere(this.menu_data.children,{id:this.current_primary_menu});displaySubMenus=!!(app&&app.children.length);}
this.$burgerMenu.find('.o_burger_menu_topbar').toggleClass('o_toggler',displaySubMenus);this.$burgerMenu.find('.o_burger_menu_content').toggleClass('o_burger_menu_dark',displaySubMenus);this.$burgerMenu.find('.o_burger_menu_caret').toggleClass('o_hidden',!displaySubMenus);this.$burgerMenu.find('.o_burger_menu_app').toggleClass('o_hidden',!displaySubMenus);this.$burgerMenu.find('.o_burger_menu_user').toggleClass('o_hidden',displaySubMenus);this.$burgerMenu.css({left:'100%'});this.$burgerMenu.animate({left:'0%'},this.animationDuration).removeClass('o_hidden');},_on_secondary_menu_click:function(){this._super.apply(this,arguments);this._closeBurgerMenu();},_onTopbarClicked:function(){this.$burgerMenu.find('.o_burger_menu_content').toggleClass('o_burger_menu_dark');this.$burgerMenu.find('.o_burger_menu_caret').toggleClass('dropup');this.$burgerMenu.find('.o_burger_menu_app, .o_burger_menu_user').toggleClass('o_hidden');this.$burgerMenu.find('.o_burger_menu_app .fa-chevron-down').toggleClass('fa-chevron-down fa-chevron-right');},});});;

/* /web_enterprise/static/src/js/search_panel_mobile.js defined in bundle 'web.assets_backend' */
odoo.define('web.SearchPanelMobile',function(require){var config=require('web.config');if(!config.device.isMobile){return;}
var core=require('web.core');var SearchPanel=require('web.SearchPanel');var qweb=core.qweb;SearchPanel.include({tagName:'details',summaryTemplate:'SearchPanel.SummaryMobile',events:_.extend({},SearchPanel.prototype.events,{'click .o_search_panel_mobile_bottom_close':'_onClickClose',}),close:function(){this.el.removeAttribute('open');},_getCategorySelection:function(){var self=this;return Object.keys(this.categories).reduce(function(selection,categoryId){var category=self.categories[categoryId];if(category.activeValueId){var orderedCategoryIDs=[category.activeValueId].concat(self._getAncestorValueIds(category,category.activeValueId));var orderedCategoryNames=orderedCategoryIDs.map(function(valueId){return category.values[valueId].display_name;});selection.push({values:orderedCategoryNames,icon:category.icon,color:category.color,});}
return selection;},[]);},_getFilterSelection:function(){var self=this;function nameOfCheckedValues(values){return Object.keys(values).filter(function(valueId){return values[valueId].checked;}).map(function(valueId){return values[valueId].name;});}
return Object.keys(this.filters).reduce(function(selection,filterId){var filter=self.filters[filterId];var values=[];if(filter.groups){values=_.flatten(Object.keys(filter.groups).map(function(groupId){return nameOfCheckedValues(filter.groups[groupId].values);}));}else if(filter.values){values=nameOfCheckedValues(filter.values);}
if(values.length){selection.push({values:values,icon:filter.icon,color:filter.color,});}
return selection;},[]);},_render:function(){this._super.apply(this,arguments);this.$el.prepend(qweb.render(this.summaryTemplate,{categories:this._getCategorySelection(),filters:this._getFilterSelection(),}));},_onClickClose:function(ev){ev.preventDefault();this.close();},});});;

/* /web_enterprise/static/src/js/swipe_item_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.SwipeItemMixin',function(){const ANIMATION_SWIPE_DURATION=250;const SWIPE_ACTIVATION_THRESHOLD=15;const SWIPE_ITEM_DATA_KEY='swipe_item';const ACTION_DIRECTION=Object.freeze({LEFT:'left',RIGHT:'right',NONE:false});const SWIPE_AXES=Object.freeze({HORIZONTAL:'horizontal',VERTICAL:'vertical',NONE:false});return{events:{'touchstart .o_swipe_item':'_onTouchStart','touchmove .o_swipe_item':'_onTouchMove','touchend .o_swipe_item':'_onTouchEnd',},init(options){this.actions=options.actions;this.selectorTarget=options.selectorTarget;},addClassesToTarget(){this.$(this.selectorTarget).addClass('o_swipe_item');},_addSwipeElement(target){target.classList.add('o_swipe_current');target.parentElement.classList.add('overflow-hidden');$('<div/>').addClass('o_swipe_separator').prependTo(target);for(const[key,value]of Object.entries(this.actions)){$('<div/>').addClass(['o_swipe_action',key]).append($('<span/>').addClass(value.classesImage)).prependTo(target);this._setSwipeData(target,'actionThreshold',{[key]:this._calculateActionThreshold(target,key)});}},_allowSwipe(ev,action){if(this.actions[action]&&this.actions[action].allowSwipe){return this.actions[action].allowSwipe(ev);}
return false;},_calculateActionThreshold(targetElement,swipeDirection){const iconElement=targetElement.querySelector(`.o_swipe_action.${swipeDirection} .fa`);const iconParentElement=iconElement.parentElement;return parseFloat(getComputedStyle(iconElement).width)+(2*parseFloat(getComputedStyle(iconParentElement).paddingLeft));},_getMaxPosition(swipeDirection){if(swipeDirection===ACTION_DIRECTION.LEFT){return'-100%';}else if(swipeDirection===ACTION_DIRECTION.RIGHT){return'100%';}},_getSwipeActionElement(target,action){if(action){return target.querySelector(`.o_swipe_action.${action}`);}
return target.querySelector(`.o_swipe_action`);},_getSwipeAxes(touchDelta){if(Math.abs(touchDelta.yDelta)>SWIPE_ACTIVATION_THRESHOLD){return SWIPE_AXES.VERTICAL;}else if(Math.abs(touchDelta.xDelta)>SWIPE_ACTIVATION_THRESHOLD){return SWIPE_AXES.HORIZONTAL;}
return SWIPE_AXES.NONE;},_getSwipeData(target,key){return $(target).data(SWIPE_ITEM_DATA_KEY)[key];},_getSwipeDirection(touchDelta){if(touchDelta.xDelta>0){return ACTION_DIRECTION.RIGHT;}else if(touchDelta.xDelta<0){return ACTION_DIRECTION.LEFT;}
return ACTION_DIRECTION.NONE;},_getTouchDelta(event,target){const touch=this._getTouchPosition(event);const touchStart=this._getSwipeData(target,'touchStart');return{xDelta:touch.x-touchStart.x+this._getSwipeData(target,'startLeft'),yDelta:touch.y-touchStart.y};},_getTouchPosition(event){return{x:event.changedTouches[0].clientX,y:event.changedTouches[0].clientY};},_isThresholdReach(target,touchDelta,swipeDirection){if(Math.abs(touchDelta.xDelta)<this._getSwipeData(target,'actionThreshold')[swipeDirection]){return false;}
return swipeDirection;},_moveElementAndActionWithAnimation(target,swipeDirection,toPosition,unit='px'){return this._moveWithAnimation(target,toPosition,{step:(now)=>this._updateSwipeActionPosition(target,swipeDirection,-now,unit)});},_moveWithAnimation(element,left,customOptions={}){return $(element).animate({left:left,},Object.assign({},{duration:ANIMATION_SWIPE_DURATION,},customOptions)).promise();},_performSwipeEndAction(ev,callback,restore=()=>{}){if(callback){callback(ev,restore);}},async _restoreDOMLikeBeforeSwipe(target){await this._moveElementAndActionWithAnimation(target,null,0);$(target).find('.o_swipe_action, .o_swipe_separator').remove();target.classList.remove('o_swipe_current');target.parentElement.classList.remove('overflow-hidden');this._setSwipeData(target,'swipeDirection',false);this._setSwipeData(target,'swipeAxes',false);},_setSwipeData(target,key,value){const tmpData=$(target).data(SWIPE_ITEM_DATA_KEY);if(typeof tmpData[key]==='object'){Object.assign(tmpData[key],value);}else{tmpData[key]=value;}
$(target).data(SWIPE_ITEM_DATA_KEY,tmpData);},_updateSwipeActionElement(target,action,xDelta){const actionOptions=this.actions[action];if(actionOptions){const swipeActionElement=this._getSwipeActionElement(target,action);const max=this._getSwipeData(target,'actionThreshold')[action];swipeActionElement.classList.add(actionOptions.backgroundClassColor);swipeActionElement.style.opacity=Math.abs(xDelta/max);}},_updateSwipeActionPosition(target,swipeDirection,left,unit='px'){const swipeActionElement=this._getSwipeActionElement(target,swipeDirection);if(swipeActionElement){swipeActionElement.style.left=`${left}${unit}`;}},_updateSwipePosition(target,swipeDirection,left){target.style.left=`${left}px`;this._updateSwipeActionPosition(target,swipeDirection,-left);},_onTouchStart(ev){const target=ev.currentTarget;if(!target.matches(this.selectorTarget)){return;}
$(target).data(SWIPE_ITEM_DATA_KEY,{touchStart:this._getTouchPosition(ev),startLeft:$(target).css('left')==='auto'?0:parseInt($(target).css('left'),10),swipeDirection:false,swipeAxes:false,actionThreshold:{},});},_onTouchMove(ev){const target=ev.currentTarget;if(!target.matches(this.selectorTarget)){return;}
const touchDelta=this._getTouchDelta(ev,target);const swipeDirection=this._getSwipeDirection(touchDelta);if(this._getSwipeData(target,'swipeAxes')===false){this._setSwipeData(target,'swipeAxes',this._getSwipeAxes(touchDelta));}
if(this._getSwipeData(target,'swipeAxes')!==SWIPE_AXES.HORIZONTAL){return;}
ev.preventDefault();const allowSwipe=this._allowSwipe(ev,swipeDirection);if(!target.classList.contains('o_swipe_current')&&allowSwipe){this._addSwipeElement(target);}
if(allowSwipe){this._setSwipeData(target,'swipeDirection',swipeDirection);}else{if(!(this._getSwipeData(target,'swipeDirection')&&this._getSwipeData(target,'swipeDirection')===swipeDirection)){this._updateSwipePosition(target,swipeDirection,0);}
return;}
this._updateSwipePosition(target,swipeDirection,touchDelta.xDelta);this._updateSwipeActionElement(target,swipeDirection,touchDelta.xDelta);},async _onTouchEnd(ev){const target=ev.currentTarget;if(!target.matches(this.selectorTarget)){return;}
const touchDelta=this._getTouchDelta(ev,target);const swipeDirection=this._getSwipeDirection(touchDelta);if(this._getSwipeData(target,'swipeAxes')!==SWIPE_AXES.HORIZONTAL){return;}
ev.preventDefault();if(!this._allowSwipe(ev,swipeDirection)){this._restoreDOMLikeBeforeSwipe(target);return;}
const swipeDirectionWithThresholdReach=this._isThresholdReach(target,touchDelta,swipeDirection);const action=this.actions[swipeDirectionWithThresholdReach];if(action){if(swipeDirectionWithThresholdReach){await this._moveElementAndActionWithAnimation(target,swipeDirectionWithThresholdReach,this._getMaxPosition(swipeDirectionWithThresholdReach),'%');}
if(!(action.avoidRestorePositionElement&&action.avoidRestorePositionElement(swipeDirection,target,ev))){await this._moveElementAndActionWithAnimation(target,swipeDirectionWithThresholdReach,0);}
this._performSwipeEndAction(ev,action.actionCallback,()=>{target.style.left=0;});}
this._restoreDOMLikeBeforeSwipe(target);},};});;

/* /web_enterprise/static/src/js/core/dialog.js defined in bundle 'web.assets_backend' */
odoo.define("web_enterprise.Dialog",function(require){"use strict";const config=require("web.config");if(!config.device.isMobile){return;}
const Dialog=require("web.Dialog");Dialog.include({init(parent,{headerButtons}){this._super.apply(this,arguments);this.headerButtons=headerButtons||[];},async willStart(){const prom=await this._super.apply(this,arguments);if(this.renderHeader&&this.fullscreen){const $modalHeader=this.$modal.find(".modal-header");$modalHeader.find("button.close").remove();const $navigationBtn=$("<button>",{class:"btn fa fa-arrow-left","data-dismiss":"modal","aria-label":"close",});$modalHeader.prepend($navigationBtn);const $btnContainer=$("<div>");this._setButtonsTo($btnContainer,this.headerButtons);$modalHeader.append($btnContainer);}
return prom;},});});;

/* /web_enterprise/static/src/js/views/calendar/calendar_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.CalendarRenderer',function(require){"use strict";var config=require('web.config');if(!config.device.isMobile){return;}
var core=require('web.core');var CalendarRenderer=require('web.CalendarRenderer');var qweb=core.qweb;CalendarRenderer.include({_getPopoverParams:function(eventData){var popoverParameters=this._super.apply(this,arguments);popoverParameters['container']='body';return popoverParameters;},_onPopoverShown:function($popoverElement,calendarPopover){this._super.apply(this,arguments);var $popover=$($popoverElement.data('bs.popover').tip);setTimeout(()=>{$popover.toggleClass(['bs-popover-left','bs-popover-right',],false);$popover.find('.arrow').remove();$popover.css({display:'flex',bottom:0,right:0,borderWidth:0,maxWidth:'100%',transform:'translate3d(0px, 0px, 0px)',});$popover.find('.o_cw_body').css({display:'flex',flex:'1 0 auto',flexDirection:'column',});$popover.find('.o_cw_popover_fields_secondary').toggleClass('o_cw_popover_fields_secondary',false).css({flexGrow:1,});$popover.on('touchmove',(event)=>{event.preventDefault();});$popover.on('mousewheel',(event)=>{event.preventDefault();});$popover.on('wheel',(event)=>{event.preventDefault();});$popover.find('a.o_field_widget[href]').on('click',(event)=>{$('.o_cw_popover').popover('dispose');})},0);},_unselectEvent:function(){this._super.apply(this,arguments);$('.o_cw_popover').popover('dispose');},});});;

/* /web_enterprise/static/src/js/views/form_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.MobileFormRenderer',function(require){"use strict";var config=require('web.config');if(!config.device.isMobile){return;}
var core=require('web.core');var FormRenderer=require('web.FormRenderer');var qweb=core.qweb;FormRenderer.include({_renderHeaderButtons:function(node){var $headerButtons=$();var self=this;var buttons=[];_.each(node.children,function(child){if(child.tag==='button'){buttons.push(self._renderHeaderButton(child));}
if(child.tag==='widget'){buttons.push(self._renderTagWidget(child));}});if(buttons.length){$headerButtons=$(qweb.render('StatusbarButtons'));var $dropdownMenu=$headerButtons.find('.dropdown-menu');_.each(buttons,function($button){$dropdownMenu.append($button.addClass('dropdown-item'));});this._toggleStatusbarButtons($headerButtons);}
return $headerButtons;},_toggleStatusbarButtons:function($headerButtons){var $visibleButtons=$headerButtons.find('.dropdown-menu button:not(.o_invisible_modifier)');$visibleButtons=$visibleButtons.filter((index,element)=>{return!(this.mode==='edit'&&element.matches('.oe_read_only'));});$headerButtons.toggleClass('o_invisible_modifier',!$visibleButtons.length);},_updateAllModifiers:function(){var def=this._super.apply(this,arguments);this._toggleStatusbarButtons(this.$('.o_statusbar_buttons'));return def;},});});;

/* /web_enterprise/static/src/js/views/relational_fields.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.relational_fields',function(require){"use strict";var config=require('web.config');if(!config.device.isMobile){return;}
var core=require('web.core');var relational_fields=require('web.relational_fields');var FieldStatus=relational_fields.FieldStatus;var FieldMany2One=relational_fields.FieldMany2One;var FieldX2Many=relational_fields.FieldX2Many;var qweb=core.qweb;var _t=core._t;FieldStatus.include({_render:function(){this.$el.html(qweb.render("FieldStatus.content.mobile",{selection:this.status_information,status:_.findWhere(this.status_information,{selected:true}),clickable:this.isClickable,}));},});FieldMany2One.include({start:function(){var superRes=this._super.apply(this,arguments);this.$input.prop('readonly',true);return superRes;},_bindAutoComplete:function(){},_getSearchCreatePopupOptions:function(){var self=this;var searchCreatePopupOptions=this._super.apply(this,arguments);_.extend(searchCreatePopupOptions,{selectionMode:true,on_clear:function(){self.reinitialize(false);},});return searchCreatePopupOptions;},_search:function(search_val){var self=this;var def=new Promise(function(resolve,reject){var context=self.record.getContext(self.recordParams);var domain=self.record.getDomain(self.recordParams);_.extend(context,self.additionalContext);var blacklisted_ids=self._getSearchBlacklist();if(blacklisted_ids.length>0){domain.push(['id','not in',blacklisted_ids]);}
var prom;if(search_val){prom=self._rpc({model:self.field.relation,method:'name_search',kwargs:{name:search_val,args:domain,operator:"ilike",limit:self.SEARCH_MORE_LIMIT,context:context,},});}
Promise.resolve(prom).then(function(results){var dynamicFilters;if(results){var ids=_.map(results,function(x){return x[0];});dynamicFilters=[{description:_.str.sprintf(_t('Quick search: %s'),search_val),domain:[['id','in',ids]],}];}
self._searchCreatePopup("search",false,{},dynamicFilters);});});this.orderer.add(def);return def;},_onInputClick:function(){return this._search();},});FieldX2Many.include({_renderButtons:function(){var result=this._super.apply(this,arguments);if(this.$buttons){this.$buttons.find('.btn-secondary').removeClass('btn-secondary').addClass('btn-primary btn-add-record');}
return result;}});});;

/* /web_enterprise/static/src/js/views/upgrade_fields.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.upgrade_widgets',function(require){"use strict";var basic_fields=require('web.basic_fields');var field_registry=require('web.field_registry');var relational_fields=require('web.relational_fields');var UpgradeBoolean=basic_fields.FieldBoolean.extend({renderWithLabel:function(){},});var UpgradeRadio=relational_fields.FieldRadio.extend({});field_registry.add('upgrade_boolean',UpgradeBoolean).add('upgrade_radio',UpgradeRadio);});;

/* /web_enterprise/static/src/js/views/view_dialogs.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.view_dialogs',function(require){"use strict";var config=require('web.config');if(!config.device.isMobile){return;}
var core=require('web.core');var view_dialogs=require('web.view_dialogs');var _t=core._t;view_dialogs.FormViewDialog.include({init(parent,options){options.headerButtons=options.headerButtons||[];this._super.apply(this,arguments);},_setRemoveButtonOption(options,btnClasses){options.headerButtons.push({text:_t("Remove"),classes:`btn-secondary ${btnClasses}`,click:async()=>{await this._remove();this.close();},});},});view_dialogs.SelectCreateDialog.include({init:function(){this._super.apply(this,arguments);this.on_clear=this.options.on_clear||(function(){});this.viewType='kanban';},_prepareButtons:function(){this._super.apply(this,arguments);if(this.options.disable_multiple_selection){if(this.options.selectionMode){this.headerButtons.push({text:_t("Clear"),classes:'btn-secondary o_clear_button',close:true,click:function(){this.on_clear();},});}}else{this.__buttons=this.__buttons.filter(button=>!button.classes.split(' ').includes('o_select_button'));}},});});;

/* /web_enterprise/static/src/js/widgets/debug_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.DebugManager',function(require){"use strict";var config=require('web.config');var WebClient=require('web.WebClient');if(config.isDebug()){WebClient.include({start:function(){var self=this;return this._super.apply(this,arguments).then(function(){var toggle_home_menu=self.toggle_home_menu;self.toggle_home_menu=function(display){var action,controller;if(!display){action=self.action_manager.getCurrentAction();controller=self.action_manager.getCurrentController();}
self.update_debug_manager(action,controller);toggle_home_menu.apply(self,arguments);};});},instanciate_menu_widgets:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.systray_menu=self.menu.systray_menu;});},});}});;

/* /web_enterprise/static/src/js/widgets/user_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.UserMenu',function(require){"use strict";var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var UserMenu=require('web.UserMenu');var _t=core._t;var QWeb=core.qweb;UserMenu.include({init:function(){this._super.apply(this,arguments);if(config.device.isMobile){this.className='o_user_menu_mobile';this.tagName='ul';this.template=undefined;}},start:function(){if(config.device.isMobile){this.$el.append(QWeb.render('UserMenu.Actions'));}
return this._super.apply(this,arguments);},do_action(){return this._super(...arguments).then(resp=>{core.bus.trigger('close_o_burger_menu');return resp;});},_onMenuSupport:function(){window.open('https://www.odoo.com/help','_blank');},});});;

/* /web_enterprise/static/src/js/widgets/snackbar.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.SnackBar',function(require){'use strict';var config=require('web.config');if(!config.device.isMobile){return;}
const Widget=require('web.Widget');const SnackBar=Widget.extend({template:'SnackBar',events:{'click .o_snackbar_button':'_onClickButton'},init(parent,options){this._super(...arguments);this.message=options.message||'';this.delay=options.delay||1000;this.onComplete=options.onComplete;this.actionText=options.actionText||'';this.onActionClick=options.onActionClick;this._timeout=false;},_delayedAction(){if(this.onComplete){this.onComplete();}
this.destroy();},_onClickButton(ev){ev.preventDefault();ev.stopPropagation();if(this.onActionClick){this.onActionClick();}
if(this._timeout){clearTimeout(this._timeout);}
this.destroy();},dismiss(){this.destroy();},show(){this.appendTo($('body'));const hasValidDelay=this.delay>-1;if(hasValidDelay){this._timeout=setTimeout(()=>this._delayedAction(),this.delay);}},});return SnackBar;});;

/* /web_enterprise/static/src/js/widgets/switch_company_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web_enterprise.SwitchCompanyMenu',function(require){"use strict";var config=require('web.config');if(!config.device.isMobile){return;}
var SwitchCompanyMenu=require('web.SwitchCompanyMenu');var SystrayMenu=require('web.SystrayMenu');if(config.device.isMobile){var index=SystrayMenu.Items.indexOf(SwitchCompanyMenu);if(index>=0){SystrayMenu.Items.splice(index,1);}}
const SwitchCompanyMenuMobile=SwitchCompanyMenu.extend({template:'MobileCompanySwitcher',events:Object.assign({},SwitchCompanyMenu.prototype.events,{'click .log_into':'_onSwitchCompanyClick','click .toggle_company':'_onToggleCompanyClick',}),});return{SwitchCompanyMenuMobile:SwitchCompanyMenuMobile,};});;

/* /web_gantt/static/src/js/gantt_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web_gantt.GanttRenderer',function(require){"use strict";var AbstractRenderer=require('web.AbstractRenderer');var config=require('web.config');var core=require('web.core');var GanttRow=require('web_gantt.GanttRow');var qweb=require('web.QWeb');var session=require('web.session');var utils=require('web.utils');var QWeb=core.qweb;var _t=core._t;var GanttRenderer=AbstractRenderer.extend({custom_events:_.extend({},AbstractRenderer.prototype.custom_events,{'start_dragging':'_onStartDragging','start_no_dragging':'_onStartNoDragging','stop_dragging':'_onStopDragging','stop_no_dragging':'_onStopNoDragging',}),DECORATIONS:['decoration-secondary','decoration-success','decoration-info','decoration-warning','decoration-danger',],init:function(parent,state,params){var self=this;this._super.apply(this,arguments);this.$draggedPill=null;this.$draggedPillClone=null;this.canCreate=params.canCreate;this.canEdit=params.canEdit;this.canPlan=params.canPlan;this.cellPrecisions=params.cellPrecisions;this.colorField=params.colorField;this.progressField=params.progressField;this.consolidationParams=params.consolidationParams;this.fieldsInfo=params.fieldsInfo;this.SCALES=params.SCALES;this.string=params.string;this.totalRow=params.totalRow;this.collapseFirstLevel=params.collapseFirstLevel;this.thumbnails=params.thumbnails;this.rowWidgets={};this.pillDecorations=_.chain(this.arch.attrs).pick(function(value,key){return self.DECORATIONS.indexOf(key)>=0;}).mapObject(function(value){return py.parse(py.tokenize(value));}).value();if(params.popoverTemplate){this.popoverQWeb=new qweb(config.isDebug(),{_s:session.origin});this.popoverQWeb.add_template(utils.json_node_to_xml(params.popoverTemplate));}else{this.popoverQWeb=QWeb;}
this.isRTL=_t.database.parameters.direction==="rtl";},on_attach_callback:function(){this._isInDom=true;core.bus.on("keydown",this,this._onKeydown);core.bus.on("keyup",this,this._onKeyup);this._setRowsDroppable();},on_detach_callback:function(){this._isInDom=false;core.bus.off("keydown",this,this._onKeydown);core.bus.off("keyup",this,this._onKeyup);_.invoke(this.rowWidgets,'on_detach_callback');},updateRow:function(rowState){var self=this;var oldRowIds=[rowState.id].concat(rowState.childrenRowIds);var oldRows=[];oldRowIds.forEach(function(rowId){if(self.rowWidgets[rowId]){oldRows.push(self.rowWidgets[rowId]);delete self.rowWidgets[rowId];}});this.proms=[];var rows=this._renderRows([rowState],rowState.groupedBy);var proms=this.proms;delete this.proms;return Promise.all(proms).then(function(){var $previousRow=oldRows[0].$el;rows.forEach(function(row){row.$el.insertAfter($previousRow);$previousRow=row.$el;});_.invoke(oldRows,'destroy');self._setRowsDroppable();});},_getAction:function(event){return event.ctrlKey||event.metaKey?'copy':'reschedule';},_getFocusDateFormat:function(){var focusDate=this.state.focusDate;switch(this.state.scale){case'day':return focusDate.format('DD MMMM YYYY');case'week':var dateStart=focusDate.clone().startOf('week').format('DD MMMM YYYY');var dateEnd=focusDate.clone().endOf('week').format('DD MMMM YYYY');return _.str.sprintf('%s - %s',dateStart,dateEnd);case'month':return focusDate.format('MMMM YYYY');case'year':return focusDate.format('YYYY');default:break;}},_getSlotsDates:function(){var token=this.SCALES[this.state.scale].interval;var stopDate=this.state.stopDate;var day=this.state.startDate;var dates=[];while(day<=stopDate){dates.push(day);day=day.clone().add(1,token);}
return dates;},_prepareViewInfo:function(){return{colorField:this.colorField,progressField:this.progressField,consolidationParams:this.consolidationParams,state:this.state,fieldsInfo:this.fieldsInfo,slots:this._getSlotsDates(),pillDecorations:this.pillDecorations,popoverQWeb:this.popoverQWeb,activeScaleInfo:{precision:this.cellPrecisions[this.state.scale],interval:this.SCALES[this.state.scale].cellPrecisions[this.cellPrecisions[this.state.scale]],time:this.SCALES[this.state.scale].time,},};},_render:function(){var self=this;var oldRowWidgets=Object.keys(this.rowWidgets).map(function(rowId){return self.rowWidgets[rowId];});this.rowWidgets={};this.viewInfo=this._prepareViewInfo();this.proms=[];var rows=this._renderRows(this.state.rows,this.state.groupedBy);var totalRow;if(this.totalRow){totalRow=this._renderTotalRow();}
this.proms.push(this._super.apply(this,arguments));var proms=this.proms;delete this.proms;return Promise.all(proms).then(function(){self.$el.empty();_.invoke(oldRowWidgets,'destroy');self._replaceElement(QWeb.render('GanttView',{widget:self}));const $containment=$('<div id="o_gantt_containment"/>');self.$('.o_gantt_row_container').append($containment);if(!self.state.groupedBy.length){$containment.css(self.isRTL?{right:0}:{left:0})}
rows.forEach(function(row){row.$el.appendTo(self.$('.o_gantt_row_container'));});if(totalRow){totalRow.$el.appendTo(self.$('.o_gantt_total_row_container'));}
if(self._isInDom){self._setRowsDroppable();}});},_renderRows:function(rows,groupedBy){var self=this;var rowWidgets=[];var disableResize=this.state.scale==='year';var groupLevel=this.state.groupedBy.length-groupedBy.length;var hideSidebar=groupedBy.length===0;if(this.collapseFirstLevel){hideSidebar=self.state.groupedBy.length===0;}
rows.forEach(function(row){var pillsInfo={groupId:row.groupId,resId:row.resId,pills:row.records,groupLevel:groupLevel,};if(groupedBy.length){pillsInfo.groupName=row.name;pillsInfo.groupedByField=row.groupedByField;}
var params={canCreate:self.canCreate,canEdit:self.canEdit,canPlan:self.canPlan,isGroup:row.isGroup,consolidate:(groupLevel===0)&&(self.state.groupedBy[0]===self.consolidationParams.maxField),hideSidebar:hideSidebar,isOpen:row.isOpen,disableResize:disableResize,rowId:row.id,scales:self.SCALES,unavailabilities:row.unavailabilities,};if(self.thumbnails&&row.groupedByField&&row.groupedByField in self.thumbnails){params.thumbnail={model:self.fieldsInfo[row.groupedByField].relation,field:self.thumbnails[row.groupedByField],};}
rowWidgets.push(self._renderRow(pillsInfo,params));if(row.isGroup&&row.isOpen){var subRowWidgets=self._renderRows(row.rows,groupedBy.slice(1));rowWidgets=rowWidgets.concat(subRowWidgets);}});return rowWidgets;},_renderRow:function(pillsInfo,params){var ganttRow=new GanttRow(this,pillsInfo,this.viewInfo,params);this.rowWidgets[ganttRow.rowId]=ganttRow;this.proms.push(ganttRow._widgetRenderAndInsert(function(){}));return ganttRow;},_renderTotalRow:function(){var pillsInfo={groupId:"groupTotal",pills:this.state.records,groupLevel:0,groupName:"Total"};var params={canCreate:this.canCreate,canEdit:this.canEdit,canPlan:this.canPlan,hideSidebar:this.state.groupedBy.length===0,isGroup:true,rowId:'__total_row__',scales:this.SCALES,};return this._renderRow(pillsInfo,params);},_setRowsDroppable:function(){const firstCell=this.$('.o_gantt_header_scale .o_gantt_header_cell:first')[0];_.invoke(this.rowWidgets,'setDroppable',firstCell);},_onKeydown:function(ev){this.action=this._getAction(ev);if(this.$draggedPill&&this.action==='copy'){this.$el.addClass('o_copying');this.$el.removeClass('o_grabbing');}},_onKeyup:function(ev){this.action=this._getAction(ev);if(this.$draggedPill&&this.action==='reschedule'){this.$el.addClass('o_grabbing');this.$el.removeClass('o_copying');}},_onStartDragging:function(event){this.$draggedPill=event.data.$draggedPill;this.$draggedPill.addClass('o_dragged_pill');if(this.action==='copy'){this.$el.addClass('o_copying');}else{this.$el.addClass('o_grabbing');}},_onStartNoDragging:function(){this.$el.addClass('o_no_dragging');},_onStopDragging:function(){this.$draggedPill.removeClass('o_dragged_pill');this.$draggedPill=null;this.$draggedPillClone=null;this.$el.removeClass('o_grabbing');this.$el.removeClass('o_copying');},_onStopNoDragging:function(){this.$el.removeClass('o_no_dragging');},});return GanttRenderer;});;

/* /web_gantt/static/src/js/gantt_view.js defined in bundle 'web.assets_backend' */
odoo.define('web_gantt.GanttView',function(require){"use strict";var AbstractView=require('web.AbstractView');var core=require('web.core');var GanttModel=require('web_gantt.GanttModel');var GanttRenderer=require('web_gantt.GanttRenderer');var GanttController=require('web_gantt.GanttController');var pyUtils=require('web.py_utils');var view_registry=require('web.view_registry');var _t=core._t;var _lt=core._lt;var GanttView=AbstractView.extend({display_name:_lt('Gantt'),icon:'fa-tasks',config:_.extend({},AbstractView.prototype.config,{Model:GanttModel,Controller:GanttController,Renderer:GanttRenderer,}),viewType:'gantt',init:function(viewInfo,params){this._super.apply(this,arguments);const{domain}=params.action||{};this.controllerParams.actionDomain=domain||[];this.SCALES={day:{string:_t('Day'),cellPrecisions:{full:60,half:30,quarter:15},defaultPrecision:'full',time:'minutes',interval:'hour'},week:{string:_t('Week'),cellPrecisions:{full:24,half:12},defaultPrecision:'half',time:'hours',interval:'day'},month:{string:_t('Month'),cellPrecisions:{full:24,half:12},defaultPrecision:'half',time:'hours',interval:'day'},year:{string:_t('Year'),cellPrecisions:{full:1},defaultPrecision:'full',time:'months',interval:'month'},};var arch=this.arch;var decorationFields=[];_.each(arch.children,function(child){if(child.tag==='field'){decorationFields.push(child.attrs.name);}});var collapseFirstLevel=!!arch.attrs.collapse_first_level;var displayUnavailability=!!arch.attrs.display_unavailability;var colorField=arch.attrs.color;var precisionAttrs=arch.attrs.precision?pyUtils.py_eval(arch.attrs.precision):{};var cellPrecisions={};_.each(this.SCALES,function(vals,key){if(precisionAttrs[key]){var precision=precisionAttrs[key].split(':');if(precision[1]&&_.contains(_.keys(vals.cellPrecisions),precision[1])){cellPrecisions[key]=precision[1];}}
cellPrecisions[key]=cellPrecisions[key]||vals.defaultPrecision;});var consolidationMaxField;var consolidationMaxValue;var consolidationMax=arch.attrs.consolidation_max?pyUtils.py_eval(arch.attrs.consolidation_max):{};if(Object.keys(consolidationMax).length>0){consolidationMaxField=Object.keys(consolidationMax)[0];consolidationMaxValue=consolidationMax[consolidationMaxField];collapseFirstLevel=!!consolidationMaxField||collapseFirstLevel;}
var consolidationParams={field:arch.attrs.consolidation,maxField:consolidationMaxField,maxValue:consolidationMaxValue,excludeField:arch.attrs.consolidation_exclude,};var formViewId=arch.attrs.form_view_id?parseInt(arch.attrs.form_view_id,10):false;if(params.action&&!formViewId){var result=_.findWhere(params.action.views,{type:'form'});formViewId=result?result.viewID:false;}
var dialogViews=[[formViewId,'form']];var allowedScales;if(arch.attrs.scales){var possibleScales=Object.keys(this.SCALES);allowedScales=_.reduce(arch.attrs.scales.split(','),function(allowedScales,scale){if(possibleScales.indexOf(scale)>=0){allowedScales.push(scale.trim());}
return allowedScales;},[]);}else{allowedScales=Object.keys(this.SCALES);}
var scale=arch.attrs.default_scale||'month';var initialDate=moment(params.initialDate||params.context.initialDate||new Date());var offset=arch.attrs.offset;if(offset&&scale){initialDate.add(offset,scale);}
var thumbnails=this.arch.attrs.thumbnails?pyUtils.py_eval(this.arch.attrs.thumbnails):{};var canPlan=this.arch.attrs.plan?!!JSON.parse(this.arch.attrs.plan):true;this.controllerParams.context=params.context||{};this.controllerParams.dialogViews=dialogViews;this.controllerParams.SCALES=this.SCALES;this.controllerParams.allowedScales=allowedScales;this.controllerParams.collapseFirstLevel=collapseFirstLevel;this.controllerParams.createAction=arch.attrs.on_create||null;this.loadParams.initialDate=initialDate;this.loadParams.collapseFirstLevel=collapseFirstLevel;this.loadParams.colorField=colorField;this.loadParams.dateStartField=arch.attrs.date_start;this.loadParams.dateStopField=arch.attrs.date_stop;this.loadParams.progressField=arch.attrs.progress;this.loadParams.decorationFields=decorationFields;this.loadParams.defaultGroupBy=this.arch.attrs.default_group_by;this.loadParams.displayUnavailability=displayUnavailability;this.loadParams.fields=this.fields;this.loadParams.scale=scale;this.loadParams.consolidationParams=consolidationParams;this.rendererParams.canCreate=this.controllerParams.activeActions.create;this.rendererParams.canEdit=this.controllerParams.activeActions.edit;this.rendererParams.canPlan=canPlan&&this.rendererParams.canEdit;this.rendererParams.fieldsInfo=viewInfo.fields;this.rendererParams.SCALES=this.SCALES;this.rendererParams.cellPrecisions=cellPrecisions;this.rendererParams.totalRow=arch.attrs.total_row||false;this.rendererParams.string=arch.attrs.string||_t('Gantt View');this.rendererParams.popoverTemplate=_.findWhere(arch.children,{tag:'templates'});this.rendererParams.colorField=colorField;this.rendererParams.progressField=arch.attrs.progress;this.rendererParams.displayUnavailability=displayUnavailability;this.rendererParams.collapseFirstLevel=collapseFirstLevel;this.rendererParams.consolidationParams=consolidationParams;this.rendererParams.thumbnails=thumbnails;},});view_registry.add('gantt',GanttView);return GanttView;});;

/* /web_gantt/static/src/js/gantt_model.js defined in bundle 'web.assets_backend' */
odoo.define('web_gantt.GanttModel',function(require){"use strict";var AbstractModel=require('web.AbstractModel');var concurrency=require('web.concurrency');var core=require('web.core');var fieldUtils=require('web.field_utils');var session=require('web.session');var _t=core._t;var GanttModel=AbstractModel.extend({init:function(){this._super.apply(this,arguments);this.dp=new concurrency.DropPrevious();this.mutex=new concurrency.Mutex();},collapseRow:function(rowId){this.allRows[rowId].isOpen=false;},collapseRows:function(){this.ganttData.rows.forEach(function(group){group.isOpen=false;});},convertToServerTime:function(date){var result=date.clone();if(!result.isUTC()){result.subtract(session.getTZOffset(date),'minutes');}
return result.locale('en').format('YYYY-MM-DD HH:mm:ss');},dateAdd:function(date,offset,unit){var result=date.clone().add(offset,unit);if(Math.abs(result.diff(date,'hours'))>=24){var tzOffsetDiff=result.clone().local().utcOffset()-date.clone().local().utcOffset();if(tzOffsetDiff!==0){result.subtract(tzOffsetDiff,'minutes');}}
return result;},get:function(rowId){if(rowId){return this.allRows[rowId];}else{return _.extend({},this.ganttData);}},expandRow:function(rowId){this.allRows[rowId].isOpen=true;},expandRows:function(){var self=this;Object.keys(this.allRows).forEach(function(rowId){var row=self.allRows[rowId];if(row.isGroup){self.allRows[rowId].isOpen=true;}});},load:function(params){this.modelName=params.modelName;this.fields=params.fields;this.domain=params.domain;this.context=params.context;this.decorationFields=params.decorationFields;this.colorField=params.colorField;this.progressField=params.progressField;this.consolidationParams=params.consolidationParams;this.collapseFirstLevel=params.collapseFirstLevel;this.displayUnavailability=params.displayUnavailability;this.defaultGroupBy=params.defaultGroupBy?[params.defaultGroupBy]:[];if(!params.groupedBy||!params.groupedBy.length){params.groupedBy=this.defaultGroupBy;}
this.ganttData={dateStartField:params.dateStartField,dateStopField:params.dateStopField,groupedBy:params.groupedBy,fields:params.fields,};this._setRange(params.initialDate,params.scale);return this._fetchData().then(function(){return Promise.resolve();});},reload:function(handle,params){if('scale'in params){this._setRange(this.ganttData.focusDate,params.scale);}
if('date'in params){this._setRange(params.date,this.ganttData.scale);}
if('domain'in params){this.domain=params.domain;}
if('groupBy'in params){if(params.groupBy&&params.groupBy.length){this.ganttData.groupedBy=params.groupBy.filter(groupedByField=>{var fieldName=groupedByField.split(':')[0]
return fieldName in this.fields&&this.fields[fieldName].type.indexOf('date')===-1;});if(this.ganttData.groupedBy.length!==params.groupBy.length){this.do_warn(_t('Invalid group by'),_t('Grouping by date is not supported, ignoring it'));}}else{this.ganttData.groupedBy=this.defaultGroupBy;}}
return this._fetchData()},copy:function(id,schedule){var self=this;const defaults=this.rescheduleData(schedule);return this.mutex.exec(function(){return self._rpc({model:self.modelName,method:'copy',args:[id,defaults],context:self.context,});});},reschedule:function(ids,schedule,isUTC){var self=this;if(!_.isArray(ids)){ids=[ids];}
const data=this.rescheduleData(schedule,isUTC);return this.mutex.exec(function(){return self._rpc({model:self.modelName,method:'write',args:[ids,data],context:self.context,});});},rescheduleData:function(schedule,isUTC){const allowedFields=[this.ganttData.dateStartField,this.ganttData.dateStopField,...this.ganttData.groupedBy];const data=_.pick(schedule,allowedFields);let type;for(let k in data){type=this.fields[k].type;if(data[k]&&(type==='datetime'||type==='date')&&!isUTC){data[k]=this.convertToServerTime(data[k]);}};return data},_fetchData:function(){var self=this;var domain=this._getDomain();var context=_.extend(this.context,{'group_by':this.ganttData.groupedBy});var groupsDef;if(this.ganttData.groupedBy.length){groupsDef=this._rpc({model:this.modelName,method:'read_group',fields:this._getFields(),domain:domain,context:context,groupBy:this.ganttData.groupedBy,orderBy:this.ganttData.groupedBy.map(function(f){return{name:f};}),lazy:this.ganttData.groupedBy.length===1,});}
var dataDef=this._rpc({route:'/web/dataset/search_read',model:this.modelName,fields:this._getFields(),context:context,domain:domain,});return this.dp.add(Promise.all([groupsDef,dataDef])).then(function(results){var groups=results[0];var searchReadResult=results[1];if(groups){_.each(groups,function(group){group.id=_.uniqueId('group');});}
var oldRows=self.allRows;self.allRows={};self.ganttData.groups=groups;self.ganttData.records=self._parseServerData(searchReadResult.records);self.ganttData.rows=self._generateRows({groupedBy:self.ganttData.groupedBy,groups:groups,oldRows:oldRows,records:self.ganttData.records,});var unavailabilityProm;if(self.displayUnavailability){unavailabilityProm=self._fetchUnavailability();}
return unavailabilityProm;});},_computeUnavailabilityRows:function(rows){var self=this;return _.map(rows,function(r){if(r){return{groupedBy:r.groupedBy,records:r.records,name:r.name,resId:r.resId,rows:self._computeUnavailabilityRows(r.rows)}}else{return r;}});},_fetchUnavailability:function(){var self=this;return this._rpc({model:this.modelName,method:'gantt_unavailability',args:[this.convertToServerTime(this.ganttData.startDate),this.convertToServerTime(this.ganttData.stopDate),this.ganttData.scale,this.ganttData.groupedBy,this._computeUnavailabilityRows(this.ganttData.rows),],context:this.context,}).then(function(enrichedRows){self._updateUnavailabilityRows(self.ganttData.rows,enrichedRows);});},_updateUnavailabilityRows:function(original,enriched){var self=this;_.zip(original,enriched).forEach(function(rowPair){var o=rowPair[0];var e=rowPair[1];o.unavailabilities=_.map(e.unavailabilities,function(u){u.start=self._parseServerValue({type:'datetime'},u.start);u.stop=self._parseServerValue({type:'datetime'},u.stop);return u;});if(o.rows&&e.rows){self._updateUnavailabilityRows(o.rows,e.rows);}});},_generateRows:function(params){var self=this;var groups=params.groups;var groupedBy=params.groupedBy;var rows;if(!groupedBy.length){var row={groupId:groups&&groups.length&&groups[0].id,id:_.uniqueId('row'),records:params.records,};rows=[row];this.allRows[row.id]=row;}else{var groupedByField=groupedBy[0];var currentLevelGroups=_.groupBy(groups,groupedByField);rows=Object.keys(currentLevelGroups).map(function(key){var subGroups=currentLevelGroups[key];var groupRecords=_.filter(params.records,function(record){return _.isEqual(record[groupedByField],subGroups[0][groupedByField]);});var value;if(groupRecords.length){value=groupRecords[0][groupedByField];}else{value=subGroups[0][groupedByField];}
var path=(params.parentPath||'')+JSON.stringify(value);var minNbGroups=self.collapseFirstLevel?0:1;var isGroup=groupedBy.length>minNbGroups;var row={name:self._getFieldFormattedValue(value,self.fields[groupedByField]),groupId:subGroups[0].id,groupedBy:groupedBy,groupedByField:groupedByField,id:_.uniqueId('row'),resId:_.isArray(value)?value[0]:value,isGroup:isGroup,isOpen:!_.findWhere(params.oldRows,{path:path,isOpen:false}),path:path,records:groupRecords,};if(isGroup){row.rows=self._generateRows({groupedBy:groupedBy.slice(1),groups:subGroups,oldRows:params.oldRows,parentPath:row.path+'\n',records:groupRecords,});row.childrenRowIds=[];row.rows.forEach(function(subRow){row.childrenRowIds.push(subRow.id);row.childrenRowIds=row.childrenRowIds.concat(subRow.childrenRowIds||[]);});}
self.allRows[row.id]=row;return row;});if(!rows.length){rows=[{groups:[],records:[],}];}}
return rows;},_getDomain:function(){var domain=[[this.ganttData.dateStartField,'<=',this.convertToServerTime(this.ganttData.stopDate)],[this.ganttData.dateStopField,'>=',this.convertToServerTime(this.ganttData.startDate)],];return this.domain.concat(domain);},_getFields:function(){var fields=['display_name',this.ganttData.dateStartField,this.ganttData.dateStopField];fields=fields.concat(this.ganttData.groupedBy,this.decorationFields);if(this.progressField){fields.push(this.progressField);}
if(this.colorField){fields.push(this.colorField);}
if(this.consolidationParams.field){fields.push(this.consolidationParams.field);}
if(this.consolidationParams.excludeField){fields.push(this.consolidationParams.excludeField);}
return _.uniq(fields);},_getFieldFormattedValue:function(value,field){var options={};if(field.type==='boolean'){options={forceString:true};}
var formattedValue=fieldUtils.format[field.type](value,field,options);return formattedValue||_.str.sprintf(_t('Undefined %s'),field.string);},_parseServerData:function(data){var self=this;data.forEach(function(record){Object.keys(record).forEach(function(fieldName){record[fieldName]=self._parseServerValue(self.fields[fieldName],record[fieldName]);});});return data;},_setRange:function(focusDate,scale){this.ganttData.scale=scale;this.ganttData.focusDate=focusDate;this.ganttData.startDate=focusDate.clone().startOf(scale);this.ganttData.stopDate=focusDate.clone().endOf(scale);},});return GanttModel;});;

/* /web_gantt/static/src/js/gantt_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web_gantt.GanttController',function(require){"use strict";var AbstractController=require('web.AbstractController');var core=require('web.core');var dialogs=require('web.view_dialogs');var confirmDialog=require('web.Dialog').confirm;var QWeb=core.qweb;var _t=core._t;var GanttController=AbstractController.extend({events:_.extend({},AbstractController.prototype.events,{'click .o_gantt_button_add':'_onAddClicked','click .o_gantt_button_scale':'_onScaleClicked','click .o_gantt_button_prev':'_onPrevPeriodClicked','click .o_gantt_button_next':'_onNextPeriodClicked','click .o_gantt_button_today':'_onTodayClicked','click .o_gantt_button_expand_rows':'_onExpandClicked','click .o_gantt_button_collapse_rows':'_onCollapseClicked',}),custom_events:_.extend({},AbstractController.prototype.custom_events,{add_button_clicked:'_onCellAddClicked',plan_button_clicked:'_onCellPlanClicked',collapse_row:'_onCollapseRow',expand_row:'_onExpandRow',pill_clicked:'_onPillClicked',pill_resized:'_onPillResized',pill_dropped:'_onPillDropped',updating_pill_started:'_onPillUpdatingStarted',updating_pill_stopped:'_onPillUpdatingStopped',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.model=model;this.context=params.context;this.dialogViews=params.dialogViews;this.SCALES=params.SCALES;this.allowedScales=params.allowedScales;this.collapseFirstLevel=params.collapseFirstLevel;this.createAction=params.createAction;this.actionDomain=params.actionDomain;this.isRTL=_t.database.parameters.direction==="rtl";},renderButtons:function($node){if($node){var state=this.model.get();this.$buttons=$(QWeb.render('GanttView.buttons',{groupedBy:state.groupedBy,widget:this,SCALES:this.SCALES,activateScale:state.scale,allowedScales:this.allowedScales,}));this.$buttons.appendTo($node);}},_copy:function(id,schedule){return this._executeAsyncOperation(this.model.copy.bind(this.model),[id,schedule]);},_executeAsyncOperation:function(operation,args){const self=this;var prom=new Promise(function(resolve,reject){var asyncOp=operation(...args);asyncOp.then(resolve).guardedCatch(resolve);self.dp.add(asyncOp).guardedCatch(reject);});return prom.then(this.reload.bind(this,{}));},_getDialogContext:function(date,groupId){var state=this.model.get();var context={};context[state.dateStartField]=date.clone();context[state.dateStopField]=date.clone().endOf(this.SCALES[state.scale].interval);if(groupId){_.each(state.groupedBy,function(fieldName){var groupValue=_.find(state.groups,function(group){return group.id===groupId;});var value=groupValue[fieldName];if(_.isArray(value)){value=value[0];}
context[fieldName]=value;});}
for(var k in context){var type=state.fields[k].type;if(context[k]&&(type==='datetime'||type==='date')){context[k]=this.model.convertToServerTime(context[k]);}}
return context;},_openDialog:function(resID,context){var title=resID?_t("Open"):_t("Create");return new dialogs.FormViewDialog(this,{title:_.str.sprintf(title),res_model:this.modelName,view_id:this.dialogViews[0][0],res_id:resID,readonly:!this.is_action_enabled('edit'),deletable:this.is_action_enabled('edit')&&resID,context:_.extend({},this.context,context),on_saved:this.reload.bind(this,{}),on_remove:this._onDialogRemove.bind(this,resID),}).open();},_onDialogRemove:function(resID){var controller=this;var confirm=new Promise(function(resolve){confirmDialog(this,_t('Are you sure to delete this record?'),{confirm_callback:function(){resolve(true);},cancel_callback:function(){resolve(false);},});});return confirm.then(function(confirmed){if((!confirmed)){return Promise.resolve();}
return controller._rpc({model:controller.modelName,method:'unlink',args:[[resID,],],}).then(function(){return controller.reload();})});},_openPlanDialog:function(context){var self=this;var state=this.model.get();var domain=['|',[state.dateStartField,'=',false],[state.dateStopField,'=',false],];new dialogs.SelectCreateDialog(this,{title:_t("Plan"),res_model:this.modelName,domain:this.actionDomain.concat(domain),views:this.dialogViews,context:_.extend({},this.context,context),on_selected:function(records){var ids=_.pluck(records,'id');if(ids.length){self._reschedule(ids,context,true);}},}).open();},_onCreate:function(context){if(this.createAction){var fullContext=_.extend({},this.context,context);this.do_action(this.createAction,{additional_context:fullContext,on_close:this.reload.bind(this,{})});}else{this._openDialog(undefined,context);}},_reschedule:function(ids,schedule,isUTC){return this._executeAsyncOperation(this.model.reschedule.bind(this.model),[ids,schedule,isUTC]);},_update:function(){var self=this;return this._super.apply(this,arguments).then(function(){if(self.$buttons){var nbGroups=self.model.get().groupedBy.length;var minNbGroups=self.collapseFirstLevel?0:1;var displayButtons=nbGroups>minNbGroups;self.$buttons.find('.o_gantt_button_expand_rows').toggle(displayButtons);self.$buttons.find('.o_gantt_button_collapse_rows').toggle(displayButtons);}});},_onCellAddClicked:function(ev){ev.stopPropagation();var context=this._getDialogContext(ev.data.date,ev.data.groupId);for(var k in context){context[_.str.sprintf('default_%s',k)]=context[k];}
this._onCreate(context);},_onAddClicked:function(ev){ev.preventDefault();var context={};var state=this.model.get();context[state.dateStartField]=this.model.convertToServerTime(state.focusDate.clone().startOf(state.scale));context[state.dateStopField]=this.model.convertToServerTime(state.focusDate.clone().endOf(state.scale));for(var k in context){context[_.str.sprintf('default_%s',k)]=context[k];}
this._onCreate(context);},_onCollapseClicked:function(ev){ev.preventDefault();this.model.collapseRows();this.update({},{reload:false});},_onCollapseRow:function(ev){ev.stopPropagation();this.model.collapseRow(ev.data.rowId);this.renderer.updateRow(this.model.get(ev.data.rowId));},_onExpandClicked:function(ev){ev.preventDefault();this.model.expandRows();this.update({},{reload:false});},_onExpandRow:function(ev){ev.stopPropagation();this.model.expandRow(ev.data.rowId);this.renderer.updateRow(this.model.get(ev.data.rowId));},_onNextPeriodClicked:function(ev){ev.preventDefault();var state=this.model.get();this.update({date:state.focusDate.add(1,state.scale)});},_onPillClicked:async function(ev){if(!this._updating){ev.data.target.addClass('o_gantt_pill_editing');await this.model.mutex.getUnlockedDef();var dialog=this._openDialog(ev.data.target.data('id'));dialog.on('closed',this,function(){ev.data.target.removeClass('o_gantt_pill_editing');});}},_onPillDropped:function(ev){ev.stopPropagation();var state=this.model.get();var schedule={};var diff=ev.data.diff;diff=this.isRTL?-diff:diff;if(diff){var pill=_.findWhere(state.records,{id:ev.data.pillId});schedule[state.dateStartField]=this.model.dateAdd(pill[state.dateStartField],diff,this.SCALES[state.scale].time);schedule[state.dateStopField]=this.model.dateAdd(pill[state.dateStopField],diff,this.SCALES[state.scale].time);}else if(ev.data.action==='copy'){const pill=_.findWhere(state.records,{id:ev.data.pillId});schedule[state.dateStartField]=pill[state.dateStartField].clone();schedule[state.dateStopField]=pill[state.dateStopField].clone();}
if(ev.data.newGroupId&&ev.data.newGroupId!==ev.data.oldGroupId){var group=_.findWhere(state.groups,{id:ev.data.newGroupId});var fieldsToWrite=state.groupedBy.slice(0,ev.data.groupLevel+1);_.each(fieldsToWrite,function(fieldName){schedule[fieldName]=group[fieldName];if(_.isArray(schedule[fieldName])){schedule[fieldName]=schedule[fieldName][0];}});}
if(ev.data.action==='copy'){this._copy(ev.data.pillId,schedule);}else{this._reschedule(ev.data.pillId,schedule);}},_onPillResized:function(ev){ev.stopPropagation();var schedule={};schedule[ev.data.field]=ev.data.date;this._reschedule(ev.data.id,schedule);},_onPillUpdatingStarted:function(ev){ev.stopPropagation();this._updating=true;},_onPillUpdatingStopped:function(ev){ev.stopPropagation();this._updating=false;},_onCellPlanClicked:function(ev){ev.stopPropagation();var context=this._getDialogContext(ev.data.date,ev.data.groupId);this._openPlanDialog(context);},_onPrevPeriodClicked:function(ev){ev.preventDefault();var state=this.model.get();this.update({date:state.focusDate.subtract(1,state.scale)});},_onScaleClicked:function(ev){ev.preventDefault();var $button=$(ev.currentTarget);this.$buttons.find('.o_gantt_button_scale').removeClass('active');$button.addClass('active');this.$buttons.find('.o_gantt_dropdown_selected_scale').text($button.text());this.update({scale:$button.data('value')});},_onTodayClicked:function(ev){ev.preventDefault();this.update({date:moment()});},});return GanttController;});;

/* /web_gantt/static/src/js/gantt_row.js defined in bundle 'web.assets_backend' */
odoo.define('web_gantt.GanttRow',function(require){"use strict";var core=require('web.core');var session=require('web.session');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var GanttRow=Widget.extend({template:'GanttView.Row',events:{'mouseleave':'_onMouseLeave','mousemove .o_gantt_cell':'_onMouseMove','mouseenter .o_gantt_pill':'_onPillEntered','click .o_gantt_pill':'_onPillClicked','click':'_onRowSidebarClicked','click .o_gantt_cell_buttons > div > .o_gantt_cell_add':'_onButtonAddClicked','click .o_gantt_cell_buttons > div > .o_gantt_cell_plan':'_onButtonPlanClicked',},NB_GANTT_RECORD_COLORS:12,LEVEL_LEFT_OFFSET:16,LEVEL_TOP_OFFSET:31,POPOVER_DELAY:260,init:function(parent,pillsInfo,viewInfo,options){this._super.apply(this,arguments);var self=this;this.name=pillsInfo.groupName;this.groupId=pillsInfo.groupId;this.groupLevel=pillsInfo.groupLevel;this.groupedByField=pillsInfo.groupedByField;this.pills=_.map(pillsInfo.pills,_.clone);this.resId=pillsInfo.resId;this.viewInfo=viewInfo;this.fieldsInfo=viewInfo.fieldsInfo;this.state=viewInfo.state;this.colorField=viewInfo.colorField;this.options=options;this.SCALES=options.scales;this.isGroup=options.isGroup;this.isOpen=options.isOpen;this.rowId=options.rowId;this.unavailabilities=_.map(options.unavailabilities,function(u){u.startDate=self._convertToUserTime(u.start);u.stopDate=self._convertToUserTime(u.stop);return u;});this._snapToGrid(this.unavailabilities);this.consolidate=options.consolidate;this.consolidationParams=viewInfo.consolidationParams;if(options.thumbnail){this.thumbnailUrl=session.url('/web/image',{model:options.thumbnail.model,id:this.resId,field:this.options.thumbnail.field,});}
this.isTotal=this.groupId==='groupTotal';this._adaptPills();this._snapToGrid(this.pills);this._calculateLevel();if(this.isGroup&&this.pills.length){this._aggregateGroupedPills();}else{this.progressField=viewInfo.progressField;this._evaluateDecoration();}
this._calculateMarginAndWidth();this._insertIntoSlot();this.leftPadding=(this.groupLevel+1)*this.LEVEL_LEFT_OFFSET;this.cellHeight=this.level*this.LEVEL_TOP_OFFSET+(this.level>0?this.level-1:0);this.MIN_WIDTHS={full:100,half:50,quarter:25};this.PARTS={full:1,half:2,quarter:4};this.cellMinWidth=this.MIN_WIDTHS[this.viewInfo.activeScaleInfo.precision];this.cellPart=this.PARTS[this.viewInfo.activeScaleInfo.precision];this.childrenRows=[];this._onButtonAddClicked=_.debounce(this._onButtonAddClicked,500,true);this._onButtonPlanClicked=_.debounce(this._onButtonPlanClicked,500,true);this._onPillClicked=_.debounce(this._onPillClicked,500,true);if(this.isTotal){const maxCount=Math.max(...this.pills.map(p=>p.count));const factor=maxCount?(90/maxCount):0;for(let p of this.pills){p.totalHeight=factor*p.count;}}
this.isRTL=_t.database.parameters.direction==="rtl";},start:function(){if(!this.isGroup){this._bindPopover();}
return this._super.apply(this,arguments);},setDroppable:function(firstCell){if(this.isTotal){return;}
var self=this;const resizeSnappingWidth=this._getResizeSnappingWidth(firstCell);this.$el.droppable({drop:function(event,ui){var diff=self._getDiff(resizeSnappingWidth,ui.position.left);var $pill=ui.draggable;var oldGroupId=$pill.closest('.o_gantt_row').data('group-id');if(diff||(self.groupId!==oldGroupId)){const action=event.ctrlKey||event.metaKey?'copy':'reschedule';self._saveDragChanges($pill.data('id'),diff,oldGroupId,self.groupId,action);}else{ui.helper.animate({left:0,top:0,});}},tolerance:'intersect',});},_bindPopover:function(){var self=this;this.$('.o_gantt_pill').popover({container:this.$el,trigger:'hover',delay:{show:this.POPOVER_DELAY},html:true,placement:'top',content:function(){return self.viewInfo.popoverQWeb.render('gantt-popover',self._getPopoverContext($(this).data('id')));},});},_calculateLevel:function(){if(this.isGroup||!this.pills.length){this.level=0;this.pills.forEach(function(pill){pill.level=0;});}else{this.pills=_.sortBy(this.pills,'startDate');this.pills[0].level=0;var levels=[{pills:[this.pills[0]],maxStopDate:this.pills[0].stopDate,}];for(var i=1;i<this.pills.length;i++){var currentPill=this.pills[i];for(var l=0;l<levels.length;l++){if(currentPill.startDate>=levels[l].maxStopDate){currentPill.level=l;levels[l].pills.push(currentPill);if(currentPill.stopDate>levels[l].maxStopDate){levels[l].maxStopDate=currentPill.stopDate;}
break;}}
if(!currentPill.level&&currentPill.level!=0){currentPill.level=levels.length;levels.push({pills:[currentPill],maxStopDate:currentPill.stopDate,});}}
this.level=levels.length;}},_adaptPills:function(){var self=this;var dateStartField=this.state.dateStartField;var dateStopField=this.state.dateStopField;var ganttStartDate=this.state.startDate;var ganttStopDate=this.state.stopDate;this.pills.forEach(function(pill){var pillStartDate=self._convertToUserTime(pill[dateStartField]);var pillStopDate=self._convertToUserTime(pill[dateStopField]);if(pillStartDate<ganttStartDate){pill.startDate=ganttStartDate;pill.disableStartResize=true;}else{pill.startDate=pillStartDate;}
if(pillStopDate>ganttStopDate){pill.stopDate=ganttStopDate;pill.disableStopResize=true;}else{pill.stopDate=pillStopDate;}
if(self.isGroup){pill.disableStartResize=true;pill.disableStopResize=true;}});},_aggregateGroupedPills:function(){var self=this;var sortedPills=_.sortBy(_.map(this.pills,_.clone),'startDate');var firstPill=sortedPills[0];firstPill.count=1;var timeToken=this.SCALES[this.state.scale].time;var precision=this.viewInfo.activeScaleInfo.precision;var cellTime=this.SCALES[this.state.scale].cellPrecisions[precision];var intervals=_.reduce(this.viewInfo.slots,function(intervals,slotStart){intervals.push(slotStart);if(precision==='half'){intervals.push(slotStart.clone().add(cellTime,timeToken));}
return intervals;},[]);this.pills=_.reduce(intervals,function(pills,intervalStart){var intervalStop=intervalStart.clone().add(cellTime,timeToken);var pillsInThisInterval=_.filter(self.pills,function(pill){return pill.startDate<intervalStop&&pill.stopDate>intervalStart;});if(pillsInThisInterval.length){var previousPill=pills[pills.length-1];var isContinuous=previousPill&&_.intersection(previousPill.aggregatedPills,pillsInThisInterval).length;if(isContinuous&&previousPill.count===pillsInThisInterval.length){previousPill.stopDate=intervalStop;previousPill.aggregatedPills=previousPill.aggregatedPills.concat(pillsInThisInterval);}else{var newPill={id:0,count:pillsInThisInterval.length,aggregatedPills:pillsInThisInterval,startDate:moment.max(_.min(pillsInThisInterval,'startDate').startDate,intervalStart),stopDate:moment.min(_.max(pillsInThisInterval,'stopDate').stopDate,intervalStop),};if(self.consolidate&&self.consolidationParams.field){newPill.consolidationValue=pillsInThisInterval.reduce(function(sum,pill){if(!pill[self.consolidationParams.excludeField]){return sum+pill[self.consolidationParams.field];}
return sum;},0);newPill.consolidationMaxValue=self.consolidationParams.maxValue;newPill.consolidationExceeded=newPill.consolidationValue>newPill.consolidationMaxValue;}
pills.push(newPill);}}
return pills;},[]);var maxCount=_.max(this.pills,function(pill){return pill.count;}).count;var minColor=215;var maxColor=100;this.pills.forEach(function(pill){pill.consolidated=true;if(self.consolidate&&self.consolidationParams.maxValue){pill.status=pill.consolidationExceeded?'danger':'success';pill.display_name=pill.consolidationValue;}else{var color=minColor-((pill.count-1)/maxCount)*(minColor-maxColor);pill.style=_.str.sprintf("background-color: rgba(%s, %s, %s, 0.6)",color,color,color);pill.display_name=pill.count;}});},_calculateMarginAndWidth:function(){var self=this;var left;var diff;this.pills.forEach(function(pill){switch(self.state.scale){case'day':left=pill.startDate.diff(pill.startDate.clone().startOf('hour'),'minutes');pill.leftMargin=(left/60)*100;diff=pill.stopDate.diff(pill.startDate,'minutes');var gapSize=pill.stopDate.diff(pill.startDate,'hours')-1;pill.width=gapSize>0?'calc('+(diff/60)*100+'% + '+gapSize+'px)':(diff/60)*100+'%';break;case'week':case'month':left=pill.startDate.diff(pill.startDate.clone().startOf('day'),'hours');pill.leftMargin=(left/24)*100;diff=pill.stopDate.diff(pill.startDate,'hours');var gapSize=pill.stopDate.diff(pill.startDate,'days')-1;pill.width=gapSize>0?'calc('+(diff/24)*100+'% + '+gapSize+'px)':(diff/24)*100+'%';break;case'year':var startDateMonthStart=pill.startDate.clone().startOf('month');var stopDateMonthEnd=pill.stopDate.clone().endOf('month');left=pill.startDate.diff(startDateMonthStart,'days');pill.leftMargin=(left/30)*100;var monthsDiff=stopDateMonthEnd.diff(startDateMonthStart,'months',true);if(monthsDiff<1){diff=Math.max(Math.ceil(pill.stopDate.diff(pill.startDate,'days',true)),2);pill.width=(diff/pill.startDate.daysInMonth())*100+"%";}else{var startDateMonthEnd=pill.startDate.clone().endOf('month');var diffMonthStart=Math.ceil(startDateMonthEnd.diff(pill.startDate,'days',true));var widthMonthStart=(diffMonthStart/pill.startDate.daysInMonth());var stopDateMonthStart=pill.stopDate.clone().startOf('month');var diffMonthStop=Math.ceil(pill.stopDate.diff(stopDateMonthStart,'days',true));var widthMonthStop=(diffMonthStop/pill.stopDate.daysInMonth());var width=Math.max((widthMonthStart+widthMonthStop),(2/30))*100;if(monthsDiff>2){width+=(monthsDiff-2)*100;}
pill.width=width+"%";}
break;default:break;}
pill.topPadding=pill.level*(self.LEVEL_TOP_OFFSET+1);});},_convertToUserTime:function(date){return date.clone().local();},_evaluateDecoration:function(){var self=this;this.pills.forEach(function(pill){var pillDecorations=[];_.each(self.viewInfo.pillDecorations,function(expr,decoration){if(py.PY_isTrue(py.evaluate(expr,self._getDecorationEvalContext(pill)))){pillDecorations.push(decoration);}});pill.decorations=pillDecorations;if(self.colorField){pill._color=self._getColor(pill[self.colorField]);}
if(self.progressField){pill._progress=pill[self.progressField]||0;}});},_getColor:function(value){if(_.isNumber(value)){return Math.round(value)%this.NB_GANTT_RECORD_COLORS;}else if(_.isArray(value)){return value[0]%this.NB_GANTT_RECORD_COLORS;}
return 0;},_getDecorationEvalContext:function(pillData){return _.extend(this._getPillEvalContext(pillData),session.user_context,{current_date:moment().format('YYYY-MM-DD')});},_getDiff:function(resizeSnappingWidth,gridOffset){return Math.round(gridOffset/resizeSnappingWidth)*this.viewInfo.activeScaleInfo.interval;},_getPillEvalContext:function(pillData){var pillContext=_.clone(pillData);for(var fieldName in pillContext){if(this.fieldsInfo[fieldName]){var fieldType=this.fieldsInfo[fieldName].type;if(pillContext[fieldName]._isAMomentObject){pillContext[fieldName]=pillContext[fieldName].format(pillContext[fieldName].f);}
else if(fieldType==='date'||fieldType==='datetime'){if(pillContext[fieldName]){pillContext[fieldName]=JSON.parse(JSON.stringify(pillContext[fieldName]));}
continue;}}}
return pillContext;},_getPopoverContext:function(pillID){var data=_.clone(_.findWhere(this.pills,{id:pillID}));data.userTimezoneStartDate=this._convertToUserTime(data[this.state.dateStartField]);data.userTimezoneStopDate=this._convertToUserTime(data[this.state.dateStopField]);return data;},_getResizeSnappingWidth:function(firstCell){if(!this.firstCell){this.firstCell=firstCell||$('.o_gantt_view .o_gantt_header_scale .o_gantt_header_cell:first')[0];}
return this.firstCell.getBoundingClientRect().width/this.cellPart;},_insertIntoSlot:function(){var self=this;var scale=this.state.scale;var intervalToken=this.SCALES[scale].interval;var precision=this.viewInfo.activeScaleInfo.precision;var x,y;this.slots=_.map(this.viewInfo.slots,function(date,key){var slotStart=date;var slotStop=date.clone().add(1,intervalToken);var slotHalf=moment((slotStart+slotStop)/2);var slotUnavailability;var morningUnavailabilities=0;var afternoonUnavailabilities=0;self.unavailabilities.forEach(function(unavailability){if(unavailability.start<slotStop&&unavailability.stop>slotStart){if((scale==='month'||scale==='week')){x=unavailability.start.diff(slotHalf)/(3600*1000);y=unavailability.stop.diff(slotHalf)/(3600*1000);if(x<0&&y<0){morningUnavailabilities+=Math.min(-x,12)-Math.min(-y,12);}else if(x>0&&y>0){afternoonUnavailabilities+=Math.min(y,12)-Math.min(x,12);}else{morningUnavailabilities+=Math.min(-x,12);afternoonUnavailabilities+=Math.min(y,12);}}else{slotUnavailability='full';}}});if(scale==='month'||scale==='week'){if((morningUnavailabilities>10&&afternoonUnavailabilities>10)||(precision!=='half'&&morningUnavailabilities+afternoonUnavailabilities>22)){slotUnavailability='full';}else if(morningUnavailabilities>10&&precision==='half'){slotUnavailability='first_half';}else if(afternoonUnavailabilities>10&&precision==='half'){slotUnavailability='second_half';}}
return{isToday:date.isSame(new Date(),'day')&&self.state.scale!=='day',unavailability:slotUnavailability,hasButtons:!self.isGroup&&!self.isTotal,start:slotStart,stop:slotStop,pills:[],};});var slotsToFill=this.slots;this.pills.forEach(function(currentPill){var skippedSlots=[];slotsToFill.some(function(currentSlot){var fitsInThisSlot=currentPill.startDate<currentSlot.stop;if(fitsInThisSlot){currentSlot.pills.push(currentPill);}else{skippedSlots.push(currentSlot);}
return fitsInThisSlot;});slotsToFill=_.difference(slotsToFill,skippedSlots);});},_saveDragChanges:function(pillId,diff,oldGroupId,newGroupId,action){this.trigger_up('pill_dropped',{pillId:pillId,diff:diff,oldGroupId:oldGroupId,newGroupId:newGroupId,groupLevel:this.groupLevel,action:action,});},_saveResizeChanges:function(pillID,resizeDiff,direction){var pill=_.findWhere(this.pills,{id:pillID});var data={id:pillID};if(direction==='left'){data.field=this.state.dateStartField;data.date=pill[this.state.dateStartField].clone().subtract(resizeDiff,this.viewInfo.activeScaleInfo.time);}else{data.field=this.state.dateStopField;data.date=pill[this.state.dateStopField].clone().add(resizeDiff,this.viewInfo.activeScaleInfo.time);}
this.trigger_up('pill_resized',data);},_setDraggable:function($pill){if($pill.hasClass('ui-draggable-dragging')){return;}
var self=this;var pill=_.findWhere(this.pills,{id:$pill.data('id')});if(this.options.canEdit&&!pill.disableStartResize&&!pill.disableStopResize&&!this.isGroup){const resizeSnappingWidth=this._getResizeSnappingWidth()
const grid=[resizeSnappingWidth,1];if($pill.draggable("instance")){$pill.draggable("option","grid",grid);return;}
if(!this.$containment){this.$containment=$('#o_gantt_containment');}
$pill.draggable({containment:this.$containment,grid:grid,start:function(event,ui){self.trigger_up('updating_pill_started');const pillWidth=$pill[0].getBoundingClientRect().width;ui.helper.css({width:pillWidth});ui.helper.removeClass('position-relative');self.trigger_up('start_dragging',{$draggedPill:$pill,$draggedPillClone:ui.helper,});self.$el.addClass('o_gantt_dragging');$pill.popover('hide');self.$('.o_gantt_pill').popover('disable');},drag:function(event,ui){if($(event.target).hasClass('o_gantt_pill_editing')){return false;}
var diff=self._getDiff(resizeSnappingWidth,ui.position.left);self._updateResizeBadge(ui.helper,diff,ui);},stop:function(){self.trigger_up('updating_pill_stopped');self.trigger_up('stop_dragging');self.$el.removeClass('o_gantt_dragging');self.$('.o_gantt_pill').popover('enable');},helper:'clone',});}else{if($pill.draggable("instance")){return;}
if(!this.$lockIndicator){this.$lockIndicator=$('<div class="fa fa-lock"/>').css({'z-index':20,position:'absolute',top:'4px',right:'4px',});}
$pill.draggable({grid:[0,0],start:function(){self.trigger_up('updating_pill_started');self.trigger_up('start_no_dragging');$pill.popover('hide');self.$('.o_gantt_pill').popover('disable');self.$lockIndicator.appendTo($pill);},drag:function(){if($(event.target).hasClass('o_gantt_pill_editing')){return false;}},stop:function(){self.trigger_up('updating_pill_stopped');self.trigger_up('stop_no_dragging');self.$('.o_gantt_pill').popover('enable');self.$lockIndicator.detach();},});$pill.addClass('o_fake_draggable');}},_setResizable:function($pill){if($pill.hasClass('ui-resizable')){return;}
var self=this;var pillHeight=this.$('.o_gantt_pill:first').height();var pill=_.findWhere(self.pills,{id:$pill.data('id')});const resizeSnappingWidth=this._getResizeSnappingWidth();var handles=[];if(!pill.disableStartResize){handles.push('w');}
if(!pill.disableStopResize){handles.push('e');}
if(handles.length&&!self.options.disableResize&&!self.isGroup&&self.options.canEdit){$pill.resizable({handles:handles.join(', '),odoo_isRTL:this.isRTL,grid:[resizeSnappingWidth,pillHeight],start:function(){$pill.popover('hide');self.$('.o_gantt_pill').popover('disable');self.trigger_up('updating_pill_started');self.$el.addClass('o_gantt_dragging');},resize:function(event,ui){var diff=Math.round((ui.size.width-ui.originalSize.width)/resizeSnappingWidth*self.viewInfo.activeScaleInfo.interval);self._updateResizeBadge($pill,diff,ui);},stop:function(event,ui){setTimeout(()=>{self.trigger_up('updating_pill_stopped');self.$el.removeClass('o_gantt_dragging');self.$('.o_gantt_pill').popover('enable');});var diff=Math.round((ui.size.width-ui.originalSize.width)/resizeSnappingWidth*self.viewInfo.activeScaleInfo.interval);var direction=ui.position.left?'left':'right';if(diff){self._saveResizeChanges(pill.id,diff,direction);}},});}},_snapToGrid:function(timeSpans){var self=this;var interval=this.viewInfo.activeScaleInfo.interval;switch(this.state.scale){case'day':timeSpans.forEach(function(span){var snappedStartDate=self._snapMinutes(span.startDate,interval);var snappedStopDate=self._snapMinutes(span.stopDate,interval);var minuteDiff=snappedStartDate.diff(snappedStopDate,'minute');if(minuteDiff===0){if(snappedStartDate>span.startDate){span.startDate=snappedStartDate.subtract(interval,'minute');span.stopDate=snappedStopDate;}else{span.startDate=snappedStartDate;span.stopDate=snappedStopDate.add(interval,'minute');}}else{span.startDate=snappedStartDate;span.stopDate=snappedStopDate;}});break;case'week':case'month':timeSpans.forEach(function(span){var snappedStartDate=self._snapHours(span.startDate,interval);var snappedStopDate=self._snapHours(span.stopDate,interval);var hourDiff=snappedStartDate.diff(snappedStopDate,'hour');if(hourDiff===0){if(snappedStartDate>span.startDate){span.startDate=snappedStartDate.subtract(interval,'hour');span.stopDate=snappedStopDate;}else{span.startDate=snappedStartDate;span.stopDate=snappedStopDate.add(interval,'hour');}}else{span.startDate=snappedStartDate;span.stopDate=snappedStopDate;}});break;case'year':timeSpans.forEach(function(span){span.startDate=span.startDate.clone().startOf('month');span.stopDate=span.stopDate.clone().endOf('month');});break;default:break;}},_snapHours:function(date,interval){var snappedHours=Math.round(date.clone().hour()/interval)*interval;return date.clone().hour(snappedHours).minute(0).second(0);},_snapMinutes:function(date,interval){var snappedMinutes=Math.round(date.clone().minute()/interval)*interval;return date.clone().minute(snappedMinutes).second(0);},_updateResizeBadge:function($pill,diff,ui){$pill.find('.o_gantt_pill_resize_badge').remove();if(diff){var direction=ui.position.left?'left':'right';$(QWeb.render('GanttView.ResizeBadge',{diff:diff,direction:direction,time:this.viewInfo.activeScaleInfo.time,}),{css:{'z-index':2}}).appendTo($pill);}},_onButtonAddClicked:function(ev){var date=moment($(ev.currentTarget).closest('.o_gantt_cell').data('date'));this.trigger_up('add_button_clicked',{date:date,groupId:this.groupId,});},_onButtonPlanClicked:function(ev){var date=moment($(ev.currentTarget).closest('.o_gantt_cell').data('date'));this.trigger_up('plan_button_clicked',{date:date,groupId:this.groupId,});},_onMouseMove:function(ev){if((this.options.canCreate||this.options.canEdit)&&!this.$el[0].classList.contains('o_gantt_dragging')){var elementsFromPoint=function(x,y){if(document.elementsFromPoint)
return document.elementsFromPoint(x,y);if(document.msElementsFromPoint){return Array.prototype.slice.call(document.msElementsFromPoint(x,y));}};var hoveredCell;if(ev.target.classList.contains('o_gantt_pill')||ev.target.parentNode.classList.contains('o_gantt_pill')){elementsFromPoint(ev.pageX,ev.pageY).some(function(element){return element.classList.contains('o_gantt_cell')?((hoveredCell=element),true):false;});}else{hoveredCell=ev.currentTarget;}
if(hoveredCell&&hoveredCell!=this.lastHoveredCell){if(this.lastHoveredCell){this.lastHoveredCell.classList.remove('o_hovered');}
hoveredCell.classList.add('o_hovered');this.lastHoveredCell=hoveredCell;}}},_onMouseLeave:function(){this.$(".o_gantt_cell.o_hovered").removeClass('o_hovered');this.lastHoveredCell=undefined;},_onPillClicked:function(ev){if(!this.isGroup){this.trigger_up('pill_clicked',{target:$(ev.currentTarget),});}},_onPillEntered:function(ev){var $pill=$(ev.currentTarget);this._setResizable($pill);if(!this.isTotal){this._setDraggable($pill);}},_onRowSidebarClicked:function(){if(this.isGroup&!this.isTotal){if(this.isOpen){this.trigger_up('collapse_row',{rowId:this.rowId});}else{this.trigger_up('expand_row',{rowId:this.rowId});}}},});return GanttRow;});;

/* /web_grid/static/lib/snabbdom-0.5.0/snabbdom.js defined in bundle 'web.assets_backend' */
odoo.define('snabbdom.vnode',function(require){return function(sel,data,children,text,elm){var key=data===undefined?undefined:data.key;return{sel:sel,data:data,children:children,text:text,elm:elm,key:key};};});odoo.define('snabbdom.is',function(require){return{array:Array.isArray,primitive:function(s){return typeof s==='string'||typeof s==='number';},};});odoo.define('snabbdom.h',function(require){var VNode=require('snabbdom.vnode');var is=require('snabbdom.is');function addNS(data,children){data.ns='http://www.w3.org/2000/svg';if(children!==undefined){for(var i=0;i<children.length;++i){addNS(children[i].data,children[i].children);}}}
return function h(sel,b,c){var data={},children,text,i;if(arguments.length===3){data=b;if(is.array(c)){children=c;}else if(is.primitive(c)){text=c;}}else if(arguments.length===2){if(is.array(b)){children=b;}else if(is.primitive(b)){text=b;}else{data=b;}}
if(is.array(children)){for(i=0;i<children.length;++i){if(is.primitive(children[i]))children[i]=VNode(undefined,undefined,undefined,children[i]);}}
if(sel[0]==='s'&&sel[1]==='v'&&sel[2]==='g'){addNS(data,children);}
return VNode(sel,data,children,text,undefined);};});odoo.define('snabbdom.init',function(require){'use strict';var VNode=require('snabbdom.vnode');var is=require('snabbdom.is');function isUndef(s){return s===undefined;}
function isDef(s){return s!==undefined;}
var emptyNode=VNode('',{},[],undefined,undefined);function sameVnode(vnode1,vnode2){return vnode1.key===vnode2.key&&vnode1.sel===vnode2.sel;}
function createKeyToOldIdx(children,beginIdx,endIdx){var i,map={},key;for(i=beginIdx;i<=endIdx;++i){key=children[i].key;if(isDef(key))map[key]=i;}
return map;}
var hooks=['create','update','remove','destroy','pre','post'];function init(modules){var i,j,cbs={};for(i=0;i<hooks.length;++i){cbs[hooks[i]]=[];for(j=0;j<modules.length;++j){if(modules[j][hooks[i]]!==undefined)cbs[hooks[i]].push(modules[j][hooks[i]]);}}
function emptyNodeAt(elm){return VNode(elm.tagName.toLowerCase(),{},[],undefined,elm);}
function createRmCb(childElm,listeners){return function(){if(--listeners===0){var parent=childElm.parentElement;parent.removeChild(childElm);}};}
function createElm(vnode,insertedVnodeQueue){var i,data=vnode.data;if(isDef(data)){if(isDef(i=data.hook)&&isDef(i=i.init)){i(vnode);data=vnode.data;}}
var elm,children=vnode.children,sel=vnode.sel;if(isDef(sel)){var hashIdx=sel.indexOf('#');var dotIdx=sel.indexOf('.',hashIdx);var hash=hashIdx>0?hashIdx:sel.length;var dot=dotIdx>0?dotIdx:sel.length;var tag=hashIdx!==-1||dotIdx!==-1?sel.slice(0,Math.min(hash,dot)):sel;elm=vnode.elm=isDef(data)&&isDef(i=data.ns)?document.createElementNS(i,tag):document.createElement(tag);if(hash<dot)elm.id=sel.slice(hash+1,dot);if(dotIdx>0)elm.className=sel.slice(dot+1).replace(/\./g,' ');if(is.array(children)){for(i=0;i<children.length;++i){elm.appendChild(createElm(children[i],insertedVnodeQueue));}}else if(is.primitive(vnode.text)){elm.appendChild(document.createTextNode(vnode.text));}
for(i=0;i<cbs.create.length;++i)cbs.create[i](emptyNode,vnode);i=vnode.data.hook;if(isDef(i)){if(i.create)i.create(emptyNode,vnode);if(i.insert)insertedVnodeQueue.push(vnode);}}else{elm=vnode.elm=document.createTextNode(vnode.text);}
return vnode.elm;}
function addVnodes(parentElm,before,vnodes,startIdx,endIdx,insertedVnodeQueue){for(;startIdx<=endIdx;++startIdx){parentElm.insertBefore(createElm(vnodes[startIdx],insertedVnodeQueue),before);}}
function invokeDestroyHook(vnode){var i,j,data=vnode.data;if(isDef(data)){if(isDef(i=data.hook)&&isDef(i=i.destroy))i(vnode);for(i=0;i<cbs.destroy.length;++i)cbs.destroy[i](vnode);if(isDef(i=vnode.children)){for(j=0;j<vnode.children.length;++j){invokeDestroyHook(vnode.children[j]);}}}}
function removeVnodes(parentElm,vnodes,startIdx,endIdx){for(;startIdx<=endIdx;++startIdx){var i,listeners,rm,ch=vnodes[startIdx];if(isDef(ch)){if(isDef(ch.sel)){invokeDestroyHook(ch);listeners=cbs.remove.length+1;rm=createRmCb(ch.elm,listeners);for(i=0;i<cbs.remove.length;++i)cbs.remove[i](ch,rm);if(isDef(i=ch.data)&&isDef(i=i.hook)&&isDef(i=i.remove)){i(ch,rm);}else{rm();}}else{parentElm.removeChild(ch.elm);}}}}
function updateChildren(parentElm,oldCh,newCh,insertedVnodeQueue){var oldStartIdx=0,newStartIdx=0;var oldEndIdx=oldCh.length-1;var oldStartVnode=oldCh[0];var oldEndVnode=oldCh[oldEndIdx];var newEndIdx=newCh.length-1;var newStartVnode=newCh[0];var newEndVnode=newCh[newEndIdx];var oldKeyToIdx,idxInOld,elmToMove,before;while(oldStartIdx<=oldEndIdx&&newStartIdx<=newEndIdx){if(isUndef(oldStartVnode)){oldStartVnode=oldCh[++oldStartIdx];}else if(isUndef(oldEndVnode)){oldEndVnode=oldCh[--oldEndIdx];}else if(sameVnode(oldStartVnode,newStartVnode)){patchVnode(oldStartVnode,newStartVnode,insertedVnodeQueue);oldStartVnode=oldCh[++oldStartIdx];newStartVnode=newCh[++newStartIdx];}else if(sameVnode(oldEndVnode,newEndVnode)){patchVnode(oldEndVnode,newEndVnode,insertedVnodeQueue);oldEndVnode=oldCh[--oldEndIdx];newEndVnode=newCh[--newEndIdx];}else if(sameVnode(oldStartVnode,newEndVnode)){patchVnode(oldStartVnode,newEndVnode,insertedVnodeQueue);parentElm.insertBefore(oldStartVnode.elm,oldEndVnode.elm.nextSibling);oldStartVnode=oldCh[++oldStartIdx];newEndVnode=newCh[--newEndIdx];}else if(sameVnode(oldEndVnode,newStartVnode)){patchVnode(oldEndVnode,newStartVnode,insertedVnodeQueue);parentElm.insertBefore(oldEndVnode.elm,oldStartVnode.elm);oldEndVnode=oldCh[--oldEndIdx];newStartVnode=newCh[++newStartIdx];}else{if(isUndef(oldKeyToIdx))oldKeyToIdx=createKeyToOldIdx(oldCh,oldStartIdx,oldEndIdx);idxInOld=oldKeyToIdx[newStartVnode.key];if(isUndef(idxInOld)){parentElm.insertBefore(createElm(newStartVnode,insertedVnodeQueue),oldStartVnode.elm);newStartVnode=newCh[++newStartIdx];}else{elmToMove=oldCh[idxInOld];patchVnode(elmToMove,newStartVnode,insertedVnodeQueue);oldCh[idxInOld]=undefined;parentElm.insertBefore(elmToMove.elm,oldStartVnode.elm);newStartVnode=newCh[++newStartIdx];}}}
if(oldStartIdx>oldEndIdx){before=isUndef(newCh[newEndIdx+1])?null:newCh[newEndIdx+1].elm;addVnodes(parentElm,before,newCh,newStartIdx,newEndIdx,insertedVnodeQueue);}else if(newStartIdx>newEndIdx){removeVnodes(parentElm,oldCh,oldStartIdx,oldEndIdx);}}
function patchVnode(oldVnode,vnode,insertedVnodeQueue){var i,hook;if(isDef(i=vnode.data)&&isDef(hook=i.hook)&&isDef(i=hook.prepatch)){i(oldVnode,vnode);}
var elm=vnode.elm=oldVnode.elm,oldCh=oldVnode.children,ch=vnode.children;if(oldVnode===vnode)return;if(!sameVnode(oldVnode,vnode)){var parentElm=oldVnode.elm.parentElement;elm=createElm(vnode,insertedVnodeQueue);parentElm.insertBefore(elm,oldVnode.elm);removeVnodes(parentElm,[oldVnode],0,0);return;}
if(isDef(vnode.data)){for(i=0;i<cbs.update.length;++i)cbs.update[i](oldVnode,vnode);i=vnode.data.hook;if(isDef(i)&&isDef(i=i.update))i(oldVnode,vnode);}
if(isUndef(vnode.text)){if(isDef(oldCh)&&isDef(ch)){if(oldCh!==ch)updateChildren(elm,oldCh,ch,insertedVnodeQueue);}else if(isDef(ch)){if(isDef(oldVnode.text)){elm.textContent='';}
addVnodes(elm,null,ch,0,ch.length-1,insertedVnodeQueue);}else if(isDef(oldCh)){removeVnodes(elm,oldCh,0,oldCh.length-1);}else if(isDef(oldVnode.text)){elm.textContent='';}}else if(oldVnode.text!==vnode.text){elm.textContent=vnode.text;}
if(isDef(hook)&&isDef(i=hook.postpatch)){i(oldVnode,vnode);}}
return function(oldVnode,vnode){var i,elm,parent;var insertedVnodeQueue=[];for(i=0;i<cbs.pre.length;++i)cbs.pre[i]();if(isUndef(oldVnode.sel)){oldVnode=emptyNodeAt(oldVnode);}
if(sameVnode(oldVnode,vnode)){patchVnode(oldVnode,vnode,insertedVnodeQueue);}else{elm=oldVnode.elm;parent=elm.parentElement;createElm(vnode,insertedVnodeQueue);if(parent!==null){parent.insertBefore(vnode.elm,elm.nextSibling);removeVnodes(parent,[oldVnode],0,0);}}
for(i=0;i<insertedVnodeQueue.length;++i){insertedVnodeQueue[i].data.hook.insert(insertedVnodeQueue[i]);}
for(i=0;i<cbs.post.length;++i)cbs.post[i]();return vnode;};}
return init;});odoo.define('snabbdom.thunk',function(require){var h=require('snabbdom.h');function copyToThunk(vnode,thunk){thunk.elm=vnode.elm;vnode.data.fn=thunk.data.fn;vnode.data.args=thunk.data.args;thunk.data=vnode.data;thunk.children=vnode.children;thunk.text=vnode.text;thunk.elm=vnode.elm;}
function init(thunk){var i,cur=thunk.data;var vnode=cur.fn.apply(undefined,cur.args);copyToThunk(vnode,thunk);}
function prepatch(oldVnode,thunk){var i,old=oldVnode.data,cur=thunk.data,vnode;var oldArgs=old.args,args=cur.args;if(old.fn!==cur.fn||oldArgs.length!==args.length){copyToThunk(cur.fn.apply(undefined,args),thunk);}
for(i=0;i<args.length;++i){if(oldArgs[i]!==args[i]){copyToThunk(cur.fn.apply(undefined,args),thunk);return;}}
copyToThunk(oldVnode,thunk);}
return function(sel,key,fn,args){if(args===undefined){args=fn;fn=key;key=undefined;}
return h(sel,{key:key,hook:{init:init,prepatch:prepatch},fn:fn,args:args});};});odoo.define('snabbdom.class',function(require){function updateClass(oldVnode,vnode){var cur,name,elm=vnode.elm,oldClass=oldVnode.data.class||{},klass=vnode.data.class||{};for(name in oldClass){if(!klass[name]){elm.classList.remove(name);}}
for(name in klass){cur=klass[name];if(cur!==oldClass[name]){elm.classList[cur?'add':'remove'](name);}}}
return{create:updateClass,update:updateClass};});odoo.define('snabbdom.props',function(require){function updateProps(oldVnode,vnode){var key,cur,old,elm=vnode.elm,oldProps=oldVnode.data.props||{},props=vnode.data.props||{};for(key in oldProps){if(!props[key]){delete elm[key];}}
for(key in props){cur=props[key];old=oldProps[key];if(old!==cur&&(key!=='value'||elm[key]!==cur)){elm[key]=cur;}}}
return{create:updateProps,update:updateProps};});odoo.define('snabbdom.attributes',function(require){var booleanAttrs=["allowfullscreen","async","autofocus","autoplay","checked","compact","controls","declare","default","defaultchecked","defaultmuted","defaultselected","defer","disabled","draggable","enabled","formnovalidate","hidden","indeterminate","inert","ismap","itemscope","loop","multiple","muted","nohref","noresize","noshade","novalidate","nowrap","open","pauseonexit","readonly","required","reversed","scoped","seamless","selected","sortable","spellcheck","translate","truespeed","typemustmatch","visible"];var booleanAttrsDict={};for(var i=0,len=booleanAttrs.length;i<len;i++){booleanAttrsDict[booleanAttrs[i]]=true;}
function updateAttrs(oldVnode,vnode){var key,cur,old,elm=vnode.elm,oldAttrs=oldVnode.data.attrs||{},attrs=vnode.data.attrs||{};for(key in attrs){cur=attrs[key];old=oldAttrs[key];if(old!==cur){if(!cur&&booleanAttrsDict[key])
elm.removeAttribute(key);else
elm.setAttribute(key,cur);}}
for(key in oldAttrs){if(!(key in attrs)){elm.removeAttribute(key);}}}
return{create:updateAttrs,update:updateAttrs};});odoo.define('snabbdom.eventlistener',function(require){function invokeHandler(handler,vnode,event){if(typeof handler==="function"){handler.call(vnode,event,vnode);}
else if(typeof handler==="object"){if(typeof handler[0]==="function"){if(handler.length===2){handler[0].call(vnode,handler[1],event,vnode);}
else{var args=handler.slice(1);args.push(event);args.push(vnode);handler[0].apply(vnode,args);}}
else{for(var i=0;i<handler.length;i++){invokeHandler(handler[i]);}}}}
function handleEvent(event,vnode){var name=event.type,on=vnode.data.on;if(on&&on[name]){invokeHandler(on[name],vnode,event);}}
function createListener(){return function handler(event){handleEvent(event,handler.vnode);};}
function updateEventListeners(oldVnode,vnode){var oldOn=oldVnode.data.on,oldListener=oldVnode.listener,oldElm=oldVnode.elm,on=vnode&&vnode.data.on,elm=(vnode&&vnode.elm),name;if(oldOn===on){return;}
if(oldOn&&oldListener){if(!on){for(name in oldOn){oldElm.removeEventListener(name,oldListener,false);}}
else{for(name in oldOn){if(!on[name]){oldElm.removeEventListener(name,oldListener,false);}}}}
if(on){var listener=vnode.listener=oldVnode.listener||createListener();listener.vnode=vnode;if(!oldOn){for(name in on){elm.addEventListener(name,listener,false);}}
else{for(name in on){if(!oldOn[name]){elm.addEventListener(name,listener,false);}}}}}
return{create:updateEventListeners,update:updateEventListeners,destroy:updateEventListeners}});odoo.define('snabbdom.patch',function(require){return require('snabbdom.init')([require('snabbdom.class'),require('snabbdom.props'),require('snabbdom.attributes'),require('snabbdom.eventlistener')]);});;

/* /web_grid/static/src/js/grid_view.js defined in bundle 'web.assets_backend' */
odoo.define('web_grid.GridView',function(require){"use strict";var AbstractView=require('web.AbstractView');var config=require('web.config');var core=require('web.core');var GridModel=require('web_grid.GridModel');var GridController=require('web_grid.GridController');var GridRenderer=require('web_grid.GridRenderer');var viewRegistry=require('web.view_registry');var pyUtils=require('web.py_utils');var _t=core._t;var _lt=core._lt;var GridView=AbstractView.extend({display_name:_lt('Grid'),mobile_friendly:true,icon:'fa-th',config:_.extend({},AbstractView.prototype.config,{Model:GridModel,Controller:GridController,Renderer:GridRenderer,}),viewType:'grid',init:function(viewInfo,params){var self=this;this._super.apply(this,arguments);var arch=this.arch;var fields=this.fields;var rowFields=[];var sectionField,colField,cellField,ranges,cellWidget,cellWidgetOptions,measureLabel,readonlyField;_.each(arch.children,function(child){if(child.tag==='field'){if(child.attrs.type==='row'){if(child.attrs.section==='1'&&!sectionField){sectionField=child.attrs.name;}
rowFields.push(child.attrs.name);}
if(child.attrs.type==='col'){colField=child.attrs.name;ranges=self._extract_ranges(child,params.context);}
if(child.attrs.type==='measure'){cellField=child.attrs.name;cellWidget=child.attrs.widget;if(child.attrs.options){cellWidgetOptions=JSON.parse(child.attrs.options.replace(/'/g,'"'));}
measureLabel=child.attrs.string;}
if(child.attrs.type==='readonly'){readonlyField=child.attrs.name;}}});this.loadParams.ranges=ranges;var contextRangeName=params.context.grid_range;var contextRange=contextRangeName&&_.findWhere(ranges,{name:contextRangeName});this.loadParams.currentRange=contextRange||ranges[0];this.loadParams.rowFields=rowFields;this.loadParams.sectionField=sectionField;this.loadParams.colField=colField;this.loadParams.cellField=cellField;this.loadParams.groupedBy=params.groupBy;this.loadParams.readonlyField=readonlyField;this.rendererParams.canCreate=this.controllerParams.activeActions.create;this.rendererParams.fields=fields;this.rendererParams.measureLabel=measureLabel;this.rendererParams.noContentHelper=_.find(arch.children,function(c){return c.tag==='empty';});this.rendererParams.editableCells=this.controllerParams.activeActions.edit&&arch.attrs.adjustment;this.rendererParams.cellWidget=cellWidget;this.rendererParams.cellWidgetOptions=cellWidgetOptions;this.controllerParams.formViewID=false;this.controllerParams.listViewID=false;_.each(params.actionViews,function(view){if(view.type==='form'){self.controllerParams.formViewID=view.viewID;}
if(view.type==='list'){self.controllerParams.listViewID=view.viewID;}});this.controllerParams.context=params.context;this.controllerParams.ranges=ranges;this.controllerParams.currentRange=this.loadParams.currentRange.name;this.controllerParams.navigationButtons=arch.children.filter(function(c){return c.tag==='button';}).map(function(c){return c.attrs;});this.controllerParams.adjustment=arch.attrs.adjustment;this.controllerParams.adjustName=arch.attrs.adjust_name;},_extract_ranges:function(col_node,context){var ranges=[];if(config.device.isMobile){ranges.push({name:'day',string:_t('Day'),span:'day',step:'day',});}
var pyevalContext=py.dict.fromJSON(context||{});_.each(_.pluck(col_node.children,'attrs'),function(range){if(range.invisible&&pyUtils.py_eval(range.invisible,{'context':pyevalContext})){return;}
ranges.push(range);});return ranges;},});viewRegistry.add('grid',GridView);return GridView;});;

/* /web_grid/static/src/js/grid_model.js defined in bundle 'web.assets_backend' */
odoo.define('web_grid.GridModel',function(require){"use strict";var AbstractModel=require('web.AbstractModel');var concurrency=require('web.concurrency');return AbstractModel.extend({init:function(){this._super.apply(this,arguments);this._gridData=null;this._fetchMutex=new concurrency.MutexedDropPrevious();},get:function(){return this._gridData;},getContext:function(context){var c=_.extend({},this.context,context);return c;},getIds:function(){var data=this._gridData;if(!_.isArray(data)){data=[data];}
var domain=[];var cells=0;for(var i=0;i<data.length;i++){var grid=data[i].grid;for(var j=0;j<grid.length;j++){var row=grid[j];for(var k=0;k<row.length;k++){var cell=row[k];if(cell.size!==0){cells++;domain.push.apply(domain,cell.domain);}}}}
if(cells===0){return Promise.resolve([]);}
while(--cells>0){domain.unshift('|');}
return this._rpc({model:this.modelName,method:'search',args:[domain],context:this.getContext(),});},load:function(params){this.modelName=params.modelName;this.rowFields=params.rowFields;this.sectionField=params.sectionField;this.colField=params.colField;this.cellField=params.cellField;this.ranges=params.ranges;this.currentRange=params.currentRange;this.domain=params.domain;this.context=params.context;var groupedBy=(params.groupedBy&&params.groupedBy.length)?params.groupedBy:this.rowFields;this.groupedBy=Array.isArray(groupedBy)?groupedBy:[groupedBy];this.readonlyField=params.readonlyField;return this._fetch(this.groupedBy);},reload:function(handle,params){if(params==='special'){return Promise.resolve();}
params=params||{};if('context'in params){var old_context=this.context;this.context=params.context;if(old_context.grid_anchor!==undefined||params.context.grid_anchor!==undefined){this.context.grid_anchor=old_context.grid_anchor||params.context.grid_anchor;}}
if('domain'in params){this.domain=params.domain;}
if('pagination'in params){_.extend(this.context,params.pagination);}
if('range'in params){this.currentRange=_.findWhere(this.ranges,{name:params.range});}
if('groupBy'in params){if(params.groupBy.length){this.groupedBy=Array.isArray(params.groupBy)?params.groupBy:[params.groupBy];}else{this.groupedBy=this.rowFields;}}
return this._fetch(this.groupedBy);},_fetch:function(groupBy){var self=this;if(!this.currentRange){return Promise.resolve();}
return this._fetchMutex.exec(function(){if(self.sectionField&&self.sectionField===groupBy[0]){return self._fetchGroupedData(groupBy);}else{return self._fetchUngroupedData(groupBy);}});},_fetchGroupedData:function(groupBy){var self=this;return this._rpc({model:self.modelName,method:'read_grid_domain',kwargs:{field:self.colField,range:self.currentRange,},context:self.getContext(),}).then(function(d){return self._rpc({model:self.modelName,method:'read_group',kwargs:{domain:d.concat(self.domain||[]),fields:[self.sectionField],groupby:[self.sectionField],},context:self.getContext()});}).then(function(groups){if(!groups.length){return Promise.all([self._fetchSectionGrid(groupBy,{__domain:self.domain||[],})]);}
return Promise.all((groups||[]).map(function(group){return self._fetchSectionGrid(groupBy,group);}));}).then(function(results){self._gridData=results;self._gridData.groupBy=groupBy;self._gridData.colField=self.colField;self._gridData.cellField=self.cellField;self._gridData.range=self.currentRange.name;self._gridData.context=self.context;var r0=results[0];self._gridData.prev=r0&&r0.prev;self._gridData.next=r0&&r0.next;});},_fetchSectionGrid:function(groupBy,sectionGroup,additionalContext){var self=this;var rpcProm=this._rpc({model:this.modelName,method:'read_grid',kwargs:{row_fields:groupBy.slice(1),col_field:this.colField,cell_field:this.cellField,range:this.currentRange,domain:sectionGroup.__domain,readonly_field:this.readonlyField,},context:this.getContext(additionalContext),})
rpcProm.then(function(grid){grid.__label=sectionGroup[self.sectionField];});return rpcProm;},_fetchUngroupedData:function(groupBy){var self=this;return this._rpc({model:self.modelName,method:'read_grid',kwargs:{row_fields:groupBy,col_field:self.colField,cell_field:self.cellField,domain:self.domain,range:self.currentRange,readonly_field:this.readonlyField,},context:self.getContext(),}).then(function(result){self._gridData=result;self._gridData.groupBy=groupBy;self._gridData.colField=self.colField;self._gridData.cellField=self.cellField;self._gridData.range=self.currentRange.name;self._gridData.context=self.context;});},});});;

/* /web_grid/static/src/js/grid_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web_grid.GridController',function(require){"use strict";var AbstractController=require('web.AbstractController');var config=require('web.config');var core=require('web.core');var dialogs=require('web.view_dialogs');var utils=require('web.utils');var concurrency=require('web.concurrency');var qweb=core.qweb;var _t=core._t;var GridController=AbstractController.extend({custom_events:_.extend({},AbstractController.prototype.custom_events,{'cell_edited':'_onCellEdited',}),events:{'click .o_grid_cell_information':'_onClickCellInformation','focus .o_grid_input':'_onGridInputFocus',},init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.context=params.context;this.navigationButtons=params.navigationButtons;this.ranges=params.ranges;this.currentRange=params.currentRange;this.formViewID=params.formViewID;this.listViewID=params.listViewID;this.adjustment=params.adjustment;this.adjustName=params.adjustName;this.canCreate=params.activeActions.create;this.mutex=new concurrency.Mutex();},renderButtons:function($node){this.$buttons=$(qweb.render('grid.GridArrows',{widget:{_ranges:this.ranges,_buttons:this.navigationButtons,allowCreate:this.canCreate,},isMobile:config.device.isMobile}));this.$buttons.appendTo($node);this._updateButtons();this.$buttons.on('click','.o_grid_button_add',this._onAddLine.bind(this));this.$buttons.on('click','.grid_arrow_previous',this._onPaginationChange.bind(this,'prev'));this.$buttons.on('click','.grid_button_initial',this._onPaginationChange.bind(this,'initial'));this.$buttons.on('click','.grid_arrow_next',this._onPaginationChange.bind(this,'next'));this.$buttons.on('click','.grid_arrow_range',this._onRangeChange.bind(this));this.$buttons.on('click','.grid_arrow_button',this._onButtonClicked.bind(this));},_adjust:function(cell,newValue){var difference=newValue-cell.value;if(Math.abs(difference)<1e-6){return Promise.resolve();}
var state=this.model.get();var domain=this.model.domain.concat(cell.row.domain);var self=this;return this.mutex.exec(function(){if(self.adjustment==='action'){var actionData={type:self.adjustment,name:self.adjustName,context:self.model.getContext({grid_adjust:{row_domain:domain,column_field:state.colField,column_value:cell.col.values[state.colField][0],cell_field:state.cellField,change:difference,},}),};return self.trigger_up('execute_action',{action_data:actionData,env:{context:self.model.getContext(),model:self.modelName},on_success:self.reload.bind(self),});}
return self._rpc({model:self.modelName,method:self.adjustName,args:[[],domain,state.colField,cell.col.values[state.colField][0],state.cellField,difference],context:self.model.getContext()}).then(function(){return self.model.reload();}).then(function(){var state=self.model.get();return self.renderer.updateState(state,{});}).then(function(){self._updateButtons(state);});});},_update:function(){return this._super.apply(this,arguments).then(this._updateButtons.bind(this));},_updateButtons:function(){if(this.$buttons){var state=this.model.get();this.$buttons.find('.grid_arrow_previous').toggleClass('d-none',!state.prev);this.$buttons.find('.grid_arrow_next').toggleClass('d-none',!state.next);this.$buttons.find('.grid_button_initial').toggleClass('d-none',!state.initial);this.$buttons.find('.grid_arrow_range').removeClass('active');this.$buttons.find('.grid_arrow_range[data-name='+this.currentRange+']').addClass('active');}},_onAddLine:function(event){event.preventDefault();var context=this.model.getContext();var formContext=_.extend({},context,{view_grid_add_line:true});var formViewID=context.quick_create_view||this.formViewID||false;new dialogs.FormViewDialog(this,{res_model:this.modelName,res_id:false,context:formContext,view_id:formViewID,title:_t("Add a Line"),disable_multiple_selection:true,on_saved:this.reload.bind(this,{}),}).open();},_onCellEdited:function(event){var state=this.model.get();this._adjust({row:utils.into(state,event.data.row_path),col:utils.into(state,event.data.col_path),value:utils.into(state,event.data.cell_path).value,},event.data.value).then(function(){if(event.data.doneCallback!==undefined){event.data.doneCallback();}}).guardedCatch(function(){if(event.data.doneCallback!==undefined){event.data.doneCallback();}})},_onButtonClicked:function(e){var self=this;e.stopPropagation();var button=this.navigationButtons[$(e.target).attr('data-index')];var actionData=_.extend({},button,{context:this.model.getContext(button.context),});this.model.getIds().then(function(ids){self.trigger_up('execute_action',{action_data:actionData,env:{context:self.model.getContext(),model:self.modelName,resIDs:ids,},on_closed:self.reload.bind(self,{}),});});},_onClickCellInformation:function(e){var self=this;var $target=$(e.target);var cell_path=$target.parent().attr('data-path').split('.');var row_path=cell_path.slice(0,-3).concat(['rows'],cell_path.slice(-2,-1));var state=this.model.get();var cell=utils.into(state,cell_path);var row=utils.into(state,row_path);var groupFields=state.groupBy.slice(_.isArray(state)?1:0);var label=_.map(groupFields,function(g){return row.values[g][1]||_t('Undefined');}).join(': ');var cols_path=cell_path.slice(0,-3).concat(['cols'],cell_path.slice(-1));var col=utils.into(state,cols_path);var column_value=col.values[state.colField][0];if(!column_value)
{column_value=false;}
else if(!_.isNumber(column_value))
{column_value=column_value.split("/")[0]}
var ctx=_.extend({},this.context);var sectionField=_.find(this.renderer.fields,function(res){return self.model.sectionField===res.name;});if(this.model.sectionField&&state.groupBy&&state.groupBy[0]===this.model.sectionField){var value=state[parseInt(cols_path[0])].__label;ctx['default_'+this.model.sectionField]=_.isArray(value)?value[0]:value;}
_.each(groupFields,function(field){ctx['default_'+field]=row.values[field][0]||false;});ctx['default_'+state.colField]=column_value;ctx['create']=!cell.readonly
ctx['edit']=!cell.readonly
this.do_action({type:'ir.actions.act_window',name:label,res_model:this.modelName,views:[[this.listViewID,'list'],[this.formViewID,'form']],domain:cell.domain,context:ctx,});},_onGridInputFocus:function(e){var selection=window.getSelection();var range=document.createRange();range.selectNodeContents(e.target);selection.removeAllRanges();selection.addRange(range);},_onPaginationChange:function(dir){var state=this.model.get();this.update({pagination:state[dir]});},_onRangeChange:function(e){e.stopPropagation();var $target=$(e.target);if(config.device.isMobile){$target.closest(".dropdown-menu").prev().dropdown("toggle");}
if($target.hasClass('active')){return;}
this.currentRange=$target.attr('data-name');this.update({range:this.currentRange});},});return GridController;});;

/* /web_grid/static/src/js/grid_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web_grid.GridRenderer',function(require){"use strict";var AbstractRenderer=require('web.AbstractRenderer');var core=require('web.core');var utils=require('web.utils');var fieldUtils=require('web.field_utils');var gridWidgetRegistry=require('web_grid.widget_registry');var patch=require('snabbdom.patch');var h=require('snabbdom.h');var _t=core._t;return AbstractRenderer.extend({custom_events:_.extend({},AbstractRenderer.prototype.custom_events,{'grid_cell_edited':'_onGridWidgetBlur','grid_cell_refresh':'_onGridWidgetRefresh',}),events:{'blur .o_grid_input':"_onGridInputBlur",'keydown .o_grid_input':"_onGridInputKeydown",},init:function(parent,state,params){this._super.apply(this,arguments);this.canCreate=params.canCreate;this.fields=params.fields;this.noContentHelper=params.noContentHelper;this.editableCells=params.editableCells;this.measureLabel=params.measureLabel;this.cellWidget=params.cellWidget;this.cellWidgetOptions=params.cellWidgetOptions||{};if(gridWidgetRegistry.contains(this.cellWidget)){var WidgetClass=gridWidgetRegistry.get(this.cellWidget);this.CellWidgetInstance=new WidgetClass(this,this.fields[this.state.cellField],this.cellWidgetOptions);}
this.formatType=this.CellWidgetInstance&&this.CellWidgetInstance.formatType?this.CellWidgetInstance.formatType:this.fields[this.state.cellField].type;},start:function(){this._state=document.createElement('div');this.el.appendChild(this._state);return this._super();},_convertToVNode:function(root){var self=this;return h(root.tag,{'attrs':root.attrs},_.map(root.children,function(child){if(child.tag){return self._convertToVNode(child);}
return child;}));},_computeTotals:function(grid){var totals={super:0,rows:{},columns:{}};for(var i=0;i<grid.length;i++){var row=grid[i];for(var j=0;j<row.length;j++){var cell=row[j];totals.super+=cell.value;totals.rows[i]=(totals.rows[i]||0)+cell.value;totals.columns[j]=(totals.columns[j]||0)+cell.value;}}
return totals;},_format:function(value){if(value===undefined){return'';}
if(this.CellWidgetInstance){return this.CellWidgetInstance.format(value);}
var cellField=this.fields[this.state.cellField];return fieldUtils.format[this.formatType](value,cellField,this.cellWidgetOptions);},_hasContent:function(){var state=_.isArray(this.state)?this.state[0]:this.state;return state.rows[0]!==undefined;},_isCellReadonly:function(cell){return!this.editableCells||cell.readonly;},_parse:function(value){if(this.CellWidgetInstance){return this.CellWidgetInstance.parse(value);}
var cellField=this.fields[this.state.cellField];return fieldUtils.parse[this.formatType](value,cellField,this.cellWidgetOptions);},_field2label:function(value_to_display,field_type){if(!value_to_display){return _t('Unknown');}
if(["many2one","many2many","one2many","selection"].indexOf(field_type)>-1){return value_to_display[1];}
else if(["date"].indexOf(field_type)>-1){return Array.isArray(value_to_display)?value_to_display.slice(1).join(' '):value_to_display;}
else{return value_to_display;}},_render:function(){var self=this;var vnode;if(!this._hasContent()&&!!this.noContentHelp){vnode=this._renderNoContentHelper();}else if(_.isArray(this.state)){if(!(_.isEmpty(this.state)||_.reduce(this.state,function(m,it){return _.isEqual(m.cols,it.cols)&&m;}))){throw new Error(_t("The sectioned grid view can't handle groups with different columns sets"));}
vnode=this._renderGroupedGrid();}else{vnode=this._renderUngroupedGrid();}
this._state=patch(this._state,vnode);setTimeout(function(){var rowHeaders=self.el.querySelectorAll('tbody th:first-child div');for(var k=0;k<rowHeaders.length;k++){var header=rowHeaders[k];if(header.scrollWidth>header.clientWidth){$(header).addClass('overflow');}}},0);return Promise.resolve();},_renderCell:function(cell,path){var is_readonly=this._isCellReadonly(cell);var classmap={o_grid_cell_container:true,o_grid_cell_empty:!cell.size,o_grid_cell_readonly:is_readonly,};_.each(cell.classes,function(cls){if(!(cls in classmap)){classmap[cls]=true;}});return h('td',{class:{o_grid_current:cell.is_current}},[this._renderCellContent(cell.value,is_readonly,classmap,path)]);},_renderCellContent:function(cell_value,isReadonly,classmap,path){return h('div',{class:classmap,attrs:{'data-path':path}},[h('i.fa.fa-search-plus.o_grid_cell_information',{attrs:{title:_t("See all the records aggregated in this cell")}},[]),this._renderCellInner(cell_value,isReadonly,path)]);},_renderCellInner:function(cellValue,isReadonly,path){var formattedValue=this._format(cellValue);if(this.CellWidgetInstance){return this._renderCellInnerWidget(cellValue,isReadonly,path)}else if(isReadonly){return h('div.o_grid_show',formattedValue);}else{return h('div.o_grid_input',{attrs:{contentEditable:"true"}},formattedValue);}
return'';},_renderCellInnerWidget:function(cellValue,isReadonly,path){var widget_instance=this.CellWidgetInstance;var render_method=widget_instance.render(isReadonly,path);return render_method.call(this,cellValue);},_renderEmptyWarning:function(empty){if(!empty||!this.noContentHelper||!this.noContentHelper.children.length||!this.canCreate){return[];}
return h('div.o_grid_nocontent_container',[h('div.o_view_nocontent oe_edit_only',_.map(this.noContentHelper.children,this._convertToVNode.bind(this)))]);},_renderGridColumnTotalCell:function(node,value){if(this.state.range==='day'){return[];}
return[h(node,value)];},_renderNoContentHelper:function(){return h('div.o_view_nocontent',[h('div.o_nocontent_help',{props:{innerHTML:this.noContentHelp}})]);},_renderGridRows:function(grid,groupFields,path,rows,totals){var self=this;return _.map(grid,function(row,rowIndex){var rowValues=[];var rowKeys=[];for(var i=0;i<groupFields.length;i++){var row_field=groupFields[i];var value=rows[rowIndex].values[row_field];var fieldName=row_field.split(':')[0];var field_type=self.fields[fieldName].type;if(field_type==='selection'){value=self.fields[fieldName].selection.find(function(choice){return choice[0]===value;});}
let key=['selection','many2one'].includes(field_type)?value[0]:value;rowKeys.push(key);rowValues.push(self._field2label(value,field_type));}
var rowKey=rowKeys.join('|');return h('tr',{key:rowKey},[h('th',{},[h('div',_.map(rowValues,function(label){var klass=label!==_t('Unknown')?'':'o_grid_text_muted';return h('div',{attrs:{title:label,class:klass}},label);}))])].concat(_.map(row,function(cell,cell_index){return self._renderCell(cell,path.concat([rowIndex,cell_index]).join('.'));}),self._renderGridColumnTotalCell('td.o_grid_total',self._format(totals[rowIndex]))));});},_renderGroupedGrid:function(){var self=this;var columns=this.state.length?this.state[0].cols:[];var superTotals=this._computeTotals(_.flatten(_.pluck(this.state,'grid'),true));var vnode=this._renderTable(columns,superTotals.columns,superTotals.super);var gridBody=vnode.children[0].children;for(var n=0;n<this.state.length;n++){var grid=this.state[n];var totals=this._computeTotals(grid.grid);var rows=this._renderGridRows(grid.grid||[],this.state.groupBy.slice(1),[n,'grid'],grid.rows||[],totals.rows);gridBody.push(h('tbody',{class:{o_grid_section:true}},[h('tr',[h('th',{},[(grid.__label||[])[1]||_t('Unknown')])].concat(_(columns).map(function(column,column_index){return h('td',{class:{o_grid_current:column.is_current,}},self._format(totals.columns[column_index]));}),self._renderGridColumnTotalCell('td.o_grid_total',self._format(totals.super))))].concat(rows)));}
return vnode;},_renderTable:function(columns,totals,super_total,empty){var self=this;var col_field=this.state.colField;var total_label;if(this.measureLabel){total_label=_.str.sprintf(_t("Total (%s)"),this.measureLabel);}else{total_label=_t("Total");}
return h('div.o_view_grid.table-responsive',[h('table.table.table-sm.table-striped',[h('thead',[h('tr',[h('th.o_grid_title_header'),].concat(_.map(columns,function(column){return h('th',{class:{o_grid_current:column.is_current}},column.values[col_field][1]);}),self._renderGridColumnTotalCell('th.o_grid_total',total_label)))]),h('tfoot',[h('tr',[h('td',totals?total_label:[])].concat(_.map(columns,function(column,column_index){var cell_content=!totals?[]:self._format(totals[column_index]);return h(totals&&totals[column_index]?'td':'td.text-muted',{class:{o_grid_current:column.is_current,}},cell_content);}),self._renderGridColumnTotalCell('td',!super_total?[]:self._format(super_total))))]),])].concat(this._renderEmptyWarning(empty)));},_renderUngroupedGrid:function(){var self=this;var vnode;var columns=this.state.cols;var rows=this.state.rows;var grid=this.state.grid;var totals=this._computeTotals(grid);vnode=this._renderTable(columns,totals.columns,totals.super,!grid.length);vnode.children[0].children.push(h('tbody',this._renderGridRows(grid,this.state.groupBy,['grid'],rows,totals.rows).concat(_.times(Math.max(5-rows.length,0),function(){return h('tr.o_grid_padding',[h('th',{},"\u00A0")].concat(_.map(columns,function(column){return h('td',{class:{o_grid_current:column.is_current}},[]);}),self._renderGridColumnTotalCell('td.o_grid_total',[])));}))));return vnode;},_onGridInputBlur:function(e){var $target=$(e.target);var value;try{value=this._parse(e.target.textContent.trim());$target.removeClass('o_has_error').find('.form-control, .custom-select').removeClass('is-invalid');}catch(_){$target.addClass('o_has_error').find('.form-control, .custom-select').addClass('is-invalid');return;}
var cell_path=$target.parent().attr('data-path').split('.');var grid_path=cell_path.slice(0,-3);var row_path=grid_path.concat(['rows'],cell_path.slice(-2,-1));var col_path=grid_path.concat(['cols'],cell_path.slice(-1));this.trigger_up('cell_edited',{cell_path:cell_path,row_path:row_path,col_path:col_path,value:value,});},_onGridInputKeydown:function(e){switch(e.which){case $.ui.keyCode.ENTER:e.preventDefault();e.stopPropagation();break;}},_onGridWidgetBlur:function(e){var path=e.data.path;var button=this.$("div[data-path='"+path+"']").find('button');var value;try{value=this._parse(button.text());}catch(_){return;}
var cell_path=path.split('.');var grid_path=cell_path.slice(0,-3);var row_path=grid_path.concat(['rows'],cell_path.slice(-2,-1));var col_path=grid_path.concat(['cols'],cell_path.slice(-1));button.prop('disabled',true);this.trigger_up('cell_edited',{cell_path:cell_path,row_path:row_path,col_path:col_path,value:value,doneCallback:function(){button.prop('disabled',false);}});},_onGridWidgetRefresh:function(e){try{var value=e.data.formattedValue;var path=e.data.path;var selector=e.data.selector||false;var $cell=this.$("div[data-path='"+path+"']")
if(selector){$cell.find(selector).text(value);}else{$cell.text(value);}}catch(_){return;}}});});;

/* /web_grid/static/src/js/grid_widget.js defined in bundle 'web.assets_backend' */
odoo.define('web_grid.widget',function(require){"use strict";var core=require('web.core');var Class=require('web.Class');var mixins=require('web.mixins');var utils=require('web.utils');var field_utils=require('web.field_utils');var h=require('snabbdom.h');var BaseGridWidget=Class.extend(mixins.EventDispatcherMixin,{init:function(parent,fieldInfo,nodeOptions){mixins.EventDispatcherMixin.init.call(this);this.setParent(parent);this.field=fieldInfo;if(!this.formatType){this.formatType=this.field.type;}
this.nodeOptions=nodeOptions||{};this.formatOptions=nodeOptions||{};this.parseOptions=nodeOptions||{};},format:function(value){return field_utils.format[this.formatType](value,{},this.formatOptions);},parse:function(value){return field_utils.parse[this.formatType](value,{},this.parseOptions);},render:function(isReadonly,path){var self=this;return function(value){if(isReadonly){return self._renderReadonly(self.format(value),path);}else{return self._renderEdit(self.format(value),path);}}},_renderEdit:function(formattedValue,path){return h('div.o_grid_input',{attrs:{contentEditable:"true"}},formattedValue);},_renderReadonly:function(formattedValue,path){return h('div.o_grid_show',formattedValue);},});var FloatFactorWidget=BaseGridWidget.extend({formatType:'float_factor',});var FloatTimeWidget=BaseGridWidget.extend({formatType:'float_time',});var FloatToggleWidget=BaseGridWidget.extend({formatType:'float_factor',init:function(gridRenderer,fieldInfo,nodeOptions){this._super.apply(this,arguments);if(!nodeOptions.factor){this.nodeOptions.factor=1;this.formatOptions.factor=1;this.parseOptions.factor=1;}
var range=[0.0,0.5,1.0];if(this.nodeOptions.range){range=this.nodeOptions.range;}
this.range=range;},_renderEdit:function(formattedValue,path){var self=this;var range=this.range;var current=formattedValue;function onClick(){var currentFloat=field_utils.parse['float'](current);var closest=utils.closestNumber(currentFloat,range);var closest_index=_.indexOf(range,closest);var next_index=closest_index+1<range.length?closest_index+1:0;current=range[next_index];current=field_utils.format['float'](current,{},self.formatOptions);self.trigger_up('grid_cell_refresh',{selector:'button',formattedValue:current.toString(),path:path,});}
function triggerSaveChange(){        self.trigger_up('grid_cell_edited',{path:path,});}
var classes='.o_grid_float_toggle.btn.btn-default.btn-block';return h('button'+classes,{on:{'click':onClick,'blur':triggerSaveChange,},attrs:{'type':'button','data-value':parseFloat(formattedValue),}},formattedValue);},_renderReadonly:function(formattedValue,path){var classes='.o_grid_float_toggle.btn.btn-default.btn-block.disabled';return h('button'+classes,{attrs:{'type':'button','data-value':parseFloat(formattedValue),}},formattedValue);},});return{FloatFactorWidget:FloatFactorWidget,FloatTimeWidget:FloatTimeWidget,FloatToggleWidget:FloatToggleWidget,};});;

/* /web_grid/static/src/js/grid_widget_registry.js defined in bundle 'web.assets_backend' */
odoo.define('web_grid.widget_registry',function(require){"use strict";var Registry=require('web.Registry');return new Registry();});odoo.define('web_grid._widget_registry',function(require){"use strict";var grid_widget=require('web_grid.widget');var registry=require('web_grid.widget_registry');registry.add('float_factor',grid_widget.FloatFactorWidget).add('float_time',grid_widget.FloatTimeWidget).add('float_toggle',grid_widget.FloatToggleWidget)});;

/* /web_kanban_gauge/static/src/js/kanban_gauge.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban_gauge.widget',function(require){"use strict";var AbstractField=require('web.AbstractField');var core=require('web.core');var field_registry=require('web.field_registry');var utils=require('web.utils');var _t=core._t;var GaugeWidget=AbstractField.extend({className:"oe_gauge",jsLibs:['/web/static/lib/Chart/Chart.js',],_render:function(){var val=this.value;if(_.isArray(JSON.parse(val))){val=JSON.parse(val);}
var gauge_value=_.isArray(val)&&val.length?val[val.length-1].value:val;if(this.nodeOptions.gauge_value_field){gauge_value=this.recordData[this.nodeOptions.gauge_value_field];}
var max_value=this.nodeOptions.max_value||100;if(this.nodeOptions.max_field){max_value=this.recordData[this.nodeOptions.max_field];}
max_value=Math.max(gauge_value,max_value);var label=this.nodeOptions.label||"";if(this.nodeOptions.label_field){label=this.recordData[this.nodeOptions.label_field];}
var title=this.nodeOptions.title||this.field.string;var maxLabel=max_value;if(gauge_value===0&&max_value===0){max_value=1;maxLabel=0;}
var config={type:'doughnut',data:{datasets:[{data:[gauge_value,max_value-gauge_value],backgroundColor:["#1f77b4","#dddddd"],label:title}],},options:{circumference:Math.PI,rotation:-Math.PI,responsive:true,tooltips:{displayColors:false,callbacks:{label:function(tooltipItems){if(tooltipItems.index===0){return _t('Value: ')+gauge_value;}
return _t('Max: ')+maxLabel;},},},title:{display:true,text:title,padding:4,},layout:{padding:{bottom:5}},maintainAspectRatio:false,cutoutPercentage:70,}};this.$canvas=$('<canvas/>');this.$el.empty();this.$el.append(this.$canvas);this.$el.attr('style',this.nodeOptions.style);this.$el.css({position:'relative'});var context=this.$canvas[0].getContext('2d');this.chart=new Chart(context,config);var humanValue=utils.human_number(gauge_value,1);var $value=$('<span class="o_gauge_value">').text(humanValue);$value.css({'text-align':'center',position:'absolute',left:0,right:0,bottom:'6px','font-weight':'bold'});this.$el.append($value);},});field_registry.add("gauge",GaugeWidget);return GaugeWidget;});;

/* /web_tour/static/src/js/debug_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web_tour.DebugManager.Backend',function(require){"use strict";var core=require("web.core");var DebugManager=require('web.DebugManager.Backend');var Dialog=require("web.Dialog");var tour=require('web_tour.tour');function get_active_tours(){return _.difference(_.keys(tour.tours),tour.consumed_tours);}
DebugManager.include({start:function(){this.consume_tours_enabled=get_active_tours().length>0;return this._super.apply(this,arguments);},consume_tours:function(){var active_tours=get_active_tours();if(active_tours.length>0){this._rpc({model:'web_tour.tour',method:'consume',args:[active_tours],}).then(function(){window.location.reload();});}},start_tour:function(){var dialog=new Dialog(this,{title:'Tours',$content:core.qweb.render('WebClient.DebugManager.ToursDialog',{tours:tour.tours}),});dialog.opened().then(function(){dialog.$('.o_start_tour').on('click',function(e){e.preventDefault();tour.run($(e.target).data('name'));});});dialog.open();},});});;

/* /base_setup/static/src/js/res_config_dev_tool.js defined in bundle 'web.assets_backend' */
odoo.define('base_setup.ResConfigDevTool',function(require){"use strict";var config=require('web.config');var Widget=require('web.Widget');var widget_registry=require('web.widget_registry');var ResConfigDevTool=Widget.extend({template:'res_config_dev_tool',events:{'click .o_web_settings_force_demo':'_onClickForceDemo',},init:function(){this._super.apply(this,arguments);this.isDebug=config.isDebug();this.isAssets=config.isDebug("assets");this.isTests=config.isDebug("tests");},willStart:function(){var self=this;return this._super.apply(this,arguments).then(function(){return self._rpc({route:'/base_setup/demo_active',}).then(function(demo_active){self.demo_active=demo_active;});});},_onClickForceDemo:function(ev){ev.preventDefault();this.do_action('base.demo_force_install_action');},});widget_registry.add('res_config_dev_tool',ResConfigDevTool);});;

/* /base_setup/static/src/js/res_config_edition.js defined in bundle 'web.assets_backend' */
odoo.define('base_setup.ResConfigEdition',function(require){"use strict";var Widget=require('web.Widget');var widget_registry=require('web.widget_registry');var session=require('web.session');var ResConfigEdition=Widget.extend({template:'res_config_edition',init:function(){this._super.apply(this,arguments);this.server_version=session.server_version;this.expiration_date=session.expiration_date?moment(session.expiration_date):moment().add(30,'d');},});widget_registry.add('res_config_edition',ResConfigEdition);return ResConfigEdition;});;

/* /base_setup/static/src/js/res_config_invite_users.js defined in bundle 'web.assets_backend' */
odoo.define('base_setup.ResConfigInviteUsers',function(require){"use strict";var Widget=require('web.Widget');var widget_registry=require('web.widget_registry');var core=require('web.core');var _t=core._t;var ResConfigInviteUsers=Widget.extend({template:'res_config_invite_users',events:{'click .o_web_settings_invite':'_onClickInvite','click .o_web_settings_user':'_onClickUser','click .o_web_settings_more':'_onClickMore','keydown .o_user_emails':'_onKeydownUserEmails',},init:function(){this._super.apply(this,arguments);this.emails=[];},willStart:function(){var self=this;return this._super.apply(this,arguments).then(function(){return self.load();});},load:function(){var self=this;return this._rpc({route:'/base_setup/data',}).then(function(data){self.active_users=data.active_users;self.pending_users=data.pending_users;self.pending_count=data.pending_count;self.resend_invitation=data.resend_invitation||false;});},_validateEmail:function(email){var re=/^([a-z0-9][-a-z0-9_\+\.]*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,63}(?:\.[a-z]{2})?)$/i;return re.test(email);},_invite:function(){var self=this;var $userEmails=this.$('.o_user_emails');$userEmails.prop('disabled',true);this.$('.o_web_settings_invite').prop('disabled',true);var value=$userEmails.val().trim();if(value){var emails=_.uniq(value.split(/[ ,;\n]+/));var invalidEmails=_.reject(emails,this._validateEmail);if(invalidEmails.length){this.do_warn(_.str.sprintf(_t('The following email addresses are invalid: %s.'),invalidEmails.join(', ')));}
emails=_.difference(emails,invalidEmails);if(!this.resend_invitation){var pendingEmails=_.map(this.pending_users,function(info){return info[1];});var existingEmails=_.intersection(emails,this.emails.concat(pendingEmails));if(existingEmails.length){this.do_warn(_.str.sprintf(_t('The following email addresses already exist: %s.'),existingEmails.join(', ')));}
emails=_.difference(emails,existingEmails);}
if(emails.length){$userEmails.val('');this._rpc({model:'res.users',method:'web_create_users',args:[emails],}).then(function(){return self.load().then(function(){self.renderElement();self.$('.o_user_emails').focus();});});}else{$userEmails.prop('disabled',false);this.$('.o_web_settings_invite').prop('disabled',false);self.$('.o_user_emails').focus();}}},_onClickInvite:function(ev){if(this.$('.o_user_emails').val().length){var $button=$(ev.target);$button.button('loading');return this._invite();}},_onClickMore:function(ev){var self=this;ev.preventDefault();this._rpc({model:'ir.model.data',method:'xmlid_to_res_model_res_id',args:["base.view_users_form"],}).then(function(data){self.do_action({name:_t('Users'),type:'ir.actions.act_window',view_mode:'tree,form',res_model:'res.users',domain:[['log_ids','=',false]],context:{search_default_no_share:true,},views:[[false,'list'],[data[1],'form']],});});},_onClickUser:function(ev){var self=this;ev.preventDefault();var user_id=$(ev.currentTarget).data('user-id');this._rpc({model:'ir.model.data',method:'xmlid_to_res_model_res_id',args:["base.view_users_form"],}).then(function(data){self.do_action({type:'ir.actions.act_window',res_model:'res.users',view_mode:'form',res_id:user_id,views:[[data[1],'form']],});});},_onKeydownUserEmails:function(ev){var keyCodes=[$.ui.keyCode.TAB,$.ui.keyCode.COMMA,$.ui.keyCode.ENTER];if(_.contains(keyCodes,ev.which)){ev.preventDefault();this._invite();}},});widget_registry.add('res_config_invite_users',ResConfigInviteUsers);});;

/* /bus/static/src/js/longpolling_bus.js defined in bundle 'web.assets_backend' */
odoo.define('bus.Longpolling',function(require){"use strict";var Bus=require('web.Bus');var ServicesMixin=require('web.ServicesMixin');var LongpollingBus=Bus.extend(ServicesMixin,{PARTNERS_PRESENCE_CHECK_PERIOD:30000,ERROR_RETRY_DELAY:10000,POLL_ROUTE:'/longpolling/poll',_isActive:null,_lastNotificationID:0,_isOdooFocused:true,_pollRetryTimeout:null,init:function(parent,params){this._super.apply(this,arguments);this._id=_.uniqueId('bus');this._longPollingBusId=this._id;this._options={};this._channels=[];this._lastPresenceTime=new Date().getTime();$(window).on("focus."+this._longPollingBusId,this._onFocusChange.bind(this,{focus:true}));$(window).on("blur."+this._longPollingBusId,this._onFocusChange.bind(this,{focus:false}));$(window).on("unload."+this._longPollingBusId,this._onFocusChange.bind(this,{focus:false}));$(window).on("click."+this._longPollingBusId,this._onPresence.bind(this));$(window).on("keydown."+this._longPollingBusId,this._onPresence.bind(this));$(window).on("keyup."+this._longPollingBusId,this._onPresence.bind(this));},destroy:function(){this.stopPolling();$(window).off("focus."+this._longPollingBusId);$(window).off("blur."+this._longPollingBusId);$(window).off("unload."+this._longPollingBusId);$(window).off("click."+this._longPollingBusId);$(window).off("keydown."+this._longPollingBusId);$(window).off("keyup."+this._longPollingBusId);this._super();},addChannel:function(channel){if(this._channels.indexOf(channel)===-1){this._channels.push(channel);if(this._pollRpc){this._pollRpc.abort();}else{this.startPolling();}}},deleteChannel:function(channel){var index=this._channels.indexOf(channel);if(index!==-1){this._channels.splice(index,1);if(this._pollRpc){this._pollRpc.abort();}}},isOdooFocused:function(){return this._isOdooFocused;},startPolling:function(){if(this._isActive===null){this._poll=this._poll.bind(this);}
if(!this._isActive){this._isActive=true;this._poll();}},stopPolling:function(){this._isActive=false;this._channels=[];clearTimeout(this._pollRetryTimeout);if(this._pollRpc){this._pollRpc.abort();}},updateOption:function(key,value){this._options[key]=value;},_getLastPresence:function(){return this._lastPresenceTime;},_poll:function(){var self=this;if(!this._isActive){return;}
var now=new Date().getTime();var options=_.extend({},this._options,{bus_inactivity:now-this._getLastPresence(),});var data={channels:this._channels,last:this._lastNotificationID,options:options};this._pollRpc=this._makePoll(data);this._pollRpc.then(function(result){self._pollRpc=false;self._onPoll(result);self._poll();}).guardedCatch(function(result){self._pollRpc=false;result.event.preventDefault();if(result.message==="XmlHttpRequestError abort"){self._poll();}else{self._pollRetryTimeout=setTimeout(self._poll,self.ERROR_RETRY_DELAY+(Math.floor((Math.random()*20)+1)*1000));}});},_makePoll:function(data){return this._rpc({route:this.POLL_ROUTE,params:data},{shadow:true,timeout:60000});},_onFocusChange:function(params){this._isOdooFocused=params.focus;if(params.focus){this._lastPresenceTime=new Date().getTime();this.trigger('window_focus',this._isOdooFocused);}},_onPoll:function(notifications){var self=this;var notifs=_.map(notifications,function(notif){if(notif.id>self._lastNotificationID){self._lastNotificationID=notif.id;}
return[notif.channel,notif.message];});this.trigger("notification",notifs);return notifs;},_onPresence:function(){this._lastPresenceTime=new Date().getTime();},});return LongpollingBus;});;

/* /bus/static/src/js/crosstab_bus.js defined in bundle 'web.assets_backend' */
odoo.define('bus.CrossTab',function(require){"use strict";var Longpolling=require('bus.Longpolling');var session=require('web.session');var CrossTabBus=Longpolling.extend({TAB_HEARTBEAT_PERIOD:10000,MASTER_TAB_HEARTBEAT_PERIOD:1500,HEARTBEAT_OUT_OF_DATE_PERIOD:5000,HEARTBEAT_KILL_OLD_PERIOD:15000,LOCAL_STORAGE_PREFIX:'bus',_isMasterTab:false,_isRegistered:false,init:function(){this._super.apply(this,arguments);var now=new Date().getTime();this._sanitizedOrigin=session.origin.replace(/:\/{0,2}/g,'_');this._id=_.uniqueId(this.LOCAL_STORAGE_PREFIX)+':'+now;if(this._callLocalStorage('getItem','last_ts',0)+50000<now){this._callLocalStorage('removeItem','last');}
this._lastNotificationID=this._callLocalStorage('getItem','last',0);this.call('local_storage','onStorage',this,this._onStorage);},destroy:function(){this._super();clearTimeout(this._heartbeatTimeout);},addChannel:function(){this._super.apply(this,arguments);this._callLocalStorage('setItem','channels',this._channels);},deleteChannel:function(){this._super.apply(this,arguments);this._callLocalStorage('setItem','channels',this._channels);},getTabId:function(){return this._id;},isMasterTab:function(){return this._isMasterTab;},startPolling:function(){if(this._isActive===null){this._heartbeat=this._heartbeat.bind(this);}
if(!this._isRegistered){this._isRegistered=true;var peers=this._callLocalStorage('getItem','peers',{});peers[this._id]=new Date().getTime();this._callLocalStorage('setItem','peers',peers);this._registerWindowUnload();if(!this._callLocalStorage('getItem','master')){this._startElection();}
this._heartbeat();if(this._isMasterTab){this._callLocalStorage('setItem','channels',this._channels);this._callLocalStorage('setItem','options',this._options);}else{this._channels=this._callLocalStorage('getItem','channels',this._channels);this._options=this._callLocalStorage('getItem','options',this._options);}
return;}
if(this._isMasterTab){this._super.apply(this,arguments);}},updateOption:function(){this._super.apply(this,arguments);this._callLocalStorage('setItem','options',this._options);},_callLocalStorage:function(method,key,param){return this.call('local_storage',method,this._generateKey(key),param);},_generateKey:function(key){return this.LOCAL_STORAGE_PREFIX+'.'+this._sanitizedOrigin+'.'+key;},_getLastPresence:function(){return this._callLocalStorage('getItem','lastPresence')||this._super();},_heartbeat:function(){var now=new Date().getTime();var heartbeatValue=parseInt(this._callLocalStorage('getItem','heartbeat',0));var peers=this._callLocalStorage('getItem','peers',{});if((heartbeatValue+this.HEARTBEAT_OUT_OF_DATE_PERIOD)<now){this._startElection();heartbeatValue=parseInt(this._callLocalStorage('getItem','heartbeat',0));}
if(this._isMasterTab){var cleanedPeers={};for(var peerName in peers){if(peers[peerName]+this.HEARTBEAT_KILL_OLD_PERIOD>now){cleanedPeers[peerName]=peers[peerName];}}
if(heartbeatValue!==this.lastHeartbeat){this._isMasterTab=false;this.lastHeartbeat=0;peers[this._id]=now;this._callLocalStorage('setItem','peers',peers);this.stopPolling();this.trigger('no_longer_master');}else{this.lastHeartbeat=now;this._callLocalStorage('setItem','heartbeat',now);this._callLocalStorage('setItem','peers',cleanedPeers);}}else{peers[this._id]=now;this._callLocalStorage('setItem','peers',peers);}
var hbPeriod=this._isMasterTab?this.MASTER_TAB_HEARTBEAT_PERIOD:this.TAB_HEARTBEAT_PERIOD;if(this._lastPresenceTime+hbPeriod>now){this._callLocalStorage('setItem','lastPresence',this._lastPresenceTime);}
this._heartbeatTimeout=setTimeout(this._heartbeat.bind(this),hbPeriod);},_registerWindowUnload:function(){$(window).on('unload.'+this._id,this._onUnload.bind(this));},_startElection:function(){if(this._isMasterTab){return;}
var now=new Date().getTime();var peers=this._callLocalStorage('getItem','peers',{});var heartbeatKillOld=now-this.HEARTBEAT_KILL_OLD_PERIOD;var newMaster;for(var peerName in peers){if(peers[peerName]<heartbeatKillOld){continue;}
newMaster=peerName;break;}
if(newMaster===this._id){this.lastHeartbeat=now;this._callLocalStorage('setItem','heartbeat',this.lastHeartbeat);this._callLocalStorage('setItem','master',true);this._isMasterTab=true;this.startPolling();this.trigger('become_master');delete peers[newMaster];this._callLocalStorage('setItem','peers',peers);}},_onFocusChange:function(params){this._super.apply(this,arguments);this._callLocalStorage('setItem','focus',params.focus);},_onPoll:function(notifications){var notifs=this._super(notifications);if(this._isMasterTab&&notifs.length){this._callLocalStorage('setItem','last',this._lastNotificationID);this._callLocalStorage('setItem','last_ts',new Date().getTime());this._callLocalStorage('setItem','notification',notifs);}},_onStorage:function(e){var value=JSON.parse(e.newValue);var key=e.key;if(this._isRegistered&&key===this._generateKey('master')&&!value){this._startElection();}
if(key===this._generateKey('last')){this._lastNotificationID=value||0;}
else if(key===this._generateKey('notification')){if(!this._isMasterTab){this.trigger("notification",value);}}
else if(key===this._generateKey('channels')){this._channels=value;}
else if(key===this._generateKey('options')){this._options=value;}
else if(key===this._generateKey('focus')){this._isOdooFocused=value;this.trigger('window_focus',this._isOdooFocused);}},_onUnload:function(){var peers=this._callLocalStorage('getItem','peers')||{};delete peers[this._id];this._callLocalStorage('setItem','peers',peers);if(this._isMasterTab){this._callLocalStorage('removeItem','master');}},});return CrossTabBus;});;

/* /bus/static/src/js/services/bus_service.js defined in bundle 'web.assets_backend' */
odoo.define('bus.BusService',function(require){"use strict";var CrossTab=require('bus.CrossTab');var core=require('web.core');var ServicesMixin=require('web.ServicesMixin');var BusService=CrossTab.extend(ServicesMixin,{dependencies:['local_storage'],_audio:null,start:function(){},sendNotification:function(title,content,callback){if(window.Notification&&Notification.permission==="granted"){if(this.isMasterTab()){try{this._sendNativeNotification(title,content,callback);}catch(error){if(error.message.indexOf('ServiceWorkerRegistration')>-1){this.do_notify(title,content);this._beep();}else{throw error;}}}}else{this.do_notify(title,content);if(this.isMasterTab()){this._beep();}}},onNotification:function(){this.on.apply(this,["notification"].concat(Array.prototype.slice.call(arguments)));},_beep:function(){if(typeof(Audio)!=="undefined"){if(!this._audio){this._audio=new Audio();var ext=this._audio.canPlayType("audio/ogg; codecs=vorbis")?".ogg":".mp3";var session=this.getSession();this._audio.src=session.url("/mail/static/src/audio/ting"+ext);}
Promise.resolve(this._audio.play()).catch(_.noop);}},_sendNativeNotification:function(title,content,callback){var notification=new Notification(title,{body:content,icon:"/mail/static/src/img/odoobot_transparent.png"});notification.onclick=function(){window.focus();if(this.cancel){this.cancel();}else if(this.close){this.close();}
if(callback){callback();}};},});core.serviceRegistry.add('bus_service',BusService);return BusService;});;

/* /resource/static/src/js/section_fields_backend.js defined in bundle 'web.assets_backend' */
odoo.define('resource.section_backend',function(require){"use strict";var FieldOne2Many=require('web.relational_fields').FieldOne2Many;var fieldRegistry=require('web.field_registry');var ListRenderer=require('web.ListRenderer');var SectionListRenderer=ListRenderer.extend({_renderBodyCell:function(record,node,index,options){var $cell=this._super.apply(this,arguments);var isSection=record.data.display_type==='line_section';if(isSection){if(node.attrs.widget==="handle"){return $cell;}else if(node.attrs.name==="name"){var nbrColumns=this._getNumberOfCols();if(this.handleField){nbrColumns--;}
if(this.addTrashIcon){nbrColumns--;}
$cell.attr('colspan',nbrColumns);}else{return $cell.addClass('o_hidden');}}
return $cell;},_renderRow:function(record,index){var $row=this._super.apply(this,arguments);if(record.data.display_type){$row.addClass('o_is_'+record.data.display_type);}
return $row;},_renderView:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.$('.o_list_table').addClass('o_section_list_view');});},});var SectionFieldOne2Many=FieldOne2Many.extend({_getRenderer:function(){if(this.view.arch.tag==='tree'){return SectionListRenderer;}
return this._super.apply(this,arguments);},});fieldRegistry.add('section_one2many',SectionFieldOne2Many);});;

/* /web_dashboard/static/src/js/dashboard_view.js defined in bundle 'web.assets_backend' */
odoo.define('web_dashboard.DashboardView',function(require){"use strict";var BasicView=require('web.BasicView');var core=require('web.core');var viewRegistry=require('web.view_registry');var DashboardController=require('web_dashboard.DashboardController');var DashboardModel=require('web_dashboard.DashboardModel');var DashboardRenderer=require('web_dashboard.DashboardRenderer');var _lt=core._lt;var DashboardView=BasicView.extend({config:_.extend({},BasicView.prototype.config,{Model:DashboardModel,Controller:DashboardController,Renderer:DashboardRenderer,}),display_name:_lt('Dashboard'),searchMenuTypes:['filter','timeRange','favorite'],icon:'fa-tachometer',viewType:'dashboard',init:function(viewInfo,params){this._super.apply(this,arguments);this.modelName=params.modelName;this.controllerParams.actionDomain=(params.action&&params.action.domain)||[];this.rendererParams.subFieldsViews={};var fields=this.fieldsInfo.dashboard;var additionalMeasures=_.pluck(_.filter(fields,{realType:'many2one'}),'field');this.rendererParams.additionalMeasures=additionalMeasures;this.loadParams.aggregates=this.fieldsView.aggregates;this.loadParams.formulas=this.fieldsView.formulas;},_loadData:function(model){var self=this;var subViewsDef;if(this.fieldsView.subViews.length){subViewsDef=model.loadViews(this.modelName,this.loadParams.context,this.fieldsView.subViews).then(function(fieldsViews){for(var viewType in fieldsViews){self.rendererParams.subFieldsViews[viewType]=fieldsViews[viewType];}});}
var superDef=this._super.apply(this,arguments);return Promise.all([superDef,subViewsDef]).then(function(results){var dataPointID=results[0];return dataPointID;});},_processAggregateNode:function(node,fv){var aggregateID=node.attrs.name;var field=fv.viewFields[node.attrs.field];var aggregate=_.defaults({},node.attrs,{domain:'[]',group_operator:field.group_operator,});aggregate.Widget=this._getFieldWidgetClass('dashboard',field,aggregate);if(field.type==='many2one'){field.type='integer';field.realType='many2one';aggregate.realType='many2one';aggregate.group_operator='count_distinct';}
aggregate.type=field.type;fv.fieldsInfo.dashboard[aggregateID]=aggregate;fv.viewFields[node.attrs.name]=_.extend({},field,{name:node.attrs.name,});fv.aggregates.push(aggregateID);return false;},_processArch:function(arch,fv){fv.aggregates=[];fv.formulas={};fv.subViews=[];fv.viewFields=$.extend(true,{},fv.viewFields);this._super.apply(this,arguments);},_processFormulaNode:function(node,fv){var formulaID=node.attrs.name||_.uniqueId('formula_');node.attrs.name=formulaID;var formula=_.extend({},node.attrs,{type:'float'});var fakeField={name:formulaID,type:'float'};formula.Widget=this._getFieldWidgetClass('dashboard',fakeField,formula);fv.fieldsInfo.dashboard[formulaID]=formula;fv.viewFields[formulaID]=fakeField;fv.formulas[formulaID]=_.pick(node.attrs,'string','value');return false;},_processNode:function(node,fv){var res=this._super.apply(this,arguments);if(node.tag==='aggregate'){res=this._processAggregateNode(node,fv);}
if(node.tag==='formula'){res=this._processFormulaNode(node,fv);}
if(node.tag==='view'){fv.subViews.push([node.attrs.ref,node.attrs.type]);res=false;}
return res;},_updateMVCParams:function(){var self=this;this._super.apply(this,arguments);_.each(this.fieldsView.subViews,function(subView){if(subView[0]){self.loadParams.context[subView[1]+'_view_ref']=subView[0];}});this.fieldsView.subViews=_.map(this.fieldsView.subViews,function(subView){return[false,subView[1]];});}});viewRegistry.add('dashboard',DashboardView);return DashboardView;});;

/* /web_dashboard/static/src/js/dashboard_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web_dashboard.DashboardRenderer',function(require){"use strict";var config=require('web.config');var core=require('web.core');var dataComparisonUtils=require('web.dataComparisonUtils');var Domain=require('web.Domain');var fieldUtils=require('web.field_utils');var FormRenderer=require('web.FormRenderer');var pyUtils=require('web.py_utils');var viewRegistry=require('web.view_registry');var renderComparison=dataComparisonUtils.renderComparison;var renderVariation=dataComparisonUtils.renderVariation;var QWeb=core.qweb;var DashboardRenderer=FormRenderer.extend({className:"o_dashboard_view",events:{'click .o_aggregate.o_clickable':'_onAggregateClicked',},OUTER_GROUP_COL:6,init:function(parent,state,params){this._super.apply(this,arguments);this.mode='readonly';this.subFieldsViews=params.subFieldsViews;this.additionalMeasures=params.additionalMeasures;this.subControllers={};this.subControllersContext=_.pick(state.context||{},'pivot','graph','cohort');this.subcontrollersNextMeasures={pivot:{},graph:{},cohort:{}};var session=this.getSession();var currency_id=session.company_currency_id;if(session.companies_currency_id&&session.user_context.allowed_company_ids){currency_id=session.companies_currency_id[session.user_context.allowed_company_ids[0]];}
this.formatOptions={currency_id:currency_id,humanReadable:function(value){return Math.abs(value)>=1000;},minDigits:1,decimals:2,formatterCallback:function(str){return str;}};},on_attach_callback:function(){this._super.apply(this,arguments);this.isInDOM=true;_.invoke(this.subControllers,'on_attach_callback');_.invoke(this.widgets,'on_attach_callback');},on_detach_callback:function(){this._super.apply(this,arguments);this.isInDOM=false;},getsubControllersContext:function(){return _.mapObject(this.subControllers,function(controller){return controller.getOwnedQueryParams().context;});},updateState:function(state,params){var viewType;for(viewType in this.subControllers){this.subControllersContext[viewType]=this.subControllers[viewType].getOwnedQueryParams().context;}
var subControllersContext=_.pick(params.context||{},'pivot','graph','cohort');_.extend(this.subControllersContext,subControllersContext);for(viewType in this.subControllers){_.extend(this.subControllersContext[viewType],this.subcontrollersNextMeasures[viewType]);this.subcontrollersNextMeasures[viewType]={};}
return this._super.apply(this,arguments);},_addStatisticTooltip:function($el,node){$el.tooltip({delay:{show:1000,hide:0},title:function(){return QWeb.render('web_dashboard.StatisticTooltip',{debug:config.isDebug(),node:node,});}});},_renderLabel:function(node){var text=node.attrs.name;if('string'in node.attrs){text=node.attrs.string;}
var $result=$('<label>',{text:text});return $result;},_renderStatistic:function(node){var self=this;var $label=this._renderLabel(node);var $el=$('<div>').attr('name',node.attrs.name).append($label);var $value;var statisticName=node.attrs.name;var variation;var formatter;var statistic=self.state.fieldsInfo.dashboard[statisticName];var valueLabel=statistic.value_label?(' '+statistic.value_label):'';if(!node.attrs.widget||(node.attrs.widget in fieldUtils.format)){var fieldValue=self.state.data[statisticName];fieldValue=_.contains(['date','datetime'],statistic.type)?(fieldValue===0?NaN:moment(fieldValue)):fieldValue;var formatType=node.attrs.widget||statistic.type;formatter=fieldUtils.format[formatType];if(this.state.compare){var comparisonValue=this.state.comparisonData[statisticName];comparisonValue=_.contains(['date','datetime'],statistic.type)?(comparisonValue===0?NaN:moment(comparisonValue)):comparisonValue;variation=this.state.variationData[statisticName];renderComparison($el,fieldValue,comparisonValue,variation,formatter,statistic,this.formatOptions);$('.o_comparison',$el).append(valueLabel);}else{fieldValue=isNaN(fieldValue)?'-':formatter(fieldValue,statistic,this.formatOptions);$value=$('<div>',{class:'o_value'}).html(fieldValue+valueLabel);$el.append($value);}}else{if(this.state.compare){var $originalValue=this._renderFieldWidget(node,this.state);var fakeState=_.clone(this.state);fakeState.data=fakeState.comparisonData;var $comparisonValue=this._renderFieldWidget(node,fakeState);variation=this.state.variationData[statisticName];fakeState.data[statisticName]=variation;$el.append(renderVariation(variation,statistic)).append($('<div>',{class:'o_comparison'}).append($originalValue,$('<span>').html(" vs "),$comparisonValue));}else{$value=this._renderFieldWidget(node,this.state).addClass('o_value');$el.append($value);}}
if(variation){if(variation>0){$el.addClass('border-success');}else if(variation<0){$el.addClass('border-danger');}}
this._registerModifiers(node,this.state,$el);if(config.isDebug()||node.attrs.help){this._addStatisticTooltip($el,node);}
return $el;},_renderSubViewButtons:function($el,controller){var $buttons=$('<div>',{class:'o_'+controller.viewType+'_buttons o_dashboard_subview_buttons'});controller.renderButtons($buttons);var $buttonGroup=$('<div class="btn-group">');$buttonGroup.append($buttons.find('[aria-label="Main actions"]'));$buttonGroup.append($buttons.find('.o_dropdown:has(.o_group_by_menu)'));$buttonGroup.prependTo($buttons);$('<button>').addClass("btn btn-outline-secondary fa fa-arrows-alt float-right o_button_switch").attr({title:'Full Screen View',viewType:controller.viewType}).tooltip().on('click',this._onViewSwitcherClicked.bind(this)).appendTo($buttons);$buttons.find('.btn-primary,.btn-secondary').removeClass('btn-primary btn-secondary o_dropdown_toggler_btn').addClass("btn-outline-secondary");$buttons.find('[class*=interval_button]').addClass('text-muted text-capitalize');$buttons.find('.fa.fa-bars').removeClass('fa fa-bars');$buttons.prependTo($el);},_renderTagAggregate:function(node){var $aggregate=this._renderStatistic(node).addClass('o_aggregate');var isClickable=node.attrs.clickable===undefined||pyUtils.py_eval(node.attrs.clickable);$aggregate.toggleClass('o_clickable',isClickable);var $result=$('<div>').addClass('o_aggregate_col').append($aggregate);this._registerModifiers(node,this.state,$result);return $result;},_renderTagFormula:function(node){return this._renderStatistic(node).addClass('o_formula');},_renderTagGroup:function(node){var $group=this._renderOuterGroup(node);if(node.children.length&&node.children[0].tag==='widget'){$group.addClass('o_has_widget');}
return $group;},_renderTagView:function(node){var self=this;var viewType=node.attrs.type;var controllerContext=this.subControllersContext[viewType];var searchQuery={context:_.extend({},this.state.context,controllerContext),domain:this.state.domain,groupBy:[],};var subViewParams={modelName:this.state.model,withControlPanel:false,hasSwitchButton:true,isEmbedded:true,additionalMeasures:this.additionalMeasures,searchQuery:searchQuery,};var SubView=viewRegistry.get(viewType);var subView=new SubView(this.subFieldsViews[viewType],subViewParams);var $div=$('<div>',{class:'o_subview',type:viewType});var def=subView.getController(this).then(function(controller){return controller.appendTo($div).then(function(){self._renderSubViewButtons($div,controller);self.subControllers[viewType]=controller;});});this.defs.push(def);return $div;},_renderView:function(){var self=this;var oldControllers=_.values(this.subControllers);var r=this._super.apply(this,arguments);return r.then(function(){_.invoke(oldControllers,'destroy');if(self.isInDOM){_.invoke(self.subControllers,'on_attach_callback');_.invoke(self.widgets,'on_attach_callback');}});},_updateView:function($newContent){this.$el.html($newContent);},_onAggregateClicked:function(ev){var aggregate=ev.currentTarget.getAttribute('name');var aggregateInfo=this.state.fieldsInfo.dashboard[aggregate];var measure=aggregateInfo.measure!==undefined?aggregateInfo.measure:aggregateInfo.field;if(this.subControllers.pivot){this.subcontrollersNextMeasures.pivot.pivot_measures=[measure];}
if(this.subControllers.graph){this.subcontrollersNextMeasures.graph.graph_measure=measure;}
if(this.subControllers.cohort){this.subcontrollersNextMeasures.cohort.cohort_measure=measure;}
var domain=new Domain(aggregateInfo.domain);var label=aggregateInfo.domain_label||aggregateInfo.string||aggregateInfo.name;this.trigger_up('reload',{domain:domain.toArray(),domainLabel:label,});},_onViewSwitcherClicked:function(ev){ev.stopPropagation();var viewType=$(ev.currentTarget).attr('viewType');var controller=this.subControllers[viewType];this.trigger_up('open_view',{context:_.extend({},this.state.context,controller.getOwnedQueryParams().context),viewType:viewType,additionalMeasures:this.additionalMeasures,});},});return DashboardRenderer;});;

/* /web_dashboard/static/src/js/dashboard_model.js defined in bundle 'web.assets_backend' */
odoo.define('web_dashboard.DashboardModel',function(require){"use strict";var BasicModel=require('web.BasicModel');var dataComparisonUtils=require('web.dataComparisonUtils');var Domain=require('web.Domain');var pyUtils=require('web.py_utils');var computeVariation=dataComparisonUtils.computeVariation;var DashboardModel=BasicModel.extend({get:function(){var record=this._super.apply(this,arguments);record.timeRange=this.dataPoint.timeRange;record.comparisonTimeRange=this.dataPoint.comparisonTimeRange;record.compare=this.dataPoint.compare;record.comparisonData=this.dataPoint.comparisonData;record.variationData=this.dataPoint.variationData;return record;},load:function(params){params.type='record';this.dataPoint=this._makeDataPoint(params);return this._load(this.dataPoint);},reload:function(id,options){options=options||{};if(options.domain!==undefined){this.dataPoint.domain=options.domain;}
if(options.context!==undefined){var timeRangeMenuData=options.context.timeRangeMenuData;if(timeRangeMenuData){this.dataPoint.timeRange=timeRangeMenuData.timeRange||[];this.dataPoint.comparisonTimeRange=timeRangeMenuData.comparisonTimeRange||[];this.dataPoint.compare=this.dataPoint.comparisonTimeRange.length>0;this.dataPoint.context.timeRangeMenuData=timeRangeMenuData;}else{this.dataPoint.timeRange=[];this.dataPoint.comparisonTimeRange=[];this.dataPoint.compare=false;this.dataPoint.context=_.omit(this.dataPoint.context,'timeRangeMenuData');}}
return this._load(this.dataPoint);},_evaluateFormulas:function(dataPoint){_.each(dataPoint.formulas,function(formula,formulaID){try{dataPoint.data[formulaID]=pyUtils.py_eval(formula.value,{record:dataPoint.data});if(!isFinite(dataPoint.data[formulaID])){dataPoint.data[formulaID]=NaN;}}catch(e){dataPoint.data[formulaID]=NaN;}
if(dataPoint.compare){try{dataPoint.comparisonData[formulaID]=pyUtils.py_eval(formula.value,{record:dataPoint.comparisonData});if(!isFinite(dataPoint.comparisonData[formulaID])){dataPoint.comparisonData[formulaID]=NaN;}}catch(e){dataPoint.comparisonData[formulaID]=NaN;}}});},_getReadGroupDomain:function(range,aggregateDomain){return Domain.prototype.normalizeArray(this.dataPoint.domain).concat(aggregateDomain).concat(Domain.prototype.normalizeArray(new Domain(range).toArray()));},_load:function(dataPoint){var self=this;var domainMapping={};var fieldsInfo=dataPoint.fieldsInfo.dashboard;_.each(dataPoint.aggregates,function(aggregateName){var domain=fieldsInfo[aggregateName].domain;if(domain in domainMapping){domainMapping[domain].push(aggregateName);}else{domainMapping[domain]=[aggregateName];}});var defs=[];_.each(domainMapping,function(aggregateNames,domain){var fields=_.map(aggregateNames,function(aggregateName){var fieldName=fieldsInfo[aggregateName].field;var groupOperator=fieldsInfo[aggregateName].group_operator;return aggregateName+':'+groupOperator+'('+fieldName+')';});defs.push(self._readGroup({domain:self._getReadGroupDomain(domain,self.dataPoint.timeRange),fields:fields,}).then(function(result){_.extend(self.dataPoint.data,_.pick(result,aggregateNames));}));if(dataPoint.compare){defs.push(self._readGroup({domain:self._getReadGroupDomain(domain,self.dataPoint.comparisonTimeRange),fields:fields,}).then(function(result){_.extend(self.dataPoint.comparisonData,_.pick(result,aggregateNames));}));}});return Promise.all(defs).then(function(){self._evaluateFormulas(dataPoint);if(dataPoint.compare){var value,comparisonValue;for(var statisticName in dataPoint.data){value=dataPoint.data[statisticName];comparisonValue=dataPoint.comparisonData[statisticName];dataPoint.variationData[statisticName]=computeVariation(value,comparisonValue);}}else{dataPoint.comparisonData={};dataPoint.variationData={};}
return dataPoint.id;});},_makeDataPoint:function(params){var dataPoint=this._super.apply(this,arguments);dataPoint.aggregates=params.aggregates;dataPoint.formulas=params.formulas;dataPoint.timeRange=params.timeRange;dataPoint.comparisonTimeRange=params.comparisonTimeRange;dataPoint.compare=params.compare;dataPoint.comparisonData={};dataPoint.variationData={};return dataPoint;},_readGroup:function(args){var readGroupArgs=_.extend({context:this.dataPoint.getContext(),groupBy:[],lazy:true,method:'read_group',model:this.dataPoint.model,orderBy:[],},args);return this._rpc(readGroupArgs).then(function(result){result=result[0];return _.mapObject(result,function(value){return value||0;});});}});return DashboardModel;});;

/* /web_dashboard/static/src/js/dashboard_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web_dashboard.DashboardController',function(require){"use strict";var AbstractController=require('web.AbstractController');var BasicController=require('web.BasicController');var core=require('web.core');var Domain=require('web.Domain');var _t=core._t;var DashboardController=AbstractController.extend({custom_events:_.extend({},BasicController.prototype.custom_events,{open_view:'_onOpenView',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.actionDomain=params.actionDomain;this.currentFilterIDs=[];},getOwnedQueryParams:function(){return{context:this.renderer.getsubControllersContext()};},_onOpenView:function(ev){ev.stopPropagation();var data=ev.data;var action={domain:this.actionDomain,context:_.omit(data.context,'timeRangeMenuData'),name:_.str.sprintf(_t('%s Analysis'),_.str.capitalize(data.viewType)),res_model:this.modelName,type:'ir.actions.act_window',views:[[false,data.viewType]],};if(!_.isEmpty(ev.data.additionalMeasures)){action.flags={additionalMeasures:ev.data.additionalMeasures};}
this.do_action(action,{controllerState:this.exportState(),});},_onReload:function(ev){ev.stopPropagation();if(!this._controlPanel){return this.do_warn(_t("Incorrect Operation"),_t("You cannot apply a filter from this view."));}
var newFilters=[];if(ev.data.domain&&ev.data.domain.length){newFilters.push({type:'filter',domain:Domain.prototype.arrayToString(ev.data.domain),description:ev.data.domainLabel});}
var filtersToRemove=this.currentFilterIDs||[];this.currentFilterIDs=this._controlPanel.updateFilters(newFilters,filtersToRemove);},});return DashboardController;});;

/* /iap/static/src/js/iap_credit.js defined in bundle 'web.assets_backend' */
odoo.define('iap.redirect_odoo_credit_widget',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var core=require('web.core');var IapOdooCreditRedirect=AbstractAction.extend({template:'iap.redirect_to_odoo_credit',events:{"click .redirect_confirm":"odoo_redirect",},init:function(parent,action){this._super(parent,action);this.url=action.params.url;},odoo_redirect:function(){window.open(this.url,'_blank');this.do_action({type:'ir.actions.act_window_close'});},});core.action_registry.add('iap_odoo_credit_redirect',IapOdooCreditRedirect);});;

/* /iap/static/src/js/crash_manager.js defined in bundle 'web.assets_backend' */
odoo.define('iap.CrashManager',function(require){"use strict";var ajax=require('web.ajax');var core=require('web.core');var CrashManager=require('web.CrashManager').CrashManager;var Dialog=require('web.Dialog');var _t=core._t;var QWeb=core.qweb;CrashManager.include({_getButtonMessage:function(isTrial){var isEnterprise=_.last(odoo.session_info.server_version_info)==='e';return isTrial&&isEnterprise?_t('Start a Trial at Odoo'):_t('Buy credits');},rpc_error:function(error){var self=this;if(error.data.name==="odoo.addons.iap.models.iap.InsufficientCreditError"){var error_data=JSON.parse(error.data.message);ajax.jsonRpc('/web/dataset/call_kw','call',{model:'iap.account',method:'get_credits_url',args:[],kwargs:{base_url:error_data.base_url,service_name:error_data.service_name,credit:error_data.credit,trial:error_data.trial}}).then(function(url){var content=$(QWeb.render('iap.redirect_to_odoo_credit',{data:error_data,}));if(error_data.body){content.css('padding',0);}
new Dialog(this,{size:'large',title:error_data.title||_t("Insufficient Balance"),$content:content,buttons:[{text:self._getButtonMessage(error_data.trial),classes:"btn-primary",click:function(){window.open(url,'_blank');},close:true,},{text:_t("Cancel"),close:true,}],}).open();});}else{this._super.apply(this,arguments);}},});});;

/* /iap/static/src/js/iap_buy_more_credits.js defined in bundle 'web.assets_backend' */
odoo.define('iap.buy_more_credits',function(require){'use strict';var widgetRegistry=require('web.widget_registry');var Widget=require('web.Widget');var core=require('web.core');var rpc=require('web.rpc');var QWeb=core.qweb;var IAPBuyMoreCreditsWidget=Widget.extend({className:'o_field_iap_buy_more_credits',init:function(parent,data,options){this._super.apply(this,arguments);this.service_name=options.attrs.service_name;},start:function(){this.$widget=$(QWeb.render('iap.buy_more_credits'));this.$buyLink=this.$widget.find('.buy_credits');this.$widget.appendTo(this.$el);this.$buyLink.click(this._getLink.bind(this));},_getLink:function(){var self=this;return rpc.query({model:'iap.account',method:'get_credits_url',args:[this.service_name],},{shadow:true,}).then(function(url){return self.do_action({type:'ir.actions.act_url',url:url,});});},});widgetRegistry.add('iap_buy_more_credits',IAPBuyMoreCreditsWidget);return IAPBuyMoreCreditsWidget;});;

/* /mail/static/src/js/many2many_tags_email.js defined in bundle 'web.assets_backend' */
odoo.define('mail.many2manytags',function(require){"use strict";var BasicModel=require('web.BasicModel');var core=require('web.core');var form_common=require('web.view_dialogs');var field_registry=require('web.field_registry');var relational_fields=require('web.relational_fields');var M2MTags=relational_fields.FieldMany2ManyTags;var _t=core._t;BasicModel.include({_setInvalidMany2ManyTagsEmail:function(record,fieldName){var self=this;var localID=(record._changes&&fieldName in record._changes)?record._changes[fieldName]:record.data[fieldName];var list=this._applyX2ManyOperations(this.localData[localID]);var invalidPartnerIds=[];_.each(list.data,function(id){var record=self.localData[id];if(!record.data.email){invalidPartnerIds.push(record);}});var def;if(invalidPartnerIds.length){var changes={operation:'DELETE',ids:_.pluck(invalidPartnerIds,'id')};def=this._applyX2ManyChange(record,fieldName,changes);}
return Promise.resolve(def).then(function(){return{invalidPartnerIds:_.pluck(invalidPartnerIds,'res_id'),};});},});var FieldMany2ManyTagsEmail=M2MTags.extend({tag_template:"FieldMany2ManyTagsEmail",fieldsToFetch:_.extend({},M2MTags.prototype.fieldsToFetch,{email:{type:'char'},}),specialData:"_setInvalidMany2ManyTagsEmail",_checkEmailPopup:function(){var self=this;var popupDefs=[];var validPartners=[];_.each(this.record.specialData[this.name].invalidPartnerIds,function(resID){var def=new Promise(function(resolve,reject){var pop=new form_common.FormViewDialog(self,{res_model:self.field.relation,res_id:resID,context:self.record.context,title:"",on_saved:function(record){if(record.data.email){validPartners.push(record.res_id);}},}).open();pop.on('closed',self,function(){resolve();});});popupDefs.push(def);});return Promise.all(popupDefs).then(function(){validPartners=_.uniq(validPartners);if(validPartners.length){var values=_.map(validPartners,function(id){return{id:id};});self._setValue({operation:'ADD_M2M',ids:values,});}});},_render:function(){var self=this;var _super=this._super.bind(this);return new Promise(function(resolve,reject){if(self.record.specialData[self.name].invalidPartnerIds.length){resolve(self._checkEmailPopup());}else{resolve();}}).then(function(){return _super.apply(self,arguments);});},});field_registry.add('many2many_tags_email',FieldMany2ManyTagsEmail);});;

/* /mail/static/src/js/services/mail_manager.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Manager',function(require){"use strict";var AbstractService=require('web.AbstractService');var DMChat=require('mail.model.DMChat');var Livechat=require('mail.model.Livechat');var Mailbox=require('mail.model.Mailbox');var MailFailure=require('mail.model.MailFailure');var Message=require('mail.model.Message');var MultiUserChannel=require('mail.model.MultiUserChannel');var mailUtils=require('mail.utils');var utils=require('web.utils');var Bus=require('web.Bus');var config=require('web.config');var core=require('web.core');var session=require('web.session');var _t=core._t;var PREVIEW_MSG_MAX_SIZE=350;var MailManager=AbstractService.extend({dependencies:['ajax','bus_service','local_storage'],_isReady:false,_ODOOBOT_ID:["ODOOBOT","ODOOBOT"],start:function(){this._super.apply(this,arguments);this._throttleNotifyChannelFetched=_.throttle(this._notifyChannelFetched.bind(this),3000);this._toNotifyChannelFetchedIDs=[];this._initializeInternalState();this._listenOnBuses();this._fetchMailStateFromServer();},addMessage:function(data,options){options=options||{};var message=this.getMessage(data.id);var prom;if(!message){prom=this._addNewMessage(data,options);}else{if(data.moderation_status==='accepted'){message.setModerationStatus('accepted',{additionalThreadIDs:data.channel_ids});}
this._addMessageToThreads(message,options);prom=Promise.resolve(message);}
return prom;},createChannel:function(name,type){if(type==='dm_chat'){return this._createDMChat(name);}else{return this._createChannel(name,type);}},getCannedResponses:function(){return this._cannedResponses;},getChannel:function(threadID){return _.find(this._threads,function(thread){return thread.isChannel()&&(thread.getID()===threadID);});},getChannels:function(){return _.filter(this._threads,function(thread){return thread.isChannel();});},getChannelPreviews:function(channels){var self=this;return this._getChannelPreviews(channels).then(function(previews){var sortedPreviews=self._sortPreviews(previews);return sortedPreviews;});},getMailBus:function(){return this._mailBus;},getDiscussMenuID:function(){return this._discussMenuID;},getDMChatFromPartnerID:function(partnerID){return _.find(this._threads,function(thread){return thread.getType()==='dm_chat'&&thread.getDirectPartnerID()===partnerID;});},getMailbox:function(mailboxID){return _.find(this._threads,function(thread){return thread.getID()==='mailbox_'+mailboxID;});},getMailFailures:function(){return this._mailFailures;},getMentionPartnerSuggestions:function(){return this._mentionPartnerSuggestions;},getMessage:function(messageID){return _.find(this._messages,function(message){return message.getID()===messageID;});},getSystrayPreviews:function(filter){var self=this;var channelDef=this._getSystrayChannelPreviews(filter);var inboxDef=this._getSystrayInboxPreviews(filter);var failureDef=this._getSystrayMailFailurePreviews(filter);return Promise.all([channelDef,inboxDef,failureDef]).then(function(result){var previewsChannel=self._sortPreviews(result[0]);var previewsInbox=self._sortPreviews(result[1]);var previewsFailure=self._sortPreviews(result[2]);return _.union(previewsFailure,previewsInbox,previewsChannel);});},getModeratedChannelIDs:function(){return this._moderatedChannelIDs||[];},getOdoobotID:function(){return this._ODOOBOT_ID;},getThread:function(threadID){return _.find(this._threads,function(thread){return thread.getID()===threadID;});},getThreads:function(){return this._threads;},isMyselfModerator:function(){return this._isMyselfModerator;},isReady:function(){return this._isReady;},joinChannel:function(channelID,options){var prom;var channel=this.getChannel(channelID);if(channel){prom=Promise.resolve(channelID);}else{prom=this._joinAndAddChannel(channelID,options);}
return prom;},markMessagesAsRead:function(messageIDs){var self=this;var ids=_.filter(messageIDs,function(id){var message=self.getMessage(id);return!message||message.isNeedaction();});if(ids.length){return this._rpc({model:'mail.message',method:'set_message_done',args:[ids],});}else{return Promise.resolve();}},notifyChannelFetched:function(data){this._toNotifyChannelFetchedIDs=_.uniq(this._toNotifyChannelFetchedIDs.concat(data.channelID));this._throttleNotifyChannelFetched();},openThread:function(threadID){this._openThreadInDiscuss(threadID);},redirect:function(resModel,resID,dmRedirectionCallback){if(resModel==='res.partner'){this._redirectPartner(resModel,resID,dmRedirectionCallback);}else{this._redirectDefault(resModel,resID);}},removeMessageFromThreads:function(message){var self=this;_.each(message.getThreadIDs(),function(threadID){var thread=self.getThread(threadID);if(thread){thread.removeMessage(message.getID());}});},searchPartner:function(searchVal,limit){var self=this;var partners=this._searchPartnerPrefetch(searchVal,limit);return new Promise(function(resolve,reject){if(!partners.length){resolve(self._searchPartnerFetch(searchVal,limit));}else{resolve(partners);}}).then(function(partners){var suggestions=_.map(partners,function(partner){return{id:partner.id,value:partner.name,label:partner.name};});return _.sortBy(suggestions,'label');});},unstarAll:function(){return this._rpc({model:'mail.message',method:'unstar_all',});},_addChannel:function(data,options){options=typeof options==='object'?options:{};var channel=this.getChannel(data.id);var proms=[];if(!channel){channel=this._makeChannel(data,options);if(channel.getType()==='dm_chat'){this._pinnedDmPartners.push(channel.getDirectPartnerID());}
this._threads.push(channel);if(data.last_message){proms.push(this.addMessage(data.last_message));}
this._sortThreads();if(!options.silent){this._mailBus.trigger('new_channel',channel,proms);}}
return Promise.all(proms).then(function(){return channel.getID();});},_addMailbox:function(data,options){options=typeof options==='object'?options:{};var mailbox=new Mailbox({parent:this,data:data,options:options,commands:this._commands});this._threads.push(mailbox);this._sortThreads();return mailbox;},_addMessageToThreads:function(message,options){var self=this;options=options||{};_.each(message.getThreadIDs(),function(threadID){var thread=self.getThread(threadID);if(thread){thread.addMessage(message,options);}});},_addNewMessage:function(data,options){var self=this;var message=this._makeMessage(data);var index=_.sortedIndex(this._messages,message,function(msg){return msg.getID();});this._messages.splice(index,0,message);return this._addNewMessagePostprocessThread(message,options).then(function(){self._addMessageToThreads(message,options);if(!options.silent){self._mailBus.trigger('new_message',message);}
return message;});},_addNewMessagePostprocessThread:function(message,options){var self=this;var proms=[];_.each(message.getThreadIDs(),function(threadID){var thread=self.getThread(threadID);if(thread){if(thread.getType()!=='mailbox'&&!message.isMyselfAuthor()&&!message.isSystemNotification()){if(thread.isTwoUserThread()&&options.showNotification){var prom=Promise.resolve();if(!self._isDiscussOpen()&&!config.device.isMobile&&!thread.isDetached()){prom=thread.detach({passively:true});}
proms.push(prom);prom.then(function(){var query={isVisible:false};self._mailBus.trigger('is_thread_bottom_visible',thread,query);if(!self.call('bus_service','isOdooFocused')||!query.isVisible){self._notifyIncomingMessage(message);}});}}}});return Promise.all(proms);},_createChannel:function(name,type){var context=_.extend({isMobile:config.device.isMobile},session.user_context);return this._rpc({model:'mail.channel',method:'channel_create',args:[name,type],kwargs:{context:context},}).then(this._addChannel.bind(this));},_createDMChat:function(name){var context=_.extend({isMobile:config.device.isMobile},session.user_context);return this._rpc({model:'mail.channel',method:'channel_get',args:[[name]],kwargs:{context:context},}).then(this._addChannel.bind(this));},_fetchChannelPreviews:function(channelIDs){return this._rpc({model:'mail.channel',method:'channel_fetch_preview',args:[channelIDs],},{shadow:true});},_fetchMailStateFromServer:function(){var self=this;session.is_bound.then(function(){var context=_.extend({isMobile:config.device.isMobile},session.user_context);return self._rpc({route:'/mail/init_messaging',params:{context:context},});}).then(function(result){self._updateInternalStateFromServer(result);self.call('bus_service','startPolling');self._isReady=true;self._mailBus.trigger('messaging_ready');});},_getChannelPreviews:function(channels){var self=this;var unpreviewedChannels=_.reject(channels,function(channel){return channel.hasBeenPreviewed();});var fetchDef;if(unpreviewedChannels.length){var ids=_.map(unpreviewedChannels,function(channel){return channel.getID();});fetchDef=this._fetchChannelPreviews(ids);}else{fetchDef=Promise.resolve();}
return fetchDef.then(function(fetchedPreviews){var proms=[];_.each(fetchedPreviews,function(fetchedPreview){if(fetchedPreview.last_message){proms.push(self.addMessage(fetchedPreview.last_message));}
var channel=self.getChannel(fetchedPreview.id);channel.markAsPreviewed();});return Promise.all(proms);}).then(function(){return _.map(channels,function(channel){return channel.getPreview();});});},_getMailFailurePreviews:function(){var items=[];_.each(this._mailFailures,function(failure){var unreadCounter=1;var isSameDocument=true;var sameModelAndTypeItem=_.find(items,function(item){if(item.failure.isLinkedToDocument()&&(item.failure.getDocumentModel()===failure.getDocumentModel())&&(item.failure.getFailureType()===failure.getFailureType())){isSameDocument=item.failure.getDocumentID()===failure.getDocumentID();return true;}
return false;});if(failure.isLinkedToDocument()&&sameModelAndTypeItem){unreadCounter=sameModelAndTypeItem.unreadCounter+1;isSameDocument=sameModelAndTypeItem.isSameDocument&&isSameDocument;var index=_.findIndex(items,sameModelAndTypeItem);items[index]={unreadCounter:unreadCounter,failure:failure,isSameDocument:isSameDocument,};}else{items.push({unreadCounter:unreadCounter,failure:failure,isSameDocument:true,});}});return _.map(items,function(item){var preview={};_.extend(preview,item.failure.getPreview(),{unreadCounter:item.unreadCounter,});if(!item.isSameDocument){preview.documentID=undefined;}
return preview;});},_getSystrayChannelPreviews:function(filter){var filteredThreads=_.filter(this._threads,function(thread){if(!thread.isChannel()){return false;}
if(filter==='chat'){return thread.isTwoUserThread();}else if(filter==='channels'){return!thread.isTwoUserThread();}
return true;});return this.getChannelPreviews(filteredThreads);},_getSystrayInboxPreviews:function(filter){if(filter==='mailbox_inbox'||!filter){var inbox=this.getMailbox('inbox');return inbox.getMessagePreviews();}else{return Promise.resolve([]);}},_getSystrayMailFailurePreviews:function(filter){if(filter==='mailbox_inbox'||!filter){return this._getMailFailurePreviews();}else{return Promise.resolve([]);}},_initializeInternalState:function(){this._cannedResponses=[];this._mailBus=new Bus(this);this._commands=[];this._discussMenuID=undefined;this._discussOpen=false;this._isMyselfModerator=false;this._mailFailures=[];this._mentionPartnerSuggestions=[];this._messages=[];this._moderatedChannelIDs=[];this._outOfFocusUnreadMessageCounter=0;this._pinnedDmPartners=[];this._threads=[];this._addMailbox({id:'inbox',name:_t("Inbox"),});this._addMailbox({id:'starred',name:_t("Starred"),});this._addMailbox({id:'history',name:_t("History"),});},_isDiscussOpen:function(){return this._discussOpen;},_joinAndAddChannel:function(channelID,options){var self=this;return this._rpc({model:'mail.channel',method:'channel_join_and_get_info',args:[[channelID]],}).then(function(result){return self._addChannel(result,options);});},_listenOnBuses:function(){this._mailBus.on('discuss_open',this,this._onDiscussOpen);this.call('bus_service','on','window_focus',this,this._onWindowFocus);},_makeChannel:function(data,options){if(_.size(data.direct_partner)>0){return new DMChat({parent:this,data:data,options:options,commands:this._commands});}
if(data.channel_type==='livechat'){return new Livechat({parent:this,data:data,options:options,commands:this._commands,});}
return new MultiUserChannel({parent:this,data:data,options:options,commands:this._commands,});},_makeMessage:function(data){return new Message(this,data);},_notifyChannelFetched:function(){var channelIDs=this._toNotifyChannelFetchedIDs;this._toNotifyChannelFetchedIDs=[];if(_.isEmpty(channelIDs)){return Promise.resolve();}
return this._rpc({model:'mail.channel',method:'channel_fetched',args:[channelIDs],},{shadow:true});},_notifyIncomingMessage:function(message){if(this.call('bus_service','isOdooFocused')){return;}
var title=_t("New message");if(message.hasAuthor()){title=_.escape(message.getAuthorName());}
var content=mailUtils.parseAndTransform(message.getBody(),mailUtils.stripHTML).substr(0,PREVIEW_MSG_MAX_SIZE);if(!this.call('bus_service','isOdooFocused')){this._outOfFocusUnreadMessageCounter++;var tabTitle=_.str.sprintf(_t("%d Messages"),this._outOfFocusUnreadMessageCounter);this.trigger_up('set_title_part',{part:'_chat',title:tabTitle});}
this.call('bus_service','sendNotification',title,content);},_openThreadInDiscuss:function(threadID){var thread=this.getThread(threadID);this._mailBus.trigger('open_thread_in_discuss',thread);},_redirectDefault:function(resModel,resID){var self=this;this._rpc({model:resModel,method:'get_formview_id',args:[[resID],session.user_context.uid],}).then(function(viewID){self._redirectToDocument(resModel,resID,viewID);});},_redirectToDocument:function(resModel,resID,viewID){this.do_action({type:'ir.actions.act_window',view_mode:'form',res_model:resModel,views:[[viewID||false,'form']],res_id:resID,});},_redirectPartner:function(resModel,resID,dmRedirection){var self=this;var domain=[['partner_id','=',resID],['share','=',false]];this._rpc({model:'res.users',method:'search',args:[domain],}).then(function(userIDs){if(userIDs.length&&userIDs[0]!==session.uid&&dmRedirection){self.createChannel(resID,'dm_chat').then(dmRedirection);}else{self._redirectToDocument(resModel,resID);}});},_removeChannel:function(channel){if(!channel){return;}
if(channel.getType()==='dm_chat'){var index=this._pinnedDmPartners.indexOf(channel.getDirectPartnerID());if(index>-1){this._pinnedDmPartners.splice(index,1);}}
this._threads=_.without(this._threads,channel);},_removeMessageFromThread:function(threadID,message){message.removeThread(threadID);var thread=_.find(this._threads,function(thread){return thread.getID()===threadID;});thread.removeMessage(message.getID());},_resetOutOfFocusUnreadMessageCounter:function(){this._outOfFocusUnreadMessageCounter=0;},_searchPartnerFetch:function(searchVal,limit){return this._rpc({model:'res.partner',method:'im_search',args:[searchVal,limit||20],},{shadow:true});},_searchPartnerPrefetch:function(searchVal,limit){var values=[];var searchRegexp=new RegExp(_.str.escapeRegExp(utils.unaccent(searchVal)),'i');_.each(this._mentionPartnerSuggestions,function(partners){if(values.length<limit){values=values.concat(_.filter(partners,function(partner){return(session.partner_id!==partner.id)&&searchRegexp.test(utils.unaccent(partner.name));})).splice(0,limit);}});return values;},_sortPreviews:function(previews){var res=previews.sort(function(p1,p2){var unreadDiff=Math.min(1,p2.unreadCounter)-Math.min(1,p1.unreadCounter);var datedDiff=!!p2.date-!!p1.date;var isTwoUserThreadDiff=p2.isTwoUserThread-p1.isTwoUserThread;var dateDiff=p2.date&&p2.date.diff(p1.date);return unreadDiff||datedDiff||isTwoUserThreadDiff||dateDiff;});return res;},_sortThreads:function(){this._threads=_.sortBy(this._threads,function(thread){var name=thread.getName();return _.isString(name)?name.toLowerCase():'';});},_updateCannedResponsesFromServer:function(data){var self=this;_.each(data.shortcodes,function(s){var cannedResponse=_.pick(s,['id','source','substitution']);self._cannedResponses.push(cannedResponse);});},_updateChannelsFromServer:function(data){var self=this;var proms=[];const options={};_.each(data.channel_slots,function(channels){_.each(channels,function(channel){proms.push(self._addChannel(channel,options));});});return Promise.all(proms);},_updateCommandsFromServer:function(data){this._commands=_.map(data.commands,function(command){return _.extend({id:command.name},command);});},_updateInternalStateFromServer:function(result){this._updateCommandsFromServer(result);var prom=this._updateChannelsFromServer(result);this._updateModerationSettingsFromServer(result);this._updateMailboxesFromServer(result);this._updateMailFailuresFromServer(result);this._updateCannedResponsesFromServer(result);this._mentionPartnerSuggestions=result.mention_partner_suggestions;this._discussMenuID=result.menu_id;return prom;},_updateMailboxesFromServer:function(data){this.getMailbox('inbox').setMailboxCounter(data.needaction_inbox_counter||0);this.getMailbox('starred').setMailboxCounter(data.starred_counter||0);if(data.is_moderator){this._addMailbox({id:'moderation',name:_t("Moderate Messages"),mailboxCounter:data.moderation_counter||0,});}},_updateMailFailuresFromServer:function(data){var self=this;this._mailFailures=_.map(data.mail_failures,function(mailFailureData){return new MailFailure(self,mailFailureData);});},_updateModerationSettingsFromServer:function(data){this._isMyselfModerator=data.is_moderator;this._moderatedChannelIDs=data.moderation_channel_ids;},_onDiscussOpen:function(open){this._discussOpen=open;},_onWindowFocus:function(){this._resetOutOfFocusUnreadMessageCounter();this.trigger_up('set_title_part',{part:'_chat'});},});return MailManager;});;

/* /mail/static/src/js/services/mail_document_thread_manager.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Manager.DocumentThread',function(require){"use strict";var MailManager=require('mail.Manager');var DocumentThread=require('mail.model.DocumentThread');var session=require('web.session');MailManager.include({DOCUMENT_THREAD_MESSAGE_KEY:'mail.document_threads_last_message',DOCUMENT_THREAD_STATE_KEY:'mail.document_threads_state',start:function(){this._super.apply(this,arguments);this._documentThreadWindowStates={};this._tabId=this.call('bus_service','getTabId');var localStorageLength=this.call('local_storage','length');for(var i=0;i<localStorageLength;i++){var key=this.call('local_storage','key',i);if(key.indexOf(this.DOCUMENT_THREAD_STATE_KEY)===0){var documentThreadId=key.substring(this.DOCUMENT_THREAD_STATE_KEY.length+1);this._documentThreadWindowStates[documentThreadId]=this.call('local_storage','getItem',key);}}
this._mailBus.on('messaging_ready',this,this._updateDocumentThreadWindows.bind(this,this._documentThreadWindowStates));this.call('local_storage','onStorage',this,this._onStorage);},addMessage:function(data,options){var message=this.getMessage(data.id);if(!message&&options&&options.postedFromDocumentThread){var key=this.DOCUMENT_THREAD_MESSAGE_KEY;this.call('local_storage','setItem',key,{messageData:data,tabId:this._tabId,});}
return this._super.apply(this,arguments);},getDocumentThread:function(model,resID){return this.getThread(model+'_'+resID);},getOrAddDocumentThread:function(params){var thread=this.getDocumentThread(params.resModel,params.resID);if(!thread){thread=new DocumentThread({parent:this,data:{messageIDs:params.messageIDs,name:params.name,resID:params.resID,resModel:params.resModel,},});this._threads.push(thread);}else{if('messageIDs'in params){thread.setMessageIDs(params.messageIDs);}
if('name'in params&&params.name){thread.setName(params.name);}}
return thread;},openThread:function(threadID){var thread=this.getThread(threadID);if(thread&&thread.getType()==='document_thread'&&this._isDiscussOpen()){var resModel=thread.getDocumentModel();var resID=thread.getDocumentID();this._redirectToDocument(resModel,resID);}else{this._super.apply(this,arguments);}},updateDocumentThreadState:function(threadID,state){this._documentThreadWindowStates[threadID]=state;this.call('local_storage','setItem',this.DOCUMENT_THREAD_STATE_KEY+'/'+threadID,{state:state,tabId:this._tabId,});},_addNewMessagePostprocessThread:function(message){var resModel=message.getDocumentModel();var resID=message.getDocumentID();if(resModel&&resModel!=='mail.channel'&&resID){this.getOrAddDocumentThread({name:message.getDocumentName(),resID:resID,resModel:resModel,});}
return this._super.apply(this,arguments);},_updateDocumentThreadWindows:function(documentThreadStates){var self=this;_.each(documentThreadStates,function(state,key){var info=key.split('_');var documentThread=self.getOrAddDocumentThread({name:state.name,resID:parseInt(info[1]),resModel:info[0],});if(state.windowState==='closed'){documentThread.close({skipCrossTabSync:true,});}else{documentThread.fold(state.windowState==='folded',{skipCrossTabSync:true,});self.openThreadWindow(documentThread.getID(),{keepFoldState:true,skipCrossTabSync:true,});}});},_onStorage:function(ev){var value;try{value=JSON.parse(ev.newValue);}catch(err){return;}
if(ev.key.indexOf(this.DOCUMENT_THREAD_STATE_KEY)===0){if(value.tabId===this._tabId){return;}
var documentThreadId=ev.key.substring(this.DOCUMENT_THREAD_STATE_KEY.length+1);var param={};param[documentThreadId]=value.state;this._updateDocumentThreadWindows(param);}else if(ev.key===this.DOCUMENT_THREAD_MESSAGE_KEY){if(value.tabId===this._tabId){return;}
if(value.messageData){this.addMessage(value.messageData);}}},});return MailManager;});;

/* /mail/static/src/js/services/mail_status_manager.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Manager.Status',function(require){"use strict";var core=require('web.core');var MailManager=require('mail.Manager');var mailUtils=require('mail.utils');var QWeb=core.qweb;MailManager.include({_UPDATE_INTERVAL:50,getImStatus:function(data){var self=this;var partnerID=data.partnerID;if(partnerID===this.getOdoobotID()[0]){return'bot';}
if(!this._imStatus[partnerID]){this._imStatus[partnerID]=undefined;mailUtils.clearTimeout(this._fetchStatusTimeout);this._fetchStatusTimeout=mailUtils.setTimeout(function(){self._fetchMissingImStatus();},500);}
return this._imStatus[partnerID];},updateImStatus:function(statusList){var updatedIDs=[];var self=this;var dmChat;var toUpdateOutOfOfficeChatIDs=[];_.each(statusList,function(status){if(self._imStatus[status.id]===status.im_status){return;}
if(status.im_status.indexOf('leave')!==-1||(self._imStatus[status.id]&&self._imStatus[status.id].indexOf('leave')!==-1)){dmChat=self.getDMChatFromPartnerID(status.id);if(dmChat){toUpdateOutOfOfficeChatIDs.push(dmChat.getID());}}
updatedIDs.push(status.id);self._imStatus[status.id]=status.im_status;});if(!_.isEmpty(toUpdateOutOfOfficeChatIDs)){this._rpc({model:'mail.channel',method:'channel_info',args:[toUpdateOutOfOfficeChatIDs],}).then(function(channelsInfo){_.each(channelsInfo,function(channelInfo){dmChat=self.getChannel(channelInfo.id);if(!dmChat){return;}
dmChat.updateOutOfOfficeInfo({outOfOfficeMessage:channelInfo.direct_partner[0].out_of_office_message,outOfOfficeDateEnd:channelInfo.direct_partner[0].out_of_office_date_end,});});});}
if(!_.isEmpty(updatedIDs)){this._mailBus.trigger('updated_im_status',updatedIDs);this._renderImStatus(updatedIDs);}},_fetchImStatus:function(data){var self=this;var partnerIDs=data.partnerIDs;if(_.isEmpty(partnerIDs)){return Promise.resolve();}
return this._rpc({route:'/longpolling/im_status',params:{partner_ids:partnerIDs},},{shadow:true,}).then(function(results){self.updateImStatus(results);});},_fetchMissingImStatus:function(){var missing=[];_.each(this._imStatus,function(value,key){if(value===undefined){missing.push(Number(key));}});return this._fetchImStatus({partnerIDs:missing});},_getImStatusToUpdate:function(){var toUpdate=[];_.each(this._imStatus,function(status,key){if(['im_partner','bot'].indexOf(status)===-1){toUpdate.push(Number(key));}});return toUpdate;},_initializeInternalState:function(){this._super.apply(this,arguments);this._fetchStatusTimeout=undefined;this._imStatus={};this._isTabFocused=true;this._updateImStatusLoop();},_listenOnBuses:function(){this._super.apply(this,arguments);$(window).on("focus",this._onWindowFocusChange.bind(this,true));$(window).on("blur",this._onWindowFocusChange.bind(this,false));$(window).on("unload",this._onWindowFocusChange.bind(this,false));},_renderImStatus:function(updatedIds){var self=this;$('.o_updatable_im_status').each(function(){var $this=$(this);var partnerID=$this.data('partner-id');if(partnerID!==undefined&&updatedIds.indexOf(partnerID)!==-1){var status=QWeb.render('mail.UserStatus',{status:self.getImStatus({partnerID:partnerID}),partnerID:partnerID,});$this.replaceWith(status);}});},_updateImStatusLoop:function(counter){var self=this;if(!_.isNumber(counter)){counter=0;}
mailUtils.setTimeout(function(){if(counter>=self._UPDATE_INTERVAL&&self._isTabFocused){self._fetchImStatus({partnerIDs:self._getImStatusToUpdate()});counter=0;}
self._updateImStatusLoop(counter+1);},1000);},_onWindowFocusChange:function(focused){this._isTabFocused=focused;},});});;

/* /mail/static/src/js/services/mail_notification_manager.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Manager.Notification',function(require){"use strict";var MailManager=require('mail.Manager');var MailFailure=require('mail.model.MailFailure');const config=require('web.config');var core=require('web.core');var session=require('web.session');var _t=core._t;MailManager.include({_filterNotificationsOnUnsubscribe:function(notifications){var unsubscribedNotif=_.find(notifications,function(notif){return notif[1].info==='unsubscribe';});if(unsubscribedNotif){notifications=_.reject(notifications,function(notif){return notif[0][1]==='mail.channel'&&notif[0][2]===unsubscribedNotif[1].id;});}
return notifications;},_handleChannelNotification:function(params){if(params.data&&params.data.info==='typing_status'){this._handleChannelTypingNotification(params.channelID,params.data);}else if(params.data&&params.data.info==='channel_fetched'){this._handleChannelFetchedNotification(params.channelID,params.data);}else if(params.data&&params.data.info==='channel_seen'){this._handleChannelSeenNotification(params.channelID,params.data);}else{this._handleChannelMessageNotification(params.data);}},_handleChannelFetchedNotification:function(channelID,data){var channel=this.getChannel(channelID);if(!channel){return;}
if(channel.hasSeenFeature()){channel.updateSeenPartnersInfo(data);}},_handleChannelMessageNotification:function(messageData){var self=this;var def;var channelAlreadyInCache=true;if(messageData.channel_ids.length===1){channelAlreadyInCache=!!this.getChannel(messageData.channel_ids[0]);def=this.joinChannel(messageData.channel_ids[0],{autoswitch:false});}else{def=Promise.resolve();}
def.then(function(){return self.addMessage(messageData,{showNotification:true,incrementUnread:channelAlreadyInCache});});},_handleChannelSeenNotification:function(channelID,data){var channel=this.getChannel(channelID);if(!channel){return;}
if(channel.hasSeenFeature()){channel.updateSeenPartnersInfo(data);}
if(session.partner_id!==data.partner_id){return;}
channel.setLastSeenMessageID(data.last_message_id);if(channel.hasUnreadMessages()){channel.resetUnreadCounter();}},_handleChannelTypingNotification:function(channelID,typingData){var isWebsiteUser=typingData.is_website_user;var partnerID=typingData.partner_id;if(partnerID===session.partner_id&&!isWebsiteUser){return;}
var channel=this.getChannel(channelID);if(!channel){return;}
var typingID={isWebsiteUser:typingData.is_website_user,partnerID:typingData.partner_id,};if(typingData.is_typing){channel.registerTyping(typingID);}else{channel.unregisterTyping(typingID);}},_handleNeedactionNotification:function(messageData){var self=this;var inbox=this.getMailbox('inbox');this.addMessage(messageData,{incrementUnread:true,showNotification:true,}).then(function(message){inbox.incrementMailboxCounter();_.each(message.getThreadIDs(),function(threadID){var channel=self.getChannel(threadID);if(channel){channel.incrementNeedactionCounter();}});self._mailBus.trigger('update_needaction',inbox.getMailboxCounter());});},_handlePartnerActivityUpdateNotification:function(data){this._mailBus.trigger('activity_updated',data);},_handlePartnerChannelMinimizeNotification:function(channelData){var self=this;this._addChannel(channelData).then(function(channelID){self.getChannel(channelID).detach()});},_handlePartnerChannelNotification:function(channelData){if((channelData.channel_type==='channel')&&(channelData.state==='open')){this._addChannel(channelData,{autoswitch:false});if(!channelData.is_minimized&&channelData.info!=='creation'){this.do_notify(_t("Invitation"),_.str.sprintf(_t("You have been invited to: %s"),_.escape(channelData.name)));}}
if(!config.device.isMobile){const channel=this.getChannel(channelData.id);if(channel&&channelData.info!=='join'){channel.updateWindowState({folded:channelData.state==='folded'?true:false,detached:channelData.is_minimized,});}}},_handlePartnerChannnelSeenNotification:function(data){this._handleChannelSeenNotification(data.channel_id,data);},_handlePartnerMailFailureNotification:function(datas){var self=this;_.each(datas.elements,function(data){var isNewFailure=_.some(data.notifications,function(notif){return notif[0]==='exception'||notif[0]==='bounce';});var matchedFailure=_.find(self._mailFailures,function(failure){return failure.getMessageID()===data.message_id;});if(matchedFailure){var index=_.findIndex(self._mailFailures,matchedFailure);if(isNewFailure){self._mailFailures[index]=new MailFailure(self,data);}else{self._mailFailures.splice(index,1);}}else if(isNewFailure){self._mailFailures.push(new MailFailure(self,data));}
var message=_.find(self._messages,function(msg){return msg.getID()===data.message_id;});if(message){if(isNewFailure){message.updateCustomerEmailStatus('exception');}else{message.updateCustomerEmailStatus('sent');}
self._updateMessageNotificationStatus(data,message);self._mailBus.trigger('update_message',message);}});this._mailBus.trigger('update_needaction',this.needactionCounter);},_handlePartnerMarkAsReadNotification:function(data){var self=this;var history=this.getMailbox('history');_.each(data.message_ids,function(messageID){var message=_.find(self._messages,function(msg){return msg.getID()===messageID;});if(message){self._removeMessageFromThread('mailbox_inbox',message);history.addMessage(message);self._mailBus.trigger('update_message',message,data.type);}});if(data.channel_ids){_.each(data.channel_ids,function(channelID){var channel=self.getChannel(channelID);if(channel){channel.decrementNeedactionCounter(data.message_ids.length,0);}});}else{_.each(this.getChannels(),function(channel){channel.resetNeedactionCounter();});}
var inbox=this.getMailbox('inbox');inbox.decrementMailboxCounter(data.message_ids.length);this._mailBus.trigger('update_needaction',inbox.getMailboxCounter());},_handlePartnerMessageAuthorNotification:function(data){this.addMessage(data.message);},_handlePartnerMessageDeletionNotification:function(data){var self=this;_.each(data.message_ids,function(messageID){var message=self.getMessage(messageID);if(message){message.setModerationStatus('rejected');}});},_handlePartnerMessageModeratorNotification:function(data){var self=this;this.addMessage(data.message).then(function(){self._mailBus.trigger('update_moderation_counter');});},_handlePartnerNotification:function(data){if(data.info==='unsubscribe'){this._handlePartnerUnsubscribeNotification(data);}else if(data.type==='toggle_star'){this._handlePartnerToggleStarNotification(data);}else if(data.type==='mark_as_read'){this._handlePartnerMarkAsReadNotification(data);}else if(data.type==='moderator'){this._handlePartnerMessageModeratorNotification(data);}else if(data.type==='author'){this._handlePartnerMessageAuthorNotification(data);}else if(data.type==='deletion'){this._handlePartnerMessageDeletionNotification(data);}else if(data.info==='transient_message'){this._handlePartnerTransientMessageNotification(data);}else if(data.type==='activity_updated'){this._handlePartnerActivityUpdateNotification(data);}else if(data.type==='mail_failure'){this._handlePartnerMailFailureNotification(data);}else if(data.type==='user_connection'){this._handlePartnerUserConnectionNotification(data);}else if(data.info==='channel_seen'){this._handlePartnerChannnelSeenNotification(data);}else if(data.type==='simple_notification'){var title=_.escape(data.title),message=_.escape(data.message);data.warning?this.do_warn(title,message,data.sticky):this.do_notify(title,message,data.sticky);}else if(data.info==='channel_minimize'){this._handlePartnerChannelMinimizeNotification(data);}else{this._handlePartnerChannelNotification(data);}},_handlePartnerToggleStarNotification:function(data){var self=this;var starred=this.getMailbox('starred');_.each(data.message_ids,function(messageID){var message=_.find(self._messages,function(msg){return msg.getID()===messageID;});if(message){message.setStarred(data.starred);if(!message.isStarred()){self._removeMessageFromThread('mailbox_starred',message);}else{self._addMessageToThreads(message,[]);var channelStarred=self.getMailbox('starred');channelStarred.invalidateCaches();}
self._mailBus.trigger('update_message',message);}});if(data.starred){starred.incrementMailboxCounter(data.message_ids.length);}else{starred.decrementMailboxCounter(data.message_ids.length);}
this._mailBus.trigger('update_starred',starred.getMailboxCounter());},_handlePartnerTransientMessageNotification:function(data){var lastMessage=_.last(this._messages);data.id=(lastMessage?lastMessage.getID():0)+0.01;data.author_id=this.getOdoobotID();this.addMessage(data);},_handlePartnerUnsubscribeNotification:function(data){var channel=this.getChannel(data.id);if(channel){var message;if(_.contains(['public','private'],channel.getType())){message=_.str.sprintf(_t("You unsubscribed from <b>%s</b>."),_.escape(channel.getName()));}else{message=_.str.sprintf(_t("You unpinned your conversation with <b>%s</b>."),_.escape(channel.getName()));}
this._removeChannel(channel);this._mailBus.trigger('unsubscribe_from_channel',data.id);this.do_notify(_t("Unsubscribed"),message);}},_handlePartnerUserConnectionNotification:function(data){var self=this;var partnerID=data.partner_id;this.call('bus_service','sendNotification',data.title,data.message,function(){self.call('mail_service','openDMChatWindowFromBlankThreadWindow',partnerID);});},_listenOnBuses:function(){this._super.apply(this,arguments);this.call('bus_service','onNotification',this,this._onNotification);},_updateMessageNotificationStatus:function(data,message){_.each(data.notifications,function(notif,id){var partnerName=notif[1];var notifStatus=notif[0];var res=_.find(message.getCustomerEmailData(),function(entry){return entry[0]===parseInt(id);});if(res){res[2]=notifStatus;}else{message.addCustomerEmailData([parseInt(id),partnerName,notifStatus]);}});},_onNotification:function(notifs){var self=this;notifs=this._filterNotificationsOnUnsubscribe(notifs);_.each(notifs,function(notif){var model=notif[0][1];if(model==='ir.needaction'){self._handleNeedactionNotification(notif[1]);}else if(model==='mail.channel'){self._handleChannelNotification({channelID:notif[0][2],data:notif[1],});}else if(model==='res.partner'){self._handlePartnerNotification(notif[1]);}});},});return MailManager;});;

/* /mail/static/src/js/services/mail_window_manager.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Manager.Window',function(require){"use strict";var MailManager=require('mail.Manager');var ThreadWindow=require('mail.ThreadWindow');var config=require('web.config');var core=require('web.core');var utils=require('web.utils');var QWeb=core.qweb;var _t=core._t;MailManager.include({custom_events:_.extend({},MailManager.prototype.custom_events,{close_blank_thread_window:'_onCloseBlankThreadWindow',}),HIDDEN_THREAD_WINDOW_DROPDOWN_BUTTON_WIDTH:50,THREAD_WINDOW_APPENDTO:'body',THREAD_WINDOW_WIDTH:325+5,openBlankThreadWindow:function(){var blankThreadWindow=this._getBlankThreadWindow();if(!blankThreadWindow){blankThreadWindow=new ThreadWindow(this,null);this._addThreadWindow(blankThreadWindow);blankThreadWindow.appendTo(this.THREAD_WINDOW_APPENDTO).then(this._repositionThreadWindows.bind(this));}else{if(blankThreadWindow.isHidden()){this._makeThreadWindowVisible(blankThreadWindow);}else if(blankThreadWindow.isFolded()){blankThreadWindow.toggleFold(false);}}},openDMChatWindowFromBlankThreadWindow:function(partnerID){var dmChat=this.getDMChatFromPartnerID(partnerID);if(!dmChat){this._openAndDetachDMChat(partnerID);}else{this.openThreadWindow(dmChat.getID());}
this._closeBlankThreadWindow();},openThread:function(threadID){if(!this._isDiscussOpen()){var thread=this.getThread(threadID);if(thread){thread.detach();}}else{this._super.apply(this,arguments);}},openThreadWindow:function(threadID,options){var self=this;options=options||{};var thread=this.getThread(threadID);if(thread.isCreatingWindow){return Promise.resolve();}
var threadWindow=this._getThreadWindow(threadID);var prom=Promise.resolve();if(!threadWindow){thread.isCreatingWindow=true;prom=thread.fetchMessages().then(function(){threadWindow=self._makeNewThreadWindow(thread,options);return threadWindow.appendTo($(self.THREAD_WINDOW_APPENDTO));}).then(function(){self._placeNewThreadWindow(threadWindow,options.passively);self._repositionThreadWindows();threadWindow.render();threadWindow.scrollToBottom();if(!self._areAllThreadWindowsHidden()&&!thread.isFolded()&&!threadWindow.isPassive()){thread.markAsRead();}
thread.isCreatingWindow=false;}).guardedCatch(function(){thread.close({skipCrossTabSync:true,});thread.isCreatingWindow=false;});}
return prom.then(function(){threadWindow.updateVisualFoldState();});},updateThreadWindow:function(threadID,options){var thread=this.getThread(threadID);var prom=Promise.resolve();if(thread){if(thread.isDetached()){_.extend(options,{keepFoldState:true});prom=this.openThreadWindow(threadID,options);}else{this._closeThreadWindow(threadID);}}
return prom;},_addThreadWindow:function(threadWindow){this._threadWindows.push(threadWindow);this._computeAvailableSlotsForThreadWindows();this._threadWindows.pop();this._threadWindows.splice(this._availableSlotsForThreadWindows-1,0,threadWindow);},_areAllThreadWindowsHidden:function(){return $(this.THREAD_WINDOW_APPENDTO).hasClass('o_no_thread_window');},_closeThreadWindow:function(threadID){var threadWindow=_.find(this._threadWindows,function(threadWindow){return threadWindow.getID()===threadID;});if(threadWindow){this._threadWindows=_.without(this._threadWindows,threadWindow);this._repositionThreadWindows();threadWindow.destroy();}},_closeBlankThreadWindow:function(){var blankThreadWindow=this._getBlankThreadWindow();if(blankThreadWindow){this._closeThreadWindow(blankThreadWindow.getID());}},_computeAvailableSlotsForThreadWindows:function(){if(config.device.isMobile){this._availableSlotsForThreadWindows=1;return;}
var GLOBAL_WIDTH=this._getGlobalWidth();var THREAD_WINDOW_NUM=this._threadWindows.length;var availableSlots=Math.floor(GLOBAL_WIDTH/this.THREAD_WINDOW_WIDTH);var spaceLeft=GLOBAL_WIDTH-(Math.min(availableSlots,THREAD_WINDOW_NUM)*this.THREAD_WINDOW_WIDTH);if(availableSlots<THREAD_WINDOW_NUM&&spaceLeft<this.HIDDEN_THREAD_WINDOW_DROPDOWN_BUTTON_WIDTH){availableSlots--;spaceLeft+=this.THREAD_WINDOW_WIDTH;}
this._availableSlotsForThreadWindows=availableSlots;this._spaceLeftForThreadWindows=spaceLeft;},_getBlankThreadWindow:function(){return _.find(this._threadWindows,function(threadWindow){return threadWindow.getID()==='_blank';});},_getGlobalWidth:function(){return window.innerWidth;},_getHiddenThreadWindow:function(threadID){return _.find(this._hiddenThreadWindows,function(threadWindow){return threadWindow.getID()===threadID;});},_getThreadWindow:function(threadID){return _.find(this._threadWindows,function(threadWindow){return threadWindow.getID()===threadID;});},_initializeInternalState:function(){this._super.apply(this,arguments);this._availableSlotsForThreadWindows=0;this._hiddenThreadWindows=[];this._keepHiddenThreadWindowsDropdownOpen=false;this._spaceLeftForThreadWindows=0;this._threadWindows=[];this._$hiddenThreadWindowsDropdown=null;},_listenOnBuses:function(){this._super.apply(this,arguments);this._mailBus.on('update_message',this,this._onUpdateMessage).on('new_message',this,this._onNewMessage).on('new_channel',this,this._onNewChannel).on('is_thread_bottom_visible',this,this._onIsThreadBottomVisible).on('unsubscribe_from_channel',this,this._onUnsubscribeFromChannel).on('updated_im_status',this,this._onUpdatedImStatus).on('updated_out_of_office',this,this._onUpdatedOutOfOffice).on('update_thread_unread_counter',this,this._onUpdateThreadUnreadCounter);core.bus.on('resize',this,_.debounce(this._repositionThreadWindows.bind(this),100));},_makeHiddenThreadWindowsDropdown:function(){var self=this;if(this._$hiddenThreadWindowsDropdown){this._$hiddenThreadWindowsDropdown.remove();}
if(this._hiddenThreadWindows.length){this._$hiddenThreadWindowsDropdown=this._renderHiddenThreadWindowsDropdown();var $hiddenWindowsDropdown=this._$hiddenThreadWindowsDropdown;$hiddenWindowsDropdown.css({right:this.THREAD_WINDOW_WIDTH*this._availableSlotsForThreadWindows,bottom:0}).appendTo(this.THREAD_WINDOW_APPENDTO);this._repositionHiddenWindowsDropdown();this._keepHiddenThreadWindowsDropdownOpen=false;$hiddenWindowsDropdown.on('click','.o_thread_window_header',function(ev){var threadID=$(ev.currentTarget).data('thread-id');var threadWindow=self._getHiddenThreadWindow(threadID);if(threadWindow){self._makeThreadWindowVisible(threadWindow);}}).on('click','.o_thread_window_close',function(ev){ev.preventDefault();var threadID=$(ev.currentTarget).closest('.o_thread_window_header').data('thread-id');var threadWindow=self._getHiddenThreadWindow(threadID);if(threadWindow){threadWindow.close();self._keepHiddenThreadWindowsDropdownOpen=true;}});}},_makeNewThreadWindow:function(thread,options){return new ThreadWindow(this,thread,_.extend(options,{autofocus:!options.passively,}));},_makeThreadWindowVisible:function(threadWindow){utils.swap(this._threadWindows,threadWindow,this._threadWindows[this._availableSlotsForThreadWindows-1]);this._repositionThreadWindows();threadWindow.toggleFold(false);},_openAndDetachDMChat:async function(partnerID){const data=await this._rpc({model:'mail.channel',method:config.device.isMobile?'channel_get':'channel_get_and_minimize',args:[[partnerID]],});const channelID=await this._addChannel(data);const channel=this.getChannel(channelID);channel.detach();},_placeNewThreadWindow:function(threadWindow,passively){var thread=this.getThread(threadWindow.getID());var blankThreadWindow=this._getBlankThreadWindow();if(blankThreadWindow&&thread.getType()==='dm_chat'&&thread.getDirectPartnerID()===blankThreadWindow.directPartnerID){var index=_.indexOf(this._threadWindows,blankThreadWindow);this._threadWindows[index]=threadWindow;blankThreadWindow.destroy();}else if(passively){this._threadWindows.push(threadWindow);}else{this._addThreadWindow(threadWindow);}},_repositionHiddenWindowsDropdown:function(){var $dropdownUL=this._$hiddenThreadWindowsDropdown.children('ul');if(this._spaceLeftForThreadWindows>$dropdownUL.width()+10){$dropdownUL.addClass('dropdown-menu-right');}},_renderHiddenThreadWindowsDropdown:function(){var $dropdown=$(QWeb.render('mail.HiddenThreadWindowsDropdown',{threadWindows:this._hiddenThreadWindows,open:this._keepHiddenThreadWindowsDropdownOpen,unreadCounter:this._hiddenThreadWindowsUnreadCounter,widget:{isMobile:function(){return config.device.isMobile;},},}));return $dropdown;},_repositionHiddenThreadWindows:function(){var hiddenWindows=[];var hiddenUnreadCounter=0;var index=this._availableSlotsForThreadWindows;while(index<this._threadWindows.length){var threadWindow=this._threadWindows[index];hiddenWindows.push(threadWindow);hiddenUnreadCounter+=threadWindow.getUnreadCounter();threadWindow.do_hide();index++;}
this._hiddenThreadWindows=hiddenWindows;this._hiddenThreadWindowsUnreadCounter=hiddenUnreadCounter;this._makeHiddenThreadWindowsDropdown();},_repositionThreadWindows:function(){this._computeAvailableSlotsForThreadWindows();this._repositionVisibleThreadWindows();this._repositionHiddenThreadWindows();},_repositionVisibleThreadWindows:function(){var index=0;while(index<this._availableSlotsForThreadWindows&&index<this._threadWindows.length){var threadWindow=this._threadWindows[index];var cssProps={bottom:0};cssProps[_t.database.parameters.direction==='rtl'?'left':'right']=this.THREAD_WINDOW_WIDTH*index;threadWindow.$el.css(cssProps);threadWindow.do_show();index++;}},_updateThreadWindowsFromMessage:function(message,options){_.each(this._threadWindows,function(threadWindow){if(_.contains(message.getThreadIDs(),threadWindow.getID())){threadWindow.update(options);}});},_onCloseBlankThreadWindow:function(){this._closeBlankThreadWindow();},_onDiscussOpen:function(open){this._super.apply(this,arguments);if(open){$(this.THREAD_WINDOW_APPENDTO).addClass('o_no_thread_window');}else{$(this.THREAD_WINDOW_APPENDTO).removeClass('o_no_thread_window');this._repositionThreadWindows();}},_onIsThreadBottomVisible:function(thread,query){_.each(this._threadWindows,function(threadWindow){if(thread.getID()===threadWindow.getID()&&threadWindow.isAtBottom()&&!threadWindow.isHidden()){query.isVisible=true;}});},_onNewChannel:function(channel,proms){if(channel.isDetached()){if(!config.device.isMobile){var prom=this.openThreadWindow(channel.getID(),{keepFoldState:true,passively:true,});proms.push(prom);}}else{this._closeThreadWindow(channel.getID());}},_onNewMessage:function(message){this._updateThreadWindowsFromMessage(message,{keepBottom:true,passively:true});},_onUnsubscribeFromChannel:function(channelID){this._closeThreadWindow(channelID);},_onUpdatedImStatus:function(partnerIDs){var self=this;_.each(partnerIDs,function(partnerID){var thread=self.getDMChatFromPartnerID(partnerID);if(!thread){return;}
var threadWindow=self._getThreadWindow(thread.getID());if(!threadWindow){return;}
threadWindow.renderHeader();});},_onUpdatedOutOfOffice:function(data){var threadWindow=this._getThreadWindow(data.threadID);if(!threadWindow){return;}
threadWindow.renderOutOfOffice();},_onUpdateThreadUnreadCounter:function(thread){var self=this;this._hiddenThreadWindowsUnreadCounter=0;_.each(this._threadWindows,function(threadWindow){if(thread.getID()===threadWindow.getID()){threadWindow.renderHeader();if(thread.getUnreadCounter()===0){threadWindow.removePassive();}}
if(threadWindow.isHidden()){self._hiddenThreadWindowsUnreadCounter+=threadWindow.getUnreadCounter();}});if(this._$hiddenThreadWindowsDropdown){this._$hiddenThreadWindowsDropdown.html(this._renderHiddenThreadWindowsDropdown().html());this._repositionHiddenWindowsDropdown();}},_onUpdateMessage:function(message){this._updateThreadWindowsFromMessage(message,{keepBottom:false});},});return MailManager;});;

/* /mail/static/src/js/services/mail_service.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Service',function(require){"use strict";var core=require('web.core');var MailManager=require('mail.Manager');require('mail.Manager.Status');require('mail.Manager.Notification');require('mail.Manager.Window');require('mail.Manager.DocumentThread');core.serviceRegistry.add('mail_service',MailManager);return MailManager;});;

/* /mail/static/src/js/models/mail_failure.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.MailFailure',function(require){"use strict";var Class=require('web.Class');var core=require('web.core');var Mixins=require('web.mixins');var ServicesMixin=require('web.ServicesMixin');var time=require('web.time');var _t=core._t;var MailFailure=Class.extend(Mixins.EventDispatcherMixin,ServicesMixin,{init:function(parent,data){Mixins.EventDispatcherMixin.init.call(this,arguments);this.setParent(parent);this._documentID=data.res_id;this._documentModel=data.model;this._failureType=data.failure_type||'mail';this._lastMessageDate=moment();this._messageID=data.message_id;this._modelName=data.model_name;this._moduleIcon=data.module_icon;this._notifications=data.notifications;this._recordName=data.record_name;this._uuid=data.uuid;if(data.last_message_date){this._lastMessageDate=moment(time.str_to_datetime(data.last_message_date));}},getDocumentModel:function(){return this._documentModel;},getDocumentID:function(){return this._documentID;},getFailureType:function(){return this._failureType;},getMessageID:function(){return this._messageID;},getPreview:function(){var preview={body:_t("An error occurred when sending an email"),date:this._lastMessageDate,documentID:this._documentID,documentModel:this._documentModel,id:'mail_failure',imageSRC:this._moduleIcon,title:this._modelName,};return preview;},isLinkedToDocument:function(){return!!(this._documentModel&&this._documentID);},});return MailFailure;});;

/* /mail/static/src/js/models/messages/abstract_message.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.AbstractMessage',function(require){"use strict";var mailUtils=require('mail.utils');var Class=require('web.Class');var core=require('web.core');var session=require('web.session');var time=require('web.time');var _t=core._t;var AbstractMessage=Class.extend({init:function(parent,data){this._attachmentIDs=data.attachment_ids||[];this._body=data.body||"";this._date=data.date?moment(time.str_to_datetime(data.date)):moment();this._id=data.id;this._isDiscussion=data.is_discussion;this._isNotification=data.is_notification;this._serverAuthorID=data.author_id;this._type=data.message_type||undefined;this._processAttachmentURL();this._attachmentIDs.forEach(function(attachment){attachment.filename=attachment.filename||attachment.name||_t("unnamed");});},getAttachments:function(){return this._attachmentIDs;},getAuthorID:function(){if(!this.hasAuthor()){return-1;}
return this._serverAuthorID[0];},getAuthorImStatus:function(){return undefined;},getAvatarSource:function(){if(this.hasAuthor()){return'/web/image/res.partner/'+this.getAuthorID()+'/image_128';}},getBody:function(){return this._body;},getDate:function(){return this._date;},getDateDay:function(){var date=this.getDate().format('YYYY-MM-DD');if(date===moment().format('YYYY-MM-DD')){return _t("Today");}else if(date===moment().subtract(1,'days').format('YYYY-MM-DD')){return _t("Yesterday");}
return this.getDate().format('LL');},getDisplayedAuthor:function(){return this.hasAuthor()?this._getAuthorName():null;},getID:function(){return this._id;},getImageAttachments:function(){return _.filter(this.getAttachments(),function(attachment){return attachment.mimetype&&attachment.mimetype.split('/')[0]==='image';});},getNonImageAttachments:function(){return _.difference(this.getAttachments(),this.getImageAttachments());},getTimeElapsed:function(){return mailUtils.timeFromNow(this.getDate());},getType:function(){return this._type;},hasAttachments:function(){return this.getAttachments().length>0;},hasAuthor:function(){return!!(this._serverAuthorID&&this._serverAuthorID[0]);},hasCustomerEmailData:function(){return false;},hasEmailFrom:function(){return false;},hasImageAttachments:function(){return _.some(this.getAttachments(),function(attachment){return attachment.mimetype&&attachment.mimetype.split('/')[0]==='image';});},hasNonImageAttachments:function(){return _.some(this.getAttachments(),function(attachment){return!(attachment.mimetype&&attachment.mimetype.split('/')[0]==='image');});},originatesFromChannel:function(){return false;},hasSubject:function(){return false;},isEmpty:function(){return!this.hasTrackingValues()&&!this.hasAttachments()&&!this.getBody();},hasSubtypeDescription:function(){return false;},hasTrackingValues:function(){return false;},isDiscussion:function(){return this._isDiscussion;},isLinkedToDocumentThread:function(){return false;},isNeedaction:function(){return false;},isNote:function(){return this._isNote;},isNotification:function(){return this._isNotification;},isStarred:function(){return false;},isSystemNotification:function(){return false;},needsModeration:function(){return false;},removeAttachments:function(attachmentIDs){this._attachmentIDs=_.reject(this._attachmentIDs,function(attachment){return _.contains(attachmentIDs,attachment.id);});},shouldRedirectToAuthor:function(){return!this._isMyselfAuthor();},_getAuthorName:function(){if(!this.hasAuthor()){return"";}
return this._serverAuthorID[1];},_isMyselfAuthor:function(){return this.hasAuthor()&&(this.getAuthorID()===session.partner_id);},_processAttachmentURL:function(){_.each(this.getAttachments(),function(attachment){attachment.url='/web/content/'+attachment.id+'?download=true';});},});return AbstractMessage;});;

/* /mail/static/src/js/models/messages/message.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.Message',function(require){"use strict";var emojis=require('mail.emojis');var AbstractMessage=require('mail.model.AbstractMessage');var mailUtils=require('mail.utils');var core=require('web.core');var Mixins=require('web.mixins');var ServicesMixin=require('web.ServicesMixin');var session=require('web.session');var _t=core._t;var Message=AbstractMessage.extend(Mixins.EventDispatcherMixin,ServicesMixin,{init:function(parent,data,emojis){this._super.apply(this,arguments);Mixins.EventDispatcherMixin.init.call(this,arguments);this.setParent(parent);this._setInitialData(data);this._processBody(emojis);this._processMailboxes();this._processModeration();this._processDocumentThread();this._processTrackingValues();},addCustomerEmailData:function(data){this._customerEmailData.push(data);},getAuthorImStatus:function(){if(!this.hasAuthor()){return undefined;}
return this.call('mail_service','getImStatus',{partnerID:this.getAuthorID()});},getAuthorName:function(){return this._getAuthorName();},getAvatarSource:function(){if(this._isOdoobotAuthor()){return'/mail/static/src/img/odoobot.png';}else if(this.hasAuthor()){return'/web/image/res.partner/'+this.getAuthorID()+'/image_128';}else if(this.getType()==='email'){return'/mail/static/src/img/email_icon.png';}
return'/mail/static/src/img/smiley/avatar.jpg';},getCustomerEmailData:function(){if(!this.hasCustomerEmailData()){return undefined;}
return this._customerEmailData;},getCustomerEmailStatus:function(){if(!this.hasCustomerEmailData()){return undefined;}
return this._customerEmailStatus;},getDisplayedAuthor:function(){var res=this._super.apply(this,arguments);if(res){return res;}else{return this.hasEmailFrom()?this.getEmailFrom():_t("Anonymous");}},getDocumentID:function(){return this._documentID;},getDocumentModel:function(){return this._documentModel;},getDocumentName:function(){if(!this.isLinkedToDocumentThread()){return"";}
var model=this.getDocumentModel();var id=this.getDocumentID();var documentThread=this.call('mail_service','getDocumentThread',model,id);if(documentThread){this._documentName=documentThread.getName();}
return this._documentName;},getEmailFrom:function(){if(!this.hasEmailFrom()){return"";}
return this._emailFrom;},getOriginChannelID:function(){if(!this.originatesFromChannel()){return-1;}
return this._documentID;},getOriginChannelName:function(){if(!this.originatesFromChannel()){return"";}
var originChannelID=this.getOriginChannelID();var channel=originChannelID&&this.call('mail_service','getChannel',originChannelID);if(!channel){return"";}
return channel.getName();},getPreview:function(){var id,title;if(this.isLinkedToDocumentThread()){id=this.getDocumentModel()+'_'+this.getDocumentID();title=this.getDocumentName();}else{id='mailbox_inbox';title=this.hasSubject()?this.getSubject():this.getDisplayedAuthor();}
return{author:this.getDisplayedAuthor(),body:mailUtils.htmlToTextContentInline(this.getBody()),date:this.getDate(),documentModel:this.getDocumentModel(),documentID:this.getDocumentID(),id:id,imageSRC:this._getModuleIcon()||this.getAvatarSource(),messageID:this.getID(),status:this.status,title:title,isLinkedToDocumentThread:this.isLinkedToDocumentThread(),};},getSubject:function(){if(!this.hasSubject()){return"";}
return this._subject;},getSubtypeDescription:function(){return this._subtypeDescription;},getThreadIDs:function(){return this._threadIDs;},getTrackingValues:function(){if(!this.hasTrackingValues()){return undefined;}
return this._trackingValueIDs;},getURL:function(){return session.url('/mail/view?message_id='+this._id);},hasCustomerEmailData:function(){return!!(this._customerEmailData&&(this._customerEmailData.length>0));},hasEmailFrom:function(){return!!(this._emailFrom);},hasSubject:function(){return!!(this._subject);},hasSubtypeDescription:function(){return!!(this._subtypeDescription);},hasTrackingValues:function(){return!!(this._trackingValueIDs&&(this._trackingValueIDs.length>0));},isLinkedToDocumentThread:function(){return!!(this._documentModel!=='mail.channel'&&this._documentID&&this._type!=='user_notification');},isMyselfAuthor:function(){return this._isMyselfAuthor();},needsModeration:function(){return this._moderationStatus==='pending_moderation';},needsModerationByUser:function(){return _.contains(this._threadIDs,'mailbox_moderation');},isNeedaction:function(){return _.contains(this._threadIDs,'mailbox_inbox');},isStarred:function(){return _.contains(this._threadIDs,'mailbox_starred');},isSystemNotification:function(){return(this.getType()==='notification'&&this._documentModel==='mail.channel')||this._isTransient();},originatesFromChannel:function(){return this._documentModel==='mail.channel';},removeThread:function(threadID){this._threadIDs=_.without(this._threadIDs,threadID);},setModerationStatus:function(newModerationStatus,options){var self=this;if(newModerationStatus===this._moderationStatus){return;}
this._moderationStatus=newModerationStatus;if(newModerationStatus==='accepted'&&options){_.each(options.additionalThreadIDs,function(threadID){self._addThread(threadID);});}
this._warnMessageModerated();},setStarred:function(starred){if(starred){this._addThread('mailbox_starred');}else{this.removeThread('mailbox_starred');}},shouldDisplaySubject:function(){return this.hasSubject()&&this.getType()!=='notification'&&!this.originatesFromChannel();},shouldRedirectToAuthor:function(){return this._super.apply(this,arguments)&&!this._isOdoobotAuthor();},toggleStarStatus:function(){return this._rpc({model:'mail.message',method:'toggle_message_starred',args:[[this._id]],});},updateCustomerEmailStatus:function(newCustomerEmailStatus){this._customerEmailStatus=newCustomerEmailStatus;},_addThread:function(threadID){if(!this._threadIDs){this._threadIDs=[];}
this._threadIDs.push(threadID);this._threadIDs=_.uniq(this._threadIDs);},_getAuthorName:function(){if(this._isOdoobotAuthor()){return"OdooBot";}
return this._super.apply(this,arguments);},_getModuleIcon:function(){return this._moduleIcon;},_isOdoobotAuthor:function(){return this._serverAuthorID&&this._serverAuthorID[0]===this.call('mail_service','getOdoobotID')[0];},_isTransient:function(){return this._info==='transient_message';},_processBody:function(){var self=this;_.each(emojis,function(emoji){var unicode=emoji.unicode;var regexp=new RegExp("(?:^|\\s|<[a-z]*>)("+unicode+")(?=\\s|$|</[a-z]*>)",'g');var originalBody=self._body;self._body=self._body.replace(regexp,' <span class="o_mail_emoji">'+unicode+'</span> ');if(_.str.count(self._body,'o_mail_emoji')>200){self._body=originalBody;}});self._body=mailUtils.parseAndTransform(self._body,mailUtils.addLink);},_processDocumentThread:function(){if(!this.isLinkedToDocumentThread()){return;}
var resModel=this.getDocumentModel();var resID=this.getDocumentID();var documentThread=this.call('mail_service','getOrAddDocumentThread',{resModel:resModel,resID:resID,name:this.getDocumentName(),});this._threadIDs.push(documentThread.getID());},_processMailboxes:function(){if(_.contains(this._needactionPartnerIDs,session.partner_id)){this._setNeedaction(true);}
if(_.contains(this._starredPartnerIDs,session.partner_id)){this.setStarred(true);}
if(_.contains(this._historyPartnerIDs,session.partner_id)){this._setHistory(true);}
if(this.originatesFromChannel()&&_.contains(this.call('mail_service','getModeratedChannelIDs'),this.getOriginChannelID())&&this.needsModeration()){this._setModeratedByUser(true);}},_processModeration:function(){if(this.needsModeration()){this._threadIDs.push(this.getOriginChannelID());}},_processTrackingValues:function(){if(this.hasTrackingValues()){_.each(this.getTrackingValues(),function(trackingValue){if(trackingValue.field_type==='datetime'){if(trackingValue.old_value){trackingValue.old_value=moment.utc(trackingValue.old_value).local().format('LLL');}
if(trackingValue.new_value){trackingValue.new_value=moment.utc(trackingValue.new_value).local().format('LLL');}}else if(trackingValue.field_type==='date'){if(trackingValue.old_value){trackingValue.old_value=moment(trackingValue.old_value).local().format('LL');}
if(trackingValue.new_value){trackingValue.new_value=moment(trackingValue.new_value).local().format('LL');}}});}},_setInitialData:function(data){this._customerEmailData=data.customer_email_data||[];this._customerEmailStatus=data.customer_email_status;this._documentModel=data.model;this._documentName=data.record_name;this._documentID=data.res_id;this._emailFrom=data.email_from;this._info=data.info;this._isNote=data.is_note;this._moduleIcon=data.module_icon;this._needactionPartnerIDs=data.needaction_partner_ids||[];this._starredPartnerIDs=data.starred_partner_ids||[];this._historyPartnerIDs=data.history_partner_ids||[];this._subject=data.subject;this._subtypeDescription=data.subtype_description;this._threadIDs=data.channel_ids||[];this._trackingValueIDs=data.tracking_value_ids;this._moderationStatus=data.moderation_status||'accepted';},_setHistory:function(history){if(history){this._addThread('mailbox_history');}else{this.removeThread('mailbox_history');}},_setModeratedByUser:function(moderated){if(moderated){this._addThread('mailbox_moderation');}else{this.removeThread('mailbox_moderation');}},_setNeedaction:function(needaction){if(needaction){this._addThread('mailbox_inbox');}else{this.removeThread('mailbox_inbox');}},_warnMessageModerated:function(){var mailBus=this.call('mail_service','getMailBus');if(this.needsModerationByUser()){this._setModeratedByUser(false);var moderationBox=this.call('mail_service','getMailbox','moderation');moderationBox.decrementMailboxCounter();moderationBox.removeMessage(this.getID());mailBus.trigger('update_moderation_counter');}
if(this._moderationStatus!=='accepted'){this.call('mail_service','removeMessageFromThreads',this);}
mailBus.trigger('update_message',this);},});return Message;});;

/* /mail/static/src/js/models/threads/abstract_thread.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.AbstractThread',function(require){"use strict";var Class=require('web.Class');var Mixins=require('web.mixins');var AbstractThread=Class.extend(Mixins.EventDispatcherMixin,{init:function(params){Mixins.EventDispatcherMixin.init.call(this,arguments);this.setParent(params.parent);this._folded=false;this._id=params.data.id;this._name=params.data.name;this._status=params.data.status||'';this._unreadCounter=0;},addMessage:function(message){this._addMessage.apply(this,arguments);this.trigger('message_added',message);},fold:function(folded){this._folded=folded;},getID:function(){return this._id;},getMessages:function(){},getName:function(){return this._name;},getOutOfOfficeInfo:function(){return undefined;},getOutOfOfficeMessage:function(){return undefined;},getStatus:function(){return this._status;},getTitle:function(){return this.getName();},getUnreadCounter:function(){return this._unreadCounter;},hasMessages:function(){return!_.isEmpty(this.getMessages());},hasSeenFeature:function(){return false;},hasTypingNotification:function(){return false;},isFolded:function(){return this._folded;},markAsRead:function(){if(this._unreadCounter>0){return this._markAsRead();}
return Promise.resolve();},postMessage:function(){return this._postMessage.apply(this,arguments).then(this.trigger.bind(this,'message_posted'));},resetUnreadCounter:function(){this._unreadCounter=0;this._warnUpdatedUnreadCounter();},_addMessage:function(message){},_incrementUnreadCounter:function(){this._unreadCounter++;},_markAsRead:function(){this.resetUnreadCounter();return Promise.resolve();},_postMessage:function(){return Promise.resolve();},_warnUpdatedUnreadCounter:function(){},});return AbstractThread;});;

/* /mail/static/src/js/models/threads/channel.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.Channel',function(require){"use strict";var SearchableThread=require('mail.model.SearchableThread');var ThreadTypingMixin=require('mail.model.ThreadTypingMixin');var mailUtils=require('mail.utils');const config=require('web.config');var session=require('web.session');var time=require('web.time');var Channel=SearchableThread.extend(ThreadTypingMixin,{init:function(params){var self=this;this._super.apply(this,arguments);ThreadTypingMixin.init.apply(this,arguments);var data=params.data;var options=params.options;var commands=params.commands;this._autoswitch='autoswitch'in options?options.autoswitch:true;this._commands=undefined;this._creatorUID=data.create_uid;this._detached=data.is_minimized||false;this._directPartnerID=undefined;this._folded=data.state==='folded';this._groupBasedSubscription=data.group_based_subscription;this._isModerated=data.moderation;this._isMyselfModerator=data.is_moderator;this._lastMessageDate=undefined;this._members=data.members||[];this._membersDef=undefined;this._needactionCounter=data.message_needaction_counter||0;this._serverType=data.channel_type;this._uuid=data.uuid;this._commands=_.filter(commands,function(command){return!command.channel_types||_.contains(command.channel_types,self._serverType);});if(data.last_message_date){this._lastMessageDate=moment(time.str_to_datetime(data.last_message_date));}
if(data.message_unread_counter){this._unreadCounter=data.message_unread_counter;}},close:function(){this._super.apply(this,arguments);if(!config.device.isMobile){this._rpc({model:'mail.channel',method:'channel_fold',kwargs:{uuid:this.getUUID(),state:'closed'},},{shadow:true});}},decrementNeedactionCounter:function(num){num=_.isNumber(num)?num:1;this._needactionCounter=Math.max(this._needactionCounter-1,0);},detach:function(){var self=this;return this._super.apply(this,arguments).then(function(){if(!config.device.isMobile){self._rpc({model:'mail.channel',method:'channel_minimize',args:[self.getUUID(),true],},{shadow:true,});}});},forceFetchMembers:function(){this._membersDef=undefined;return this.getMentionPartnerSuggestions();},fold:function(folded){this._super.apply(this,arguments);var args={uuid:this.getUUID(),};if(_.isBoolean(folded)){args.state=folded?'folded':'open';}
this._rpc({model:'mail.channel',method:'channel_fold',kwargs:args,},{shadow:true});},getCommands:function(){return this._commands;},getLastMessage:function(){return _.last(this._cache['[]'].messages);},getMentionPartnerSuggestions:function(){var self=this;if(!this._membersDef){this._membersDef=this._rpc({model:'mail.channel',method:'channel_fetch_listeners',args:[this.getUUID()],},{shadow:true}).then(function(members){self._members=members;return[members];});}
return this._membersDef;},getNeedactionCounter:function(){return this._needactionCounter;},getPreview:function(){var result=this._super.apply(this,arguments);if(!this.isTwoUserThread()){result.imageSRC='/web/image/mail.channel/'+this.getID()+'/image_128';}
var lastMessage=this.getLastMessage();return _.extend(result,{author:lastMessage?lastMessage.getDisplayedAuthor():'',body:lastMessage?mailUtils.htmlToTextContentInline(lastMessage.getBody()):'',date:lastMessage?lastMessage.getDate():undefined,isMyselfAuthor:this.hasMessages()&&this.getLastMessage().isMyselfAuthor(),});},getUUID:function(){return this._uuid;},incrementNeedactionCounter:function(){this._needactionCounter++;},isAutoswitch:function(){return this._autoswitch;},isChannel:function(){return true;},isGroupBasedSubscription:function(){return this._groupBasedSubscription;},isModerated:function(){return this._isModerated;},isMyselfAdministrator:function(){return session.uid===this._creatorUID&&!this.isTwoUserThread();},isMyselfModerator:function(){return this._isMyselfModerator;},unsubscribe:function(){},updateWindowState:function(params){this._folded='folded'in params?params.folded:this._folded;this._detached='detached'in params?params.detached:this._detached;this._warnUpdatedWindowState();},resetNeedactionCounter:function(){this._needactionCounter=0;},_getFetchMessagesKwargs:function(){var kwargs=this._super.apply(this,arguments);if(this.isModerated()){kwargs.moderated_channel_ids=[this.getID()];}
return kwargs;},_getThreadDomain:function(){return[['channel_ids','in',[this._id]]];},_isTypingMyselfInfo:function(params){return session.partner_id===params.partnerID;},_markAsRead:function(){var superDef=this._super.apply(this,arguments);var seenDef=this._notifySeen();return Promise.all([superDef,seenDef]);},_notifyMyselfTyping:function(params){return this._rpc({model:'mail.channel',method:'notify_typing',args:[this.getID()],kwargs:{is_typing:params.typing},},{shadow:true});},_notifySeen:function(){var self=this;return this._rpc({model:'mail.channel',method:'channel_seen',args:[[this._id]],},{shadow:true}).then(function(lastSeenMessageID){self._lastSeenMessageID=lastSeenMessageID;return lastSeenMessageID;});},_postMessage:function(data){var self=this;return this._super.apply(this,arguments).then(function(messageData){_.extend(messageData,{message_type:'comment',subtype:'mail.mt_comment',command:data.command,});return self._rpc({model:'mail.channel',method:data.command?'execute_command':'message_post',args:[self._id],kwargs:messageData,}).then(function(){return messageData;});});},_warnUpdatedTypingPartners:function(){this.call('mail_service','getMailBus').trigger('update_typing_partners',this.getID());},});return Channel;});;

/* /mail/static/src/js/models/threads/multi_user_channel.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.MultiUserChannel',function(require){"use strict";var Channel=require('mail.model.Channel');var MultiUserChannel=Channel.extend({init:function(params){this._super.apply(this,arguments);var data=params.data;this._isMassMailing=data.mass_mailing||false;this._type='multi_user_channel';this._public=data.public!=='private';},getTitle:function(){return"#"+this._super.apply(this,arguments);},isMassMailing:function(){return this._isMassMailing;},isPublic:function(){return this._public;},unsubscribe:function(){return this._rpc({model:'mail.channel',method:'action_unfollow',args:[[this.getID()]],});},});return MultiUserChannel;});;

/* /mail/static/src/js/models/threads/two_user_channel.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.TwoUserChannel',function(require){"use strict";var Channel=require('mail.model.Channel');var TwoUserChannel=Channel.extend({isTwoUserThread:function(){return true;},unsubscribe:function(){return this._rpc({model:'mail.channel',method:'channel_pin',args:[this.getUUID(),false],});},});return TwoUserChannel;});;

/* /mail/static/src/js/models/threads/create_mode_document_thread.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.CreateModeDocumentThread',function(require){"use strict";var AbstractMessage=require('mail.model.AbstractMessage');var AbstractThread=require('mail.model.AbstractThread');var core=require('web.core');var session=require('web.session');var _t=core._t;var CreateModeDocumentThread=AbstractThread.extend({init:function(){var params={data:{id:'_createModeDocumentThread'}};this._super(params);this._messages=this._forgeCreateMessages();},getMessages:function(){return this._messages;},_forgeCreateMessages:function(){var createMessage=new AbstractMessage(this,{id:0,body:_t("<p>Creating a new record...</p>"),author_id:[session.partner_id,session.partner_display_name],});return[createMessage];},});return CreateModeDocumentThread;});;

/* /mail/static/src/js/models/threads/dm_chat.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.DMChat',function(require){"use strict";var ChannelSeenMixin=require('mail.model.ChannelSeenMixin');var TwoUserChannel=require('mail.model.TwoUserChannel');var core=require('web.core');const{str_to_datetime}=require('web.time');var _t=core._t;var DMChat=TwoUserChannel.extend(ChannelSeenMixin,{init:function(params){this._super.apply(this,arguments);ChannelSeenMixin.init.apply(this,arguments);var data=params.data;this._directPartnerID=data.direct_partner[0].id;this._name=data.custom_channel_name||data.direct_partner[0].name;this._outOfOfficeMessage=data.direct_partner[0].out_of_office_message;this._outOfOfficeDateEnd=data.direct_partner[0].out_of_office_date_end;this._type='dm_chat';this.call('mail_service','updateImStatus',[{id:this._directPartnerID,im_status:data.direct_partner[0].im_status}]);},getDirectPartnerID:function(){return this._directPartnerID;},getOutOfOfficeInfo:function(){if(!this._outOfOfficeDateEnd){return undefined;}
var currentDate=new Date();var date=str_to_datetime(this._outOfOfficeDateEnd);var options={day:'numeric',month:'short'};if(currentDate.getFullYear()!==date.getFullYear()){options.year='numeric';}
var formattedDate=date.toLocaleDateString(window.navigator.language,options);return _.str.sprintf(_t("Out of office until %s"),formattedDate);},getOutOfOfficeMessage:function(){return this._outOfOfficeMessage;},getPreview:function(){var result=this._super.apply(this,arguments);result.imageSRC='/web/image/res.partner/'+this.getDirectPartnerID()+'/image_128';return result;},getStatus:function(){return this.call('mail_service','getImStatus',{partnerID:this._directPartnerID});},updateOutOfOfficeInfo:function(data){this._outOfOfficeMessage=data.outOfOfficeMessage;this._outOfOfficeDateEnd=data.outOfOfficeDateEnd;this.call('mail_service','getMailBus').trigger('updated_out_of_office',{threadID:this.getID(),});}});return DMChat;});;

/* /mail/static/src/js/models/threads/document_thread.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.DocumentThread',function(require){"use strict";var Thread=require('mail.model.Thread');var session=require('web.session');var DocumentThread=Thread.extend({init:function(params){var data=params.data;data.id=data.resModel+'_'+data.resID;data.type='document_thread';this._super.apply(this,arguments);this._documentID=data.resID;this._documentModel=data.resModel;this._messageIDs=data.messageIDs||[];this._messages=[];this._mustFetchMessageIDs=!_.isArray(data.messageIDs);},close:function(options){this._super.apply(this,arguments);if(options&&options.skipCrossTabSync){return;}
this.call('mail_service','updateDocumentThreadState',this._id,{name:this.getName(),windowState:'closed',});},detach:function(options){this._super.apply(this,arguments);if(options&&options.skipCrossTabSync){return;}
var windowState=this._folded?'folded':'open';this.call('mail_service','updateDocumentThreadState',this._id,{name:this.getName(),windowState:windowState,});},fetchMessages:function(options){var self=this;return this._fetchMessages(options).then(function(){return self._messages;});},fold:function(folded,options){this._super.apply(this,arguments);if(options&&options.skipCrossTabSync){return;}
var windowState=this._folded?'folded':'open';this.call('mail_service','updateDocumentThreadState',this._id,{name:this.getName(),windowState:windowState,});},getDocumentModel:function(){return this._documentModel;},getDocumentID:function(){return this._documentID;},getMessageIDs:function(){return this._messageIDs;},getMessages:function(){return this._messages;},isLinkedToDocument:function(){return true;},removeAttachmentsFromMessages:function(attachmentIDs){_.each(this.getMessages(),function(message){message.removeAttachments(attachmentIDs);});},setMessageIDs:function(messageIDs){this._mustFetchMessageIDs=false;this._messageIDs=messageIDs;},_addMessage:function(message){this._super.apply(this,arguments);if(_.contains(this._messages,message)){return;}
this._messages.push(message);this._messages=_.sortBy(this._messages,function(msg){return msg.getID();});if(!_.contains(this._messageIDs,message.getID())){this._messageIDs.push(message.getID());}
if(message.isNeedaction()){this._unreadCounter++;}},_fetchMessageIDs:function(){var self=this;var resID=this.getDocumentID();if(!resID||!this._mustFetchMessageIDs){return Promise.resolve();}
return this._rpc({model:this.getDocumentModel(),method:'read',args:[[resID],['message_ids']],}).then(function(result){self.setMessageIDs(result[0].message_ids);});},_fetchMessages:function(options){var self=this;return this._fetchMessageIDs().then(function(){var messageIDs=self._messageIDs;var loadedMessages=_.filter(self._messages,function(message){return _.contains(messageIDs,message.getID());});var loadedMessageIDs=_.map(loadedMessages,function(message){return message.getID();});options=options||{};var shouldFetch=_.difference(messageIDs.slice(0,self._FETCH_LIMIT),loadedMessageIDs).length>0;if(options.forceFetch||shouldFetch){var idsToLoad=_.difference(messageIDs,loadedMessageIDs).slice(0,self._FETCH_LIMIT);return self._rpc({model:'mail.message',method:'message_format',args:[idsToLoad],context:session.user_context,}).then(function(messagesData){_.each(messagesData,function(messageData){self.call('mail_service','addMessage',messageData,{silent:true});});});}else{return Promise.resolve();}});},_markAsRead:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.call('mail_service','markMessagesAsRead',self._messageIDs);});},_postMessage:function(data){var self=this;var resModel=this.getDocumentModel();var resID=this.getDocumentID();return this._super.apply(this,arguments).then(function(messageData){_.extend(messageData,{context:data.context,message_type:data.message_type,subtype:data.subtype||"mail.mt_comment",subtype_id:data.subtype_id,});return self._rpc({model:resModel,method:'message_post',args:[resID],kwargs:messageData,}).then(function(messageID){return self._rpc({model:'mail.message',method:'message_format',args:[[messageID]],}).then(function(messages){messages[0].model=resModel;messages[0].res_id=resID;self.call('mail_service','addMessage',messages[0],{postedFromDocumentThread:true,});return messages[0];});});});},});return DocumentThread;});;

/* /mail/static/src/js/models/threads/livechat.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.Livechat',function(require){"use strict";var TwoUserChannel=require('mail.model.TwoUserChannel');var Livechat=TwoUserChannel.extend({_WEBSITE_USER_ID:'_websiteUser',_WEBSITE_USER_NAME:'Website user',init:function(params){this._super.apply(this,arguments);this._name=params.data.correspondent_name;this._WEBSITE_USER_NAME=this._name;},getMentionPartnerSuggestions:function(){var self=this;return this._super.apply(this,arguments).then(function(){var websiteUser=_.findWhere(self._members,{id:self._WEBSITE_USER_ID});if(!websiteUser){self._members.push({id:self._WEBSITE_USER_ID,name:self._WEBSITE_USER_NAME,});}
return[self._members];});},registerTyping:function(params){params.partnerID=this._WEBSITE_USER_ID;this._super.call(this,params);},unregisterTyping:function(params){params.partnerID=this._WEBSITE_USER_ID;this._super.call(this,params);},});return Livechat;});;

/* /mail/static/src/js/models/threads/mailbox.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.Mailbox',function(require){"use strict";var SearchableThread=require('mail.model.SearchableThread');var core=require('web.core');var _t=core._t;var Mailbox=SearchableThread.extend({init:function(params){var data=params.data;data.id='mailbox_'+data.id;data.type='mailbox';this._super.apply(this,arguments);this._mailboxCounter=data.mailboxCounter||0;},decrementMailboxCounter:function(num){num=_.isNumber(num)?num:1;this._mailboxCounter=Math.max(this._mailboxCounter-num,0);},getMailboxCounter:function(){return this._mailboxCounter;},getMessagePreviews:function(){var self=this;return this.fetchMessages().then(function(messages){var items=[];_.each(messages,function(message){var unreadCounter=1;var messageIDs=[message.getID()];var similarItem=_.find(items,function(item){return self._areMessagesFromSameDocumentThread(item.message,message)||self._areMessagesFromSameChannel(item.message,message);});if(similarItem){unreadCounter=similarItem.unreadCounter+1;messageIDs=similarItem.messageIDs.concat(messageIDs);var index=_.findIndex(items,similarItem);items[index]={unreadCounter:unreadCounter,message:message,messageIDs:messageIDs};}else{items.push({unreadCounter:unreadCounter,message:message,messageIDs:messageIDs,});}});return _.map(items,function(item){return _.extend(item.message.getPreview(),{unreadCounter:item.unreadCounter,messageIDs:item.messageIDs,});});});},incrementMailboxCounter:function(num){num=_.isNumber(num)?num:1;this._mailboxCounter=Math.max(this._mailboxCounter+num,0);},markAllMessagesAsRead:function(domain){if(this._id==='mailbox_inbox'&&this.getMailboxCounter()>0){return this._rpc({model:'mail.message',method:'mark_all_as_read',kwargs:{domain:domain,},});}
return Promise.resolve();},setMailboxCounter(newCounter){this._mailboxCounter=newCounter;},_areMessagesFromSameChannel:function(message1,message2){return message1.originatesFromChannel()&&message2.originatesFromChannel()&&message1.getOriginChannelID()===message2.getOriginChannelID();},_areMessagesFromSameDocumentThread:function(message1,message2){return message1.isLinkedToDocumentThread()&&message2.isLinkedToDocumentThread()&&message1.getDocumentModel()===message2.getDocumentModel()&&message1.getDocumentID()===message2.getDocumentID();},_getThreadDomain:function(){if(this._id==='mailbox_inbox'){return[['needaction','=',true]];}else if(this._id==='mailbox_starred'){return[['starred','=',true]];}else if(this._id==='mailbox_history'){return[['needaction','=',false]];}else if(this._id==='mailbox_moderation'){return[['need_moderation','=',true]];}else{throw(_.str(_t("Missing domain for mailbox with ID '%s'"),this._id));}},_postMessage:function(messageData,options){var documentThread=this.call('mail_service','getDocumentThread',options.documentModel,options.documentID);return documentThread.postMessage(messageData);},});return Mailbox;});;

/* /mail/static/src/js/models/threads/searchable_thread.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.SearchableThread',function(require){"use strict";var Thread=require('mail.model.Thread');var session=require('web.session');var SearchableThread=Thread.extend({init:function(params){this._super.apply(this,arguments);this._cache={'[]':{allHistoryLoaded:false,loaded:false,messages:[],}};this._lastSeenMessageID=params.data.seen_message_id;},fetchMessages:function(domain,loadMore){if(loadMore){return this._fetchMessages(domain,true);}
var cache=this._getCache(domain);if(cache.loaded){return Promise.all(cache.messages);}else{return this._fetchMessages(domain);}},getLastSeenMessageID:function(){return this._lastSeenMessageID||null;},getMessages:function(options){options=options||{};var domain=options.domain||[];return this._getCache(domain).messages;},hasMessages:function(options){options=options||{};var domain=options.domain||[];return!_.isEmpty(this.getMessages({domain:domain}));},invalidateCaches:function(){this._cache=_.pick(this._cache,'[]');},isAllHistoryLoaded:function(domain){return this._getCache(domain).allHistoryLoaded;},removeMessage:function(messageID){_.each(this._cache,function(cache){cache.messages=_.reject(cache.messages,function(message){return message.getID()===messageID;});});},setLastSeenMessageID:function(messageID){this._lastSeenMessageID=messageID;},_addMessage:function(message,options){options=options||{};this._super.apply(this,arguments);var cache=this._getCache(options.domain||[]);var index=_.sortedIndex(cache.messages,message,function(msg){return msg.getID();});if(cache.messages[index]!==message){cache.messages.splice(index,0,message);}
if(!message.isMyselfAuthor()&&options.incrementUnread&&message.getType()!=='notification'){this._incrementUnreadCounter();}},_fetchMessages:function(pDomain,loadMore){var self=this;var domain=this._getThreadDomain();var cache=this._getCache(pDomain);if(pDomain){domain=domain.concat(pDomain||[]);}
if(loadMore){var minMessageID=cache.messages[0].getID();domain=[['id','<',minMessageID]].concat(domain);}
return this._rpc({model:'mail.message',method:'message_fetch',args:[domain],kwargs:this._getFetchMessagesKwargs(),}).then(function(messages){if(!cache.allHistoryLoaded){cache.allHistoryLoaded=messages.length<self._FETCH_LIMIT;}
cache.loaded=true;_.each(messages,function(message){self.call('mail_service','addMessage',message,{silent:true,domain:pDomain,});});cache=self._getCache(pDomain||[]);return cache.messages;});},_getCache:function(domain){var stringifiedDomain=JSON.stringify(domain||[]);if(!this._cache[stringifiedDomain]){this._cache[stringifiedDomain]={allHistoryLoaded:false,loaded:false,messages:[],};}
return this._cache[stringifiedDomain];},_getFetchMessagesKwargs:function(){return{limit:this._FETCH_LIMIT,context:session.user_context};},_getThreadDomain:function(){},});return SearchableThread;});;

/* /mail/static/src/js/models/threads/thread.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.Thread',function(require){"use strict";var emojis=require('mail.emojis');var AbstractThread=require('mail.model.AbstractThread');var mailUtils=require('mail.utils');var ServicesMixin=require('web.ServicesMixin');var Thread=AbstractThread.extend(ServicesMixin,{_FETCH_LIMIT:30,init:function(params){this._super.apply(this,arguments);this._detached=false;this._previewed=false;this._type=params.data.type||params.data.channel_type;},close:function(){this._detached=false;this._folded=false;this._warnUpdatedWindowState();},detach:function(options){options=options||{};this._detached=true;this._folded=options.keepFoldState?this._folded:false;return this._warnUpdatedWindowState({passively:options.passively,});},fetchMessages:function(){return Promise.resolve([]);},fold:function(folded){this._super.apply(this,arguments);this._detached=true;this._warnUpdatedWindowState();},getCommands:function(){return[];},getMentionPartnerSuggestions:function(){return Promise.resolve([]);},getPreview:function(){return{id:this.getID(),imageSRC:'/mail/static/src/img/smiley/avatar.jpg',isTwoUserThread:this.isTwoUserThread(),status:this.getStatus(),title:this.getName(),unreadCounter:this.getUnreadCounter(),};},getType:function(){return this._type;},hasBeenPreviewed:function(){return this._previewed;},hasUnreadMessages:function(){return this._unreadCounter!==0;},incrementNeedactionCounter:function(){},isAutoswitch:function(){return false;},isChannel:function(){return false;},isDetached:function(){return this._detached;},isLinkedToDocument:function(){return false;},isMassMailing:function(){return false;},isModerated:function(){return false;},isMyselfModerator:function(){return false;},isTwoUserThread:function(){return false;},markAsPreviewed:function(){this._previewed=true;},setName:function(newName){this._name=newName;},_fetchMessages:function(){return Promise.resolve();},_generateEmojis:function(htmlString){_.each(emojis,function(emoji){_.each(emoji.sources,function(source){var escapedSource=String(source).replace(/([.*+?=^!:${}()|[\]/\\])/g,'\\$1');var regexp=new RegExp("(\\s|^)("+escapedSource+")(?=\\s|$)",'g');htmlString=htmlString.replace(regexp,'$1'+emoji.unicode);});});return htmlString;},_incrementUnreadCounter:function(){this._super.apply(this,arguments);this._warnUpdatedUnreadCounter();},_postMessage:function(data){var body=mailUtils.parseAndTransform(_.str.trim(data.content),mailUtils.addLink);body=this._generateEmojis(body);var messageData={partner_ids:data.partner_ids,channel_ids:data.channel_ids,body:body,attachment_ids:data.attachment_ids,canned_response_ids:data.canned_response_ids,};if('subject'in data){messageData.subject=data.subject;}
return this._super.apply(this,arguments).then(function(){return messageData;});},_warnUpdatedUnreadCounter:function(){this.call('mail_service','getMailBus').trigger('update_thread_unread_counter',this);},_warnUpdatedWindowState:function(options){options=options||{};return this.call('mail_service','updateThreadWindow',this.getID(),options);},});return Thread;});;

/* /mail/static/src/js/models/threads/mixins/channel_seen_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.ChannelSeenMixin',function(require){"use strict";var session=require('web.session');var ChannelSeenMixin={init:function(params){this._seenPartnersInfo=params.data.seen_partners_info||[];this.on('message_added',this,this._onSeenMessageAdded);},getFetchedNotSeenMembers:function(message){var otherPartnersInfo=_.filter(this._seenPartnersInfo,function(info){return info.partner_id!==session.partner_id;});var seenPartnersInfo=_.filter(otherPartnersInfo,function(info){return info.seen_message_id&&info.seen_message_id>=message.getID();});var seenPartnerIDs=_.map(seenPartnersInfo,function(info){return info.partner_id;});var fetchedPartnersInfo=_.filter(otherPartnersInfo,function(info){var lastFetchedID=info.fetched_message_id||info.seen_message_id||0;return lastFetchedID>=message.getID();});var fetchedPartnerIDs=_.map(fetchedPartnersInfo,function(info){return info.partner_id;});fetchedPartnerIDs=_.reject(fetchedPartnerIDs,function(fetchedPartnerID){return _.contains(seenPartnerIDs,fetchedPartnerID);});var fetchedMembers=_.filter(this._members,function(member){return _.contains(fetchedPartnerIDs,member.id);});return fetchedMembers;},getLastMessageIDSeenByEveryone:function(){var otherPartnersInfo=_.filter(this._seenPartnersInfo,function(info){return info.partner_id!==session.partner_id;});var seenMessageIDs=_.map(otherPartnersInfo,function(info){return info.seen_message_id||0;});if(_.isEmpty(seenMessageIDs)){return 0;}
return _.min(seenMessageIDs);},getSeenMembers:function(message){var otherPartnersInfo=_.filter(this._seenPartnersInfo,function(info){return info.partner_id!==session.partner_id;});var seenPartnersInfo=_.filter(otherPartnersInfo,function(info){return info.seen_message_id>=message.getID();});var seenPartnerIDs=_.map(seenPartnersInfo,function(info){return info.partner_id;});var seenMembers=_.filter(this._members,function(member){return _.contains(seenPartnerIDs,member.id);});return seenMembers;},hasEveryoneFetched:function(message){var otherPartnersInfo=_.filter(this._seenPartnersInfo,function(info){return info.partner_id!==session.partner_id;});var lastFetchedMessageIDs=_.map(otherPartnersInfo,function(info){return info.fetched_message_id||info.seen_message_id||0;});if(_.isEmpty(lastFetchedMessageIDs)){return 0;}
return message.getID()<=_.min(lastFetchedMessageIDs);},hasEveryoneSeen:function(message){var otherPartnersInfo=_.filter(this._seenPartnersInfo,function(info){return info.partner_id!==session.partner_id;});var lastSeenMessageIDs=_.map(otherPartnersInfo,function(info){return info.seen_message_id||0;});if(_.isEmpty(lastSeenMessageIDs)){return 0;}
return message.getID()<=_.min(lastSeenMessageIDs);},hasSomeoneFetched:function(message){var otherPartnersInfo=_.filter(this._seenPartnersInfo,function(info){return info.partner_id!==session.partner_id;});var lastFetchedMessageIDs=_.map(otherPartnersInfo,function(info){return info.fetched_message_id||info.seen_message_id||0;});if(_.isEmpty(lastFetchedMessageIDs)){return false;}
var fetched=_.find(lastFetchedMessageIDs,function(msgID){return msgID>=message.getID();});return fetched;},hasSomeoneSeen:function(message){var otherPartnersInfo=_.filter(this._seenPartnersInfo,function(info){return info.partner_id!==session.partner_id;});var lastSeenMessageIDs=_.map(otherPartnersInfo,function(info){return info.seen_message_id||0;});if(_.isEmpty(lastSeenMessageIDs)){return false;}
var seen=_.find(lastSeenMessageIDs,function(msgID){return msgID>=message.getID();});return seen;},hasSeenFeature:function(){return true;},updateSeenPartnersInfo:function(data){var seenInfo=_.findWhere(this._seenPartnersInfo,{partner_id:data.partner_id});if(!seenInfo){seenInfo={partner_id:data.partner_id,seen_message_id:0,fetched_message_id:0,};this._seenPartnersInfo.push(seenInfo);}
if(data.info==='channel_fetched'){seenInfo.fetched_message_id=data.last_message_id;}else if(data.info==='channel_seen'){seenInfo.fetched_message_id=data.last_message_id;seenInfo.seen_message_id=data.last_message_id;}
this.call('mail_service','getMailBus').trigger('update_channel',this.getID());},_onSeenMessageAdded:function(){this.call('mail_service','notifyChannelFetched',{channelID:this._id});},};return ChannelSeenMixin;});;

/* /mail/static/src/js/models/threads/mixins/thread_typing_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.ThreadTypingMixin',function(require){"use strict";var CCThrottleFunction=require('mail.model.CCThrottleFunction');var Timer=require('mail.model.Timer');var Timers=require('mail.model.Timers');var core=require('web.core');var _t=core._t;var ThreadTypingMixin={_DEFAULT_TYPING_PARTNER_ID:'_default',_DEFAULT_TYPING_PARTNER_NAME:'Someone',init:function(){this._lastNotifiedMyselfTyping=false;this._myselfLongTypingTimer=new Timer({duration:50*1000,onTimeout:this._onMyselfLongTypingTimeout.bind(this),});this._myselfTypingInactivityTimer=new Timer({duration:5*1000,onTimeout:this._onMyselfTypingInactivityTimeout.bind(this),});this._othersTypingTimers=new Timers({duration:60*1000,onTimeout:this._onOthersTypingTimeout.bind(this),});this._throttleNotifyMyselfTyping=CCThrottleFunction({duration:2.5*1000,func:this._onNotifyMyselfTyping.bind(this),});this._typingPartnerIDs=[];this.on('message_added',this,this._onTypingMessageAdded);this.on('message_posted',this,this._onTypingMessagePosted);},getTypingMembersToText:function(){var typingPartnerIDs=this._typingPartnerIDs;var typingMembers=_.filter(this._members,function(member){return _.contains(typingPartnerIDs,member.id);});var sortedTypingMembers=_.sortBy(typingMembers,function(member){return _.indexOf(typingPartnerIDs,member.id);});var displayableTypingMembers=sortedTypingMembers.slice(0,3);if(displayableTypingMembers.length===0){return'';}else if(displayableTypingMembers.length===1){return _.str.sprintf(_t("%s is typing..."),displayableTypingMembers[0].name);}else if(displayableTypingMembers.length===2){return _.str.sprintf(_t("%s and %s are typing..."),displayableTypingMembers[0].name,displayableTypingMembers[1].name);}else{return _.str.sprintf(_t("%s, %s and more are typing..."),displayableTypingMembers[0].name,displayableTypingMembers[1].name);}},hasTypingNotification:function(){return true;},isSomeoneTyping:function(){return!(_.isEmpty(this._typingPartnerIDs));},registerTyping:function(params){if(this._isTypingMyselfInfo(params)){return;}
var partnerID=params.partnerID;this._othersTypingTimers.registerTimer({timeoutCallbackArguments:[partnerID],timerID:partnerID,});if(_.contains(this._typingPartnerIDs,partnerID)){return;}
this._typingPartnerIDs.push(partnerID);this._warnUpdatedTypingPartners();},setMyselfTyping:function(params){var typing=params.typing;if(this._lastNotifiedMyselfTyping===typing){this._throttleNotifyMyselfTyping.cancel();}else{this._throttleNotifyMyselfTyping(params);}
if(typing){this._myselfTypingInactivityTimer.reset();}else{this._myselfTypingInactivityTimer.clear();}},unregisterTyping:function(params){var partnerID=params.partnerID;this._othersTypingTimers.unregisterTimer({timerID:partnerID});if(!_.contains(this._typingPartnerIDs,partnerID)){return;}
this._typingPartnerIDs=_.reject(this._typingPartnerIDs,function(id){return id===partnerID;});this._warnUpdatedTypingPartners();},_isTypingMyselfInfo:function(params){return false;},_notifyMyselfTyping:function(params){return Promise.resolve();},_warnUpdatedTypingPartners:function(){},_onMyselfLongTypingTimeout:function(){this._throttleNotifyMyselfTyping.clear();this._throttleNotifyMyselfTyping({typing:true});},_onMyselfTypingInactivityTimeout:function(){this._throttleNotifyMyselfTyping.clear();this._throttleNotifyMyselfTyping({typing:false});},_onNotifyMyselfTyping:function(params){var typing=params.typing;this._lastNotifiedMyselfTyping=typing;this._notifyMyselfTyping(params);if(typing){this._myselfLongTypingTimer.reset();}else{this._myselfLongTypingTimer.clear();}},_onOthersTypingTimeout:function(partnerID){this.unregisterTyping({partnerID:partnerID});},_onTypingMessageAdded:function(message){var partnerID=message.hasAuthor()?message.getAuthorID():this._DEFAULT_TYPING_PARTNER_ID;this.unregisterTyping({partnerID:partnerID});},_onTypingMessagePosted:function(){this._lastNotifiedMyselfTyping=false;this._throttleNotifyMyselfTyping.clear();this._myselfLongTypingTimer.clear();this._myselfTypingInactivityTimer.clear();},};return ThreadTypingMixin;});;

/* /mail/static/src/js/models/utils/timer.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.Timer',function(require){"use strict";var Class=require('web.Class');var Timer=Class.extend({init:function(params){this._duration=params.duration;this._timeout=undefined;this._timeoutCallback=params.onTimeout;},clear:function(){clearTimeout(this._timeout);},reset:function(){this.clear();this.start();},start:function(){this._timeout=setTimeout(this._onTimeout.bind(this),this._duration);},_onTimeout:function(){this._timeoutCallback();},});return Timer;});;

/* /mail/static/src/js/models/utils/timers.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.Timers',function(require){"use strict";var Timer=require('mail.model.Timer');var Class=require('web.Class');var Timers=Class.extend({init:function(params){this._duration=params.duration;this._timeoutCallback=params.onTimeout;this._timers={};},registerTimer:function(params){var timerID=params.timerID;if(this._timers[timerID]){this._timers[timerID].clear();}
var timerParams={duration:this._duration,onTimeout:this._timeoutCallback,};if('timeoutCallbackArguments'in params){timerParams.onTimeout=this._timeoutCallback.bind.apply(this._timeoutCallback,[null].concat(params.timeoutCallbackArguments));}else{timerParams.onTimeout=this._timeoutCallback;}
this._timers[timerID]=new Timer(timerParams);this._timers[timerID].start();},unregisterTimer:function(params){var timerID=params.timerID;if(this._timers[timerID]){this._timers[timerID].clear();delete this._timers[timerID];}},});return Timers;});;

/* /mail/static/src/js/models/utils/cc_throttle_function.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.CCThrottleFunctionObject',function(require){"use strict";var Class=require('web.Class');var CCThrottleFunctionObject=Class.extend({init:function(params){this._arguments=undefined;this._cooldownTimeout=undefined;this._duration=params.duration;this._func=params.func;this._shouldCallFunctionAfterCD=false;},cancel:function(){this._arguments=undefined;this._shouldCallFunctionAfterCD=false;},clear:function(){if(this._cooldownTimeout){clearTimeout(this._cooldownTimeout);this._onCooldownTimeout();}},do:function(){this._arguments=Array.prototype.slice.call(arguments);if(this._cooldownTimeout===undefined){this._callFunction();}else{this._shouldCallFunctionAfterCD=true;}},_callFunction:function(){this._func.apply(null,this._arguments);this._cooldown();},_cooldown:function(){this.cancel();this._cooldownTimeout=setTimeout(this._onCooldownTimeout.bind(this),this._duration);},_onCooldownTimeout:function(){if(this._shouldCallFunctionAfterCD){this._callFunction();}else{this._cooldownTimeout=undefined;}},});return CCThrottleFunctionObject;});odoo.define('mail.model.CCThrottleFunction',function(require){"use strict";var CCThrottleFunctionObject=require('mail.model.CCThrottleFunctionObject');var CCThrottleFunction=function(params){var duration=params.duration;var func=params.func;var throttleFunctionObject=new CCThrottleFunctionObject({duration:duration,func:func,});var callable=function(){return throttleFunctionObject.do.apply(throttleFunctionObject,arguments);};callable.cancel=function(){throttleFunctionObject.cancel();};callable.clear=function(){throttleFunctionObject.clear();};return callable;};return CCThrottleFunction;});;

/* /mail/static/src/js/thread_windows/abstract_thread_window.js defined in bundle 'web.assets_backend' */
odoo.define('mail.AbstractThreadWindow',function(require){"use strict";var ThreadWidget=require('mail.widget.Thread');var config=require('web.config');var core=require('web.core');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var AbstractThreadWindow=Widget.extend({template:'mail.AbstractThreadWindow',custom_events:{escape_pressed:'_onEscapePressed',document_viewer_closed:'_onDocumentViewerClose',},events:{'click .o_thread_window_close':'_onClickClose','click .o_thread_window_title':'_onClickFold','click .o_composer_text_field':'_onComposerClick','click .o_mail_thread':'_onThreadWindowClicked','keydown .o_composer_text_field':'_onKeydown','keypress .o_composer_text_field':'_onKeypress',},FOLD_ANIMATION_DURATION:200,HEIGHT_OPEN:'400px',HEIGHT_FOLDED:'34px',init:function(parent,thread,options){this._super(parent);this.options=_.defaults(options||{},{autofocus:true,displayStars:true,displayReplyIcons:false,displayEmailIcons:false,placeholder:_t("Say something"),});this._hidden=false;this._thread=thread||null;this._debouncedOnScroll=_.debounce(this._onScroll.bind(this),100);if(!this.hasThread()){this._folded=false;}},start:function(){var self=this;this.$input=this.$('.o_composer_text_field');this.$header=this.$('.o_thread_window_header');var options={displayMarkAsRead:false,displayStars:this.options.displayStars,};if(this._thread&&this._thread._type==='document_thread'){options.displayDocumentLinks=false;}
this._threadWidget=new ThreadWidget(this,options);this.$el.css({transition:'height '+this.FOLD_ANIMATION_DURATION+'ms linear'});if(this.isFolded()){this.$el.css('height',this.HEIGHT_FOLDED);}else if(this.options.autofocus){this._focusInput();}
if(!config.device.isMobile){var margin_dir=_t.database.parameters.direction==="rtl"?"margin-left":"margin-right";this.$el.css(margin_dir,$.position.scrollbarWidth());}
var def=this._threadWidget.replace(this.$('.o_thread_window_content')).then(function(){self._threadWidget.$el.on('scroll',self,self._debouncedOnScroll);});return Promise.all([this._super(),def]);},do_hide:function(){this._hidden=true;this._super.apply(this,arguments);},do_show:function(){this._hidden=false;this._super.apply(this,arguments);},do_toggle:function(display){this._hidden=_.isBoolean(display)?!display:!this._hidden;this._super.apply(this,arguments);},close:function(){},getID:function(){return this._getThreadID();},getThread:function(){if(!this.hasThread){return undefined;}
return this._thread;},getOutOfOfficeInfo:function(){if(!this.hasThread()){return undefined;}
return this._thread.getOutOfOfficeInfo();},getOutOfOfficeMessage:function(){if(!this.hasThread()){return undefined;}
return this._thread.getOutOfOfficeMessage();},getThreadStatus:function(){if(!this.hasThread()){return undefined;}
return this._thread.getStatus();},getTitle:function(){if(!this.hasThread()){return _t("Undefined");}
return this._thread.getTitle();},getUnreadCounter:function(){if(!this.hasThread()){return 0;}
return this._thread.getUnreadCounter();},hasThread:function(){return!!this._thread;},isAtBottom:function(){return this._threadWidget.isAtBottom();},isFolded:function(){if(!this.hasThread()){return this._folded;}
return this._thread.isFolded();},isMobile:function(){return config.device.isMobile;},isHidden:function(){return this._hidden;},needsComposer:function(){return this.hasThread();},render:function(){this.renderHeader();if(this.hasThread()){this._threadWidget.render(this._thread,{displayLoadMore:false});}},renderHeader:function(){var options=this._getHeaderRenderingOptions();this.$header.html(QWeb.render('mail.AbstractThreadWindow.HeaderContent',options));},scrollToBottom:function(){this._threadWidget.scrollToBottom();},toggleFold:function(folded){if(!_.isBoolean(folded)){folded=!this.isFolded();}
this._updateThreadFoldState(folded);},updateVisualFoldState:function(){if(!this.isFolded()){this._threadWidget.scrollToBottom();if(this.options.autofocus){this._focusInput();}}
var height=this.isFolded()?this.HEIGHT_FOLDED:this.HEIGHT_OPEN;this.$el.css({height:height});},_focusInput:function(){if(config.device.touch&&config.device.size_class<=config.device.SIZES.SM){return;}
this.$input.focus();},_getHeaderRenderingOptions:function(){return{status:this.getThreadStatus(),thread:this.getThread(),title:this.getTitle(),unreadCounter:this.getUnreadCounter(),widget:this,};},_getThreadID:function(){if(!this.hasThread()){return'_blank';}
return this._thread.getID();},_hasFocus:function(){return this.$input.is(':focus');},_postMessage:function(messageData){var self=this;if(!this.hasThread()){return;}
this._thread.postMessage(messageData).then(function(){self._threadWidget.scrollToBottom();});},_updateThreadFoldState:function(folded){if(this.hasThread()){this._thread.fold(folded);}else{this._folded=folded;this.updateVisualFoldState();}},_onClickClose:function(ev){ev.stopPropagation();ev.preventDefault();if(this.hasThread()&&this._thread.getUnreadCounter()>0&&!this.isFolded()){this._thread.markAsRead();}
this.close();},_onClickFold:function(){if(!config.device.isMobile){this.toggleFold();}},_onComposerClick:function(ev){if($(ev.target).closest('a, button').length){return;}
this._focusInput();},_onDocumentViewerClose:function(){this._focusInput();},_onEscapePressed:function(){if(!this.isFolded()){this.close();}},_onKeydown:function(ev){ev.stopPropagation();if(ev.which===13){var content=_.str.trim(this.$input.val());var messageData={content:content,attachment_ids:[],partner_ids:[],};this.$input.val('');if(content){this._postMessage(messageData);}}},_onKeypress:function(ev){ev.stopPropagation();},_onScroll:function(){if(this.hasThread()&&this.isAtBottom()){this._thread.markAsRead();}},_onThreadWindowClicked:function(){var selectObj=window.getSelection();if(selectObj.anchorOffset===selectObj.focusOffset){this.$input.focus();}},});return AbstractThreadWindow;});;

/* /mail/static/src/js/thread_windows/thread_window.js defined in bundle 'web.assets_backend' */
odoo.define('mail.ThreadWindow',function(require){"use strict";var AbstractThreadWindow=require('mail.AbstractThreadWindow');var BasicComposer=require('mail.composer.Basic');var ExtendedComposer=require('mail.composer.Extended');var config=require('web.config');var core=require('web.core');var QWeb=core.qweb;var _t=core._t;var ThreadWindow=AbstractThreadWindow.extend({template:'mail.ThreadWindow',custom_events:AbstractThreadWindow.prototype.custom_events,events:_.extend({},AbstractThreadWindow.prototype.events,{'click .o_mail_thread':'_onThreadWindowFocus','click .o_thread_composer':'_onThreadWindowFocus','click .o_thread_window_expand':'_onClickExpand','click .o_out_of_office_read_more_less_button':'_onClickOutOfOfficeReadMoreLess',}),init:function(parent,thread,options){this._super.apply(this,arguments);this._passive=this.options.passively||false;if(!this.hasThread()){this.directPartnerID=null;}},start:function(){var self=this;var superDef=this._super().then(this._listenThreadWidget.bind(this));this.call('mail_service','getMailBus').on('update_typing_partners',this,this._onUpdateTypingPartners).on('update_channel',this,this._onUpdateChannel);var composerDef;if(!this.hasThread()){this._startWithoutThread();}else if(this.needsComposer()){var composer;var composerParams={mentionPartnersRestricted:this._thread.getType()!=='document_thread',thread:this._thread,};if(config.device.isMobile&&this._thread.isMassMailing()){composer=new ExtendedComposer(this,composerParams);}else{composer=new BasicComposer(this,_.extend({isMini:true},composerParams));}
composer.on('post_message',this,this._postMessage);composer.once('input_focused',this,function(){var commands=this._thread.getCommands();var partners=this._thread.getMentionPartnerSuggestions();composer.mentionSetCommands(commands);composer.mentionSetPrefetchedPartners(partners);});composerDef=composer.replace(this.$('.o_thread_composer'));composerDef.then(function(){self.$input=self.$('.o_composer_text_field');});}
this._updateOutOfOfficeReadMoreLessButton();return Promise.all([superDef,composerDef]);},close:function(){if(this.hasThread()){this._thread.close();}else{this.trigger_up('close_blank_thread_window');}},focusInput:function(){this._focusInput();},getTitle:function(){if(!this.hasThread()){return _t("New message");}
return this._super.apply(this,arguments);},isPassive:function(){return this._passive;},removePassive:function(){this._passive=false;},renderOutOfOffice:function(){var $outOfOffice=this.$('.o_out_of_office');if(!this.getOutOfOfficeInfo()&&!this.getOutOfOfficeMessage()){if($outOfOffice.length){$outOfOffice.remove();}
return;}
var $newOutOfOffice=$(QWeb.render('mail.thread_window.OutOfOffice',{widget:this,}));if($outOfOffice.length){$outOfOffice.replaceWith($newOutOfOffice);}else{$newOutOfOffice.insertAfter(this.$('.o_thread_window_header'));}},update:function(options){var self=this;if(options.passively&&!this._hasFocus()){this._setPassive();}
var bottomVisible=!this.isFolded()&&!this.isHidden()&&this.isAtBottom();if(bottomVisible&&!this.isPassive()){this._thread.markAsRead();}
this._thread.fetchMessages().then(function(){self.render();if(bottomVisible&&options.keepBottom){self.scrollToBottom();}});},_getHeaderRenderingOptions:function(){var options=this._super.apply(this,arguments);if(this._thread.getType()==='document_thread'){options.expandTitle=_t("Open document");}else{options.expandTitle=_t("Open in Discuss");}
return options;},_listenThreadWidget:function(){this._threadWidget.on('redirect',this,this._onRedirect).on('redirect_to_channel',this,this._onRedirectToChannel).on('toggle_star_status',this,this._onToggleStarStatus);},_open:function(channelID){this.call('mail_service','openThreadWindow',channelID||this.getID());},_setPassive:function(){this._passive=true;},_startWithoutThread:function(){var self=this;this.$el.addClass('o_thread_less');this.$('.o_thread_search_input input').autocomplete({autoFocus:true,source:function(request,response){self.call('mail_service','searchPartner',request.term,10).then(response);},select:function(event,ui){var partnerID=ui.item.id;self.directPartnerID=partnerID;self.call('mail_service','openDMChatWindowFromBlankThreadWindow',partnerID);},}).focus();},_updateOutOfOfficeReadMoreLessButton:function(){var $readMore=this.$('.o_out_of_office_text');var isOverflowing=$readMore.prop('scrollWidth')>$readMore.width();var isOverflowShown=!$readMore.hasClass('o_text_wrap');if(isOverflowing||isOverflowShown){var $button=this.$('.o_out_of_office_read_more_less_button');$button.show();$button.text(isOverflowing?_t('Read more'):_t('Read less'));}},_onClickExpand:_.debounce(function(ev){var self=this;ev.preventDefault();if(this.hasThread()&&this._thread.getType()==='document_thread'){this.do_action({type:'ir.actions.act_window',res_model:this._thread.getDocumentModel(),views:[[false,'form']],res_id:this._thread.getDocumentID(),});}else{this.do_action('mail.action_discuss',{clear_breadcrumbs:false,active_id:this.hasThread()?this._getThreadID():undefined,on_reverse_breadcrumb:function(){var mailBus=self.call('mail_service','getMailBus');if(mailBus){mailBus.trigger('discuss_open',false);}},});}},1000,true),_onClickOutOfOfficeReadMoreLess:function(ev){ev.preventDefault();this.$('.o_out_of_office_text').toggleClass('o_text_wrap');this._updateOutOfOfficeReadMoreLessButton();},_onKeydown:function(ev){ev.stopPropagation();},_onRedirect:function(resModel,resID){var callback=this._open.bind(this);this.call('mail_service','redirect',resModel,resID,callback);},_onRedirectToChannel:function(channelID){var self=this;var thread=this.call('mail_service','getThread',channelID);if(!thread){this.call('mail_service','joinChannel',channelID).then(function(channelID){var channel=self.call('mail_service','getThread',channelID);channel.detach();});}else{this.toggleFold(false);}},_onScroll:function(){if(this.isPassive()){return;}
return this._super.apply(this,arguments);},_onThreadWindowFocus:function(){if(this.isPassive()){this.removePassive();this._thread.markAsRead();}},_onToggleStarStatus:function(messageID){var message=this.call('mail_service','getMessage',messageID);message.toggleStarStatus();},_onUpdateTypingPartners:function(threadID){if(!this.hasThread()){return;}
if(this._thread.getID()!==threadID){return;}
this.renderHeader();},_onUpdateChannel:function(channelID){if(!this.hasThread()){return;}
if(this._thread.getID()!==channelID){return;}
this.render();},});return ThreadWindow;});;

/* /mail/static/src/js/discuss.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Discuss',function(require){"use strict";var BasicComposer=require('mail.composer.Basic');var ExtendedComposer=require('mail.composer.Extended');var ThreadWidget=require('mail.widget.Thread');var AbstractAction=require('web.AbstractAction');var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var dom=require('web.dom');var QWeb=core.qweb;var _t=core._t;var PartnerInviteDialog=Dialog.extend({dialog_title:_t("Invite people"),template:'mail.PartnerInviteDialog',init:function(parent,title,channelID){this._channelID=channelID;this._super(parent,{title:title,size:'medium',buttons:[{text:_t("Invite"),close:true,classes:'btn-primary',click:this._addChannel.bind(this),}],});},start:function(){var self=this;this.$input=this.$('.o_mail_discuss_partner_invite_input');this.$input.select2({width:'100%',allowClear:true,multiple:true,formatResult:function(item){var status=QWeb.render('mail.UserStatus',{status:self.call('mail_service','getImStatus',{partnerID:item.id}),partnerID:item.id,});return $('<span>').text(item.text).prepend(status);},query:function(query){self.call('mail_service','searchPartner',query.term,20).then(function(partners){query.callback({results:_.map(partners,function(partner){return _.extend(partner,{text:partner.label});}),});});}});return this._super.apply(this,arguments);},_addChannel:function(){var self=this;var data=this.$input.select2('data');if(data.length>=1){return this._rpc({model:'mail.channel',method:'channel_invite',args:[this._channelID],kwargs:{partner_ids:_.pluck(data,'id')},}).then(function(){var names=_.escape(_.pluck(data,'text').join(', '));var notification=_.str.sprintf(_t("You added <b>%s</b> to the conversation."),names);self.do_notify(_t("New people"),notification);var channel=self.call('mail_service','getChannel',self._channelID);channel.forceFetchMembers();});}},});var RenameConversationDialog=Dialog.extend({dialog_title:_t("Rename conversation"),template:'mail.RenameConversationDialog',init:function(parent,channelID,callback){this._channelID=channelID;this._callback=callback;this._super(parent,{title:_t('Rename conversation'),size:'medium',buttons:[{text:_t("Rename"),close:true,classes:'btn-primary o_mail_conversation_rename',click:this._rename.bind(this),},{text:_t("Discard"),close:true,}],});},start:function(){var channel=this.call('mail_service','getChannel',this._channelID);this.$('input').val(channel.getName());return this._super.apply(this,arguments);},_rename:function(){var self=this;var name=this.$('input').val();return this._rpc({model:'mail.channel',method:'channel_set_custom_name',args:[this._channelID],kwargs:{name:name,}}).then(function(){var channel=self.call('mail_service','getThread',self._channelID);channel.setName(name);self._callback();});},});var ModeratorRejectMessageDialog=Dialog.extend({template:'mail.ModeratorRejectMessageDialog',init:function(parent,params){this._messageIDs=params.messageIDs;this._proceedReject=params.proceedReject;this._super(parent,{title:_t("Send explanation to author"),size:'medium',buttons:[{text:_t("Send"),close:true,classes:'btn-primary',click:_.bind(this._onSendClicked,this),}],});},_onSendClicked:function(){var title=this.$('#message_title').val();var comment=this.$('#reject_message').val();if(title&&comment){this._proceedReject({title:title,comment:comment});}},});var Discuss=AbstractAction.extend({contentTemplate:'mail.discuss',custom_events:_.extend({},AbstractAction.prototype.custom_events,{discard_extended_composer:'_onDiscardExtendedComposer',message_moderation:'_onMessageModeration',search:'_onSearch',update_moderation_buttons:'_onUpdateModerationButtons',}),events:{'click .o_mail_sidebar_title .o_add':'_onAddThread','blur .o_mail_add_thread input':'_onAddThreadBlur','click .o_mail_channel_settings':'_onChannelSettingsClicked','click .o_mail_discuss_item':'_onDiscussItemClicked','keydown':'_onKeydown','click .o_mail_open_channels':'_onPublicChannelsClick','click .o_mail_partner_unpin':'_onUnpinChannel','input .o_discuss_sidebar_quick_search input':'_onInputSidebarQuickSearchInput',},hasControlPanel:true,loadControlPanel:true,withSearchBar:true,searchMenuTypes:['filter','favorite'],init:function(parent,action,options){this._super.apply(this,arguments);this.action=action;this.context=action.context;this.action_manager=parent;this.domain=[];this.options=options||{};if(!('channelQuickSearchThreshold'in this.options)){this.options.channelQuickSearchThreshold=20;}
this._isMessagingReady=this.call('mail_service','isReady');this._isStarted=false;this._threadsScrolltop={};this._composerStates={};this._defaultThreadID=this.options.active_id||this.action.context.active_id||this.action.params.default_active_id||'mailbox_inbox';this._selectedMessage=null;this._throttledUpdateThreads=_.throttle(this._updateThreads.bind(this),100,{leading:false});this.controlPanelParams.modelName='mail.message';this.call('mail_service','getMailBus').on('messaging_ready',this,this._onMessagingReady);},start:function(){var self=this;this._isStarted=true;return this._super.apply(this,arguments).then(function(){if(!self._isMessagingReady){return;}
return self._initRender();});},do_show:function(){this._super.apply(this,arguments);this._updateControlPanel();this.action_manager.do_push_state({action:this.action.id,active_id:this._thread.getID(),});},destroy:function(){if(this.$buttons){this.$buttons.off().remove();}
this._super.apply(this,arguments);},on_attach_callback:function(){this.call('mail_service','getMailBus').trigger('discuss_open',true);if(this._thread){this._threadWidget.scrollToPosition(this._threadsScrolltop[this._thread.getID()]);this._loadEnoughMessages();}},on_detach_callback:function(){this.call('mail_service','getMailBus').trigger('discuss_open',false);this._threadsScrolltop[this._thread.getID()]=this._threadWidget.getScrolltop();},_askConfirmationAdminUnsubscribe:function(channel){Dialog.confirm(this,_t("You are the administrator of this channel. Are you sure you want to unsubscribe?"),{buttons:[{text:_t("Unsubscribe"),classes:'btn-primary',close:true,click:function(){channel.unsubscribe();}},{text:_t("Discard"),close:true,}]});},_banAuthorsFromMessageIDs:function(messageIDs){var self=this;var emailList=_.map(messageIDs,function(messageID){return self.call('mail_service','getMessage',messageID).getEmailFrom();}).join(", ");var text=_.str.sprintf(_t("You are going to ban: %s. Do you confirm the action?"),emailList);var options={confirm_callback:function(){self._moderateMessages(messageIDs,'ban');}};Dialog.confirm(this,text,options);},_discardMessages:function(messageIDs){var self=this;var num=messageIDs.length;var text;if(num>1){text=_.str.sprintf(_t("You are going to discard %s messages. Do you confirm the action?"),num);}else if(num===1){text=_t("You are going to discard 1 message. Do you confirm the action?");}
var options={confirm_callback:function(){self._moderateMessages(messageIDs,'discard');}};Dialog.confirm(this,text,options);},_fetchAndRenderThread:function(){var self=this;return this._thread.fetchMessages(this.domain).then(function(){self._threadWidget.render(self._thread,self._getThreadRenderingOptions());self._updateButtonStatus(!self._thread.hasMessages());return self._loadEnoughMessages();});},_getThreadRenderingOptions:function(){if(_.isUndefined(this.messagesSeparatorPosition)){if(!this._unreadCounter){this.messagesSeparatorPosition=false;}else{var messageID=this._thread.getLastSeenMessageID();this.messagesSeparatorPosition=messageID||'top';}}
var hasThreadMessages=this._thread.hasMessages({domain:this.domain});return{displayLoadMore:!this._thread.isAllHistoryLoaded(this.domain),displayMarkAsRead:this._thread.getID()==='mailbox_inbox',domain:this.domain,messagesSeparatorPosition:this.messagesSeparatorPosition,squashCloseMessages:this._thread.getType()!=='mailbox'&&!this._thread.isMassMailing(),displayEmptyThread:!hasThreadMessages&&!this.domain.length,displayNoMatchFound:!hasThreadMessages&&!!this.domain.length,displaySubjectOnMessages:this._thread.isMassMailing()||this._thread.getID()==='mailbox_inbox'||this._thread.getID()==='mailbox_moderation',displayEmailIcons:false,displayReplyIcons:true,displayBottomThreadFreeSpace:true,displayModerationCommands:true,};},_handleModerationDecision:function(messageIDs,decision){if(messageIDs){if(decision==='reject'){this._rejectMessages(messageIDs);}else if(decision==='discard'){this._discardMessages(messageIDs);}else if(decision==='ban'){this._banAuthorsFromMessageIDs(messageIDs);}else{this._moderateMessages(messageIDs,decision);}}},_initRender:function(){var self=this;this.$('.o_mail_discuss_loading').remove();this._basicComposer=new BasicComposer(this,{mentionPartnersRestricted:true,showTyping:true,});this._extendedComposer=new ExtendedComposer(this,{mentionPartnersRestricted:true,showTyping:true,});this._basicComposer.on('post_message',this,this._onPostMessage).on('input_focused',this,this._onComposerFocused);this._extendedComposer.on('post_message',this,this._onPostMessage).on('input_focused',this,this._onComposerFocused);this._renderButtons();var defs=[];defs.push(this._renderThread());defs.push(this._basicComposer.appendTo(this.$('.o_mail_discuss_content')));defs.push(this._extendedComposer.appendTo(this.$('.o_mail_discuss_content')));return Promise.all(defs).then(function(){return self._setThread(self._defaultThreadID);}).then(function(){self._initThreads();self._startListening();self._threadWidget.$el.on('scroll',null,_.debounce(function(){if(self._threadWidget.getScrolltop()<20&&!self._threadWidget.$('.o_mail_no_content').length&&!self._thread.isAllHistoryLoaded(self.domain)){self._loadMoreMessages();}
if(self._threadWidget.isAtBottom()&&self._thread.getType()!=='mailbox'){self._thread.markAsRead();}},100));});},_initThreads:function(){var self=this;var $sidebar=this._renderSidebar();this.$('.o_mail_discuss_sidebar').html($sidebar.contents());_.each(['dm_chat','multi_user_channel'],function(type){var $input=self.$('.o_mail_add_thread[data-type='+type+'] input');self._prepareAddThreadInput($input,type);});},_loadEnoughMessages:function(){var loadMoreMessages=this._threadWidget.el.clientHeight&&(this._threadWidget.el.clientHeight===this._threadWidget.el.scrollHeight)&&!this._thread.isAllHistoryLoaded(this.domain);if(loadMoreMessages){return this._loadMoreMessages().then(this._loadEnoughMessages.bind(this));}},_loadMoreMessages:function(){var self=this;var oldestMessageID=this.$('.o_thread_message').first().data('messageId');var oldestMessageSelector='.o_thread_message[data-message-id="'+oldestMessageID+'"]';var offset=-dom.getPosition(document.querySelector(oldestMessageSelector)).top;return this._thread.fetchMessages(this.domain,true).then(function(){if(self.messagesSeparatorPosition==='top'){self.messagesSeparatorPosition=undefined;}
self._threadWidget.render(self._thread,self._getThreadRenderingOptions());offset+=dom.getPosition(document.querySelector(oldestMessageSelector)).top;self._threadWidget.scrollToPosition(offset);});},_moderateMessages:function(messageIDs,decision,kwargs){if(messageIDs.length&&decision){return this._rpc({model:'mail.message',method:'moderate',args:[messageIDs,decision],kwargs:kwargs});}},_prepareAddThreadInput:function($input,type){var self=this;if(type==='multi_user_channel'){$input.autocomplete({autoFocus:true,classes:{'ui-autocomplete':'o_mail_channel'},source:function(request,response){self._lastSearchVal=request.term;self._searchChannel(self._lastSearchVal).then(function(result){result.push({label:_.str.sprintf('<strong>'+_t("Create %s (Public)")+'</strong>','<em>"#'+_.escape(self._lastSearchVal)+'"</em>'),value:self._lastSearchVal,special:'public',},{label:_.str.sprintf('<strong>'+_t("Create %s (Private)")+'</strong>','<em>"#'+_.escape(self._lastSearchVal)+'"</em>'),value:self._lastSearchVal,special:'private',});response(result);});},select:function(ev,ui){if(self._lastSearchVal){if(ui.item.special){if(ui.item.special==='public'){self.call('mail_service','createChannel',self._lastSearchVal,'groups');}else{self.call('mail_service','createChannel',self._lastSearchVal,'private');}}else{self.call('mail_service','joinChannel',ui.item.id);}}},focus:function(ev){ev.preventDefault();},html:true,});}else if(type==='dm_chat'){$input.autocomplete({autoFocus:true,source:function(request,response){self._lastSearchVal=request.term;self.call('mail_service','searchPartner',_.escape(self._lastSearchVal),10).then(response);},select:function(ev,ui){var partnerID=ui.item.id;var dmChat=self.call('mail_service','getDMChatFromPartnerID',partnerID);if(dmChat){self._setThread(dmChat.getID());}else{self.call('mail_service','createChannel',partnerID,'dm_chat');}
$(this).val('');return false;},focus:function(ev){ev.preventDefault();},});}},_rejectMessages:function(messageIDs){var self=this;new ModeratorRejectMessageDialog(this,{messageIDs:messageIDs,proceedReject:function(reason){self._moderateMessages(messageIDs,'reject',reason);}}).open();},_renderButtons:function(){this.$buttons=$(QWeb.render('mail.discuss.ControlButtons',{debug:config.isDebug()}));this.$buttons.find('button').css({display:'inline-block'});this.$buttons.on('click','.o_mail_discuss_button_invite',this._onInviteButtonClicked.bind(this)).on('click','.o_mail_discuss_button_mark_all_read',this._onMarkAllAsReadClicked.bind(this)).on('click','.o_mail_discuss_button_unstar_all',this._onUnstarAllClicked.bind(this)).on('click','.o_mail_discuss_button_moderate_all',this._onModerateAllClicked.bind(this)).on('click','.o_mail_discuss_button_select_all',this._onSelectAllClicked.bind(this)).on('click','.o_mail_discuss_button_unselect_all',this._onUnselectAllClicked.bind(this));},_renderSidebar:function(){var channels=this.call('mail_service','getChannels');channels=this._sortChannels(channels);var $sidebar=$(QWeb.render('mail.discuss.Sidebar',{activeThreadID:this._thread?this._thread.getID():undefined,inbox:this.call('mail_service','getMailbox','inbox'),starred:this.call('mail_service','getMailbox','starred'),moderation:this.call('mail_service','getMailbox','moderation'),channels:channels,isMyselfModerator:this.call('mail_service','isMyselfModerator'),displayQuickSearch:channels.length>=this.options.channelQuickSearchThreshold,options:this.options,}));return $sidebar;},_renderSidebarChannels:function(options){options.searchChannelVal=options.searchChannelVal||'';var channels=this.call('mail_service','getChannels');var searchChannelValLowerCase=options.searchChannelVal.toLowerCase();channels=_.filter(channels,function(channel){var channelNameLowerCase=channel.getName().toLowerCase();return channelNameLowerCase.indexOf(searchChannelValLowerCase)!==-1;});channels=this._sortChannels(channels);this.$('.o_mail_discuss_sidebar_channels').html(QWeb.render('mail.discuss.SidebarChannels',{activeThreadID:this._thread?this._thread.getID():undefined,channels:channels,displayQuickSearch:channels.length>=this.options.channelQuickSearchThreshold,}));},_renderSidebarMailboxes:function(){this.$('.o_mail_discuss_sidebar_mailboxes').html(QWeb.render('mail.discuss.SidebarMailboxes',{activeThreadID:this._thread?this._thread.getID():undefined,inbox:this.call('mail_service','getMailbox','inbox'),starred:this.call('mail_service','getMailbox','starred'),moderation:this.call('mail_service','getMailbox','moderation'),isMyselfModerator:this.call('mail_service','isMyselfModerator'),}));},_renderSnackbar:function(template,context,timeout){if(this.$snackbar){this.$snackbar.remove();}
timeout=timeout||20000;this.$snackbar=$(QWeb.render(template,context));this.$('.o_mail_discuss_content').append(this.$snackbar);var $snackbar=this.$snackbar;setTimeout(function(){$snackbar.fadeOut();},timeout);},_renderThread:function(){this._threadWidget=new ThreadWidget(this,{loadMoreOnScroll:true});this._threadWidget.on('redirect',this,function(resModel,resID){this.call('mail_service','redirect',resModel,resID,this._setThread.bind(this));}).on('redirect_to_channel',this,function(channelID){this.call('mail_service','joinChannel',channelID).then(this._setThread.bind(this));}).on('load_more_messages',this,this._loadMoreMessages).on('mark_as_read',this,function(messageID){this.call('mail_service','markMessagesAsRead',[messageID]);}).on('toggle_star_status',this,function(messageID){var message=this.call('mail_service','getMessage',messageID);message.toggleStarStatus();}).on('select_message',this,this._selectMessage).on('unselect_message',this,this._unselectMessage);return this._threadWidget.appendTo(this.$('.o_mail_discuss_content'));},_restoreComposerState:function(channel){var composer=channel.isMassMailing()?this._extendedComposer:this._basicComposer;var composerState=this._composerStates[channel.getUUID()];if(composerState){composer.setState(composerState);}},_restoreThreadState:function(){var $newMessagesSeparator=this.$('.o_thread_new_messages_separator');if($newMessagesSeparator.length){this._threadWidget.$el.scrollTo($newMessagesSeparator);}else{var newThreadScrolltop=this._threadsScrolltop[this._thread.getID()];this._threadWidget.scrollToPosition(newThreadScrolltop);}
if(this._thread.getType()!=='mailbox'){this._restoreComposerState(this._thread);}},_searchChannel:function(searchVal){return this._rpc({model:'mail.channel',method:'channel_search_to_join',args:[searchVal]}).then(function(result){var values=[];_.each(result,function(channel){var escapedName=_.escape(channel.name);values.push(_.extend(channel,{'value':escapedName,'label':escapedName,}));});return values;});},_selectMessage:function(messageID){this.$el.addClass('o_mail_selection_mode');var message=this.call('mail_service','getMessage',messageID);this._selectedMessage=message;var subject="Re: "+message.getDocumentName();this._extendedComposer.setSubject(subject);this._extendedComposer.showDiscardButton();if(this._thread.getType()!=='mailbox'){this._basicComposer.do_hide();}
this._extendedComposer.do_show();this._threadWidget.scrollToMessage({messageID:messageID,duration:200,onlyIfNecessary:true});this._extendedComposer.focus('body');},_setThread:function(threadID){var self=this;this._storeThreadState();this._thread=this.call('mail_service','getThread',threadID)||this.call('mail_service','getMailbox','inbox');this.messagesSeparatorPosition=undefined;this._unreadCounter=this._thread.getUnreadCounter();if(this.$snackbar){this.$snackbar.remove();}
this.action.context.active_id=this._thread.getID();this.action.context.active_ids=[this._thread.getID()];this._basicComposer.setThread(this._thread);this._extendedComposer.setThread(this._thread);return this._fetchAndRenderThread().then(function(){if(self._thread.getType()!=='mailbox'){self._thread.markAsRead();}
self._restoreThreadState();self._setTitle('#'+self._thread.getName());self._updateControlPanel();self._updateControlPanelButtons(self._thread);self._unselectMessage();self.action_manager.do_push_state({action:self.action.id,active_id:self._thread.getID(),});});},_sortChannels:function(channels){return channels;},_startListening:function(){this.call('mail_service','getMailBus').on('open_thread_in_discuss',this,this._onOpenThreadInDiscuss).on('new_message',this,this._onNewMessage).on('update_message',this,this._onMessageUpdated).on('new_channel',this,this._onNewChannel).on('is_thread_bottom_visible',this,this._onIsThreadBottomVisible).on('unsubscribe_from_channel',this,this._onChannelLeft).on('updated_im_status',this,this._onUpdatedImStatus).on('update_needaction',this,this._onUpdateNeedaction).on('update_starred',this,this._onUpdateStarred).on('update_thread_unread_counter',this,this._onUpdateThreadUnreadCounter).on('activity_updated',this,this._onActivityUpdated).on('update_moderation_counter',this,this._onUpdateModerationCounter).on('update_typing_partners',this,this._onTypingPartnersUpdated).on('update_channel',this,this._onUpdateChannel);},_storeComposerState:function(channel){var composer=channel.isMassMailing()?this._extendedComposer:this._basicComposer;this._composerStates[channel.getUUID()]=composer.getState();composer.clearComposer();},_storeThreadState:function(){if(this._thread){this._threadsScrolltop[this._thread.getID()]=this._threadWidget.getScrolltop();if(this._thread.getType()!=='mailbox'){this._storeComposerState(this._thread);}}},_unselectMessage:function(){this._basicComposer.do_toggle(this._thread.getType()!=='mailbox'&&!this._thread.isMassMailing());this._extendedComposer.do_toggle(this._thread.isMassMailing());this._extendedComposer.hideDiscardButton();if(!config.device.isMobile){var composer=this._thread.getType()!=='mailbox'&&this._thread.isMassMailing()?this._extendedComposer:this._basicComposer;composer.focus();}
this.$el.removeClass('o_mail_selection_mode');this._threadWidget.unselectMessage();this._selectedMessage=null;},_updateButtonStatus:function(disabled,type){if(this._thread.getID()==='mailbox_inbox'){this.$buttons.find('.o_mail_discuss_button_mark_all_read').toggleClass('disabled',disabled);if(disabled&&type==='mark_as_read'){this.trigger_up('show_effect',{message:_t("Congratulations, your inbox is empty!"),type:'rainbow_man',});}}
if(this._thread.getID()==='mailbox_starred'){this.$buttons.find('.o_mail_discuss_button_unstar_all').toggleClass('disabled',disabled);}
if(this._thread.getID()==='mailbox_moderation'||(this._thread.isModerated()&&this._thread.isMyselfModerator())){this._updateModerationButtons();}},_updateControlPanel:function(){this.updateControlPanel({cp_content:{$buttons:this.$buttons,},});},_updateControlPanelButtons:function(thread){if(thread.getType()!=='dm_chat'&&thread.getType()!=='mailbox'){this.$buttons.find('.o_mail_discuss_button_invite, .o_mail_discuss_button_settings').removeClass('d-none d-md-inline-block').addClass('d-none d-md-inline-block');}else{this.$buttons.find('.o_mail_discuss_button_invite, .o_mail_discuss_button_settings').removeClass('d-none d-md-inline-block').addClass('d-none');}
if(thread.getID()==='mailbox_inbox'){this.$buttons.find('.o_mail_discuss_button_mark_all_read').removeClass('d-none d-md-inline-block').addClass('d-none d-md-inline-block');}else{this.$buttons.find('.o_mail_discuss_button_mark_all_read').removeClass('d-none d-md-inline-block').addClass('d-none');}
if(thread.getID()==='mailbox_starred'){this.$buttons.find('.o_mail_discuss_button_unstar_all').removeClass('d-none');}else{this.$buttons.find('.o_mail_discuss_button_unstar_all').addClass('d-none');}
if((thread.isModerated()&&thread.isMyselfModerator())||thread.getID()==='mailbox_moderation'){this.$buttons.find('.o_mail_discuss_button_select_all').removeClass('d-none');this.$buttons.find('.o_mail_discuss_button_unselect_all').removeClass('d-none');}else{this.$buttons.find('.o_mail_discuss_button_select_all').addClass('d-none');this.$buttons.find('.o_mail_discuss_button_unselect_all').addClass('d-none');}
this.$buttons.find('.o_mail_discuss_button_moderate_all').addClass('d-none');this.$('.o_mail_discuss_item').removeClass('o_active').filter('[data-thread-id='+thread.getID()+']').removeClass('o_unread_message').addClass('o_active');},_updateModerationButtons:function(){this._updateSelectUnselectAllButtons();this._updateModerationDecisionButton();},_updateModerationDecisionButton:function(){if(this._threadWidget.$('.moderation_checkbox:checked').length){this.$buttons.find('.o_mail_discuss_button_moderate_all').removeClass('d-none');}else{this.$buttons.find('.o_mail_discuss_button_moderate_all').addClass('d-none');}},_updateSelectUnselectAllButtons:function(){var buttonSelect=this.$buttons.find('.o_mail_discuss_button_select_all');var buttonUnselect=this.$buttons.find('.o_mail_discuss_button_unselect_all');var numCheckboxes=this._threadWidget.$('.moderation_checkbox').length;var numCheckboxesChecked=this._threadWidget.$('.moderation_checkbox:checked').length;if(numCheckboxes){if(numCheckboxesChecked===numCheckboxes){buttonSelect.toggleClass('disabled',true);buttonUnselect.toggleClass('disabled',false);}else if(numCheckboxesChecked===0){buttonSelect.toggleClass('disabled',false);buttonUnselect.toggleClass('disabled',true);}else{buttonSelect.toggleClass('disabled',false);buttonUnselect.toggleClass('disabled',false);}}else{buttonSelect.toggleClass('disabled',true);buttonUnselect.toggleClass('disabled',true);}},_updateThreads:function(options){var self=this;options=options||{};this._renderSidebarMailboxes(options);this._renderSidebarChannels(options);_.each(['dm_chat','multi_user_channel'],function(type){var $input=self.$('.o_mail_add_thread[data-type='+type+'] input');self._prepareAddThreadInput($input,type);});},_onActivityUpdated:function(){this._throttledUpdateThreads();},_onAddThread:function(ev){ev.preventDefault();var type=$(ev.target).data('type');this.$('.o_mail_add_thread[data-type='+type+']').show().find('input').focus();},_onAddThreadBlur:function(){this.$('.o_mail_add_thread').hide();},_onChannelLeft:function(channelID){if(this._thread.getID()===channelID){this._setThread('mailbox_inbox');}
this._updateThreads();delete this._threadsScrolltop[channelID];},_onChannelSettingsClicked:function(ev){ev.stopPropagation();var threadID=$(ev.currentTarget).data('thread-id');var thread=this.call('mail_service','getThread',threadID);if(thread.getType()==='dm_chat'){new RenameConversationDialog(this,threadID,this._updateThreads.bind(this)).open();return;}
this.do_action({type:'ir.actions.act_window',res_model:'mail.channel',res_id:threadID,views:[[false,'form']],target:'current'});},_onComposerFocused:function(){var composer=this._thread.isMassMailing()?this._extendedComposer:this._basicComposer;var commands=this._thread.getCommands();var partners=this._thread.getMentionPartnerSuggestions();composer.mentionSetCommands(commands);composer.mentionSetPrefetchedPartners(partners);},_onDiscardExtendedComposer:function(ev){ev.stopPropagation();this._unselectMessage();},_onDiscussItemClicked:function(ev){ev.preventDefault();var threadID=$(ev.currentTarget).data('thread-id');this._setThread(threadID);},_onInputSidebarQuickSearchInput:function(ev){ev.preventDefault();this._updateThreads({searchChannelVal:$(ev.currentTarget).val(),});},_onInviteButtonClicked:function(){var title=_.str.sprintf(_t("Invite people to #%s"),_.escape(this._thread.getName()));new PartnerInviteDialog(this,title,this._thread.getID()).open();},_onIsThreadBottomVisible:function(thread,query){query.isVisible=query.isVisible||(thread.getID()===this._thread.getID()&&this._threadWidget.isAtBottom());},_onKeydown:function(ev){if(ev.which===$.ui.keyCode.ESCAPE&&this._selectedMessage){this._unselectMessage();}},_onMarkAllAsReadClicked:function(){this._thread.markAllMessagesAsRead(this.domain);},_onMessageModeration:function(ev){var messageIDs=[ev.data.messageID];var decision=ev.data.decision;this._handleModerationDecision(messageIDs,decision);},_onMessageUpdated:function(message,type){var self=this;var currentThreadID=this._thread.getID();if((currentThreadID==='mailbox_starred'&&!message.isStarred())||(currentThreadID==='mailbox_inbox'&&!message.isNeedaction())||(currentThreadID==='mailbox_moderation'&&!message.needsModeration())){this._thread.fetchMessages(this.domain).then(function(){var options=self._getThreadRenderingOptions();self._threadWidget.removeMessageAndRender(message.getID(),self._thread,options).then(function(){self._updateButtonStatus(!self._thread.hasMessages(),type);});});}else if(_.contains(message.getThreadIDs(),currentThreadID)){this._fetchAndRenderThread();}},_onMessagingReady:function(){if(this._isMessagingReady){return;}
this._isMessagingReady=true;if(!this._isStarted){return;}
this._initRender();},_onModerateAllClicked:function(ev){var decision=$(ev.target).data('decision');var messageIDs=this._threadWidget.$('.moderation_checkbox:checked').map(function(){return $(this).data('message-id');}).get();this._handleModerationDecision(messageIDs,decision);},_onNewChannel:function(channel){this._updateThreads();if(channel.isAutoswitch()){this._setThread(channel.getID());}},_onNewMessage:function(message){var self=this;if(_.contains(message.getThreadIDs(),this._thread.getID())){if(this._thread.getType()!=='mailbox'&&this._threadWidget.isAtBottom()){this._thread.markAsRead();}
var shouldScroll=this._threadWidget.isAtBottom();this._fetchAndRenderThread().then(function(){if(shouldScroll){self._threadWidget.scrollToMessage({msgID:message.getID()});}});}
this._updateThreads();this._threadsScrolltop=_.omit(this._threadsScrolltop,message.getThreadIDs());},_onOpenThreadInDiscuss:function(thread){if(thread.getType()!=='document_thread'){this._setThread(thread.getID());}},_onPostMessage:function(messageData){var self=this;var options={};if(this._selectedMessage){messageData.subtype=this._selectedMessage.isNote()?'mail.mt_note':'mail.mt_comment';messageData.subtype_id=false;messageData.message_type='comment';options.documentID=this._selectedMessage.getDocumentID();options.documentModel=this._selectedMessage.getDocumentModel();}
this._thread.postMessage(messageData,options).then(function(){if(self._selectedMessage){self._renderSnackbar('mail.discuss.MessageSentSnackbar',{documentName:self._selectedMessage.getDocumentName()},5000);self._unselectMessage();}else{self._threadWidget.scrollToBottom();}});},_onPublicChannelsClick:function(){this.do_action({name:_t("Public Channels"),type:'ir.actions.act_window',res_model:'mail.channel',views:[[false,'kanban'],[false,'form']],domain:[['public','!=','private']],},{on_reverse_breadcrumb:this.on_reverse_breadcrumb,});},_onSearch:function(ev){ev.stopPropagation();this.domain=ev.data.domain;if(this._thread){this._fetchAndRenderThread();}},_onSelectAllClicked:function(ev){var $button=$(ev.target);if(!$button.hasClass('disabled')){this._threadWidget.toggleModerationCheckboxes(true);this._updateModerationButtons();}},_onTypingPartnersUpdated:function(){this._updateThreads();},_onUnpinChannel:function(ev){ev.stopPropagation();var channelID=$(ev.target).data('thread-id');var channel=this.call('mail_service','getChannel',channelID);if(channel.isMyselfAdministrator()){this._askConfirmationAdminUnsubscribe(channel);}else{channel.unsubscribe();}},_onUnselectAllClicked:function(ev){var $button=$(ev.target);if(!$button.hasClass('disabled')){this._threadWidget.toggleModerationCheckboxes(false);this._updateModerationButtons();}},_onUnstarAllClicked:function(){this.call('mail_service','unstarAll');},_onUpdateChannel:function(channelID){if(this._thread.getID()!==channelID){return;}
this._fetchAndRenderThread();},_onUpdatedImStatus:function(){this._throttledUpdateThreads();},_onUpdateModerationButtons:function(){this._updateModerationButtons();},_onUpdateModerationCounter:function(){this._throttledUpdateThreads();},_onUpdateNeedaction:function(){this._throttledUpdateThreads();},_onUpdateStarred:function(){this._throttledUpdateThreads();},_onUpdateThreadUnreadCounter:function(){this._throttledUpdateThreads();},});core.action_registry.add('mail.discuss',Discuss);return Discuss;});;

/* /mail/static/src/js/document_viewer.js defined in bundle 'web.assets_backend' */
odoo.define('mail.DocumentViewer',function(require){"use strict";var core=require('web.core');var Widget=require('web.Widget');var QWeb=core.qweb;var SCROLL_ZOOM_STEP=0.1;var ZOOM_STEP=0.5;var DocumentViewer=Widget.extend({template:"DocumentViewer",events:{'click .o_download_btn':'_onDownload','click .o_viewer_img':'_onImageClicked','click .o_viewer_video':'_onVideoClicked','click .move_next':'_onNext','click .move_previous':'_onPrevious','click .o_rotate':'_onRotate','click .o_zoom_in':'_onZoomIn','click .o_zoom_out':'_onZoomOut','click .o_zoom_reset':'_onZoomReset','click .o_close_btn, .o_viewer_img_wrapper':'_onClose','click .o_print_btn':'_onPrint','DOMMouseScroll .o_viewer_content':'_onScroll','mousewheel .o_viewer_content':'_onScroll','keydown':'_onKeydown','keyup':'_onKeyUp','mousedown .o_viewer_img':'_onStartDrag','mousemove .o_viewer_content':'_onDrag','mouseup .o_viewer_content':'_onEndDrag'},init:function(parent,attachments,activeAttachmentID){this._super.apply(this,arguments);this.attachment=_.filter(attachments,function(attachment){var match=attachment.type==='url'?attachment.url.match("(youtu|.png|.jpg|.gif)"):attachment.mimetype.match("(image|video|application/pdf|text)");if(match){attachment.fileType=match[1];if(match[1].match("(.png|.jpg|.gif)")){attachment.fileType='image';}
if(match[1]==='youtu'){var youtube_array=attachment.url.split('/');var youtube_token=youtube_array[youtube_array.length-1];if(youtube_token.indexOf('watch')!==-1){youtube_token=youtube_token.split('v=')[1];var amp=youtube_token.indexOf('&')
if(amp!==-1){youtube_token=youtube_token.substring(0,amp);}}
attachment.youtube=youtube_token;}
return true;}});this.activeAttachment=_.findWhere(attachments,{id:activeAttachmentID});this.modelName='ir.attachment';this._reset();},start:function(){this.$el.modal('show');this.$el.on('hidden.bs.modal',_.bind(this._onDestroy,this));this.$('.o_viewer_img').on("load",_.bind(this._onImageLoaded,this));this.$('[data-toggle="tooltip"]').tooltip({delay:0});return this._super.apply(this,arguments);},destroy:function(){if(this.isDestroyed()){return;}
this.trigger_up('document_viewer_closed');this.$el.modal('hide');this.$el.remove();this._super.apply(this,arguments);},_next:function(){var index=_.findIndex(this.attachment,this.activeAttachment);index=(index+1)%this.attachment.length;this.activeAttachment=this.attachment[index];this._updateContent();},_previous:function(){var index=_.findIndex(this.attachment,this.activeAttachment);index=index===0?this.attachment.length-1:index-1;this.activeAttachment=this.attachment[index];this._updateContent();},_reset:function(){this.scale=1;this.dragStartX=this.dragstopX=0;this.dragStartY=this.dragstopY=0;},_updateContent:function(){this.$('.o_viewer_content').html(QWeb.render('DocumentViewer.Content',{widget:this}));this.$('.o_viewer_img').on("load",_.bind(this._onImageLoaded,this));this.$('[data-toggle="tooltip"]').tooltip({delay:0});this._reset();},_getTransform:function(scale,angle){return'scale3d('+scale+', '+scale+', 1) rotate('+angle+'deg)';},_rotate:function(angle){this._reset();var new_angle=(this.angle||0)+angle;this.$('.o_viewer_img').css('transform',this._getTransform(this.scale,new_angle));this.$('.o_viewer_img').css('max-width',new_angle%180!==0?$(document).height():'100%');this.$('.o_viewer_img').css('max-height',new_angle%180!==0?$(document).width():'100%');this.angle=new_angle;},_zoom:function(scale){if(scale>0.5){this.$('.o_viewer_img').css('transform',this._getTransform(scale,this.angle||0));this.scale=scale;}
this.$('.o_zoom_reset').add('.o_zoom_out').toggleClass('disabled',scale===1);},_onClose:function(e){e.preventDefault();this.destroy();},_onDestroy:function(){this.destroy();},_onDownload:function(e){e.preventDefault();window.location='/web/content/'+this.modelName+'/'+this.activeAttachment.id+'/'+'datas'+'?download=true';},_onDrag:function(e){e.preventDefault();if(this.enableDrag){var $image=this.$('.o_viewer_img');var $zoomer=this.$('.o_viewer_zoomer');var top=$image.prop('offsetHeight')*this.scale>$zoomer.height()?e.clientY-this.dragStartY:0;var left=$image.prop('offsetWidth')*this.scale>$zoomer.width()?e.clientX-this.dragStartX:0;$zoomer.css("transform","translate3d("+left+"px, "+top+"px, 0)");$image.css('cursor','move');}},_onEndDrag:function(e){e.preventDefault();if(this.enableDrag){this.enableDrag=false;this.dragstopX=e.clientX-this.dragStartX;this.dragstopY=e.clientY-this.dragStartY;this.$('.o_viewer_img').css('cursor','');}},_onImageClicked:function(e){e.stopPropagation();},_onImageLoaded:function(){this.$('.o_loading_img').hide();},_onKeydown:function(e){switch(e.which){case $.ui.keyCode.RIGHT:e.preventDefault();this._next();break;case $.ui.keyCode.LEFT:e.preventDefault();this._previous();break;}},_onKeyUp:function(e){switch(e.which){case $.ui.keyCode.ESCAPE:e.preventDefault();this._onClose(e);break;}},_onNext:function(e){e.preventDefault();this._next();},_onPrevious:function(e){e.preventDefault();this._previous();},_onPrint:function(e){e.preventDefault();var src=this.$('.o_viewer_img').prop('src');var script=QWeb.render('PrintImage',{src:src});var printWindow=window.open('about:blank',"_new");printWindow.document.open();printWindow.document.write(script);printWindow.document.close();},_onScroll:function(e){var scale;if(e.originalEvent.wheelDelta>0||e.originalEvent.detail<0){scale=this.scale+SCROLL_ZOOM_STEP;this._zoom(scale);}else{scale=this.scale-SCROLL_ZOOM_STEP;this._zoom(scale);}},_onStartDrag:function(e){e.preventDefault();this.enableDrag=true;this.dragStartX=e.clientX-(this.dragstopX||0);this.dragStartY=e.clientY-(this.dragstopY||0);},_onVideoClicked:function(e){e.stopPropagation();var videoElement=e.target;if(videoElement.paused){videoElement.play();}else{videoElement.pause();}},_onRotate:function(e){e.preventDefault();this._rotate(90);},_onZoomIn:function(e){e.preventDefault();var scale=this.scale+ZOOM_STEP;this._zoom(scale);},_onZoomOut:function(e){e.preventDefault();var scale=this.scale-ZOOM_STEP;this._zoom(scale);},_onZoomReset:function(e){e.preventDefault();this.$('.o_viewer_zoomer').css("transform","");this._zoom(1);},});return DocumentViewer;});;

/* /mail/static/src/js/composers/basic_composer.js defined in bundle 'web.assets_backend' */
odoo.define('mail.composer.Basic',function(require){"use strict";var emojis=require('mail.emojis');var MentionManager=require('mail.composer.MentionManager');var DocumentViewer=require('mail.DocumentViewer');var utils=require('web.utils');var config=require('web.config');var core=require('web.core');var data=require('web.data');var dom=require('web.dom');var session=require('web.session');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var BasicComposer=Widget.extend({template:"mail.Composer",events:{'change input.o_input_file':'_onAttachmentChange','click .o_attachment_delete':'_onAttachmentDelete','click .o_attachment_download':'_onAttachmentDownload','click .o_attachment_view':'_onAttachmentView','click .o_composer_button_add_attachment':'_onClickAddAttachment','click .o_composer_button_emoji':'_onEmojiButtonClick','focusout .o_composer_button_emoji':'_onEmojiButtonFocusout','mousedown .o_mail_emoji_container .o_mail_emoji':'_onEmojiImageClick','focus .o_mail_emoji_container .o_mail_emoji':'_onEmojiImageFocus','dragover .o_file_drop_zone_container':'_onFileDragover','drop .o_file_drop_zone_container':'_onFileDrop','input .o_input':'_onInput','keydown .o_composer_input textarea':'_onKeydown','keyup .o_composer_input':'_onKeyup','click .o_composer_button_send':'_sendMessage',},MENTION_THROTTLE:200,init:function(parent,options){this._super.apply(this,arguments);this.options=_.defaults(options||{},{commandsEnabled:true,context:{},inputMinHeight:28,mentionFetchLimit:8,mentionPartnersRestricted:false,sendText:_t("Send"),defaultBody:'',defaultMentionSelections:{},isMobile:config.device.isMobile});this.context=this.options.context;this._attachmentDataSet=new data.DataSetSearch(this,'ir.attachment',this.context);this.fileuploadID=_.uniqueId('o_chat_fileupload');this.set('attachment_ids',options.attachmentIds||[]);this._mentionManager=new MentionManager(this);this._mentionManager.register({delimiter:'@',fetchCallback:this._mentionFetchPartners.bind(this),generateLinks:true,model:'res.partner',redirectClassname:'o_mail_redirect',selection:this.options.defaultMentionSelections['@'],suggestionTemplate:'mail.MentionSuggestions.Partner',});this._mentionManager.register({delimiter:'#',fetchCallback:this._mentionFetchChannels.bind(this),generateLinks:true,model:'mail.channel',redirectClassname:'o_channel_redirect',selection:this.options.defaultMentionSelections['#'],suggestionTemplate:'mail.MentionSuggestions.Channel',});this._mentionManager.register({delimiter:':',fetchCallback:this._mentionGetCannedResponses.bind(this),selection:this.options.defaultMentionSelections[':'],suggestionTemplate:'mail.MentionSuggestions.CannedResponse',});if(this.options.commandsEnabled){this._mentionManager.register({beginningOnly:true,delimiter:'/',fetchCallback:this._mentionGetCommands.bind(this),selection:this.options.defaultMentionSelections['/'],suggestionTemplate:'mail.MentionSuggestions.Command',});}
this.isMini=options.isMini;this.avatarURL=session.uid>0?session.url('/web/image',{model:'res.users',field:'image_128',id:session.uid,}):'/web/static/src/img/user_menu_avatar.png';},start:function(){var self=this;this._$attachmentButton=this.$('.o_composer_button_add_attachment');this._$attachmentsList=this.$('.o_composer_attachments_list');this.$input=this.$('.o_composer_input textarea');this.$input.focus(function(){self.trigger('input_focused');});this.$input.val(this.options.defaultBody);dom.autoresize(this.$input,{parent:this,min_height:this.options.inputMinHeight});this._renderAttachments();$(window).on(this.fileuploadID,this._onAttachmentLoaded.bind(this));this.on('change:attachment_ids',this,this._renderAttachments);this.call('mail_service','getMailBus').on('update_typing_partners',this,this._onUpdateTypingPartners);var prependPromise=this._mentionManager.prependTo(this.$('.o_composer'));var $body=$('body');this._dropZoneNS=_.uniqueId('o_dz_');$body.on('dragleave.'+this._dropZoneNS,this._onBodyFileDragLeave.bind(this));$body.on("dragover."+this._dropZoneNS,this._onBodyFileDragover.bind(this));$body.on("drop."+this._dropZoneNS,this._onBodyFileDrop.bind(this));return Promise.all([this._super(),prependPromise]);},destroy:function(){$("body").off('dragleave.'+this._dropZoneNS);$("body").off('dragover.'+this._dropZoneNS);$("body").off('drop.'+this._dropZoneNS);$(window).off(this.fileuploadID);return this._super.apply(this,arguments);},clearComposer:function(){this.$input.val('');this._mentionManager.resetSelections();this.set('attachment_ids',[]);},focus:function(){this.$input.focus();},getSelectionPositions:function(){var InputElement=this.$input.get(0);return InputElement?dom.getSelectionRange(InputElement):{start:0,end:0};},getState:function(){return{attachments:this.get('attachment_ids'),text:this.$input.val(),};},isEmpty:function(){return!this.$input.val().trim()&&!this.$('.o_attachments').children().length;},setState:function(state){this.set('attachment_ids',state.attachments);this.$input.val(state.text);},setThread:function(thread){this.options.thread=thread;},mentionSetCommands:function(commands){this._mentionCommands=commands;},mentionSetPrefetchedPartners:function(prefetchedPartners){this._mentionPrefetchedPartners=prefetchedPartners;},getMentionListenerSelections:function(){return this._mentionManager.getListenerSelections();},_clearComposerOnSend:function(){this.clearComposer();},_doCheckAttachmentUpload:function(){if(_.find(this.get('attachment_ids'),function(file){return file.upload;})){this.do_warn(_t("Uploading error"),_t("Please, wait while the file is uploading."));return false;}
return true;},_hideEmojis:function(){this._$emojisContainer.remove();},_isDragSourceExternalFile:function(dataTransfer){var DragDataType=dataTransfer.types;if(DragDataType.constructor===DOMStringList){return DragDataType.contains('Files');}
if(DragDataType.constructor===Array){return DragDataType.indexOf('Files')!==-1;}
return false;},_mentionGetCannedResponses:function(search){var self=this;var def=new Promise(function(resolve,reject){clearTimeout(self._cannedTimeout);self._cannedTimeout=setTimeout(function(){var cannedResponses=self.call('mail_service','getCannedResponses');var matches=fuzzy.filter(utils.unaccent(search),_.pluck(cannedResponses,'source'));var indexes=_.pluck(matches.slice(0,self.options.mentionFetchLimit),'index');resolve(_.map(indexes,function(index){return cannedResponses[index];}));},500);});return def;},_mentionGetCommands:function(search){var searchRegexp=new RegExp(_.str.escapeRegExp(utils.unaccent(search)),'i');return _.filter(this._mentionCommands,function(command){return searchRegexp.test(command.name);}).slice(0,this.options.mentionFetchLimit);},_mentionFetchChannels:function(search){return this._mentionFetchThrottled('mail.channel','get_mention_suggestions',{limit:this.options.mentionFetchLimit,search:search,}).then(function(suggestions){return _.partition(suggestions,function(suggestion){return _.contains(['public','groups'],suggestion.public);});});},_mentionFetchPartners:function(search){var self=this;return Promise.resolve(this._mentionPrefetchedPartners).then(function(prefetchedPartners){var suggestions=[];var limit=self.options.mentionFetchLimit;var searchRegexp=new RegExp(_.str.escapeRegExp(utils.unaccent(search)),'i');_.each(prefetchedPartners,function(partners){if(limit>0){var filteredPartners=_.filter(partners,function(partner){return partner.email&&searchRegexp.test(partner.email)||partner.name&&searchRegexp.test(utils.unaccent(partner.name));});if(filteredPartners.length){suggestions.push(filteredPartners.slice(0,limit));limit-=filteredPartners.length;}}});if(!suggestions.length&&!self.options.mentionPartnersRestricted){suggestions=self._mentionFetchThrottled('res.partner','get_mention_suggestions',{limit:limit,search:search});}
return Promise.resolve(suggestions).then(function(suggestions){_.each(suggestions,function(suggestionsSet){_.each(suggestionsSet,function(suggestion){suggestion.im_status=self.call('mail_service','getImStatus',{partnerID:suggestion.id});});});return suggestions;});});},_mentionFetchThrottled:function(model,method,kwargs){var self=this;return new Promise(function(resolve,reject){clearTimeout(self.mentionFetchTimer);self.mentionFetchTimer=setTimeout(function(){return self._rpc({model:model,method:method,kwargs:kwargs}).then(function(results){resolve(results);});},self.MENTION_THROTTLE);});},_preprocessMessage:function(){var value=_.escape(this.$input.val()).trim();value=value.replace(/(\r|\n){2,}/g,'<br/><br/>');value=value.replace(/(\r|\n)/g,'<br/>');value=value.replace(/ /g,'&nbsp;').replace(/([^>])&nbsp;([^<])/g,'$1 $2');var commands=this.options.commandsEnabled?this._mentionManager.getListenerSelection('/'):[];return Promise.resolve({content:this._mentionManager.generateLinks(value),attachment_ids:_.pluck(this.get('attachment_ids'),'id'),partner_ids:_.uniq(_.pluck(this._mentionManager.getListenerSelection('@'),'id')),canned_response_ids:_.uniq(_.pluck(this._mentionManager.getListenerSelections()[':'],'id')),channel_ids:_.uniq(_.pluck(this._mentionManager.getListenerSelection('#'),'id')),command:commands.length>0?commands[0].name:undefined,});},_processAttachmentChange:function(params){var self=this;var attachments=this.get('attachment_ids');var files=params.files;var submitForm=params.submitForm;var $form=this.$('form.o_form_binary_form');function makeFormDataWithoutUfile(){var newFormData=new window.FormData();$form.find('input').each(function(index,input){if(input.name!=='ufile'){newFormData.append(input.name,input.value);}});return newFormData;}
_.each(files,function(file){var attachment=_.findWhere(attachments,{name:file.name,size:file.size});if(attachment){self._attachmentDataSet.unlink([attachment.id]);attachments=_.without(attachments,attachment);}});if(submitForm){$form.submit();this._$attachmentButton.prop('disabled',true);}else{_.each(files,function(file){var formData=makeFormDataWithoutUfile();formData.append("ufile",file,file.name);$.ajax({url:$form.attr("action"),type:"POST",enctype:'multipart/form-data',processData:false,contentType:false,data:formData,success:function(result){var $el=$(result);$.globalEval($el.contents().text());}});});}
var uploadAttachments=_.map(files,function(file){return{id:0,name:file.name,filename:file.name,url:'',upload:true,mimetype:'',};});attachments=attachments.concat(uploadAttachments);this.set('attachment_ids',attachments);},_renderAttachments:function(){this._$attachmentsList.html(QWeb.render('mail.composer.Attachments',{attachments:this.get('attachment_ids'),}));},_sendMessage:function(){if(this.isEmpty()||!this._doCheckAttachmentUpload()){return;}
clearTimeout(this._cannedTimeout);var self=this;this._preprocessMessage().then(function(message){self.trigger('post_message',message);self._clearComposerOnSend();self.$input.focus();});},_shouldSend:function(ev){return!ev.shiftKey;},_onAttachmentChange:function(ev){this._processAttachmentChange({files:ev.currentTarget.files,submitForm:true});ev.target.value="";},_onAttachmentDelete:function(ev){ev.stopPropagation();var self=this;var attachmentID=$(ev.currentTarget).data('id');if(attachmentID){var attachments=[];_.each(this.get('attachment_ids'),function(attachment){if(attachmentID!==attachment.id){attachments.push(attachment);}else{self._attachmentDataSet.unlink([attachmentID]);}});this.set('attachment_ids',attachments);this.$('input.o_input_file').val('');}},_onAttachmentDownload:function(ev){ev.stopPropagation();},_onAttachmentLoaded:function(){var attachments=this.get('attachment_ids');var files=Array.prototype.slice.call(arguments,1);_.each(files,function(file){if(file.error||!file.id){this.do_warn(file.error);attachments=_.filter(attachments,function(attachment){return!attachment.upload;});}else{var attachment=_.findWhere(attachments,{filename:file.filename,upload:true});if(attachment){attachments=_.without(attachments,attachment);attachments.push({id:file.id,name:file.name||file.filename,filename:file.filename,mimetype:file.mimetype,size:file.size,url:session.url('/web/content',{id:file.id,download:true}),});}}}.bind(this));this.set('attachment_ids',attachments);this._$attachmentButton.prop('disabled',false);},_onAttachmentView:function(ev){var activeAttachmentID=$(ev.currentTarget).data('id');var attachments=this.get('attachment_ids');if(activeAttachmentID){var attachmentViewer=new DocumentViewer(this,attachments,activeAttachmentID);attachmentViewer.appendTo($('body'));}},_onBodyFileDragLeave:function(ev){if(ev.originalEvent.clientX<=0||ev.originalEvent.clientY<=0||ev.originalEvent.clientX>=window.innerWidth||ev.originalEvent.clientY>=window.innerHeight){this.$(".o_file_drop_zone_container").addClass("d-none");}},_onBodyFileDragover:function(ev){ev.preventDefault();if(this._isDragSourceExternalFile(ev.originalEvent.dataTransfer)){this.$(".o_file_drop_zone_container").removeClass("d-none");}},_onBodyFileDrop:function(ev){ev.preventDefault();this.$(".o_file_drop_zone_container").addClass("d-none");},_onClickAddAttachment:function(){this.$('input.o_input_file').click();this.$input.focus();},_onEmojiButtonClick:function(){if(!this._$emojisContainer){this._$emojisContainer=$(QWeb.render('mail.Composer.emojis',{emojis:emojis,}));}
if(this._$emojisContainer.parent().length){this._hideEmojis();}else{this._$emojisContainer.appendTo(this.$('.o_composer'));}},_onEmojiButtonFocusout:function(){if(this._$emojisContainer){this._hideEmojisTimeout=setTimeout(this._hideEmojis.bind(this),0);}},_onEmojiImageClick:function(ev){ev.preventDefault();var cursorPosition=this.getSelectionPositions();var inputVal=this.$input.val();var leftSubstring=inputVal.substring(0,cursorPosition.start);var rightSubstring=inputVal.substring(cursorPosition.end);var newInputVal=[leftSubstring,$(ev.currentTarget).data('emoji'),rightSubstring].join(" ");var newCursorPosition=newInputVal.length-rightSubstring.length;this.$input.val(newInputVal);this.$input.focus();this.$input[0].setSelectionRange(newCursorPosition,newCursorPosition);this._hideEmojis();},_onEmojiImageFocus:function(){clearTimeout(this._hideEmojisTimeout);},_onFileDragover:function(ev){ev.originalEvent.dataTransfer.dropEffect="copy";},_onFileDrop:function(ev){ev.preventDefault();$(".o_file_drop_zone_container").addClass("d-none");if(this._isDragSourceExternalFile(ev.originalEvent.dataTransfer)){var files=ev.originalEvent.dataTransfer.files;this._processAttachmentChange({files:files});}},_onInput:function(){if(this.options.thread&&this.options.thread.hasTypingNotification()){var isTyping=this.$input.val().length>0;this.options.thread.setMyselfTyping({typing:isTyping});}},_onKeydown:function(ev){switch(ev.which){case $.ui.keyCode.UP:case $.ui.keyCode.DOWN:case $.ui.keyCode.TAB:if(this._mentionManager.isOpen()){ev.preventDefault();}
break;case $.ui.keyCode.ENTER:if(this._mentionManager.isOpen()){ev.preventDefault();}else{var sendMessage=ev.ctrlKey||this._shouldSend(ev);if(sendMessage){ev.preventDefault();this._sendMessage();}}
break;}},_onKeyup:function(ev){switch(ev.which){case $.ui.keyCode.END:case $.ui.keyCode.PAGE_UP:case $.ui.keyCode.PAGE_DOWN:break;case $.ui.keyCode.ESCAPE:if(this._mentionManager.isOpen()){ev.stopPropagation();this._mentionManager.resetSuggestions();}else{this.trigger_up('escape_pressed');}
break;case $.ui.keyCode.ENTER:case $.ui.keyCode.UP:case $.ui.keyCode.DOWN:case $.ui.keyCode.TAB:if(this._mentionManager.isOpen()){this._mentionManager.propositionNavigation(ev.which);}
break;default:this._mentionManager.detectDelimiter();}},_onUpdateTypingPartners:function(threadID){if(!this.options.showTyping){return;}
if(!this.options.thread){return;}
if(this.options.thread.getID()!==threadID){return;}
this.$('.o_composer_thread_typing').html(QWeb.render('mail.Composer.ThreadTyping',{thread:this.options.thread,}));},});return BasicComposer;});;

/* /mail/static/src/js/composers/chatter_composer.js defined in bundle 'web.assets_backend' */
odoo.define('mail.composer.Chatter',function(require){"use strict";var BasicComposer=require('mail.composer.Basic');var mailUtils=require('mail.utils');var session=require('web.session');var core=require('web.core');var viewDialogs=require('web.view_dialogs');var _t=core._t;var ChatterComposer=BasicComposer.extend({template:'mail.chatter.Composer',events:_.extend({},BasicComposer.prototype.events,{'click .o_composer_button_full_composer':'_onOpenFullComposer','click .o_suggested_show_more_less':'_onClickPartnerSuggestionsReadMoreLess',}),init:function(parent,model,suggestedPartners,options){this._super(parent,options);this._model=model;this.suggestedPartners=suggestedPartners;this.options=_.defaults(this.options,{display_mode:'textarea',recordName:false,isLog:false,});if(this.options.isLog){this.options.sendText=_t("Log");}
this.notInline=true;},_clearComposerOnSend:function(){},_checkSuggestedPartners:function(checkedSuggestedPartners){var self=this;var checkDone=new Promise(function(resolve,reject){var recipients=_.filter(checkedSuggestedPartners,function(recipient){return recipient.checked;});var recipientsToFind=_.filter(recipients,function(recipient){return(!recipient.partner_id);});var namesToFind=_.pluck(recipientsToFind,'full_name');var recipientsToCheck=_.filter(recipients,function(recipient){return(recipient.partner_id&&!recipient.email_address);});var recipientIDs=_.pluck(_.filter(recipients,function(recipient){return recipient.partner_id&&recipient.email_address;}),'partner_id');var namesToRemove=[];var recipientIDsToRemove=[];var def;if(namesToFind.length>0){def=self._rpc({route:'/mail/get_partner_info',params:{model:self._model,res_ids:[self.context.default_res_id],emails:namesToFind,},});}
Promise.resolve(def).then(function(result){result=result||[];var emailDefs=[];var recipientPopups=result.concat(recipientsToCheck);_.each(recipientPopups,function(partnerInfo){var prom=new Promise(function(innerResolve,innerReject){var partnerName=partnerInfo.full_name;var partnerID=partnerInfo.partner_id;var parsedEmail=mailUtils.parseEmail(partnerName);var dialog=new viewDialogs.FormViewDialog(self,{res_model:'res.partner',res_id:partnerID,context:{active_model:self._model,active_id:self.context.default_res_id,force_email:true,ref:'compound_context',default_name:parsedEmail[0],default_email:parsedEmail[1],},title:_t("Please complete customer's informations"),disable_multiple_selection:true,}).open();dialog.on('closed',self,function(){innerResolve();});dialog.opened().then(function(){dialog.form_view.on('on_button_cancel',self,function(){namesToRemove.push(partnerName);if(partnerID){recipientIDsToRemove.push(partnerID);}});});});emailDefs.push(prom);});Promise.all(emailDefs).then(function(){var newNamesToFind=_.difference(namesToFind,namesToRemove);var def;if(newNamesToFind.length>0){def=self._rpc({route:'/mail/get_partner_info',params:{model:self._model,res_ids:[self.context.default_res_id],emails:namesToFind,link_mail:true,},});}
Promise.resolve(def).then(function(result){result=result||[];var recipientPopups=result.concat(recipientsToCheck);_.each(recipientPopups,function(partnerInfo){if(partnerInfo.partner_id&&_.indexOf(partnerInfo.partner_id,recipientIDsToRemove)===-1){recipientIDs.push(partnerInfo.partner_id);}});}).then(function(){resolve(recipientIDs);});});});});return checkDone;},_getCheckedSuggestedPartners:function(){var self=this;var checkedPartners=[];this.$('.o_composer_suggested_partners input:checked').each(function(){var fullName=$(this).data('fullname');checkedPartners=checkedPartners.concat(_.filter(self.suggestedPartners,function(item){return fullName===item.full_name;}));});return checkedPartners;},_preprocessMessage:function(){var self=this;return new Promise(function(resolve,reject){self._super().then(function(message){message=_.extend(message,{subtype:'mail.mt_comment',message_type:'comment',context:_.defaults({},self.context,session.user_context),});if(self.options.isLog){message.subtype='mail.mt_note';}
if(!self.options.isLog){var checkedSuggestedPartners=self._getCheckedSuggestedPartners();self._checkSuggestedPartners(checkedSuggestedPartners).then(function(partnerIDs){message.partner_ids=(message.partner_ids||[]).concat(partnerIDs);message.context=_.defaults({},message.context,{mail_post_autofollow:true,});if(partnerIDs.length){self.trigger_up('reset_suggested_partners');}
resolve(message);});}else{resolve(message);}});});},_shouldSend:function(){return false;},_onClickPartnerSuggestionsReadMoreLess:function(ev){ev.preventDefault();this.$('.o_suggested_toggle').toggleClass('o_hidden');},_onOpenFullComposer:function(){if(!this._doCheckAttachmentUpload()){return false;}
var self=this;var recipientDoneDef=new Promise(function(resolve,reject){self.trigger_up('discard_record_changes',{proceed:function(){if(self.options.isLog){resolve([]);}else{var checkedSuggestedPartners=self._getCheckedSuggestedPartners();self._checkSuggestedPartners(checkedSuggestedPartners).then(resolve);}},});});recipientDoneDef.then(function(partnerIDs){var context={default_parent_id:self.id,default_body:mailUtils.getTextToHTML(self.$input.val()),default_attachment_ids:_.pluck(self.get('attachment_ids'),'id'),default_partner_ids:partnerIDs,default_is_log:self.options.isLog,mail_post_autofollow:true,};if(self.context.default_model&&self.context.default_res_id){context.default_model=self.context.default_model;context.default_res_id=self.context.default_res_id;}
var action={type:'ir.actions.act_window',res_model:'mail.compose.message',view_mode:'form',views:[[false,'form']],target:'new',context:context,};self.do_action(action,{on_close:self.trigger.bind(self,'need_refresh'),}).then(self.trigger.bind(self,'close_composer'));});}});return ChatterComposer;});;

/* /mail/static/src/js/composers/extended_composer.js defined in bundle 'web.assets_backend' */
odoo.define('mail.composer.Extended',function(require){"use strict";var BasicComposer=require('mail.composer.Basic');var core=require('web.core');var QWeb=core.qweb;var ExtendedComposer=BasicComposer.extend({events:_.extend({},BasicComposer.prototype.events,{'click .o_composer_button_discard':'_onClickDiscard',}),init:function(parent,options){options=_.defaults(options||{},{inputMinHeight:120,});this._super(parent,options);this.extended=true;},start:function(){this._$subjectInput=this.$('.o_composer_subject input');return this._super.apply(this,arguments);},clearComposer:function(){this._super.apply(this,arguments);this._$subjectInput.val('');},focus:function(target){if(target==='body'){this.$input.focus();}else{this._$subjectInput.focus();}},getState:function(){var state=this._super.apply(this,arguments);state.subject=this._$subjectInput.val();return state;},setState:function(state){this._super.apply(this,arguments);this.setSubject(state.subject);},setSubject:function(subject){this.$('.o_composer_subject input').val(subject);},showDiscardButton:function(){var $discard=this.$('.o_composer_button_discard');$discard.removeClass('d-none');$discard.addClass('d-md-inline-block');},hideDiscardButton:function(){var $discard=this.$('.o_composer_button_discard');$discard.removeClass('d-md-inline-block');$discard.addClass('d-none');},_preprocessMessage:function(){var self=this;return this._super().then(function(message){var subject=self._$subjectInput.val();self._$subjectInput.val("");message.subject=subject;return message;});},_shouldSend:function(){return false;},_onClickDiscard:function(){this.trigger_up('discard_extended_composer');},});return ExtendedComposer;});;

/* /mail/static/src/js/composers/mention_manager.js defined in bundle 'web.assets_backend' */
odoo.define('mail.composer.MentionManager',function(require){"use strict";var core=require('web.core');var dom=require('web.dom');var session=require('web.session');var Widget=require('web.Widget');var QWeb=core.qweb;var NON_BREAKING_SPACE='\u00a0';var MentionManager=Widget.extend({className:'dropup o_composer_mention_dropdown',events:{'click .o_mention_proposition':'_onClickMentionItem','mouseover .o_mention_proposition':'_onHoverMentionProposition',},init:function(parent){this._super.apply(this,arguments);this._composer=parent;this._open=false;this._listeners=[];this.set('mention_suggestions',[]);this.on('change:mention_suggestions',this,this._renderSuggestions);},isOpen:function(){return this._open;},getListenerSelection:function(delimiter){var listener=_.findWhere(this._listeners,{delimiter:delimiter});if(listener){var escapedVal=_.escape(this._composer.$input.val().replace(/\n/g,"\n "));var inputMentions=escapedVal.match(new RegExp(delimiter+'[^ ]+(?= |&nbsp;|$)','g'));return this._validateSelection(listener.selection,inputMentions);}
return[];},getListenerSelections:function(){var selections={};_.each(this._listeners,function(listener){selections[listener.delimiter]=listener.selection;});return selections;},detectDelimiter:function(){var self=this;var textVal=this._composer.$input.val();var cursorPosition=this._getComposerSelectionPositions().start;var leftString=textVal.substring(0,cursorPosition);function validateKeyword(delimiter,beginningOnly){var beforeDelimiterPosition=leftString.lastIndexOf(delimiter)-1;if(beginningOnly&&beforeDelimiterPosition>0){return false;}
var searchStr=textVal.substring(beforeDelimiterPosition,cursorPosition);var pattern="^"+delimiter+"|^\\s"+delimiter;var regexStart=new RegExp(pattern,'g');searchStr=searchStr.replace(/^\s\s*|^[\n\r]/g,'');if(regexStart.test(searchStr)&&searchStr.length){searchStr=searchStr.replace(pattern,'');return searchStr.indexOf(' ')<0&&!/[\r\n]/.test(searchStr)?searchStr.replace(delimiter,''):false;}
return false;}
this._activeListener=undefined;for(var i=0;i<this._listeners.length;i++){var listener=this._listeners[i];this._mentionWord=validateKeyword(listener.delimiter,listener.beginningOnly);if(this._mentionWord!==false){this._activeListener=listener;break;}}
if(this._activeListener){var mentionWord=this._mentionWord;Promise.resolve(this._activeListener.fetchCallback(mentionWord)).then(function(suggestions){if(mentionWord===self._mentionWord){self.set('mention_suggestions',suggestions);}});}else{this.set('mention_suggestions',[]);}},generateLinks:function(s){var self=this;var baseHREF=session.url('/web');var linkParams="href='%s' class='%s' data-oe-id='%s' data-oe-model='%s' target='_blank'";var mentionLink="<a "+linkParams+" >"+"%s%s"+"</a>";_.each(this._listeners,function(listener){if(!listener.generateLinks){return;}
var selection=listener.selection;if(selection.length){var matches=self._getMatch(s,listener);var substrings=[];var startIndex=0;for(var i=0;i<matches.length;i++){var match=matches[i];var endIndex=match.index+match[0].length;var selectionID=self._getSelectionID(match,selection);var matchName=match[0].substring(1).replace(new RegExp(NON_BREAKING_SPACE,'g'),' ');var href=baseHREF+
_.str.sprintf("#model=%s&id=%s",listener.model,selectionID);var processedText=_.str.sprintf(mentionLink,href,listener.redirectClassname,selectionID,listener.model,listener.delimiter,matchName);substrings.push(s.substring(startIndex,match.index));substrings.push(processedText);startIndex=endIndex;}
substrings.push(s.substring(startIndex,s.length));s=substrings.join('');}});return s;},propositionNavigation:function(keycode){var $active=this.$('.o_mention_proposition.active');if(keycode===$.ui.keyCode.ENTER){$active.click();}else{var $to;if(keycode===$.ui.keyCode.DOWN){$to=$active.nextAll('.o_mention_proposition').first();}else if(keycode===$.ui.keyCode.UP){$to=$active.prevAll('.o_mention_proposition').first();}else if(keycode===$.ui.keyCode.TAB){$to=$active.nextAll('.o_mention_proposition').first();if(!$to.length){$to=$active.prevAll('.o_mention_proposition').last();}}
if($to&&$to.length){$active.removeClass('active');$to.addClass('active');}}},register:function(listener){this._listeners.push(_.defaults(listener,{model:'',redirectClassname:'',selection:[],}));},resetSuggestions:function(){this.set('mention_suggestions',[]);},resetSelections:function(){_.each(this._listeners,function(listener){listener.selection=[];});},_getMatch:function(inputText,listener){var names=_.pluck(listener.selection,'name');var escapedNames=_.map(names,function(str){return"("+_.str.escapeRegExp(listener.delimiter+str)+")(?= |&nbsp;|$)";});var regexStr=escapedNames.join('|');var result=[];if(regexStr.length){var myRegexp=new RegExp(regexStr,'g');var match=myRegexp.exec(inputText);while(match!==null){result.push(match);match=myRegexp.exec(inputText);}}
return result;},_getSelectionID:function(match,selection){return _.findWhere(selection,{name:match[0].slice(1)}).id;},_getComposerSelectionPositions:function(){return this._composer.getSelectionPositions();},_renderSuggestions:function(){var suggestions=[];if(_.find(this.get('mention_suggestions'),_.isArray)){var insertDivider=false;_.each(this.get('mention_suggestions'),function(suggestionGroup){if(suggestionGroup.length>0){if(insertDivider){suggestions.push({divider:true});}
suggestions=suggestions.concat(suggestionGroup);insertDivider=true;}});}else{suggestions=this.get('mention_suggestions');}
if(suggestions.length){this.$el.html(QWeb.render(this._activeListener.suggestionTemplate,{suggestions:_.map(suggestions,function(suggestion){return _.extend({},suggestion,{name:_.unescape(suggestion.name)});})}));this.$el.addClass('show').find('.dropdown-menu').addClass('show').css('max-width',this._composer.$input.width()).find('.o_mention_proposition').first().addClass('active');this._open=true;}else{this.$el.removeClass('show').find('.dropdown-menu').removeClass('show');this.$el.empty();this._open=false;}},_setCursorPosition:function(pos){this._composer.$input.each(function(index,elem){dom.setSelectionRange(elem,{start:pos,end:pos});});},_validateSelection:function(selection,inputMentions){var validatedSelection=[];_.each(inputMentions,function(mention){var validatedMention=_.findWhere(selection,{name:mention.slice(1)});if(validatedMention){validatedSelection.push(validatedMention);}});return validatedSelection;},_onClickMentionItem:function(ev){ev.preventDefault();var textInput=this._composer.$input.val();var id=$(ev.currentTarget).data('id');var suggestions=_.flatten(this.get('mention_suggestions'));var selectedSuggestion=_.clone(_.find(suggestions,function(s){return s.id===id;}));var substitution=selectedSuggestion.substitution;if(!substitution){selectedSuggestion.name=_.unescape(selectedSuggestion.name.replace(/ /g,NON_BREAKING_SPACE));substitution=this._activeListener.delimiter+selectedSuggestion.name;}
var getMentionIndex=function(matches,cursorPosition){for(var i=0;i<matches.length;i++){if(cursorPosition<=matches[i].index){return i;}}
return i;};if(this._activeListener.selection.length){var matches=this._getMatch(textInput,this._activeListener);var index=getMentionIndex(matches,this._getComposerSelectionPositions().start);this._activeListener.selection.splice(index,0,selectedSuggestion);}else{this._activeListener.selection.push(selectedSuggestion);}
var cursorPosition=this._getComposerSelectionPositions().start;var textLeft=textInput.substring(0,cursorPosition-(this._mentionWord.length+1));var textRight=textInput.substring(cursorPosition,textInput.length);var textInputNew=textLeft+substitution+' '+textRight;this._composer.$input.val(textInputNew);this._setCursorPosition(textLeft.length+substitution.length+2);this.set('mention_suggestions',[]);this._composer.focus('body');if(selectedSuggestion.name){selectedSuggestion.name=_.escape(selectedSuggestion.name);}},_onHoverMentionProposition:function(ev){var $elem=$(ev.currentTarget);this.$('.o_mention_proposition').removeClass('active');$elem.addClass('active');},});return MentionManager;});;

/* /mail/static/src/js/chatter.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Chatter',function(require){"use strict";var Activity=require('mail.Activity');var AttachmentBox=require('mail.AttachmentBox');var ChatterComposer=require('mail.composer.Chatter');var Dialog=require('web.Dialog');var Followers=require('mail.Followers');var ThreadField=require('mail.ThreadField');var mailUtils=require('mail.utils');var concurrency=require('web.concurrency');var config=require('web.config');var core=require('web.core');var Widget=require('web.Widget');var _t=core._t;var QWeb=core.qweb;var Chatter=Widget.extend({template:'mail.Chatter',custom_events:{delete_attachment:'_onDeleteAttachment',discard_record_changes:'_onDiscardRecordChanges',reload_attachment_box:'_onReloadAttachmentBox',reload_mail_fields:'_onReloadMailFields',reset_suggested_partners:'_onResetSuggestedPartners',},events:{'click .o_chatter_button_new_message':'_onOpenComposerMessage','click .o_chatter_button_log_note':'_onOpenComposerNote','click .o_chatter_button_attachment':'_onClickAttachmentButton','click .o_chatter_button_schedule_activity':'_onScheduleActivity',},supportedFieldTypes:['one2many'],init:function(parent,record,mailFields,options){this._super.apply(this,arguments);this._setState(record);this.attachments={};this.fields={};this._areAttachmentsLoaded=false;this._disableAttachmentBox=!!options.disable_attachment_box;this._dp=new concurrency.DropPrevious();this._isAttachmentBoxOpen=false;this._mentionPartnerSuggestions=this.call('mail_service','getMentionPartnerSuggestions');this._mentionSuggestions=this._mentionPartnerSuggestions;this._suggestedPartnersProm=undefined;if(mailFields.mail_activity){this.fields.activity=new Activity(this,mailFields.mail_activity,record,options);}
if(mailFields.mail_followers){this.fields.followers=new Followers(this,mailFields.mail_followers,record,options);}
if(mailFields.mail_thread){this.fields.thread=new ThreadField(this,mailFields.mail_thread,record,options);var fieldsInfo=record.fieldsInfo[options.viewType||record.viewType];var nodeOptions=fieldsInfo[mailFields.mail_thread].options||{};this.hasLogButton=options.display_log_button||nodeOptions.display_log_button;this.postRefresh=nodeOptions.post_refresh||'never';this.reloadOnUploadAttachment=this.postRefresh==='always';this.openAttachments=nodeOptions.open_attachments||false;}},start:function(){this._$topbar=this.$('.o_chatter_topbar');if(!this._disableAttachmentBox){this.$('.o_topbar_right_area').append(QWeb.render('mail.chatter.Attachment.Button',{displayCounter:!!this.fields.thread,count:this.record.data.message_attachment_count||0,}));}
this._$topbar.prepend(this._renderButtons());var fieldDefs=_.invoke(this.fields,'appendTo',$('<div>'));var def=this._dp.add(Promise.all(fieldDefs));this._render(def).then(this._updateMentionSuggestions.bind(this)).then(()=>{if(this.openAttachments){this._fetchAttachments().then(()=>this._openAttachmentBox());}});return this._super.apply(this,arguments);},update:function(record,fieldNames){var self=this;if(this.record.res_id!==record.res_id){this._closeComposer(true);this._closeAttachments();this._areAttachmentsLoaded=false;this.attachments={};}
this._setState(record);this.$el.height(this.$el.height());if(this.fields.activity){this.fields.activity.$el.detach();}
if(this.fields.thread&&this.fields.thread.$el){this.fields.thread.$el.detach();}
var fieldsToReset;if(fieldNames){fieldsToReset=_.filter(this.fields,function(field){return _.contains(fieldNames,field.name);});}else{fieldsToReset=this.fields;}
var fieldDefs=_.invoke(fieldsToReset,'reset',record);var def=this._dp.add(Promise.all(fieldDefs));this._render(def).then(function(){self.$el.height('auto');self._updateMentionSuggestions();});this._updateAttachmentCounter();},_closeAttachments:function(){if(this.fields.attachments){this.$('.o_chatter_button_attachment').removeClass('o_active_attach');this.fields.attachments.destroy();this._isAttachmentBoxOpen=false;}},_closeComposer:function(force){if(this._composer&&(this._composer.isEmpty()||force)){this.$el.removeClass('o_chatter_composer_active');this.$('.o_chatter_button_new_message, .o_chatter_button_log_note').removeClass('o_active');this._composer.do_hide();this._composer.clearComposer();}},_disableChatter:function(){this.$('.btn').prop('disabled',true);},_disableComposer:function(){this.$(".o_composer_button_send").prop('disabled',true);},_discardChanges:function(){var self=this;return new Promise(function(resolve,reject){self.trigger_up('discard_changes',{recordID:self.record.id,onSuccess:resolve,onFailure:reject,});});},_discardOnReload:function(messageData){if(this._reloadAfterPost(messageData)){return this._discardChanges();}
return Promise.resolve();},_enableChatter:function(){this.$('.btn').prop('disabled',false);},_enableComposer:function(){this.$(".o_composer_button_send").prop('disabled',false);},_fetchAttachments:function(){var self=this;var domain=[['res_id','=',this.record.res_id],['res_model','=',this.record.model],];return this._rpc({model:'ir.attachment',method:'search_read',domain:domain,fields:['id','name','mimetype'],}).then(function(result){self._areAttachmentsLoaded=true;self.attachments=result;});},_openAttachmentBox:function(){if(this.fields.attachments){this._closeAttachments();}
this.fields.attachments=new AttachmentBox(this,this.record,this.attachments);var $anchor=this.$('.o_chatter_topbar');if(this._composer){var $anchor=this.$('.o_thread_composer');}else{var $anchor=this.$('.o_chatter_topbar');}
this.fields.attachments.insertAfter($anchor);this.$el.addClass('o_chatter_composer_active');this.$('.o_chatter_button_attachment').addClass('o_active_attach');this._isAttachmentBoxOpen=true;},_openComposer:function(options){var self=this;var oldComposer=this._composer;this._composer=new ChatterComposer(this,this.record.model,options.suggested_partners||[],{commandsEnabled:false,context:this.context,inputMinHeight:50,isLog:options&&options.isLog,recordName:this.recordName,defaultBody:oldComposer&&oldComposer.$input&&oldComposer.$input.val(),defaultMentionSelections:oldComposer&&oldComposer.getMentionListenerSelections(),attachmentIds:(oldComposer&&oldComposer.get('attachment_ids'))||[],});this._composer.on('input_focused',this,function(){this._composer.mentionSetPrefetchedPartners(this._mentionSuggestions||[]);});this._composer.insertAfter(this.$('.o_chatter_topbar')).then(function(){if(oldComposer){oldComposer.destroy();}
self._composer.focus();self._composer.on('post_message',self,function(messageData){self._discardOnReload(messageData).then(function(){self._disableComposer();self.fields.thread.postMessage(messageData).then(function(){self._closeComposer(true);if(self._reloadAfterPost(messageData)){self.trigger_up('reload',{keepChanges:true});}else if(messageData.attachment_ids.length){self._reloadAttachmentBox();self.trigger_up('reload',{fieldNames:['message_attachment_count'],keepChanges:true});}}).guardedCatch(function(){self._enableComposer();});});});self._composer.on('need_refresh',self,self.trigger_up.bind(self,'reload',{keepChanges:true}));self._composer.on('close_composer',null,self._closeComposer.bind(self,true));self.$el.addClass('o_chatter_composer_active');self.$('.o_chatter_button_new_message, .o_chatter_button_log_note').removeClass('o_active');self.$('.o_chatter_button_new_message').toggleClass('o_active',!self._composer.options.isLog);self.$('.o_chatter_button_log_note').toggleClass('o_active',self._composer.options.isLog);});},_reloadAfterPost:function(messageData){return this.postRefresh==='always'||(this.postRefresh==='recipients'&&messageData.partner_ids&&messageData.partner_ids.length);},_reloadAttachmentBox:function(){this._areAttachmentsLoaded=false;if(this._isAttachmentBoxOpen){this._fetchAttachments().then(this._openAttachmentBox.bind(this));}
if(this.fields.thread){this.trigger_up('reload',{fieldNames:['message_attachment_count'],keepChanges:true});}},_render:function(def){var self=this;var $spinner=$(QWeb.render('Spinner'));concurrency.rejectAfter(concurrency.delay(500),def).then(function(){$spinner.appendTo(self.$el);});var always=function(){self._isCreateMode?self._disableChatter():self._enableChatter();$spinner.remove();};return def.then(function(){if(self.fields.activity){self.fields.activity.$el.appendTo(self.$el);}
if(self.fields.followers){if(self._disableAttachmentBox){self.fields.followers.$el.appendTo(self.$('.o_topbar_right_area'));}else{self.fields.followers.$el.insertBefore(self.$('.o_chatter_button_attachment'));}}
if(self.fields.thread&&self.fields.thread.$el){self.fields.thread.$el.appendTo(self.$el);}}).then(always).guardedCatch(always);},_resetSuggestedPartners(){this._suggestedPartnersProm=undefined;},_renderButtons:function(){return QWeb.render('mail.chatter.Buttons',{newMessageButton:!!this.fields.thread,logNoteButton:this.hasLogButton,scheduleActivityButton:!!this.fields.activity,isMobile:config.device.isMobile,});},_setState:function(record){this._isCreateMode=!record.res_id;if(!this.record||this.record.res_id!==record.res_id){this.context={default_res_id:record.res_id||false,default_model:record.model||false,};this._resetSuggestedPartners();}
this.record=record;this.recordName=record.data.display_name;},_updateAttachmentCounter:function(){var count=this.record.data.message_attachment_count||0;var $element=this.$('.o_chatter_attachment_button_count');if(Number($element.html())!==count){this._areAttachmentsLoaded=false;$element.html(count);}},_updateMentionSuggestions:function(){if(!this.fields.followers){return;}
var self=this;this._mentionSuggestions=[];var followerSuggestions=[];var followers=this.fields.followers.getFollowers();_.each(followers,function(follower){if(follower.res_model==='res.partner'){followerSuggestions.push({id:follower.res_id,name:follower.name,email:follower.email,});}});if(followerSuggestions.length){this._mentionSuggestions.push(followerSuggestions);}
_.each(this._mentionPartnerSuggestions,function(partners){self._mentionSuggestions.push(_.filter(partners,function(partner){return!_.findWhere(followerSuggestions,{id:partner.id});}));});},_onDeleteAttachment:function(ev){ev.stopPropagation();var self=this;var options={confirm_callback:function(){self._rpc({model:'ir.attachment',method:'unlink',args:[parseInt(ev.data.attachmentId,10)],}).then(function(){self._reloadAttachmentBox();if(self.fields.thread){self.fields.thread.removeAttachments([ev.data.attachmentId]);}
self.trigger_up('reload',{keepChanges:true});});}};var promptText=_.str.sprintf(_t("Do you really want to delete %s?"),_.escape(ev.data.attachmentName));Dialog.confirm(this,promptText,options);},_onClickAttachmentButton:function(){if(this._disableAttachmentBox){return;}
if(this._isAttachmentBoxOpen){this._closeAttachments();}else{var def;if(!this._areAttachmentsLoaded){def=this._fetchAttachments();}
Promise.resolve(def).then(this._openAttachmentBox.bind(this));}},_onDiscardRecordChanges:function(ev){this._discardChanges().then(ev.data.proceed);},_onOpenComposerMessage:function(){var self=this;if(!this._suggestedPartnersProm){this._suggestedPartnersProm=new Promise(function(resolve,reject){self._rpc({route:'/mail/get_suggested_recipients',params:{model:self.record.model,res_ids:[self.context.default_res_id],},}).then(function(result){if(!self._suggestedPartnersProm){return;}
var suggested_partners=[];var thread_recipients=result[self.context.default_res_id];_.each(thread_recipients,function(recipient){var parsed_email=recipient[1]&&mailUtils.parseEmail(recipient[1]);suggested_partners.push({checked:true,partner_id:recipient[0],full_name:recipient[1],name:parsed_email[0],email_address:parsed_email[1],reason:recipient[2],});});resolve(suggested_partners);});});}
this._suggestedPartnersProm.then(function(suggested_partners){self._openComposer({isLog:false,suggested_partners:suggested_partners});});},_onOpenComposerNote:function(){this._openComposer({isLog:true});},_onReloadAttachmentBox:function(){if(this.reloadOnUploadAttachment){this.trigger_up('reload',{keepChanges:true});}
this._reloadAttachmentBox();},_onReloadMailFields:function(event){var fieldNames=[];if(this.fields.activity&&event.data.activity){fieldNames.push(this.fields.activity.name);}
if(this.fields.followers&&event.data.followers){fieldNames.push(this.fields.followers.name);}
if(this.fields.thread&&event.data.thread){fieldNames.push(this.fields.thread.name);}
this.trigger_up('reload',{fieldNames:fieldNames,keepChanges:true,});},_onResetSuggestedPartners(ev){ev.stopPropagation();this._resetSuggestedPartners();},_onScheduleActivity:function(){this.fields.activity.scheduleActivity();},});return Chatter;});;

/* /mail/static/src/js/followers.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Followers',function(require){"use strict";var AbstractField=require('web.AbstractField');var concurrency=require('web.concurrency');var core=require('web.core');var Dialog=require('web.Dialog');var field_registry=require('web.field_registry');var _t=core._t;var QWeb=core.qweb;var Followers=AbstractField.extend({template:'mail.Followers',events:{'click .o_followers_follow_button':'_onFollowButtonClicked','click .o_subtypes_list .custom-checkbox':'_onSubtypeClicked','click .o_add_follower':'_onAddFollower','click .o_add_follower_channel':'_onAddChannel','click .o_edit_subtype':'_onEditSubtype','click .o_remove_follower':'_onRemoveFollower','click .o_mail_redirect':'_onRedirect',},init:function(parent,name,record,options){this._super.apply(this,arguments);this.image=this.attrs.image||'image_128';this.comment=this.attrs.help||false;this.followers=[];this.subtypes=[];this.data_subtype={};this._isFollower=undefined;var session=this.getSession();this.partnerID=session.partner_id;this.dp=new concurrency.DropPrevious();options=options||{};this.isEditable=options.isEditable;},_render:function(){var self=this;var fetch_def=this.dp.add(this._readFollowers());concurrency.rejectAfter(concurrency.delay(0),fetch_def).then(this._displayGeneric.bind(this));return fetch_def.then(function(){self._displayButtons();self._displayFollowers(self.followers);if(self.subtypes){self._displaySubtypes(self.subtypes);}});},isSet:function(){return true;},_reset:function(record){this._super.apply(this,arguments);this.res_id=record.res_id;},getFollowers:function(){return this.followers;},_displayButtons:function(){if(this._isFollower){this.$('button.o_followers_follow_button').removeClass('o_followers_notfollow').addClass('o_followers_following');this.$('.o_subtypes_list > .dropdown-toggle').attr('disabled',false);this.$('.o_followers_actions .dropdown-toggle').addClass('o_followers_following');}else{this.$('button.o_followers_follow_button').removeClass('o_followers_following').addClass('o_followers_notfollow');this.$('.o_subtypes_list > .dropdown-toggle').attr('disabled',true);this.$('.o_followers_actions .dropdown-toggle').removeClass('o_followers_following');}
this.$('button.o_followers_follow_button').attr("aria-pressed",this.is_follower);},_displayGeneric:function(){this.$('.o_followers_actions').hide();this.$('.o_followers_title_box > button').prop('disabled',true);this.$('.o_followers_count').html(this.value.res_ids.length).parent().attr('title',this._formatFollowers(this.value.res_ids.length));},_displayFollowers:function(){var self=this;var $followers_list=this.$('.o_followers_list').empty();$(QWeb.render('mail.Followers.add_more',{widget:this})).appendTo($followers_list);var $follower_li;_.each(this.followers,function(record){if(!record.active){record.title=_.str.sprintf(_t('%s \n(inactive)'),record.name);}else{record.title=record.name;}
$follower_li=$(QWeb.render('mail.Followers.partner',{'record':_.extend(record,{'avatar_url':'/web/image/'+record.res_model+'/'+record.res_id+'/image_128'}),'widget':self}));$follower_li.appendTo($followers_list);if(record.is_editable){$follower_li.on('mouseenter mouseleave',function(e){$(e.currentTarget).find('.o_edit_subtype').toggleClass('d-none',e.type==='mouseleave');});}});this.$('.o_followers_actions').show();this.$('.o_followers_title_box > button').prop('disabled',!$followers_list.children().length);this.$('.o_followers_count').html(this.value.res_ids.length).parent().attr('title',this._formatFollowers(this.value.res_ids.length));},_displaySubtypes:function(data,dialog,display_warning){var old_parent_model;var $list;if(dialog){$list=$('<div>').appendTo(this.dialog.$el);}else{$list=this.$('.o_subtypes_list .dropdown-menu');}
$list.empty();this.data_subtype=data;_.each(data,function(record){if(old_parent_model!==record.parent_model&&old_parent_model!==undefined){$list.append($('<div>',{class:'dropdown-divider'}));}
old_parent_model=record.parent_model;record.followed=record.followed||undefined;$list.append(QWeb.render('mail.Followers.subtype',{'record':record,'dialog':dialog,'display_warning':display_warning&&record.internal,}));});if(display_warning){$(QWeb.render('mail.Followers.subtypes.warning')).appendTo(this.dialog.$el);}},_inviteFollower:function(channel_only){var action={type:'ir.actions.act_window',res_model:'mail.wizard.invite',view_mode:'form',views:[[false,'form']],name:_t("Invite Follower"),target:'new',context:{'default_res_model':this.model,'default_res_id':this.res_id,'mail_invite_follower_channel_only':channel_only,},};this.do_action(action,{on_close:this._reload.bind(this),});},_formatFollowers:function(count){var str='';if(count<=0){str=_t("No follower");}else if(count===1){str=_t("One follower");}else{str=''+count+' '+_t("followers");}
return str;},_readFollowers:function(){var self=this;var missing_ids=_.difference(this.value.res_ids,_.pluck(this.followers,'id'));var def;if(missing_ids.length){def=this._rpc({route:'/mail/read_followers',params:{follower_ids:missing_ids,res_model:this.model,context:{}}});}
return Promise.resolve(def).then(function(results){if(results){self.followers=_.uniq(results.followers.concat(self.followers),'id');if(results.subtypes){self.subtypes=results.subtypes;}}
self.followers=_.filter(self.followers,function(follower){return _.contains(self.value.res_ids,follower.id);});var user_follower=_.filter(self.followers,function(rec){return rec.is_uid;});self._isFollower=user_follower.length>=1;});},_reload:function(){this.trigger_up('reload',{fieldNames:[this.name],keepChanges:true});},_follow:function(){var kwargs={partner_ids:[this.partnerID],context:{},};this._rpc({model:this.model,method:'message_subscribe',args:[[this.res_id]],kwargs:kwargs,}).then(this._reload.bind(this));},_messageUnsubscribe:function(ids){return this._rpc({model:this.model,method:'message_unsubscribe',args:[[this.res_id],ids.partner_ids,ids.channel_ids],}).then(this._reload.bind(this));},_unfollow:function(ids){var self=this;if(_.isEqual(ids.partner_ids,[this.partnerID])&&_.isEmpty(ids.channel_ids)){return this._messageUnsubscribe(ids);}
return new Promise(function(resolve,reject){var follower=_.find(self.followers,{res_id:ids.partner_ids?ids.partner_ids[0]:ids.channel_ids[0]});var text=_.str.sprintf(_t("If you remove a follower, he won't be notified of any email or discussion on this document. Do you really want to remove %s?"),follower.name);Dialog.confirm(this,text,{title:_t("Warning"),confirm_callback:function(){self._messageUnsubscribe(ids);resolve();},cancel_callback:reject,});});},_updateSubscription:function(event,followerID,isChannel){var ids={};var subtypes;if(followerID!==undefined){subtypes=this.dialog.$('input[type="checkbox"]');if(isChannel){ids.channel_ids=[followerID];}else{ids.partner_ids=[followerID];}}else{subtypes=this.$('.o_followers_actions input[type="checkbox"]');ids.partner_ids=[this.partnerID];}
var checklist=[];_.each(subtypes,function(record){if($(record).is(':checked')){checklist.push(parseInt($(record).data('id')));}});if(!checklist.length){this._unfollow(ids).guardedCatch(function(){$(event.currentTarget).find('input').addBack('input').prop('checked',true);});}else{var kwargs=_.extend({},ids);if(followerID===undefined||followerID===this.partnerID){_.each(this.subtypes,function(subtype){subtype.followed=checklist.indexOf(subtype.id)>-1;});}
kwargs.subtype_ids=checklist;kwargs.context={};this._rpc({model:this.model,method:'message_subscribe',args:[[this.res_id]],kwargs:kwargs,}).then(this._reload.bind(this));}},_onAddFollower:function(ev){ev.preventDefault();this._inviteFollower(false);},_onAddChannel:function(ev){ev.preventDefault();this._inviteFollower(true);},_onEditSubtype:function(ev){var self=this;var $currentTarget=$(ev.currentTarget);var follower_id=$currentTarget.data('follower-id');this._rpc({route:'/mail/read_subscription_data',params:{res_model:this.model,follower_id:follower_id},}).then(function(data){var res_id=$currentTarget.data('oe-id');var is_channel=$currentTarget.data('oe-model')==='mail.channel';self.dialog=new Dialog(this,{size:'medium',title:_t("Edit Subscription of ")+$currentTarget.siblings('a').text(),buttons:[{text:_t("Apply"),classes:'btn-primary',click:function(){self._updateSubscription(ev,res_id,is_channel);},close:true},{text:_t("Cancel"),close:true,},],});self.dialog.opened().then(function(){self._displaySubtypes(data,true,is_channel);});self.dialog.open();});},_onFollowButtonClicked:function(){if(!this._isFollower){this._follow();}else{this._unfollow({partner_ids:[this.partnerID]});}},_onRedirect:function(ev){ev.preventDefault();var $target=$(ev.target).closest('.o_mail_redirect');this.do_action({type:'ir.actions.act_window',view_mode:'form',res_model:$target.data('oe-model'),views:[[false,'form']],res_id:$target.data('oe-id'),});},_onRemoveFollower:function(ev){var resModel=$(ev.target).parent().find('a').data('oe-model');var resID=$(ev.target).parent().find('a').data('oe-id');if(resModel==='res.partner'){return this._unfollow({partner_ids:[resID]});}else{return this._unfollow({channel_ids:[resID]});}},_onSubtypeClicked:function(ev){ev.stopPropagation();this._updateSubscription(ev);var $list=this.$('.o_subtypes_list');if(!$list.hasClass('show')){$list.addClass('show');}
if(this.$('.o_subtypes_list .dropdown-menu')[0].children.length<1){$list.removeClass('show');}},});field_registry.add('mail_followers',Followers);return Followers;});;

/* /mail/static/src/js/form_controller.js defined in bundle 'web.assets_backend' */
odoo.define('mail.form_controller',function(require){"use strict";var FormController=require('web.FormController');FormController.include({custom_events:_.extend({},FormController.prototype.custom_events,{new_message:'_onNewMessage',}),_onNewMessage:function(ev){this.model.updateMessageIDs(ev.data.id,ev.data.messageIDs);},});});;

/* /mail/static/src/js/form_view.js defined in bundle 'web.assets_backend' */
odoo.define('mail.FormView',function(require){"use strict";var FormView=require('web.FormView');FormView.include({init:function(){this._super.apply(this,arguments);var fieldsInfo=this.fieldsInfo[this.viewType];if('message_ids'in fieldsInfo&&!('message_attachment_count'in fieldsInfo)){fieldsInfo.message_attachment_count={};}},});});;

/* /mail/static/src/js/form_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('mail.form_renderer',function(require){"use strict";var Chatter=require('mail.Chatter');var FormRenderer=require('web.FormRenderer');FormRenderer.include({init:function(parent,state,params){this._super.apply(this,arguments);this.mailFields=params.mailFields;this.chatter=undefined;this.isFromFormViewDialog=params.isFromFormViewDialog;},confirmChange:function(state,id,fields){if(this.chatter){var chatterFields=['message_attachment_count'].concat(_.values(this.mailFields));var updatedMailFields=_.intersection(fields,chatterFields);if(updatedMailFields.length){this.chatter.update(state,updatedMailFields);}}
return this._super.apply(this,arguments);},_renderNode:function(node){var self=this;if(node.tag==='div'&&node.attrs.class==='oe_chatter'){if(this.isFromFormViewDialog){return $('<div/>');}
if(!this.chatter){this.chatter=new Chatter(this,this.state,this.mailFields,{isEditable:this.activeActions.edit,viewType:'form',});var $temporaryParentDiv=$('<div>');this.defs.push(this.chatter.appendTo($temporaryParentDiv).then(function(){self.chatter.$el.unwrap();self._handleAttributes(self.chatter.$el,node);}));return $temporaryParentDiv;}else{this.chatter.update(this.state);return this.chatter.$el;}}else{return this._super.apply(this,arguments);}},});});;

/* /mail/static/src/js/basic_model.js defined in bundle 'web.assets_backend' */
odoo.define('mail.basic_model',function(require){"use strict";var BasicModel=require('web.BasicModel');BasicModel.include({updateMessageIDs:function(id,msgIDs){var element=this.localData[id];element.res_ids=msgIDs;element.count=msgIDs.length;},});});;

/* /mail/static/src/js/basic_view.js defined in bundle 'web.assets_backend' */
odoo.define('mail.BasicView',function(require){"use strict";var BasicView=require('web.BasicView');var mailWidgets=['mail_followers','mail_thread','mail_activity','kanban_activity'];BasicView.include({init:function(){this._super.apply(this,arguments);this.mailFields={};var fieldsInfo=this.fieldsInfo[this.viewType];for(var fieldName in fieldsInfo){var fieldInfo=fieldsInfo[fieldName];if(_.contains(mailWidgets,fieldInfo.widget)){this.mailFields[fieldInfo.widget]=fieldName;fieldInfo.__no_fetch=true;}}
this.rendererParams.activeActions=this.controllerParams.activeActions;this.rendererParams.mailFields=this.mailFields;},});});;

/* /mail/static/src/js/thread_field.js defined in bundle 'web.assets_backend' */
odoo.define('mail.ThreadField',function(require){"use strict";var CreateModeDocumentThread=require('mail.model.CreateModeDocumentThread');var ThreadWidget=require('mail.widget.Thread');var AbstractField=require('web.AbstractField');var core=require('web.core');var field_registry=require('web.field_registry');var concurrency=require('web.concurrency');var _t=core._t;var ThreadField=AbstractField.extend({init:function(){this._super.apply(this,arguments);this._isMessagingReady=this.call('mail_service','isReady');this._isStarted=false;this.call('mail_service','getMailBus').on('messaging_ready',this,this._onMessagingReady);this._markAsReadOnNextRender=false;this._setDocumentThread();},start:function(){var self=this;this._isStarted=true;this.dp=new concurrency.DropPrevious();this._threadWidget=new ThreadWidget(this,{displayOrder:ThreadWidget.ORDER.DESC,displayDocumentLinks:false,displayMarkAsRead:false,hasMessageAttachmentDeletable:true,squashCloseMessages:false,});this._threadWidget.on('load_more_messages',this,this._onLoadMoreMessages);this._threadWidget.on('redirect',this,this._onRedirect);this._threadWidget.on('redirect_to_channel',this,this._onRedirectToChannel);this._threadWidget.on('toggle_star_status',this,function(messageID){var message=self.call('mail_service','getMessage',messageID);message.toggleStarStatus();});var def1=this._threadWidget.appendTo(this.$el);var def2=this._super.apply(this,arguments);return this.alive(Promise.all([def1,def2])).then(function(){self.setElement(self._threadWidget.$el);var mailBus=self.call('mail_service','getMailBus');mailBus.on('new_message',self,self._onNewMessage);mailBus.on('update_message',self,self._onUpdateMessage);});},removeAttachments:function(attachmentIDs){this._documentThread.removeAttachmentsFromMessages(attachmentIDs);},isSet:function(){return true;},postMessage:function(message){var self=this;return this._documentThread.postMessage(message).then(function(){if(message.partner_ids.length){self.trigger_up('reload_mail_fields',{followers:true});}}).guardedCatch(function(){self.do_notify(_t("Sending Error"),_t("Your message has not been sent."));return Promise.reject();});},_fetchAndRenderThread:function(options){var self=this;if(!this._isMessagingReady){self._threadWidget.renderLoading();return Promise.resolve();}else if(!this._documentThread){var thread=new CreateModeDocumentThread();options={isCreateMode:true};self._threadWidget.render(thread,options);return Promise.resolve();}else{var fetchDef=this.dp.add(this._documentThread.fetchMessages(options));return fetchDef.then(function(){self._threadWidget.render(self._documentThread,{displayLoadMore:self._documentThread.getMessages().length<self._documentThread.getMessageIDs().length,});if(self._markAsReadOnNextRender){self._markAsReadOnNextRender=false;return self._documentThread.markAsRead();}});}},_render:function(){return this._fetchAndRenderThread();},_reset:function(record){this._super.apply(this,arguments);this.res_id=record.res_id;this._setDocumentThread();},_setDocumentThread:function(){if(!this._isMessagingReady){return;}
var params={messageIDs:this.value.res_ids,name:this.recordData.display_name,resID:this.res_id,resModel:this.model,};if(!params.resID){this._documentThread=null;}else{this._documentThread=this.call('mail_service','getOrAddDocumentThread',params);this._markAsReadOnNextRender=true;}},_onLoadMoreMessages:function(){this._fetchAndRenderThread({forceFetch:true});},_onMessagingReady:function(){if(this._isMessagingReady){return;}
this._isMessagingReady=true;if(!this._isStarted){return;}
this._setDocumentThread();this._render();},_onNewMessage:function(message){if(message.isLinkedToDocumentThread()&&message.getDocumentModel()===this.model&&message.getDocumentID()===this.res_id){this.trigger_up('new_message',{id:this.value.id,messageIDs:this._documentThread.getMessageIDs(),});this._fetchAndRenderThread();}},_onRedirectToChannel:function(channelID){var self=this;this.call('mail_service','joinChannel',channelID).then(function(){self.do_action('mail.action_discuss',{active_id:channelID});});},_onRedirect:function(resModel,resID){this.trigger_up('redirect',{res_id:resID,res_model:resModel,});},_onUpdateMessage:function(message){if(message.isLinkedToDocumentThread()&&message.getDocumentModel()===this.model&&message.getDocumentID()===this.res_id){this._fetchAndRenderThread();}},});field_registry.add('mail_thread',ThreadField);return ThreadField;});;

/* /mail/static/src/js/thread_widget.js defined in bundle 'web.assets_backend' */
odoo.define('mail.widget.Thread',function(require){"use strict";var DocumentViewer=require('mail.DocumentViewer');var mailUtils=require('mail.utils');var core=require('web.core');var time=require('web.time');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var _lt=core._lt;var ORDER={ASC:1,DESC:-1,};var READ_MORE=_lt("read more");var READ_LESS=_lt("read less");var ThreadWidget=Widget.extend({className:'o_mail_thread',events:{'click a':'_onClickRedirect','click img':'_onClickRedirect','click strong':'_onClickRedirect','click .o_thread_show_more':'_onClickShowMore','click .o_attachment_download':'_onAttachmentDownload','click .o_attachment_view':'_onAttachmentView','click .o_attachment_delete_cross':'_onDeleteAttachment','click .o_thread_message_needaction':'_onClickMessageNeedaction','click .o_thread_message_star':'_onClickMessageStar','click .o_thread_message_reply':'_onClickMessageReply','click .oe_mail_expand':'_onClickMailExpand','click .o_thread_message':'_onClickMessage','click':'_onClick','click .o_thread_message_email_exception':'_onClickEmailException','click .o_thread_message_email_bounce':'_onClickEmailException','click .o_thread_message_moderation':'_onClickMessageModeration','change .moderation_checkbox':'_onChangeModerationCheckbox',},init:function(parent,options){this._super.apply(this,arguments);this.attachments=[];this._enabledOptions=_.defaults(options||{},{displayOrder:ORDER.ASC,displayMarkAsRead:true,displayModerationCommands:false,displayStars:true,displayDocumentLinks:true,displayAvatars:true,squashCloseMessages:true,displayEmailIcons:true,displayReplyIcons:false,loadMoreOnScroll:false,hasMessageAttachmentDeletable:false,});this._disabledOptions={displayOrder:this._enabledOptions.displayOrder,displayMarkAsRead:false,displayModerationCommands:false,displayStars:false,displayDocumentLinks:false,displayAvatars:this._enabledOptions.displayAvatars,squashCloseMessages:false,displayEmailIcons:false,displayReplyIcons:false,loadMoreOnScroll:this._enabledOptions.loadMoreOnScroll,hasMessageAttachmentDeletable:false,};this._selectedMessageID=null;this._currentThreadID=null;this._messageMailPopover=null;this._messageSeenPopover=null;this._openedSeenPopoverIDs=[];},destroy:function(){clearInterval(this._updateTimestampsInterval);if(this._messageMailPopover){this._messageMailPopover.popover('hide');}
if(this._messageSeenPopover){this._messageSeenPopover.popover('hide');}
this._destroyOpenSeenPopoverIDs();this._super();},render:function(thread,options){var self=this;var shouldScrollToBottomAfterRendering=false;if(this._currentThreadID===thread.getID()&&this.isAtBottom()){shouldScrollToBottomAfterRendering=true;}
this._currentThreadID=thread.getID();var messages=_.clone(thread.getMessages({domain:options.domain||[]}));this._messages=messages;var modeOptions=options.isCreateMode?this._disabledOptions:this._enabledOptions;this.attachments=_.uniq(_.flatten(_.map(messages,function(message){return message.getAttachments();})));options=_.extend({},modeOptions,options,{selectedMessageID:this._selectedMessageID,});var displayAuthorMessages={};var prevMessage;_.each(messages,function(message){if(!prevMessage||(Math.abs(message.getDate().diff(prevMessage.getDate()))>60000)||prevMessage.getType()!=='comment'||message.getType()!=='comment'||(prevMessage.getAuthorID()!==message.getAuthorID())||((prevMessage.isLinkedToDocumentThread()&&message.isLinkedToDocumentThread())&&(prevMessage.getDocumentModel()!==message.getDocumentModel()||prevMessage.getDocumentID()!==message.getDocumentID()))){displayAuthorMessages[message.getID()]=true;}else{displayAuthorMessages[message.getID()]=!options.squashCloseMessages;}
prevMessage=message;});if(modeOptions.displayOrder===ORDER.DESC){messages.reverse();}
this.$el.html(QWeb.render('mail.widget.Thread',{thread:thread,displayAuthorMessages:displayAuthorMessages,options:options,ORDER:ORDER,dateFormat:time.getLangDatetimeFormat(),}));_.each(messages,function(message){var $message=self.$('.o_thread_message[data-message-id="'+message.getID()+'"]');$message.find('.o_mail_timestamp').data('date',message.getDate());self._insertReadMore($message);});if(shouldScrollToBottomAfterRendering){this.scrollToBottom();}
if(!this._updateTimestampsInterval){this.updateTimestampsInterval=setInterval(function(){self._updateTimestamps();},1000*60);}
this._renderMessageMailPopover(messages);if(thread.hasSeenFeature()){this._renderMessageSeenPopover(thread,messages);}},renderLoading:function(){this.$el.html(QWeb.render('mail.widget.ThreadLoading'));},getScrolltop:function(){return this.$el.scrollTop();},isAtBottom:function(){var fullHeight=this.el.scrollHeight;var topHiddenHeight=this.$el.scrollTop();var visibleHeight=this.$el.outerHeight();var bottomHiddenHeight=fullHeight-topHiddenHeight-visibleHeight;return bottomHiddenHeight<5;},removeMessageAndRender:function(messageID,thread,options){var self=this;return new Promise(function(resolve,reject){self.$('.o_thread_message[data-message-id="'+messageID+'"]').fadeOut({done:function(){self.render(thread,options);resolve();},duration:200,});});},scrollToBottom:function(){this.$el.scrollTop(this.el.scrollHeight);},scrollToMessage:function(options){var $target=this.$('.o_thread_message[data-message-id="'+options.messageID+'"]');if(options.onlyIfNecessary){var delta=$target.parent().height()-$target.height();var offset=delta<0?0:delta-($target.offset().top-$target.offsetParent().offset().top);offset=-Math.min(offset,0);this.$el.scrollTo("+="+offset+"px",options.duration);}else if($target.length){this.$el.scrollTo($target);}},scrollToPosition:function(position){if(position){this.$el.scrollTop(position);}else{this.scrollToBottom();}},toggleModerationCheckboxes:function(checked){this.$('.moderation_checkbox').prop('checked',checked);},unselectMessage:function(){this.$('.o_thread_message').removeClass('o_thread_selected_message');this._selectedMessageID=null;},_destroyOpenSeenPopoverIDs:function(){_.each(this._openedSeenPopoverIDs,function(popoverID){$('#'+popoverID).remove();});this._openedSeenPopoverIDs=[];},_insertReadMore:function($element){var self=this;var groups=[];var readMoreNodes;var $children=$element.contents().filter(function(){return this.nodeType===1||this.nodeType===3&&this.nodeValue.trim();});_.each($children,function(child){var $child=$(child);if(child.nodeType===3&&$child.prevAll('[id*="stopSpelling"]').length>0){$child=$('<span>',{text:child.textContent,'data-o-mail-quote':'1',});child.parentNode.replaceChild($child[0],child);}
if($child.attr('data-o-mail-quote')||($child.get(0).nodeName==='BR'&&$child.prev('[data-o-mail-quote="1"]').length>0)){if(!readMoreNodes){readMoreNodes=[];groups.push(readMoreNodes);}
$child.hide();readMoreNodes.push($child);}else{readMoreNodes=undefined;self._insertReadMore($child);}});_.each(groups,function(group){var $readMore=$('<a>',{class:'o_mail_read_more',href:'#',text:READ_MORE,}).insertBefore(group[0]);var isReadMore=true;$readMore.click(function(e){e.preventDefault();isReadMore=!isReadMore;_.each(group,function($child){$child.hide();$child.toggle(!isReadMore);});$readMore.text(isReadMore?READ_MORE:READ_LESS);});});},_onDeleteAttachment:function(ev){ev.stopPropagation();var $target=$(ev.currentTarget);this.trigger_up('delete_attachment',{attachmentId:$target.data('id'),attachmentName:$target.data('name')});},_redirect:_.debounce(function(options){if('channelID'in options){this.trigger('redirect_to_channel',options.channelID);}else{this.trigger('redirect',options.model,options.id);}},500,true),_renderMessageMailPopover:function(messages){if(this._messageMailPopover){this._messageMailPopover.popover('hide');}
if(!this.$('.o_thread_tooltip').length){return;}
this._messageMailPopover=this.$('.o_thread_tooltip').popover({html:true,boundary:'viewport',placement:'auto',trigger:'hover',offset:'0, 1',content:function(){var messageID=$(this).data('message-id');var message=_.find(messages,function(message){return message.getID()===messageID;});return QWeb.render('mail.widget.Thread.Message.MailTooltip',{data:message.hasCustomerEmailData()?message.getCustomerEmailData():[],});},});},_renderMessageSeenPopover:function(thread,messages){var self=this;this._destroyOpenSeenPopoverIDs();if(this._messageSeenPopover){this._messageSeenPopover.popover('hide');}
if(!this.$('.o_thread_message_core .o_mail_thread_message_seen_icon').length){return;}
this._messageSeenPopover=this.$('.o_thread_message_core .o_mail_thread_message_seen_icon').popover({html:true,boundary:'viewport',placement:'auto',trigger:'hover',offset:'0, 1',content:function(){var $this=$(this);self._openedSeenPopoverIDs.push($this.attr('aria-describedby'));var messageID=$this.data('message-id');var message=_.find(messages,function(message){return message.getID()===messageID;});return QWeb.render('mail.widget.Thread.Message.SeenIconPopoverContent',{thread:thread,message:message,});},});},_updateTimestamps:function(){var isAtBottom=this.isAtBottom();this.$('.o_mail_timestamp').each(function(){var date=$(this).data('date');$(this).html(mailUtils.timeFromNow(date));});if(isAtBottom&&!this.isAtBottom()){this.scrollToBottom();}},_onAttachmentDownload:function(event){event.stopPropagation();},_onAttachmentView:function(event){event.stopPropagation();var activeAttachmentID=$(event.currentTarget).data('id');if(activeAttachmentID){var attachmentViewer=new DocumentViewer(this,this.attachments,activeAttachmentID);attachmentViewer.appendTo($('body'));}},_onChangeModerationCheckbox:function(ev){this.trigger_up('update_moderation_buttons');},_onClick:function(){if(this._selectedMessageID){this.unselectMessage();this.trigger('unselect_message');}},_onClickEmailException:function(ev){var messageID=$(ev.currentTarget).data('message-id');this.do_action('mail.mail_resend_message_action',{additional_context:{mail_message_to_resend:messageID}});},_onClickMailExpand:function(ev){ev.preventDefault();},_onClickMessage:function(ev){$(ev.currentTarget).toggleClass('o_thread_selected_message');},_onClickMessageNeedaction:function(ev){var messageID=$(ev.currentTarget).data('message-id');this.trigger('mark_as_read',messageID);},_onClickMessageReply:function(ev){this._selectedMessageID=$(ev.currentTarget).data('message-id');this.$('.o_thread_message').removeClass('o_thread_selected_message');this.$('.o_thread_message[data-message-id="'+this._selectedMessageID+'"]').addClass('o_thread_selected_message');this.trigger('select_message',this._selectedMessageID);ev.stopPropagation();},_onClickMessageStar:function(ev){var messageID=$(ev.currentTarget).data('message-id');this.trigger('toggle_star_status',messageID);},_onClickMessageModeration:function(ev){var $button=$(ev.currentTarget);var messageID=$button.data('message-id');var decision=$button.data('decision');this.trigger_up('message_moderation',{messageID:messageID,decision:decision,});},_onClickRedirect:function(ev){if($(ev.target).data('oe-field')!==undefined){return;}
var id=$(ev.target).data('oe-id');if(id){ev.preventDefault();var model=$(ev.target).data('oe-model');var options;if(model&&(model!=='mail.channel')){options={model:model,id:id};}else{options={channelID:id};}
this._redirect(options);}},_onClickShowMore:function(){this.trigger('load_more_messages');},});ThreadWidget.ORDER=ORDER;return ThreadWidget;});;

/* /mail/static/src/js/systray/systray_activity_menu.js defined in bundle 'web.assets_backend' */
odoo.define('mail.systray.ActivityMenu',function(require){"use strict";var core=require('web.core');var session=require('web.session');var SystrayMenu=require('web.SystrayMenu');var Widget=require('web.Widget');var QWeb=core.qweb;var ActivityMenu=Widget.extend({name:'activity_menu',template:'mail.systray.ActivityMenu',events:{'click .o_mail_activity_action':'_onActivityActionClick','click .o_mail_preview':'_onActivityFilterClick','show.bs.dropdown':'_onActivityMenuShow','hide.bs.dropdown':'_onActivityMenuHide',},start:function(){this._$activitiesPreview=this.$('.o_mail_systray_dropdown_items');this.call('mail_service','getMailBus').on('activity_updated',this,this._updateCounter);this._updateCounter();this._updateActivityPreview();return this._super();},_getActivityData:function(){var self=this;return self._rpc({model:'res.users',method:'systray_get_activities',args:[],kwargs:{context:session.user_context},}).then(function(data){self._activities=data;self.activityCounter=_.reduce(data,function(total_count,p_data){return total_count+p_data.total_count||0;},0);self.$('.o_notification_counter').text(self.activityCounter);self.$el.toggleClass('o_no_notification',!self.activityCounter);});},_getActivityModelViewID:function(model){return this._rpc({model:model,method:'get_activity_view_id'});},_updateActivityPreview:function(){var self=this;self._getActivityData().then(function(){self._$activitiesPreview.html(QWeb.render('mail.systray.ActivityMenu.Previews',{widget:self}));});},_updateCounter:function(data){if(data){if(data.activity_created){this.activityCounter++;}
if(data.activity_deleted&&this.activityCounter>0){this.activityCounter--;}
this.$('.o_notification_counter').text(this.activityCounter);this.$el.toggleClass('o_no_notification',!this.activityCounter);}},_onActivityActionClick:function(ev){ev.stopPropagation();this.$('.dropdown-toggle').dropdown('toggle');var targetAction=$(ev.currentTarget);var actionXmlid=targetAction.data('action_xmlid');if(actionXmlid){this.do_action(actionXmlid);}else{this.do_action({type:'ir.actions.act_window',name:targetAction.data('model_name'),views:[[false,'activity'],[false,'kanban'],[false,'list'],[false,'form']],view_mode:'activity',res_model:targetAction.data('res_model'),domain:[['activity_ids.user_id','=',session.uid]],});}},_onActivityFilterClick:function(event){var data=_.extend({},$(event.currentTarget).data(),$(event.target).data());var context={};if(data.filter==='my'){context['search_default_activities_overdue']=1;context['search_default_activities_today']=1;}else{context['search_default_activities_'+data.filter]=1;}
context['force_search_count']=1;this.do_action({type:'ir.actions.act_window',name:data.model_name,res_model:data.res_model,views:[[false,'kanban'],[false,'list'],[false,'form']],search_view_id:[false],domain:[['activity_user_id','=',session.uid]],context:context,},{clear_breadcrumbs:true,});},_onActivityMenuShow:function(){document.body.classList.add('modal-open');this._updateActivityPreview();},_onActivityMenuHide:function(){document.body.classList.remove('modal-open');},});SystrayMenu.Items.push(ActivityMenu);return ActivityMenu;});;

/* /mail/static/src/js/systray/systray_messaging_menu.js defined in bundle 'web.assets_backend' */
odoo.define('mail.systray.MessagingMenu',function(require){"use strict";var config=require('web.config');var core=require('web.core');var SystrayMenu=require('web.SystrayMenu');var Widget=require('web.Widget');var QWeb=core.qweb;var MessagingMenu=Widget.extend({name:'messaging_menu',template:'mail.systray.MessagingMenu',events:{'click .o_mail_preview':'_onClickPreview','click .o_filter_button':'_onClickFilterButton','click .o_new_message':'_onClickNewMessage','click .o_mail_preview_mark_as_read':'_onClickPreviewMarkAsRead','click .o_thread_window_expand':'_onClickExpand','show.bs.dropdown':'_onShowDropdown','hide.bs.dropdown':'_onHideDropdown',},start:function(){this._$filterButtons=this.$('.o_filter_button');this._$previews=this.$('.o_mail_systray_dropdown_items');this._filter=false;this._isMessagingReady=this.call('mail_service','isReady');this._updateCounter();var mailBus=this.call('mail_service','getMailBus');mailBus.on('messaging_ready',this,this._onMessagingReady);mailBus.on('update_needaction',this,this._updateCounter);mailBus.on('new_channel',this,this._updateCounter);mailBus.on('update_thread_unread_counter',this,this._updateCounter);return this._super.apply(this,arguments);},isMobile:function(){return config.device.isMobile;},_clickMailFailurePreview:function($target){var documentID=$target.data('document-id');var documentModel=$target.data('document-model');if(documentModel&&documentID){this._openDocument(documentModel,documentID);}else if(documentModel!=='mail.channel'){this.do_action({name:"Mail failures",type:'ir.actions.act_window',view_mode:'kanban,list,form',views:[[false,'kanban'],[false,'list'],[false,'form']],target:'current',res_model:documentModel,domain:[['message_has_error','=',true]],});}},_computeCounter:function(){var channels=this.call('mail_service','getChannels');var channelUnreadCounters=_.map(channels,function(channel){return channel.getUnreadCounter();});var unreadChannelCounter=_.reduce(channelUnreadCounters,function(acc,c){return c>0?acc+1:acc;},0);var inboxCounter=this.call('mail_service','getMailbox','inbox').getMailboxCounter();var mailFailureCounter=this.call('mail_service','getMailFailures').length;return unreadChannelCounter+inboxCounter+mailFailureCounter;},_getPreviews:function(){return this.call('mail_service','getSystrayPreviews',this._filter);},_isShown:function(){return this.$el.hasClass('show');},_markAsRead:function($preview){var previewID=$preview.data('preview-id');if(previewID==='mailbox_inbox'){var messageIDs=$preview.data('message-ids');if(typeof messageIDs==='string'){messageIDs=messageIDs.split(',').map(id=>Number(id));}else{messageIDs=[$preview.data('message-ids')];}
this.call('mail_service','markMessagesAsRead',messageIDs);}else if(previewID==='mail_failure'){var documentModel=$preview.data('document-model');var unreadCounter=$preview.data('unread-counter');this.do_action('mail.mail_resend_cancel_action',{additional_context:{default_model:documentModel,unread_counter:unreadCounter}});}else{var thread=this.call('mail_service','getThread',previewID);if(thread){thread.markAsRead();}}},_openDiscuss:function(channelID){var self=this;var discussOptions={clear_breadcrumbs:true};if(channelID){discussOptions.active_id=channelID;}
this.do_action('mail.action_discuss',discussOptions).then(function(){self.trigger_up('hide_home_menu');core.bus.trigger('change_menu_section',self.call('mail_service','getDiscussMenuID'));});},_openDocument:function(documentModel,documentID){if(documentModel==='mail.channel'){this._openDiscuss(documentID);}else{this.do_action({type:'ir.actions.act_window',res_model:documentModel,views:[[false,'form']],res_id:documentID});}},_renderPreviews:function(previews){this._$previews.html(QWeb.render('mail.systray.MessagingMenu.Previews',{previews:previews,}));},_updatePreviews:function(){this._$previews.html(QWeb.render('Spinner'));if(!this._isMessagingReady){return;}
this._getPreviews().then(this._renderPreviews.bind(this));},_updateCounter:function(){if(!this._isMessagingReady){return;}
var counter=this._computeCounter();this.$('.o_mail_messaging_menu_icon').removeClass('fa-spinner fa-spin');this.$('.o_notification_counter').text(counter);this.$el.toggleClass('o_no_notification',!counter);if(this._isShown()){this._updatePreviews();}},_onShowDropdown:function(){document.body.classList.add('modal-open');this._updatePreviews();},_onHideDropdown:function(){document.body.classList.remove('modal-open');},_onClickExpand:function(ev){ev.stopPropagation();var $preview=$(ev.currentTarget).closest('.o_mail_preview');var documentModel=$preview.data('document-model');var documentID=$preview.data('document-id');this._openDocument(documentModel,documentID);},_onClickFilterButton:function(ev){ev.stopPropagation();this._$filterButtons.removeClass('active');var $target=$(ev.currentTarget);$target.addClass('active');this._filter=$target.data('filter');this._updatePreviews();},_onClickNewMessage:function(){this.call('mail_service','openBlankThreadWindow');},_onClickPreview:function(ev){var $target=$(ev.currentTarget);var previewID=$target.data('preview-id');if(previewID==='mail_failure'){this._clickMailFailurePreview($target);}else if(previewID==='mailbox_inbox'){var documentID=$target.data('document-id');var documentModel=$target.data('document-model');if(!documentModel){this._openDiscuss('mailbox_inbox');}else{this._openDocument(documentModel,documentID);}}else{this.call('mail_service','openThread',previewID);}},_onClickPreviewMarkAsRead:function(ev){ev.stopPropagation();var $preview=$(ev.currentTarget).closest('.o_mail_preview');this._markAsRead($preview);},_onMessagingReady:function(){if(this._isMessagingReady){return;}
this._isMessagingReady=true;this._updateCounter();},});var activityMenuIndex=_.findIndex(SystrayMenu.Items,function(SystrayMenuItem){return SystrayMenuItem.prototype.name==='activity_menu';});if(activityMenuIndex>0){SystrayMenu.Items.splice(activityMenuIndex,0,MessagingMenu);}else{SystrayMenu.Items.push(MessagingMenu);}
return MessagingMenu;});;

/* /mail/static/src/js/tours/mail.js defined in bundle 'web.assets_backend' */
odoo.define('mail.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('mail_tour',{url:"/web#action=mail.discuss",},[{trigger:'.o_mail_discuss .o_mail_discuss_sidebar .o_add[data-type="multi_user_channel"]',content:_t("<p>Channels make it easy to organize information across different topics and groups.</p> <p>Try to <b>create your first channel</b> (e.g. sales, marketing, product XYZ, after work party, etc).</p>"),position:'bottom',},{trigger:'.o_mail_discuss .o_mail_discuss_sidebar .o_mail_add_thread[data-type="multi_user_channel"]',content:_t("<p>Create a channel here.</p>"),position:'bottom',auto:true,run:function(actions){var t=new Date().getTime();actions.text("SomeChannel_"+t,this.$anchor.find("input"));},},{trigger:".ui-autocomplete.o_mail_channel",content:_t("<p>Create a public or private channel.</p>"),position:'right',run:function(){this.$consumeEventAnchor.find('li:first').click();},},{trigger:'.o_mail_discuss .o_composer_text_field',content:_t("<p><b>Write a message</b> to the members of the channel here.</p> <p>You can notify someone with <i>'@'</i> or link another channel with <i>'#'</i>. Start your message with <i>'/'</i> to get the list of possible commands.</p>"),position:"top",width:350,run:function(actions){var t=new Date().getTime();actions.text("SomeText_"+t,this.$anchor);},},{trigger:'.o_mail_discuss .o_thread_composer .o_composer_button_send',content:_t("Post your message on the thread"),position:"top",},{trigger:'.o_mail_discuss .o_mail_thread .o_thread_message_star',content:_t("Messages can be <b>starred</b> to remind you to check back later."),position:"bottom",},{trigger:'.o_mail_discuss .o_mail_discuss_item[data-thread-id="mailbox_starred"]',content:_t("Once a message has been starred, you can come back and review it at any time here."),position:"bottom",},{trigger:'.o_mail_discuss .o_mail_discuss_sidebar .o_add[data-type="dm_chat"]',content:_t("<p><b>Chat with coworkers</b> in real-time using direct messages.</p><p><i>You might need to invite users from the Settings app first.</i></p>"),position:'bottom',}]);});;

/* /mail/static/src/js/user_menu.js defined in bundle 'web.assets_backend' */
odoo.define('mail.UserMenu',function(require){"use strict";var UserMenu=require('web.UserMenu');UserMenu.include({init:function(){this._super.apply(this,arguments);var session=this.getSession();this.outOfOfficeMessage=session.out_of_office_message;},});});;

/* /mail/static/src/js/tools/debug_manager.js defined in bundle 'web.assets_backend' */
odoo.define('mail.DebugManager.Backend',function(require){"use strict";var core=require('web.core');var DebugManager=require('web.DebugManager.Backend');var _t=core._t;DebugManager.include({getMailMessages:function(){var self=this;var selectedIDs=this._controller.getSelectedIds();if(!selectedIDs.length){console.warn(_t("No message available"));return;}
this.do_action({res_model:'mail.message',name:_t('Manage Messages'),views:[[false,'list'],[false,'form']],type:'ir.actions.act_window',domain:[['res_id','=',selectedIDs[0]],['model','=',this._controller.modelName]],context:{default_res_model:this._controller.modelName,default_res_id:selectedIDs[0],},});},});});;

/* /mail/static/src/js/filter_menu.js defined in bundle 'web.assets_backend' */
odoo.define('mail.FilterMenu',function(require){"use strict";var FilterMenu=require('web.FilterMenu');FilterMenu.include({init:function(){this._super.apply(this,arguments);this.fields=_.pick(this.fields,function(field,name){return field.relation!=='mail.message'&&name!=='message_ids';});},});});;

/* /mail/static/src/js/utils.js defined in bundle 'web.assets_backend' */
odoo.define('mail.utils',function(require){"use strict";var core=require('web.core');var _t=core._t;function parseAndTransform(htmlString,transformFunction){var openToken="OPEN"+Date.now();var string=htmlString.replace(/&lt;/g,openToken);var children;try{children=$('<div>').html(string).contents();}catch(e){children=$('<div>').html('<pre>'+string+'</pre>').contents();}
return _parseAndTransform(children,transformFunction).replace(new RegExp(openToken,"g"),"&lt;");}
function _parseAndTransform(nodes,transformFunction){return _.map(nodes,function(node){return transformFunction(node,function(){return _parseAndTransform(node.childNodes,transformFunction);});}).join("");}
var urlRegexp=/\b(?:https?:\/\/\d{1,3}(?:\.\d{1,3}){3}|(?:https?:\/\/|(?:www\.))[-a-z0-9@:%._+~#=\u00C0-\u024F\u1E00-\u1EFF]{2,256}\.[a-z]{2,13})\b(?:[-a-z0-9@:%_+.~#?&'$//=;\u00C0-\u024F\u1E00-\u1EFF]*)/gi;function linkify(text,attrs){attrs=attrs||{};if(attrs.target===undefined){attrs.target='_blank';}
if(attrs.target==='_blank'){attrs.rel='noreferrer noopener';}
attrs=_.map(attrs,function(value,key){return key+'="'+_.escape(value)+'"';}).join(' ');return text.replace(urlRegexp,function(url){var href=(!/^https?:\/\//i.test(url))?"http://"+url:url;return'<a '+attrs+' href="'+href+'">'+url+'</a>';});}
function addLink(node,transformChildren){if(node.nodeType===3){const linkified=linkify(node.data);if(linkified!==node.data){const div=document.createElement('div');div.innerHTML=linkified;for(const childNode of[...div.childNodes]){node.parentNode.insertBefore(childNode,node);}
node.parentNode.removeChild(node);return linkified;}
return node.textContent;}
if(node.tagName==="A")return node.outerHTML;transformChildren();return node.outerHTML;}
function htmlToTextContentInline(htmlString){const fragment=document.createDocumentFragment();const div=document.createElement('div');fragment.appendChild(div);try{div.innerHTML=htmlString;}catch(e){div.innerHTML=`<pre>${htmlString}</pre>`;}
return div.textContent.trim().replace(/[\n\r]/g,'').replace(/\s\s+/g,' ');}
function stripHTML(node,transformChildren){if(node.nodeType===3)return node.data;if(node.tagName==="BR")return"\n";return transformChildren();}
function inline(node,transform_children){if(node.nodeType===3)return node.data;if(node.nodeType===8)return"";if(node.tagName==="BR")return" ";if(node.tagName.match(/^(A|P|DIV|PRE|BLOCKQUOTE)$/))return transform_children();node.innerHTML=transform_children();return node.outerHTML;}
function parseEmail(text){if(text){var result=text.match(/(.*)<(.*@.*)>/);if(result){return[_.str.trim(result[1]),_.str.trim(result[2])];}
result=text.match(/(.*@.*)/);if(result){return[_.str.trim(result[1]),_.str.trim(result[1])];}
return[text,false];}}
function getTextToHTML(text){return text.replace(/((?:https?|ftp):\/\/[\S]+)/g,'<a href="$1">$1</a> ').replace(/[\n\r]/g,'<br/>');}
function timeFromNow(date){if(moment().diff(date,'seconds')<45){return _t("now");}
return date.fromNow();}
function o_clearTimeout(id){return clearTimeout(id);}
function o_setTimeout(func,delay){return setTimeout(func,delay);}
return{addLink:addLink,getTextToHTML:getTextToHTML,htmlToTextContentInline,inline:inline,linkify:linkify,parseAndTransform:parseAndTransform,parseEmail:parseEmail,stripHTML:stripHTML,timeFromNow:timeFromNow,clearTimeout:o_clearTimeout,setTimeout:o_setTimeout,};});;

/* /mail/static/src/js/activity.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Activity',function(require){"use strict";var mailUtils=require('mail.utils');var AbstractField=require('web.AbstractField');var BasicModel=require('web.BasicModel');var config=require('web.config');var core=require('web.core');var field_registry=require('web.field_registry');var session=require('web.session');var framework=require('web.framework');var time=require('web.time');var QWeb=core.qweb;var _t=core._t;function _readActivities(self,ids){if(!ids.length){return Promise.resolve([]);}
var context=self.getSession().user_context;if(self.record&&!_.isEmpty(self.record.getContext())){context=self.record.getContext();}
return self._rpc({model:'mail.activity',method:'activity_format',args:[ids],context:context,}).then(function(activities){_.each(activities,function(activity){activity.create_date=moment(time.auto_str_to_date(activity.create_date));activity.date_deadline=moment(time.auto_str_to_date(activity.date_deadline));});activities=_.sortBy(activities,'date_deadline');return activities;});}
BasicModel.include({_fetchSpecialActivity:function(record,fieldName){var localID=(record._changes&&fieldName in record._changes)?record._changes[fieldName]:record.data[fieldName];return _readActivities(this,this.localData[localID].res_ids);},});var setDelayLabel=function(activities){var today=moment().startOf('day');_.each(activities,function(activity){var toDisplay='';var diff=activity.date_deadline.diff(today,'days',true);if(diff===0){toDisplay=_t("Today");}else{if(diff<0){if(diff===-1){toDisplay=_t("Yesterday");}else{toDisplay=_.str.sprintf(_t("%d days overdue"),Math.abs(diff));}}else{if(diff===1){toDisplay=_t("Tomorrow");}else{toDisplay=_.str.sprintf(_t("Due in %d days"),Math.abs(diff));}}}
activity.label_delay=toDisplay;});return activities;};var setFileUploadID=function(activities){_.each(activities,function(activity){if(activity.activity_category==='upload_file'){activity.fileuploadID=_.uniqueId('o_fileupload');}});return activities;};var BasicActivity=AbstractField.extend({events:{'click .o_edit_activity':'_onEditActivity','change input.o_input_file':'_onFileChanged','click .o_mark_as_done':'_onMarkActivityDone','click .o_mark_as_done_upload_file':'_onMarkActivityDoneUploadFile','click .o_activity_template_preview':'_onPreviewMailTemplate','click .o_schedule_activity':'_onScheduleActivity','click .o_activity_template_send':'_onSendMailTemplate','click .o_unlink_activity':'_onUnlinkActivity',},init:function(){this._super.apply(this,arguments);this._draftFeedback={};},scheduleActivity:function(){var callback=this._reload.bind(this,{activity:true,thread:true});return this._openActivityForm(false,callback);},_markActivityDone:function(params){var activityID=params.activityID;var feedback=params.feedback||false;var attachmentIds=params.attachmentIds||[];return this._sendActivityFeedback(activityID,feedback,attachmentIds).then(this._reload.bind(this,{activity:true,thread:true}));},_markActivityDoneAndScheduleNext:function(params){var activityID=params.activityID;var feedback=params.feedback;var self=this;this._rpc({model:'mail.activity',method:'action_feedback_schedule_next',args:[[activityID]],kwargs:{feedback:feedback},context:this.record.getContext(),}).then(function(rslt_action){if(rslt_action){self.do_action(rslt_action,{on_close:function(){self.trigger_up('reload',{keepChanges:true});},});}else{self.trigger_up('reload',{keepChanges:true});}});},_openActivityForm:function(id,callback){var action={type:'ir.actions.act_window',name:_t("Schedule Activity"),res_model:'mail.activity',view_mode:'form',views:[[false,'form']],target:'new',context:{default_res_id:this.res_id,default_res_model:this.model,},res_id:id||false,};return this.do_action(action,{on_close:callback});},_sendActivityFeedback:function(activityID,feedback,attachmentIds){return this._rpc({model:'mail.activity',method:'action_feedback',args:[[activityID]],kwargs:{feedback:feedback,attachment_ids:attachmentIds||[],},context:this.record.getContext(),});},_bindOnUploadAction:function(activities){var self=this;_.each(activities,function(activity){if(activity.fileuploadID){$(window).on(activity.fileuploadID,function(){framework.unblockUI();var files=Array.prototype.slice.call(arguments,1);self._markActivityDone({activityID:activity.id,attachmentIds:_.pluck(files,'id')}).then(function(){self.trigger_up('reload');});});}});},_bindPopoverFocusout:function($popover_el){var self=this;var $popover=$($popover_el.data("bs.popover").tip);var activityID=$popover_el.data('activity-id');$popover.off('focusout');$popover.focusout(function(e){if(!$popover.is(e.relatedTarget)&&!$popover.find(e.relatedTarget).length){self._draftFeedback[activityID]=$popover.find('#activity_feedback').val();$popover.popover('hide');}});},_onEditActivity:function(ev){ev.preventDefault();var activityID=$(ev.currentTarget).data('activity-id');return this._openActivityForm(activityID,this._reload.bind(this,{activity:true,thread:true}));},_onFileChanged:function(ev){ev.stopPropagation();ev.preventDefault();var $form=$(ev.currentTarget).closest('form');$form.submit();framework.blockUI();},_onMarkActivityDone:function(ev){ev.stopPropagation();ev.preventDefault();var self=this;var $markDoneBtn=$(ev.currentTarget);var activityID=$markDoneBtn.data('activity-id');var previousActivityTypeID=$markDoneBtn.data('previous-activity-type-id')||false;var forceNextActivity=$markDoneBtn.data('force-next-activity');if($markDoneBtn.data('toggle')=='collapse'){var $actLi=$markDoneBtn.parents('.o_log_activity');var $panel=self.$('#o_activity_form_'+activityID);if(!$panel.data('bs.collapse')){var $form=$(QWeb.render('mail.activity_feedback_form',{previous_activity_type_id:previousActivityTypeID,force_next:forceNextActivity}));$panel.append($form);self._onMarkActivityDoneActions($markDoneBtn,$form,activityID);_.each($panel.siblings('.o_activity_form'),function(el){if($(el).data('bs.collapse')){$(el).empty().collapse('dispose').removeClass('show');}});$markDoneBtn.parents('.o_activity_log_container').scrollTo($actLi.position().top,100);}
$panel.on('hidden.bs.collapse',function(){if($panel.data('bs.collapse')){$actLi.removeClass('o_activity_selected');$panel.collapse('dispose');$panel.empty();}});this.$('.o_activity_selected').removeClass('o_activity_selected');$actLi.toggleClass('o_activity_selected');$panel.collapse('toggle');}else if(!$markDoneBtn.data('bs.popover')){$markDoneBtn.popover({template:$(Popover.Default.template).addClass('o_mail_activity_feedback')[0].outerHTML,container:$markDoneBtn,title:_t("Feedback"),html:true,trigger:'manual',placement:'right',content:function(){var $popover=$(QWeb.render('mail.activity_feedback_form',{previous_activity_type_id:previousActivityTypeID,force_next:forceNextActivity}));self._onMarkActivityDoneActions($markDoneBtn,$popover,activityID);return $popover;},}).on('shown.bs.popover',function(){var $popover=$($(this).data("bs.popover").tip);$(".o_mail_activity_feedback.popover").not($popover).popover("hide");$popover.addClass('o_mail_activity_feedback').attr('tabindex',0);$popover.find('#activity_feedback').focus();self._bindPopoverFocusout($(this));}).popover('show');}else{var popover=$markDoneBtn.data('bs.popover');if($('#'+popover.tip.id).length===0){popover.show();}}},_onMarkActivityDoneActions:function($btn,$form,activityID){var self=this;$form.find('#activity_feedback').val(self._draftFeedback[activityID]);$form.on('click','.o_activity_popover_done',function(ev){ev.stopPropagation();self._markActivityDone({activityID:activityID,feedback:$form.find('#activity_feedback').val(),});});$form.on('click','.o_activity_popover_done_next',function(ev){ev.stopPropagation();self._markActivityDoneAndScheduleNext({activityID:activityID,feedback:$form.find('#activity_feedback').val(),});});$form.on('click','.o_activity_popover_discard',function(ev){ev.stopPropagation();if($btn.data('bs.popover')){$btn.popover('hide');}else if($btn.data('toggle')=='collapse'){self.$('#o_activity_form_'+activityID).collapse('hide');}});},_onMarkActivityDoneUploadFile:function(ev){ev.preventDefault();ev.stopPropagation();var fileuploadID=$(ev.currentTarget).data('fileupload-id');var $input=this.$("[target='"+fileuploadID+"'] > input.o_input_file");$input.click();},_onPreviewMailTemplate:function(ev){ev.stopPropagation();ev.preventDefault();var self=this;var templateID=$(ev.currentTarget).data('template-id');var action={name:_t('Compose Email'),type:'ir.actions.act_window',res_model:'mail.compose.message',views:[[false,'form']],target:'new',context:{default_res_id:this.res_id,default_model:this.model,default_use_template:true,default_template_id:templateID,force_email:true,},};return this.do_action(action,{on_close:function(){self.trigger_up('reload',{keepChanges:true});}});},_onSendMailTemplate:function(ev){ev.stopPropagation();ev.preventDefault();var templateID=$(ev.currentTarget).data('template-id');return this._rpc({model:this.model,method:'activity_send_mail',args:[[this.res_id],templateID],}).then(this._reload.bind(this,{activity:true,thread:true,followers:true}));},_onScheduleActivity:function(ev){ev.preventDefault();return this._openActivityForm(false,this._reload.bind(this));},_onUnlinkActivity:function(ev,options){ev.preventDefault();var activityID=$(ev.currentTarget).data('activity-id');options=_.defaults(options||{},{model:'mail.activity',args:[[activityID]],});return this._rpc({model:options.model,method:'unlink',args:options.args,}).then(this._reload.bind(this,{activity:true}));},_unbindOnUploadAction:function(activities){_.each(activities,function(activity){if(activity.fileuploadID){$(window).off(activity.fileuploadID);}});},});var Activity=BasicActivity.extend({className:'o_mail_activity',events:_.extend({},BasicActivity.prototype.events,{'click a':'_onClickRedirect',}),specialData:'_fetchSpecialActivity',init:function(){this._super.apply(this,arguments);this._activities=this.record.specialData[this.name];},destroy:function(){this._unbindOnUploadAction();return this._super.apply(this,arguments);},_reload:function(fieldsToReload){this.trigger_up('reload_mail_fields',fieldsToReload);},_render:function(){_.each(this._activities,function(activity){var note=mailUtils.parseAndTransform(activity.note||'',mailUtils.inline);var is_blank=(/^\s*$/).test(note);if(!is_blank){activity.note=mailUtils.parseAndTransform(activity.note,mailUtils.addLink);}else{activity.note='';}});var activities=setFileUploadID(setDelayLabel(this._activities));if(activities.length){var nbActivities=_.countBy(activities,'state');this.$el.html(QWeb.render('mail.activity_items',{uid:session.uid,activities:activities,nbPlannedActivities:nbActivities.planned,nbTodayActivities:nbActivities.today,nbOverdueActivities:nbActivities.overdue,dateFormat:time.getLangDateFormat(),datetimeFormat:time.getLangDatetimeFormat(),session:session,widget:this,}));this._bindOnUploadAction(this._activities);}else{this._unbindOnUploadAction(this._activities);this.$el.empty();}},_reset:function(record){this._super.apply(this,arguments);this._activities=this.record.specialData[this.name];this.res_id=record.res_id;},_onClickRedirect:function(ev){var id=$(ev.currentTarget).data('oe-id');if(id){ev.preventDefault();var model=$(ev.currentTarget).data('oe-model');this.trigger_up('redirect',{res_id:id,res_model:model,});}},});var KanbanActivity=BasicActivity.extend({className:'o_mail_activity_kanban',template:'mail.KanbanActivity',events:_.extend({},BasicActivity.prototype.events,{'show.bs.dropdown':'_onDropdownShow',}),fieldDependencies:_.extend({},BasicActivity.prototype.fieldDependencies,{activity_exception_decoration:{type:'selection'},activity_exception_icon:{type:'char'}}),init:function(parent,name,record){this._super.apply(this,arguments);var selection={};_.each(record.fields.activity_state.selection,function(value){selection[value[0]]=value[1];});this.selection=selection;this._setState(record);},destroy:function(){this._unbindOnUploadAction();return this._super.apply(this,arguments);},_reload:function(){this.trigger_up('reload',{db_id:this.record_id,keepChanges:true});},_render:function(){const spanClasses=['fa','fa-lg','fa-fw'];spanClasses.push('o_activity_color_'+(this.activityState||'default'));if(this.recordData.activity_exception_decoration){spanClasses.push('text-'+this.recordData.activity_exception_decoration);spanClasses.push(this.recordData.activity_exception_icon);}else{spanClasses.push('fa-clock-o');}
this.$('.o_activity_btn > span').removeClass().addClass(spanClasses.join(' '));if(this.$el.hasClass('show')){this._renderDropdown();}},_renderDropdown:function(){var self=this;this.$('.o_activity').toggleClass('dropdown-menu-right',config.device.isMobile).html(QWeb.render('mail.KanbanActivityLoading'));return _readActivities(this,this.value.res_ids).then(function(activities){activities=setFileUploadID(activities);self.$('.o_activity').html(QWeb.render('mail.KanbanActivityDropdown',{selection:self.selection,records:_.groupBy(setDelayLabel(activities),'state'),session:session,widget:self,}));self._bindOnUploadAction(activities);});},_reset:function(record){this._super.apply(this,arguments);this._setState(record);},_setState:function(record){this.record_id=record.id;this.activityState=this.recordData.activity_state;},_onDropdownShow:function(){this._renderDropdown();},});var ActivityException=AbstractField.extend({noLabel:true,fieldDependencies:_.extend({},AbstractField.prototype.fieldDependencies,{activity_exception_icon:{type:'char'}}),_renderEdit:function(){return this._renderReadonly();},_renderReadonly:function(){this.$el.empty();if(this.value){this.$el.attr({'title':_t('This record has an exception activity.'),'class':"pull-right mt-1 text-"+this.value+" fa "+this.recordData.activity_exception_icon});}}});field_registry.add('mail_activity',Activity).add('kanban_activity',KanbanActivity).add('activity_exception',ActivityException);return Activity;});;

/* /mail/static/src/js/views/activity/activity_view.js defined in bundle 'web.assets_backend' */
odoo.define('mail.ActivityView',function(require){"use strict";var ActivityController=require('mail.ActivityController');var ActivityModel=require('mail.ActivityModel');var ActivityRenderer=require('mail.ActivityRenderer');var BasicView=require('web.BasicView');var core=require('web.core');var view_registry=require('web.view_registry');var _lt=core._lt;var ActivityView=BasicView.extend({accesskey:"a",display_name:_lt('Activity'),icon:'fa-clock-o',config:_.extend({},BasicView.prototype.config,{Controller:ActivityController,Model:ActivityModel,Renderer:ActivityRenderer,}),viewType:'activity',searchMenuTypes:['filter','favorite'],init:function(){this._super.apply(this,arguments);this.loadParams.type='list';this.loadParams.limit=false;this.rendererParams.templates=_.findWhere(this.arch.children,{'tag':'templates'});},});view_registry.add('activity',ActivityView);return ActivityView;});;

/* /mail/static/src/js/views/activity/activity_model.js defined in bundle 'web.assets_backend' */
odoo.define('mail.ActivityModel',function(require){'use strict';var BasicModel=require('web.BasicModel');var session=require('web.session');var ActivityModel=BasicModel.extend({get:function(){var result=this._super.apply(this,arguments);if(result&&result.model===this.modelName&&result.type==='list'){_.extend(result,this.additionalData);}
return result;},load:function(params){this.originalDomain=_.extend([],params.domain);params.domain.push(['activity_ids','!=',false]);this.domain=params.domain;this.modelName=params.modelName;params.groupedBy=[];var def=this._super.apply(this,arguments);return Promise.all([def,this._fetchData()]).then(function(result){return result[0];});},reload:function(handle,params){if(params&&'domain'in params){this.originalDomain=_.extend([],params.domain);params.domain.push(['activity_ids','!=',false]);this.domain=params.domain;}
if(params&&'groupBy'in params){params.groupBy=[];}
var def=this._super.apply(this,arguments);return Promise.all([def,this._fetchData()]).then(function(result){return result[0];});},_fetchData:function(){var self=this;return this._rpc({model:"mail.activity",method:'get_activity_data',kwargs:{res_model:this.modelName,domain:this.domain,context:session.user_context,}}).then(function(result){self.additionalData=result;});},});return ActivityModel;});;

/* /mail/static/src/js/views/activity/activity_controller.js defined in bundle 'web.assets_backend' */
odoo.define('mail.ActivityController',function(require){"use strict";var BasicController=require('web.BasicController');var core=require('web.core');var field_registry=require('web.field_registry');var ViewDialogs=require('web.view_dialogs');var KanbanActivity=field_registry.get('kanban_activity');var _t=core._t;var ActivityController=BasicController.extend({custom_events:_.extend({},BasicController.prototype.custom_events,{empty_cell_clicked:'_onEmptyCell',send_mail_template:'_onSendMailTemplate',schedule_activity:'_onScheduleActivity',}),renderPager:function(){return Promise.resolve();},_onScheduleActivity:function(){var self=this;var state=this.model.get(this.handle);new ViewDialogs.SelectCreateDialog(this,{res_model:state.model,domain:this.model.originalDomain,title:_.str.sprintf(_t("Search: %s"),this.renderer.arch.attrs.string),no_create:!this.activeActions.create,disable_multiple_selection:true,context:state.context,on_selected:function(record){var fakeRecord=self.renderer.getKanbanActivityData({},record[0]);var widget=new KanbanActivity(self,'activity_ids',fakeRecord,{});widget.scheduleActivity();},}).open();},_onEmptyCell:function(ev){var state=this.model.get(this.handle);this.do_action({type:'ir.actions.act_window',res_model:'mail.activity',view_mode:'form',view_type:'form',views:[[false,'form']],target:'new',context:{default_res_id:ev.data.resId,default_res_model:state.model,default_activity_type_id:ev.data.activityTypeId,},res_id:false,},{on_close:this.reload.bind(this),});},_onSendMailTemplate:function(ev){var templateID=ev.data.templateID;var activityTypeID=ev.data.activityTypeID;var state=this.model.get(this.handle);var groupedActivities=state.grouped_activities;var resIDS=[];Object.keys(groupedActivities).forEach(function(resID){var activityByType=groupedActivities[resID];var activity=activityByType[activityTypeID];if(activity){resIDS.push(parseInt(resID));}});this._rpc({model:this.model.modelName,method:'activity_send_mail',args:[resIDS,templateID],});},});return ActivityController;});;

/* /mail/static/src/js/views/activity/activity_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('mail.ActivityRenderer',function(require){"use strict";var AbstractRenderer=require('web.AbstractRenderer');var ActivityRecord=require('mail.ActivityRecord');var config=require('web.config');var core=require('web.core');var field_registry=require('web.field_registry');var KanbanColumnProgressBar=require('web.KanbanColumnProgressBar');var qweb=require('web.QWeb');var session=require('web.session');var utils=require('web.utils');var KanbanActivity=field_registry.get('kanban_activity');var _t=core._t;var QWeb=core.qweb;var ActivityRenderer=AbstractRenderer.extend({className:'o_activity_view',custom_events:{'set_progress_bar_state':'_onSetProgressBarState',},events:{'click .o_send_mail_template':'_onSenMailTemplateClicked','click .o_activity_empty_cell':'_onEmptyCell','click .o_record_selector':'_onRecordSelector',},init:function(parent,state,params){this._super.apply(this,arguments);this.qweb=new qweb(config.isDebug(),{_s:session.origin});this.qweb.add_template(utils.json_node_to_xml(params.templates));},getKanbanActivityData:function(activityGroup,resID){return{data:{activity_ids:{model:'mail.activity',res_ids:activityGroup.ids,},activity_state:activityGroup.state,},fields:{activity_ids:{},activity_state:{selection:[['overdue',"Overdue"],['today',"Today"],['planned',"Planned"],],},},fieldsInfo:{},model:this.state.model,type:'record',res_id:resID,getContext:function(){return{};},};},_getRecord:function(recordId){return _.findWhere(this.state.data,{res_id:recordId});},_render:function(){var self=this;this.$el.addClass('table-responsive');this.$el.html(QWeb.render('mail.ActivityView',{isEmpty:!this.state.activity_types.length}));return Promise.all([this._super.apply(this,arguments),this._renderHeader(),this._renderBody(),]).then(function(result){self.$('table').append(result[1]).append(result[2]).append(self._renderFooter());});},_renderBody:function(){var defs=_.map(this.state.activity_res_ids,this._renderRow.bind(this));return Promise.all(defs).then(function($rows){return $('<tbody>').append($rows);});},_renderFooter:function(){return QWeb.render('mail.ActivityViewFooter');},_renderHeader:function(){var self=this;var activityTypeIds=_.unique(_.flatten(_.map(this.state.grouped_activities,function(act){return _.keys(act);})));var $thead=$(QWeb.render('mail.ActivityViewHeader',{types:this.state.activity_types,activityTypeIDs:_.map(activityTypeIds,Number),}));var defs=[];activityTypeIds.forEach(function(typeId){defs.push(self._renderProgressBar($thead,typeId));});return Promise.all(defs).then(function(){return $thead;});},_renderProgressBar:function($thead,typeId){var counts={planned:0,today:0,overdue:0};_.each(this.state.grouped_activities,function(act){if(_.contains(_.keys(act),typeId.toString())){counts[act[typeId].state]+=1;}});var progressBar=new KanbanColumnProgressBar(this,{columnID:typeId,progressBarStates:{},},{count:_.reduce(_.values(counts),(x,y)=>x+y),fields:{activity_state:{type:'selection',selection:[['planned',_t('Planned')],['today',_t('Today')],['overdue',_t('Overdue')],],},},progressBarValues:{field:'activity_state',colors:{planned:'success',today:'warning',overdue:'danger'},counts:counts,},});return progressBar.appendTo($thead.find('th[data-activity-type-id='+typeId+']'));},_renderRow:function(resId){var self=this;var defs=[];var record=this._getRecord(resId);var $nameTD=$('<td>',{class:_.contains(this.filteredResIDs,resId)?'o_activity_filter_'+this.activeFilter:'',});var activityRecord=new ActivityRecord(this,record,{qweb:this.qweb});defs.push(activityRecord.appendTo($nameTD));var $cells=_.map(this.state.activity_types,function(node){var activity_type_id=node[0];var activity_group=self.state.grouped_activities[resId];activity_group=activity_group&&activity_group[activity_type_id]||{count:0,ids:[],state:false};var $td=$(QWeb.render('mail.ActivityViewRow',{resId:resId,activityGroup:activity_group,activityTypeId:activity_type_id,widget:self,}));if(activity_group.state){var record=self.getKanbanActivityData(activity_group,resId);var widget=new KanbanActivity(self,"activity_ids",record,{});var def=widget.appendTo($td).then(function(){var $date=$('<div class="o_closest_deadline">');var splitDate=activity_group.o_closest_deadline.split('-');var date=new Date(splitDate[0],splitDate[1]-1,splitDate[2]);if(moment().year()===moment(date).year()){$date.text(date.toLocaleDateString(moment().locale(),{day:'numeric',month:'short'}));}else{$date.text(moment(date).format('ll'));}
$td.find('a').html($date);if(activity_group.count>1){$td.find('a').append($('<span>',{class:'badge badge-light badge-pill border-0 '+activity_group.state,text:activity_group.count,}));}});defs.push(def);}
return $td;});return Promise.all(defs).then(function(){var $tr=$('<tr/>',{class:'o_data_row'}).attr('data-res-id',resId).append($nameTD).append($cells);return $tr;});},_onEmptyCell:function(ev){ev.preventDefault();ev.stopPropagation();var data=$(ev.currentTarget).data();this.trigger_up('empty_cell_clicked',data);},_onRecordSelector:function(ev){ev.stopPropagation();this.trigger_up('schedule_activity');},_onSenMailTemplateClicked:function(ev){var $target=$(ev.currentTarget);var templateID=$target.data('template-id');var activityTypeID=$target.closest('th').data('activity-type-id');this.trigger_up('send_mail_template',{activityTypeID:activityTypeID,templateID:templateID,});},_onSetProgressBarState:function(ev){var self=this;this.$('th[class*="o_activity_filter_"]').attr('class','o_activity_type_cell');this.$('.o_kanban_counter_progress div').removeClass('active progress-bar-striped');var data=ev.data;var arrangedRecords=this.state.activity_res_ids;this.activeFilter=data.values.activeFilter;if(this.activeFilter){var filteredResIds=_.map(_.keys(_.pick(this.state.grouped_activities,function(act){return act[data.columnID]&&act[data.columnID].state===self.activeFilter;})),Number);arrangedRecords=_.union(_.intersection(this.state.activity_res_ids,filteredResIds),this.state.activity_res_ids);this.filteredResIDs=filteredResIds;}
var defs=_.map(arrangedRecords,this._renderRow.bind(this));Promise.all(defs).then(function($rows){self.$('tbody').html($rows);});if(this.activeFilter){var $header=this.$('th.o_activity_type_cell[data-activity-type-id='+data.columnID+']');$header.addClass('o_activity_filter_'+this.activeFilter);}},});return ActivityRenderer;});;

/* /mail/static/src/js/views/activity/activity_record.js defined in bundle 'web.assets_backend' */
odoo.define('mail.ActivityRecord',function(require){"use strict";var KanbanRecord=require('web.KanbanRecord');var ActivityRecord=KanbanRecord.extend({init:function(parent,state){this._super.apply(this,arguments);this.fieldsInfo=state.fieldsInfo.activity;},_render:function(){this.defs=[];this._replaceElement(this.qweb.render('activity-box',this.qweb_context));this.$el.on('click',this._onGlobalClick.bind(this));this.$el.addClass('o_activity_record');this._processFields();this._setupColor();return Promise.all(this.defs);},_setFieldDisplay:function($el,fieldName){this._super.apply(this,arguments);if(this.fieldsInfo[fieldName].muted){$el.addClass('text-muted');}},_setState:function(){this._super.apply(this,arguments);this.qweb_context={activity_image:this._getImageURL.bind(this),record:this.record,user_context:this.getSession().user_context,widget:this,};},});return ActivityRecord;});;

/* /mail/static/src/js/attachment_box.js defined in bundle 'web.assets_backend' */
odoo.define('mail.AttachmentBox',function(require){"use strict";var core=require('web.core');var Widget=require('web.Widget');var DocumentViewer=require('mail.DocumentViewer');var QWeb=core.qweb;var _t=core._t;var AttachmentBox=Widget.extend({template:'mail.chatter.AttachmentBox',events:{"click .o_attachment_download":"_onAttachmentDownload","click .o_attachment_view":"_onAttachmentView","click .o_attachment_delete_cross":"_onDeleteAttachment","click .o_upload_attachments_button":"_onUploadAttachments","change .o_chatter_attachment_form .o_form_binary_form":"_onAddAttachment",},init:function(parent,record,attachments){this._super.apply(this,arguments);this.fileuploadId=_.uniqueId('oe_fileupload');$(window).on(this.fileuploadId,this._onUploaded.bind(this));this.currentResID=record.res_id;this.currentResModel=record.model;this.attachmentIDs=attachments;this.imageList={};this.otherList={};_.each(attachments,function(attachment){attachment.url='/web/content/'+attachment.id+'?download=true';attachment.filename=attachment.name||_t('unnamed');});var sortedAttachments=_.partition(attachments,function(att){return att.mimetype&&att.mimetype.split('/')[0]==='image';});this.imageList=sortedAttachments[0];this.otherList=sortedAttachments[1];},destroy:function(){$(window).off(this.fileuploadId);this._super.apply(this,arguments);},update:function(record){this.currentResID=record.res_id;this.currentResModel=record.model;},_onAddAttachment:function(ev){var $input=$(ev.currentTarget).find('input.o_input_file');if($input.val()!==''){var $binaryForm=this.$('form.o_form_binary_form');$binaryForm.submit();}},_onAttachmentDownload:function(ev){ev.stopPropagation();},_onAttachmentView:function(ev){ev.stopPropagation();ev.preventDefault();var activeAttachmentID=$(ev.currentTarget).data('id');if(activeAttachmentID){var attachmentViewer=new DocumentViewer(this,this.attachmentIDs,activeAttachmentID);attachmentViewer.appendTo($('body'));}},_onUploadAttachments:function(ev){this.$('input.o_input_file').click();},_onDeleteAttachment:function(ev){ev.stopPropagation();var $target=$(ev.currentTarget);this.trigger_up('delete_attachment',{attachmentId:$target.data('id'),attachmentName:$target.data('name')});},_onUploaded:function(ev,response){if(response.error){this.do_warn(_t("Error"),_t("You are not allowed to upload an attachment here."));}else{this.trigger_up('reload_attachment_box');}},});return AttachmentBox;});;

/* /mail/static/src/js/emojis.js defined in bundle 'web.assets_backend' */
odoo.define('mail.emojis',function(require){"use strict";var data={":)":"😊",":-)":"😊","=)":"😊",":]":"😊",":D":"😃",":-D":"😃","=D":"😃","xD":"😆","XD":"😆","x'D":"😂",";)":"😉",";-)":"😉","B)":"😎","8)":"😎","B-)":"😎","8-)":"😎",";p":"😜",";P":"😜",":p":"😋",":P":"😋",":-p":"😋",":-P":"😋","=P":"😋","xp":"😝","xP":"😝","o_o":"😳",":|":"😐",":-|":"😐",":/":"😕",":-/":"😕",":(":"😞",":@":"😱",":O":"😲",":-O":"😲",":o":"😲",":-o":"😲",":'o":"😨","3:(":"😠",">:(":"😠","3:)":"😈",">:)":"😈",":*":"😘",":-*":"😘","o:)":"😇",":'(":"😢",":'-(":"😭",":\"(":"😭","<3":"❤️","&lt;3":"❤️",":heart":"❤️","</3":"💔","&lt;/3":"💔",":heart_eyes":"😍",":turban":"👳",":+1":"👍",":-1":"👎",":ok":"👌",":poop":"💩",":no_see":"🙈",":no_hear":"🙉",":no_speak":"🙊",":bug":"🐞",":kitten":"😺",":bear":"🐻",":snail":"🐌",":boar":"🐗",":clover":"🍀",":sunflower":"🌹",":fire":"🔥",":sun":"☀️",":partly_sunny:":"⛅️",":rainbow":"🌈",":cloud":"☁️",":zap":"⚡️",":star":"⭐️",":cookie":"🍪",":pizza":"🍕",":hamburger":"🍔",":fries":"🍟",":cake":"🎂",":cake_part":"🍰",":coffee":"☕️",":banana":"🍌",":sushi":"🍣",":rice_ball":"🍙",":beer":"🍺",":wine":"🍷",":cocktail":"🍸",":tropical":"🍹",":beers":"🍻",":ghost":"👻",":skull":"💀",":et":"👽",":alien":"👽",":party":"🎉",":trophy":"🏆",":key":"🔑",":pin":"📌",":postal_horn":"📯",":music":"🎵",":trumpet":"🎺",":guitar":"🎸",":run":"🏃",":bike":"🚲",":soccer":"⚽️",":football":"🏈",":8ball":"🎱",":clapper":"🎬",":microphone":"🎤",":cheese":"🧀",};var emojiDict={};_.each(data,function(unicode,source){if(!emojiDict[unicode]){emojiDict[unicode]={sources:[source],unicode:unicode,description:source,};}else{emojiDict[unicode].sources.push(source);}});var emojis=_.values(emojiDict);return emojis;});;

/* /web_map/static/src/js/map_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web_map.MapController',function(require){'use strict';var AbstractController=require('web.AbstractController');var core=require('web.core');var qweb=core.qweb;var Pager=require('web.Pager');var MapController=AbstractController.extend({custom_events:_.extend({},AbstractController.prototype.custom_events,{'pin_clicked':'_onPinClick','get_itinerary_clicked':'_onGetItineraryClicked','open_clicked':'_onOpenClicked',}),renderButtons:function($node){this.$buttons=$(qweb.render("MapView.buttons"),{widget:this});this._updateGoogleMapUrl();this.$buttons.appendTo($node);},renderPager:function($node){const params=this._getPagerParams();this.pager=new Pager(this,params.size,params.current_min,params.limit);this.pager.on('pager_changed',this,newState=>{this.pager.disable();this.reload({limit:newState.limit,offset:newState.current_min-1}).then(this.pager.enable.bind(this.pager));});return this.pager.appendTo($node);},update:function(){return this._super.apply(this,arguments).then(()=>{this._updatePager();this._updateGoogleMapUrl();});},_getPagerParams:function(){const state=this.model.get();return{current_min:state.offset+1,limit:state.limit,size:state.count,};},_updatePager:function(){if(this.pager){this.pager.updateState(this._getPagerParams());}},_updateGoogleMapUrl:function(){var url='https://www.google.com/maps/dir/?api=1';if(this.model.data.records.length){url+='&waypoints=';var all_coord=this.model.data.records.filter((record)=>record.partner&&record.partner.partner_latitude&&record.partner.partner_longitude);_.uniq(all_coord,function(record){return record.partner.partner_latitude+'_'+record.partner.partner_longitude;}).forEach((record)=>{url+=record.partner.partner_latitude+','+record.partner.partner_longitude+'|';});url=url.slice(0,-1);}
this.$buttons.find('a.btn.btn-primary').attr('href',url);},_onGetItineraryClicked:function(ev){window.open('https://www.google.com/maps/dir/?api=1&destination='+ev.data.lat+','+ev.data.lon);},_onOpenClicked:function(ev){this.trigger_up('switch_view',{view_type:'form',res_id:ev.data.id,mode:'readonly',model:this.modelName});}});return MapController;});;

/* /web_map/static/src/js/map_model.js defined in bundle 'web.assets_backend' */
odoo.define('web_map.MapModel',function(require){'use strict';var AbstractModel=require('web.AbstractModel');var session=require('web.session');var core=require('web.core');var _t=core._t;var MapModel=AbstractModel.extend({init:function(){this._super.apply(this,arguments);this.data={};this.data.mapBoxToken=session.map_box_token;},get:function(){return this.data;},load:function(params){this.data.count=0;this.data.offset=0;this.data.limit=80;this.partnerToCache=[];this.partnerIds=[];this.resPartnerField=params.resPartnerField;this.model=params.modelName;this.context=params.context;this.fields=params.fieldNames;this.domain=params.domain;this.params=params;this.orderBy=params.orderBy;this.routing=params.routing;this.numberOfLocatedRecords=0;return this._fetchData();},reload:function(handle,params){var options=params||{};this.partnerToCache=[];this.partnerIds=[];this.numberOfLocatedRecords=0;if(options.domain!==undefined){this.domain=options.domain;}
if(options.limit!==undefined){this.data.limit=options.limit;}
if(options.offset!==undefined){this.data.offset=options.offset;}
return this._fetchData();},_fetchData:async function(){if(!this.resPartnerField){this.data.records=[];this.data.route={routes:[]};return;}
var results=await this._fetchRecordData();this.data.records=results.records;this.data.count=results.length;this.partnerIds=[];if(this.model==="res.partner"&&this.resPartnerField==="id"){this.data.records.forEach((record)=>{this.partnerIds.push(record.id);record.partner_id=[record.id];});}else{this._fillPartnerIds(this.data.records);}
this.partnerIds=_.uniq(this.partnerIds);return this._partnerFetching(this.partnerIds);},_partnerFetching:async function(partnerIds){this.data.partners=partnerIds.length?await this._fetchRecordsPartner(partnerIds):[];if(this.data.mapBoxToken){return this._maxBoxAPI().then(()=>{this._writeCoordinatesUsers();}).catch((err)=>{this._mapBoxErrorHandling(err);this.data.mapBoxToken='';return this._openStreetMapAPI();});}else{return this._openStreetMapAPI().then(()=>{this._writeCoordinatesUsers();});}},_mapBoxErrorHandling:function(err){switch(err.status){case 401:this.do_warn(_t('Token invalid'),_t('The view has switched to another provider but functionalities will be limited'));break;case 403:this.do_warn(_t('Unauthorized connection'),_t('The view has switched to another provider but functionalities will be limited'));break;case 500:this.do_warn(_t('MapBox servers unreachable'),_t('The view has switched to another provider but functionalities will be limited'));}},_addPartnerToRecord:function(){this.data.records.forEach((record)=>{this.data.partners.forEach((partner)=>{var recordPartnerId;if(this.model==="res.partner"&&this.resPartnerField==="id"){recordPartnerId=record.id;}else{recordPartnerId=record[this.resPartnerField][0];}
if(recordPartnerId==partner.id){record.partner=partner;this.numberOfLocatedRecords++;}});});},_openStreetMapAPI:function(){var self=this;var promises=[];this.data.partners.forEach((partner)=>{if(partner.contact_address_complete&&(!partner.partner_latitude||!partner.partner_longitude)){promises.push(self._fetchCoordinatesFromAddressOSM(partner).then(function(coordinates){if(coordinates.length){partner.partner_longitude=coordinates[0].lon;partner.partner_latitude=coordinates[0].lat;self.partnerToCache.push(partner);}}));}else if(!this._checkCoordinatesValidity(partner)){partner.partner_latitude=undefined;partner.partner_longitude=undefined;}});return Promise.all(promises.map(p=>p.catch(error=>null))).then(function(){self._addPartnerToRecord();});},_maxBoxAPI:function(){var self=this;var promises=[];this.data.partners.forEach((partner)=>{if(partner.contact_address_complete&&(!partner.partner_latitude||!partner.partner_longitude)){promises.push(self._fetchCoordinatesFromAddressMB(partner).then(function(coordinates){if(coordinates.features.length){partner.partner_longitude=coordinates.features[0].geometry.coordinates[0];partner.partner_latitude=coordinates.features[0].geometry.coordinates[1];self.partnerToCache.push(partner);}}));}else if(!this._checkCoordinatesValidity(partner)){partner.partner_latitude=undefined;partner.partner_longitude=undefined;}});return Promise.all(promises).then(function(){self._addPartnerToRecord();self.data.route={routes:[]};if(self.numberOfLocatedRecords>1&&self.routing){return self._fetchRoute().then(function(routeResult){self.data.route=routeResult;});}else{return Promise.resolve();}});},_fillPartnerIds:function(records){return records.forEach((record)=>{if(record[this.resPartnerField]){this.partnerIds.push(record[this.resPartnerField][0]);}});},_checkCoordinatesValidity:function(partner){if(partner.partner_latitude&&partner.partner_longitude&&partner.partner_latitude>=-90&&partner.partner_latitude<=90&&partner.partner_longitude>=-180&&partner.partner_longitude<=180){return true;}
return false;},_fetchRecordsPartner:function(ids){return this._rpc({model:'res.partner',method:'search_read',fields:['contact_address_complete','partner_latitude','partner_longitude'],domain:[['contact_address_complete','!=','False'],['id','in',ids]],});},_fetchCoordinatesFromAddressMB:function(record){var encodedUrl='https://api.mapbox.com/geocoding/v5/mapbox.places/'+encodeURIComponent(record.contact_address_complete)
+'.json?access_token='+this.data.mapBoxToken+'&cachebuster=1552314159970&autocomplete=true';return new Promise(function(resolve,reject){$.ajax({url:encodedUrl,method:'GET'}).then(resolve).catch(reject);});},_fetchCoordinatesFromAddressOSM:function(record){var contact_address_complete=record.contact_address_complete.replace('/',' ');var encodedUrl='https://nominatim.openstreetmap.org/search/'+encodeURIComponent(contact_address_complete)
+'?format=jsonv2';return new Promise(function(resolve,reject){$.ajax({url:encodedUrl,method:'GET'}).then(resolve).catch(reject);});},_writeCoordinatesUsers:function(){if(this.partnerToCache.length){this._rpc({model:'res.partner',method:'update_latitude_longitude',context:self.context,args:[this.partnerToCache]});this.partnerToCache=[];}},_fetchRecordData:function(){return this._rpc({route:'/web/dataset/search_read',model:this.model,context:this.context,fields:this.fields,domain:this.domain,orderBy:this.orderBy,limit:this.data.limit,offset:this.data.offset});},_fetchRoute:function(){var coordinatesParam="";this.data.records.forEach(function(record){if(record.partner.partner_latitude&&record.partner.partner_longitude){coordinatesParam+=record.partner.partner_longitude+','+record.partner.partner_latitude+';';}});coordinatesParam=coordinatesParam.slice(0,-1);var encodedUrl='https://api.mapbox.com/directions/v5/mapbox/driving/'+encodeURIComponent(coordinatesParam)
+'?access_token='+this.data.mapBoxToken+'&steps=true&geometries=geojson';return new Promise(function(resolve,reject){$.ajax({url:encodedUrl,method:'GET',}).then(resolve).catch(reject);});},});return MapModel;});;

/* /web_map/static/src/js/map_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web_map.MapRenderer',function(require){"use strict";var core=require('web.core');var AbstractRenderer=require('web.AbstractRenderer');var field_utils=require('web.field_utils');var qweb=core.qweb;var MapRenderer=AbstractRenderer.extend({className:"o_map_view row no-gutters",init:function(parent,state,params){this._super.apply(this,arguments);this.fieldsMarkerPopup=params.fieldNamesMarkerPopup;this.numbering=params.numbering;this.hasFormView=params.hasFormView;this.defaultOrder=params.defaultOrder;this.isInDom=false;this.mapIsInit=false;this.markers=[];this.polylines=[];this.panelTitle=params.panelTitle;this.mapBoxToken=state.mapBoxToken;this.apiTilesRoute='https://a.tile.openstreetmap.org/{z}/{x}/{y}.png';if(this.mapBoxToken){this.apiTilesRoute='https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}';}},on_attach_callback:function(){this.isInDom=true;this._initializeMap();var initialCoord=this._getLatLng();if(initialCoord){this.leafletMap.fitBounds(initialCoord);}else{this.leafletMap.fitWorld();}
this._addMakers(this.state.records);this._addRoutes(this.state.route);this._addPinList();},on_detach_callback:function(){this.isInDom=false;},destroy:function(){this.markers.forEach(function(marker){marker.off('click');});this.polylines.forEach(function(polyline){polyline.off('click');});this.leafletMap.remove();return this._super.apply(this,arguments);},_initializeMap:function(){if(this.mapIsInit){return;}
this.mapIsInit=true;var mapContainer=document.createElement("div");mapContainer.classList.add('o_map_container','col-md-12','col-lg-10');this.el.appendChild(mapContainer);this.leafletMap=L.map(mapContainer,{maxBounds:[L.latLng(180,-180),L.latLng(-180,180)]});L.tileLayer(this.apiTilesRoute,{attribution:'© <a href="https://www.mapbox.com/about/maps/">Mapbox</a> © <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <strong><a href="https://www.mapbox.com/map-feedback/" target="_blank">Improve this map</a></strong>',tileSize:512,zoomOffset:-1,minZoom:2,maxZoom:19,id:'mapbox/streets-v11',accessToken:this.mapBoxToken,}).addTo(this.leafletMap);},_getLatLng:function(){var tabLatLng=[];this.state.records.forEach(function(record){if(record.partner&&record.partner.partner_latitude&&record.partner.partner_longitude){tabLatLng.push(L.latLng(record.partner.partner_latitude,record.partner.partner_longitude));}});if(!tabLatLng.length){return false;}
return L.latLngBounds(tabLatLng);},_getMarkerPopupFields:function(record,fields){var fieldsView=[];fields.forEach(function(field){if(record[field['fieldName']]){var value=record[field['fieldName']];if(value instanceof Array){value=value[1];}
if(field.widget){value=field_utils.format[field.widget](field_utils.parse[field.widget](value,{}),{});}
fieldsView.push({field:value,string:field['string']});}});return fieldsView;},_addMakers:function(records){var self=this;this._removeMakers();records.forEach(function(record){if(record.partner&&record.partner.partner_latitude&&record.partner.partner_longitude){var popup={};popup.records=self._getMarkerPopupFields(record,self.fieldsMarkerPopup);popup.url='https://www.google.com/maps/dir/?api=1&destination='+record.partner.partner_latitude+','+record.partner.partner_longitude;var $popup=$(qweb.render('map-popup',{records:popup}));var openButton=$popup.find('button.btn.btn-primary.edit')[0];if(self.hasFormView){openButton.onclick=function(){self.trigger_up('open_clicked',{id:record.id});};}else{openButton.remove();}
var marker;var offset;if(self.numbering){var number=L.divIcon({className:'o_numbered_marker',html:'<p class ="o_number_icon">'+(self.state.records.indexOf(record)+1)+'</p>'});marker=L.marker([record.partner.partner_latitude,record.partner.partner_longitude],{icon:number});offset=new L.Point(0,-35);}else{marker=L.marker([record.partner.partner_latitude,record.partner.partner_longitude]);offset=new L.Point(0,0);}
marker.addTo(self.leafletMap).bindPopup(function(){var divPopup=document.createElement('div');$popup.each(function(i,element){divPopup.appendChild(element);});return divPopup;},{offset:offset});self.markers.push(marker);}});},_addPinList:function(){this.$pinList=$(qweb.render('MapView.pinlist',{widget:this}));var $container=this.$el.find('.o_pin_list_container');if($container.length){$container.replaceWith(this.$pinList);}else{this.$el.append(this.$pinList);}
this.$('.o_pin_list_container li a').on('click',this._centerAndOpenPin.bind(this));},_addRoutes:function(route){this._removeRoutes();var self=this;if(!this.mapBoxToken||!route.routes.length){return;}
route.routes[0].legs.forEach(function(leg){var latLngs=[];leg.steps.forEach(function(step){step.geometry.coordinates.forEach(function(coordinate){latLngs.push(L.latLng(coordinate[1],coordinate[0]));});});var polyline=L.polyline(latLngs,{color:'blue',weight:5,opacity:0.3}).addTo(self.leafletMap);polyline.on('click',function(){self.polylines.forEach(function(poly){poly.setStyle({color:'blue',opacity:0.3});});this.setStyle({color:'darkblue',opacity:1.0});this.bringToFront();});self.polylines.push(polyline);});},_centerAndOpenPin:function(ev){ev.preventDefault();this.leafletMap.panTo(ev.target.dataset,{animate:true});var marker=this.markers.find((m)=>{return m._latlng.lat==ev.target.dataset.lat&&m._latlng.lng==ev.target.dataset.lng;});if(marker){marker.openPopup();}},_removeMakers:function(){var self=this;this.markers.forEach(function(marker){self.leafletMap.removeLayer(marker);});this.markers=[];},_removeRoutes:function(){var self=this;this.polylines.forEach(function(polyline){self.leafletMap.removeLayer(polyline);});this.polylines=[];},_render:function(){if(this.isInDom){var initialCoord=this._getLatLng();if(initialCoord){this.leafletMap.flyToBounds(initialCoord,{animate:false});}else{this.leafletMap.fitWorld();}
this._addMakers(this.state.records);this._addRoutes(this.state.route);this._addPinList();}
return Promise.resolve();}});return MapRenderer;});;

/* /web_map/static/src/js/map_view.js defined in bundle 'web.assets_backend' */
odoo.define('web_map.MapView',function(require){"use strict";var MapModel=require('web_map.MapModel');var MapController=require('web_map.MapController');var MapRenderer=require('web_map.MapRenderer');var AbstractView=require('web.AbstractView');var viewRegistry=require('web.view_registry');var _t=require('web.core')._t;var MapView=AbstractView.extend({jsLibs:['/web_map/static/lib/leaflet/leaflet.js',],config:_.extend({},AbstractView.prototype.config,{Model:MapModel,Controller:MapController,Renderer:MapRenderer,}),icon:'fa-map-marker',display_name:'Map',viewType:'map',mobile_friendly:true,searchMenuTypes:['filter','favorite'],init:function(viewInfo,params){this._super.apply(this,arguments);var fieldNames=[];var fieldNamesMarkerPopup=[];this.loadParams.resPartnerField=this.arch.attrs.res_partner;fieldNames.push(this.arch.attrs.res_partner);fieldNames.push('display_name');if(this.arch.attrs.default_order){this.loadParams.orderBy=[{name:this.arch.attrs.default_order||'display_name',asc:true}];}
this.loadParams.routing=this.arch.attrs.routing?true:false;this.rendererParams.numbering=this.arch.attrs.routing?true:false;this.rendererParams.defaultOrder=this.arch.attrs.default_order;this.rendererParams.panelTitle=this.arch.attrs.panel_title||params.displayName||_t('Items');this.arch.children.forEach(function(node){if(node.tag==='marker-popup'){node.children.forEach(function(child){if(child.tag==='field'){fieldNames.push(child.attrs.name);fieldNamesMarkerPopup.push({fieldName:child.attrs.name,string:child.attrs.string,widget:child.attrs.widget});}});}});this.loadParams.fieldNames=_.uniq(fieldNames);this.rendererParams.fieldNamesMarkerPopup=fieldNamesMarkerPopup;this.rendererParams.hasFormView=params.actionViews.find(function(view){return view.type==="form";});},});viewRegistry.add('map',MapView);return MapView;});;

/* /base_automation/static/src/js/base_automation_error_dialog.js defined in bundle 'web.assets_backend' */
odoo.define('base_automation.BaseAutomatioErrorDialog',function(require){"use strict";const CrashManager=require('web.CrashManager');const ErrorDialog=CrashManager.ErrorDialog;const ErrorDialogRegistry=require('web.ErrorDialogRegistry');const session=require('web.session');const BaseAutomationErrorDialog=ErrorDialog.extend({xmlDependencies:(ErrorDialog.prototype.xmlDependencies||[]).concat(['/base_automation/static/src/xml/base_automation_error_dialog.xml']),template:'CrashManager.BaseAutomationError',events:{'click .o_disable_action_button':'_onDisableAction','click .o_edit_action_button':'_onEditAction',},init:function(parent,options,error){this._super.apply(this,arguments);this.base_automation=error.data.context.base_automation;this.is_admin=session.is_admin;},_onDisableAction:function(ev){ev.preventDefault();this._rpc({model:'base.automation',method:'write',args:[[this.base_automation.id],{active:false,}],}).then(this.destroy.bind(this));},_onEditAction:function(ev){ev.preventDefault();this.do_action({name:'Automated Actions',res_model:'base.automation',res_id:this.base_automation.id,views:[[false,'form']],type:'ir.actions.act_window',view_mode:'form',});},});ErrorDialogRegistry.add('base_automation',BaseAutomationErrorDialog);});;

/* /calendar/static/src/js/base_calendar.js defined in bundle 'web.assets_backend' */
odoo.define('base_calendar.base_calendar',function(require){"use strict";var BasicModel=require('web.BasicModel');var fieldRegistry=require('web.field_registry');var Notification=require('web.Notification');var relationalFields=require('web.relational_fields');var session=require('web.session');var WebClient=require('web.WebClient');var FieldMany2ManyTags=relationalFields.FieldMany2ManyTags;var CalendarNotification=Notification.extend({template:"CalendarNotification",xmlDependencies:(Notification.prototype.xmlDependencies||[]).concat(['/calendar/static/src/xml/notification_calendar.xml']),init:function(parent,params){this._super(parent,params);this.eid=params.eventID;this.sticky=true;this.events=_.extend(this.events||{},{'click .link2event':function(){var self=this;this._rpc({route:'/web/action/load',params:{action_id:'calendar.action_calendar_event_notify',},}).then(function(r){r.res_id=self.eid;return self.do_action(r);});},'click .link2recall':function(){this.close();},'click .link2showed':function(){this._rpc({route:'/calendar/notify_ack'}).then(this.close.bind(this,false),this.close.bind(this,false));},});},});WebClient.include({display_calendar_notif:function(notifications){var self=this;var last_notif_timer=0;clearTimeout(this.get_next_calendar_notif_timeout);_.each(this.calendar_notif_timeouts,clearTimeout);this.calendar_notif_timeouts={};_.each(notifications,function(notif){var key=notif.event_id+','+notif.alarm_id;if(key in self.calendar_notif){return;}
self.calendar_notif_timeouts[key]=setTimeout(function(){var notificationID=self.call('notification','notify',{Notification:CalendarNotification,title:notif.title,message:notif.message,eventID:notif.event_id,onClose:function(){delete self.calendar_notif[key];},});self.calendar_notif[key]=notificationID;},notif.timer*1000);last_notif_timer=Math.max(last_notif_timer,notif.timer);});if(last_notif_timer>0){this.get_next_calendar_notif_timeout=setTimeout(this.get_next_calendar_notif.bind(this),last_notif_timer*1000);}},get_next_calendar_notif:function(){session.rpc("/calendar/notify",{},{shadow:true}).then(this.display_calendar_notif.bind(this)).guardedCatch(function(reason){var err=reason.message;var ev=reason.event;if(err.code===-32098){ev.preventDefault();}});},show_application:function(){this.calendar_notif_timeouts={};this.calendar_notif={};this.call('bus_service','onNotification',this,function(notifications){_.each(notifications,(function(notification){if(notification[0][1]==='calendar.alarm'){this.display_calendar_notif(notification[1]);}}).bind(this));});return this._super.apply(this,arguments).then(this.get_next_calendar_notif.bind(this));},});BasicModel.include({_fetchSpecialAttendeeStatus:function(record,fieldName){var context=record.getContext({fieldName:fieldName});var attendeeIDs=record.data[fieldName]?this.localData[record.data[fieldName]].res_ids:[];var meetingID=_.isNumber(record.res_id)?record.res_id:false;return this._rpc({model:'res.partner',method:'get_attendee_detail',args:[attendeeIDs,meetingID],context:context,}).then(function(result){return _.map(result,function(d){return _.object(['id','display_name','status','color'],d);});});},});var Many2ManyAttendee=FieldMany2ManyTags.extend({tag_template:"Many2ManyAttendeeTag",specialData:"_fetchSpecialAttendeeStatus",_getRenderTagsContext:function(){var result=this._super.apply(this,arguments);result.attendeesData=this.record.specialData.partner_ids;return result;},});fieldRegistry.add('many2manyattendee',Many2ManyAttendee);});;

/* /calendar/static/src/js/calendar_view.js defined in bundle 'web.assets_backend' */
odoo.define('calendar.CalendarView',function(require){"use strict";var CalendarPopover=require('web.CalendarPopover');var CalendarRenderer=require('web.CalendarRenderer');var CalendarView=require('web.CalendarView');var viewRegistry=require('web.view_registry');var AttendeeCalendarPopover=CalendarPopover.extend({template:'Calendar.attendee.status.popover',events:_.extend({},CalendarPopover.prototype.events,{'click .o-calendar-attendee-status .dropdown-item':'_onClickAttendeeStatus'}),init:function(){var self=this;this._super.apply(this,arguments);var session=this.getSession();this.showStatusDropdown=_.contains(this.event.record.partner_ids,session.partner_id);if(this.showStatusDropdown){this.statusColors={accepted:'text-success',declined:'text-danger',tentative:'text-muted',needsAction:'text-dark'};this.statusInfo={};_.each(this.fields.attendee_status.selection,function(selection){self.statusInfo[selection[0]]={text:selection[1],color:self.statusColors[selection[0]]};});this.selectedStatusInfo=this.statusInfo[this.event.record.attendee_status];}},_onClickAttendeeStatus:function(ev){ev.preventDefault();var self=this;var selectedStatus=$(ev.currentTarget).attr('data-action');this._rpc({model:'calendar.event',method:'change_attendee_status',args:[this.event.id,selectedStatus],}).then(function(){self.event.record.attendee_status=selectedStatus;self.$('.o-calendar-attendee-status-text').text(self.statusInfo[selectedStatus].text);self.$('.o-calendar-attendee-status-icon').removeClass(_.values(self.statusColors).join(' ')).addClass(self.statusInfo[selectedStatus].color);});},});var AttendeeCalendarRenderer=CalendarRenderer.extend({config:_.extend({},CalendarRenderer.prototype.config,{CalendarPopover:AttendeeCalendarPopover,}),});var AttendeeCalendarView=CalendarView.extend({config:_.extend({},CalendarView.prototype.config,{Renderer:AttendeeCalendarRenderer,}),});viewRegistry.add('attendee_calendar',AttendeeCalendarView);});;

/* /calendar/static/src/js/mail_activity.js defined in bundle 'web.assets_backend' */
odoo.define('calendar.Activity',function(require){"use strict";var Activity=require('mail.Activity');var Dialog=require('web.Dialog');var core=require('web.core');var _t=core._t;Activity.include({_onEditActivity:function(event,options){var self=this;var activity_id=$(event.currentTarget).data('activity-id');var activity=_.find(this.activities,function(act){return act.id===activity_id;});if(activity&&activity.activity_category==='meeting'&&activity.calendar_event_id){return self._super(event,_.extend({res_model:'calendar.event',res_id:activity.calendar_event_id[0],}));}
return self._super(event,options);},_onUnlinkActivity:function(event,options){event.preventDefault();var self=this;var activity_id=$(event.currentTarget).data('activity-id');var activity=_.find(this.activities,function(act){return act.id===activity_id;});if(activity&&activity.activity_category==='meeting'&&activity.calendar_event_id){Dialog.confirm(self,_t("The activity is linked to a meeting. Deleting it will remove the meeting as well. Do you want to proceed ?"),{confirm_callback:function(){return self._rpc({model:'mail.activity',method:'unlink_w_meeting',args:[[activity_id]],}).then(self._reload.bind(self,{activity:true}));},});}
else{return self._super(event,options);}},});});;

/* /calendar/static/src/js/systray_activity_menu.js defined in bundle 'web.assets_backend' */
odoo.define('calendar.systray.ActivityMenu',function(require){"use strict";var ActivityMenu=require('mail.systray.ActivityMenu');var fieldUtils=require('web.field_utils');ActivityMenu.include({_getActivityData:function(){var self=this;return this._super.apply(this,arguments).then(function(){var meeting=_.find(self._activities,{type:'meeting'});if(meeting&&meeting.meetings){_.each(meeting.meetings,function(res){res.start=fieldUtils.parse.datetime(res.start,false,{isUTC:true});});}});},_onActivityFilterClick:function(ev){var $el=$(ev.currentTarget);var data=_.extend({},$el.data());if(data.res_model==="calendar.event"&&data.filter==="my"){this.do_action('calendar.action_calendar_event',{additional_context:{default_mode:'day',search_default_mymeetings:1,},clear_breadcrumbs:true,});}else{this._super.apply(this,arguments);}},});});;

/* /mail_bot/static/src/js/mailbot_service.js defined in bundle 'web.assets_backend' */
odoo.define('mail_bot.MailBotService',function(require){"use strict";var AbstractService=require('web.AbstractService');var core=require('web.core');var session=require('web.session');var _t=core._t;var MailBotService=AbstractService.extend({start:function(){this._hasRequest=(window.Notification&&window.Notification.permission==="default")||false;if('odoobot_initialized'in session&&!session.odoobot_initialized){this._showOdoobotTimeout();}},getPreviews:function(filter){if(!this.isRequestingForNativeNotifications()){return[];}
if(filter&&filter!=='mailbox_inbox'){return[];}
var previews=[{title:_t("OdooBot has a request"),imageSRC:"/mail/static/src/img/odoobot.png",status:'bot',body:_t("Enable desktop notifications to chat"),id:'request_notification',unreadCounter:1,}];return previews;},isRequestingForNativeNotifications:function(){return this._hasRequest;},removeRequest:function(){this._hasRequest=false;},_showOdoobotTimeout:function(){var self=this;setTimeout(function(){session.odoobot_initialized=true;self._rpc({model:'mail.channel',method:'init_odoobot',});},2*60*1000);},});core.serviceRegistry.add('mailbot_service',MailBotService);return MailBotService;});;

/* /mail_bot/static/src/js/notification_alert.js defined in bundle 'web.assets_backend' */
odoo.define('mail.NotificationAlert',function(require){"use strict";var Widget=require('web.Widget');var widgetRegistry=require('web.widget_registry');var NotificationAlert=Widget.extend({template:'mail.NotificationAlert',init:function(){this._super.apply(this,arguments);var hasRequest=this.call('mailbot_service','isRequestingForNativeNotifications');this.isNotificationBlocked=window.Notification&&window.Notification.permission!=="granted"&&!hasRequest;},});widgetRegistry.add('notification_alert',NotificationAlert);return NotificationAlert;});;

/* /mail_bot/static/src/js/systray_messaging_menu.js defined in bundle 'web.assets_backend' */
odoo.define('mail_bot.systray.MessagingMenu',function(require){"use strict";var MessagingMenu=require('mail.systray.MessagingMenu');var core=require('web.core');var _t=core._t;return MessagingMenu.include({_computeCounter:function(){var counter=this._super.apply(this,arguments);if(this.call('mailbot_service','isRequestingForNativeNotifications')){counter++;}
return counter;},_getPreviews:function(){var mailbotPreviews=this.call('mailbot_service','getPreviews',this._filter);return this._super.apply(this,arguments).then(function(previews){return _.union(mailbotPreviews,previews);});},_handleResponseNotificationPermission:function(value){this.call('mailbot_service','removeRequest');if(value!=='granted'){this.call('bus_service','sendNotification',_t('Permission denied'),_t('Odoo will not have the permission to send native notifications on this device.'));}
this._updateCounter();},_requestNotificationPermission:function(){var def=window.Notification&&window.Notification.requestPermission();if(def){def.then(this._handleResponseNotificationPermission.bind(this));}
this.$('.o_mail_navbar_request_permission').slideUp();},_onClickPreview:function(ev){var previewID=$(ev.currentTarget).data('preview-id');if(previewID==='request_notification'){this._requestNotificationPermission();}else{this._super.apply(this,arguments);}},_onClickPreviewMarkAsRead:function(ev){ev.stopPropagation();var $preview=$(ev.currentTarget).closest('.o_mail_preview');var previewID=$preview.data('preview-id');if(previewID==='request_notification'){this._requestNotificationPermission();}else{this._super.apply(this,arguments);}}});});;

/* /mail_enterprise/static/src/js/chatter.js defined in bundle 'web.assets_backend' */
;

/* /mail_enterprise/static/src/js/form_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('mail_enterprise.form_renderer',function(require){"use strict";var config=require('web.config');var dom=require('web.dom');var pyUtils=require('web.py_utils');var FormRenderer=require('web.FormRenderer');var AttachmentViewer=require('mail_enterprise.AttachmentViewer');FormRenderer.include({custom_events:_.extend({},FormRenderer.prototype.custom_events,{preview_attachment:'_onAttachmentPreview'}),init:function(){this._super.apply(this,arguments);this.$attachmentPreview=undefined;this.attachmentPreviewResID=undefined;},_interchangeChatter:function(enablePreview){if(config.device.size_class<config.device.SIZES.XXL){return;}
if(!this.$attachmentPreview){return;}
if(!this.chatter||!this.chatter.$el){return;}
var $sheet=this.$('.o_form_sheet_bg');if(enablePreview){this.$attachmentPreview.insertAfter($sheet);dom.append($sheet,this.chatter.$el,{callbacks:[{widget:this.chatter}],in_DOM:this._isInDom,});}else{this.chatter.$el.insertAfter($sheet);dom.append($sheet,this.$attachmentPreview,{callbacks:[],in_DOM:this._isInDom,});}},_renderNode:function(node){if(node.tag==='div'&&node.attrs.class==='o_attachment_preview'){if(this.attachmentViewer){if(this.attachmentPreviewResID!==this.state.res_id){this.attachmentViewer.destroy();this.attachmentViewer=undefined;}}else{this.$attachmentPreview=$('<div>',{class:'o_attachment_preview'});}
this._handleAttributes(this.$attachmentPreview,node);this._registerModifiers(node,this.state,this.$attachmentPreview);if(node.attrs.options){this.$attachmentPreview.data(pyUtils.py_eval(node.attrs.options));}
if(this.attachmentPreviewWidth){this.$attachmentPreview.css('width',this.attachmentPreviewWidth);}
return this.$attachmentPreview;}else{return this._super.apply(this,arguments);}},_renderView:function(){var self=this;return this._super.apply(this,arguments).then(function(){var enablePreview=self.attachmentPreviewResID&&self.attachmentPreviewResID===self.state.res_id&&self.$attachmentPreview&&!self.$attachmentPreview.hasClass('o_invisible_modifier');self._interchangeChatter(enablePreview);});},_onAttachmentPreview:function(ev){if(config.device.size_class<config.device.SIZES.XXL){return;}
if(!this.$attachmentPreview){return;}
var self=this;var options=_.defaults(this.$attachmentPreview.data(),{types:['pdf','image'],order:'asc'});var attachments=$.extend(true,{},ev.data.attachments);attachments=_.filter(attachments,function(attachment){var match=attachment.mimetype.match(options.types.join('|'));attachment.type=match?match[0]:false;return match;});if(options.order==='desc'){attachments.reverse();}
if(attachments.length||this.attachmentViewer){if(this.attachmentViewer){if(this.attachmentViewer.attachments.length!==attachments.length){if(!attachments.length){this.attachmentViewer.destroy();this.attachmentViewer=undefined;this.attachmentPreviewResID=undefined;this._interchangeChatter(false);}
else{this.attachmentViewer.updateContents(attachments,options.order);}}
this.trigger_up('preview_attachment_validation');}else{this.attachmentPreviewResID=this.state.res_id;this.attachmentViewer=new AttachmentViewer(this,attachments);this.attachmentViewer.appendTo(this.$attachmentPreview).then(function(){self.trigger_up('preview_attachment_validation');self.$attachmentPreview.resizable({handles:'w',minWidth:400,maxWidth:900,resize:function(event,ui){self.attachmentPreviewWidth=ui.size.width;},});self._interchangeChatter(!self.$attachmentPreview.hasClass('o_invisible_modifier'));});}}},});});;

/* /mail_enterprise/static/src/js/attachment_viewer.js defined in bundle 'web.assets_backend' */
odoo.define('mail_enterprise.AttachmentViewer',function(require){"use strict";var core=require('web.core');var Widget=require('web.Widget');var QWeb=core.qweb;var AttachmentViewer=Widget.extend({className:'o_attachment_preview_container',events:{'click .arrow.o_move_next':'_onClickNext','click .arrow.o_move_previous':'_onClickPrevious',},init:function(parent,attachments){this._super.apply(this,arguments);this.attachments=attachments;this._setActive();},start:function(){this._renderAttachment();return this._super.apply(this,arguments);},updateContents:function(attachments,order){this.attachments=attachments;this._setActive();this._renderAttachment();},_renderAttachment:function(){this.$el.empty();this.$el.append(QWeb.render('mail_enterprise.AttachmentPreview',{widget:this}));},_setActive:function(){this.activeAttachment=_.find(this.attachments,function(attachment){return attachment.is_main;});if(!this.activeAttachment&&this.attachments.length){this.activeAttachment=this.attachments[0];this._rpc({model:'ir.attachment',method:'register_as_main_attachment',args:[[this.activeAttachment.id],this.activeAttachment.is_main===false],});}},_switch_main_attachment:function(index){var self=this;this.activeAttachment=this.attachments[index];this._rpc({model:'ir.attachment',method:'register_as_main_attachment',args:[[this.activeAttachment['id']]],}).then(function(){self._renderAttachment();});},_onClickNext:function(ev){ev.preventDefault();var index=_.findIndex(this.attachments,this.activeAttachment);index=index===this.attachments.length-1?0:index+1;this._switch_main_attachment(index);},_onClickPrevious:function(ev){ev.preventDefault();var index=_.findIndex(this.attachments,this.activeAttachment);index=index===0?this.attachments.length-1:index-1;this._switch_main_attachment(index);},});return AttachmentViewer;});;

/* /mail_enterprise/static/src/js/discuss.js defined in bundle 'web.assets_backend' */
odoo.define('mail_enterprise.Discuss',function(require){"use strict";var config=require('web.config');if(!config.device.isMobile){return;}
var core=require('web.core');var Discuss=require('mail.Discuss');var QWeb=core.qweb;const SwipeItemMixin=require('web_enterprise.SwipeItemMixin');const SnackBar=require('web_enterprise.SnackBar');const _t=core._t;Discuss.include(Object.assign({},SwipeItemMixin,{contentTemplate:'mail.discuss_mobile',events:Object.assign({},Discuss.prototype.events,SwipeItemMixin.events,{'click .o_mail_mobile_tab':'_onMobileTabClicked','click .o_mailbox_inbox_item':'_onMobileInboxButtonClicked','click .o_mail_preview':'_onMobileThreadClicked',}),init:function(){this._super.apply(this,arguments);this._currentState=this._defaultThreadID;SwipeItemMixin.init.call(this,{actions:{right:{classesImage:['fa-check-circle','fa','fa-2x','text-white'],backgroundClassColor:'bg-success',allowSwipe:ev=>this._allowRightSwipe(ev),actionCallback:(ev,restore)=>{const thread=this._getThreadFromSwipe(ev);this._toggleUnReadPreviewDisplay(ev,false);let params={message:_t('Marked as read'),delay:3000,onComplete:()=>this._processPreviewMarkAsRead(ev),actionText:_t('UNDO'),};if(thread&&thread.getType()!=='mailbox'){const hasUnreadMessage=this._getPreviewFromSwipe(ev).data('unread-counter')>0;params.onActionClick=()=>{this._toggleUnReadPreviewDisplay(ev,hasUnreadMessage);};new SnackBar(this,params).show();}else{const $target=$(ev.currentTarget);params.onActionClick=()=>{restore();this._toggleUnReadPreviewDisplay(ev,true);$target.slideDown('fast');};$target.slideUp('fast',()=>new SnackBar(this,params).show());}},avoidRestorePositionElement:ev=>{const thread=this._getThreadFromSwipe(ev);return thread&&thread.getType()==='mailbox';},},},selectorTarget:'.o_mail_preview',});},start:function(){this._$mainContent=this.$('.o_mail_discuss_content');return this._super.apply(this,arguments).then(this._updateControlPanel.bind(this)).then(()=>this._updateContent(this._thread._type==='mailbox'?'mailbox_inbox':this._thread._type));},on_attach_callback:function(){if(this._thread&&this._isInInboxTab()){this._threadWidget.scrollToPosition(this._threadsScrolltop[this._thread.getID()]);}},on_detach_callback:function(){if(this._isInInboxTab()){this._threadsScrolltop[this._thread.getID()]=this._threadWidget.getScrolltop();}},_allowRightSwipe(ev){if(this._thread._id==='mailbox_inbox'){return true;}
return this._getPreviewFromSwipe(ev).data('unread-counter')>0;},_getPreviewFromSwipe(ev){return $(ev.currentTarget);},_getThreadFromSwipe(ev){const previewID=this._getPreviewFromSwipe(ev).data('preview-id');return this.call('mail_service','getThread',previewID);},_initThreads:function(){return this._updateThreads();},_isInInboxTab:function(){return _.contains(['mailbox_inbox','mailbox_starred','mailbox_history'],this._currentState);},_processPreviewMarkAsRead(ev){const thread=this._getThreadFromSwipe(ev);if(thread){thread.markAsRead();}},_renderButtons:function(){var self=this;this._super.apply(this,arguments);_.each(['dm_chat','multi_user_channel'],function(type){var selector='.o_mail_discuss_button_'+type;self.$buttons.on('click',selector,self._onAddThread.bind(self));});},_restoreThreadState:function(){if(this._isInInboxTab()){this._super.apply(this,arguments);}},_selectMessage:function(){this._super.apply(this,arguments);this.$('.o_mail_mobile_tabs').addClass('o_hidden');},_setThread:function(threadID){var thread=this.call('mail_service','getThread',threadID);this._thread=thread;if(thread.getType()!=='mailbox'){this.call('mail_service','openThreadWindow',threadID);return Promise.resolve();}else{return this._super.apply(this,arguments);}},_storeThreadState:function(){if(this._thread&&this._isInInboxTab()){this._super.apply(this,arguments);}},_toggleUnReadPreviewDisplay(ev,state){this._getPreviewFromSwipe(ev).toggleClass('o_preview_unread',state);},_unselectMessage:function(){this._super.apply(this,arguments);this.$('.o_mail_mobile_tabs').removeClass('o_hidden');},_updateThreads:function(){return this._updateContent(this._currentState);},_updateContent:function(type){var self=this;var inMailbox=_.contains(['mailbox_inbox','mailbox_starred','mailbox_history'],type);if(!inMailbox&&this._isInInboxTab()){this._storeThreadState();}
var previouslyInInbox=this._isInInboxTab();this._currentState=type;var def;if(inMailbox){def=this._fetchAndRenderThread();}else{var allChannels=this.call('mail_service','getChannels');var channels=_.filter(allChannels,function(channel){return channel.getType()===type;});def=this.call('mail_service','getChannelPreviews',channels);}
return Promise.resolve(def).then(function(previews){if(inMailbox){if(!previouslyInInbox){self.$('.o_mail_discuss_tab_pane').remove();self._$mainContent.append(self._threadWidget.$el);self._$mainContent.append(self._extendedComposer.$el);}
self._restoreThreadState();}else{self._threadWidget.$el.detach();self._extendedComposer.$el.detach();var $content=$(QWeb.render('mail.discuss.MobileTabPane',{previews:previews,type:type,}));self._prepareAddThreadInput($content.find('.o_mail_add_thread input'),type);self._$mainContent.html($content);}
self.$buttons.find('button').removeClass('d-block').addClass('d-none');self.$buttons.find('.o_mail_discuss_button_'+type).removeClass('d-none').addClass('d-block');self.$buttons.find('.o_mail_discuss_button_mark_all_read').toggleClass('d-none',type!=='mailbox_inbox').toggleClass('d-block',type==='mailbox_inbox');self.$buttons.find('.o_mail_discuss_button_unstar_all').toggleClass('d-none',type!=='mailbox_starred').toggleClass('d-block',type==='mailbox_starred');if(inMailbox){self.$('.o_mail_discuss_mobile_mailboxes_buttons').removeClass('o_hidden');self.$('.o_mailbox_inbox_item').removeClass('btn-primary').addClass('btn-secondary');self.$('.o_mailbox_inbox_item[data-type='+type+']').removeClass('btn-secondary').addClass('btn-primary');}else{self.$('.o_mail_discuss_mobile_mailboxes_buttons').addClass('o_hidden');}
self.$('.o_mail_mobile_tab').removeClass('active');type=_.contains(['mailbox_inbox','mailbox_starred','mailbox_history'],type)?'mailbox_inbox':type;self.$('.o_mail_mobile_tab[data-type='+type+']').addClass('active');}).then(()=>{SwipeItemMixin.addClassesToTarget.call(this);return Promise.resolve();});},_onAddThread:function(){this.$('.o_mail_add_thread').show().find('input').focus();},_onMobileInboxButtonClicked:function(ev){var mailboxID=$(ev.currentTarget).data('type');this._setThread(mailboxID);this._updateContent(this._thread.getID());},_onMobileTabClicked:function(ev){var type=$(ev.currentTarget).data('type');if(type==='mailbox_inbox'){this._setThread(type);}
this._updateContent(type);},_onMobileThreadClicked:function(ev){var threadID=$(ev.currentTarget).data('preview-id');this.call('mail_service','openThreadWindow',threadID);},}));});;

/* /mail_enterprise/static/src/js/thread_field.js defined in bundle 'web.assets_backend' */
odoo.define('mail_enterprise.ThreadField',function(require){"use strict";var ThreadField=require('mail.ThreadField');ThreadField.include({_fetchAndRenderThread:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.trigger_up('preview_attachment',{attachments:self._threadWidget.attachments,});});},});var Chatter=require('mail.Chatter');Chatter.include({custom_events:_.extend({},Chatter.prototype.custom_events,{preview_attachment:'_onAttachmentPreview',}),_onAttachmentPreview:function(ev){var newInterceptedAttachmentIDs=_.difference(_.pluck(ev.data.attachments,'id'),_.pluck(this.attachments,'id'));if(newInterceptedAttachmentIDs.length>0){this._areAttachmentsLoaded=false;}
if(this._areAttachmentsLoaded){if(this.record.data.message_main_attachment_id!==undefined){var mainID=(this.record.data.message_main_attachment_id||{}).res_id;_.each(this.attachments,function(attachment){attachment.is_main=attachment.id==mainID;});}
ev.data.attachments=this.attachments;}else{ev.stopPropagation();return this._fetchAttachments().then(this.trigger_up.bind(this,'preview_attachment'));}},_onReloadAttachmentBox:function(){this._super.apply(this,arguments);this.trigger_up('preview_attachment');},});});;

/* /mail_enterprise/static/src/js/thread_window_mobile.js defined in bundle 'web.assets_backend' */
odoo.define('mail_enterprise.ThreadWindow',function(require){"use strict";var ThreadWindow=require('mail.ThreadWindow');var mobileMixins=require('web_mobile.mixins');ThreadWindow.include(_.extend({},mobileMixins.BackButtonEventMixin,{destroy:function(){this.on_detach_callback();this._super.apply(this,arguments);},appendTo:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.on_attach_callback();});},_onBackButton:ThreadWindow.prototype._onClickClose,}));});;

/* /mail_enterprise/static/src/js/thread_widget_mobile.js defined in bundle 'web.assets_backend' */
odoo.define('mail_enterprise.widget.Thread',function(require){const config=require('web.config');if(!config.device.isMobile){return;}
const core=require('web.core');const ThreadWidget=require('mail.widget.Thread');const SwipeItemMixin=require('web_enterprise.SwipeItemMixin');const SnackBar=require('web_enterprise.SnackBar');const _t=core._t;ThreadWidget.include(Object.assign({},SwipeItemMixin,{events:Object.assign({},SwipeItemMixin.events,ThreadWidget.prototype.events),init(){SwipeItemMixin.init.call(this,{actions:{right:{classesImage:['fa-check-circle','fa','fa-2x','text-white'],backgroundClassColor:'bg-success',allowSwipe:ev=>this._allowRightSwipe(ev),actionCallback:(ev,restore)=>{const $threadMessageElement=this._getThreadMessageElement(ev);const messageId=$threadMessageElement.data('message-id');if(this._currentThreadID==='mailbox_inbox'&&messageId){let params={message:_t('Marked as read'),delay:3000,onComplete:()=>{this.trigger('mark_as_read',messageId);},actionText:_t('UNDO'),onActionClick:()=>{$threadMessageElement.slideDown('fast');restore();},};$threadMessageElement.slideUp('fast',()=>new SnackBar(this,params).show());}},avoidRestorePositionElement:()=>true,},},selectorTarget:'.o_thread_message',});return this._super(...arguments);},render(thread,options){options=Object.assign({},options,{displayMarkAsRead:false,});let renderResult=this._super(thread,options);SwipeItemMixin.addClassesToTarget.call(this);return renderResult;},_allowRightSwipe(ev){return this._currentThreadID==='mailbox_inbox';},_getThreadMessageElement(ev){return $(ev.currentTarget);},}));});;

/* /mail_enterprise/static/src/js/systray_messaging_menu_mobile.js defined in bundle 'web.assets_backend' */
odoo.define('mail_enterprise.systray.MessagingMenu',function(require){const config=require('web.config');if(!config.device.isMobile){return;}
const core=require('web.core');const MessagingMenu=require('mail.systray.MessagingMenu');const SwipeItemMixin=require('web_enterprise.SwipeItemMixin');const SnackBar=require('web_enterprise.SnackBar');const _t=core._t;MessagingMenu.include(Object.assign({},SwipeItemMixin,{events:Object.assign({},SwipeItemMixin.events,MessagingMenu.prototype.events),init(){SwipeItemMixin.init.call(this,{actions:{right:{classesImage:['fa-check-circle','fa','fa-2x','text-white'],backgroundClassColor:'bg-success',allowSwipe:ev=>this._allowRightSwipe(ev),actionCallback:(ev,restore)=>{const $preview=this._getPreviewFromSwipe(ev);this._toggleUnReadPreviewDisplay(ev);const isNotificationNotDiscuss=isNaN($preview.data('preview-id'));let params={message:_t('Marked as read'),delay:3000,onComplete:()=>this._markAsRead($preview),actionText:_t('UNDO'),onActionClick:()=>{this._toggleUnReadPreviewDisplay(ev);}};if(isNotificationNotDiscuss){const $target=$(ev.currentTarget);params.onActionClick=()=>{restore();this._toggleUnReadPreviewDisplay(ev);$target.slideDown('fast');};$target.slideUp('fast',()=>new SnackBar(this,params).show());}else{new SnackBar(this,params).show();}},avoidRestorePositionElement:ev=>{const $preview=this._getPreviewFromSwipe(ev);return isNaN($preview.data('preview-id'));},},},selectorTarget:'.o_mail_preview',});return this._super(...arguments);},_allowRightSwipe(ev){const $preview=this._getPreviewFromSwipe(ev);const previewID=$preview.data('preview-id');if(previewID==='mail_failure'||previewID==='sms_failure'){return false;}
if(previewID==='mailbox_inbox'){return true;}else{return $preview.data('unread-counter')>0;}},_getPreviewFromSwipe(ev){return $(ev.currentTarget);},_renderPreviews:function(){this._super(...arguments);SwipeItemMixin.addClassesToTarget.call(this);},_toggleUnReadPreviewDisplay(ev){this._getPreviewFromSwipe(ev).toggleClass('o_preview_unread');},}));});;

/* /snailmail/static/src/js/mail_failure.js defined in bundle 'web.assets_backend' */
odoo.define('snailmail.model.MailFailure',function(require){"use strict";var MailFailure=require('mail.model.MailFailure');var core=require('web.core');var _t=core._t;MailFailure.include({getPreview:function(){var preview=this._super.apply(this,arguments);if(this._failureType==='snailmail'){_.extend(preview,{body:_t("An error occured when sending a letter with Snailmail"),id:'snailmail_failure',});}
return preview;},});});;

/* /snailmail/static/src/js/message.js defined in bundle 'web.assets_backend' */
odoo.define('snailmail.model.Message',function(require){"use strict";var Message=require('mail.model.Message');Message.include({cancelLetter:function(){var self=this;var mailBus=this.call('mail_service','getMailBus');return this._rpc({model:'mail.message',method:'cancel_letter',args:[[this.getID()]],}).then(function(){self.setSnailmailStatus('canceled');self.setSnailmailError(false);mailBus.trigger('update_message',self);});},getSnailmailStatus:function(){return this._snailmailStatus.toLowerCase();},getSnailmailError:function(){return this._snailmailError;},resendLetter:function(){return this._rpc({model:'mail.message',method:'send_letter',args:[[this.getID()]],});},setSnailmailStatus:function(snailmailStatus){this._snailmailStatus=snailmailStatus;},setSnailmailError:function(snailmailError){this._snailmailError=snailmailError;},_setInitialData:function(data){this._super.apply(this,arguments);this._snailmailStatus=data.snailmail_status;this._snailmailError=data.snailmail_error;},});});;

/* /snailmail/static/src/js/snailmail_notification_manager.js defined in bundle 'web.assets_backend' */
odoo.define('snailmail.NotificationManager',function(require){"use strict";var MailManager=require('mail.Manager');var MailFailure=require('mail.model.MailFailure');MailManager.include({_handlePartnerNotification:function(data){if(data.type==='snailmail_update'){this._handleSnailmailUpdateNotification(data);}else{this._super.apply(this,arguments);}},_handleSnailmailUpdateNotification:function(datas){var self=this;_.each(datas.elements,function(data){var isNewFailure=data.snailmail_error;var matchedFailure=_.find(self._mailFailures,function(failure){return failure.getMessageID()===data.message_id;});if(matchedFailure){var index=_.findIndex(self._mailFailures,matchedFailure);if(isNewFailure){self._mailFailures[index]=new MailFailure(self,data);}else{self._mailFailures.splice(index,1);}}else if(isNewFailure){self._mailFailures.push(new MailFailure(self,data));}
var message=_.find(self._messages,function(msg){return msg.getID()===data.message_id;});if(message){message.setSnailmailStatus(data.snailmail_status);message.setSnailmailError(data.snailmail_error);self._mailBus.trigger('update_message',message);}});this._mailBus.trigger('update_needaction',this.needactionCounter);},});});;

/* /snailmail/static/src/js/systray_messaging_menu.js defined in bundle 'web.assets_backend' */
odoo.define('snailmail.systray.MessagingMenu',function(require){"use strict";var MessagingMenu=require('mail.systray.MessagingMenu');MessagingMenu.include({_clickSnailmailFailurePreview:function($target){var documentID=$target.data('document-id');var documentModel=$target.data('document-model');if(documentModel&&documentID){this._openDocument(documentModel,documentID);}else if(documentModel!=='mail.channel'){this.do_action({name:"Snailmail failures",type:'ir.actions.act_window',view_mode:'kanban,list,form',views:[[false,'kanban'],[false,'list'],[false,'form']],target:'current',res_model:documentModel,domain:[['message_ids.snailmail_error','=',true]],});}},_onClickPreview:function(ev){var $target=$(ev.currentTarget);var previewID=$target.data('preview-id');if(previewID==='snailmail_failure'){this._clickSnailmailFailurePreview($target);}else{this._super.apply(this,arguments);}},_onClickPreviewMarkAsRead:function(ev){ev.stopPropagation();var $preview=$(ev.currentTarget).closest('.o_mail_preview');var previewID=$preview.data('preview-id');if(previewID==='snailmail_failure'){var documentModel=$preview.data('document-model');var unreadCounter=$preview.data('unread-counter');this.do_action('snailmail.snailmail_letter_cancel_action',{additional_context:{default_model:documentModel,unread_counter:unreadCounter}});}else{this._super.apply(this,arguments);}},});});;

/* /snailmail/static/src/js/thread_widget.js defined in bundle 'web.assets_backend' */
odoo.define('snailmail.widget.Thread',function(require){"use strict";var ThreadWidget=require('mail.widget.Thread');var Dialog=require('web.Dialog');var core=require('web.core');var QWeb=core.qweb;var _t=core._t;ThreadWidget.include({dependencies:['bus_service'],events:_.extend({},ThreadWidget.prototype.events,{'click .o_thread_message_snailmail_missing_required_fields':'_onClickMissingRequiredFields','click .o_thread_message_snailmail_credit_error':'_onClickCreditError','click .o_thread_message_snailmail_trial_error':'_onClickTrialError','click .o_thread_message_snailmail_no_price_available':'_onClickNoPriceAvailable','click .o_thread_message_snailmail_format_error':'_onClickFormatError','click .o_thread_message_snailmail_unknown_error':'_onClickUnknownError',}),init:function(){this._super.apply(this,arguments);this._enabledOptions=_.defaults(this._enabledOptions,{displaySnailmailIcons:true,});this._disabledOptions=_.defaults(this._disabledOptions,{displaySnailmailIcons:false,});},render:function(thread,options){this._super.apply(this,arguments);var messages=_.clone(thread.getMessages({domain:options.domain||[]}));this._messages=messages;this._renderMessageSnailmailPopover();},_openCreditErrorDialog:function(messageID,content){var message=_.find(this._messages,function(message){return message.getID()===messageID;});new Dialog(this,{size:'medium',title:_t("Failed letter"),$content:$('<div>').html(content),buttons:[{text:_t("Re-send letter"),classes:'btn-primary',close:true,click:_.bind(message.resendLetter,message)},{text:_t("Cancel letter"),close:true,click:_.bind(message.cancelLetter,message)},{text:_t("Close"),close:true},],}).open();},_openGenericErrorDialog:function(messageID,content){var message=_.find(this._messages,function(message){return message.getID()===messageID;});new Dialog(this,{size:'medium',title:_t("Failed letter"),$content:$('<div>').html(content),buttons:[{text:_t("Cancel letter"),classes:'btn-primary',close:true,click:_.bind(message.cancelLetter,message)},{text:_t("Close"),close:true},],}).open();},_renderMessageSnailmailPopover:function(){var self=this;if(this._messageSnailmailPopover){this._messageSnailmailPopover.popover('hide');}
if(!this.$('.o_thread_snailmail_tooltip').length){return;}
this._messageSnailmailPopover=this.$('.o_thread_snailmail_tooltip').popover({html:true,boundary:'viewport',placement:'auto',trigger:'hover',offset:'0, 1',content:function(){var messageID=$(this).data('message-id');var message=_.find(self._messages,function(message){return message.getID()===messageID;});return QWeb.render('snailmail.widget.Thread.Message.SnailmailTooltip',{status:message.getSnailmailStatus()});},});},_onClickCreditError:function(ev){var self=this;var messageID=$(ev.currentTarget).data('message-id');this._rpc({model:'iap.account',method:'get_credits_url',args:['snailmail'],}).then(function(link){var content=_.str.sprintf(_t('<p>The letter could not be sent due to insufficient credits on your IAP account.</p>'+'<div class= "text-right">'+'<a class="btn btn-link buy_credits" href=%s target="_blank">'+'<i class= "fa fa-arrow-right"/> Buy credits'+'</a>'+'</div>'),link);self._openCreditErrorDialog(messageID,content);});},_onClickFormatError:function(ev){var messageID=$(ev.currentTarget).data('message-id');this.do_action('snailmail.snailmail_letter_format_error_action',{additional_context:{message_id:messageID,}});},_onClickMissingRequiredFields:function(ev){var self=this;var messageID=$(ev.currentTarget).data('message-id');var domain=[['message_id','=',messageID]];this._rpc({model:'snailmail.letter',method:'search',args:[domain],}).then(function(letterIds){self.do_action('snailmail.snailmail_letter_missing_required_fields_action',{additional_context:{letter_id:letterIds[0]},on_close:function(){self.trigger_up('reload');}});});},_onClickNoPriceAvailable:function(ev){var messageID=$(ev.currentTarget).data('message-id');var content=_t('<p>The country to which you want to send the letter is not supported by our service.</p>');this._openGenericErrorDialog(messageID,content);},_onClickTrialError:function(ev){var self=this;var messageID=$(ev.currentTarget).data('message-id');this._rpc({model:'iap.account',method:'get_credits_url',args:['snailmail','',0,true],}).then(function(link){var content=_.str.sprintf(_t('<p>You need credits on your IAP account to send a letter.</p>'+'<div class= "text-right">'+'<a class="btn btn-link buy_credits" href=%s>'+'<i class= "fa fa-arrow-right"/> Buy credits'+'</a>'+'</div>'),link);self._openCreditErrorDialog(messageID,content);});},_onClickUnknownError:function(ev){var messageID=$(ev.currentTarget).data('message-id');var content=_t('<p>An unknown error occured. Please contact our <a href="https://www.odoo.com/help" target="new">support</a> for further assistance.</p>');this._openGenericErrorDialog(messageID,content);},});});;

/* /hr/static/src/js/chat.js defined in bundle 'web.assets_backend' */
odoo.define('hr.employee_chat',function(require){'use strict';var FormController=require('web.FormController');var FormView=require('web.FormView');var FormRenderer=require('web.FormRenderer');var viewRegistry=require('web.view_registry');var EmployeeFormRenderer=FormRenderer.extend({_render:function(){var self=this;return this._super.apply(this,arguments).then(function(){var $chat_button=self.$el.find('.o_employee_chat_btn');if(self.state.context.uid===self.state.data.user_id.res_id){$chat_button.hide();}
else{$chat_button.off('click').on('click',self._onOpenChat.bind(self));}});},destroy:function(){this.$el.find('.o_employee_chat_btn').off('click');return this._super();},_onOpenChat:function(ev){ev.preventDefault();ev.stopImmediatePropagation();this.trigger_up('open_chat',{partner_id:this.state.data.user_partner_id.res_id});return true;},});var EmployeeFormController=FormController.extend({custom_events:_.extend({},FormController.prototype.custom_events,{open_chat:'_onOpenChat'}),_onOpenChat:function(ev){var self=this;var dmChat=this.call('mail_service','getDMChatFromPartnerID',ev.data.partner_id);if(dmChat){dmChat.detach();}else{var def=this.call('mail_service','createChannel',ev.data.partner_id,'dm_chat').then(function(dmChatId){dmChat=self.call('mail_service','getChannel',dmChatId);dmChat.detach();});Promise.resolve(def);}},});var EmployeeFormView=FormView.extend({config:_.extend({},FormView.prototype.config,{Controller:EmployeeFormController,Renderer:EmployeeFormRenderer}),});viewRegistry.add('hr_employee_form',EmployeeFormView);return EmployeeFormView;});;

/* /hr/static/src/js/language.js defined in bundle 'web.assets_backend' */
odoo.define('hr.employee_language',function(require){'use strict';var FormController=require('web.FormController');var FormView=require('web.FormView');var viewRegistry=require('web.view_registry');var EmployeeFormController=FormController.extend({saveRecord:function(){var self=this;return this._super.apply(this,arguments).then(function(){if(arguments[0].indexOf('lang')>=0){self.do_action('reload_context');}});},});var EmployeeProfileFormView=FormView.extend({config:_.extend({},FormView.prototype.config,{Controller:EmployeeFormController,}),});viewRegistry.add('hr_employee_profile_form',EmployeeProfileFormView);return EmployeeProfileFormView;});;

/* /sms/static/src/js/fields_phone_widget.js defined in bundle 'web.assets_backend' */
odoo.define('sms.fields',function(require){"use strict";var basic_fields=require('web.basic_fields');var core=require('web.core');var session=require('web.session');var _t=core._t;var Phone=basic_fields.FieldPhone;Phone.include({_onClickSMS:function(ev){ev.preventDefault();var context=session.user_context;context=_.extend({},context,{default_res_model:this.model,default_res_id:parseInt(this.res_id),default_number_field_name:this.name,default_composition_mode:'comment',});var self=this;return this.do_action({title:_t('Send SMS Text Message'),type:'ir.actions.act_window',res_model:'sms.composer',target:'new',views:[[false,'form']],context:context,},{on_close:function(){self.trigger_up('reload');}});},_renderReadonly:function(){var def=this._super.apply(this,arguments);if(this.nodeOptions.enable_sms){var $composerButton=$('<a>',{title:_t('Send SMS Text Message'),href:'',class:'ml-3 d-inline-flex align-items-center o_field_phone_sms',html:$('<small>',{class:'font-weight-bold ml-1',html:'SMS'}),});$composerButton.prepend($('<i>',{class:'fa fa-mobile'}));$composerButton.on('click',this._onClickSMS.bind(this));this.$el=$('<div/>').append(this.$el).append($composerButton);}
return def;},});return Phone;});;

/* /sms/static/src/js/fields_sms_widget.js defined in bundle 'web.assets_backend' */
odoo.define('sms.sms_widget',function(require){"use strict";var basicFields=require('web.basic_fields');var core=require('web.core');var fieldRegistry=require('web.field_registry');var FieldText=basicFields.FieldText;var _t=core._t;var SmsWidget=FieldText.extend({className:'o_field_text',init:function(){this._super.apply(this,arguments);this.nbrChar=0;this.nbrSMS=0;this.encoding='GSM7';},_renderEdit:function(){var def=this._super.apply(this,arguments);this._compute();$('.o_sms_container').remove();var $sms_container=$('<div class="o_sms_container"/>');$sms_container.append(this._renderSMSInfo());$sms_container.append(this._renderIAPButton());this.$el=this.$el.add($sms_container);return def;},_compute:function(){var content=this._getValue();this.encoding=this._extractEncoding(content);this.nbrChar=content.length;this.nbrChar+=(content.match(/\n/g)||[]).length;this.nbrSMS=this._countSMS(this.nbrChar,this.encoding);},_countSMS:function(){if(this.nbrChar===0){return 0;}
if(this.encoding==='UNICODE'){if(this.nbrChar<=70){return 1;}
return Math.ceil(this.nbrChar/67);}
if(this.nbrChar<=160){return 1;}
return Math.ceil(this.nbrChar/153);},_extractEncoding:function(content){if(String(content).match(RegExp("^[@£$¥èéùìòÇ\\nØø\\rÅåΔ_ΦΓΛΩΠΨΣΘΞÆæßÉ !\\\"#¤%&'()*+,-./0123456789:;<=>?¡ABCDEFGHIJKLMNOPQRSTUVWXYZÄÖÑÜ§¿abcdefghijklmnopqrstuvwxyzäöñüà]*$"))){return'GSM7';}
return'UNICODE';},_renderIAPButton:function(){return $('<a>',{'href':'https://iap-services.odoo.com/iap/sms/pricing','target':'_blank','title':_t('SMS Pricing'),'aria-label':_t('SMS Pricing'),'class':'fa fa-lg fa-info-circle',});},_renderSMSInfo:function(){var string=_.str.sprintf(_t('%s characters, fits in %s SMS (%s) '),this.nbrChar,this.nbrSMS,this.encoding);var $span=$('<span>',{'class':'text-muted o_sms_count',});$span.text(string);return $span;},_updateSMSInfo:function(){this._compute();var string=_.str.sprintf(_t('%s characters, fits in %s SMS (%s) '),this.nbrChar,this.nbrSMS,this.encoding);this.$('.o_sms_count').text(string);},_onChange:function(){this._super.apply(this,arguments);this._updateSMSInfo();},_onInput:function(){this._super.apply(this,arguments);this._updateSMSInfo();},});fieldRegistry.add('sms_widget',SmsWidget);return SmsWidget;});;

/* /sms/static/src/js/mail_failure.js defined in bundle 'web.assets_backend' */
odoo.define('sms.model.MailFailure',function(require){'use strict';var MailFailure=require('mail.model.MailFailure');var core=require('web.core');var _t=core._t;MailFailure.include({getPreview:function(){var preview=this._super.apply(this,arguments);if(this._failureType==='sms'){_.extend(preview,{body:_t('An error occurred when sending an SMS'),id:'sms_failure',});}
return preview;},});});;

/* /sms/static/src/js/message.js defined in bundle 'web.assets_backend' */
odoo.define('sms.model.Message',function(require){"use strict";var Message=require('mail.model.Message');Message.include({getSmsIds:function(){return this._smsIds;},getSmsStatus:function(){var self=this;this._smsStatus='sent';_.each(this._smsIds,function(sms){if(sms[2]==='bounce'||sms[2]==='exception'){self._smsStatus='error';}});return this._smsStatus;},hasSmsData:function(){return!!(this._smsIds&&(this._smsIds.length>0));},isError:function(){return this.getSmsStatus()==='error';},setSmsStatus:function(smsID,smsStatus){var self=this;var sms=_.find(self._smsIds,function(sms){return sms[0]===smsID;});if(sms!==undefined&&smsStatus!==undefined){sms[2]=smsStatus;}},_setInitialData:function(data){this._super.apply(this,arguments);this._smsIds=data.sms_ids;if(this._smsStatus===false){this._smsStatus='sent';}},});});;

/* /sms/static/src/js/sms_notification_manager.js defined in bundle 'web.assets_backend' */
odoo.define('sms.NotificationManager',function(require){"use strict";var MailManager=require('mail.Manager');var MailFailure=require('mail.model.MailFailure');MailManager.include({_handlePartnerNotification:function(data){if(data.type==='sms_update'){this._handleSMSUpdateNotification(data);}else{this._super.apply(this,arguments);}},_handleSMSUpdateNotification:function(datas){var self=this;_.each(datas.elements,function(data){var isNewFailure=data.sms_status==='error';var matchedFailure=_.find(self._mailFailures,function(failure){return failure.getMessageID()===data.message_id;});if(matchedFailure){var index=_.findIndex(self._mailFailures,matchedFailure);if(isNewFailure){self._mailFailures[index]=new MailFailure(self,data);}else{self._mailFailures.splice(index,1);}}else if(isNewFailure){self._mailFailures.push(new MailFailure(self,data));}
var message=_.find(self._messages,function(msg){return msg.getID()===data.message_id;});if(message){message.setSmsStatus(data.sms_id,data.sms_status);self._mailBus.trigger('update_message',message);}});this._mailBus.trigger('update_needaction',this.needactionCounter);},});});;

/* /sms/static/src/js/systray_messaging_menu.js defined in bundle 'web.assets_backend' */
odoo.define('sms.systray.MessagingMenu',function(require){"use strict";var core=require('web.core');var MessagingMenu=require('mail.systray.MessagingMenu');var _t=core._t;MessagingMenu.include({_clickSMSFailurePreview:function($target){var documentID=$target.data('document-id');var documentModel=$target.data('document-model');if(documentModel&&documentID){this._openDocument(documentModel,documentID);}else if(documentModel!=='mail.channel'){this.do_action({name:_t('SMS Failures'),type:'ir.actions.act_window',view_mode:'kanban,list,form',views:[[false,'kanban'],[false,'list'],[false,'form']],target:'current',res_model:documentModel,domain:[['message_has_sms_error','=',true]],});}},_onClickPreview:function(ev){var $target=$(ev.currentTarget);var previewID=$target.data('preview-id');if(previewID==='sms_failure'){this._clickSMSFailurePreview($target);}else{this._super.apply(this,arguments);}},_onClickPreviewMarkAsRead:function(ev){ev.stopPropagation();var $preview=$(ev.currentTarget).closest('.o_mail_preview');var previewID=$preview.data('preview-id');if(previewID==='sms_failure'){var documentModel=$preview.data('document-model');var unreadCounter=$preview.data('unread-counter');this.do_action('sms.sms_cancel_action',{additional_context:{default_model:documentModel,unread_counter:unreadCounter}});}else{this._super.apply(this,arguments);}},});});;

/* /sms/static/src/js/thread_widget.js defined in bundle 'web.assets_backend' */
odoo.define('sms.widget.Thread',function(require){"use strict";var ThreadWidget=require('mail.widget.Thread');var core=require('web.core');var QWeb=core.qweb;ThreadWidget.include({events:_.extend({},ThreadWidget.prototype.events,{'click .o_thread_message_sms_error':'_onClickSMSError'}),init:function(){this._super.apply(this,arguments);this._enabledOptions=_.defaults(this._enabledOptions,{displaySmsIcons:true,});this._disabledOptions=_.defaults(this._disabledOptions,{displaySmsIcons:false,});},render:function(thread,options){this._super.apply(this,arguments);var messages=_.clone(thread.getMessages({domain:options.domain||[]}));this._renderMessageSmsPopover(messages);},_renderMessageSmsPopover:function(messages){if(this._messageSmsPopover){this._messageSmsPopover.popover('hide');}
if(!this.$('.o_thread_sms_tooltip').length){return;}
this._messageSmsPopover=this.$('.o_thread_sms_tooltip').popover({html:true,boundary:'viewport',placement:'auto',trigger:'hover',offset:'0, 1',content:function(){var messageID=$(this).data('message-id');var message=_.find(messages,function(message){return message.getID()===messageID;});return QWeb.render('sms.widget.Thread.Message.SmsTooltip',{data:message.getSmsIds()});},});},_onClickSMSError:function(ev){var messageID=$(ev.currentTarget).data('message-id');this.do_action('sms.sms_resend_action',{additional_context:{default_mail_message_id:messageID}});},});});;

/* /survey/static/src/js/fields_section_one2many.js defined in bundle 'web.assets_backend' */
odoo.define('survey.question_page_one2many',function(require){"use strict";var Context=require('web.Context');var FieldOne2Many=require('web.relational_fields').FieldOne2Many;var FieldRegistry=require('web.field_registry');var ListRenderer=require('web.ListRenderer');var config=require('web.config');var SectionListRenderer=ListRenderer.extend({init:function(parent,state,params){this.sectionFieldName="is_page";this._super.apply(this,arguments);},_checkIfRecordIsSection:function(id){var record=this._findRecordById(id);return record&&record.data[this.sectionFieldName];},_findRecordById:function(id){return _.find(this.state.data,function(record){return record.id===id;});},_renderBodyCell:function(record,node,index,options){var $cell=this._super.apply(this,arguments);var isSection=record.data[this.sectionFieldName];if(isSection){if(node.attrs.widget==="handle"||node.attrs.name==="random_questions_count"){return $cell;}else if(node.attrs.name==="title"){var nbrColumns=this._getNumberOfCols();if(this.handleField){nbrColumns--;}
if(this.addTrashIcon){nbrColumns--;}
if(record.data.questions_selection==="random"){nbrColumns--;}
$cell.attr('colspan',nbrColumns);}else{$cell.removeClass('o_invisible_modifier');return $cell.addClass('o_hidden');}}
return $cell;},_renderRow:function(record,index){var $row=this._super.apply(this,arguments);if(record.data[this.sectionFieldName]){$row.addClass("o_is_section");}
return $row;},_renderView:function(){var def=this._super.apply(this,arguments);var self=this;return def.then(function(){self.$('table.o_list_table').addClass('o_section_list_view');});},_onRowClicked:function(ev){var parent=this.getParent();var recordId=$(ev.currentTarget).data('id');var is_section=this._checkIfRecordIsSection(recordId);if(is_section&&parent.mode==="edit"){this.editable="bottom";}else{this.editable=null;}
this._super.apply(this,arguments);},_onCellClick:function(ev){var parent=this.getParent();var recordId=$(ev.currentTarget.parentElement).data('id');var is_section=this._checkIfRecordIsSection(recordId);if(is_section&&parent.mode==="edit"){this.editable="bottom";}else{this.editable=null;this.unselectRow();}
this._super.apply(this,arguments);},_onNavigationMove:function(ev){this.unselectRow();},});var SectionFieldOne2Many=FieldOne2Many.extend({init:function(parent,name,record,options){this._super.apply(this,arguments);this.sectionFieldName="is_page";this.rendered=false;},_getRenderer:function(){if(this.view.arch.tag==='tree'){return SectionListRenderer;}
return this._super.apply(this,arguments);},_onAddRecord:function(ev){this.editable=null;if(!config.device.isMobile){var context_str=ev.data.context&&ev.data.context[0];var context=new Context(context_str).eval();if(context['default_'+this.sectionFieldName]){this.editable="bottom";}}
this._super.apply(this,arguments);},});FieldRegistry.add('question_page_one2many',SectionFieldOne2Many);});;

/* /web_studio/static/src/js/home_menu_all.js defined in bundle 'web.assets_backend' */
odoo.define('web_studio.HomeMenuAll',function(require){"use strict";var session=require('web.session');var WebClient=require('web.WebClient');var HomeMenu=require('web_enterprise.HomeMenu');HomeMenu.include({start:function(){this._setBackgroundImage();return this._super.apply(this,arguments);},_processMenuData:function(menuData){this._hasCustomBackground=menuData.background_image;return this._super.apply(this,arguments);},_setBackgroundImage:function(){if(this._hasCustomBackground){var url=session.url('/web/image',{model:'res.company',id:session.user_context.allowed_company_ids[0],field:'background_image',});this.$el.css({"background-image":"url("+url+")","background-size":"cover",});}},});WebClient.include({toggle_home_menu:function(display){this._super.apply(this,arguments);this.$el.toggleClass('o_home_menu_background_custom',display&&!!this.menu_data.background_image);},});});;

/* /hr_gamification/static/src/js/gamification.js defined in bundle 'web.assets_backend' */
odoo.define('hr_gamification.hr_gamification',function(require){"use strict";var KanbanRecord=require('web.KanbanRecord');KanbanRecord.include({_openRecord:function(){if(this.modelName==='gamification.badge.user'){var action={type:'ir.actions.act_window',res_model:'gamification.badge',view_mode:'form',views:[[false,'form']],res_id:this.record.badge_id.raw_value};this.do_action(action);}else{this._super.apply(this,arguments);}}});});;

/* /hr_holidays/static/src/js/time_off_calendar.js defined in bundle 'web.assets_backend' */
odoo.define('hr_holidays.dashboard.view_custo',function(require){'use strict';var core=require('web.core');var CalendarController=require("web.CalendarController");var CalendarRenderer=require("web.CalendarRenderer");var CalendarView=require("web.CalendarView");var viewRegistry=require('web.view_registry');var _t=core._t;var QWeb=core.qweb;var TimeOffCalendarController=CalendarController.extend({events:_.extend({},CalendarController.prototype.events,{'click .btn-time-off':'_onNewTimeOff','click .btn-allocation':'_onNewAllocation',}),renderButtons:function($node){this._super.apply(this,arguments);$(QWeb.render('hr_holidays.dashboard.calendar.button',{time_off:_t('New Time Off Request'),request:_t('New Allocation Request'),})).appendTo(this.$buttons);if($node){this.$buttons.appendTo($node);}else{this.$('.o_calendar_buttons').replaceWith(this.$buttons);}},_onNewTimeOff:function(){var self=this;this.do_action('hr_holidays.hr_leave_action_my_request',{on_close:function(){self.reload();}});},_onNewAllocation:function(){var self=this;this.do_action({type:'ir.actions.act_window',res_model:'hr.leave.allocation',name:'New Allocation Request',views:[[false,'form']],context:{'form_view_ref':'hr_holidays.hr_leave_allocation_view_form_dashboard'},target:'new',},{on_close:function(){self.reload();}});},});var TimeOffCalendarRenderer=CalendarRenderer.extend({_render:function(){var self=this;return this._super.apply(this,arguments).then(function(){return self._rpc({model:'hr.leave.type',method:'get_days_all_request',context:self.context,});}).then(function(result){self.$el.parent().find('.o_timeoff_container').remove();var elem=QWeb.render('hr_holidays.dashboard_calendar_header',{timeoffs:result,});self.$el.before(elem);});},});var TimeOffCalendarView=CalendarView.extend({config:_.extend({},CalendarView.prototype.config,{Controller:TimeOffCalendarController,Renderer:TimeOffCalendarRenderer,}),});viewRegistry.add('time_off_calendar',TimeOffCalendarView);});;

/* /hr_holidays/static/src/js/leave_stats_widget.js defined in bundle 'web.assets_backend' */
odoo.define('hr_holidays.LeaveStatsWidget',function(require){"use strict";var time=require('web.time');var Widget=require('web.Widget');var widget_registry=require('web.widget_registry');var LeaveStatsWidget=Widget.extend({template:'hr_holidays.leave_stats',init:function(parent,params){this._setState(params);this._super(parent);},willStart:function(){return Promise.all([this._super(),this._fetchLeaveTypesData(),this._fetchDepartmentLeaves()]);},updateState:function(state){var self=this;var to_await=[];var updatedFields=this._setState(state);if(_.intersection(updatedFields,['employee','date']).length){to_await.push(this._fetchLeaveTypesData());}
if(_.intersection(updatedFields,['department','date']).length){to_await.push(this._fetchDepartmentLeaves());}
return Promise.all(to_await).then(function(){self.renderElement();});},_setState:function(state){var updatedFields=[];if(state.data.employee_id.res_id!==(this.employee&&this.employee.res_id)){updatedFields.push('employee');this.employee=state.data.employee_id;}
if(state.data.department_id.res_id!==(this.department&&this.department.res_id)){updatedFields.push('department');this.department=state.data.department_id;}
if(state.data.date_from!==this.date){updatedFields.push('date');this.date=state.data.date_from;}
return updatedFields;},_fetchDepartmentLeaves:function(){if(!this.date||!this.department){this.departmentLeaves=null;return Promise.resolve();}
var self=this;var month_date_from=this.date.clone().startOf('month');var month_date_to=this.date.clone().endOf('month');return this._rpc({model:'hr.leave',method:'search_read',args:[[['department_id','=',this.department.res_id],['state','=','validate'],['holiday_type','=','employee'],['date_from','<=',month_date_to],['date_to','>=',month_date_from]],['employee_id','date_from','date_to','number_of_days'],],}).then(function(data){var dateFormat=time.getLangDateFormat();self.departmentLeaves=data.map(function(leave){return _.extend(leave,{date_from:moment(leave.date_from).format(dateFormat),date_to:moment(leave.date_to).format(dateFormat),number_of_days:leave.number_of_days,});});});},_fetchLeaveTypesData:function(){if(!this.date||!this.employee){this.leavesPerType=null;return Promise.resolve();}
var self=this;var year_date_from=this.date.clone().startOf('year');var year_date_to=this.date.clone().endOf('year');return this._rpc({model:'hr.leave',method:'read_group',kwargs:{domain:[['employee_id','=',this.employee.res_id],['state','=','validate'],['date_from','<=',year_date_to],['date_to','>=',year_date_from]],fields:['holiday_status_id','number_of_days:sum'],groupby:['holiday_status_id'],},}).then(function(data){self.leavesPerType=data;});}});widget_registry.add('hr_leave_stats',LeaveStatsWidget);return LeaveStatsWidget;});;

/* /hr_org_chart/static/src/js/hr_org_chart.js defined in bundle 'web.assets_backend' */
odoo.define('web.OrgChart',function(require){"use strict";var AbstractField=require('web.AbstractField');var concurrency=require('web.concurrency');var core=require('web.core');var field_registry=require('web.field_registry');var session=require('web.session');var QWeb=core.qweb;var _t=core._t;var FieldOrgChart=AbstractField.extend({events:{"click .o_employee_redirect":"_onEmployeeRedirect","click .o_employee_sub_redirect":"_onEmployeeSubRedirect","click .o_employee_more_managers":"_onEmployeeMoreManager"},init:function(parent,options){this._super.apply(this,arguments);this.dm=new concurrency.DropMisordered();this.employee=null;},_getOrgData:function(){var self=this;return this.dm.add(this._rpc({route:'/hr/get_org_chart',params:{employee_id:this.employee,context:session.user_context,},})).then(function(data){return data;});},_getSubordinatesData:function(employee_id,type){return this.dm.add(this._rpc({route:'/hr/get_subordinates',params:{employee_id:employee_id,subordinates_type:type,context:session.user_context,},}));},_render:function(){if(!this.recordData.id){return this.$el.html(QWeb.render("hr_org_chart",{managers:[],children:[],}));}
else if(!this.employee){this.employee=this.recordData.employee_ids!==undefined?this.recordData.employee_ids.res_ids[0]:this.recordData.id;}
var self=this;return this._getOrgData().then(function(orgData){if(_.isEmpty(orgData)){orgData={managers:[],children:[],}}
orgData.view_employee_id=self.recordData.id;self.$el.html(QWeb.render("hr_org_chart",orgData));self.$('[data-toggle="popover"]').each(function(){$(this).popover({html:true,title:function(){var $title=$(QWeb.render('hr_orgchart_emp_popover_title',{employee:{name:$(this).data('emp-name'),id:$(this).data('emp-id'),},}));$title.on('click','.o_employee_redirect',_.bind(self._onEmployeeRedirect,self));return $title;},container:this,placement:'left',trigger:'focus',content:function(){var $content=$(QWeb.render('hr_orgchart_emp_popover_content',{employee:{id:$(this).data('emp-id'),name:$(this).data('emp-name'),direct_sub_count:parseInt($(this).data('emp-dir-subs')),indirect_sub_count:parseInt($(this).data('emp-ind-subs')),},}));$content.on('click','.o_employee_sub_redirect',_.bind(self._onEmployeeSubRedirect,self));return $content;},template:QWeb.render('hr_orgchart_emp_popover',{}),});});});},_onEmployeeMoreManager:function(event){event.preventDefault();this.employee=parseInt($(event.currentTarget).data('employee-id'));this._render();},_onEmployeeRedirect:function(event){var self=this;event.preventDefault();var employee_id=parseInt($(event.currentTarget).data('employee-id'));return this._rpc({model:'hr.employee',method:'get_formview_action',args:[employee_id],}).then(function(action){return self.do_action(action);});},_onEmployeeSubRedirect:function(event){event.preventDefault();var employee_id=parseInt($(event.currentTarget).data('employee-id'));var employee_name=$(event.currentTarget).data('employee-name');var type=$(event.currentTarget).data('type')||'direct';var self=this;if(employee_id){this._getSubordinatesData(employee_id,type).then(function(data){var domain=[['id','in',data]];return self._rpc({model:'hr.employee',method:'get_formview_action',args:[employee_id],}).then(function(action){action=_.extend(action,{'name':_t('Team'),'view_mode':'kanban,list,form','views':[[false,'kanban'],[false,'list'],[false,'form']],'domain':domain,'context':{'default_parent_id':employee_id,}});delete action['res_id'];return self.do_action(action);});});}},});field_registry.add('hr_org_chart',FieldOrgChart);return FieldOrgChart;});;

/* /website/static/src/js/backend/button.js defined in bundle 'web.assets_backend' */
odoo.define('website.backend.button',function(require){'use strict';var AbstractField=require('web.AbstractField');var core=require('web.core');var field_registry=require('web.field_registry');var _t=core._t;var WebsitePublishButton=AbstractField.extend({className:'o_stat_info',supportedFieldTypes:['boolean'],isSet:function(){return true;},_render:function(){this.$el.empty();var text=this.value?_t("Published"):_t("Unpublished");var hover=this.value?_t("Unpublish"):_t("Publish");var valColor=this.value?'text-success':'text-danger';var hoverColor=this.value?'text-danger':'text-success';var $val=$('<span>').addClass('o_stat_text o_not_hover '+valColor).text(text);var $hover=$('<span>').addClass('o_stat_text o_hover '+hoverColor).text(hover);this.$el.append($val).append($hover);},});var WidgetWebsiteButtonIcon=AbstractField.extend({template:'WidgetWebsiteButtonIcon',events:{'click':'_onClick',},start:function(){this.$icon=this.$('.o_button_icon');return this._super.apply(this,arguments);},isSet:function(){return true;},_render:function(){this._super.apply(this,arguments);var published=this.value;var info=published?_t("Published"):_t("Unpublished");this.$el.attr('aria-label',info).prop('title',info);this.$icon.toggleClass('text-danger',!published).toggleClass('text-success',published);},_onClick:function(){this.trigger_up('button_clicked',{attrs:{type:'object',name:'open_website_url',},record:this.record,});},});field_registry.add('website_redirect_button',WidgetWebsiteButtonIcon).add('website_publish_button',WebsitePublishButton);});;

/* /website/static/src/js/backend/dashboard.js defined in bundle 'web.assets_backend' */
odoo.define('website.backend.dashboard',function(require){'use strict';var AbstractAction=require('web.AbstractAction');var ajax=require('web.ajax');var core=require('web.core');var Dialog=require('web.Dialog');var field_utils=require('web.field_utils');var pyUtils=require('web.py_utils');var session=require('web.session');var time=require('web.time');var web_client=require('web.web_client');var _t=core._t;var QWeb=core.qweb;var COLORS=["#1f77b4","#aec7e8"];var FORMAT_OPTIONS={humanReadable:function(value){return Math.abs(value)>=1000;},minDigits:1,decimals:2,formatterCallback:function(str){return str;},};var Dashboard=AbstractAction.extend({hasControlPanel:true,contentTemplate:'website.WebsiteDashboardMain',jsLibs:['/web/static/lib/Chart/Chart.js',],events:{'click .js_link_analytics_settings':'on_link_analytics_settings','click .o_dashboard_action':'on_dashboard_action','click .o_dashboard_action_form':'on_dashboard_action_form',},init:function(parent,context){this._super(parent,context);this.DATE_FORMAT=time.getLangDateFormat();this.date_range='week';this.date_from=moment.utc().subtract(1,'week');this.date_to=moment.utc();this.dashboards_templates=['website.dashboard_header','website.dashboard_content'];this.graphs=[];this.chartIds={};},willStart:function(){var self=this;return Promise.all([ajax.loadLibs(this),this._super()]).then(function(){return self.fetch_data();}).then(function(){var website=_.findWhere(self.websites,{selected:true});self.website_id=website?website.id:false;});},start:function(){var self=this;return this._super().then(function(){self.update_cp();self.render_graphs();});},on_attach_callback:function(){this._isInDom=true;this.render_graphs();this._super.apply(this,arguments);},on_detach_callback:function(){this._isInDom=false;this._super.apply(this,arguments);},fetch_data:function(){var self=this;var prom=this._rpc({route:'/website/fetch_dashboard_data',params:{website_id:this.website_id||false,date_from:this.date_from.year()+'-'+(this.date_from.month()+1)+'-'+this.date_from.date(),date_to:this.date_to.year()+'-'+(this.date_to.month()+1)+'-'+this.date_to.date(),},});prom.then(function(result){self.data=result;self.dashboards_data=result.dashboards;self.currency_id=result.currency_id;self.groups=result.groups;self.websites=result.websites;});return prom;},on_link_analytics_settings:function(ev){ev.preventDefault();var self=this;var dialog=new Dialog(this,{size:'medium',title:_t('Connect Google Analytics'),$content:QWeb.render('website.ga_dialog_content',{ga_key:this.dashboards_data.visits.ga_client_id,ga_analytics_key:this.dashboards_data.visits.ga_analytics_key,}),buttons:[{text:_t("Save"),classes:'btn-primary',close:true,click:function(){var ga_client_id=dialog.$el.find('input[name="ga_client_id"]').val();var ga_analytics_key=dialog.$el.find('input[name="ga_analytics_key"]').val();self.on_save_ga_client_id(ga_client_id,ga_analytics_key);},},{text:_t("Cancel"),close:true,},],}).open();},on_go_to_website:function(ev){ev.preventDefault();var website=_.findWhere(this.websites,{selected:true});window.location.href=`/website/force/${website.id}`;},on_save_ga_client_id:function(ga_client_id,ga_analytics_key){var self=this;return this._rpc({route:'/website/dashboard/set_ga_data',params:{'website_id':self.website_id,'ga_client_id':ga_client_id,'ga_analytics_key':ga_analytics_key,},}).then(function(result){if(result.error){self.do_warn(result.error.title,result.error.message);return;}
self.on_date_range_button('week');});},render_dashboards:function(){var self=this;_.each(this.dashboards_templates,function(template){self.$('.o_website_dashboard').append(QWeb.render(template,{widget:self}));});},render_graph:function(div_to_display,chart_values,chart_id){var self=this;this.$(div_to_display).empty();var $canvasContainer=$('<div/>',{class:'o_graph_canvas_container'});this.$canvas=$('<canvas/>').attr('id',chart_id);$canvasContainer.append(this.$canvas);this.$(div_to_display).append($canvasContainer);var labels=chart_values[0].values.map(function(date){return moment(date[0],"YYYY-MM-DD",'en');});var datasets=chart_values.map(function(group,index){return{label:group.key,data:group.values.map(function(value){return value[1];}),dates:group.values.map(function(value){return value[0];}),fill:false,borderColor:COLORS[index],};});var ctx=this.$canvas[0];this.chart=new Chart(ctx,{type:'line',data:{labels:labels,datasets:datasets,},options:{legend:{display:false,},maintainAspectRatio:false,scales:{yAxes:[{type:'linear',ticks:{beginAtZero:true,callback:this.formatValue.bind(this),},}],xAxes:[{ticks:{callback:function(moment){return moment.format(self.DATE_FORMAT);},}}],},tooltips:{mode:'index',intersect:false,bodyFontColor:'rgba(0,0,0,1)',titleFontSize:13,titleFontColor:'rgba(0,0,0,1)',backgroundColor:'rgba(255,255,255,0.6)',borderColor:'rgba(0,0,0,0.2)',borderWidth:2,callbacks:{title:function(tooltipItems,data){return data.datasets[0].label;},label:function(tooltipItem,data){var moment=data.labels[tooltipItem.index];var date=tooltipItem.datasetIndex===0?moment:moment.subtract(1,self.date_range);return date.format(self.DATE_FORMAT)+': '+self.formatValue(tooltipItem.yLabel);},labelColor:function(tooltipItem,chart){var dataset=chart.data.datasets[tooltipItem.datasetIndex];return{borderColor:dataset.borderColor,backgroundColor:dataset.borderColor,};},}}}});},render_graphs:function(){var self=this;if(this._isInDom){_.each(this.graphs,function(e){var renderGraph=self.groups[e.group]&&self.dashboards_data[e.name].summary.order_count;if(!self.chartIds[e.name]){self.chartIds[e.name]=_.uniqueId('chart_'+e.name);}
var chart_id=self.chartIds[e.name];if(renderGraph){self.render_graph('.o_graph_'+e.name,self.dashboards_data[e.name].graph,chart_id);}});this.render_graph_analytics(this.dashboards_data.visits.ga_client_id);}},render_graph_analytics:function(client_id){if(!this.dashboards_data.visits||!this.dashboards_data.visits.ga_client_id){return;}
this.load_analytics_api();var $analytics_components=this.$('.js_analytics_components');this.addLoader($analytics_components);var self=this;gapi.analytics.ready(function(){$analytics_components.empty();var $analytics_auth=$('<div>').addClass('col-lg-12');window.onOriginError=function(){$analytics_components.find('.js_unauthorized_message').remove();self.display_unauthorized_message($analytics_components,'not_initialized');};gapi.analytics.auth.authorize({container:$analytics_auth[0],clientid:client_id});$analytics_auth.appendTo($analytics_components);self.handle_analytics_auth($analytics_components);gapi.analytics.auth.on('signIn',function(){delete window.onOriginError;self.handle_analytics_auth($analytics_components);});});},on_date_range_button:function(date_range){if(date_range==='week'){this.date_range='week';this.date_from=moment.utc().subtract(1,'weeks');}else if(date_range==='month'){this.date_range='month';this.date_from=moment.utc().subtract(1,'months');}else if(date_range==='year'){this.date_range='year';this.date_from=moment.utc().subtract(1,'years');}else{console.log('Unknown date range. Choose between [week, month, year]');return;}
var self=this;Promise.resolve(this.fetch_data()).then(function(){self.$('.o_website_dashboard').empty();self.render_dashboards();self.render_graphs();});},on_website_button:function(website_id){var self=this;this.website_id=website_id;Promise.resolve(this.fetch_data()).then(function(){self.$('.o_website_dashboard').empty();self.render_dashboards();self.render_graphs();});},on_reverse_breadcrumb:function(){var self=this;web_client.do_push_state({});this.update_cp();this.fetch_data().then(function(){self.$('.o_website_dashboard').empty();self.render_dashboards();self.render_graphs();});},on_dashboard_action:function(ev){ev.preventDefault();var self=this
var $action=$(ev.currentTarget);var additional_context={};if(this.date_range==='week'){additional_context={search_default_week:true};}else if(this.date_range==='month'){additional_context={search_default_month:true};}else if(this.date_range==='year'){additional_context={search_default_year:true};}
this._rpc({route:'/web/action/load',params:{'action_id':$action.attr('name'),},}).then(function(action){action.domain=pyUtils.assembleDomains([action.domain,`[('website_id', '=', ${self.website_id})]`]);return self.do_action(action,{'additional_context':additional_context,'on_reverse_breadcrumb':self.on_reverse_breadcrumb});});},on_dashboard_action_form:function(ev){ev.preventDefault();var $action=$(ev.currentTarget);this.do_action({name:$action.attr('name'),res_model:$action.data('res_model'),res_id:$action.data('res_id'),views:[[false,'form']],type:'ir.actions.act_window',},{on_reverse_breadcrumb:this.on_reverse_breadcrumb});},update_cp:function(){var self=this;if(!this.$searchview){this.$searchview=$(QWeb.render("website.DateRangeButtons",{widget:this,}));this.$searchview.find('button.js_date_range').click(function(ev){self.$searchview.find('button.js_date_range.active').removeClass('active');$(ev.target).addClass('active');self.on_date_range_button($(ev.target).data('date'));});this.$searchview.find('button.js_website').click(function(ev){self.$searchview.find('button.js_website.active').removeClass('active');$(ev.target).addClass('active');self.on_website_button($(ev.target).data('website-id'));});}
var $buttons=$(QWeb.render("website.GoToButtons"));$buttons.on('click',this.on_go_to_website.bind(this));this.updateControlPanel({cp_content:{$searchview:this.$searchview,$buttons:$buttons,},});},load_analytics_api:function(){var self=this;if(!("gapi"in window)){(function(w,d,s,g,js,fjs){g=w.gapi||(w.gapi={});g.analytics={q:[],ready:function(cb){this.q.push(cb);}};js=d.createElement(s);fjs=d.getElementsByTagName(s)[0];js.src='https://apis.google.com/js/platform.js';fjs.parentNode.insertBefore(js,fjs);js.onload=function(){g.load('analytics');};}(window,document,'script'));gapi.analytics.ready(function(){self.analytics_create_components();});}},handle_analytics_auth:function($analytics_components){$analytics_components.find('.js_unauthorized_message').remove();if(!gapi.analytics.auth.getAuthResponse()){this.display_unauthorized_message($analytics_components,'not_connected');}else if(gapi.analytics.auth.getAuthResponse()&&gapi.analytics.auth.getAuthResponse().scope.indexOf('https://www.googleapis.com/auth/analytics')===-1){this.display_unauthorized_message($analytics_components,'no_right');}else{this.make_analytics_calls($analytics_components);}},display_unauthorized_message:function($analytics_components,reason){$analytics_components.prepend($(QWeb.render('website.unauthorized_analytics',{reason:reason})));},make_analytics_calls:function($analytics_components){var $analytics_users=$('<div>');var activeUsers=new gapi.analytics.ext.ActiveUsers({container:$analytics_users[0],pollingInterval:10,});$analytics_users.appendTo($analytics_components);var $analytics_view_selector=$('<div>').addClass('col-lg-12 o_properties_selection');var viewSelector=new gapi.analytics.ViewSelector({container:$analytics_view_selector[0],});viewSelector.execute();$analytics_view_selector.appendTo($analytics_components);var start_date='7daysAgo';if(this.date_range==='month'){start_date='30daysAgo';}else if(this.date_range==='year'){start_date='365daysAgo';}
var $analytics_chart_2=$('<div>').addClass('col-lg-6 col-12');var breakdownChart=new gapi.analytics.googleCharts.DataChart({query:{'dimensions':'ga:date','metrics':'ga:sessions','start-date':start_date,'end-date':'yesterday'},chart:{type:'LINE',container:$analytics_chart_2[0],options:{title:'All',width:'100%',tooltip:{isHtml:true},}}});$analytics_chart_2.appendTo($analytics_components);var $analytics_chart_1=$('<div>').addClass('col-lg-6 col-12');var mainChart=new gapi.analytics.googleCharts.DataChart({query:{'dimensions':'ga:medium','metrics':'ga:sessions','sort':'-ga:sessions','max-results':'6'},chart:{type:'TABLE',container:$analytics_chart_1[0],options:{width:'100%'}}});$analytics_chart_1.appendTo($analytics_components);var table_row_listener;viewSelector.on('change',function(ids){var options={query:{ids:ids}};activeUsers.set({ids:ids}).execute();mainChart.set(options).execute();breakdownChart.set(options).execute();if(table_row_listener){google.visualization.events.removeListener(table_row_listener);}});mainChart.on('success',function(response){var chart=response.chart;var dataTable=response.dataTable;table_row_listener=google.visualization.events.addListener(chart,'select',function(){var options;if(chart.getSelection().length){var row=chart.getSelection()[0].row;var medium=dataTable.getValue(row,0);options={query:{filters:'ga:medium=='+medium,},chart:{options:{title:medium,}}};}else{options={chart:{options:{title:'All',}}};delete breakdownChart.get().query.filters;}
breakdownChart.set(options).execute();});});activeUsers.once('success',function(){var element=this.container.firstChild;var timeout;this.on('change',function(data){element=this.container.firstChild;var animationClass=data.delta>0?'is-increasing':'is-decreasing';element.className+=(' '+animationClass);clearTimeout(timeout);timeout=setTimeout(function(){element.className=element.className.replace(/ is-(increasing|decreasing)/g,'');},3000);});});},analytics_create_components:function(){gapi.analytics.createComponent('ActiveUsers',{initialize:function(){this.activeUsers=0;gapi.analytics.auth.once('signOut',this.handleSignOut_.bind(this));},execute:function(){if(this.polling_){this.stop();}
this.render_();if(gapi.analytics.auth.isAuthorized()){this.pollActiveUsers_();}else{gapi.analytics.auth.once('signIn',this.pollActiveUsers_.bind(this));}},stop:function(){clearTimeout(this.timeout_);this.polling_=false;this.emit('stop',{activeUsers:this.activeUsers});},render_:function(){var opts=this.get();this.container=typeof opts.container==='string'?document.getElementById(opts.container):opts.container;this.container.innerHTML=opts.template||this.template;this.container.querySelector('b').innerHTML=this.activeUsers;},pollActiveUsers_:function(){var options=this.get();var pollingInterval=(options.pollingInterval||5)*1000;if(isNaN(pollingInterval)||pollingInterval<5000){throw new Error('Frequency must be 5 seconds or more.');}
this.polling_=true;gapi.client.analytics.data.realtime.get({ids:options.ids,metrics:'rt:activeUsers'}).then(function(response){var result=response.result;var newValue=result.totalResults?+result.rows[0][0]:0;var oldValue=this.activeUsers;this.emit('success',{activeUsers:this.activeUsers});if(newValue!==oldValue){this.activeUsers=newValue;this.onChange_(newValue-oldValue);}
if(this.polling_){this.timeout_=setTimeout(this.pollActiveUsers_.bind(this),pollingInterval);}}.bind(this));},onChange_:function(delta){var valueContainer=this.container.querySelector('b');if(valueContainer){valueContainer.innerHTML=this.activeUsers;}
this.emit('change',{activeUsers:this.activeUsers,delta:delta});if(delta>0){this.emit('increase',{activeUsers:this.activeUsers,delta:delta});}else{this.emit('decrease',{activeUsers:this.activeUsers,delta:delta});}},handleSignOut_:function(){this.stop();gapi.analytics.auth.once('signIn',this.handleSignIn_.bind(this));},handleSignIn_:function(){this.pollActiveUsers_();gapi.analytics.auth.once('signOut',this.handleSignOut_.bind(this));},template:'<div class="ActiveUsers">'+'Active Users: <b class="ActiveUsers-value"></b>'+'</div>'});},addLoader:function(selector){var loader='<span class="fa fa-3x fa-spin fa-spinner fa-pulse"/>';selector.html("<div class='o_loader'>"+loader+"</div>");},getValue:function(d){return d[1];},format_number:function(value,type,digits,symbol){if(type==='currency'){return this.render_monetary_field(value,this.currency_id);}else{return field_utils.format[type](value||0,{digits:digits})+' '+symbol;}},formatValue:function(value){var formatter=field_utils.format.float;var formatedValue=formatter(value,undefined,FORMAT_OPTIONS);return formatedValue;},render_monetary_field:function(value,currency_id){var currency=session.get_currency(currency_id);var formatted_value=field_utils.format.float(value||0,{digits:currency&&currency.digits});if(currency){if(currency.position==="after"){formatted_value+=currency.symbol;}else{formatted_value=currency.symbol+formatted_value;}}
return formatted_value;},});core.action_registry.add('backend_dashboard',Dashboard);return Dashboard;});;

/* /website/static/src/js/backend/res_config_settings.js defined in bundle 'web.assets_backend' */
odoo.define('website.settings',function(require){var BaseSettingController=require('base.settings').Controller;var FormController=require('web.FormController');BaseSettingController.include({_onButtonClicked:function(ev){if(ev.data.attrs.name==='website_go_to'){FormController.prototype._onButtonClicked.apply(this,arguments);}else{this._super.apply(this,arguments);}},});});;

/* /hr_payroll/static/src/js/work_entries_controller_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('hr_payroll.WorkEntryControllerMixin',function(require){'use strict';var core=require('web.core');var time=require('web.time');var _t=core._t;var QWeb=core.qweb;var WorkEntryControllerMixin={events:{'click .btn-payslip-generate':'_onGeneratePayslips',},_update:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.firstDay=self._fetchFirstDay().toDate();self.lastDay=self._fetchLastDay().toDate();self._renderWorkEntryButtons();var now=moment();if(self.firstDay>now)return Promise.resolve();return self._generateWorkEntries();});},_generateWorkEntries:function(){var self=this;return this._rpc({model:'hr.employee',method:'generate_work_entries',args:[[],time.date_to_str(this.firstDay),time.date_to_str(this.lastDay)],}).then(function(new_work_entries){if(new_work_entries){self.reload();}});},_getActiveEmployeeIds:function(){const records=this._fetchRecords();const employees_datas=_.pluck(records,"employee_id");const employee_ids=_.map(employees_datas,employee_datas=>employee_datas[0]);return _.uniq(employee_ids);},_generatePayslips:function(){this.do_action('hr_payroll.action_generate_payslips_from_work_entries',{additional_context:{default_date_start:time.date_to_str(this.firstDay),default_date_end:time.date_to_str(this.lastDay),active_employee_ids:this._getActiveEmployeeIds(),},});},_renderWorkEntryButtons:function(){if(this.modelName!=="hr.work.entry"){return;}
var records=this._fetchRecords();var hasConflicts=records.some(function(record){return record.state==='conflict';});var allValidated=records.every(function(record){return record.state==='validated';});this.$buttons.find('.btn-work-entry').remove();if(!allValidated&&records.length!==0){this.$buttons.append(QWeb.render('hr_work_entry.work_entry_button',{button_text:_t("Generate Payslips"),event_class:'btn-payslip-generate',disabled:hasConflicts,}));}},_onGeneratePayslips:function(e){e.preventDefault();e.stopImmediatePropagation();this._generatePayslips();},};return WorkEntryControllerMixin;});;

/* /hr_payroll/static/src/js/work_entries_calendar.js defined in bundle 'web.assets_backend' */
odoo.define('hr_payroll.work_entries_calendar',function(require){'use strict';var core=require('web.core');var WorkEntryControllerMixin=require('hr_payroll.WorkEntryControllerMixin');var CalendarController=require("web.CalendarController");var CalendarModel=require('web.CalendarModel');var CalendarRenderer=require('web.CalendarRenderer');var CalendarView=require('web.CalendarView');var viewRegistry=require('web.view_registry');var _t=core._t;var WorkEntryCalendarController=CalendarController.extend(WorkEntryControllerMixin,{events:_.extend({},WorkEntryControllerMixin.events,CalendarController.prototype.events),_fetchRecords:function(){var self=this;var records=_.filter(this.model.data.data,function(data){return data.record.date_start.isBefore(self.lastDay)&&data.record.date_stop.isAfter(self.firstDay);});return _.pluck(records,'record');},_fetchFirstDay:function(){return this.model.data.target_date.clone().startOf('month');},_fetchLastDay:function(){return this.model.data.target_date.clone().endOf('month');},_displayWarning:function($warning){this.$('.o_calendar_container').before($warning);},});var WorkEntryCalendarModel=CalendarModel.extend({_loadFilter:function(filter){return this._super.apply(this,arguments).then(function(){var filters=filter.filters;var all_filter=filters[filters.length-1];if(all_filter){all_filter.label=_t("Everybody's work entries");if(filter.write_model&&filter.filters.length<=1&&all_filter.active===undefined){filter.all=true;all_filter.active=true;}}});}});var WorkEntryCalendarView=CalendarView.extend({config:_.extend({},CalendarView.prototype.config,{Controller:WorkEntryCalendarController,Model:WorkEntryCalendarModel,Renderer:CalendarRenderer,}),});viewRegistry.add('work_entries_calendar',WorkEntryCalendarView);});;

/* /hr_payroll/static/src/js/work_entries_gantt.js defined in bundle 'web.assets_backend' */
odoo.define('hr_payroll_gantt.work_entries_gantt',function(require){'use strict';var WorkEntryControllerMixin=require('hr_payroll.WorkEntryControllerMixin');var GanttView=require('web_gantt.GanttView');var GanttController=require('web_gantt.GanttController');var viewRegistry=require('web.view_registry');var WorkEntryGanttController=GanttController.extend(WorkEntryControllerMixin,{events:_.extend({},WorkEntryControllerMixin.events,GanttController.prototype.events),_fetchRecords:function(){return this.model.ganttData.records;},_fetchFirstDay:function(){return this.model.ganttData.startDate;},_fetchLastDay:function(){return this.model.ganttData.stopDate;},_displayWarning:function($warning){this.$('.o_gantt_view').before($warning);},});var WorkEntryGanttView=GanttView.extend({config:_.extend({},GanttView.prototype.config,{Controller:WorkEntryGanttController,}),});viewRegistry.add('work_entries_gantt',WorkEntryGanttView);});;

/* /hr_payroll/static/src/js/payslip.js defined in bundle 'web.assets_backend' */
odoo.define('hr_payroll.payslip.tree',function(require){"use strict";var core=require('web.core');var ListController=require('web.ListController');var ListView=require('web.ListView');var viewRegistry=require('web.view_registry');var QWeb=core.qweb;var PayslipListController=ListController.extend({renderButtons:function(){this._super.apply(this,arguments);this.$buttons.append($(QWeb.render("PayslipListView.print_button",this)));var self=this;this.$buttons.on('click','.o_button_print_payslip',function(){if(self.getSelectedIds().length==0){return;}
return self._rpc({model:'hr.payslip',method:'action_print_payslip',args:[self.getSelectedIds()],}).then(function(results){self.do_action(results);});});}});var PayslipListView=ListView.extend({config:_.extend({},ListView.prototype.config,{Controller:PayslipListController,}),});viewRegistry.add('hr_payroll_payslip_tree',PayslipListView);});;

/* /hr_recruitment/static/src/js/recruitment.js defined in bundle 'web.assets_backend' */
odoo.define('job.update_kanban',function(require){'use strict';var KanbanRecord=require('web.KanbanRecord');KanbanRecord.include({_openRecord:function(){if(this.modelName==='hr.job'&&this.$(".o_hr_job_boxes a").length){this.$(".o_hr_job_boxes a").first().click();}else{this._super.apply(this,arguments);}}});});;

/* /website_theme_install/static/src/js/res_config_settings.js defined in bundle 'web.assets_backend' */
odoo.define('website_theme_install.settings',function(require){var BaseSettingController=require('base.settings').Controller;var FormController=require('web.FormController');BaseSettingController.include({_onButtonClicked:function(ev){if(ev.data.attrs.name==='install_theme_on_current_website'){FormController.prototype._onButtonClicked.apply(this,arguments);}else{this._super.apply(this,arguments);}},});});;

/* /website_slides/static/src/js/slide_category_one2many.js defined in bundle 'web.assets_backend' */
odoo.define('survey.slide_category_one2many',function(require){"use strict";var Context=require('web.Context');var FieldOne2Many=require('web.relational_fields').FieldOne2Many;var FieldRegistry=require('web.field_registry');var ListRenderer=require('web.ListRenderer');var config=require('web.config');var SectionListRenderer=ListRenderer.extend({init:function(parent,state,params){this.sectionFieldName="is_category";this._super.apply(this,arguments);},_checkIfRecordIsSection:function(id){var record=this._findRecordById(id);return record&&record.data[this.sectionFieldName];},_findRecordById:function(id){return _.find(this.state.data,function(record){return record.id===id;});},_renderBodyCell:function(record,node,index,options){var $cell=this._super.apply(this,arguments);var isSection=record.data[this.sectionFieldName];if(isSection){if(node.attrs.widget==="handle"){return $cell;}else if(node.attrs.name==="name"){var nbrColumns=this._getNumberOfCols();if(this.handleField){nbrColumns--;}
if(this.addTrashIcon){nbrColumns--;}
$cell.attr('colspan',nbrColumns);}else{$cell.removeClass('o_invisible_modifier');return $cell.addClass('o_hidden');}}
return $cell;},_renderRow:function(record,index){var $row=this._super.apply(this,arguments);if(record.data[this.sectionFieldName]){$row.addClass("o_is_section");}
return $row;},_renderView:function(){var def=this._super.apply(this,arguments);var self=this;return def.then(function(){self.$('table.o_list_table').addClass('o_section_list_view');});},_onRowClicked:function(ev){var parent=this.getParent();var recordId=$(ev.currentTarget).data('id');var is_section=this._checkIfRecordIsSection(recordId);if(is_section&&parent.mode==="edit"){this.editable="bottom";}else{this.editable=null;}
this._super.apply(this,arguments);},_onCellClick:function(ev){var parent=this.getParent();var recordId=$(ev.currentTarget.parentElement).data('id');var is_section=this._checkIfRecordIsSection(recordId);if(is_section&&parent.mode==="edit"){this.editable="bottom";}else{this.editable=null;this.unselectRow();}
this._super.apply(this,arguments);},_onNavigationMove:function(ev){this.unselectRow();},});var SectionFieldOne2Many=FieldOne2Many.extend({init:function(parent,name,record,options){this._super.apply(this,arguments);this.sectionFieldName="is_category";this.rendered=false;},_getRenderer:function(){if(this.view.arch.tag==='tree'){return SectionListRenderer;}
return this._super.apply(this,arguments);},_onAddRecord:function(ev){this.editable=null;if(!config.device.isMobile){var context_str=ev.data.context&&ev.data.context[0];var context=new Context(context_str).eval();if(context['default_'+this.sectionFieldName]){this.editable="bottom";}}
this._super.apply(this,arguments);},});FieldRegistry.add('slide_category_one2many',SectionFieldOne2Many);});;

/* /website_slides/static/src/js/rating_field_backend.js defined in bundle 'web.assets_backend' */
odoo.define('website_slides.ratingField',function(require){"use strict";var basicFields=require('web.basic_fields');var fieldRegistry=require('web.field_registry');var core=require('web.core');var QWeb=core.qweb;var FieldFloatRating=basicFields.FieldFloat.extend({xmlDependencies:!basicFields.FieldFloat.prototype.xmlDependencies?['/website_rating/static/src/xml/portal_tools.xml']:basicFields.FieldFloat.prototype.xmlDependencies.concat(['/website_rating/static/src/xml/portal_tools.xml']),_render:function(){var self=this;return Promise.resolve(this._super()).then(function(){self.$el.html(QWeb.render('website_rating.rating_stars_static',{'val':self.value/2,'inline_mode':true}));});},});fieldRegistry.add('field_float_rating',FieldFloatRating);return{FieldFloatRating:FieldFloatRating,};});;

/* /barcodes/static/src/js/barcode_parser.js defined in bundle 'web.assets_backend' */
odoo.define('barcodes.BarcodeParser',function(require){"use strict";var Class=require('web.Class');var rpc=require('web.rpc');var BarcodeParser=Class.extend({init:function(attributes){this.nomenclature_id=attributes.nomenclature_id;this.loaded=this.load();},load:function(){var self=this;if(!this.nomenclature_id){return;}
var id=this.nomenclature_id[0];return rpc.query({model:'barcode.nomenclature',method:'read',args:[[id],['name','rule_ids','upc_ean_conv']],}).then(function(nomenclatures){self.nomenclature=nomenclatures[0];var args=[[['barcode_nomenclature_id','=',self.nomenclature.id]],['name','sequence','type','encoding','pattern','alias'],];return rpc.query({model:'barcode.rule',method:'search_read',args:args,});}).then(function(rules){rules=rules.sort(function(a,b){return a.sequence-b.sequence;});self.nomenclature.rules=rules;});},is_loaded:function(){return this.loaded;},ean_checksum:function(ean){var code=ean.split('');if(code.length!==13){return-1;}
var oddsum=0,evensum=0,total=0;code=code.reverse().splice(1);for(var i=0;i<code.length;i++){if(i%2===0){oddsum+=Number(code[i]);}else{evensum+=Number(code[i]);}}
total=oddsum*3+evensum;return Number((10-total%10)%10);},ean8_checksum:function(ean){var code=ean.split('');if(code.length!==8){return-1;}
var sum1=Number(code[1])+Number(code[3])+Number(code[5]);var sum2=Number(code[0])+Number(code[2])+Number(code[4])+Number(code[6]);var total=sum1+3*sum2;return Number((10-total%10)%10);},check_ean:function(ean){return/^\d+$/.test(ean)&&this.ean_checksum(ean)===Number(ean[ean.length-1]);},check_encoding:function(barcode,encoding){var len=barcode.length;var allnum=/^\d+$/.test(barcode);var check=Number(barcode[len-1]);if(encoding==='ean13'){return len===13&&allnum&&this.ean_checksum(barcode)===check;}else if(encoding==='ean8'){return len===8&&allnum&&this.ean8_checksum(barcode)===check;}else if(encoding==='upca'){return len===12&&allnum&&this.ean_checksum('0'+barcode)===check;}else if(encoding==='any'){return true;}else{return false;}},sanitize_ean:function(ean){ean=ean.substr(0,13);for(var n=0,count=(13-ean.length);n<count;n++){ean='0'+ean;}
return ean.substr(0,12)+this.ean_checksum(ean);},sanitize_upc:function(upc){return this.sanitize_ean('0'+upc).substr(1,12);},match_pattern:function(barcode,pattern,encoding){var match={value:0,base_code:barcode,match:false,};barcode=barcode.replace("\\","\\\\").replace("{",'\{').replace("}","\}").replace(".","\.");var numerical_content=pattern.match(/[{][N]*[D]*[}]/);var base_pattern=pattern;if(numerical_content){var num_start=numerical_content.index;var num_length=numerical_content[0].length;var value_string=barcode.substr(num_start,num_length-2);var whole_part_match=numerical_content[0].match("[{][N]*[D}]");var decimal_part_match=numerical_content[0].match("[{N][D]*[}]");var whole_part=value_string.substr(0,whole_part_match.index+whole_part_match[0].length-2);var decimal_part="0."+value_string.substr(decimal_part_match.index,decimal_part_match[0].length-1);if(whole_part===''){whole_part='0';}
match['value']=parseInt(whole_part)+parseFloat(decimal_part);match['base_code']=barcode.substr(0,num_start);var base_pattern=pattern.substr(0,num_start);for(var i=0;i<(num_length-2);i++){match['base_code']+="0";base_pattern+="0";}
match['base_code']+=barcode.substr(num_start+num_length-2,barcode.length-1);base_pattern+=pattern.substr(num_start+num_length,pattern.length-1);match['base_code']=match['base_code'].replace("\\\\","\\").replace("\{","{").replace("\}","}").replace("\.",".");var base_code=match.base_code.split('')
if(encoding==='ean13'){base_code[12]=''+this.ean_checksum(match.base_code);}else if(encoding==='ean8'){base_code[7]=''+this.ean8_checksum(match.base_code);}else if(encoding==='upca'){base_code[11]=''+this.ean_checksum('0'+match.base_code);}
match.base_code=base_code.join('')}
if(base_pattern[0]!=='^'){base_pattern="^"+base_pattern;}
match.match=match.base_code.match(base_pattern);return match;},parse_barcode:function(barcode){var parsed_result={encoding:'',type:'error',code:barcode,base_code:barcode,value:0,};if(!this.nomenclature){return parsed_result;}
var rules=this.nomenclature.rules;for(var i=0;i<rules.length;i++){var rule=rules[i];var cur_barcode=barcode;if(rule.encoding==='ean13'&&this.check_encoding(barcode,'upca')&&this.nomenclature.upc_ean_conv in{'upc2ean':'','always':''}){cur_barcode='0'+cur_barcode;}else if(rule.encoding==='upca'&&this.check_encoding(barcode,'ean13')&&barcode[0]==='0'&&this.upc_ean_conv in{'ean2upc':'','always':''}){cur_barcode=cur_barcode.substr(1,12);}
if(!this.check_encoding(cur_barcode,rule.encoding)){continue;}
var match=this.match_pattern(cur_barcode,rules[i].pattern,rule.encoding);if(match.match){if(rules[i].type==='alias'){barcode=rules[i].alias;parsed_result.code=barcode;parsed_result.type='alias';}
else{parsed_result.encoding=rules[i].encoding;parsed_result.type=rules[i].type;parsed_result.value=match.value;parsed_result.code=cur_barcode;if(rules[i].encoding==="ean13"){parsed_result.base_code=this.sanitize_ean(match.base_code);}
else{parsed_result.base_code=match.base_code;}
return parsed_result;}}}
return parsed_result;},});return BarcodeParser;});;

/* /barcodes/static/src/js/barcode_events.js defined in bundle 'web.assets_backend' */
odoo.define('barcodes.BarcodeEvents',function(require){"use strict";var core=require('web.core');var mixins=require('web.mixins');var session=require('web.session');function CustomEvent(event,params){params=params||{bubbles:false,cancelable:false,detail:undefined};var evt=document.createEvent('CustomEvent');evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);return evt;}
CustomEvent.prototype=window.Event.prototype;var BarcodeEvents=core.Class.extend(mixins.PropertiesMixin,{timeout:null,key_pressed:{},buffered_key_events:[],regexp:/(.{3,})[\n\r\t]*/,suffix:/[\n\r\t]+/,max_time_between_keys_in_ms:session.max_time_between_keys_in_ms||55,inputTimeOut:800,init:function(){mixins.PropertiesMixin.init.call(this);this.__keydown_handler=_.bind(this.keydown_handler,this);this.__keyup_handler=_.bind(this.keyup_handler,this);this.__handler=_.bind(this.handler,this);$(_.bind(this.start,this,false));var isMobile=navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i);this.isChromeMobile=isMobile&&navigator.userAgent.match(/Chrome/i);this.$barcodeInput=$('<input/>',{name:'barcode',type:'text',css:{'position':'fixed','top':'50%','transform':'translateY(-50%)','z-index':'-1','opacity':'0',},});this.$barcodeInput.attr('autocomplete','off');this.__blurBarcodeInput=_.debounce(this._blurBarcodeInput,this.inputTimeOut);},handle_buffered_keys:function(){var str=this.buffered_key_events.reduce(function(memo,e){return memo+String.fromCharCode(e.which)},'');var match=str.match(this.regexp);if(match){var barcode=match[1];core.bus.trigger('barcode_scanned',barcode,this.buffered_key_events[0].target);if(this.buffered_key_events[0].target.getAttribute("barcode_events")==="true")
$(this.buffered_key_events[0].target).trigger('barcode_scanned',barcode);}else{this.resend_buffered_keys();}
this.buffered_key_events=[];},resend_buffered_keys:function(){var old_event,new_event;for(var i=0;i<this.buffered_key_events.length;i++){old_event=this.buffered_key_events[i];if(old_event.which!==13){var params={'bubbles':old_event.bubbles,'cancelable':old_event.cancelable,};new_event=$.Event('keypress',params);new_event.viewArg=old_event.viewArg;new_event.ctrl=old_event.ctrl;new_event.alt=old_event.alt;new_event.shift=old_event.shift;new_event.meta=old_event.meta;new_event.char=old_event.char;new_event.key=old_event.key;new_event.charCode=old_event.charCode;new_event.keyCode=old_event.keyCode||old_event.which;new_event.which=old_event.which;new_event.dispatched_by_barcode_reader=true;$(old_event.target).trigger(new_event);}}},element_is_editable:function(element){return $(element).is('input,textarea,[contenteditable="true"]');},is_special_key:function(e){if(e.key==="ArrowLeft"||e.key==="ArrowRight"||e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="Escape"||e.key==="Tab"||e.key==="Backspace"||e.key==="Delete"||e.key==="Home"||e.key==="End"||e.key==="PageUp"||e.key==="PageDown"||e.key==="Unidentified"||/F\d\d?/.test(e.key)){return true;}else{return false;}},keydown_handler:function(e){if(this.key_pressed[e.which]){e.preventDefault();}else{this.key_pressed[e.which]=true;}},keyup_handler:function(e){this.key_pressed[e.which]=false;},handler:function(e){if(e.dispatched_by_barcode_reader)
return;if(this.is_special_key(e))
return;if(e.ctrlKey||e.metaKey||e.altKey)
return;if(e.which===13&&this.buffered_key_events.length===0)
return;if((this.element_is_editable(e.target)&&!$(e.target).data('enableBarcode'))&&e.target.getAttribute("barcode_events")!=="true")
return;this.buffered_key_events.push(e);e.preventDefault();e.stopImmediatePropagation();clearTimeout(this.timeout);if(String.fromCharCode(e.which).match(this.suffix)){this.handle_buffered_keys();}else{this.timeout=setTimeout(_.bind(this.handle_buffered_keys,this),this.max_time_between_keys_in_ms);}},_listenBarcodeScanner:function(e){if($(document.activeElement).not('input:text, textarea, [contenteditable], '+'[type="email"], [type="number"], [type="password"], [type="tel"], [type="search"]').length){$('body').append(this.$barcodeInput);this.$barcodeInput.focus();}
if(this.$barcodeInput.is(":focus")){clearTimeout(this.timeout);if(String.fromCharCode(e.which).match(this.suffix)){this._handleBarcodeValue(e);}else{this.timeout=setTimeout(this._handleBarcodeValue.bind(this,e),this.max_time_between_keys_in_ms);}
this.__blurBarcodeInput();}},_handleBarcodeValue:function(e){var barcodeValue=this.$barcodeInput.val();if(barcodeValue.match(this.regexp)){core.bus.trigger('barcode_scanned',barcodeValue,$(e.target).parent()[0]);this._blurBarcodeInput();}},_blurBarcodeInput:function(){this.$barcodeInput.val('').blur();},start:function(prevent_key_repeat){if(this.isChromeMobile){$('body').on("keydown",this._listenBarcodeScanner.bind(this));}else{$('body').bind("keypress",this.__handler);}
if(prevent_key_repeat===true){$('body').bind("keydown",this.__keydown_handler);$('body').bind('keyup',this.__keyup_handler);}},stop:function(){$('body').off("keypress",this.__handler);$('body').off("keydown",this.__keydown_handler);$('body').off('keyup',this.__keyup_handler);},});return{BarcodeEvents:new BarcodeEvents(),ReservedBarcodePrefixes:['O-CMD'],};});;

/* /barcodes/static/src/js/barcode_form_view.js defined in bundle 'web.assets_backend' */
odoo.define('barcodes.FormView',function(require){"use strict";var BarcodeEvents=require('barcodes.BarcodeEvents');var concurrency=require('web.concurrency');var core=require('web.core');var Dialog=require('web.Dialog');var FormController=require('web.FormController');var FormRenderer=require('web.FormRenderer');var _t=core._t;FormController.include({custom_events:_.extend({},FormController.prototype.custom_events,{activeBarcode:'_barcodeActivated',}),init:function(){this._super.apply(this,arguments);this.activeBarcode={form_view:{commands:{'O-CMD.EDIT':this._barcodeEdit.bind(this),'O-CMD.DISCARD':this._barcodeDiscard.bind(this),'O-CMD.SAVE':this._barcodeSave.bind(this),'O-CMD.PREV':this._barcodePagerPrevious.bind(this),'O-CMD.NEXT':this._barcodePagerNext.bind(this),'O-CMD.PAGER-FIRST':this._barcodePagerFirst.bind(this),'O-CMD.PAGER-LAST':this._barcodePagerLast.bind(this),},},};this.barcodeMutex=new concurrency.Mutex();this._barcodeStartListening();},destroy:function(){this._barcodeStopListening();this._super();},_barcodeAddX2MQuantity:function(barcode,activeBarcode){if(this.mode==='readonly'){this.do_warn(_t('Error: Document not editable'),_t('To modify this document, please first start edition.'));return Promise.reject();}
var record=this.model.get(this.handle);var candidate=this._getBarCodeRecord(record,barcode,activeBarcode);if(candidate){return this._barcodeSelectedCandidate(candidate,record,barcode,activeBarcode);}else{return this._barcodeWithoutCandidate(record,barcode,activeBarcode);}},_barcodeDiscard:function(){return this.discardChanges();},_barcodeEdit:function(){return this._setMode('edit');},_barcodePagerFirst:function(){var self=this;return this.mutex.exec(function(){}).then(function(){if(!self.pager){self.do_warn(_t('Error: Pager not available'));return;}
self.pager.updateState({current_min:1,},{notifyChange:true});});},_barcodePagerLast:function(){var self=this;return this.mutex.exec(function(){}).then(function(){if(!self.pager){self.do_warn(_t('Error: Pager not available'));return;}
var state=self.model.get(self.handle,{raw:true});self.pager.updateState({current_min:state.count,},{notifyChange:true});});},_barcodePagerNext:function(){var self=this;return this.mutex.exec(function(){}).then(function(){if(!self.pager){self.do_warn(_t('Error: Pager not available'));return;}
self.pager.next();});},_barcodePagerPrevious:function(){var self=this;return this.mutex.exec(function(){}).then(function(){if(!self.pager){self.do_warn(_t('Error: Pager not available'));return;}
self.pager.previous();});},_barcodeRecordFilter:function(candidate,barcode,activeBarcode){return candidate.data.product_barcode===barcode;},_barcodeSave:function(){return this.saveRecord();},_barcodeSelectedCandidate:function(candidate,record,barcode,activeBarcode,quantity){var changes={};var candidateChanges={};candidateChanges[activeBarcode.quantity]=quantity?quantity:candidate.data[activeBarcode.quantity]+1;changes[activeBarcode.fieldName]={operation:'UPDATE',id:candidate.id,data:candidateChanges,};return this.model.notifyChanges(this.handle,changes,{notifyChange:activeBarcode.notifyChange});},_barcodeStartListening:function(){core.bus.on('barcode_scanned',this,this._barcodeScanned);core.bus.on('keypress',this,this._quantityListener);},_barcodeStopListening:function(){core.bus.off('barcode_scanned',this,this._barcodeScanned);core.bus.off('keypress',this,this._quantityListener);},_barcodeWithoutCandidate:function(record,barcode,activeBarcode){var changes={};changes[activeBarcode.name]=barcode;return this.model.notifyChanges(record.id,changes);},_getBarCodeRecord:function(record,barcode,activeBarcode){var self=this;if(!activeBarcode.fieldName||!record.data[activeBarcode.fieldName]){return;}
return _.find(record.data[activeBarcode.fieldName].data,function(record){return self._barcodeRecordFilter(record,barcode,activeBarcode);});},_barcodeActivated:function(event){event.stopPropagation();var name=event.data.name;this.activeBarcode[name]={name:name,handle:this.handle,target:event.target,widget:event.target.attrs&&event.target.attrs.widget,setQuantityWithKeypress:!!event.data.setQuantityWithKeypress,fieldName:event.data.fieldName,notifyChange:(event.data.notifyChange!==undefined)?event.data.notifyChange:true,quantity:event.data.quantity,commands:event.data.commands||{},candidate:this.activeBarcode[name]&&this.activeBarcode[name].handle===this.handle?this.activeBarcode[name].candidate:null,};this.disableAutofocus=true;},_barcodeActiveScanned:function(method,barcode,activeBarcode){var self=this;var methodDef;var def=new Promise(function(resolve,reject){if(typeof method==='string'){methodDef=self[method](barcode,activeBarcode);}else{methodDef=method.call(self,barcode,activeBarcode);}
methodDef.then(function(){var record=self.model.get(self.handle);var candidate=self._getBarCodeRecord(record,barcode,activeBarcode);activeBarcode.candidate=candidate;}).then(resolve,resolve);});return def;},_barcodeScanned:function(barcode,target){var self=this;return this.barcodeMutex.exec(function(){var prefixed=_.any(BarcodeEvents.ReservedBarcodePrefixes,function(reserved){return barcode.indexOf(reserved)===0;});var hasCommand=false;var defs=[];if(!$.contains(target,self.el)){return;}
for(var k in self.activeBarcode){var activeBarcode=self.activeBarcode[k];var methods=self.activeBarcode[k].commands;var method=prefixed?methods[barcode]:methods.barcode;if(method){if(prefixed){hasCommand=true;}
defs.push(self._barcodeActiveScanned(method,barcode,activeBarcode));}}
if(prefixed&&!hasCommand){self.do_warn(_t('Error: Barcode command is undefined'),barcode);}
return self.alive(Promise.all(defs)).then(function(){if(!prefixed){self.current_barcode=barcode;self.update({},{reload:false});}});});},_quantityListener:function(event){var character=String.fromCharCode(event.which);if(!$.contains(event.target,this.el)){return;}
if(!$(event.target).is('body, .modal')||!/[0-9]/.test(character)){return;}
var barcodeInfos=_.filter(this.activeBarcode,'setQuantityWithKeypress');if(!barcodeInfos.length){return;}
if(!_.compact(_.pluck(barcodeInfos,'candidate')).length){return this.do_warn(_t('Error: No last scanned barcode'),_t('To set the quantity please scan a barcode first.'));}
for(var k in this.activeBarcode){if(this.activeBarcode[k].candidate){this._quantityOpenDialog(character,this.activeBarcode[k]);}}},_quantityOpenDialog:function(character,activeBarcode){var self=this;var $content=$('<div>').append($('<input>',{type:'text',class:'o_set_qty_input'}));this.dialog=new Dialog(this,{title:_t('Set quantity'),buttons:[{text:_t('Select'),classes:'btn-primary',close:true,click:function(){var new_qty=this.$content.find('.o_set_qty_input').val();var record=self.model.get(self.handle);return self._barcodeSelectedCandidate(activeBarcode.candidate,record,self.current_barcode,activeBarcode,parseFloat(new_qty)).then(function(){self.update({},{reload:false});});}},{text:_t('Discard'),close:true}],$content:$content,});this.dialog.opened().then(function(){var $input=self.dialog.$('.o_set_qty_input').focus().val(character);var $selectBtn=self.dialog.$footer.find('.btn-primary');$input.on('keypress',function(event){if(event.which===13){event.preventDefault();$input.off();$selectBtn.click();}});});this.dialog.open();},});FormRenderer.include({_barcodeButtonHandler:function($button,node){var commands={};commands.barcode=function(){return Promise.resolve();};commands['O-BTN.'+node.attrs.barcode_trigger]=function(){if(!$button.hasClass('o_invisible_modifier')){$button.click();}
return Promise.resolve();};var name=node.attrs.name;if(node.attrs.string){name=name+'_'+node.attrs.string;}
this.trigger_up('activeBarcode',{name:name,commands:commands});},_renderHeaderButton:function(node){var $button=this._super.apply(this,arguments);if(node.attrs.barcode_trigger){this._barcodeButtonHandler($button,node);}
return $button;},_renderStatButton:function(node){var $button=this._super.apply(this,arguments);if(node.attrs.barcode_trigger){this._barcodeButtonHandler($button,node);}
return $button;},_renderTagButton:function(node){var $button=this._super.apply(this,arguments);if(node.attrs.barcode_trigger){this._barcodeButtonHandler($button,node);}
return $button;}});BarcodeEvents.ReservedBarcodePrefixes.push('O-BTN');});;

/* /barcodes/static/src/js/barcode_field.js defined in bundle 'web.assets_backend' */
odoo.define('barcodes.field',function(require){"use strict";var AbstractField=require('web.AbstractField');var basicFields=require('web.basic_fields');var fieldRegistry=require('web.field_registry');var BarcodeEvents=require('barcodes.BarcodeEvents').BarcodeEvents;var FieldFloatScannable=basicFields.FieldFloat.extend({events:_.extend({},basicFields.FieldFloat.prototype.events,{keypress:'_onKeypress',}),_renderEdit:function(){var self=this;return Promise.resolve(this._super()).then(function(){self.$input.data('enableBarcode',true);});},_onKeypress:function(e){if(e.dispatched_by_barcode_reader!==true){if(!BarcodeEvents.is_special_key(e)){e.preventDefault();}
return;}
var character=String.fromCharCode(e.which);var current_str=e.target.value;var str_before_carret=current_str.substring(0,e.target.selectionStart);var str_after_carret=current_str.substring(e.target.selectionEnd);e.target.value=str_before_carret+character+str_after_carret;var new_carret_index=str_before_carret.length+character.length;e.target.setSelectionRange(new_carret_index,new_carret_index);$(e.target).trigger('input');},});var FormViewBarcodeHandler=AbstractField.extend({init:function(){this._super.apply(this,arguments);this.trigger_up('activeBarcode',{name:this.name,commands:{barcode:'_barcodeAddX2MQuantity',}});},});fieldRegistry.add('field_float_scannable',FieldFloatScannable);fieldRegistry.add('barcode_handler',FormViewBarcodeHandler);return{FieldFloatScannable:FieldFloatScannable,FormViewBarcodeHandler:FormViewBarcodeHandler,};});;

/* /barcodes_mobile/static/src/js/barcode_events.js defined in bundle 'web.assets_backend' */
odoo.define('barcodes_mobile.BarcodeEvents',function(require){"use strict";var BarcodeEvents=require('barcodes.BarcodeEvents');var mobile=require('web_mobile.rpc');if(!mobile.methods.closeVirtualKeyboard){return;}
var barcodeEvents=BarcodeEvents.BarcodeEvents;barcodeEvents.$barcodeInput.on('focus',function(){setTimeout(mobile.methods.closeVirtualKeyboard,0);});barcodeEvents._blurBarcodeInput=function(){if(this.$barcodeInput){this.$barcodeInput.val('');}}
barcodeEvents.__blurBarcodeInput=_.debounce(barcodeEvents._blurBarcodeInput,barcodeEvents.inputTimeOut);});;

/* /hr_attendance/static/src/js/employee_kanban_view_handler.js defined in bundle 'web.assets_backend' */
odoo.define('hr_attendance.employee_kanban_view_handler',function(require){"use strict";var KanbanRecord=require('web.KanbanRecord');KanbanRecord.include({_openRecord:function(){if(this.modelName==='hr.employee'&&this.$el.parents('.o_hr_employee_attendance_kanban').length){var action={type:'ir.actions.client',name:'Confirm',tag:'hr_attendance_kiosk_confirm',employee_id:this.record.id.raw_value,employee_name:this.record.name.raw_value,employee_state:this.record.attendance_state.raw_value,employee_hours_today:this.record.hours_today.raw_value,};this.do_action(action);}else{this._super.apply(this,arguments);}}});});;

/* /hr_attendance/static/src/js/greeting_message.js defined in bundle 'web.assets_backend' */
odoo.define('hr_attendance.greeting_message',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var core=require('web.core');var time=require('web.time');var _t=core._t;var GreetingMessage=AbstractAction.extend({contentTemplate:'HrAttendanceGreetingMessage',events:{"click .o_hr_attendance_button_dismiss":function(){this.do_action(this.next_action,{clear_breadcrumbs:true});},},init:function(parent,action){var self=this;this._super.apply(this,arguments);this.activeBarcode=true;if(!action.attendance){this.activeBarcode=false;this.getSession().user_has_group('hr_attendance.group_hr_attendance_user').then(function(has_group){if(has_group){self.next_action='hr_attendance.hr_attendance_action_kiosk_mode';}else{self.next_action='hr_attendance.hr_attendance_action_my_attendances';}});return;}
this.next_action=action.next_action||'hr_attendance.hr_attendance_action_my_attendances';if(this.next_action!='hr_attendance.hr_attendance_action_kiosk_mode'&&this.next_action.tag!='hr_attendance_kiosk_mode'){this.activeBarcode=false;}
this.attendance=action.attendance;this.attendance.check_in=this.attendance.check_in&&moment.utc(this.attendance.check_in).local();this.attendance.check_out=this.attendance.check_out&&moment.utc(this.attendance.check_out).local();this.previous_attendance_change_date=action.previous_attendance_change_date&&moment.utc(action.previous_attendance_change_date).local();this.format_time=time.getLangTimeFormat();this.attendance.check_in_time=this.attendance.check_in&&this.attendance.check_in.format(this.format_time);this.attendance.check_out_time=this.attendance.check_out&&this.attendance.check_out.format(this.format_time);if(action.hours_today){var duration=moment.duration(action.hours_today,"hours");this.hours_today=duration.hours()+' hours, '+duration.minutes()+' minutes';}
this.employee_name=action.employee_name;this.attendanceBarcode=action.barcode;},start:function(){if(this.attendance){this.attendance.check_out?this.farewell_message():this.welcome_message();}
if(this.activeBarcode){core.bus.on('barcode_scanned',this,this._onBarcodeScanned);}
return this._super.apply(this,arguments);},welcome_message:function(){var self=this;var now=this.attendance.check_in.clone();this.return_to_main_menu=setTimeout(function(){self.do_action(self.next_action,{clear_breadcrumbs:true});},5000);if(now.hours()<5){this.$('.o_hr_attendance_message_message').append(_t("Good night"));}else if(now.hours()<12){if(now.hours()<8&&Math.random()<0.3){if(Math.random()<0.75){this.$('.o_hr_attendance_message_message').append(_t("The early bird catches the worm"));}else{this.$('.o_hr_attendance_message_message').append(_t("First come, first served"));}}else{this.$('.o_hr_attendance_message_message').append(_t("Good morning"));}}else if(now.hours()<17){this.$('.o_hr_attendance_message_message').append(_t("Good afternoon"));}else if(now.hours()<23){this.$('.o_hr_attendance_message_message').append(_t("Good evening"));}else{this.$('.o_hr_attendance_message_message').append(_t("Good night"));}
if(this.previous_attendance_change_date){var last_check_out_date=this.previous_attendance_change_date.clone();if(now-last_check_out_date>24*7*60*60*1000){this.$('.o_hr_attendance_random_message').html(_t("Glad to have you back, it's been a while!"));}else{if(Math.random()<0.02){this.$('.o_hr_attendance_random_message').html(_t("If a job is worth doing, it is worth doing well!"));}}}},farewell_message:function(){var self=this;var now=this.attendance.check_out.clone();this.return_to_main_menu=setTimeout(function(){self.do_action(self.next_action,{clear_breadcrumbs:true});},5000);if(this.previous_attendance_change_date){var last_check_in_date=this.previous_attendance_change_date.clone();if(now-last_check_in_date>1000*60*60*12){this.$('.o_hr_attendance_warning_message').show().append(_t("<b>Warning! Last check in was over 12 hours ago.</b><br/>If this isn't right, please contact Human Resource staff"));clearTimeout(this.return_to_main_menu);this.activeBarcode=false;}else if(now-last_check_in_date>1000*60*60*8){this.$('.o_hr_attendance_random_message').html(_t("Another good day's work! See you soon!"));}}
if(now.hours()<12){this.$('.o_hr_attendance_message_message').append(_t("Have a good day!"));}else if(now.hours()<14){this.$('.o_hr_attendance_message_message').append(_t("Have a nice lunch!"));if(Math.random()<0.05){this.$('.o_hr_attendance_random_message').html(_t("Eat breakfast as a king, lunch as a merchant and supper as a beggar"));}else if(Math.random()<0.06){this.$('.o_hr_attendance_random_message').html(_t("An apple a day keeps the doctor away"));}}else if(now.hours()<17){this.$('.o_hr_attendance_message_message').append(_t("Have a good afternoon"));}else{if(now.hours()<18&&Math.random()<0.2){this.$('.o_hr_attendance_message_message').append(_t("Early to bed and early to rise, makes a man healthy, wealthy and wise"));}else{this.$('.o_hr_attendance_message_message').append(_t("Have a good evening"));}}},_onBarcodeScanned:function(barcode){var self=this;if(this.attendanceBarcode!==barcode){if(this.return_to_main_menu){clearTimeout(this.return_to_main_menu);}
core.bus.off('barcode_scanned',this,this._onBarcodeScanned);this._rpc({model:'hr.employee',method:'attendance_scan',args:[barcode,],}).then(function(result){if(result.action){self.do_action(result.action);}else if(result.warning){self.do_warn(result.warning);setTimeout(function(){self.do_action(self.next_action,{clear_breadcrumbs:true});},5000);}},function(){setTimeout(function(){self.do_action(self.next_action,{clear_breadcrumbs:true});},5000);});}},destroy:function(){core.bus.off('barcode_scanned',this,this._onBarcodeScanned);clearTimeout(this.return_to_main_menu);this._super.apply(this,arguments);},});core.action_registry.add('hr_attendance_greeting_message',GreetingMessage);return GreetingMessage;});;

/* /hr_attendance/static/src/js/kiosk_mode.js defined in bundle 'web.assets_backend' */
odoo.define('hr_attendance.kiosk_mode',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var ajax=require('web.ajax');var core=require('web.core');var Session=require('web.session');var QWeb=core.qweb;var KioskMode=AbstractAction.extend({events:{"click .o_hr_attendance_button_employees":function(){this.do_action('hr_attendance.hr_employee_attendance_action_kanban',{additional_context:{'no_group_by':true},});},},start:function(){var self=this;core.bus.on('barcode_scanned',this,this._onBarcodeScanned);self.session=Session;const company_id=this.session.user_context.allowed_company_ids[0];var def=this._rpc({model:'res.company',method:'search_read',args:[[['id','=',company_id]],['name']],}).then(function(companies){self.company_name=companies[0].name;self.company_image_url=self.session.url('/web/image',{model:'res.company',id:company_id,field:'logo',});self.$el.html(QWeb.render("HrAttendanceKioskMode",{widget:self}));self.start_clock();});self._interval=window.setInterval(this._callServer.bind(this),(60*60*1000*24));return Promise.all([def,this._super.apply(this,arguments)]);},on_attach_callback:function(){this.call('bus_service','stopPolling');$('body').find('.o_thread_window_close').click();},_onBarcodeScanned:function(barcode){var self=this;core.bus.off('barcode_scanned',this,this._onBarcodeScanned);this._rpc({model:'hr.employee',method:'attendance_scan',args:[barcode,],}).then(function(result){if(result.action){self.do_action(result.action);}else if(result.warning){self.do_warn(result.warning);core.bus.on('barcode_scanned',self,self._onBarcodeScanned);}},function(){core.bus.on('barcode_scanned',self,self._onBarcodeScanned);});},start_clock:function(){this.clock_start=setInterval(function(){this.$(".o_hr_attendance_clock").text(new Date().toLocaleTimeString(navigator.language,{hour:'2-digit',minute:'2-digit',second:'2-digit'}));},500);this.$(".o_hr_attendance_clock").show().text(new Date().toLocaleTimeString(navigator.language,{hour:'2-digit',minute:'2-digit',second:'2-digit'}));},destroy:function(){core.bus.off('barcode_scanned',this,this._onBarcodeScanned);clearInterval(this.clock_start);clearInterval(this._interval);this.call('bus_service','startPolling');this._super.apply(this,arguments);},_callServer:function(){return ajax.rpc("/hr_attendance/kiosk_keepalive",{});},});core.action_registry.add('hr_attendance_kiosk_mode',KioskMode);return KioskMode;});;

/* /hr_attendance/static/src/js/kiosk_confirm.js defined in bundle 'web.assets_backend' */
odoo.define('hr_attendance.kiosk_confirm',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var core=require('web.core');var field_utils=require('web.field_utils');var QWeb=core.qweb;var KioskConfirm=AbstractAction.extend({events:{"click .o_hr_attendance_back_button":function(){this.do_action(this.next_action,{clear_breadcrumbs:true});},"click .o_hr_attendance_sign_in_out_icon":_.debounce(function(){var self=this;this._rpc({model:'hr.employee',method:'attendance_manual',args:[[this.employee_id],this.next_action],}).then(function(result){if(result.action){self.do_action(result.action);}else if(result.warning){self.do_warn(result.warning);}});},200,true),'click .o_hr_attendance_pin_pad_button_0':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+0);},'click .o_hr_attendance_pin_pad_button_1':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+1);},'click .o_hr_attendance_pin_pad_button_2':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+2);},'click .o_hr_attendance_pin_pad_button_3':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+3);},'click .o_hr_attendance_pin_pad_button_4':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+4);},'click .o_hr_attendance_pin_pad_button_5':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+5);},'click .o_hr_attendance_pin_pad_button_6':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+6);},'click .o_hr_attendance_pin_pad_button_7':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+7);},'click .o_hr_attendance_pin_pad_button_8':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+8);},'click .o_hr_attendance_pin_pad_button_9':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+9);},'click .o_hr_attendance_pin_pad_button_C':function(){this.$('.o_hr_attendance_PINbox').val('');},'click .o_hr_attendance_pin_pad_button_ok':_.debounce(function(){var self=this;this.$('.o_hr_attendance_pin_pad_button_ok').attr("disabled","disabled");this._rpc({model:'hr.employee',method:'attendance_manual',args:[[this.employee_id],this.next_action,this.$('.o_hr_attendance_PINbox').val()],}).then(function(result){if(result.action){self.do_action(result.action);}else if(result.warning){self.do_warn(result.warning);self.$('.o_hr_attendance_PINbox').val('');setTimeout(function(){self.$('.o_hr_attendance_pin_pad_button_ok').removeAttr("disabled");},500);}});},200,true),},init:function(parent,action){this._super.apply(this,arguments);this.next_action='hr_attendance.hr_attendance_action_kiosk_mode';this.employee_id=action.employee_id;this.employee_name=action.employee_name;this.employee_state=action.employee_state;this.employee_hours_today=field_utils.format.float_time(action.employee_hours_today);},start:function(){var self=this;this.getSession().user_has_group('hr_attendance.group_hr_attendance_use_pin').then(function(has_group){self.use_pin=has_group;self.$el.html(QWeb.render("HrAttendanceKioskConfirm",{widget:self}));self.start_clock();});return self._super.apply(this,arguments);},start_clock:function(){this.clock_start=setInterval(function(){this.$(".o_hr_attendance_clock").text(new Date().toLocaleTimeString(navigator.language,{hour:'2-digit',minute:'2-digit',second:'2-digit'}));},500);this.$(".o_hr_attendance_clock").show().text(new Date().toLocaleTimeString(navigator.language,{hour:'2-digit',minute:'2-digit',second:'2-digit'}));},destroy:function(){clearInterval(this.clock_start);this._super.apply(this,arguments);},});core.action_registry.add('hr_attendance_kiosk_confirm',KioskConfirm);return KioskConfirm;});;

/* /hr_attendance/static/src/js/my_attendances.js defined in bundle 'web.assets_backend' */
odoo.define('hr_attendance.my_attendances',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var core=require('web.core');var field_utils=require('web.field_utils');var MyAttendances=AbstractAction.extend({contentTemplate:'HrAttendanceMyMainMenu',events:{"click .o_hr_attendance_sign_in_out_icon":_.debounce(function(){this.update_attendance();},200,true),},willStart:function(){var self=this;var def=this._rpc({model:'hr.employee',method:'search_read',args:[[['user_id','=',this.getSession().uid]],['attendance_state','name','hours_today']],}).then(function(res){self.employee=res.length&&res[0];if(res.length){self.hours_today=field_utils.format.float_time(self.employee.hours_today);}});return Promise.all([def,this._super.apply(this,arguments)]);},update_attendance:function(){var self=this;this._rpc({model:'hr.employee',method:'attendance_manual',args:[[self.employee.id],'hr_attendance.hr_attendance_action_my_attendances'],}).then(function(result){if(result.action){self.do_action(result.action);}else if(result.warning){self.do_warn(result.warning);}});},});core.action_registry.add('hr_attendance_my_attendances',MyAttendances);return MyAttendances;});;

/* /hr_attendance/static/src/js/time_widget.js defined in bundle 'web.assets_backend' */
odoo.define('hr_attendance.widget',function(require){"use strict";var basic_fields=require('web.basic_fields');var field_registry=require('web.field_registry');var RelativeTime=basic_fields.FieldDateTime.extend({_formatValue:function(val){if(!(val&&val._isAMomentObject)){return;}
return val.fromNow(true);},});field_registry.add('relative_time',RelativeTime);return RelativeTime;});;

/* /hr_skills/static/src/js/resume_widget.js defined in bundle 'web.assets_backend' */
odoo.define('web.FieldResume',function(require){"use strict";var time=require('web.time');var FieldOne2Many=require('web.relational_fields').FieldOne2Many;var FieldProgressBar=require('web.basic_fields').FieldProgressBar;var ListRenderer=require('web.ListRenderer');var field_registry=require('web.field_registry');var core=require('web.core');var qweb=core.qweb;var _t=core._t;var AbstractGroupedOne2ManyRenderer=ListRenderer.extend({groupBy:'',groupTitleTemplate:'hr_default_group_row',dataRowTemplate:'',addLineButtonTemplate:'group_add_item',_freezeColumnWidths:function(){},_renderHeader:function(){return $('<thead/>');},_renderFooter:function(){return $('<tfoot/>');},_renderGroupRow:function(display_name){return qweb.render(this.groupTitleTemplate,{display_name:display_name});},_formatData:function(data){return data;},_renderRow:function(record,isLast){return $(qweb.render(this.dataRowTemplate,{id:record.id,data:this._formatData(record.data),is_last:isLast,}));},_getCreateLineContext:function(group){return{};},_renderTrashIcon:function(){return qweb.render('hr_trash_button');},_renderAddItemButton:function(group){return qweb.render(this.addLineButtonTemplate,{context:JSON.stringify(this._getCreateLineContext(group)),});},_renderBody:function(){var self=this;var grouped_by=_.groupBy(this.state.data,function(record){return record.data[self.groupBy].res_id;});var groupTitle;var $body=$('<tbody>');for(var key in grouped_by){var group=grouped_by[key];if(key==='undefined'){groupTitle=_t("Other");}else{groupTitle=group[0].data[self.groupBy].data.display_name;}
var $title_row=$(self._renderGroupRow(groupTitle));$body.append($title_row);group.forEach(function(record,index){var isLast=(index+1===group.length);var $row=self._renderRow(record,isLast);if(self.addTrashIcon)$row.append(self._renderTrashIcon());$body.append($row);});if(self.addCreateLine){$title_row.find('.o_group_name').append(self._renderAddItemButton(group));}}
if($body.is(':empty')&&self.addCreateLine){$body.append(this._renderAddItemButton());}
return $body;},});var ResumeLineRenderer=AbstractGroupedOne2ManyRenderer.extend({groupBy:'line_type_id',groupTitleTemplate:'hr_resume_group_row',dataRowTemplate:'hr_resume_data_row',_formatData:function(data){var dateFormat=time.getLangDateFormat();var date_start=data.date_start&&data.date_start.format(dateFormat)||"";var date_end=data.date_end&&data.date_end.format(dateFormat)||_t("Current");return _.extend(data,{date_start:date_start,date_end:date_end,});},_getCreateLineContext:function(group){var ctx=this._super(group);return group?_.extend({default_line_type_id:group[0].data[this.groupBy]&&group[0].data[this.groupBy].data.id||""},ctx):ctx;},_render:function(){var self=this;return this._super().then(function(){self.$el.find('table').removeClass('table-striped o_list_table_ungrouped');self.$el.find('table').addClass('o_resume_table table-borderless');});},});var SkillsRenderer=AbstractGroupedOne2ManyRenderer.extend({groupBy:'skill_type_id',dataRowTemplate:'hr_skill_data_row',_renderRow:function(record){var $row=this._super(record);var $td=$('<td/>',{class:'o_data_cell o_skill_cell'});var progress=new FieldProgressBar(this,'level_progress',record,{current_value:record.data.level_progress,attrs:this.arch.attrs,});progress.appendTo($td);return $row.append($td);},_getCreateLineContext:function(group){var ctx=this._super(group);return group?_.extend({default_skill_type_id:group[0].data[this.groupBy].data.id},ctx):ctx;},_render:function(){var self=this;return this._super().then(function(){self.$el.find('table').toggleClass('table-striped');});},});var FieldResume=FieldOne2Many.extend({_getRenderer:function(){return ResumeLineRenderer;},});var FieldSkills=FieldOne2Many.extend({_getRenderer:function(){return SkillsRenderer;},});field_registry.add('hr_resume',FieldResume);field_registry.add('hr_skills',FieldSkills);return FieldResume;});;

/* /project/static/src/js/project.js defined in bundle 'web.assets_backend' */
odoo.define('project.update_kanban',function(require){'use strict';var KanbanRecord=require('web.KanbanRecord');KanbanRecord.include({_openRecord:function(){if(this.modelName==='project.project'&&this.$(".o_project_kanban_boxes a").length){this.$('.o_project_kanban_boxes a').first().click();}else{this._super.apply(this,arguments);}},});});;

/* /project/static/src/js/project_task_kanban_examples.js defined in bundle 'web.assets_backend' */
odoo.define('project.task_kanban_examples',function(require){'use strict';var core=require('web.core');var kanbanExamplesRegistry=require('web.kanban_examples_registry');var _lt=core._lt;var greenBullet='<span class="o_status o_status_green"></span>';var redBullet='<span class="o_status o_status_red"></span>';var star='<a style="color: gold;" class="fa fa-star"/>';function escFormat(){var args=arguments;return{toString:function(){args[0]=_.escape(args[0]);return _.str.sprintf.apply(_.str,args);},};}
kanbanExamplesRegistry.add('project',{ghostColumns:[_lt('New'),_lt('Assigned'),_lt('In Progress'),_lt('Done')],examples:[{name:_lt('Software Development'),columns:[_lt('Backlog'),_lt('Specifications'),_lt('Development'),_lt('Tests'),_lt('Delivered')],description:escFormat(_lt('Prioritize Tasks by using the %s icon.'+'%s Use the %s button to signalize to your colleagues that a task is ready for the next stage.'+'%s Use the %s to signalize a problem or a need for discussion on a task.'),star,'<br/>',greenBullet,'<br/>',redBullet),bullets:[greenBullet,redBullet,star],},{name:_lt('Agile'),columns:[_lt('Backlog'),_lt('Analysis'),_lt('Development'),_lt('Testing'),_lt('Done')],description:escFormat(_lt('Waiting for the next stage: use %s and %s bullets.'),greenBullet,redBullet),bullets:[greenBullet,redBullet],},{name:_lt('Digital Marketing'),columns:[_lt('Ideas'),_lt('Researching'),_lt('Writing'),_lt('Editing'),_lt('Done')],description:escFormat(_lt('Everyone can propose ideas, and the Editor marks the best ones '+'as %s. Attach all documents or links to the task directly, to have all information about '+'a research centralized.'),greenBullet),bullets:[greenBullet,redBullet],},{name:_lt('Customer Feedback'),columns:[_lt('New'),_lt('In development'),_lt('Done'),_lt('Refused')],description:escFormat(_lt('Customers propose feedbacks by email; Odoo creates tasks '+'automatically, and you can communicate on the task directly. Your managers decide which '+'feedback is accepted %s and which feedback is moved to the "Refused" column.'),greenBullet),bullets:[greenBullet,redBullet],},{name:_lt('Getting Things Done (GTD)'),columns:[_lt('Inbox'),_lt('Today'),_lt('This Week'),_lt('This Month'),_lt('Long Term')],description:_lt('Fill your Inbox easily with the email gateway. Periodically review your '+'Inbox and schedule tasks by moving them to others columns. Every day, you review the '+'"This Week" column to move important tasks "Today". Every Monday, you review the "This '+'Month" column.'),},{name:_lt('Consulting'),columns:[_lt('New Projects'),_lt('Resources Allocation'),_lt('In Progress'),_lt('Done')],description:escFormat(_lt('Manage the lifecycle of your project using the kanban view. Add newly acquired project, assign them and use the %s and %s to define if the project is ready for the next step.'),greenBullet,redBullet),bullets:[greenBullet,redBullet],},{name:_lt('Research Project'),columns:[_lt('Brainstorm'),_lt('Research'),_lt('Draft'),_lt('Final Document')],description:escFormat(_lt('Handle your idea gathering within Tasks of your new Project and discuss them in the chatter of the tasks. Use the %s and %s to signalize what is the current status of your Idea'),greenBullet,redBullet),bullets:[greenBullet,redBullet],},{name:_lt('Website Redesign'),columns:[_lt('Page Ideas'),_lt('Copywriting'),_lt('Design'),_lt('Live')],description:escFormat(_lt('Handle your idea gathering within Tasks of your new Project and discuss them in the chatter of the tasks. Use the %s and %s to signalize what is the current status of your Idea'),greenBullet,redBullet),},{name:_lt('T-shirt Printing'),columns:[_lt('New Orders'),_lt('Logo Design'),_lt('To Print'),_lt('Done')],description:escFormat(_lt('Communicate with customers on the task using the email gateway. '+'Attach logo designs to the task, so that information flow from designers to the workers '+'who print the t-shirt. Organize priorities amongst orders %s using the icon.'),star),bullets:[star],}],});});;

/* /project/static/src/js/tours/project.js defined in bundle 'web.assets_backend' */
odoo.define('project.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('project_tour',{url:"/web",},[tour.STEPS.SHOW_APPS_MENU_ITEM,{trigger:'.o_app[data-menu-xmlid="project.menu_main_pm"]',content:_t('Want a better way to <b>manage your projects</b>? <i>It starts here.</i>'),position:'right',edition:'community',},{trigger:'.o_app[data-menu-xmlid="project.menu_main_pm"]',content:_t('Want a better way to <b>manage your projects</b>? <i>It starts here.</i>'),position:'bottom',edition:'enterprise',},{trigger:'.o-kanban-button-new',extra_trigger:'.o_project_kanban',content:_t('Let\'s create your first project.'),position:'bottom',width:200,},{trigger:'input.o_project_name',content:_t('Choose a <b>project name</b>. (e.g. Website Launch, Product Development, Office Party, etc.)'),position:'right',},{trigger:'.o_open_tasks',content:_t('This will create a new project and redirect us to its stages.'),position:'top',run:function(actions){actions.auto('.modal:visible .btn.btn-primary');},},{trigger:".o_kanban_project_tasks .o_column_quick_create input",content:_t("Add columns to configure <b>stages for your tasks</b>.<br/><i>e.g. New - In Progress - Done</i>"),position:"bottom",},{trigger:".o_kanban_project_tasks .o_column_quick_create .o_kanban_add",auto:true,},{trigger:".o_kanban_project_tasks .o_column_quick_create input",content:_t("Add columns to configure <b>stages for your tasks</b>.<br/><i>e.g. New - In Progress - Done</i>"),position:"bottom",},{trigger:".o_kanban_project_tasks .o_column_quick_create .o_kanban_add",auto:true,},{trigger:'.o-kanban-button-new',extra_trigger:'.o_kanban_project_tasks',content:_t('Let\'s create your first task.'),position:'bottom',width:200,},{trigger:'.o_kanban_quick_create input.o_field_char[name=name]',extra_trigger:'.o_kanban_project_tasks',content:_t('Choose a <b>task name</b>. (e.g. Website Design, Purchase Goods etc.)'),position:'right',},{trigger:'.o_kanban_quick_create .o_kanban_add',extra_trigger:'.o_kanban_project_tasks',content:_t("<p>Once your task is ready, you can save it.</p>"),position:'bottom',},{trigger:".o_kanban_record .o_priority_star",extra_trigger:'.o_kanban_project_tasks',content:_t("<b>Star tasks</b> to mark team priorities."),position:"bottom",},{trigger:".o_kanban_record .oe_kanban_content",extra_trigger:'.o_kanban_project_tasks',content:_t("Click on the card to write more information about it and collaborate with your coworkers."),position:"bottom",},{trigger:".o_form_button_edit",extra_trigger:'.o_form_project_tasks',content:_t('Click on this button to modify the task.'),position:"bottom"},{trigger:".o_form_view .o_task_user_field",extra_trigger:'.o_form_project_tasks.o_form_editable',content:_t('<b>Assign the task</b> to someone. <i>You can create and invite a new user on the fly.</i>'),position:"bottom",run:function(actions){actions.text("Marc Demo",this.$anchor.find("input"));},},{trigger:".ui-autocomplete > li > a",auto:true,},{trigger:".o_form_button_save",extra_trigger:'.o_form_project_tasks.o_form_editable',content:_t('<b>Click the save button</b> to apply your changes to the task.'),position:"bottom"},{trigger:".breadcrumb-item:not(.active):last",extra_trigger:'.o_form_project_tasks.o_form_readonly',content:_t("Use the breadcrumbs to <b>go back to your tasks pipeline</b>."),position:"right"}]);});;

/* /hr_timesheet/static/src/js/timesheet_uom.js defined in bundle 'web.assets_backend' */
odoo.define('hr_timesheet.timesheet_uom',function(require){'use strict';var AbstractField=require('web.AbstractField');var basicFields=require('web.basic_fields');var fieldUtils=require('web.field_utils');var fieldRegistry=require('web.field_registry');require('web._field_registry');var session=require('web.session');var FieldTimesheetFactor=basicFields.FieldFloatFactor.extend({formatType:'float_factor',init:function(parent,name,record,options){this._super(parent,name,record,options);if(session.timesheet_uom_factor){this.nodeOptions.factor=session.timesheet_uom_factor;this.parseOptions.factor=session.timesheet_uom_factor;}},});var FieldTimesheetToggle=basicFields.FieldFloatToggle.extend({formatType:'float_factor',init:function(parent,name,record,options){options=options||{};var fieldsInfo=record.fieldsInfo[options.viewType||'default'];var attrs=options.attrs||(fieldsInfo&&fieldsInfo[name])||{};var hasRange=_.contains(_.keys(attrs.options||{}),'range');this._super(parent,name,record,options);if(!hasRange){this.nodeOptions.range=[0.00,1.00,0.50];}
this.nodeOptions.factor=session.timesheet_uom_factor;},});var widgetName='timesheet_uom'in session?session.timesheet_uom.timesheet_widget:'float_factor';var FieldTimesheetUom=widgetName==='float_toggle'?FieldTimesheetToggle:((fieldRegistry.get(widgetName)&&fieldRegistry.get(widgetName).extend({}))||FieldTimesheetFactor);fieldRegistry.add('timesheet_uom',FieldTimesheetUom);var _tweak_options=function(options){if(!_.contains(options,'factor')){options.factor=session.timesheet_uom_factor;}
return options;};fieldUtils.format.timesheet_uom=function(value,field,options){options=_tweak_options(options||{});var formatter=fieldUtils.format[FieldTimesheetUom.prototype.formatType];return formatter(value,field,options);};fieldUtils.parse.timesheet_uom=function(value,field,options){options=_tweak_options(options||{});var parser=fieldUtils.parse[FieldTimesheetUom.prototype.formatType];return parser(value,field,options);};return FieldTimesheetUom;});;

/* /project_enterprise/static/src/js/task_gantt_view.js defined in bundle 'web.assets_backend' */
odoo.define('project_enterprise.TaskGanttView',function(require){'use strict';var GanttView=require('web_gantt.GanttView');var TaskGanttController=require('project_enterprise.TaskGanttController');var GanttRenderer=require('web_gantt.GanttRenderer');var TaskGanttModel=require('project_enterprise.TaskGanttModel');var view_registry=require('web.view_registry');var TaskGanttView=GanttView.extend({config:_.extend({},GanttView.prototype.config,{Controller:TaskGanttController,Renderer:GanttRenderer,Model:TaskGanttModel,}),});view_registry.add('task_gantt',TaskGanttView);return TaskGanttView;});;

/* /project_enterprise/static/src/js/task_gantt_model.js defined in bundle 'web.assets_backend' */
odoo.define('project_enterprise.TaskGanttModel',function(require){"use strict";var GanttModel=require('web_gantt.GanttModel');var _t=require('web.core')._t;var TaskGanttModel=GanttModel.extend({_generateRows:function(params){if(params.groupedBy.length){var groupedByField=params.groupedBy[0];if(groupedByField==='user_id'){var empty_exists=_.some(params.groups,function(group){return!group[groupedByField];});if(!empty_exists){var values=this._parsePath(params.parentPath);var new_group=_.clone(values);new_group=_.extend(new_group,{id:_.uniqueId('group'),fake:true,__count:0,__domain:this._getDomain(),user_id:false,});params.groups.push(new_group);this.ganttData.groups.push(new_group);}}}
var rows=this._super(params);_.each(rows,function(row){if(row.groupedByField==='user_id'&&!row.resId){row.name=_t('Unassigned Tasks');}});if(params.groupedBy&&params.groupedBy.length){if(rows&&rows.length&&rows[rows.length-1]&&!rows[rows.length-1].resId){rows.unshift(rows.pop());}}
return rows;},_parsePath:function(path){var values={};if(path){var pathParts=path.split('\n');var state=this.get();var groupby=state.groupedBy;_.each(groupby,function(fname,index){var val=pathParts[index];if(val){val=JSON.parse(val);if(state.fields[fname].type=='many2one'){values[fname]=val[0];}else{values[fname]=val;}}});}
return values;},});return TaskGanttModel;});;

/* /project_enterprise/static/src/js/task_gantt_controller.js defined in bundle 'web.assets_backend' */
odoo.define('project_enterprise.TaskGanttController',function(require){'use strict';var GanttController=require('web_gantt.GanttController');var core=require('web.core');var QWeb=core.qweb;var PlanningGanttController=GanttController.extend({renderButtons:function($node){if($node){var state=this.model.get();this.$buttons=$(QWeb.render('TaskGanttView.buttons',{groupedBy:state.groupedBy,widget:this,SCALES:this.SCALES,activateScale:state.scale,allowedScales:this.allowedScales,activeActions:this.activeActions,}));this.$buttons.appendTo($node);}},});return PlanningGanttController;});;

/* /project_timesheet_synchro/static/src/js/timesheet_app_backend.js defined in bundle 'web.assets_backend' */
odoo.define('projcet_timesheet_synchro.app',function(require){'use strict';var AbstractAction=require('web.AbstractAction');var config=require('web.config');var core=require('web.core');var IFrameWidget=require('web.IFrameWidget');var project_timesheet_synchro_demo=AbstractAction.extend({contentTemplate:'project_timesheet_synchro.demo',start:function(){var def;if(config.device.size_class>=config.device.SIZES.MD){var app=new project_timesheet_synchro_app();def=app.appendTo(this.$('.o_project_timesheet_app'));}
return Promise.all([def,this._super.apply(this,arguments)]);},});var project_timesheet_synchro_app=IFrameWidget.extend({init:function(parent){this._super(parent,'/project_timesheet_synchro/timesheet_app');},start:function(){var res=this._super.apply(this,arguments);this.$el.css({height:'582px',width:'330px',border:0});return res;},});core.action_registry.add('project_timesheet_synchro_app_action',project_timesheet_synchro_demo);});;

/* /timesheet_grid/static/src/js/timesheet_uom.js defined in bundle 'web.assets_backend' */
odoo.define('timesheet_grid.timesheet_uom',function(require){'use strict';var gridRegistry=require('web_grid.widget_registry');var gridWidgets=require('web_grid.widget');var session=require('web.session');var FloatFactorWidgetTimesheet=gridWidgets.FloatFactorWidget.extend({init:function(gridRenderer,fieldInfo,nodeOptions){this._super.apply(this,arguments);if(session.timesheet_uom_factor){this.nodeOptions.factor=session.timesheet_uom_factor;this.formatOptions.factor=session.timesheet_uom_factor;this.parseOptions.factor=session.timesheet_uom_factor;}},});var FloatToggleWidgetTimesheet=gridWidgets.FloatToggleWidget.extend({init:function(gridRenderer,fieldInfo,nodeOptions){var hasRange=_.contains(_.keys(nodeOptions||{}),'range');this._super.apply(this,arguments);if(session.timesheet_uom_factor){this.nodeOptions.factor=session.timesheet_uom_factor;this.formatOptions.factor=session.timesheet_uom_factor;this.parseOptions.factor=session.timesheet_uom_factor;}
if(!hasRange){var timesheet_range=[0.00,1.00,0.50];this.nodeOptions.range=timesheet_range;this.formatOptions.range=timesheet_range;this.parseOptions.range=timesheet_range;this.range=timesheet_range;}},});var FieldTimesheetUom=FloatFactorWidgetTimesheet;var widgetName='timesheet_uom'in session?session.timesheet_uom.timesheet_widget:'float_factor';if(widgetName==="float_toggle"){var FieldTimesheetUom=FloatToggleWidgetTimesheet;}else if(widgetName==="float_factor"){var FieldTimesheetUom=FloatFactorWidgetTimesheet;}else{var FieldTimesheetUom=(gridRegistry.get(widgetName)&&gridRegistry.get(widgetName).extend({}))||FloatFactorWidgetTimesheet;}
gridRegistry.add('timesheet_uom',FieldTimesheetUom);return FieldTimesheetUom;});;

/* /timesheet_grid/static/src/js/tours/timesheet_grid.js defined in bundle 'web.assets_backend' */
"use strict";odoo.define('timesheet.tour',function(require){var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('timesheet_tour',{url:"/web",},[tour.STEPS.SHOW_APPS_MENU_ITEM,{trigger:'.o_app[data-menu-xmlid="hr_timesheet.timesheet_menu_root"]',content:_t('Track the time spent on your projects. <i>It starts here.</i>'),position:'bottom',},{trigger:'.o_grid_button_add',content:_t('Timesheets are done on tasks, click here to create your first one.'),position:'bottom',},{trigger:".modal-body .o_timesheet_tour_project_name",content:_t('Choose a <b>project name</b>. (e.g. name of a customer, or product)'),position:"right",run:function(actions){actions.auto();},},{trigger:".modal-body .o_timesheet_tour_task_name",content:_t('Use tasks to track the different type of activities. (e.g. Graphic Design, Programming, Project Management)'),position:"right",run:function(actions){actions.auto(".modal-footer .btn-secondary");},},{trigger:'.o_grid_input',content:_t('Set the number of hours done on this task, for every day of the week. (e.g. 1.5 or 1:30)'),position:'top',run:function(actions){actions.text("4",this.$anchor);},}]);});;

/* /documents/static/src/js/documents_document_viewer.js defined in bundle 'web.assets_backend' */
odoo.define('documents.DocumentViewer',function(require){"use strict";var DocumentViewer=require('mail.DocumentViewer');var DocumentsDocumentViewer=DocumentViewer.extend({template:"DocumentsDocumentViewer",events:_.extend({},DocumentViewer.prototype.events,{'click .o_documents_split_btn':'_onSplitPDF',}),init:function(parent,attachments,activeAttachmentID){this._super.apply(this,arguments);this.modelName='documents.document';},_onSplitPDF:function(e){e.stopPropagation();var self=this;var indices=this.$(".o_documents_page_number_input").val();var remainder=this.$(".o_documents_remainder_input").is(":checked");var always=function(){self.trigger_up('document_viewer_attachment_changed');self.destroy();};this._rpc({model:'documents.document',method:'split_pdf',args:[this.activeAttachment.id,indices,remainder],}).then(always).guardedCatch(always);},});return DocumentsDocumentViewer;});;

/* /documents/static/src/js/documents_kanban_color_widget.js defined in bundle 'web.assets_backend' */
odoo.define('documents.Many2ManyColorWidget',function(require){'use strict';var field_registry=require('web.field_registry');var relational_fields=require('web.relational_fields');var KanbanFieldMany2ManyTags=relational_fields.KanbanFieldMany2ManyTags;var Many2ManyColorWidget=KanbanFieldMany2ManyTags.extend({start:function(){var self=this;this.trigger_up('get_search_panel_tags',{callback:function(val){self.tags=val;}});return this._super.apply(this,arguments);},_render:function(){var self=this;if(!this.tags||!this.tags.length){return this._super.apply(this,arguments);}
this.$el.empty().addClass('o_field_many2manytags o_kanban_tags');var tagIDs=_.map(this.value.data,function(m2m){return m2m.data.id;});_.each(this.tags,function(tag){if(tagIDs.indexOf(tag.id)>-1){var color=tag.group_hex_color||'#00000022';$('<span>',{class:'o_tag',text:tag.name,title:tag.group_name+' > '+tag.name,}).prepend($('<span>',{style:'color: '+color+';',text:'●',})).appendTo(self.$el);}});},});field_registry.add('documents_kanban_color_tags',Many2ManyColorWidget);});;

/* /documents/static/src/js/documents_kanban_controller.js defined in bundle 'web.assets_backend' */
odoo.define('documents.DocumentsKanbanController',function(require){"use strict";var DocumentsInspector=require('documents.DocumentsInspector');var DocumentViewer=require('documents.DocumentViewer');var DocumentsProgressBar=require('documents.ProgressBar');var DocumentsProgressCard=require('documents.ProgressCard');var Chatter=require('mail.Chatter');var core=require('web.core');var KanbanController=require('web.KanbanController');var session=require('web.session');var utils=require('web.utils');var qweb=core.qweb;var _t=core._t;var DocumentsKanbanController=KanbanController.extend({events:_.extend({},KanbanController.prototype.events,{'click .o_document_close_chatter':'_onCloseChatter','drop .o_documents_kanban_view':'_onDrop','dragstart .oe_kanban_global_area':'_onRecordDragStart','dragover .o_documents_kanban_view':'_onHoverDrop','dragleave .o_documents_kanban_view':'_onHoverLeave','click .o_documents_kanban_share':'_onShareDomain','click .o_documents_kanban_upload':'_onUpload','click .o_documents_kanban_url':'_onUploadFromUrl','click .o_documents_kanban_request':'_onRequestFile',}),custom_events:_.extend({},KanbanController.prototype.custom_events,{archive_records:'_onArchiveRecords',delete_records:'_onDeleteRecords',document_viewer_attachment_changed:'_onDocumentViewerAttachmentChanged',download:'_onDownload',get_search_panel_tags:'_onGetSearchPanelTags',kanban_image_clicked:'_onKanbanPreview',lock_attachment:'_onLock',open_chatter:'_onOpenChatter',open_record:'_onOpenRecord',progress_bar_abort:'_onProgressBarAbort',replace_file:'_onReplaceFile',save_multi:'_onSaveMulti',select_record:'_onRecordSelected',selection_changed:'_onSelectionChanged',set_focus_tag_input:'_onSetFocusTagInput',share:'_onShareIDs',trigger_rule:'_onTriggerRule',}),init:function(){this._super.apply(this,arguments);const state=this.model.get(this.handle,{raw:true});this.unlockedRecordIDs=state.data.filter(record=>!record.data.lock_uid||record.data.lock_uid===session.uid).map(record=>record.res_id);this.selectedRecordIDs=[];this.chatter=null;this.documentsInspector=null;this.anchorID=null;this.uploads={};this._focusTagInput=false;},start:function(){this.$('.o_content').addClass('o_documents_kanban');return this._super.apply(this,arguments);},reload:function(){return this._super.apply(this,arguments).then(()=>{const state=this.model.get(this.handle,{raw:true});const recordIDs=state.data.map(record=>record.res_id);this.unlockedRecordIDs=state.data.filter(record=>!record.data.lock_uid||record.data.lock_uid===session.uid).map(record=>record.res_id);this.selectedRecordIDs=_.intersection(this.selectedRecordIDs,recordIDs);this.renderer.updateSelection(this.selectedRecordIDs);return this._attachProgressBars();});},renderButtons:function($node){this.$buttons=$(qweb.render('DocumentsKanbanView.buttons'));this.$buttons.appendTo($node);this._updateButtons();},async _attachProgressBars(){const currentFolderID=this._searchPanel.getSelectedFolderId();for(const upload of Object.values(this.uploads)){if(!currentFolderID||!upload.folderID||currentFolderID===upload.folderID){let $targetCard;if(upload.progressCard){await upload.progressCard.prependTo(this.$('.o_documents_kanban_view'));$targetCard=upload.progressCard.$el;}else{$targetCard=this.$(`.o_kanban_attachment[data-id="${upload.documentID}"]`);$targetCard.find('.o_record_selector').addClass('o_hidden');}
await upload.progressBar.appendTo($targetCard);}}
const uploadingFolderIDs=_.uniq(_.pluck(this.uploads,'folderID'));this._searchPanel.setUploadingFolderIDs(uploadingFolderIDs);},_closeChatter:function(){this.$('.o_content').removeClass('o_chatter_open');this.$('.o_document_chatter').remove();if(this.chatter){this.chatter.destroy();this.chatter=null;}},_createXHR(){return new window.XMLHttpRequest();},_makeNewProgress(uploadID,folderID,xhr,title,type){const progressCard=new DocumentsProgressCard(this,{title,type,});const progressBar=new DocumentsProgressBar(this,{xhr,title,uploadID,});xhr.upload.addEventListener("progress",ev=>{if(ev.lengthComputable){progressCard.update(ev.loaded,ev.total);progressBar.update(ev.loaded,ev.total);}});this.uploads[uploadID]={folderID,progressBar,progressCard,};},_makeReplaceProgress(uploadID,documentID,xhr){const progressBar=new DocumentsProgressBar(this,{xhr,uploadID,});xhr.upload.addEventListener("progress",ev=>{if(ev.lengthComputable){progressBar.update(ev.loaded,ev.total);}});this.uploads[uploadID]={documentID,progressBar,};},_openChatter:function(record){var self=this;return this.model.fetchActivities(record.id).then(function(){record=self.model.get(record.id);var $chatterContainer=$('<div>').addClass('o_document_chatter oe_chatter p-relative bg-white');var options={display_log_button:true,isEditable:true,};var mailFields={mail_thread:'message_ids',mail_followers:'message_follower_ids',mail_activity:'activity_ids'};self._closeChatter();self.chatter=new Chatter(self,record,mailFields,options);return self.chatter.appendTo($chatterContainer).then(function(){$chatterContainer.append($('<span>').addClass('o_document_close_chatter text-center').html('&#215;'));self.$('.o_content').addClass('o_chatter_open');self.$('.o_content').append($chatterContainer);});});},async _processFiles(files,documentID){const uploadID=_.uniqueId('uploadID');const folderID=this._searchPanel.getSelectedFolderId();const tagIDS=this._searchPanel.getSelectedTagIds();const context=this.model.get(this.handle,{raw:true}).getContext();if(!folderID&&!documentID){return;}
if(!files.length){return;}
const data=new FormData();data.append('csrf_token',core.csrf_token);data.append('tag_ids',tagIDS);data.append('folder_id',folderID);if(documentID){if(files.length>1){return;}
data.append('document_id',documentID);}
if(context){if(context.default_partner_id){data.append('partner_id',context.default_partner_id);}
if(context.default_owner_id){data.append('owner_id',context.default_owner_id);}}
for(const file of files){data.append('ufile',file);}
let title=files.length+' Files';let type;if(files.length===1){title=files[0].name;type=files[0].type;}
const prom=new Promise(resolve=>{const xhr=this._createXHR();xhr.open('POST','/documents/upload_attachment');if(documentID){this._makeReplaceProgress(uploadID,documentID,xhr);}else{this._makeNewProgress(uploadID,folderID,xhr,title,type);}
const progressPromise=this._attachProgressBars();xhr.onload=async()=>{await progressPromise;resolve();let result={error:xhr.status};if(xhr.status===200){result=JSON.parse(xhr.response);}
if(result.error){this.do_notify(_t("Error"),result.error,true);}
this._removeProgressBar(uploadID);};xhr.onerror=async()=>{await progressPromise;resolve();this.do_notify(xhr.status,_.str.sprintf(_t('message: %s'),xhr.reponseText),true);this._removeProgressBar(uploadID);};xhr.send(data);});return prom;},async _removeProgressBar(uploadID){const upload=this.uploads[uploadID];upload.progressCard&&upload.progressCard.destroy();upload.progressBar.destroy();delete this.uploads[uploadID];await this.reload();},_renderDocumentsInspector:function(state){var self=this;var localState;if(this.documentsInspector){localState=this.documentsInspector.getLocalState();this.documentsInspector.destroy();}
var params={recordIDs:this.selectedRecordIDs,state:state,folders:this._searchPanel.getFolders(),tags:this._searchPanel.getTags(),folderId:this._searchPanel.getSelectedFolderId(),focusTagInput:this._focusTagInput,};this._focusTagInput=false;this.documentsInspector=new DocumentsInspector(this,params);this.documentsInspector.insertAfter(this.$('.o_kanban_view')).then(function(){if(localState){self.documentsInspector.setLocalState(localState);}});},_share:function(vals){var self=this;if(!vals.folder_id){return;}
return this._rpc({model:'documents.share',method:'create_share',args:[vals],}).then(function(result){return self.do_action(result);});},_triggerRule:function(recordIDs,ruleID){var self=this;return this._rpc({model:'documents.workflow.rule',method:'apply_actions',args:[[ruleID],recordIDs],}).then(function(result){if(_.isObject(result)){return self.do_action(result);}else{return self.reload();}});},_update:function(){var self=this;return this._super.apply(this,arguments).then(function(){var state=self.model.get(self.handle);return self._updateChatter(state).then(function(){self._renderDocumentsInspector(state);self.anchorID=null;});});},_updateButtons:function(){this._super.apply(this,arguments);var selectedFolderId=this._searchPanel.getSelectedFolderId();this.$buttons.find('.o_documents_kanban_upload').prop('disabled',!selectedFolderId);this.$buttons.find('.o_documents_kanban_url').prop('disabled',!selectedFolderId);this.$buttons.find('.o_documents_kanban_request').prop('disabled',!selectedFolderId);this.$buttons.find('.o_documents_kanban_share').prop('disabled',!selectedFolderId);},_updateChatter:function(state){if(this.chatter){if(this.selectedRecordIDs.length===1){var record=_.findWhere(state.data,{res_id:this.selectedRecordIDs[0]});if(record){return this._openChatter(record);}}
this._closeChatter();}
return Promise.resolve();},_uploadFilesHandler:function(multiple){return(ev)=>{const documentID=ev.data?ev.data.id:undefined;const $uploadInput=this.hiddenUploadInputFile?this.hiddenUploadInputFile.off('change'):(this.hiddenUploadInputFile=$('<input>',{type:'file',name:'files[]',class:'o_hidden'}).appendTo(this.$el));$uploadInput.attr('multiple',multiple?true:null);const cleanup=$.prototype.remove.bind($uploadInput);$uploadInput.on('change',changeEv=>{this._processFiles(changeEv.target.files,documentID).then(cleanup).guardedCatch(cleanup);});$uploadInput.click();}},_onArchiveRecords:function(ev){ev.stopPropagation();var self=this;var recordIDs=_.pluck(ev.data.records,'id');this.model.toggleActive(recordIDs,this.handle).then(function(){self.update({},{reload:false});});},_onCloseChatter:function(){this._closeChatter();},_onDeleteRecords:function(ev){ev.stopPropagation();var self=this;var recordIDs=_.pluck(ev.data.records,'id');this.model.deleteRecords(recordIDs,this.modelName).then(function(){var resIDs=_.pluck(ev.data.records,'res_id');self.selectedRecordIDs=_.difference(self.selectedRecordIDs,resIDs);self.reload();});},_onDocumentViewerAttachmentChanged:function(){this.update({});},_onDownload:function(ev){ev.stopPropagation();var resIDs=ev.data.resIDs;if(resIDs.length===1){window.location='/documents/content/'+resIDs[0];}else{var timestamp=moment().format('YYYY-MM-DD');session.get_file({url:'/document/zip',data:{file_ids:resIDs,zip_name:'documents-'+timestamp+'.zip',},});}},_onDrop:function(ev){if(ev.originalEvent.dataTransfer.types.indexOf('Files')===-1){return;}
ev.preventDefault();this.$('.o_documents_kanban_view').removeClass('o_drop_over');this.$('.o_upload_text').remove();this._processFiles(ev.originalEvent.dataTransfer.files);},_onGetSearchPanelTags:function(ev){ev.data.callback(this._searchPanel.getTags());},_onHoverDrop:function(ev){if(ev.originalEvent.dataTransfer.types.indexOf('Files')===-1){return;}
ev.preventDefault();if(!this._searchPanel.getSelectedFolderId()){return;}
this.renderer.$el.addClass('o_drop_over');if(this.$('.o_upload_text').length===0){var $upload_text=$('<div>').addClass("o_upload_text text-center text-white");$upload_text.append('<i class="d-block fa fa-upload fa-9x mb-4"/>');$upload_text.append('<span>'+_t('Drop files here to upload')+'</span>');this.$('.o_content').append($upload_text);}
$(document).on('dragover:kanbanView',this._onHoverLeave.bind(this));},_onHoverLeave:function(ev){if($.contains(this.renderer.$el[0],ev.target)){return;}
var target=document.elementFromPoint(ev.originalEvent.clientX,ev.originalEvent.clientY);if($.contains(this.renderer.$el[0],target)){return;}
$(document).off('dragover:kanbanView');this.renderer.$el.removeClass('o_drop_over');this.$('.o_upload_text').remove();},_onKanbanPreview:function(ev){ev.stopPropagation();var documents=ev.data.recordList;var documentID=ev.data.recordID;var documentViewer=new DocumentViewer(this,documents,documentID);documentViewer.appendTo(this.$('.o_documents_kanban_view'));},_onLock:function(ev){ev.stopPropagation();var self=this;this._rpc({model:'documents.document',method:'toggle_lock',args:[ev.data.resID],}).then(self.reload.bind(self),self.reload.bind(self));},_onOpenChatter:function(ev){ev.stopPropagation();var state=this.model.get(this.handle);var record=_.findWhere(state.data,{res_id:ev.data.id});this._openChatter(record);},_onOpenRecord:function(ev){ev.stopPropagation();var self=this;var always=function(result){self.do_action({res_id:ev.data.resID,res_model:ev.data.resModel,type:'ir.actions.act_window',views:[[result,'form']],});};this._rpc({model:ev.data.resModel,method:'get_formview_id',args:[ev.data.resID],}).then(always).guardedCatch(always);},_onProgressBarAbort(ev){const uploadID=ev.data.uploadID;this._removeProgressBar(uploadID);},_onRecordDragStart:function(ev){if(!ev.currentTarget.classList.contains('o_record_selected')){ev.currentTarget.click();}
const draggedRecordIDs=_.intersection(this.selectedRecordIDs,this.unlockedRecordIDs);if(draggedRecordIDs.length===0){return ev.preventDefault();}
const lockedCount=this.selectedRecordIDs.length-draggedRecordIDs.length;ev.originalEvent.dataTransfer.setData("o_documents_data",JSON.stringify({recordIDs:draggedRecordIDs,lockedCount,}));let dragIconContent=_.str.sprintf(_t('%s Documents'),draggedRecordIDs.length);const lockedCountText=_.str.sprintf(_t(' (+%s locked)'),lockedCount);if(draggedRecordIDs.length===1){const state=this.model.get(this.handle);const record=state.data.find(record=>record.res_id===draggedRecordIDs[0]);if(record){dragIconContent=record.data.name?record.data.display_name:_t('Unnamed');}}
const $dragIcon=$('<span>',{text:lockedCount?dragIconContent+=lockedCountText:dragIconContent,class:'o_documents_drag_icon'}).appendTo($('body'));ev.originalEvent.dataTransfer.setDragImage($dragIcon[0],-5,-5);setTimeout(()=>$dragIcon.remove());},_onRecordSelected:function(ev){ev.stopPropagation();var shift=ev.data.originalEvent.shiftKey;var ctrl=ev.data.originalEvent.ctrlKey||ev.data.originalEvent.metaKey;var state=this.model.get(this.handle);if(ev.data.clear||shift||ctrl){if(this.selectedRecordIDs.length===1&&this.selectedRecordIDs[0]===ev.data.resID){this.selectedRecordIDs=[];}else if(shift&&this.selectedRecordIDs.length){var recordIDs=_.pluck(state.data,'res_id');var anchorIndex=recordIDs.indexOf(this.anchorID);var selectedRecordIndex=recordIDs.indexOf(ev.data.resID);var lowerIndex=Math.min(anchorIndex,selectedRecordIndex);var upperIndex=Math.max(anchorIndex,selectedRecordIndex);var shiftSelection=recordIDs.slice(lowerIndex,upperIndex+1);if(ctrl){this.selectedRecordIDs=_.uniq(this.selectedRecordIDs.concat(shiftSelection));}else{this.selectedRecordIDs=shiftSelection;}}else if(ctrl&&this.selectedRecordIDs.length){var oldIds=this.selectedRecordIDs.slice();this.selectedRecordIDs=_.without(this.selectedRecordIDs,ev.data.resID);if(this.selectedRecordIDs.length===oldIds.length){this.selectedRecordIDs.push(ev.data.resID);this.anchorID=ev.data.resID;}}else{this.selectedRecordIDs=[ev.data.resID];this.anchorID=ev.data.resID;}}else if(ev.data.selected){this.selectedRecordIDs.push(ev.data.resID);this.selectedRecordIDs=_.uniq(this.selectedRecordIDs);this.anchorID=ev.data.resID;}else{this.selectedRecordIDs=_.without(this.selectedRecordIDs,ev.data.resID);}
this.trigger_up('selection_changed',{selection:this.selectedRecordIDs,});this.renderer.updateSelection(this.selectedRecordIDs);},_onReplaceFile:function(ev){this._uploadFilesHandler(false)(ev);},_onRequestFile:function(ev){ev.preventDefault();var self=this;var context=this.model.get(this.handle,{raw:true}).getContext();this.do_action('documents.action_request_form',{additional_context:{default_partner_id:context.default_partner_id||false,default_folder_id:this._searchPanel.getSelectedFolderId(),default_tag_ids:[[6,0,this._searchPanel.getSelectedTagIds()]],},on_close:function(){self.reload();},});},_onSaveMulti:function(ev){ev.stopPropagation();var callback=ev.data.callback||function(){};this.model.saveMulti(ev.data.dataPointIDs,ev.data.changes,this.handle).then(this.reload.bind(this,{})).then(callback).guardedCatch(callback);},_onSelectionChanged:function(ev){ev.stopPropagation();var self=this;this.selectedRecordIDs=ev.data.selection;var state=this.model.get(this.handle);this._updateChatter(state).then(function(){self._renderDocumentsInspector(state);});},_onSetFocusTagInput:function(){this._focusTagInput=true;},_onShareDomain:function(){var state=this.model.get(this.handle,{raw:true});this._share({domain:state.domain,folder_id:this._searchPanel.getSelectedFolderId(),tag_ids:[[6,0,this._searchPanel.getSelectedTagIds()]],type:'domain',});},_onShareIDs:function(ev){ev.stopPropagation();this._share({document_ids:[[6,0,ev.data.resIDs]],folder_id:this._searchPanel.getSelectedFolderId(),type:'ids',});},_onToggleFavorite:function(ev){ev.stopPropagation();var self=this;self._rpc({model:'documents.document',method:'toggle_favorited',args:[ev.data.resID],}).then(function(){self.reload();});},_onTriggerRule:function(ev){ev.stopPropagation();var recordIDs=_.pluck(ev.data.records,'res_id');return this._triggerRule(recordIDs,ev.data.ruleID,this.handle);},_onUpload:function(ev){this._uploadFilesHandler(true)(ev);},_onUploadFromUrl:function(ev){ev.preventDefault();var self=this;var context=this.model.get(this.handle,{raw:true}).getContext();this.do_action('documents.action_url_form',{additional_context:{default_partner_id:context.default_partner_id||false,default_folder_id:this._searchPanel.getSelectedFolderId(),default_tag_ids:[[6,0,this._searchPanel.getSelectedTagIds()]],},on_close:function(){self.reload();},});},});return DocumentsKanbanController;});;

/* /documents/static/src/js/documents_kanban_controller_mobile.js defined in bundle 'web.assets_backend' */
odoo.define('documents.DocumentsKanbanControllerMobile',function(require){"use strict";var config=require('web.config');if(!config.device.isMobile){return;}
var core=require('web.core');var DocumentsKanbanController=require('documents.DocumentsKanbanController');var qweb=core.qweb;DocumentsKanbanController.include({renderButtons:function(){this._super.apply(this,arguments);var $buttons=this.$buttons.find('button');var $dropdownButton=$(qweb.render('documents.ControlPanelButtonsMobile'));$buttons.addClass('dropdown-item').appendTo($dropdownButton.find('.dropdown-menu'));$dropdownButton.replaceAll(this.$buttons);this.$buttons=$dropdownButton;},_onRecordSelected:function(ev){if(!ev.data.clear||this.selectedRecordIDs.length!==1||this.selectedRecordIDs[0]!==ev.data.resID){this._super.apply(this,arguments);}
if(ev.data.clear&&this.selectedRecordIDs.length===1){this.documentsInspector.open();}},});});;

/* /documents/static/src/js/documents_kanban_model.js defined in bundle 'web.assets_backend' */
odoo.define('documents.DocumentsKanbanModel',function(require){"use strict";var KanbanModel=require('web.KanbanModel');var DocumentsKanbanModel=KanbanModel.extend({fetchActivities:function(recordID){var record=this.localData[recordID];return this._fetchSpecialActivity(record,'activity_ids').then(function(data){record.specialData.activity_ids=data;});},get:function(dataPointID){var result=this._super.apply(this,arguments);if(result&&result.type==='list'){var dataPoint=this.localData[dataPointID];result.size=dataPoint.size;}
return result;},load:function(params){var self=this;var def=this._super.apply(this,arguments);return self._fetchAdditionalData(def,params).then(function(dataPointID){var dataPoint=self.localData[dataPointID];dataPoint.isRootDataPoint=true;return dataPointID;});},reload:function(id,options){var element=this.localData[id];var def=this._super.apply(this,arguments);if(element.isRootDataPoint){return this._fetchAdditionalData(def,options);}else{return def;}},saveMulti:function(recordIDs,values,parentID){return this.mutex.exec(this._saveMulti.bind(this,recordIDs,values,parentID));},_fetchAdditionalData:function(def,params){var self=this;var defs=[def];defs.push(this._fetchSize(params));return Promise.all(defs).then(function(results){var dataPointID=results[0];var size=results[1];var dataPoint=self.localData[dataPointID];dataPoint.size=size;return dataPointID;});},_fetchSize:function(params){params=params||{};return this._rpc({model:'documents.document',method:'read_group',domain:params.domain||[],fields:['file_size'],groupBy:[],}).then(function(result){var size=result[0].file_size/(1000*1000);return Math.round(size*100)/100;});},_saveMulti:function(recordIDs,values,parentID){var self=this;var parent=this.localData[parentID];var resIDs=_.map(recordIDs,function(recordID){return self.localData[recordID].res_id;});var changes=_.mapObject(values,function(value,fieldName){var field=parent.fields[fieldName];if(field.type==='many2one'){value=value.id||false;}else if(field.type==='many2many'){var command=value.operation==='FORGET'?3:4;value=_.map(value.resIDs,function(resID){return[command,resID];});}
return value;});return this._rpc({model:parent.model,method:'write',args:[resIDs,changes],});},});return DocumentsKanbanModel;});;

/* /documents/static/src/js/documents_kanban_record.js defined in bundle 'web.assets_backend' */
odoo.define('documents.DocumentsKanbanRecord',function(require){"use strict";var KanbanRecord=require('web.KanbanRecord');var DocumentsKanbanRecord=KanbanRecord.extend({events:_.extend({},KanbanRecord.prototype.events,{'click':'_onSelectRecord','click .o_record_selector':'_onAddRecordToSelection','click .oe_kanban_previewer':'_onImageClicked','click .o_request_image':'_onRequestImage',}),getResID:function(){return this.id;},update:function(){var self=this;var isSelected=this.$el.hasClass('o_record_selected');return this._super.apply(this,arguments).then(function(){if(isSelected){self.$el.addClass('o_record_selected');}});},updateSelection:function(selected){this.$el.toggleClass('o_record_selected',selected);},_toggleSelect:function(clear,ev){this.trigger_up('select_record',{clear:clear,originalEvent:ev,resID:this.getResID(),selected:!this.$el.hasClass('o_record_selected'),});},_onAddRecordToSelection:function(ev){ev.preventDefault();ev.stopPropagation();this._toggleSelect(false,ev);},_onImageClicked:function(ev){ev.preventDefault();ev.stopPropagation();this.trigger_up('kanban_image_clicked',{recordList:[this.recordData],recordID:this.recordData.id});},_onKeyDownOpenFirstLink:function(ev){switch(ev.keyCode){case $.ui.keyCode.ENTER:this._toggleSelect(true,ev);break;}},_onRequestImage:function(ev){ev.preventDefault();ev.stopPropagation();this.trigger_up('replace_file',{id:this.id});},_onSelectRecord:function(ev){ev.preventDefault();if(!$(ev.target).hasClass('oe_kanban_action')){this._toggleSelect(true,ev);}},});return DocumentsKanbanRecord;});;

/* /documents/static/src/js/documents_kanban_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('documents.DocumentsKanbanRenderer',function(require){"use strict";var DocumentsKanbanRecord=require('documents.DocumentsKanbanRecord');var KanbanRenderer=require('web.KanbanRenderer');var DocumentsKanbanRenderer=KanbanRenderer.extend({config:_.extend({},KanbanRenderer.prototype.config,{KanbanRecord:DocumentsKanbanRecord,}),start:function(){this.$el.addClass('o_documents_kanban_view position-relative align-content-start flex-grow-1 flex-shrink-1');return this._super.apply(this,arguments);},updateSelection:function(selectedRecordIDs){_.each(this.widgets,function(widget){var selected=_.contains(selectedRecordIDs,widget.getResID());widget.updateSelection(selected);});},});return DocumentsKanbanRenderer;});;

/* /documents/static/src/js/documents_kanban_view.js defined in bundle 'web.assets_backend' */
odoo.define('documents.DocumentsKanbanView',function(require){"use strict";var DocumentsKanbanController=require('documents.DocumentsKanbanController');var DocumentsKanbanModel=require('documents.DocumentsKanbanModel');var DocumentsKanbanRenderer=require('documents.DocumentsKanbanRenderer');var DocumentsSearchPanel=require('documents.DocumentsSearchPanel');var core=require('web.core');var KanbanView=require('web.KanbanView');var view_registry=require('web.view_registry');var _lt=core._lt;var DocumentsKanbanView=KanbanView.extend({config:_.extend({},KanbanView.prototype.config,{Controller:DocumentsKanbanController,Model:DocumentsKanbanModel,Renderer:DocumentsKanbanRenderer,SearchPanel:DocumentsSearchPanel,}),display_name:_lt('Attachments Kanban'),searchMenuTypes:['filter','favorite'],init:function(){this._super.apply(this,arguments);this.withSearchPanel=true;this.rendererParams.withSearchPanel=true;var inspectorFields=['active','activity_ids','available_rule_ids','checksum','display_name','folder_id','lock_uid','message_attachment_count','message_follower_ids','message_ids','mimetype','name','owner_id','partner_id','res_id','res_model','res_model_name','res_name','share_ids','tag_ids','type','url',];_.defaults(this.fieldsInfo[this.viewType],_.pick(this.fields,inspectorFields));this.fieldsInfo[this.viewType].available_rule_ids=_.extend({},{fieldsInfo:{default:{display_name:{},note:{},limited_to_single_record:{},},},relatedFields:{display_name:{type:'string'},note:{type:'string'},limited_to_single_record:{type:'boolean'},},viewType:'default',},this.fieldsInfo[this.viewType].available_rule_ids);},});view_registry.add('documents_kanban',DocumentsKanbanView);return DocumentsKanbanView;});;

/* /documents/static/src/js/documents_progress_card.js defined in bundle 'web.assets_backend' */
odoo.define('documents.ProgressCard',function(require){"use strict";const core=require('web.core');const Widget=require('web.Widget');const _t=core._t;const ProgressCard=Widget.extend({template:'documents.ProgressCard',init(parent,params){this._super.apply(this,arguments);this.title=params.title;this.type=params.type;},update(loaded,total){if(!this.$el){return;}
const percent=Math.round((loaded/total)*100);const $textDivLeft=this.$('.o_documents_progress_text_left');const $textDivRight=this.$('.o_documents_progress_text_right');if(percent===100){$textDivLeft.text(_t('Processing...'));}else{const mbLoaded=Math.round(loaded/1000000);const mbTotal=Math.round(total/1000000);$textDivLeft.text(_.str.sprintf(_t("Uploading... (%s%%)"),percent));$textDivRight.text(_.str.sprintf(_t("(%s/%sMb)"),mbLoaded,mbTotal));}},});return ProgressCard;});;

/* /documents/static/src/js/documents_progress_bar.js defined in bundle 'web.assets_backend' */
odoo.define('documents.ProgressBar',function(require){"use strict";const Dialog=require('web.Dialog');const core=require('web.core');const Widget=require('web.Widget');const _t=core._t;const ProgressBar=Widget.extend({template:'documents.ProgressBar',events:{'click .o_upload_cross':'_onCrossClick',},init(parent,params){this._super.apply(this,arguments);this.title=params.title;this.uploadID=params.uploadID;this.xhr=params.xhr;},start(){this.xhr.onabort=()=>{this.do_notify(_t("Upload cancelled"));};return this._super.apply(this,arguments);},update(loaded,total){if(!this.$el){return;}
const percent=Math.round((loaded/total)*100);this.$('.o_documents_progress_bar').css("width",percent+"%");},_onCrossClick(ev){ev.stopPropagation();const promptText=_.str.sprintf(_t("Do you really want to cancel the upload of %s?"),_.escape(this.title));Dialog.confirm(this,promptText,{confirm_callback:()=>{this.xhr.abort();this.trigger_up('progress_bar_abort',{uploadID:this.uploadID});}});},});return ProgressBar;});;

/* /documents/static/src/js/documents_search_panel.js defined in bundle 'web.assets_backend' */
odoo.define('documents.DocumentsSearchPanel',function(require){"use strict";const core=require('web.core');const SearchPanel=require('web.SearchPanel');const _t=core._t;const DocumentsSearchPanel=SearchPanel.extend({events:Object.assign({},SearchPanel.prototype.events,{'dragenter .o_search_panel_category_value, .o_search_panel_filter_value':'_onDragEnter','dragleave .o_search_panel_category_value, .o_search_panel_filter_value':'_onDragLeave','dragover .o_search_panel_category_value, .o_search_panel_filter_value':'_onDragOver','drop .o_search_panel_category_value, .o_search_panel_filter_value':'_onRecordDrop',}),init:function(){this._super.apply(this,arguments);this.uploadingFolderIDs=[];},getFolders:function(){var category=_.findWhere(this.categories,{fieldName:'folder_id'});return Object.keys(category.values).map(function(folderId){return category.values[folderId];});},getSelectedFolderId:function(){var category=_.findWhere(this.categories,{fieldName:'folder_id'});return category.activeValueId;},getSelectedTagIds:function(){var filter=_.findWhere(this.filters,{fieldName:'tag_ids'});return Object.keys(filter.values).filter(function(tagId){return filter.values[tagId].checked;});},getTags:function(){var filter=_.findWhere(this.filters,{fieldName:'tag_ids'});return Object.keys(filter.values).map(tagId=>filter.values[tagId]).sort((a,b)=>{if(a.group_sequence===b.group_sequence){return a.sequence-b.sequence;}else{return a.group_sequence-b.group_sequence;}});},setUploadingFolderIDs:function(uploadingFolderIDs){this.uploadingFolderIDs=uploadingFolderIDs;this._render();},_renderLoadingSpinners:function(){const $folderSection=this.$('[data-field-name="folder_id"]');$folderSection.find('.o_search_panel_spinner').remove();$folderSection.find('.o_search_panel_category_value').each((i,el)=>{if(this.uploadingFolderIDs.includes(+el.getAttribute("data-id"))){const $spinner=$('<span>',{class:'fa fa-spinner fa-spin o_search_panel_spinner',});$spinner.appendTo($(el).find('> header > label'));}});},_getCategoryDefaultValue:function(category,validValues){var value=this._super.apply(this,arguments);return _.contains(validValues,value)?value:validValues[0];},_isValidDropZone($target){const fieldName=$target.closest('.o_search_panel_field').data('field-name');const hasRightFieldName=['folder_id','tag_ids'].includes(fieldName);const hasID=$target.data('id')||$target.data('value-id');return hasRightFieldName&&hasID;},_render:function(){this._super.apply(this,arguments);this._renderLoadingSpinners();},_onDragEnter(ev){if(!this._isValidDropZone($(ev.currentTarget))||!ev.originalEvent.dataTransfer.types.includes('o_documents_data')){return;}
ev.stopPropagation();ev.preventDefault();const $item=$(ev.currentTarget).closest('.o_search_panel_category_value');const category=this.categories[$item.data('categoryId')];const valueId=$item.data('id');if(category&&category.values[valueId].folded){category.values[valueId].folded=false;this._render();}
this.$('.o_drag_over_selector').removeClass('o_drag_over_selector');$(ev.currentTarget).addClass('o_drag_over_selector');},_onDragLeave(ev){const target=document.elementFromPoint(ev.originalEvent.clientX,ev.originalEvent.clientY);if(!this._isValidDropZone($(ev.currentTarget))||$.contains(ev.currentTarget,target)||!ev.originalEvent.dataTransfer.types.includes('o_documents_data')){return;}
ev.stopPropagation();ev.preventDefault();this.$('.o_drag_over_selector').removeClass('o_drag_over_selector');},_onDragOver(ev){if(this._isValidDropZone($(ev.currentTarget))&&ev.originalEvent.dataTransfer.types.includes('o_documents_data')){ev.preventDefault();}},_onRecordDrop:function(ev){ev.stopPropagation();ev.preventDefault();var $item=$(ev.currentTarget);$item.removeClass('o_drag_over_selector');const fieldName=$item.closest('.o_search_panel_field').data('field-name');const panelRecordID=$item.data('id')||$item.data('value-id');const dataTransfer=ev.originalEvent.dataTransfer;if(!this._isValidDropZone($item)||!panelRecordID||!dataTransfer||!dataTransfer.types.includes('o_documents_data')||$item.find('> .active').length){return;}
const data=JSON.parse(dataTransfer.getData("o_documents_data"));if(data.lockedCount){this.do_notify("Partial transfer",_.str.sprintf(_t('%s file(s) not moved because they are locked by another user'),data.lockedCount));}
const vals=fieldName==='tag_ids'?{tag_ids:[[4,panelRecordID]]}:{folder_id:panelRecordID};this._rpc({model:'documents.document',method:'write',args:[data.recordIDs,vals],}).then(()=>this._notifyDomainUpdated());},});return DocumentsSearchPanel;});;

/* /documents/static/src/js/documents_inspector.js defined in bundle 'web.assets_backend' */
odoo.define('documents.DocumentsInspector',function(require){"use strict";var core=require('web.core');var fieldRegistry=require('web.field_registry');var session=require('web.session');var dialogs=require('web.view_dialogs');var Widget=require('web.Widget');var _t=core._t;var qweb=core.qweb;var TAGS_SEARCH_LIMIT=8;var DocumentsInspector=Widget.extend({template:'documents.DocumentsInspector',custom_events:{field_changed:'_onFieldChanged',},events:{'click .o_inspector_archive':'_onArchive','click .o_inspector_delete':'_onDelete','click .o_inspector_download':'_onDownload','click .o_inspector_replace':'_onReplace','click .o_inspector_lock':'_onLock','click .o_inspector_share':'_onShare','click .o_inspector_open_chatter':'_onOpenChatter','click .o_inspector_tag_add':'_onTagInputClicked','click .o_inspector_tag_remove':'_onRemoveTag','click .o_inspector_trigger_rule':'_onTriggerRule','click .o_inspector_object_name':'_onOpenResource','click .o_preview_available':'_onOpenPreview','click .o_document_pdf':'_onOpenPDF','mouseover .o_inspector_trigger_hover':'_onMouseoverRule','mouseout .o_inspector_trigger_hover':'_onMouseoutRule',},init:function(parent,params){var self=this;this._super.apply(this,arguments);this.nbDocuments=params.state.count;this.size=params.state.size;this.focusTagInput=params.focusTagInput;this.currentFolder=_.findWhere(params.folders,{id:params.folderId});this.recordsData={};this.records=[];for(const resID of params.recordIDs){var record=_.findWhere(params.state.data,{res_id:resID});if(record){let youtubeToken;let youtubeUrlMatch;if(record.data.url&&record.data.url.length){youtubeUrlMatch=record.data.url.match('youtu(?:\.be|be\.com)/(?:.*v(?:/|=)|(?:.*/)?)([a-zA-Z0-9-_]{11})');}
if(youtubeUrlMatch&&youtubeUrlMatch.length>1){youtubeToken=youtubeUrlMatch[1];}
this.recordsData[record.id]={isGif:new RegExp('image.*(gif)').test(record.data.mimetype),isImage:new RegExp('image.*(jpeg|jpg|png)').test(record.data.mimetype),isYouTubeVideo:!!youtubeToken,youtubeToken,};this.records.push(record);}}
this.tags=params.tags;var tagIDsByRecord=_.map(this.records,function(record){return record.data.tag_ids.res_ids;});this.commonTagIDs=_.intersection.apply(_,tagIDsByRecord);var ruleIDsByRecord=_.map(this.records,function(record){return record.data.available_rule_ids.res_ids;});var commonRuleIDs=_.intersection.apply(_,ruleIDsByRecord);var record=this.records[0];this.rules=_.map(commonRuleIDs,function(ruleID){var rule=_.findWhere(record.data.available_rule_ids.data,{res_id:ruleID,});return rule.data;});this.pendingSavingRequests=0;this._isLocked=this.records.some(record=>record.data.lock_uid&&record.data.lock_uid.res_id!==session.uid);},async start(){this._renderTags();this._renderRules();this._renderModel();this._updateButtons();await Promise.all([this._renderFields(),this._super.apply(this,arguments)]);this.$('.o_inspector_table .o_input').prop('disabled',this._isLocked);},getLocalState:function(){return{scrollTop:this.el.scrollTop,};},setLocalState:function(state){this.el.scrollTop=state.scrollTop;},_generateCommonRecord:function(fieldName){var record=_.extend({},this.records[0],{id:null,res_id:null,});record.data=_.extend({},record.data);record.data[fieldName]={data:{display_name:_t('Multiple values'),id:null,},};return record;},_renderField:function(fieldName,options){options=options||{};var values=_.uniq(_.map(this.records,function(record){return record.data[fieldName]&&record.data[fieldName].res_id;}));var record;if(values.length>1){record=this._generateCommonRecord(fieldName);}else{record=this.records[0];}
var $row=$(qweb.render('documents.DocumentsInspector.infoRow'));var $label=$(qweb.render('documents.DocumentsInspector.fieldLabel',{icon:options.icon,label:options.label||record.fields[fieldName].string,name:fieldName,}));$label.appendTo($row.find('.o_inspector_label'));var type=record.fields[fieldName].type;var FieldWidget=fieldRegistry.get(type);options=_.extend({},options,{noOpen:true,viewType:'kanban',});var fieldWidget=new FieldWidget(this,fieldName,record,options);const prom=fieldWidget.appendTo($row.find('.o_inspector_value')).then(function(){fieldWidget.getFocusableElement().attr('id',fieldName);if(type==='many2one'&&values.length>1){fieldWidget.$el.addClass('o_multiple_values');}});$row.insertBefore(this.$('.o_inspector_fields tbody tr.o_inspector_divider'));return prom;},_renderFields:function(){var options={mode:'edit'};var proms=[];if(this.records.length===1){proms.push(this._renderField('name',options));if(this.records[0].data.type==='url'){proms.push(this._renderField('url',options));}
proms.push(this._renderField('partner_id',options));}
if(this.records.length>0){proms.push(this._renderField('owner_id',options));proms.push(this._renderField('folder_id',{icon:'fa fa-folder o_documents_folder_color',mode:'edit',}));}
return Promise.all(proms);},_renderModel:function(){if(this.records.length!==1){return;}
var resModelName=this.records[0].data.res_model_name;if(!resModelName||this.records[0].data.res_model==='documents.document'){return;}
var $modelContainer=this.$('.o_model_container');var options={res_model:resModelName,res_name:this.records[0].data.res_name,};$modelContainer.append(qweb.render('documents.DocumentsInspector.resModel',options));},_renderRules:function(){if(!this.currentFolder||this._isLocked){return;}
var self=this;_.each(this.rules,function(rule){if(self.records.length===1||!rule.limited_to_single_record){var $rule=$(qweb.render('documents.DocumentsInspector.rule',rule));$rule.appendTo(self.$('.o_inspector_rules'));}});},_renderTags:function(){var $tags=this.$('.o_inspector_tags');const commonTags=this.tags.filter(tag=>this.commonTagIDs.includes(tag.id));for(const tag of commonTags){if(tag){var $tag=$(qweb.render('documents.DocumentsInspector.tag',tag));$tag.appendTo(this.$('.o_inspector_tags'));}};if(this.tags.length>this.commonTagIDs.length){this.$tagInput=$('<input>',{class:'o_input o_inspector_tag_add',type:'text',}).attr('placeholder',_t("+ Add a tag "));this.$tagInput.autocomplete({delay:0,minLength:0,autoFocus:true,select:(event,ui)=>{this.trigger_up('set_focus_tag_input');const currentId=ui.item.id;if(ui.item.special){if(ui.item.special==='more'){this._searchMore(this._lastSearchVal);}}else if(currentId){this._saveMulti({tag_ids:{operation:'ADD_M2M',resIDs:[currentId],},});}},source:(req,resp)=>{resp(this._search(req.term));this._lastSearchVal=req.term;},});var disabled=this._isLocked||(this.records.length===1&&!this.records[0].data.active);$tags.closest('.o_inspector_custom_field').toggleClass('o_disabled',disabled);this.$tagInput.appendTo($tags);if(this.focusTagInput){this.$tagInput.focus();}}},_saveMulti:function(changes){var self=this;this.pendingSavingRequests++;this.trigger_up('save_multi',{changes:changes,dataPointIDs:_.pluck(this.records,'id'),callback:function(){self.pendingSavingRequests--;},});},_search:function(value){var self=this;var tags=[];_.each(this.tags,function(tag){if(!_.contains(self.commonTagIDs,tag.id)){tags.push({id:tag.id,label:tag.group_name+' > '+tag.name,});}});const lowerValue=value.toLowerCase();const allSearchResults=tags.filter(tag=>tag.label.toLowerCase().includes(lowerValue));const searchResults=allSearchResults.slice(0,TAGS_SEARCH_LIMIT);if(allSearchResults.length>TAGS_SEARCH_LIMIT){searchResults.push({label:_t("Search more..."),special:'more',classname:'o_m2o_dropdown_option',});}
return searchResults;},_searchCreatePopup(dynamicFilters=[]){this.$('.o_inspector_tag_add').val('');return new dialogs.SelectCreateDialog(this,{domain:[['folder_id','=',this.currentFolder.id]],dynamicFilters:dynamicFilters||[],no_create:true,on_selected:records=>this._saveMulti({tag_ids:{operation:'ADD_M2M',resIDs:records.map(record=>record.id),},}),res_model:'documents.tag',title:_t('Select tags'),}).open();},async _searchMore(value){let results;if(value){results=await this._rpc({model:'documents.tag',method:'search_read',fields:['id'],domain:['&','&',['id','not in',this.commonTagIDs],['folder_id','=',this.currentFolder.id],'|',['facet_id.name','ilike',value],['name','ilike',value]],});}
let dynamicFilters;if(results){const ids=results.map(result=>result.id);dynamicFilters=[{description:_.str.sprintf(_t('Name or Category contains: %s'),value),domain:[['id','in',ids]],}];}
await this._searchCreatePopup(dynamicFilters);},_updateButtons:function(){var binary=_.some(this.records,function(record){return record.data.type==='binary';});if(this._isLocked){this.$('.o_inspector_replace').prop('disabled',true);this.$('.o_inspector_delete').prop('disabled',true);this.$('.o_inspector_archive').prop('disabled',true);this.$('.o_inspector_table .o_field_widget').prop('disabled',true);}
if(!binary&&(this.records.length>1||(this.records.length&&this.records[0].data.type==='empty'))){this.$('.o_inspector_download').prop('disabled',true);}},_onArchive:function(){this.trigger_up('archive_records',{records:this.records,});},_onDelete:function(){this.trigger_up('delete_records',{records:this.records,});},_onDownload:function(){this.trigger_up('download',{resIDs:_.pluck(this.records,'res_id'),});},_onFieldChanged:function(ev){ev.stopPropagation();this._saveMulti(ev.data.changes);},_onLock:function(){this.trigger_up('lock_attachment',{resID:this.records[0].res_id,});},_onMouseoverRule:function(ev){$(ev.currentTarget).closest('.o_inspector_trigger_hover_target').addClass('o_inspector_hover');},_onMouseoutRule:function(ev){$(ev.currentTarget).closest('.o_inspector_trigger_hover_target').removeClass('o_inspector_hover');},_onOpenChatter:function(){this.trigger_up('open_chatter',{id:this.records[0].data.id,});},_onOpenPreview:function(ev){ev.preventDefault();ev.stopPropagation();if(this.pendingSavingRequests>0)
return;var activeID=$(ev.currentTarget).data('id');if(activeID){var records=_.pluck(this.records,'data');this.trigger_up('kanban_image_clicked',{recordID:activeID,recordList:records});}},_onOpenResource:function(){var record=this.records[0];this.trigger_up('open_record',{resID:record.data.res_id,resModel:record.data.res_model,});},_onRemoveTag:function(ev){ev.stopPropagation();var tagID=$(ev.currentTarget).closest('.o_inspector_tag').data('id');var changes={tag_ids:{operation:'FORGET',resIDs:[tagID],},};this._saveMulti(changes);},_onReplace:function(){this.trigger_up('replace_file',{id:this.records[0].data.id,});},_onShare:function(){this.trigger_up('share',{resIDs:_.pluck(this.records,'res_id'),});},_onTagInputClicked:function(){if(this.$tagInput.autocomplete("widget").is(":visible")){this.$tagInput.autocomplete("close");}else{this.$tagInput.autocomplete('search');}},_onTriggerRule:function(ev){var $btn=$(ev.currentTarget);var ruleID=$btn.closest('.o_inspector_rule').data('id');$btn.prop('disabled',true);this.trigger_up('trigger_rule',{records:this.records,ruleID:ruleID});},});return DocumentsInspector;});;

/* /documents/static/src/js/documents_inspector_mobile.js defined in bundle 'web.assets_backend' */
odoo.define('documents.DocumentsInspectorMobile',function(require){"use strict";var config=require('web.config');if(!config.device.isMobile){return;}
var DocumentsInspector=require('documents.DocumentsInspector');DocumentsInspector.include({template:'documents.DocumentsInspectorMobile',getLocalState:function(){return _.extend({},this._super.apply(this,arguments),{open:this.el.getAttribute('open')==='',});},setLocalState:function(state){this._super.apply(this,arguments);if(state.open){this.open();}},open:function(){this.el.setAttribute('open','');},});});;

/* /documents/static/src/js/systray_activity_menu.js defined in bundle 'web.assets_backend' */
odoo.define('documents.systray.ActivityMenu',function(require){"use strict";var ActivityMenu=require('mail.systray.ActivityMenu');const session=require('web.session');ActivityMenu.include({events:_.extend({},ActivityMenu.prototype.events,{'click .o_sys_documents_request':'_onRequestDocument',}),async willStart(){await this._super(...arguments);this.hasDocumentUserGroup=await session.user_has_group('documents.group_documents_user');},_onRequestDocument:function(ev){ev.preventDefault();ev.stopPropagation();this.$('.dropdown-toggle').dropdown('toggle');this.do_action('documents.action_request_form');},});});;

/* /documents/static/src/js/tours/documents.js defined in bundle 'web.assets_backend' */
odoo.define('documents.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('documents_tour',{url:"/web",},[{trigger:'.o_app[data-menu-xmlid="documents.menu_root"]',content:_t("Want to become a <b>paperless company</b>? Let's discover Odoo DMS."),position:'bottom',},{trigger:'.o_search_panel_category_value[data-id="1"] .o_search_panel_label',content:_t("Select the Internal workspace."),position:'bottom',},{trigger:'.o_kanban_record:contains(Video: Odoo Documents)',content:_t("Click on a card to <b>view the document</b>."),position:'bottom',},{trigger:'.o_preview_available',content:_t("Go to the <b>images, videos & PDF viewer</b> by clicking on the preview area."),position:'bottom',},{trigger:'.o_close_btn',extra_trigger:'.o_documents_kanban',content:_t("<b>Close the preview</b> to go back to your selection of documents"),position:'left',},{trigger:'.o_inspector_open_chatter',content:_t("This icon gets you to the <b>discussion board</b>, to chat with followers of this document"),position:'left',},{trigger:'.o_chatter_button_new_message',extra_trigger:'.o_mail_thread_content',content:_t("Try to <b>post a message</b>"),position:'bottom',},{trigger:'.o_composer_button_send',extra_trigger:'.o_documents_kanban',content:_t("It will be sent to the followers of this document"),position:'bottom',},{trigger:'.o_document_close_chatter',extra_trigger:'.o_documents_kanban',content:_t("Click here to <b>close the discussion board</b>"),position:'bottom',},{trigger:'.o_inspector_trigger_rule',extra_trigger:'.o_documents_kanban',content:_t("<b>Actions</b> allows you to assign tags, automate actions like creating a task or vendor bill,</br> create activities for users, etc.</br> Actions can be customized through the Configuration menu."),position:'left',},{trigger:'.o_search_panel_category_value[data-id="2"] .o_search_panel_label',extra_trigger:'.o_documents_kanban',content:_t("Use <b>workspaces</b> to organize documents by departments, or group of interests"),position:'right',},{trigger:'.o_search_panel_filter_value[data-value-id="13"] .o_search_panel_label_title',extra_trigger:'.o_documents_kanban',content:_t("<b>Use tags</b> to easily filter documents. Tags are defined according to the workspace."),position:'right',},{trigger:'.o_documents_kanban_upload',content:_t("When you <b>upload documents</b>, they appear in the selected workspace and tags."),position:'bottom',},{trigger:'.o_kanban_record:nth(0)',content:_t("Select a record."),position:'bottom',},{trigger:'.o_inspector_archive',extra_trigger:'.o_documents_kanban',content:_t("To delete files, archive them first. </br>Archived documents can still be accessed using the Archive option in the Filters top menu."),position:'left',}]);});;

/* /account/static/src/js/reconciliation/reconciliation_action.js defined in bundle 'web.assets_backend' */
odoo.define('account.ReconciliationClientAction',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var ReconciliationModel=require('account.ReconciliationModel');var ReconciliationRenderer=require('account.ReconciliationRenderer');var core=require('web.core');var QWeb=core.qweb;var StatementAction=AbstractAction.extend({hasControlPanel:true,withSearchBar:true,loadControlPanel:true,title:core._t('Bank Reconciliation'),contentTemplate:'reconciliation',custom_events:{change_mode:'_onAction',change_filter:'_onAction',change_offset:'_onAction',change_partner:'_onAction',add_proposition:'_onAction',remove_proposition:'_onAction',update_proposition:'_onAction',create_proposition:'_onAction',getPartialAmount:'_onActionPartialAmount',quick_create_proposition:'_onAction',partial_reconcile:'_onAction',validate:'_onValidate',close_statement:'_onCloseStatement',load_more:'_onLoadMore',reload:'reload',search:'_onSearch',navigation_move:'_onNavigationMove',},config:_.extend({},AbstractAction.prototype.config,{Model:ReconciliationModel.StatementModel,ActionRenderer:ReconciliationRenderer.StatementRenderer,LineRenderer:ReconciliationRenderer.LineRenderer,params:['statement_line_ids'],defaultDisplayQty:10,limitMoveLines:15,}),_onNavigationMove:function(ev){var non_reconciled_keys=_.keys(_.pick(this.model.lines,function(value,key,object){return!value.reconciled}));var currentIndex=_.indexOf(non_reconciled_keys,ev.data.handle);var widget=false;switch(ev.data.direction){case'up':ev.stopPropagation();widget=this._getWidget(non_reconciled_keys[currentIndex-1]);break;case'down':ev.stopPropagation();widget=this._getWidget(non_reconciled_keys[currentIndex+1]);break;case'validate':ev.stopPropagation();widget=this._getWidget(non_reconciled_keys[currentIndex]);widget.$('caption .o_buttons button:visible').click();break;}
if(widget)widget.$el.focus();},init:function(parent,params){this._super.apply(this,arguments);this.action_manager=parent;this.params=params;this.controlPanelParams.modelName='account.bank.statement.line';this.model=new this.config.Model(this,{modelName:"account.reconciliation.widget",defaultDisplayQty:params.params&&params.params.defaultDisplayQty||this.config.defaultDisplayQty,limitMoveLines:params.params&&params.params.limitMoveLines||this.config.limitMoveLines,});this.widgets=[];_.each(params.params,function(value,name){params.context[name]=name.indexOf('_ids')!==-1?_.map((value+'').split(','),parseFloat):value;});params.params={};_.each(this.config.params,function(name){if(params.context[name]){params.params[name]=params.context[name];}});},willStart:function(){var self=this;var def=this.model.load(this.params.context).then(this._super.bind(this));return def.then(function(){if(!self.model.context||!self.model.context.active_id){self.model.context={'active_id':self.params.context.active_id,'active_model':self.params.context.active_model};}
var journal_id=self.params.context.journal_id;if(!journal_id&&self.model.context.active_model==='account.journal'){if(self.model.context.active_ids&&self.model.context.active_ids.length){journal_id=self.model.context.active_ids[0];}else if(self.model.context.active_id){journal_id=self.model.context.active_id;}}
if(journal_id){var promise=self._rpc({model:'account.journal',method:'read',args:[journal_id,['display_name']],});}else{var promise=Promise.resolve();}
return promise.then(function(result){var title=result&&result[0]?result[0]['display_name']:self.params.display_name||''
self._setTitle(title);self.renderer=new self.config.ActionRenderer(self,self.model,{'bank_statement_id':self.model.bank_statement_id,'valuenow':self.model.valuenow,'valuemax':self.model.valuemax,'defaultDisplayQty':self.model.defaultDisplayQty,'title':title,});});});},reload:function(){var self=this;self.$('.o_reconciliation_lines').addClass('d-none');_.each(this.widgets,function(widget){widget.destroy();});this.widgets=[];self.$('.o_reconciliation_lines').removeClass('d-none');return this.model.reload().then(function(){return self._renderLinesOrRainbow();});},_renderLinesOrRainbow:function(){var self=this;return self._renderLines().then(function(){var initialState=self.renderer._initialState;var valuenow=self.model.statement?self.model.statement.value_min:initialState.valuenow;var valuemax=self.model.statement?self.model.statement.value_max:initialState.valuemax;if(valuenow===valuemax){initialState.valuenow=valuenow;initialState.context=self.model.getContext();self.renderer.showRainbowMan(initialState);self.remove_cp();}else{if(initialState.valuenow>0)
self.renderer._renderNotifications(self.model.statement.notifications);self._openFirstLine();self.renderer.$('[data-toggle="tooltip"]').tooltip();self.do_show();}});},start:function(){var self=this;var args=arguments;var sup=this._super;return this.renderer.prependTo(self.$('.o_form_sheet')).then(function(){return self._renderLinesOrRainbow().then(function(){self.do_show();return sup.apply(self,args);});});},do_show:function(){this._super.apply(this,arguments);if(this.action_manager){this.$pager=$(QWeb.render('reconciliation.control.pager',{widget:this.renderer}));this.updateControlPanel({clear:true,cp_content:{$pager:this.$pager,},});this.renderer.$progress=this.$pager;$(this.renderer.$progress).parent().css('width','100%').css('padding-left','0');}},remove_cp:function(){this.updateControlPanel({clear:true,});},_getWidget:function(handle){return _.find(this.widgets,function(widget){return widget.handle===handle;});},_loadMore:function(qty){var self=this;return this.model.loadMore(qty).then(function(){return self._renderLines();});},_openFirstLine:function(previous_handle){var self=this;previous_handle=previous_handle||'rline0';var handle=_.compact(_.map(this.model.lines,function(line,handle){return(line.reconciled||(parseInt(handle.substr(5))<parseInt(previous_handle.substr(5))))?null:handle;}))[0];if(handle){var line=this.model.getLine(handle);this.model.changeMode(handle,'default').then(function(){self._getWidget(handle).update(line);}).guardedCatch(function(){self._getWidget(handle).update(line);}).then(function(){self._getWidget(handle).$el.focus();});}
return handle;},_forceUpdate:function(){var self=this;_.each(this.model.lines,function(handle){var widget=self._getWidget(handle['handle']);if(widget&&handle.need_update){widget.update(handle);widget.need_update=false;}})},_renderLines:function(){var self=this;var linesToDisplay=this.model.getStatementLines();var linePromises=[];_.each(linesToDisplay,function(line,handle){var widget=new self.config.LineRenderer(self,self.model,line);widget.handle=handle;self.widgets.push(widget);linePromises.push(widget.appendTo(self.$('.o_reconciliation_lines')));});if(this.model.hasMoreLines()===false){this.renderer.hideLoadMoreButton(true);}
else{this.renderer.hideLoadMoreButton(false);}
return Promise.all(linePromises);},_onAction:function(event){var self=this;var handle=event.target.handle;var current_line=this.model.getLine(handle);this.model[_.str.camelize(event.name)](handle,event.data.data).then(function(){var widget=self._getWidget(handle);if(widget){widget.update(current_line);}
if(current_line.mode!=='inactive'){_.each(self.model.lines,function(line,_handle){if(line.mode!=='inactive'&&_handle!==handle){self.model.changeMode(_handle,'inactive');var widget=self._getWidget(_handle);if(widget){widget.update(line);}}});}});},_onSearch:function(ev){var self=this;ev.stopPropagation();this.model.domain=ev.data.domain;this.model.display_context='search';self.reload().then(function(){self.renderer._updateProgressBar({'valuenow':self.model.valuenow,'valuemax':self.model.valuemax,});});},_onActionPartialAmount:function(event){var self=this;var handle=event.target.handle;var line=this.model.getLine(handle);var amount=this.model.getPartialReconcileAmount(handle,event.data);self._getWidget(handle).updatePartialAmount(event.data.data,amount);},_onCloseStatement:function(event){var self=this;return this.model.closeStatement().then(function(){self.do_action({name:'Bank Statements',res_model:'account.bank.statement',res_id:self.model.bank_statement_id.id,views:[[false,'form']],type:'ir.actions.act_window',view_mode:'form',});$('.o_reward').remove();});},_onLoadMore:function(event){return this._loadMore(this.model.defaultDisplayQty);},_onValidate:function(event){var self=this;var handle=event.target.handle;this.model.validate(handle).then(function(result){self.renderer.update({'valuenow':self.model.valuenow,'valuemax':self.model.valuemax,'bank_statement_id':self.model.bank_statement_id,'title':self.title,'time':Date.now()-self.time,'notifications':result.notifications,'context':self.model.getContext(),});self._forceUpdate();_.each(result.handles,function(handle){var widget=self._getWidget(handle);if(widget){widget.destroy();var index=_.findIndex(self.widgets,function(widget){return widget.handle===handle;});self.widgets.splice(index,1);}});if(self.widgets.length<self.model.defaultDisplayQty&&self.model.valuemax-self.model.valuenow>=self.model.defaultDisplayQty){var toLoad=self.model.defaultDisplayQty-self.widgets.length;self._loadMore(toLoad);}
self._openFirstLine(handle);});},});var ManualAction=StatementAction.extend({title:core._t('Journal Items to Reconcile'),withSearchBar:false,config:_.extend({},StatementAction.prototype.config,{Model:ReconciliationModel.ManualModel,ActionRenderer:ReconciliationRenderer.ManualRenderer,LineRenderer:ReconciliationRenderer.ManualLineRenderer,params:['company_ids','mode','partner_ids','account_ids'],defaultDisplayQty:30,limitMoveLines:15,}),_onValidate:function(event){var self=this;var handle=event.target.handle;var method='validate';this.model[method](handle).then(function(result){_.each(result.reconciled,function(handle){self._getWidget(handle).destroy();});_.each(result.updated,function(handle){self._getWidget(handle).update(self.model.getLine(handle));});self.renderer.update({valuenow:_.compact(_.invoke(self.widgets,'isDestroyed')).length,valuemax:self.widgets.length,title:self.title,time:Date.now()-self.time,});if(!_.any(result.updated,function(handle){return self.model.getLine(handle).mode!=='inactive';})){self._openFirstLine(handle);}});},});core.action_registry.add('bank_statement_reconciliation_view',StatementAction);core.action_registry.add('manual_reconciliation_view',ManualAction);return{StatementAction:StatementAction,ManualAction:ManualAction,};});;

/* /account/static/src/js/reconciliation/reconciliation_model.js defined in bundle 'web.assets_backend' */
odoo.define('account.ReconciliationModel',function(require){"use strict";var BasicModel=require('web.BasicModel');var field_utils=require('web.field_utils');var utils=require('web.utils');var session=require('web.session');var WarningDialog=require('web.CrashManager').WarningDialog;var core=require('web.core');var _t=core._t;var StatementModel=BasicModel.extend({avoidCreate:false,quickCreateFields:['account_id','amount','analytic_account_id','label','tax_ids','force_tax_included','analytic_tag_ids','to_check'],modes:['create','match_rp','match_other'],init:function(parent,options){this._super.apply(this,arguments);this.reconcileModels=[];this.lines={};this.valuenow=0;this.valuemax=0;this.alreadyDisplayed=[];this.domain=[];this.defaultDisplayQty=options&&options.defaultDisplayQty||10;this.limitMoveLines=options&&options.limitMoveLines||15;this.display_context='init';},addProposition:function(handle,mv_line_id){var self=this;var line=this.getLine(handle);var prop=_.clone(_.find(line['mv_lines_'+line.mode],{'id':mv_line_id}));this._addProposition(line,prop);line['mv_lines_'+line.mode]=_.filter(line['mv_lines_'+line.mode],l=>l['id']!=mv_line_id);line.reconciliation_proposition=_.filter(line.reconciliation_proposition,function(prop){return prop&&!prop.invalid;});if(!line.st_line.partner_id&&line.reconciliation_proposition&&line.reconciliation_proposition.length==1&&prop.partner_id&&line.type===undefined){return this.changePartner(handle,{'id':prop.partner_id,'display_name':prop.partner_name},true);}
return Promise.all([this._computeLine(line),this._performMoveLine(handle,line.mode,1)]);},changeFilter:function(handle,filter){var line=this.getLine(handle);line['filter_'+line.mode]=filter;line['mv_lines_'+line.mode]=[];return this._performMoveLine(handle,line.mode);},changeMode:function(handle,mode){var self=this;var line=this.getLine(handle);if(mode==='default'){var match_requests=self.modes.filter(x=>x.startsWith('match')).map(x=>this._performMoveLine(handle,x))
return Promise.all(match_requests).then(function(){return self.changeMode(handle,self._getDefaultMode(handle));});}
if(mode==='next'){var available_modes=self._getAvailableModes(handle)
mode=available_modes[(available_modes.indexOf(line.mode)+1)%available_modes.length];}
line.mode=mode;if(['match_rp','match_other'].includes(line.mode)){if(!(line['mv_lines_'+line.mode]&&line['mv_lines_'+line.mode].length)){return this._performMoveLine(handle,line.mode);}else{return this._formatMoveLine(handle,line.mode,[]);}}
if(line.mode==='create'){return this.createProposition(handle);}
return Promise.resolve();},changeOffset:function(handle){var line=this.getLine(handle);return this._performMoveLine(handle,line.mode);},changePartner:function(handle,partner,preserveMode){var self=this;var line=this.getLine(handle);line.st_line.partner_id=partner&&partner.id;line.st_line.partner_name=partner&&partner.display_name||'';self.modes.filter(x=>x.startsWith('match')).forEach(function(mode){line["mv_lines_"+mode]=[];});return Promise.resolve(partner&&this._changePartner(handle,partner.id)).then(function(){if(line.st_line.partner_id){_.each(line.reconciliation_proposition,function(prop){if(prop.partner_id!=line.st_line.partner_id){line.reconciliation_proposition=[];return false;}});}
return self._computeLine(line);}).then(function(){return self.changeMode(handle,preserveMode?line.mode:'default',true);})},closeStatement:function(){var self=this;return this._rpc({model:'account.bank.statement',method:'button_confirm_bank',args:[self.bank_statement_id.id],});},createProposition:function(handle){var line=this.getLine(handle);var prop=_.filter(line.reconciliation_proposition,'__focus');prop=this._formatQuickCreate(line);line.reconciliation_proposition.push(prop);line.createForm=_.pick(prop,this.quickCreateFields);return this._computeLine(line);},getContext:function(){return this.context;},getStatementLines:function(){var self=this;var linesToDisplay=_.pick(this.lines,function(value,key,object){if(value.visible===true&&self.alreadyDisplayed.indexOf(key)===-1){self.alreadyDisplayed.push(key);return object;}});return linesToDisplay;},hasMoreLines:function(){var notDisplayed=_.filter(this.lines,function(line){return!line.visible;});if(notDisplayed.length>0){return true;}
return false;},getLine:function(handle){return this.lines[handle];},load:function(context){var self=this;this.context=context;this.statement_line_ids=context.statement_line_ids;if(this.statement_line_ids===undefined){return self._rpc({model:'account.bank.statement.line',method:'search_read',fields:['id'],domain:[['journal_id','=?',context.active_id]],}).then(function(result){self.statement_line_ids=result.map(r=>r.id);return self.reload()})}else{return self.reload();}},loadMore:function(qty){if(qty===undefined){qty=this.defaultDisplayQty;}
var ids=_.pluck(this.lines,'id');ids=ids.splice(this.pagerIndex,qty);this.pagerIndex+=qty;return this.loadData(ids,this._getExcludedIds());},loadData:function(ids){var self=this;var excluded_ids=this._getExcludedIds();return self._rpc({model:'account.reconciliation.widget',method:'get_bank_statement_line_data',args:[ids,excluded_ids],context:self.context,}).then(function(res){return self._formatLine(res['lines']);})},reload:function(){var self=this;self.alreadyDisplayed=[];self.lines={};self.pagerIndex=0;var def_statement=this._rpc({model:'account.reconciliation.widget',method:'get_bank_statement_data',kwargs:{"bank_statement_line_ids":self.statement_line_ids,"srch_domain":self.domain},context:self.context,}).then(function(statement){self.statement=statement;self.bank_statement_id=statement.statement_id?{id:statement.statement_id,display_name:statement.statement_name}:false;self.valuenow=self.valuenow||statement.value_min;self.valuemax=self.valuemax||statement.value_max;self.context.journal_id=statement.journal_id;_.each(statement.lines,function(res){var handle=_.uniqueId('rline');self.lines[handle]={id:res.st_line.id,partner_id:res.st_line.partner_id,handle:handle,reconciled:false,mode:'inactive',mv_lines_match_rp:[],mv_lines_match_other:[],filter_match_rp:"",filter_match_other:"",reconciliation_proposition:[],reconcileModels:[],};});});var domainReconcile=[];if(self.context&&self.context.company_ids){domainReconcile.push(['company_id','in',self.context.company_ids]);}
if(self.context&&self.context.active_model==='account.journal'&&self.context.active_ids){domainReconcile.push('|');domainReconcile.push(['match_journal_ids','=',false]);domainReconcile.push(['match_journal_ids','in',self.context.active_ids]);}
var def_reconcileModel=this._loadReconciliationModel({domainReconcile:domainReconcile});var def_account=this._rpc({model:'account.account',method:'search_read',fields:['code'],}).then(function(accounts){self.accounts=_.object(_.pluck(accounts,'id'),_.pluck(accounts,'code'));});var def_taxes=self._loadTaxes();return Promise.all([def_statement,def_reconcileModel,def_account,def_taxes]).then(function(){_.each(self.lines,function(line){line.reconcileModels=self.reconcileModels;});var ids=_.pluck(self.lines,'id');ids=ids.splice(0,self.defaultDisplayQty);self.pagerIndex=ids.length;return self._formatLine(self.statement.lines);});},_readAnalyticTags:function(params){var self=this;this.analyticTags={};if(!params||!params.res_ids||!params.res_ids.length){return $.when();}
var fields=(params&&params.fields||[]).concat(['id','display_name']);return this._rpc({model:'account.analytic.tag',method:'read',args:[params.res_ids,fields,],}).then(function(tags){for(var i=0;i<tags.length;i++){var tag=tags[i];self.analyticTags[tag.id]=tag;}});},_loadReconciliationModel:function(params){var self=this;return this._rpc({model:'account.reconcile.model',method:'search_read',domain:params.domainReconcile||[],}).then(function(reconcileModels){var analyticTagIds=[];for(var i=0;i<reconcileModels.length;i++){var modelTags=reconcileModels[i].analytic_tag_ids||[];if(reconcileModels[i].has_second_line){modelTags=_.union(modelTags,reconcileModels[i].second_analytic_tag_ids||[])}
for(var j=0;j<modelTags.length;j++){if(analyticTagIds.indexOf(modelTags[j])===-1){analyticTagIds.push(modelTags[j]);}}}
return self._readAnalyticTags({res_ids:analyticTagIds}).then(function(){for(var i=0;i<reconcileModels.length;i++){var recModel=reconcileModels[i];var analyticTagData=[];var modelTags=reconcileModels[i].analytic_tag_ids||[];for(var j=0;j<modelTags.length;j++){var tagId=modelTags[j];analyticTagData.push([tagId,self.analyticTags[tagId].display_name])}
recModel.analytic_tag_ids=analyticTagData;if(recModel.has_second_line){var secondAnalyticTagData=[];var modelTags=recModel.second_analytic_tag_ids||[];for(var j=0;j<modelTags.length;j++){var tagId=modelTags[j];secondAnalyticTagData.push([tagId,self.analyticTags[tagId].display_name])}
if(secondAnalyticTagData.length>0){recModel.second_analytic_tag_ids=secondAnalyticTagData;}}}
self.reconcileModels=reconcileModels;});});},_loadTaxes:function(){var self=this;self.taxes={};return this._rpc({model:'account.tax',method:'search_read',fields:['price_include','name'],}).then(function(taxes){_.each(taxes,function(tax){self.taxes[tax.id]={price_include:tax.price_include,display_name:tax.name,};});return taxes;});},quickCreateProposition:function(handle,reconcileModelId){var self=this;var line=this.getLine(handle);var reconcileModel=_.find(this.reconcileModels,function(r){return r.id===reconcileModelId;});var fields=['account_id','amount','amount_type','analytic_account_id','journal_id','label','force_tax_included','tax_ids','analytic_tag_ids','to_check','amount_from_label_regex','decimal_separator'];this._blurProposition(handle);var focus=this._formatQuickCreate(line,_.pick(reconcileModel,fields));focus.reconcileModelId=reconcileModelId;line.reconciliation_proposition.push(focus);var defs=[];if(reconcileModel.has_second_line){defs.push(self._computeLine(line).then(function(){var second={};_.each(fields,function(key){second[key]=("second_"+key)in reconcileModel?reconcileModel["second_"+key]:reconcileModel[key];});var second_focus=self._formatQuickCreate(line,second);second_focus.reconcileModelId=reconcileModelId;line.reconciliation_proposition.push(second_focus);self._computeReconcileModels(handle,reconcileModelId);}))}
return Promise.all(defs).then(function(){line.createForm=_.pick(focus,self.quickCreateFields);return self._computeLine(line);})},removeProposition:function(handle,id){var self=this;var line=this.getLine(handle);var defs=[];var prop=_.find(line.reconciliation_proposition,{'id':id});if(prop){line.reconciliation_proposition=_.filter(line.reconciliation_proposition,function(p){return p.id!==prop.id&&p.id!==prop.link&&p.link!==prop.id&&(!p.link||p.link!==prop.link);});if(prop['reconcileModelId']===undefined){if(['receivable','payable','liquidity'].includes(prop.account_type)){line.mv_lines_match_rp.unshift(prop);}else{line.mv_lines_match_other.unshift(prop);}}
if(line.reconciliation_proposition.length==0&&line.st_line.has_no_partner)
defs.push(self.changePartner(line.handle));}
line.mode=(id||line.mode!=="create")&&isNaN(id)?'create':'match_rp';defs.push(this._computeLine(line));return Promise.all(defs).then(function(){return self.changeMode(handle,line.mode,true);})},getPartialReconcileAmount:function(handle,data){var line=this.getLine(handle);var formatOptions={currency_id:line.st_line.currency_id,noSymbol:true,};var prop=_.find(line.reconciliation_proposition,{'id':data.data});if(prop){var amount=prop.partial_amount||prop.amount;var partial=Math.abs(line.balance.amount+amount);if(Math.abs(line.balance.amount)>=Math.abs(amount)){amount=Math.abs(amount);}else if(partial<=Math.abs(prop.amount)&&partial>=0){amount=partial;}else{amount=Math.abs(amount);}
return field_utils.format.monetary(amount,{},formatOptions);}},partialReconcile:function(handle,data){var line=this.getLine(handle);var prop=_.find(line.reconciliation_proposition,{'id':data.mvLineId});if(prop){var amount=data.amount;try{amount=field_utils.parse.float(data.amount);}
catch(err){amount=NaN;}
if(amount>=Math.abs(prop.amount)||amount<=0||isNaN(amount)){delete prop.partial_amount_str;delete prop.partial_amount;if(isNaN(amount)||amount<0){this.do_warn(_.str.sprintf(_t('The amount %s is not a valid partial amount'),data.amount));}
return this._computeLine(line);}
else{var format_options={currency_id:line.st_line.currency_id};prop.partial_amount=(prop.amount>0?1:-1)*amount;prop.partial_amount_str=field_utils.format.monetary(Math.abs(prop.partial_amount),{},format_options);}}
return this._computeLine(line);},updateProposition:function(handle,values){var self=this;var line=this.getLine(handle);var prop=_.last(_.filter(line.reconciliation_proposition,'__focus'));if(prop.reconcileModelId){prop=_.find(line.reconciliation_proposition,function(proposition){return proposition.__focus==true&&proposition.to_check==false&&proposition.reconcileModelId==prop.reconcileModelId&&proposition.label==prop.label&&proposition.id.includes('createLine');})||prop;}
if('to_check'in values&&values.to_check===false){prop.to_check=line.reconciliation_proposition.some(function(rec_prop,index){return rec_prop.id!==prop.id&&rec_prop.to_check;});}
if(!prop){prop=this._formatQuickCreate(line);line.reconciliation_proposition.push(prop);}
_.each(values,function(value,fieldName){if(fieldName==='analytic_tag_ids'){switch(value.operation){case"ADD_M2M":var vids=_.isArray(value.ids)?value.ids:[value.ids];_.each(vids,function(val){if(!_.findWhere(prop.analytic_tag_ids,{id:val.id})){prop.analytic_tag_ids.push(val);}});break;case"FORGET":var id=self.localData[value.ids[0]].ref;prop.analytic_tag_ids=_.filter(prop.analytic_tag_ids,function(val){return val.id!==id;});break;}}
else if(fieldName==='tax_ids'){switch(value.operation){case"ADD_M2M":prop.__tax_to_recompute=true;var vids=_.isArray(value.ids)?value.ids:[value.ids];_.each(vids,function(val){if(!_.findWhere(prop.tax_ids,{id:val.id})){value.ids.price_include=self.taxes[val.id]?self.taxes[val.id].price_include:false;prop.tax_ids.push(val);}});break;case"FORGET":prop.__tax_to_recompute=true;var id=self.localData[value.ids[0]].ref;prop.tax_ids=_.filter(prop.tax_ids,function(val){return val.id!==id;});break;}}
else{prop[fieldName]=values[fieldName];}});if('account_id'in values){prop.account_code=prop.account_id?this.accounts[prop.account_id.id]:'';}
if('amount'in values){prop.base_amount=values.amount;if(prop.reconcileModelId){this._computeReconcileModels(handle,prop.reconcileModelId);}}
if('label'in values||'force_tax_included'in values||'amount'in values||'account_id'in values){prop.__tax_to_recompute=true;}
line.createForm=_.pick(prop,this.quickCreateFields);if(prop.base_amount)
line.createForm.amount=prop.base_amount;if(prop.tax_ids.length!==1){prop.amount=prop.base_amount;line.createForm.force_tax_included=false;}
return this._computeLine(line);},validate:function(handle){var self=this;this.display_context='validate';var handles=[];if(handle){handles=[handle];}else{_.each(this.lines,function(line,handle){if(!line.reconciled&&line.balance&&!line.balance.amount&&line.reconciliation_proposition.length){handles.push(handle);}});}
var ids=[];var values=[];var handlesPromises=[];_.each(handles,function(handle){var line=self.getLine(handle);var props=_.filter(line.reconciliation_proposition,function(prop){return!prop.invalid;});var computeLinePromise;if(props.length===0){props.push(self._formatQuickCreate(line,{account_id:[line.st_line.open_balance_account_id,self.accounts[line.st_line.open_balance_account_id]],}));line.reconciliation_proposition.push(props[0]);computeLinePromise=self._computeLine(line);}
ids.push(line.id);handlesPromises.push(Promise.resolve(computeLinePromise).then(function(){var values_dict={"partner_id":line.st_line.partner_id,"counterpart_aml_dicts":_.map(_.filter(props,function(prop){return!isNaN(prop.id)&&!prop.already_paid;}),self._formatToProcessReconciliation.bind(self,line)),"payment_aml_ids":_.pluck(_.filter(props,function(prop){return!isNaN(prop.id)&&prop.already_paid;}),'id'),"new_aml_dicts":_.map(_.filter(props,function(prop){return isNaN(prop.id)&&prop.display;}),self._formatToProcessReconciliation.bind(self,line)),"to_check":line.to_check,};var currency=session.get_currency(line.st_line.currency_id);var balance=line.balance.amount;if(!utils.float_is_zero(balance,currency.digits[1])){var unreconciled_amount_dict={'account_id':line.st_line.open_balance_account_id,'credit':balance>0?balance:0,'debit':balance<0?-balance:0,'name':line.st_line.name+' : '+_t("Open balance"),};values_dict['new_aml_dicts'].push(unreconciled_amount_dict);}
values.push(values_dict);line.reconciled=true;}));_.each(self.lines,function(other_line){if(other_line!=line){var filtered_prop=other_line.reconciliation_proposition.filter(p=>!line.reconciliation_proposition.map(l=>l.id).includes(p.id));if(filtered_prop.length!=other_line.reconciliation_proposition.length){other_line.need_update=true;other_line.reconciliation_proposition=filtered_prop;}
self._computeLine(line);}})});return Promise.all(handlesPromises).then(function(){return self._rpc({model:'account.reconciliation.widget',method:'process_bank_statement_line',args:[ids,values],context:self.context,}).then(self._validatePostProcess.bind(self)).then(function(){self.valuenow+=handles.length;return{handles:handles};});});},_addProposition:function(line,prop){line.reconciliation_proposition.push(prop);},_blurProposition:function(handle){var line=this.getLine(handle);line.reconciliation_proposition=_.filter(line.reconciliation_proposition,function(l){l.__focus=false;return!l.invalid;});},_changePartner:function(handle,partner_id){var self=this;return this._rpc({model:'res.partner',method:'read',args:[partner_id,["property_account_receivable_id","property_account_payable_id"]],}).then(function(result){if(result.length>0){var line=self.getLine(handle);self.lines[handle].st_line.open_balance_account_id=line.balance.amount<0?result[0]['property_account_payable_id'][0]:result[0]['property_account_receivable_id'][0];}});},_computeLine:function(line){var self=this;var tax_defs=[];var reconciliation_proposition=[];var formatOptions={currency_id:line.st_line.currency_id,};line.to_check=false;_.each(line.reconciliation_proposition,function(prop){if(prop.to_check){line.to_check=true;}
if(prop.tax_repartition_line_id){if(!_.find(line.reconciliation_proposition,{'id':prop.link}).__tax_to_recompute){reconciliation_proposition.push(prop);}
return;}
if(!prop.already_paid&&parseInt(prop.id)){prop.is_move_line=true;}
reconciliation_proposition.push(prop);if(prop.tax_ids&&prop.tax_ids.length&&prop.__tax_to_recompute&&prop.base_amount){reconciliation_proposition=_.filter(reconciliation_proposition,function(p){return!p.tax_repartition_line_id||p.link!==prop.id;});var args=[prop.tax_ids.map(function(el){return el.id;}),prop.base_amount,formatOptions.currency_id];var add_context={'round':true};if(prop.tax_ids.length===1&&line.createForm&&line.createForm.force_tax_included)
add_context.force_price_include=true;tax_defs.push(self._rpc({model:'account.tax',method:'json_friendly_compute_all',args:args,context:$.extend({},self.context||{},add_context),}).then(function(result){_.each(result.taxes,function(tax){var tax_prop=self._formatQuickCreate(line,{'link':prop.id,'tax_ids':tax.tax_ids,'tax_repartition_line_id':tax.tax_repartition_line_id,'tax_base_amount':tax.base,'tag_ids':tax.tag_ids,'amount':tax.amount,'label':prop.label?prop.label+" "+tax.name:tax.name,'date':prop.date,'account_id':tax.account_id?[tax.account_id,null]:prop.account_id,'analytic':tax.analytic,'__focus':false});prop.tax_exigible=tax.tax_exigibility==='on_payment'?true:undefined;prop.amount=tax.base;prop.amount_str=field_utils.format.monetary(Math.abs(prop.amount),{},formatOptions);prop.invalid=!self._isValid(prop);tax_prop.amount_str=field_utils.format.monetary(Math.abs(tax_prop.amount),{},formatOptions);tax_prop.invalid=prop.invalid;reconciliation_proposition.push(tax_prop);});prop.tag_ids=result.base_tags;}));}else{prop.amount_str=field_utils.format.monetary(Math.abs(prop.amount),{},formatOptions);prop.display=self._isDisplayedProposition(prop);prop.invalid=!self._isValid(prop);}});return Promise.all(tax_defs).then(function(){_.each(reconciliation_proposition,function(prop){prop.__tax_to_recompute=false;});line.reconciliation_proposition=reconciliation_proposition;var amount_currency=0;var total=line.st_line.amount||0;var isOtherCurrencyId=_.uniq(_.pluck(_.reject(reconciliation_proposition,'invalid'),'currency_id'));isOtherCurrencyId=isOtherCurrencyId.length===1&&!total&&isOtherCurrencyId[0]!==formatOptions.currency_id?isOtherCurrencyId[0]:false;_.each(reconciliation_proposition,function(prop){if(!prop.invalid){total-=prop.partial_amount||prop.amount;if(isOtherCurrencyId){amount_currency-=(prop.amount<0?-1:1)*Math.abs(prop.amount_currency);}}});var company_currency=session.get_currency(line.st_line.currency_id);var company_precision=company_currency&&company_currency.digits[1]||2;total=utils.round_decimals(total,company_precision)||0;if(isOtherCurrencyId){var other_currency=session.get_currency(isOtherCurrencyId);var other_precision=other_currency&&other_currency.digits[1]||2;amount_currency=utils.round_decimals(amount_currency,other_precision);}
line.balance={amount:total,amount_str:field_utils.format.monetary(Math.abs(total),{},formatOptions),currency_id:isOtherCurrencyId,amount_currency:isOtherCurrencyId?amount_currency:total,amount_currency_str:isOtherCurrencyId?field_utils.format.monetary(Math.abs(amount_currency),{},{currency_id:isOtherCurrencyId}):false,account_code:self.accounts[line.st_line.open_balance_account_id],};line.balance.show_balance=line.balance.amount_currency!=0;line.balance.type=line.balance.amount_currency?(line.st_line.partner_id?0:-1):1;});},_computeReconcileModels:function(handle,reconcileModelId){var line=this.getLine(handle);var props=_.filter(line.reconciliation_proposition,{'reconcileModelId':reconcileModelId,'__focus':true});if(props.length===2&&props[0].percent&&props[1].percent){if(props[0].percent+props[1].percent===100){props[0].base_amount=props[0].amount=line.st_line.amount-props[1].base_amount;props[0].__tax_to_recompute=true;}}},_formatNameGet:function(value){return value?(value.id?value:{'id':value[0],'display_name':value[1]}):false;},_formatMany2ManyTags:function(value){var res=[];for(var i=0,len=value.length;i<len;i++){res[i]={'id':value[i][0],'display_name':value[i][1]};}
return res;},_formatMany2ManyTagsTax:function(value){var res=[];for(var i=0;i<value.length;i++){res.push({id:value[i],display_name:this.taxes[value[i]]?this.taxes[value[i]].display_name:''});}
return res;},_formatLineProposition:function(line,props){var self=this;if(props.length){_.each(props,function(prop){prop.amount=prop.debit||-prop.credit;prop.label=prop.name;prop.account_id=self._formatNameGet(prop.account_id||line.account_id);prop.is_partially_reconciled=prop.amount_str!==prop.total_amount_str;prop.to_check=!!prop.to_check;});}},_formatLine:function(lines){var self=this;var defs=[];_.each(lines,function(data){var line=_.find(self.lines,function(l){return l.id===data.st_line.id;});line.visible=true;line.limitMoveLines=self.limitMoveLines;_.extend(line,data);self._formatLineProposition(line,line.reconciliation_proposition);if(!line.reconciliation_proposition.length){delete line.reconciliation_proposition;}
defs.push(self._computeLine(line).then(function(){if(!line.st_line.partner_id&&line.reconciliation_proposition.length>0){var hasDifferentPartners=function(prop){return!prop.partner_id||prop.partner_id!=line.reconciliation_proposition[0].partner_id;};if(!_.any(line.reconciliation_proposition,hasDifferentPartners)){return self.changePartner(line.handle,{'id':line.reconciliation_proposition[0].partner_id,'display_name':line.reconciliation_proposition[0].partner_name,},true);}}else if(!line.st_line.partner_id&&line.partner_id&&line.partner_name){return self.changePartner(line.handle,{'id':line.partner_id,'display_name':line.partner_name,},true);}
return true;}).then(function(){return data.write_off?self.quickCreateProposition(line.handle,data.model_id):true;}).then(function(){if(!line.st_line.partner_id&&self.context.partner_id&&self.context.partner_name){return self.changePartner(line.handle,{'id':self.context.partner_id,'display_name':self.context.partner_name,},true);}
return true;}));});return Promise.all(defs);},_formatMoveLine:function(handle,mode,mv_lines){var self=this;var line=this.getLine(handle);line['mv_lines_'+mode]=_.uniq(line['mv_lines_'+mode].concat(mv_lines),l=>l.id);if(mv_lines[0]){line['remaining_'+mode]=mv_lines[0].recs_count-mv_lines.length;}else if(line['mv_lines_'+mode].length==0){line['remaining_'+mode]=0;}
this._formatLineProposition(line,mv_lines);if((line.mode=='match_other'||line.mode=="match_rp")&&!line['mv_lines_'+mode].length&&!line['filter_'+mode].length){line.mode=self._getDefaultMode(handle);if(line.mode!=='match_rp'&&line.mode!=='match_other'&&line.mode!=='inactive'){return this._computeLine(line).then(function(){return self.createProposition(handle);});}}else{return this._computeLine(line);}},_getDefaultMode:function(handle){var line=this.getLine(handle);if(line.balance.amount===0&&(!line.st_line.mv_lines_match_rp||line.st_line.mv_lines_match_rp.length===0)&&(!line.st_line.mv_lines_match_other||line.st_line.mv_lines_match_other.length===0)){return'inactive';}
if(line.mv_lines_match_rp&&line.mv_lines_match_rp.length){return'match_rp';}
if(line.mv_lines_match_other&&line.mv_lines_match_other.length){return'match_other';}
return'create';},_getAvailableModes:function(handle){var line=this.getLine(handle);var modes=[]
if(line.mv_lines_match_rp&&line.mv_lines_match_rp.length){modes.push('match_rp')}
if(line.mv_lines_match_other&&line.mv_lines_match_other.length){modes.push('match_other')}
modes.push('create')
return modes},_formatQuickCreate:function(line,values){values=values||{};var today=new moment().utc().format();var account=this._formatNameGet(values.account_id);var formatOptions={currency_id:line.st_line.currency_id,};var amount;switch(values.amount_type){case'percentage':amount=line.balance.amount*values.amount/100;break;case'regex':var matching=line.st_line.name.match(new RegExp(values.amount_from_label_regex))
amount=0;if(matching&&matching.length==2){matching=matching[1].replace(new RegExp('\\D'+values.decimal_separator,'g'),'');matching=matching.replace(values.decimal_separator,'.');amount=parseFloat(matching)||0;amount=line.balance.amount>0?amount:-amount;}
break;case'fixed':amount=values.amount;break;default:amount=values.amount!==undefined?values.amount:line.balance.amount;}
var prop={'id':_.uniqueId('createLine'),'label':values.label||line.st_line.name,'account_id':account,'account_code':account?this.accounts[account.id]:'','analytic_account_id':this._formatNameGet(values.analytic_account_id),'analytic_tag_ids':this._formatMany2ManyTags(values.analytic_tag_ids||[]),'journal_id':this._formatNameGet(values.journal_id),'tax_ids':this._formatMany2ManyTagsTax(values.tax_ids||[]),'tag_ids':values.tag_ids,'tax_repartition_line_id':values.tax_repartition_line_id,'tax_base_amount':values.tax_base_amount,'debit':0,'credit':0,'date':values.date?values.date:field_utils.parse.date(today,{},{isUTC:true}),'force_tax_included':values.force_tax_included||false,'base_amount':amount,'percent':values.amount_type==="percentage"?values.amount:null,'link':values.link,'display':true,'invalid':true,'to_check':!!values.to_check,'__tax_to_recompute':true,'__focus':'__focus'in values?values.__focus:true,};if(prop.base_amount){var sign=prop.base_amount<0?-1:1;var amount=field_utils.format.monetary(Math.abs(prop.base_amount),{},formatOptions);prop.base_amount=sign*field_utils.parse.monetary(amount,{},formatOptions);}
prop.amount=prop.base_amount;return prop;},_getExcludedIds:function(){var excludedIds=[];_.each(this.lines,function(line){if(line.reconciliation_proposition){_.each(line.reconciliation_proposition,function(prop){if(parseInt(prop['id'])){excludedIds.push(prop['id']);}});}});return excludedIds;},_isDisplayedProposition:function(prop){return!isNaN(prop.id)||!!prop.account_id;},_isValid:function(prop){return!isNaN(prop.id)||prop.account_id&&prop.amount&&prop.label&&!!prop.label.length;},_performMoveLine:function(handle,mode,limit){limit=limit||this.limitMoveLines;var line=this.getLine(handle);var excluded_ids=_.map(_.union(line.reconciliation_proposition,line.mv_lines_match_rp,line.mv_lines_match_other),function(prop){return _.isNumber(prop.id)?prop.id:null;}).filter(id=>id!=null);var filter=line['filter_'+mode]||"";return this._rpc({model:'account.reconciliation.widget',method:'get_move_lines_for_bank_statement_line',args:[line.id,line.st_line.partner_id,excluded_ids,filter,0,limit,mode==='match_rp'?'rp':'other'],context:this.context,}).then(this._formatMoveLine.bind(this,handle,mode));},_formatToProcessReconciliation:function(line,prop){var amount=-prop.amount;if(prop.partial_amount){amount=-prop.partial_amount;}
var result={name:prop.label,debit:amount>0?amount:0,credit:amount<0?-amount:0,tax_exigible:prop.tax_exigible,analytic_tag_ids:[[6,null,_.pluck(prop.analytic_tag_ids,'id')]]};if(!isNaN(prop.id)){result.counterpart_aml_id=prop.id;}else{result.account_id=prop.account_id.id;if(prop.journal_id){result.journal_id=prop.journal_id.id;}}
if(!isNaN(prop.id))result.counterpart_aml_id=prop.id;if(prop.analytic_account_id)result.analytic_account_id=prop.analytic_account_id.id;if(prop.tax_ids&&prop.tax_ids.length)result.tax_ids=[[6,null,_.pluck(prop.tax_ids,'id')]];if(prop.tag_ids&&prop.tag_ids.length)result.tag_ids=[[6,null,prop.tag_ids]];if(prop.tax_repartition_line_id)result.tax_repartition_line_id=prop.tax_repartition_line_id;if(prop.tax_base_amount)result.tax_base_amount=prop.tax_base_amount;if(prop.reconcileModelId)result.reconcile_model_id=prop.reconcileModelId
return result;},_validatePostProcess:function(data){var self=this;return Promise.resolve();},});var ManualModel=StatementModel.extend({quickCreateFields:['account_id','journal_id','amount','analytic_account_id','label','tax_ids','force_tax_included','analytic_tag_ids','date','to_check'],modes:['create','match'],hasMoreLines:function(){if(this.manualLines.length>this.pagerIndex){return true;}
return false;},load:function(context){var self=this;this.context=context;var domain_account_id=[];if(context&&context.company_ids){domain_account_id.push(['company_id','in',context.company_ids]);}
var def_account=this._rpc({model:'account.account',method:'search_read',domain:domain_account_id,fields:['code'],}).then(function(accounts){self.account_ids=_.pluck(accounts,'id');self.accounts=_.object(self.account_ids,_.pluck(accounts,'code'));});var domainReconcile=[];var session_allowed_company_ids=session.user_context.allowed_company_ids||[]
var company_ids=context&&context.company_ids||session_allowed_company_ids.slice(0,1);if(company_ids){domainReconcile.push(['company_id','in',company_ids]);}
var def_reconcileModel=this._loadReconciliationModel({domainReconcile:domainReconcile});var def_taxes=this._loadTaxes();return Promise.all([def_reconcileModel,def_account,def_taxes]).then(function(){switch(context.mode){case'customers':case'suppliers':var mode=context.mode==='customers'?'receivable':'payable';var args=['partner',context.partner_ids||null,mode];return self._rpc({model:'account.reconciliation.widget',method:'get_data_for_manual_reconciliation',args:args,context:context,}).then(function(result){self.manualLines=result;self.valuenow=0;self.valuemax=Object.keys(self.manualLines).length;var lines=self.manualLines.slice(0,self.defaultDisplayQty);self.pagerIndex=lines.length;return self.loadData(lines);});case'accounts':return self._rpc({model:'account.reconciliation.widget',method:'get_data_for_manual_reconciliation',args:['account',context.account_ids||self.account_ids],context:context,}).then(function(result){self.manualLines=result;self.valuenow=0;self.valuemax=Object.keys(self.manualLines).length;var lines=self.manualLines.slice(0,self.defaultDisplayQty);self.pagerIndex=lines.length;return self.loadData(lines);});default:var partner_ids=context.partner_ids||null;var account_ids=context.account_ids||self.account_ids||null;return self._rpc({model:'account.reconciliation.widget',method:'get_all_data_for_manual_reconciliation',args:[partner_ids,account_ids],context:context,}).then(function(result){self.manualLines=[].concat(result.accounts,result.customers,result.suppliers);self.valuenow=0;self.valuemax=Object.keys(self.manualLines).length;var lines=self.manualLines.slice(0,self.defaultDisplayQty);self.pagerIndex=lines.length;return self.loadData(lines);});}});},reload:function(){this.lines={};return this.load(this.context);},loadMore:function(qty){if(qty===undefined){qty=this.defaultDisplayQty;}
var lines=this.manualLines.slice(this.pagerIndex,this.pagerIndex+qty);this.pagerIndex+=qty;return this.loadData(lines);},loadData:function(lines){var self=this;var defs=[];_.each(lines,function(l){defs.push(self._formatLine(l.mode,l));});return Promise.all(defs);},validate:function(handle){var self=this;var handles=[];if(handle){handles=[handle];}else{_.each(this.lines,function(line,handle){if(!line.reconciled&&!line.balance.amount&&line.reconciliation_proposition.length){handles.push(handle);}});}
var def=Promise.resolve();var process_reconciliations=[];var reconciled=[];_.each(handles,function(handle){var line=self.getLine(handle);if(line.reconciled){return;}
var props=line.reconciliation_proposition;if(!props.length){self.valuenow++;reconciled.push(handle);line.reconciled=true;process_reconciliations.push({id:line.type==='accounts'?line.account_id:line.partner_id,type:line.type,mv_line_ids:[],new_mv_line_dicts:[],});}else{var mv_line_ids=_.pluck(_.filter(props,function(prop){return!isNaN(prop.id);}),'id');var new_mv_line_dicts=_.map(_.filter(props,function(prop){return isNaN(prop.id)&&prop.display;}),self._formatToProcessReconciliation.bind(self,line));process_reconciliations.push({id:null,type:null,mv_line_ids:mv_line_ids,new_mv_line_dicts:new_mv_line_dicts});}
line.reconciliation_proposition=[];});if(process_reconciliations.length){def=self._rpc({model:'account.reconciliation.widget',method:'process_move_lines',args:[process_reconciliations],});}
return def.then(function(){var defs=[];var account_ids=[];var partner_ids=[];_.each(handles,function(handle){var line=self.getLine(handle);if(line.reconciled){return;}
line.filter_match="";defs.push(self._performMoveLine(handle,'match').then(function(){if(!line.mv_lines_match.length){self.valuenow++;reconciled.push(handle);line.reconciled=true;if(line.type==='accounts'){account_ids.push(line.account_id.id);}else{partner_ids.push(line.partner_id);}}}));});return Promise.all(defs).then(function(){if(partner_ids.length){self._rpc({model:'res.partner',method:'mark_as_reconciled',args:[partner_ids],});}
return{reconciled:reconciled,updated:_.difference(handles,reconciled)};});});},removeProposition:function(handle,id){var self=this;var line=this.getLine(handle);var defs=[];var prop=_.find(line.reconciliation_proposition,{'id':id});if(prop){line.reconciliation_proposition=_.filter(line.reconciliation_proposition,function(p){return p.id!==prop.id&&p.id!==prop.link&&p.link!==prop.id&&(!p.link||p.link!==prop.link);});line.mv_lines_match=line.mv_lines_match||[];line.mv_lines_match.unshift(prop);if(line.reconciliation_proposition.length==0&&line.st_line.has_no_partner)
defs.push(self.changePartner(line.handle));}
line.mode=(id||line.mode!=="create")&&isNaN(id)?'create':'match';defs.push(this._computeLine(line));return Promise.all(defs).then(function(){return self.changeMode(handle,line.mode,true);})},_computeLine:function(line){return this._super(line).then(function(){var props=_.reject(line.reconciliation_proposition,'invalid');_.each(line.reconciliation_proposition,function(p){delete p.is_move_line;});line.balance.type=-1;if(!line.balance.amount_currency&&props.length){line.balance.type=1;}else if(_.any(props,function(prop){return prop.amount>0;})&&_.any(props,function(prop){return prop.amount<0;})){line.balance.type=0;}});},_formatLine:function(type,data){var line=this.lines[_.uniqueId('rline')]=_.extend(data,{type:type,reconciled:false,mode:'inactive',limitMoveLines:this.limitMoveLines,filter_match:"",reconcileModels:this.reconcileModels,account_id:this._formatNameGet([data.account_id,data.account_name]),st_line:data,visible:true});this._formatLineProposition(line,line.reconciliation_proposition);if(!line.reconciliation_proposition.length){delete line.reconciliation_proposition;}
return this._computeLine(line);},_formatLineProposition:function(line,props){var self=this;this._super(line,props);if(props.length){_.each(props,function(prop){var tmp_value=prop.debit||prop.credit;prop.credit=prop.credit!==0?0:tmp_value;prop.debit=prop.debit!==0?0:tmp_value;prop.amount=-prop.amount;prop.journal_id=self._formatNameGet(prop.journal_id||line.journal_id);prop.to_check=!!prop.to_check;});}},_formatQuickCreate:function(line,values){if(values&&values.journal_id===undefined&&line&&line.createForm&&line.createForm.journal_id){values.journal_id=line.createForm.journal_id;}
return this._super(line,values);},_isDisplayedProposition:function(prop){return!!prop.journal_id&&this._super(prop);},_isValid:function(prop){return prop.journal_id&&this._super(prop);},_performMoveLine:function(handle,mode,limit){limit=limit||this.limitMoveLines;var line=this.getLine(handle);var excluded_ids=_.map(_.union(line.reconciliation_proposition,line.mv_lines_match),function(prop){return _.isNumber(prop.id)?prop.id:null;}).filter(id=>id!=null);var filter=line.filter_match||"";var args=[line.account_id.id,line.partner_id,excluded_ids,filter,0,limit];return this._rpc({model:'account.reconciliation.widget',method:'get_move_lines_for_manual_reconciliation',args:args,context:this.context,}).then(this._formatMoveLine.bind(this,handle,''));},_formatToProcessReconciliation:function(line,prop){var result=this._super(line,prop);result['date']=prop.date;return result;},_getDefaultMode:function(handle){var line=this.getLine(handle);if(line.balance.amount===0&&(!line.st_line.mv_lines_match||line.st_line.mv_lines_match.length===0)){return'inactive';}
return line.mv_lines_match.length>0?'match':'create';},_formatMoveLine:function(handle,mode,mv_lines){var self=this;var line=this.getLine(handle);line.mv_lines_match=_.uniq((line.mv_lines_match||[]).concat(mv_lines),l=>l.id);if(mv_lines[0]){line.remaining_match=mv_lines[0].recs_count-mv_lines.length;}else if(line.mv_lines_match.length==0){line.remaining_match=0;}
this._formatLineProposition(line,mv_lines);if(line.mode!=='create'&&!line.mv_lines_match.length&&!line.filter_match.length){line.mode=this.avoidCreate||!line.balance.amount?'inactive':'create';if(line.mode==='create'){return this._computeLine(line).then(function(){return self.createProposition(handle);});}}else{return this._computeLine(line);}},});return{StatementModel:StatementModel,ManualModel:ManualModel,};});;

/* /account/static/src/js/reconciliation/reconciliation_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('account.ReconciliationRenderer',function(require){"use strict";var Widget=require('web.Widget');var FieldManagerMixin=require('web.FieldManagerMixin');var relational_fields=require('web.relational_fields');var basic_fields=require('web.basic_fields');var core=require('web.core');var time=require('web.time');var session=require('web.session');var qweb=core.qweb;var _t=core._t;var StatementRenderer=Widget.extend(FieldManagerMixin,{template:'reconciliation.statement',events:{'click *[rel="do_action"]':'_onDoAction','click button.js_load_more':'_onLoadMore',},init:function(parent,model,state){this._super(parent);this.model=model;this._initialState=state;},start:function(){var self=this;var defs=[this._super.apply(this,arguments)];this.time=Date.now();this.$progress=$('');return Promise.all(defs);},hideLoadMoreButton:function(show){if(!show){this.$('.js_load_more').show();}
else{this.$('.js_load_more').hide();}},showRainbowMan:function(state){if(this.model.display_context!=='validate'){return}
var dt=Date.now()-this.time;var $done=$(qweb.render("reconciliation.done",{'duration':moment(dt).utc().format(time.getLangTimeFormat()),'number':state.valuenow,'timePerTransaction':Math.round(dt/1000/state.valuemax),'context':state.context,'bank_statement_id':state.bank_statement_id,}));$done.find('*').addClass('o_reward_subcontent');$done.find('.button_close_statement').click(this._onCloseBankStatement.bind(this));$done.find('.button_back_to_statement').click(this._onGoToBankStatement.bind(this));if(session.show_effect){this.trigger_up('show_effect',{type:'rainbow_man',fadeout:'no',message:$done,});this.$el.css('min-height','450px');}else{$done.appendTo(this.$el);}},update:function(state){var self=this;this._updateProgressBar(state);if(state.valuenow===state.valuemax&&!this.$('.done_message').length){this.showRainbowMan(state);}
if(state.notifications){this._renderNotifications(state.notifications);}},_updateProgressBar:function(state){this.$progress.find('.valuenow').text(state.valuenow);this.$progress.find('.valuemax').text(state.valuemax);this.$progress.find('.progress-bar').attr('aria-valuenow',state.valuenow).attr('aria-valuemax',state.valuemax).css('width',(state.valuenow/state.valuemax*100)+'%');},_renderNotifications:function(notifications){this.$(".notification_area").empty();for(var i=0;i<notifications.length;i++){var $notification=$(qweb.render("reconciliation.notification",notifications[i])).hide();$notification.appendTo(this.$(".notification_area")).slideDown(300);}},_onCloseBankStatement:function(e){this.trigger_up('close_statement');},_onDoAction:function(e){e.preventDefault();var name=e.currentTarget.dataset.action_name;var model=e.currentTarget.dataset.model;if(e.currentTarget.dataset.ids){var ids=e.currentTarget.dataset.ids.split(",").map(Number);var domain=[['id','in',ids]];}else{var domain=e.currentTarget.dataset.domain;}
var context=e.currentTarget.dataset.context;var tag=e.currentTarget.dataset.tag;if(tag){this.do_action({type:'ir.actions.client',tag:tag,context:context,})}else{this.do_action({name:name,res_model:model,domain:domain,context:context,views:[[false,'list'],[false,'form']],type:'ir.actions.act_window',view_mode:"list"});}},_onGoToBankStatement:function(e){var journalId=$(e.target).attr('data_journal_id');if(journalId){journalId=parseInt(journalId);}
$('.o_reward').remove();this.do_action({name:'Bank Statements',res_model:'account.bank.statement',views:[[false,'list'],[false,'form']],type:'ir.actions.act_window',context:{search_default_journal_id:journalId,'journal_type':'bank'},view_mode:'form',});},_onLoadMore:function(e){this.trigger_up('load_more');},});var LineRenderer=Widget.extend(FieldManagerMixin,{template:"reconciliation.line",events:{'click .accounting_view caption .o_buttons button':'_onValidate','click .accounting_view tfoot':'_onChangeTab','click':'_onTogglePanel','click .o_field_widget':'_onStopPropagation','keydown .o_input, .edit_amount_input':'_onStopPropagation','click .o_notebook li a':'_onChangeTab','click .cell':'_onEditAmount','change input.filter':'_onFilterChange','click .match .load-more a':'_onLoadMore','click .match .mv_line td':'_onSelectMoveLine','click .accounting_view tbody .mv_line td':'_onSelectProposition','click .o_reconcile_models button':'_onQuickCreateProposition','click .create .add_line':'_onCreateProposition','click .reconcile_model_create':'_onCreateReconcileModel','click .reconcile_model_edit':'_onEditReconcileModel','keyup input':'_onInputKeyup','blur input':'_onInputKeyup','keydown':'_onKeydown',},custom_events:_.extend({},FieldManagerMixin.custom_events,{'field_changed':'_onFieldChanged',}),_avoidFieldUpdate:{},MV_LINE_DEBOUNCE:200,_onKeydown:function(ev){switch(ev.which){case $.ui.keyCode.ENTER:this.trigger_up('navigation_move',{direction:'validate',handle:this.handle});break;case $.ui.keyCode.UP:ev.stopPropagation();ev.preventDefault();this.trigger_up('navigation_move',{direction:'up',handle:this.handle});break;case $.ui.keyCode.DOWN:ev.stopPropagation();ev.preventDefault();this.trigger_up('navigation_move',{direction:'down',handle:this.handle});break;}},init:function(parent,model,state){this._super(parent);FieldManagerMixin.init.call(this);this.model=model;this._initialState=state;if(this.MV_LINE_DEBOUNCE){this._onSelectMoveLine=_.debounce(this._onSelectMoveLine,this.MV_LINE_DEBOUNCE,true);}else{this._onSelectMoveLine=this._onSelectMoveLine;}},start:function(){var self=this;var def1=this._makePartnerRecord(this._initialState.st_line.partner_id,this._initialState.st_line.partner_name).then(function(recordID){self.fields={partner_id:new relational_fields.FieldMany2One(self,'partner_id',self.model.get(recordID),{mode:'edit',attrs:{placeholder:self._initialState.st_line.communication_partner_name||_t('Select Partner'),}})};self.fields.partner_id.insertAfter(self.$('.accounting_view caption .o_buttons'));});var def3=session.user_has_group('analytic.group_analytic_tags').then(function(has_group){self.group_tags=has_group;});var def4=session.user_has_group('analytic.group_analytic_accounting').then(function(has_group){self.group_acc=has_group;});$('<span class="line_info_button fa fa-info-circle"/>').appendTo(this.$('thead .cell_info_popover')).attr("data-content",qweb.render('reconciliation.line.statement_line.details',{'state':this._initialState}));this.$el.popover({'selector':'.line_info_button','placement':'left','container':this.$el,'html':true,'sanitize':false,'trigger':'hover','animation':false,'toggle':'popover'});var def2=this._super.apply(this,arguments);return Promise.all([def1,def2,def3,def4]);},update:function(state){var self=this;var to_check_checked=!!(state.to_check);let buttonDisplayed;if(state.balance.type===-1){buttonDisplayed='invalid';}else if(state.balance.type===0){buttonDisplayed='validate';}else if(state.balance.type===1){buttonDisplayed=to_check_checked?'validate':'reconcile';}
const buttons={'validate':this.$('caption .o_buttons button.o_validate'),'reconcile':this.$('caption .o_buttons button.o_reconcile'),'invalid':this.$('caption .o_buttons .o_no_valid'),};Object.entries(buttons).forEach(([name,$button])=>$button.toggleClass('d-none',name!==buttonDisplayed));self.$('caption .o_buttons button.o_validate').toggleClass('text-warning',to_check_checked);this._makePartnerRecord(state.st_line.partner_id,state.st_line.partner_name).then(function(recordID){self.fields.partner_id.reset(self.model.get(recordID));self.$el.attr('data-partner',state.st_line.partner_id);});this.$el.data('mode',state.mode).attr('data-mode',state.mode);this.$('.o_notebook li a').attr('aria-selected',false);this.$('.o_notebook li a').removeClass('active');this.$('.o_notebook .tab-content .tab-pane').removeClass('active');this.$('.o_notebook li a[href*="notebook_page_'+state.mode+'"]').attr('aria-selected',true);this.$('.o_notebook li a[href*="notebook_page_'+state.mode+'"]').addClass('active');this.$('.o_notebook .tab-content .tab-pane[id*="notebook_page_'+state.mode+'"]').addClass('active');this.$('.create, .match').each(function(){$(this).removeAttr('style');});var $props=this.$('.accounting_view tbody').empty();var props=[];var balance=state.balance.amount_currency;_.each(state.reconciliation_proposition,function(prop){if(prop.display){props.push(prop);}});_.each(props,function(line){var $line=$(qweb.render("reconciliation.line.mv_line",{'line':line,'state':state,'proposition':true}));if(!isNaN(line.id)){$('<span class="line_info_button fa fa-info-circle"/>').appendTo($line.find('.cell_info_popover')).attr("data-content",qweb.render('reconciliation.line.mv_line.details',{'line':line}));}
$props.append($line);});var matching_modes=self.model.modes.filter(x=>x.startsWith('match'));for(let i=0;i<matching_modes.length;i++){var stateMvLines=state['mv_lines_'+matching_modes[i]]||[];var recs_count=stateMvLines.length>0?stateMvLines[0].recs_count:0;var remaining=state['remaining_'+matching_modes[i]];var $mv_lines=this.$('div[id*="notebook_page_'+matching_modes[i]+'"] .match table tbody').empty();this.$('.o_notebook li a[href*="notebook_page_'+matching_modes[i]+'"]').parent().toggleClass('d-none',stateMvLines.length===0&&!state['filter_'+matching_modes[i]]);_.each(stateMvLines,function(line){var $line=$(qweb.render("reconciliation.line.mv_line",{'line':line,'state':state}));if(!isNaN(line.id)){$('<span class="line_info_button fa fa-info-circle"/>').appendTo($line.find('.cell_info_popover')).attr("data-content",qweb.render('reconciliation.line.mv_line.details',{'line':line}));}
$mv_lines.append($line);});this.$('div[id*="notebook_page_'+matching_modes[i]+'"] .match div.load-more').toggle(remaining>0);this.$('div[id*="notebook_page_'+matching_modes[i]+'"] .match div.load-more span').text(remaining);}
this.$('.popover').remove();this.$('table tfoot').html(qweb.render("reconciliation.line.balance",{'state':state}));if(state.createForm){var createPromise;if(!this.fields.account_id){createPromise=this._renderCreate(state);}
Promise.resolve(createPromise).then(function(){var data=self.model.get(self.handleCreateRecord).data;return self.model.notifyChanges(self.handleCreateRecord,state.createForm).then(function(){return self.model.notifyChanges(self.handleCreateRecord,{analytic_tag_ids:{operation:'REPLACE_WITH',ids:[]}})}).then(function(){var defs=[];_.each(state.createForm.analytic_tag_ids,function(tag){defs.push(self.model.notifyChanges(self.handleCreateRecord,{analytic_tag_ids:{operation:'ADD_M2M',ids:tag}}));});return Promise.all(defs);}).then(function(){return self.model.notifyChanges(self.handleCreateRecord,{tax_ids:{operation:'REPLACE_WITH',ids:[]}})}).then(function(){var defs=[];_.each(state.createForm.tax_ids,function(tag){defs.push(self.model.notifyChanges(self.handleCreateRecord,{tax_ids:{operation:'ADD_M2M',ids:tag}}));});return Promise.all(defs);}).then(function(){var record=self.model.get(self.handleCreateRecord);_.each(self.fields,function(field,fieldName){if(self._avoidFieldUpdate[fieldName])return;if(fieldName==="partner_id")return;if((data[fieldName]||state.createForm[fieldName])&&!_.isEqual(state.createForm[fieldName],data[fieldName])){field.reset(record);}
if(fieldName==='tax_ids'){if(!state.createForm[fieldName].length||state.createForm[fieldName].length>1){$('.create_force_tax_included').addClass('d-none');}
else{$('.create_force_tax_included').removeClass('d-none');var price_include=state.createForm[fieldName][0].price_include;var force_tax_included=state.createForm[fieldName][0].force_tax_included;self.$('.create_force_tax_included input').prop('checked',force_tax_included);self.$('.create_force_tax_included input').prop('disabled',price_include);}}});if(state.to_check){self.$('.create_to_check input').prop('checked',state.to_check).change();}
return true;});});}
this.$('.create .add_line').toggle(!!state.balance.amount_currency);},updatePartialAmount:function(line_id,amount){var $line=this.$('.mv_line[data-line-id='+line_id+']');$line.find('.edit_amount').addClass('d-none');$line.find('.edit_amount_input').removeClass('d-none');$line.find('.edit_amount_input').focus();$line.find('.edit_amount_input').val(amount);$line.find('.line_amount').addClass('d-none');},_destroyPopover:function($el){var popover=$el.data('bs.popover');if(popover){popover.dispose();}},_makePartnerRecord:function(partnerID,partnerName){var field={relation:'res.partner',type:'many2one',name:'partner_id',};if(partnerID){field.value=[partnerID,partnerName];}
return this.model.makeRecord('account.bank.statement.line',[field],{partner_id:{domain:["|",["is_company","=",true],["parent_id","=",false]],options:{no_open:true}}});},_renderCreate:function(state){var self=this;return this.model.makeRecord('account.bank.statement.line',[{relation:'account.account',type:'many2one',name:'account_id',domain:[['company_id','=',state.st_line.company_id],['deprecated','=',false]],},{relation:'account.journal',type:'many2one',name:'journal_id',domain:[['company_id','=',state.st_line.company_id],['type','=','general']],},{relation:'account.tax',type:'many2many',name:'tax_ids',domain:[['company_id','=',state.st_line.company_id]],},{relation:'account.analytic.account',type:'many2one',name:'analytic_account_id',domain:["|",['company_id','=',state.st_line.company_id],['company_id','=',false]]},{relation:'account.analytic.tag',type:'many2many',name:'analytic_tag_ids',},{type:'boolean',name:'force_tax_included',},{type:'char',name:'label',},{type:'float',name:'amount',},{type:'char',name:'date',},{type:'boolean',name:'to_check',}],{account_id:{string:_t("Account"),},label:{string:_t("Label")},amount:{string:_t("Account")},}).then(function(recordID){self.handleCreateRecord=recordID;var record=self.model.get(self.handleCreateRecord);self.fields.account_id=new relational_fields.FieldMany2One(self,'account_id',record,{mode:'edit',attrs:{can_create:false}});self.fields.journal_id=new relational_fields.FieldMany2One(self,'journal_id',record,{mode:'edit'});self.fields.tax_ids=new relational_fields.FieldMany2ManyTags(self,'tax_ids',record,{mode:'edit',additionalContext:{append_type_to_tax_name:true}});self.fields.analytic_account_id=new relational_fields.FieldMany2One(self,'analytic_account_id',record,{mode:'edit'});self.fields.analytic_tag_ids=new relational_fields.FieldMany2ManyTags(self,'analytic_tag_ids',record,{mode:'edit'});self.fields.force_tax_included=new basic_fields.FieldBoolean(self,'force_tax_included',record,{mode:'edit'});self.fields.label=new basic_fields.FieldChar(self,'label',record,{mode:'edit'});self.fields.amount=new basic_fields.FieldFloat(self,'amount',record,{mode:'edit'});self.fields.date=new basic_fields.FieldDate(self,'date',record,{mode:'edit'});self.fields.to_check=new basic_fields.FieldBoolean(self,'to_check',record,{mode:'edit'});var $create=$(qweb.render("reconciliation.line.create",{'state':state,'group_tags':self.group_tags,'group_acc':self.group_acc}));self.fields.account_id.appendTo($create.find('.create_account_id .o_td_field')).then(addRequiredStyle.bind(self,self.fields.account_id));self.fields.journal_id.appendTo($create.find('.create_journal_id .o_td_field'));self.fields.tax_ids.appendTo($create.find('.create_tax_id .o_td_field'));self.fields.analytic_account_id.appendTo($create.find('.create_analytic_account_id .o_td_field'));self.fields.analytic_tag_ids.appendTo($create.find('.create_analytic_tag_ids .o_td_field'));self.fields.force_tax_included.appendTo($create.find('.create_force_tax_included .o_td_field'));self.fields.label.appendTo($create.find('.create_label .o_td_field')).then(addRequiredStyle.bind(self,self.fields.label));self.fields.amount.appendTo($create.find('.create_amount .o_td_field')).then(addRequiredStyle.bind(self,self.fields.amount));self.fields.date.appendTo($create.find('.create_date .o_td_field'));self.fields.to_check.appendTo($create.find('.create_to_check .o_td_field'));self.$('.create').append($create);function addRequiredStyle(widget){widget.$el.addClass('o_required_modifier');}});},_onStopPropagation:function(ev){ev.stopPropagation();},_onCreateReconcileModel:function(event){event.preventDefault();var self=this;this.do_action({type:'ir.actions.act_window',res_model:'account.reconcile.model',views:[[false,'form']],target:'current'},{on_reverse_breadcrumb:function(){self.trigger_up('reload');},});},_editAmount:function(event){event.stopPropagation();var $line=$(event.target);var moveLineId=$line.closest('.mv_line').data('line-id');this.trigger_up('partial_reconcile',{'data':{mvLineId:moveLineId,'amount':$line.val()}});},_onEditAmount:function(event){event.preventDefault();event.stopPropagation();if(!$(event.target).hasClass('edit_amount_input')){var $line=$(event.target);this.trigger_up('getPartialAmount',{'data':$line.closest('.mv_line').data('line-id')});}},_onEditReconcileModel:function(event){event.preventDefault();var self=this;this.do_action({type:'ir.actions.act_window',res_model:'account.reconcile.model',views:[[false,'list'],[false,'form']],view_mode:"list",target:'current'},{on_reverse_breadcrumb:function(){self.trigger_up('reload');},});},_onFieldChanged:function(event){event.stopPropagation();var fieldName=event.target.name;if(fieldName==='partner_id'){var partner_id=event.data.changes.partner_id;this.trigger_up('change_partner',{'data':partner_id});}else{if(event.data.changes.amount&&isNaN(event.data.changes.amount)){return;}
this.trigger_up('update_proposition',{'data':event.data.changes});}},_onTogglePanel:function(){if(this.$el[0].getAttribute('data-mode')=='inactive')
this.trigger_up('change_mode',{'data':'default'});},_onChangeTab:function(event){if(event.currentTarget.nodeName==='TFOOT'){this.trigger_up('change_mode',{'data':'next'});}else{var modes=this.model.modes;var selected_mode=modes.find(function(e){return event.target.getAttribute('href').includes(e)});if(selected_mode){this.trigger_up('change_mode',{'data':selected_mode});}}},_onFilterChange:function(event){this.trigger_up('change_filter',{'data':_.str.strip($(event.target).val())});},_onInputKeyup:function(event){var target_partner_id=$(event.target).parents('[name="partner_id"]');if(target_partner_id.length===1){return;}
if(event.keyCode===13){if($(event.target).hasClass('edit_amount_input')){$(event.target).blur();return;}
var created_lines=_.findWhere(this.model.lines,{mode:'create'});if(created_lines&&created_lines.balance.amount){this._onCreateProposition();}
return;}
if($(event.target).hasClass('edit_amount_input')){if(event.type==='keyup'){return;}
else{return this._editAmount(event);}}
var self=this;for(var fieldName in this.fields){var field=this.fields[fieldName];if(!field.$el.is(event.target)){continue;}
this._avoidFieldUpdate[field.name]=event.type!=='focusout';field.value=false;field._setValue($(event.target).val()).then(function(){self._avoidFieldUpdate[field.name]=false;});break;}},_onLoadMore:function(ev){ev.preventDefault();this.trigger_up('change_offset');},_onSelectMoveLine:function(event){var $el=$(event.target);$el.prop('disabled',true);this._destroyPopover($el);var moveLineId=$el.closest('.mv_line').data('line-id');this.trigger_up('add_proposition',{'data':moveLineId});},_onSelectProposition:function(event){var $el=$(event.target);this._destroyPopover($el);var moveLineId=$el.closest('.mv_line').data('line-id');this.trigger_up('remove_proposition',{'data':moveLineId});},_onQuickCreateProposition:function(event){document.activeElement&&document.activeElement.blur();this.trigger_up('quick_create_proposition',{'data':$(event.target).data('reconcile-model-id')});},_onCreateProposition:function(){document.activeElement&&document.activeElement.blur();var invalid=[];_.each(this.fields,function(field){if(!field.isValid()){invalid.push(field.string);}});if(invalid.length){this.do_warn(_t("Some fields are undefined"),invalid.join(', '));return;}
this.trigger_up('create_proposition');},_onValidate:function(){this.trigger_up('validate');}});var ManualRenderer=StatementRenderer.extend({template:"reconciliation.manual.statement",});var ManualLineRenderer=LineRenderer.extend({template:"reconciliation.manual.line",removeProposition:function(handle,id){if(!id){return Promise.resolve();}
return this._super(handle,id);},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){return self.model.makeRecord('account.move.line',[{relation:'account.account',type:'many2one',name:'account_id',value:[self._initialState.account_id.id,self._initialState.account_id.display_name],}]).then(function(recordID){self.fields.title_account_id=new relational_fields.FieldMany2One(self,'account_id',self.model.get(recordID),{mode:'readonly'});}).then(function(){return self.fields.title_account_id.appendTo(self.$('.accounting_view thead td:eq(0) span:first'));});});},update:function(state){this._super(state);var props=_.filter(state.reconciliation_proposition,{'display':true});if(!props.length){var $line=$(qweb.render("reconciliation.line.mv_line",{'line':{},'state':state}));this.$('.accounting_view tbody').append($line);}},_renderCreate:function(state){var self=this;var parentPromise=this._super(state).then(function(){self.$('.create .create_journal_id').show();self.$('.create .create_date').removeClass('d-none');self.$('.create .create_journal_id .o_input').addClass('o_required_modifier');});return parentPromise;},});return{StatementRenderer:StatementRenderer,ManualRenderer:ManualRenderer,LineRenderer:LineRenderer,ManualLineRenderer:ManualLineRenderer,};});;

/* /account/static/src/js/account_payment_field.js defined in bundle 'web.assets_backend' */
odoo.define('account.payment',function(require){"use strict";var AbstractField=require('web.AbstractField');var core=require('web.core');var field_registry=require('web.field_registry');var field_utils=require('web.field_utils');var QWeb=core.qweb;var _t=core._t;var ShowPaymentLineWidget=AbstractField.extend({events:_.extend({'click .outstanding_credit_assign':'_onOutstandingCreditAssign',},AbstractField.prototype.events),supportedFieldTypes:['char'],isSet:function(){return true;},_render:function(){var self=this;var info=JSON.parse(this.value);if(!info){this.$el.html('');return;}
_.each(info.content,function(k,v){k.index=v;k.amount=field_utils.format.float(k.amount,{digits:k.digits});if(k.date){k.date=field_utils.format.date(field_utils.parse.date(k.date,{},{isUTC:true}));}});this.$el.html(QWeb.render('ShowPaymentInfo',{lines:info.content,outstanding:info.outstanding,title:info.title}));_.each(this.$('.js_payment_info'),function(k,v){var isRTL=_t.database.parameters.direction==="rtl";var content=info.content[v];var options={content:function(){var $content=$(QWeb.render('PaymentPopOver',{name:content.name,journal_name:content.journal_name,date:content.date,amount:content.amount,currency:content.currency,position:content.position,payment_id:content.payment_id,payment_method_name:content.payment_method_name,move_id:content.move_id,ref:content.ref,account_payment_id:content.account_payment_id,}));$content.filter('.js_unreconcile_payment').on('click',self._onRemoveMoveReconcile.bind(self));$content.filter('.js_open_payment').on('click',self._onOpenPayment.bind(self));return $content;},html:true,placement:isRTL?'bottom':'left',title:'Payment Information',trigger:'focus',delay:{"show":0,"hide":100},container:$(k).parent(),};$(k).popover(options);});},_onOpenPayment:function(event){var paymentId=parseInt($(event.target).attr('payment-id'));var moveId=parseInt($(event.target).attr('move-id'));var res_model;var id;if(paymentId!==undefined&&!isNaN(paymentId)){res_model="account.payment";id=paymentId;}else if(moveId!==undefined&&!isNaN(moveId)){res_model="account.move";id=moveId;}
if(res_model&&id){this.do_action({type:'ir.actions.act_window',res_model:res_model,res_id:id,views:[[false,'form']],target:'current'});}},_onOutstandingCreditAssign:function(event){event.stopPropagation();event.preventDefault();var self=this;var id=$(event.target).data('id')||false;this._rpc({model:'account.move',method:'js_assign_outstanding_line',args:[JSON.parse(this.value).move_id,id],}).then(function(){self.trigger_up('reload');});},_onRemoveMoveReconcile:function(event){var self=this;var paymentId=parseInt($(event.target).attr('payment-id'));if(paymentId!==undefined&&!isNaN(paymentId)){this._rpc({model:'account.move.line',method:'remove_move_reconcile',args:[paymentId],context:{'move_id':this.res_id},}).then(function(){self.trigger_up('reload');});}},});field_registry.add('payment',ShowPaymentLineWidget);return{ShowPaymentLineWidget:ShowPaymentLineWidget};});;

/* /account/static/src/js/mail_activity.js defined in bundle 'web.assets_backend' */
odoo.define('account.activity',function(require){"use strict";var AbstractField=require('web.AbstractField');var core=require('web.core');var field_registry=require('web.field_registry');var QWeb=core.qweb;var _t=core._t;var VatActivity=AbstractField.extend({className:'o_journal_activity_kanban',events:{'click .see_all_activities':'_onOpenAll','click .see_activity':'_onOpenActivity',},init:function(){this.MAX_ACTIVITY_DISPLAY=5;this._super.apply(this,arguments);},_render:function(){var self=this;var info=JSON.parse(this.value);if(!info){this.$el.html('');return;}
info.more_activities=false;if(info.activities.length>this.MAX_ACTIVITY_DISPLAY){info.more_activities=true;info.activities=info.activities.slice(0,this.MAX_ACTIVITY_DISPLAY);}
this.$el.html(QWeb.render('accountJournalDashboardActivity',info));},_onOpenActivity:function(e){e.preventDefault();var self=this;self.do_action({type:'ir.actions.act_window',name:_t('Journal Entry'),target:'current',res_id:$(e.target).data('resId'),res_model:'account.move',views:[[false,'form']],});},_onOpenAll:function(e){e.preventDefault();var self=this;self.do_action({type:'ir.actions.act_window',name:_t('Journal Entries'),res_model:'account.move',views:[[false,'kanban'],[false,'form']],search_view_id:[false],domain:[['journal_id','=',self.res_id],['activity_ids','!=',false]],});}})
field_registry.add('kanban_vat_activity',VatActivity);return VatActivity;});;

/* /account/static/src/js/tax_group.js defined in bundle 'web.assets_backend' */
odoo.define('account.tax_group',function(require){"use strict";var core=require('web.core');var session=require('web.session');var fieldRegistry=require('web.field_registry');var AbstractField=require('web.AbstractField');var fieldUtils=require('web.field_utils');var QWeb=core.qweb;var TaxGroupCustomField=AbstractField.extend({events:{'click .tax_group_edit':'_onClick','keydown .oe_tax_group_editable .tax_group_edit_input input':'_onKeydown','blur .oe_tax_group_editable .tax_group_edit_input input':'_onBlur',},_changeTaxValueByTaxGroup:function(taxGroupId,deltaAmount){const self=this;function applyChange(line_id){let debitAmount=0;let creditAmount=0;let amount_currency=0;if(line_id.data.currency_id){if(self.record.data.type==="in_invoice"){amount_currency=line_id.data.amount_currency-deltaAmount;}else{amount_currency=line_id.data.amount_currency+deltaAmount;}}else{let balance=line_id.data.price_subtotal;balance-=deltaAmount;if(self.record.data.type==="in_invoice"){if(balance>0){debitAmount=balance;}else if(balance<0){creditAmount=-balance;}}else{if(balance>0){creditAmount=balance;}else if(balance<0){debitAmount=-balance;}}}
self.trigger_up('field_changed',{dataPointID:self.record.id,changes:{line_ids:{operation:"UPDATE",id:line_id.id,data:{amount_currency:amount_currency,debit:debitAmount,credit:creditAmount}}},initialEvent:{dataPointID:line_id.id,changes:{amount_currency:amount_currency,debit:debitAmount,credit:creditAmount},},});}
let line_id=self.record.data.line_ids.data.find(elem=>elem.data.tax_group_id&&elem.data.tax_group_id.data.id===taxGroupId);if(line_id){applyChange(line_id);}else{const{limit,id,count}=self.record.data.line_ids;let offset=count-limit;self.trigger_up('load',{id,limit,offset,on_success:value=>{line_id=value.data.find(elem=>elem.data.tax_group_id&&elem.data.tax_group_id.data.id===taxGroupId);applyChange(line_id);},});}},_isPurchaseDocument:function(){return this.record.data.type==="in_invoice"||this.record.data.type==='in_refund';},_render:function(){var self=this;var displayEditWidget=self._isPurchaseDocument()&&this.record.data.state==='draft'&&this.getParent().mode==='edit';this.$el.html($(QWeb.render('AccountTaxGroupTemplate',{lines:self.value,displayEditWidget:displayEditWidget,})));},_onBlur:function(ev){ev.preventDefault();var $input=$(ev.target);var newValue=$input.val();var currency=session.get_currency(this.record.data.currency_id.data.id);try{newValue=fieldUtils.parse.float(newValue);newValue=fieldUtils.format.float(newValue,null,{digits:currency.digits});newValue=fieldUtils.parse.float(newValue);}catch(err){$input.addClass('o_field_invalid');return;}
var oldValue=$input.data('originalValue');if(newValue===oldValue||newValue===0){return this._render();}
var taxGroupId=$input.parents('.oe_tax_group_editable').data('taxGroupId');this._changeTaxValueByTaxGroup(taxGroupId,oldValue-newValue);},_onClick:function(ev){ev.preventDefault();var $taxGroupElement=$(ev.target).parents('.oe_tax_group_editable');$taxGroupElement.find('.tax_group_edit').addClass('d-none');$taxGroupElement.find('.tax_group_edit_input').removeClass('d-none');var $input=$taxGroupElement.find('.tax_group_edit_input input');var formatedOriginalValue=fieldUtils.format.float($input.data('originalValue'),{},{});$input.focus();$input.val(formatedOriginalValue);},_onKeydown:function(ev){switch(ev.which){case $.ui.keyCode.ENTER:case $.ui.keyCode.TAB:$(ev.target).blur();}},});fieldRegistry.add('tax-group-custom-field',TaxGroupCustomField)});;

/* /account/static/src/js/bank_statement.js defined in bundle 'web.assets_backend' */
odoo.define('account.bank_statement',function(require){"use strict";var KanbanController=require("web.KanbanController");var ListController=require("web.ListController");var includeDict={renderButtons:function(){this._super.apply(this,arguments);if(this.hasButtons&&this.modelName==="account.bank.statement"){var data=this.model.get(this.handle);if(data.context.journal_type!=='cash'){this.$buttons.find('button.o_button_import').hide();}}}};KanbanController.include(includeDict);ListController.include(includeDict);});;

/* /account/static/src/js/section_and_note_fields_backend.js defined in bundle 'web.assets_backend' */
odoo.define('account.section_and_note_backend',function(require){"use strict";var FieldChar=require('web.basic_fields').FieldChar;var FieldOne2Many=require('web.relational_fields').FieldOne2Many;var fieldRegistry=require('web.field_registry');var ListFieldText=require('web.basic_fields').ListFieldText;var ListRenderer=require('web.ListRenderer');var SectionAndNoteListRenderer=ListRenderer.extend({_renderBodyCell:function(record,node,index,options){var $cell=this._super.apply(this,arguments);var isSection=record.data.display_type==='line_section';var isNote=record.data.display_type==='line_note';if(isSection||isNote){if(node.attrs.widget==="handle"){return $cell;}else if(node.attrs.name==="name"){var nbrColumns=this._getNumberOfCols();if(this.handleField){nbrColumns--;}
if(this.addTrashIcon){nbrColumns--;}
$cell.attr('colspan',nbrColumns);}else{$cell.removeClass('o_invisible_modifier');return $cell.addClass('o_hidden');}}
return $cell;},_renderRow:function(record,index){var $row=this._super.apply(this,arguments);if(record.data.display_type){$row.addClass('o_is_'+record.data.display_type);}
return $row;},_renderView:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.$('.o_list_table').addClass('o_section_and_note_list_view');});}});var SectionAndNoteFieldOne2Many=FieldOne2Many.extend({_getRenderer:function(){if(this.view.arch.tag==='tree'){return SectionAndNoteListRenderer;}
return this._super.apply(this,arguments);},});var SectionAndNoteFieldText=function(parent,name,record,options){var isSection=record.data.display_type==='line_section';var Constructor=isSection?FieldChar:ListFieldText;return new Constructor(parent,name,record,options);};fieldRegistry.add('section_and_note_one2many',SectionAndNoteFieldOne2Many);fieldRegistry.add('section_and_note_text',SectionAndNoteFieldText);return SectionAndNoteListRenderer;});;

/* /account/static/src/js/tours/account.js defined in bundle 'web.assets_backend' */
odoo.define('account.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('account_tour',{'skip_enabled':true,},[{trigger:".o_form_readonly .o_invoice_validate",extra_trigger:'.o_invoice_form',content:_t("Click to <b>validate your invoice.</b> A reference will be assigned to this invoice and you will not be able to modify it anymore."),position:"right"},{trigger:".o_invoice_send",extra_trigger:'.o_invoice_form',content:_t("Click to <b>send the invoice by email.</b>"),position:"bottom"},{trigger:".o_mail_send",content:_t("Click to <b>send the invoice.</b>"),position:"bottom"}]);});;

/* /account/static/src/js/bills_tree_upload.js defined in bundle 'web.assets_backend' */
odoo.define('account.upload.bill.mixin',function(require){"use strict";var core=require('web.core');var _t=core._t;var qweb=core.qweb;var UploadBillMixin={start:function(){this.fileUploadID=_.uniqueId('account_bill_file_upload');$(window).on(this.fileUploadID,this._onFileUploaded.bind(this));return this._super.apply(this,arguments);},_onAddAttachment:function(ev){var $input=$(ev.currentTarget).find('input.o_input_file');if($input.val()!==''){var $binaryForm=this.$('.o_vendor_bill_upload form.o_form_binary_form');$binaryForm.submit();}},_onFileUploaded:function(){var self=this;var attachments=Array.prototype.slice.call(arguments,1);var attachent_ids=attachments.reduce(function(filtered,record){if(record.id){filtered.push(record.id);}
return filtered;},[]);return this._rpc({model:'account.journal',method:'create_invoice_from_attachment',args:["",attachent_ids],context:this.initialState.context,}).then(function(result){self.do_action(result);}).catch(function(){self.$('.o_vendor_bill_upload .o_input_file').val('');});},_onUpload:function(event){var self=this;var $formContainer=this.$('.o_content').find('.o_vendor_bill_upload');if(!$formContainer.length){$formContainer=$(qweb.render('account.BillsHiddenUploadForm',{widget:this}));$formContainer.appendTo(this.$('.o_content'));}
this.$('.o_vendor_bill_upload .o_input_file').click();},}
return UploadBillMixin;});odoo.define('account.bills.tree',function(require){"use strict";var core=require('web.core');var ListController=require('web.ListController');var ListView=require('web.ListView');var UploadBillMixin=require('account.upload.bill.mixin');var viewRegistry=require('web.view_registry');var BillsListController=ListController.extend(UploadBillMixin,{buttons_template:'BillsListView.buttons',events:_.extend({},ListController.prototype.events,{'click .o_button_upload_bill':'_onUpload','change .o_vendor_bill_upload .o_form_binary_form':'_onAddAttachment',}),});var BillsListView=ListView.extend({config:_.extend({},ListView.prototype.config,{Controller:BillsListController,}),});viewRegistry.add('account_tree',BillsListView);});odoo.define('account.dashboard.kanban',function(require){"use strict";var core=require('web.core');var KanbanController=require('web.KanbanController');var KanbanView=require('web.KanbanView');var UploadBillMixin=require('account.upload.bill.mixin');var viewRegistry=require('web.view_registry');var DashboardKanbanController=KanbanController.extend(UploadBillMixin,{events:_.extend({},KanbanController.prototype.events,{'click .o_button_upload_bill':'_onUpload','change .o_vendor_bill_upload .o_form_binary_form':'_onAddAttachment',}),_onUpload:function(event){var kanbanRecord=$(event.currentTarget).closest('.o_kanban_record').data('record');this.initialState.context['default_journal_id']=kanbanRecord.id;if($(event.currentTarget).attr('journal_type')=='sale'){this.initialState.context['default_type']='out_invoice'}else if($(event.currentTarget).attr('journal_type')=='purchase'){this.initialState.context['default_type']='in_invoice'}
UploadBillMixin._onUpload.apply(this,arguments);}});var DashboardKanbanView=KanbanView.extend({config:_.extend({},KanbanView.prototype.config,{Controller:DashboardKanbanController,}),});viewRegistry.add('account_dashboard_kanban',DashboardKanbanView);});;

/* /account/static/src/js/account_selection.js defined in bundle 'web.assets_backend' */
odoo.define('account.hierarchy.selection',function(require){"use strict";var core=require('web.core');var relational_fields=require('web.relational_fields');var _t=core._t;var registry=require('web.field_registry');var FieldSelection=relational_fields.FieldSelection;var qweb=core.qweb;var HierarchySelection=FieldSelection.extend({_renderEdit:function(){var self=this;var prom=Promise.resolve()
if(!self.hierarchy_groups){prom=this._rpc({model:'account.account.type',method:'read',args:[_.filter(_.map(this.values,v=>v[0]),v=>typeof v=='number'),['internal_group'],],}).then(function(arg){self.hierarchy_groups=[{'name':_('Balance Sheet'),'children':[{'name':_t('Assets'),'ids':_.map(_.filter(arg,v=>v['internal_group']=='asset'),v=>v['id'])},{'name':_t('Liabilities'),'ids':_.map(_.filter(arg,v=>v['internal_group']=='liability'),v=>v['id'])},{'name':_t('Equity'),'ids':_.map(_.filter(arg,v=>v['internal_group']=='equity'),v=>v['id'])},],},{'name':_t('Profit & Loss'),'children':[{'name':_t('Income'),'ids':_.map(_.filter(arg,v=>v['internal_group']=='income'),v=>v['id'])},{'name':_t('Expense'),'ids':_.map(_.filter(arg,v=>v['internal_group']=='expense'),v=>v['id'])},],},{'name':_t('Other'),'ids':_.map(_.filter(arg,v=>!['asset','liability','equity','income','expense'].includes(v['internal_group'])),v=>v['id'])},]});}
Promise.resolve(prom).then(function(){self.$el.empty();self._addHierarchy(self.$el,self.hierarchy_groups,0);var value=self.value;if(self.field.type==='many2one'&&value){value=value.data.id;}
self.$el.val(JSON.stringify(value));});},_addHierarchy:function(el,group,level){var self=this;_.each(group,function(item){var optgroup=$('<optgroup/>').attr(({'label':$('<div/>').html('&nbsp;'.repeat(6*level)+item['name']).text(),}))
_.each(item['ids'],function(id){var value=_.find(self.values,v=>v[0]==id)
optgroup.append($('<option/>',{value:JSON.stringify(value[0]),text:value[1],}));})
el.append(optgroup)
if(item['children']){self._addHierarchy(el,item['children'],level+1);}})}});registry.add("account_hierarchy_selection",HierarchySelection);});;

/* /account_bank_statement_import/static/src/js/account_bank_statement_import.js defined in bundle 'web.assets_backend' */
odoo.define('account_bank_statement_import.import',function(require){"use strict";var core=require('web.core');var BaseImport=require('base_import.import');var _t=core._t;BaseImport.DataImport.include({renderImportLink:function(){this._super();if(this.res_model=='account.bank.statement'){this.$(".import-link").prop({"text":_t(" Import Template for Bank Statements"),"href":"/account_bank_statement_import/static/csv/account.bank.statement.csv"});this.$(".template-import").removeClass('d-none');}},});});;

/* /account_invoice_extract/static/src/js/invoice_extract_box.js defined in bundle 'web.assets_backend' */
odoo.define('account_invoice_extract.Box',function(require){"use strict";var Widget=require('web.Widget');var InvoiceExtractBox=Widget.extend({events:{'click':'_onClick'},template:'account_invoice_extract.Box',init:function(parent,data){this._super.apply(this,arguments);this._angle=data.box_angle;this._fieldName=data.feature;this._height=data.box_height;this._id=data.id;this._isOcrChosen=data.selected_status!==0;this._isSelected=data.user_selected;this._midX=data.box_midX;this._midY=data.box_midY;this._text=data.text;this._width=data.box_width;this._$boxLayer=data.$boxLayer;},start:function(){if(this._isSelected){this.trigger_up('select_invoice_extract_box',{box:this,});}
if(this._isOcrChosen){this.trigger_up('choice_ocr_invoice_extract_box',{box:this,});}
return this._super.apply(this,arguments);},destroy:function(){this.trigger_up('destroy_invoice_extract_box',{box:this,});this._super.apply(this,arguments);},getFieldName:function(){return this._fieldName;},getID:function(){return this._id;},getStyle:function(){return'left:'+(this._midX*parseInt(this._$boxLayer[0].style.width))+'px;'+'top:'+(this._midY*parseInt(this._$boxLayer[0].style.height))+'px;'+'width:'+((this._width)*parseInt(this._$boxLayer[0].style.width))+'px;'+'height:'+((this._height)*parseInt(this._$boxLayer[0].style.height))+'px;'+'transform: translate(-50%, -50%) rotate('+this._angle+'deg);'+'-ms-transform: translate(-50%, -50%) rotate('+this._angle+'deg);'+'-webkit-transform: translate(-50%, -50%) rotate('+this._angle+'deg);';},isOcrChosen:function(){return this._isOcrChosen;},isSelected:function(){return this._isSelected;},setSelected:function(){if(!this._isSelected){this._isSelected=true;this.$el.addClass('selected');}},unsetOcrChosen:function(){if(this._isOcrChosen){this._isOcrChosen=false;this.$el.removeClass('ocr_chosen');}},unsetSelected:function(){if(this._isSelected){this._isSelected=false;this.$el.removeClass('selected');}},_onClick:function(ev){ev.stopPropagation();this.trigger_up('click_invoice_extract_box',{box:this,});},});return InvoiceExtractBox;});;

/* /account_invoice_extract/static/src/js/invoice_extract_box_layer.js defined in bundle 'web.assets_backend' */
odoo.define('account_invoice_extract.BoxLayer',function(require){"use strict";var InvoiceExtractBox=require('account_invoice_extract.Box');var Widget=require('web.Widget');var InvoiceExtractBoxLayer=Widget.extend({events:{'click':'_onClick',},className:'boxLayer',init:function(parent,data){var self=this;this._super.apply(this,arguments);this._boxes=[];this._boxesData=data.boxesData;this._mode=data.mode;this._pageNum=data.pageNum||0;this._$buttons=data.$buttons;this._$page=data.$page;this._$textLayer=data.$textLayer;this._boxesData=_.filter(this._boxesData,function(boxData){return boxData.page===self._pageNum;});},start:function(){var self=this;if(this._isOnPDF()){this.el.style.width=this._$textLayer[0].style.width;this.el.style.height=this._$textLayer[0].style.height;this._$page[0].style.height='calc(100% - '+this._$buttons.height()+'px)';}else if(this._isOnImg()){this.el.style.width=this._$page[0].clientWidth+'px';this.el.style.height=this._$page[0].clientHeight+'px';this.el.style.left=this._$page[0].offsetLeft+'px';this.el.style.top=this._$page[0].offsetTop+'px';}
this._boxes=[];_.forEach(this._boxesData,function(boxData){var box=new InvoiceExtractBox(self,_.extend({},boxData,{$boxLayer:self.$el,}));box.appendTo(self.$el).then(function(){box.do_hide();self._boxes.push(box);});});return this._super.apply(this,arguments);},displayBoxes:function(params){var selectedFieldName=params.fieldName;_.each(this._boxes,function(box){if(box.getFieldName()===selectedFieldName){box.do_show();}else{box.do_hide();}});},setTextLayer:function(params){var $textLayer=params.$textLayer;this._$textLayer=$textLayer;},_isOnImg:function(){return this._mode==='img';},_isOnPDF:function(){return this._mode==='pdf';},_onClick:function(ev){this.trigger_up('click_invoice_extract_box_layer');},});return InvoiceExtractBoxLayer;});;

/* /account_invoice_extract/static/src/js/invoice_extract_field.js defined in bundle 'web.assets_backend' */
odoo.define('account_invoice_extract.Field',function(require){"use strict";var InvoiceExtractFieldButton=require('account_invoice_extract.FieldButton');var Class=require('web.Class');var field_utils=require('web.field_utils');var Mixins=require('web.mixins');var InvoiceExtractField=Class.extend(Mixins.EventDispatcherMixin,{custom_events:{click_invoice_extract_field_button:'_onClickInvoiceExtractFieldButton'},init:function(parent,params){Mixins.EventDispatcherMixin.init.call(this,arguments);this.setParent(parent);this._button=undefined;this._isActive=false;this._name=params.fieldName;this._text=params.text;this._ocrChosenBox=undefined;this._selectedBox=undefined;},getSelectedBox:function(){return this._selectedBox;},getName:function(){return this._name;},handleFieldChanged:function(params){var fieldChangedInfo=params.fieldChangedInfo;var state=params.state;var changes={};switch(this._name){case'date':changes={invoice_date:field_utils.parse.date(fieldChangedInfo.split(' ')[0])};break;case'supplier':if(_.isNumber(fieldChangedInfo)){changes={partner_id:{id:fieldChangedInfo}};}
break;case'VAT_Number':changes={partner_id:{id:fieldChangedInfo}};break;case'due_date':changes={invoice_date_due:field_utils.parse.date(fieldChangedInfo.split(' ')[0])};break;case'invoice_id':changes={ref:fieldChangedInfo};break;case'currency':changes={currency_id:{id:fieldChangedInfo}};break;}
return changes;},isActive:function(){return this._isActive;},renderButton:function(params){this._button=new InvoiceExtractFieldButton(this,{fieldName:this._name,isActive:this._isActive,text:this._text,});return this._button.appendTo(params.$container);},setActive:function(){if(!this._isActive){this._isActive=true;if(this._button){this._button.setActive();}}},setInactive:function(){if(this._isActive){this._isActive=false;if(this._button){this._button.setInactive();}}},resetSelection:function(){this._ocrChosenBox=undefined;this._selectedBox=undefined;},setOcrChosenBox:function(box){this._ocrChosenBox=box;if(!this._selectedBox){this._selectedBox=this._ocrChosenBox;this._ocrChosenBox.setSelected();}},setSelectedBox:function(box){if(this._selectedBox){this._selectedBox.unsetSelected();}
this._selectedBox=box;if(this._ocrChosenBox&&this._selectedBox!==this._ocrChosenBox){this._ocrChosenBox.unsetSelected();}
this._selectedBox.setSelected();},unselectBox:function(){if(!this._selectedBox){return;}
if(this._ocrChosenBox&&this._ocrChosenBox.isSelected()){this._selectedBox=undefined;this._ocrChosenBox.unsetSelected();this._ocrChosenBox.unsetOcrChosen();this._ocrChosenBox=undefined;}else if(this._ocrChosenBox){this._selectedBox.unsetSelected();this._selectedBox=this._ocrChosenBox;this._ocrChosenBox.setSelected();}else{this._selectedBox.unsetSelected();this._selectedBox=undefined;}},unsetBox:function(box){if(this._ocrChosenBox===this._selectedBox&&this._ocrChosenBox===box){this._ocrChosenBox=this._selectedBox=undefined;}else if(this._ocrChosenBox===box){this._ocrChosenBox=undefined;}else{this._selectedBox=this._ocrSelectedBox;}},_onClickInvoiceExtractFieldButton:function(ev){ev.stopPropagation();this.trigger_up('active_invoice_extract_field',{fieldName:this._name,});},});return InvoiceExtractField;});;

/* /account_invoice_extract/static/src/js/invoice_extract_field_button.js defined in bundle 'web.assets_backend' */
odoo.define('account_invoice_extract.FieldButton',function(require){"use strict";var Widget=require('web.Widget');var InvoiceExtractFieldButton=Widget.extend({events:{'click':'_onClick',},template:'account_invoice_extract.Button',init:function(parent,params){this._super.apply(this,arguments);this._fieldName=params.fieldName;this._isActive=params.isActive||false;this._text=params.text;},getFieldName:function(){return this._fieldName;},getText:function(){return this._text;},isActive:function(){return this._isActive;},setActive:function(){this._isActive=true;if(this.$el){this.$el.addClass('active');}},setInactive:function(){this._isActive=false;if(this.$el){this.$el.removeClass('active');}},_onClick:function(ev){ev.stopPropagation();this.trigger_up('click_invoice_extract_field_button');},});return InvoiceExtractFieldButton;});;

/* /account_invoice_extract/static/src/js/invoice_extract_fields.js defined in bundle 'web.assets_backend' */
odoo.define('account_invoice_extract.Fields',function(require){"use strict";var InvoiceExtractField=require('account_invoice_extract.Field');var Class=require('web.Class');var Mixins=require('web.mixins');var ServicesMixin=require('web.ServicesMixin');var session=require('web.session');var InvoiceExtractFields=Class.extend(Mixins.EventDispatcherMixin,ServicesMixin,{custom_events:{active_invoice_extract_field:'_onActiveInvoiceExtractField',},init:function(parent,is_customer_invoice=false){var self=this;Mixins.EventDispatcherMixin.init.call(this,arguments);this.setParent(parent);var vendor_text='Vendor';if(is_customer_invoice){vendor_text='Customer';}
this._fields=[new InvoiceExtractField(this,{text:'VAT',fieldName:'VAT_Number'}),new InvoiceExtractField(this,{text:vendor_text,fieldName:'supplier'}),new InvoiceExtractField(this,{text:'Date',fieldName:'date'}),new InvoiceExtractField(this,{text:'Due Date',fieldName:'due_date'}),new InvoiceExtractField(this,{text:'Vendor Reference',fieldName:'invoice_id'}),];this._fields[0].setActive();session.user_has_group('base.group_multi_currency').then(function(has_multi_currency){if(has_multi_currency){self._fields.push(new InvoiceExtractField(self,{text:'Currency',fieldName:'currency'}));}});},getActiveField:function(){return _.find(this._fields,function(field){return field.isActive();});},getField:function(params){params=params||{};if(!params.name){return this.getActiveField();}
return _.find(this._fields,function(field){return field.getName()===params.name;});},renderButtons:function(params){var proms=[];_.each(this._fields,function(field){proms.push(field.renderButton(params));});return Promise.all(proms);},resetActive:function(){var oldActiveField=this.getActiveField();if(!oldActiveField){return;}
oldActiveField.setInactive();this._fields[0].setActive();},resetFieldsSelections:function(){_.each(this._fields,function(field){field.resetSelection();});},_onActiveInvoiceExtractField:function(ev){var oldActiveField=this.getActiveField();if(!oldActiveField){return;}
oldActiveField.setInactive();var field=this.getField({name:ev.data.fieldName});if(!field){return;}
field.setActive();},});return InvoiceExtractFields;});;

/* /account_invoice_extract/static/src/js/invoice_extract_form_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('account_invoice_extract.FormRenderer',function(require){"use strict";var InvoiceExtractBoxLayer=require('account_invoice_extract.BoxLayer');var InvoiceExtractFields=require('account_invoice_extract.Fields');var FormRenderer=require('web.FormRenderer');var InvoiceExtractFormRenderer=FormRenderer.extend({custom_events:_.extend({},FormRenderer.prototype.custom_events,{active_invoice_extract_field:'_onActiveInvoiceExtractField',preview_attachment_validation:'_onAttachmentPreviewValidation',choice_ocr_invoice_extract_box:'_onChoiceOcrInvoiceExtractBox',click_invoice_extract_box:'_onClickInvoiceExtractBox',click_invoice_extract_box_layer:'_onClickInvoiceExtractBoxLayer',destroy_invoice_extract_box:'_onDestroyInvoiceExtractBox',select_invoice_extract_box:'_onSelectInvoiceExtractBox',}),init:function(){this._super.apply(this,arguments);this._res_id=-1;this._invoiceExtractBoxData=[];this._invoiceExtractBoxLayers=[];var is_customer_invoice=false;if(this.state.context.default_type=='out_invoice'||this.state.context.default_type=='out_refund')
is_customer_invoice=true;this._invoiceExtractFields=new InvoiceExtractFields(this,is_customer_invoice);this._$invoiceExtractButtons=[];},_destroyInvoiceExtract:function(){_.invoke(this._invoiceExtractBoxLayers,'destroy');this._res_id=-1;this._invoiceExtractBoxData=[];this._invoiceExtractBoxLayers=[];this._invoiceExtractFields.resetActive();if(this._$invoiceExtractButtons.length){this._$invoiceExtractButtons.remove();}
this._$invoiceExtractButtons=[];},_displayInvoiceExtractBoxes:function(){var field=this._invoiceExtractFields.getActiveField();if(!field){return;}
_.each(this._invoiceExtractBoxLayers,function(boxLayer){boxLayer.displayBoxes({fieldName:field.getName()});});},_handleInvoiceExtractFieldChanged:function(params){var fieldChangedInfo=params.fieldChangedInfo;var field=this._invoiceExtractFields.getActiveField();if(!field){return;}
var changes=field.handleFieldChanged({fieldChangedInfo:fieldChangedInfo,state:this.state,});if(!_.isEmpty(changes)){this.trigger_up('field_changed',{dataPointID:this.state.id,changes:changes,});}},_initInvoiceExtract:function($page){var self=this;this._res_id=this.state.res_id;this._rpc({model:'account.move',method:'get_boxes',args:[this.state.res_id],}).then(function(boxesData){self._invoiceExtractBoxData=boxesData;self._renderInvoiceExtractBoxLayers({$page:$page,}).then(function(){self._displayInvoiceExtractBoxes();});});},_renderInvoiceExtractButtons:function(){return this._invoiceExtractFields.renderButtons({$container:this._$invoiceExtractButtons,});},_renderInvoiceExtractBoxLayers:function(params){var $page=params.$page;var boxLayer;var proms=[];if($page.hasClass('img-fluid')){boxLayer=new InvoiceExtractBoxLayer(this,{boxesData:this._invoiceExtractBoxData,mode:'img',$page:$page,});proms.push(boxLayer.insertAfter($page));this._invoiceExtractBoxLayers=[boxLayer];}
if($page.is('iframe')){var $document=$page.contents();$document.find('head').append('<link rel="stylesheet" type="text/css" href="/account_invoice_extract/static/src/css/account_invoice_extract_box_layer.css"></link>');var $textLayers=$document.find('.textLayer');for(var index=0;index<$textLayers.length;index++){var $textLayer=$textLayers.eq(index);var pageNum=$textLayer[0].parentElement.dataset['pageNumber']-1;var existingBoxLayer=this._invoiceExtractBoxLayers.find(function(bl){return bl._pageNum==pageNum;});if(existingBoxLayer){existingBoxLayer.setTextLayer({$textLayer:$textLayer,});proms.push(existingBoxLayer.insertAfter($textLayer));}
else{boxLayer=new InvoiceExtractBoxLayer(this,{boxesData:this._invoiceExtractBoxData,mode:'pdf',pageNum:pageNum,$buttons:this._$invoiceExtractButtons,$page:$page,$textLayer:$textLayer,});proms.push(boxLayer.insertAfter($textLayer));this._invoiceExtractBoxLayers.push(boxLayer);}}}
return Promise.all(proms);},_startInvoiceExtract:function($attachment){var $ocrSuccess=this.$('.o_success_ocr');if($attachment.length!==0&&$ocrSuccess.length>0&&!$ocrSuccess.hasClass('o_invisible_modifier')&&this.mode==='edit'){if(this._res_id!=this.state.res_id){this._destroyInvoiceExtract();this._initInvoiceExtract($attachment);}
else if(this._invoiceExtractBoxData.length>0){var self=this;this._renderInvoiceExtractBoxLayers({$page:$attachment,}).then(function(){self._displayInvoiceExtractBoxes();});}
if(this._$invoiceExtractButtons.length==0){this._$invoiceExtractButtons=$('<div class="o_invoice_extract_buttons"/>');$attachment.before(this._$invoiceExtractButtons);this._renderInvoiceExtractButtons();}}else{this._destroyInvoiceExtract();}},_onActiveInvoiceExtractField:function(ev){ev.stopPropagation();this._displayInvoiceExtractBoxes();},_onAttachmentPreviewValidation:function(ev){ev.stopPropagation();var self=this;if(this.$attachmentPreview===undefined){return;}
this.$attachmentPreview.find('iframe').on("load",function(){var $iframe=self.$attachmentPreview.find('iframe');var $iframeDoc=self.$attachmentPreview.find('iframe').contents();$iframeDoc[0].addEventListener('pagerendered',function(){self._startInvoiceExtract($iframe);});});var $documentImg=self.$attachmentPreview.find('.img-fluid');var $attachment=$('#attachment_img');if($attachment.length&&$attachment[0].complete){this._startInvoiceExtract($documentImg);}else{this.$attachmentPreview.find('.img-fluid').on("load",function(){self._startInvoiceExtract($documentImg);});}},_onClickInvoiceExtractBox:function(ev){ev.stopPropagation();var self=this;var box=ev.data.box;var field=this._invoiceExtractFields.getActiveField();if(!field){return;}
this._rpc({model:'account.move',method:'set_user_selected_box',args:[[this.state.res_id],box.getID()],}).then(function(fieldChangedInfo){field.setSelectedBox(box);self._handleInvoiceExtractFieldChanged({fieldChangedInfo:fieldChangedInfo,});});},_onClickInvoiceExtractBoxLayer:function(ev){ev.stopPropagation();var self=this;var field=this._invoiceExtractFields.getActiveField();if(!field){return;}
var box=field.getSelectedBox();if(!box){return;}
field.unselectBox();this._rpc({model:'account.move',method:'remove_user_selected_box',args:[[this.state.res_id],box.getID()],}).then(function(fieldChangedInfo){self._handleInvoiceExtractFieldChanged({fieldChangedInfo:fieldChangedInfo,});});},_onChoiceOcrInvoiceExtractBox:function(ev){ev.stopPropagation();var box=ev.data.box;var field=this._invoiceExtractFields.getField({name:box.getFieldName(),});if(!field){return;}
field.setOcrChosenBox(box);},_onDestroyInvoiceExtractBox:function(ev){ev.stopPropagation();var box=ev.data.box;if(!box.isOcrChosen()&&!box.isSelected()){return;}
var field=this._invoiceExtractFields.getField({name:box.getFieldName(),});if(!field){return;}
field.unsetBox(box);},_onSelectInvoiceExtractBox:function(ev){ev.stopPropagation();var box=ev.data.box;var field=this._invoiceExtractFields.getField({name:box.getFieldName(),});if(!field){return;}
field.setSelectedBox(box);},});return InvoiceExtractFormRenderer;});;

/* /account_invoice_extract/static/src/js/invoice_extract_form_view.js defined in bundle 'web.assets_backend' */
odoo.define('account_invoice_extract.FormView',function(require){"use strict";var InvoiceExtractFormRenderer=require('account_invoice_extract.FormRenderer');var FormView=require('web.FormView');var view_registry=require('web.view_registry');var InvoiceExtractFormView=FormView.extend({config:_.extend({},FormView.prototype.config,{Renderer:InvoiceExtractFormRenderer,}),});view_registry.add('account_invoice_extract_preview',InvoiceExtractFormView);return InvoiceExtractFormView;});;

/* /account_online_sync/static/src/js/online_sync.js defined in bundle 'web.assets_backend' */
odoo.define('account_online_sync.acc_config_widget',function(require){"use strict";var core=require('web.core');var framework=require('web.framework');var AbstractAction=require('web.AbstractAction');var QWeb=core.qweb;var OnlineSyncAccountInstitutionSelector=AbstractAction.extend({template:'OnlineSyncSearchBank',init:function(parent,context){this._super(parent,context);this.search_allowed=true;this.starred_inst=context.starred_inst;this.sync_error_message=context.sync_error_message;this.results=this.starred_inst;if(context.context!==undefined){this.context=context.context;this.country=context.context.country;}
this.state=(this.sync_error_message!=='')?'error':'dashboard';},start:function(){this.displayState();},displayState:function(){var self=this;if(this.state==='error'){self.$('.sync_error').removeClass('d-none');self.renderSyncError();}
else if(this.state==='search'||(this.state==='dashboard'&&this.results.length>0)){self.$('.institutions_search').removeClass('d-none');self.$('.favorite_institutions_no_result').addClass('d-none');if(self.results.length>0){self.$('.institution_no_result').addClass('d-none');self.$('.institution_result').removeClass('d-none');self.renderSearchResult();}
else{self.$('.institution_no_result').removeClass('d-none');self.$('.institution_result').addClass('d-none');}}
else{self.$('.favorite_institutions_no_result').removeClass('d-none');self.$('.institutions_search').addClass('d-none');}},openInstitution:function($node){var self=this;if(self.willDisappear===true){return true;}
self.willDisappear=true;var provider=$node.data('provider');var instId=$node.data('instId');var beta=$node.data('beta')||false;self._rpc({model:'account.online.provider',method:'get_login_form',args:[[],instId,provider,beta],context:self.context,}).then(function(result){self.do_action(result);}).guardedCatch(function(){self.willDisappear=false;});},renderButtons:function($node){var self=this;this.$buttons=$(QWeb.render("OnlineSyncSearchBankFooter",{'widget':this}));this.$buttons.find('.js_cancel').click(function(e){self.do_action({type:'ir.actions.act_window_close'});});this.$buttons.find('.js_select_institution').click(function(e){if(self.selected){self.openInstitution(self.$('.js_institution[data-inst-id='+self.selected+']'));}});this.$buttons.find('.js_configure_manually').click(function(){return self.configure_manually()});this.$('.institution_no_result').find('.js_configure_manually').click(function(){return self.configure_manually()});this.$buttons.appendTo($node);},configure_manually:function(){var self=this;return self._rpc({model:'account.online.provider',method:'get_manual_configuration_form',context:self.context,}).then(function(action){self.do_action(action,{on_close:function(){core.bus.trigger("refresh_account_dashboard");},});});},renderElement:function(){var self=this;this._super();this.$('#search_form').submit(function(event){event.preventDefault();event.stopPropagation();self.searchInstitution();});this.$('#click_search_institution').click(function(){self.searchInstitution();});this.$('#search_institution').blur(function(){if(self.state!=='dashboard'&&self.$('#search_institution').val()===''){self.state='dashboard';self.displayState();}});this.$('.o_institution').click(function(e){self.openInstitution($(this));});this.$('.switch_country').click(function(e){if($(e.target).attr('value')!==self.country){self.switchCountry();}});},renderSyncError:function(){var self=this
self.$('.sync_error').html('');var $errorMessage=$(QWeb.render('OnlineSyncErrorMessage',{sync_error_message:self.sync_error_message}));$errorMessage.find('.js_configure_manually').click(function(){return self.configure_manually()});$errorMessage.appendTo(self.$('.sync_error'));},renderSearchResult:function(){var self=this;self.$('.institution_result').html('');var $searchResults=$(QWeb.render('OnlineSyncSearchBankTable',{institutions:self.results}));$searchResults.find('.js_institution').click(function(e){var instId=$(e.target).data('instId')||$(e.target).parents('.js_institution').data('instId');if(self.selected===instId){self.selected=false;self.$('.js_institution[data-inst-id='+instId+']').removeClass('selected');self.$buttons.find('.js_select_institution').prop('disabled',true);self.$buttons.find('.js_select_institution').toggleClass('btn-primary btn-secondary');}
else{self.selected=instId;self.$buttons.find('.js_select_institution').prop('disabled',false);self.$('.js_institution').removeClass('selected');self.$('.js_institution[data-inst-id='+instId+']').addClass('selected');self.$buttons.find('.js_select_institution').removeClass('btn-secondary');self.$buttons.find('.js_select_institution').addClass('btn-primary');}
self.$('.js_institution_detail:not(.d-none):not(#'+instId+')').addClass('d-none');self.$('#'+instId+'').toggleClass('d-none');});$searchResults.appendTo(self.$('.institution_result'));},searchInstitution:function(){var self=this;if(self.$('#search_institution').val()===''){self.state='dashboard';self.displayState();return true;}
if(self.search_allowed===true){self.search_allowed=false;self.selected=false;self.state='search';self.$buttons.find('.js_select_institution').prop('disabled',true);framework.blockUI();return this._rpc({model:'account.online.provider',method:'get_institutions',args:[[],self.$('#search_institution').val(),self.country==='worldwide'?false:self.country],}).then(function(result){framework.unblockUI();var results=JSON.parse(result);self.results=results.match||[];self.displayState();self.search_allowed=true;}).guardedCatch(function(){framework.unblockUI();self.search_allowed=true;self.$buttons.find('.js_select_institution').prop('disabled',false);});}},switchCountry:function(){if(this.country==='worldwide'){this.country=this.context.country;}
else{this.country='worldwide';}
this.displayState();if(this.$('#search_institution').val().length>0){this.searchInstitution();}},});core.action_registry.add('online_sync_institution_selector',OnlineSyncAccountInstitutionSelector);return{OnlineSyncAccountInstitutionSelector:OnlineSyncAccountInstitutionSelector,}});;

/* /hr_expense/static/src/js/documents_upload.js defined in bundle 'web.assets_backend' */
odoo.define('hr_expense.expenses.tree',function(require){"use strict";var DocumentUploadMixin=require('hr_expense.documents.upload.mixin');var KanbanController=require('web.KanbanController');var KanbanView=require('web.KanbanView');var ListController=require('web.ListController');var ListView=require('web.ListView');var viewRegistry=require('web.view_registry');var ExpensesListController=ListController.extend(DocumentUploadMixin,{buttons_template:'ExpensesListView.buttons',events:_.extend({},ListController.prototype.events,{'click .o_button_upload_expense':'_onUpload','change .o_expense_documents_upload .o_form_binary_form':'_onAddAttachment',}),});var ExpensesListView=ListView.extend({config:_.extend({},ListView.prototype.config,{Controller:ExpensesListController,}),});var ExpensesKanbanController=KanbanController.extend(DocumentUploadMixin,{buttons_template:'ExpensesKanbanView.buttons',events:_.extend({},KanbanController.prototype.events,{'click .o_button_upload_expense':'_onUpload','change .o_expense_documents_upload .o_form_binary_form':'_onAddAttachment',}),});var ExpensesKanbanView=KanbanView.extend({config:_.extend({},KanbanView.prototype.config,{Controller:ExpensesKanbanController,}),});viewRegistry.add('hr_expense_tree',ExpensesListView);viewRegistry.add('hr_expense_kanban',ExpensesKanbanView);});;

/* /hr_expense/static/src/js/upload_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('hr_expense.documents.upload.mixin',function(require){"use strict";var core=require('web.core');var _t=core._t;var qweb=core.qweb;var DocumentUploadMixin={start:function(){this.fileUploadID=_.uniqueId('hr_expense_document_upload');$(window).on(this.fileUploadID,this._onFileUploaded.bind(this));return this._super.apply(this,arguments);},_onAddAttachment:function(ev){var $input=$(ev.currentTarget).find('input.o_input_file');if($input.val()!==''){var $binaryForm=this.$('.o_expense_documents_upload form.o_form_binary_form');$binaryForm.submit();}},_onFileUploaded:function(){var self=this;var attachments=Array.prototype.slice.call(arguments,1);var attachent_ids=attachments.reduce(function(filtered,record){if(record.id){filtered.push(record.id);}
return filtered;},[]);if(!attachent_ids.length){return self.do_notify(_t("Error"),_t("An error occurred during the upload"));}
return this._rpc({model:'hr.expense',method:'create_expense_from_attachments',args:["",attachent_ids],context:this.initialState.context,}).then(function(result){self.do_action(result);});},_onUpload:function(event){var self=this;var $formContainer=this.$('.o_content').find('.o_expense_documents_upload');if(!$formContainer.length){$formContainer=$(qweb.render('hr.expense.DocumentsHiddenUploadForm',{widget:this}));$formContainer.appendTo(this.$('.o_content'));}
this.$('.o_expense_documents_upload .o_input_file').click();},};return DocumentUploadMixin;});;

/* /snailmail_account/static/src/js/snailmail_account_notification_manager.js defined in bundle 'web.assets_backend' */
odoo.define('snailmail_account.NotificationManager',function(require){"use strict";var AbstractService=require('web.AbstractService');var core=require("web.core");var SnailmailAccountNotificationManager=AbstractService.extend({dependencies:['bus_service'],start:function(){this._super.apply(this,arguments);this.call('bus_service','onNotification',this,this._onNotification);},_onNotification:function(notifs){var self=this;_.each(notifs,function(notif){var model=notif[0][1];var type=notif[1].type;if(model==='res.partner'&&type==='snailmail_invalid_address'){self.do_warn(notif[1].title,notif[1].message);}});}});core.serviceRegistry.add('snailmail_account_notification_service',SnailmailAccountNotificationManager);return SnailmailAccountNotificationManager;});;

/* /account_bank_statement_import_csv/static/src/js/import_bank_stmt.js defined in bundle 'web.assets_backend' */
odoo.define('bank_stmt_import_csv.import',function(require){"use strict";var core=require('web.core');var BaseImport=require('base_import.import')
var QWeb=core.qweb;var _t=core._t;var _lt=core._lt;var DataImportStmt=BaseImport.DataImport.extend({init:function(parent,action){this._super.apply(this,arguments);action.display_name=_t('Import Bank Statement');this.filename=action.params.filename||{};this.first_load=true;},start:function(){var self=this;return this._super().then(function(res){self.id=self.parent_context.wizard_id;self.$('input[name=import_id]').val(self.id);self['loaded_file']();});},create_model:function(){return Promise.resolve();},import_options:function(){var options=this._super();options['bank_stmt_import']=true;return options;},onfile_loaded:function(){var self=this;if(this.first_load){this.$('.oe_import_file_show').val(this.filename);this.$('.oe_import_file_reload').hide();this.first_load=false;self['settings_changed']();}
else{this.$('.oe_import_file_reload').show();this._super();}},call_import:function(kwargs){var self=this;var superProm=self._super.apply(this,arguments);superProm.then(function(message){if(message.ids){self.statement_line_ids=message.ids}});return superProm;},exit:function(){this.do_action({name:_t("Reconciliation on Bank Statements"),context:{'statement_line_ids':this.statement_line_ids},type:'ir.actions.client',tag:'bank_statement_reconciliation_view'});},});core.action_registry.add('import_bank_stmt',DataImportStmt);return{DataImportStmt:DataImportStmt,};});;

/* /account_plaid/static/src/js/plaid.js defined in bundle 'web.assets_backend' */
odoo.define('account_plaid.acc_config_widget',function(require){"use strict";var ajax=require('web.ajax');var core=require('web.core');var AbstractAction=require('web.AbstractAction');var PlaidAccountConfigurationWidget=AbstractAction.extend({on_attach_callback:function(){if(this.exit===true){this.do_action({type:'ir.actions.act_window_close'});}},init:function(parent,context){var self=this;this._super(parent,context);this.context=context.context;this.exit=false;this.loaded=new Promise(function(resolve){self._loadedResolver=resolve;});this.institution_id=context.institution_id;this.plaid_link=context.open_link;this.account_online_provider_id=context.account_online_provider_id;this.public_key=context.public_key;this.public_token=context.public_token;this.environment=context.environment||'production';if(context.result){this.result=context.result;}},willStart:function(){var self=this;if(this.plaid_link===true){ajax.loadJS('https://cdn.plaid.com/link/v2/stable/link-initialize.js').then(function(){var plaid_options={clientName:'Odoo',env:self.environment,key:self.public_key,product:['transactions'],onSuccess:function(public_token,metadata){if(self.public_token===undefined){return self.linkSuccess(public_token,metadata);}
else{self.exit=true;self._loadedResolver();}},onExit:function(err,metadata){if(err){console.log(err);console.log(metadata);}
self.exit=true;self._loadedResolver();},}
if(self.public_token!==undefined){plaid_options['token']=self.public_token;}
self.plaid_link=Plaid.create(plaid_options);if(self.public_token!==undefined){self.plaid_link.open();}
else{self.plaid_link.open(self.institution_id);}});}
else{this._loadedResolver();}
return this.loaded;},linkSuccess:function(public_token,metadata){var self=this;metadata.environment=self.environment;return this._rpc({model:'account.online.provider',method:'link_success',args:[[self.id],public_token,metadata],context:self.context,}).then(function(result){self.do_action(result);});},renderElement:function(){var self=this;if(this.exit===true){return this._super.apply(this,arguments);}},});core.action_registry.add('plaid_online_sync_widget',PlaidAccountConfigurationWidget);});;

/* /account_ponto/static/src/js/ponto.js defined in bundle 'web.assets_backend' */
odoo.define('account_ponto.acc_config_widget',function(require){"use strict";var ajax=require('web.ajax');var core=require('web.core');var _t=core._t;var AbstractAction=require('web.AbstractAction');var QWeb=core.qweb;var PontoAccountConfigurationWidget=AbstractAction.extend({template:'PontoTemplate',init:function(parent,context){this._super(parent,context);this.create=context.context.method==='add';this.context=context.context;this.record_id=context.record_id&&[context.record_id]||[];},renderButtons:function($node){var self=this;this.$buttons=$(QWeb.render("PontoTemplateFooter",{'widget':this}));this.$buttons.find('.js_ponto_continue').click(function(e){var client_id=$('.client_id').val()
var secret_id=$('.secret_id').val()
if(client_id&&secret_id){var credentials_to_encode=client_id+':'+secret_id;self._rpc({model:'account.online.provider',method:'success_callback',args:[self.record_id,credentials_to_encode],context:self.context,}).then(function(result){self.do_action(result);});}});this.$buttons.find('.js_cancel').click(function(e){self.do_action({type:'ir.actions.act_window_close'});});this.$buttons.appendTo($node);},});core.action_registry.add('ponto_online_sync_widget',PontoAccountConfigurationWidget);});;

/* /account_yodlee/static/src/js/yodlee.js defined in bundle 'web.assets_backend' */
odoo.define('account_yodlee.acc_config_widget',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var core=require('web.core');var QWeb=core.qweb;var YodleeAccountConfigurationWidget=AbstractAction.extend({template:'YodleeTemplate',init:function(parent,context){this._super(parent,context);this.userToken=context.userToken;this.fastlinkUrl=context.fastlinkUrl;this.accessTokens=context.accessTokens;this.beta=context.beta;this.state=context.state;this.callbackUrl=context.paramsUrl+
document.location.protocol+'//'+document.location.host+context.callbackUrl;},renderButtons:function($node){var self=this;if(this.userToken!==undefined){this.$buttons=$(QWeb.render("YodleeTemplateFooter",{'widget':this}));this.$buttons.find('.js_yodlee_continue').click(function(e){self.$('#yodleeForm').submit();});this.$buttons.appendTo($node);}},});var YodleeCallbackWidget=AbstractAction.extend({init:function(parent,context){this._super(parent,context);},willStart:function(){var self=this;var paramsUrl=$.bbq.getState();self.method=paramsUrl.state;var def=this._rpc({model:'account.online.provider',method:'callback_institution',args:[[],paramsUrl.provider_identifier,paramsUrl.state,paramsUrl.journal_id]}).then(function(result){self.do_action(result);});return Promise.all([this._super.apply(this,arguments),def]);},});core.action_registry.add('yodlee_online_sync_widget',YodleeAccountConfigurationWidget);core.action_registry.add('yodlee_callback_widget',YodleeCallbackWidget);});;

/* /account_accountant/static/src/js/move_line_list_view.js defined in bundle 'web.assets_backend' */
odoo.define('account_accountant.MoveLineListView',function(require){"use strict";var AttachmentViewer=require('mail_enterprise.AttachmentViewer');var config=require('web.config');var core=require('web.core');var ListController=require('web.ListController');var ListModel=require('web.ListModel');var ListRenderer=require('web.ListRenderer');var ListView=require('web.ListView');var viewRegistry=require('web.view_registry');var _t=core._t;var AccountMoveListModel=ListModel.extend({_fetchRelatedData:function(list,toFetch,fieldName){if(fieldName==='move_attachment_ids'&&config.device.size_class>=config.device.SIZES.XXL){var fieldsInfo=list.fieldsInfo[list.viewType][fieldName];fieldsInfo.__no_fetch=false;fieldsInfo.relatedFields={mimetype:{type:'char'},};}
return this._super.apply(this,arguments);},});var AccountMoveListController=ListController.extend({events:_.extend({},ListController.prototype.events,{'click .o_attachment_control':'_onToggleAttachment',}),custom_events:_.extend({},ListController.prototype.custom_events,{row_selected:'_onRowSelected',}),init:function(){this._super.apply(this,arguments);this.currentAttachments=[];this.hide_attachment=!!this.initialState.context.hide_attachment;this.last_selected=false;},_update:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.$('.o_content').addClass('o_move_line_list_view');self.currentAttachments=[];if(!self.$attachmentPreview&&config.device.size_class>=config.device.SIZES.XXL){self.$attachmentPreview=$('<div>',{class:'o_attachment_preview',}).append($('<p>',{class:'o_move_line_empty',text:_t("Choose a line to preview its attachments."),})).append($('<div>',{class:'o_attachment_control',}));self.$attachmentPreview.appendTo(self.$('.o_content'));self.$attachmentPreview.toggleClass('hidden',self.hide_attachment);}}).then(self._renderAttachmentPreview());},_renderAttachmentPreview:function(recordId){var self=this;if(_.filter(this.model.localData,function(value,key,object){return value.groupData==self.last_selected}).length){recordId=_.filter(this.model.localData,function(value,key,object){return value.groupData==self.last_selected})[0].data[0]}
if(!recordId){return Promise.resolve()}
var record=this.model.get(recordId||this.last_selected);var types=['pdf','image'];if(record.type==='list'){return;}
let attachments=record.data.move_attachment_ids.data.map(function(attachment){return{id:attachment.res_id,filename:attachment.data.filename,mimetype:attachment.data.mimetype,url:'/web/content/'+attachment.res_id+'?download=true',};});attachments=_.filter(attachments,function(attachment){var match=attachment.mimetype.match(types.join('|'));attachment.type=match?match[0]:false;return match;});var prom;if(!_.isEqual(_.pluck(this.currentAttachments,'id'),_.pluck(attachments,'id'))){if(this.attachmentViewer){this.attachmentViewer.updateContents(attachments);}else{this.attachmentViewer=new AttachmentViewer(this,attachments);}
prom=this.attachmentViewer.appendTo(this.$attachmentPreview.empty()).then(function(){self.$attachmentPreview.resizable({handles:'w',minWidth:400,maxWidth:900,});});}
return Promise.resolve(prom).then(function(){self.currentAttachments=attachments;if(!attachments.length){var $empty=$('<p>',{class:'o_move_line_without_attachment',text:_t("There is no attachment linked to this move."),});self.$attachmentPreview.empty().append($empty);}
$('<div>',{class:'o_attachment_control'}).appendTo(self.$attachmentPreview);});},_onToggleAttachment:function(){this.hide_attachment=!this.hide_attachment;this.$attachmentPreview.toggleClass('hidden');},_onRowSelected:function(ev){if(config.device.size_class>=config.device.SIZES.XXL){this.last_selected=ev.data.recordId;if(this.last_selected.includes('line')){this._renderAttachmentPreview(ev.data.recordId);}}},});var AccountMoveListRenderer=ListRenderer.extend({_selectRow:function(rowIndex){var self=this;var recordId=this._getRecordID(rowIndex);var currentRow=this.currentRow;return this._super.apply(this,arguments).then(function(){if(rowIndex!==currentRow){self.trigger_up('row_selected',{recordId:recordId,});}});},_onRowClicked:function(ev){ev.stopPropagation();var id=$(ev.currentTarget).data('id');if(id){this.trigger_up('row_selected',{recordId:id,});}},_renderGroupRow:function(group,groupLevel){var ret=this._super.apply(this,arguments);if(this.state.context.name_groupby){var $th=ret.find('th.o_group_name');$th.addClass('o_group_name_custom');var text_node=$th.contents().filter(function(){return this.nodeType==3;})[0];text_node.nodeValue=_.escape(text_node.nodeValue).replace(/(\*\*)(.*)\1/g,'<strong>$2</strong>').replace(/\s+\([0-9]+\)/,'');$(text_node).replaceWith($('<span>'+text_node.nodeValue+'</span>'));}
return ret;},_onToggleGroup:function(ev){var group=$(ev.currentTarget).closest('tr').data('group');if(group.model==='account.move.line'&&group.groupData&&group.groupData.model==='account.move'){this.trigger_up('row_selected',{recordId:group.groupData.id,});}
this._super.apply(this,arguments);},});var AccountMoveListView=ListView.extend({config:_.extend({},ListView.prototype.config,{Controller:AccountMoveListController,Model:AccountMoveListModel,Renderer:AccountMoveListRenderer,}),});viewRegistry.add('account_move_line_list',AccountMoveListView);return{AccountMoveListView:AccountMoveListView,AccountMoveListController:AccountMoveListController,AccountMoveListModel:AccountMoveListModel,AccountMoveListRenderer:AccountMoveListRenderer}});;

/* /account_accountant/static/src/js/tours/account_accountant.js defined in bundle 'web.assets_backend' */
odoo.define('account_accountant.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('account_accountant_tour',{'skip_enabled':true,},[{trigger:'.o_app[data-menu-xmlid="account_accountant.menu_accounting"]',content:_t('Ready to discover your new favorite <b>accounting app</b>? Get started by clicking here.'),position:'bottom',},{trigger:".o_invoice_new",extra_trigger:'div.o_view_controller:not(.o_has_banner) .o_account_kanban',content:_t("Let's start with a new customer invoice."),position:"bottom"},{trigger:".breadcrumb-item:not(.active):last",extra_trigger:"[data-id='open'].btn-primary, [data-id='open'].oe_active",content:_t("Use the path to quickly click back to <b>previous screens</b>, without reloading the page."),position:"bottom"},{trigger:'li a[data-menu-xmlid="account.menu_finance_reports"], div[data-menu-xmlid="account.menu_finance_reports"]',content:_t("Your reports are available in real time. <i>No need to close a fiscal year to get a Profit &amp; Loss statement or view the Balance Sheet.</i>"),position:"bottom"}]);});;

/* /account_reports/static/src/js/mail_activity.js defined in bundle 'web.assets_backend' */
odoo.define('account_reports.activity',function(require){"use strict";var core=require('web.core');var AccountActivity=require('account.activity');var _t=core._t;AccountActivity.include({events:_.extend({'click .o_open_vat_report':'_onOpenReport',},AccountActivity.prototype.events),_onOpenReport:function(e){e.stopPropagation();e.preventDefault();var self=this;var id=$(e.target).data('id')||false;if(id){this._rpc({model:'mail.activity',method:'action_open_tax_report',args:[id],}).then(function(action){self.do_action(action);});}}});});;

/* /account_reports/static/src/js/account_reports.js defined in bundle 'web.assets_backend' */
odoo.define('account_reports.account_report',function(require){'use strict';var core=require('web.core');var Context=require('web.Context');var AbstractAction=require('web.AbstractAction');var Dialog=require('web.Dialog');var datepicker=require('web.datepicker');var session=require('web.session');var field_utils=require('web.field_utils');var RelationalFields=require('web.relational_fields');var StandaloneFieldManagerMixin=require('web.StandaloneFieldManagerMixin');var WarningDialog=require('web.CrashManager').WarningDialog;var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var M2MFilters=Widget.extend(StandaloneFieldManagerMixin,{init:function(parent,fields){this._super.apply(this,arguments);StandaloneFieldManagerMixin.init.call(this);this.fields=fields;this.widgets={};},willStart:function(){var self=this;var defs=[this._super.apply(this,arguments)];_.each(this.fields,function(field,fieldName){defs.push(self._makeM2MWidget(field,fieldName));});return Promise.all(defs);},start:function(){var self=this;var $content=$(QWeb.render("m2mWidgetTable",{fields:this.fields}));self.$el.append($content);_.each(this.fields,function(field,fieldName){self.widgets[fieldName].appendTo($content.find('#'+fieldName+'_field'));});return this._super.apply(this,arguments);},_confirmChange:function(){var self=this;var result=StandaloneFieldManagerMixin._confirmChange.apply(this,arguments);var data={};_.each(this.fields,function(filter,fieldName){data[fieldName]=self.widgets[fieldName].value.res_ids;});this.trigger_up('value_changed',data);return result;},_makeM2MWidget:function(fieldInfo,fieldName){var self=this;var options={};options[fieldName]={options:{no_create_edit:true,no_create:true,}};return this.model.makeRecord(fieldInfo.modelName,[{fields:[{name:'id',type:'integer',},{name:'display_name',type:'char',}],name:fieldName,relation:fieldInfo.modelName,type:'many2many',value:fieldInfo.value,}],options).then(function(recordID){self.widgets[fieldName]=new RelationalFields.FieldMany2ManyTags(self,fieldName,self.model.get(recordID),{mode:'edit',});self._registerWidget(recordID,fieldName,self.widgets[fieldName]);});},});var accountReportsWidget=AbstractAction.extend({hasControlPanel:true,events:{'input .o_account_reports_filter_input':'filter_accounts','click .o_account_reports_summary':'edit_summary','click .js_account_report_save_summary':'save_summary','click .o_account_reports_footnote_icons':'delete_footnote','click .js_account_reports_add_footnote':'add_edit_footnote','click .js_account_report_foldable':'fold_unfold','click [action]':'trigger_action','click .o_account_reports_load_more span':'load_more','click .o_account_reports_table thead th':'selected_column','click .o_change_expected_date':'_onChangeExpectedDate',},custom_events:{'value_changed':function(ev){var self=this;self.report_options.partner_ids=ev.data.partner_ids;self.report_options.partner_categories=ev.data.partner_categories;self.report_options.analytic_accounts=ev.data.analytic_accounts;self.report_options.analytic_tags=ev.data.analytic_tags;return self.reload().then(function(){self.$searchview_buttons.find('.account_partner_filter').click();self.$searchview_buttons.find('.account_analytic_filter').click();});},},init:function(parent,action){this.actionManager=parent;this.report_model=action.context.model;if(this.report_model===undefined){this.report_model='account.report';}
this.financial_id=false;if(action.context.id){this.financial_id=action.context.id;}
this.odoo_context=action.context;this.report_options=action.options||false;this.ignore_session=action.ignore_session;if((action.ignore_session==='read'||action.ignore_session==='both')!==true){var persist_key='report:'+this.report_model+':'+this.financial_id+':'+session.company_id;this.report_options=JSON.parse(sessionStorage.getItem(persist_key))||this.report_options;}
return this._super.apply(this,arguments);},start:function(){var self=this;var extra_info=this._rpc({model:self.report_model,method:'get_report_informations',args:[self.financial_id,self.report_options],context:self.odoo_context,}).then(function(result){return self.parse_reports_informations(result);});return Promise.all([extra_info,this._super.apply(this,arguments)]).then(function(){self.render();});},parse_reports_informations:function(values){this.report_options=values.options;this.odoo_context=values.context;this.report_manager_id=values.report_manager_id;this.footnotes=values.footnotes;this.buttons=values.buttons;this.main_html=values.main_html;this.$searchview_buttons=$(values.searchview_html);this.persist_options();},persist_options:function(){if((this.ignore_session==='write'||this.ignore_session==='both')!==true){var persist_key='report:'+this.report_model+':'+this.financial_id+':'+session.company_id;sessionStorage.setItem(persist_key,JSON.stringify(this.report_options));}},do_show:function(){this._super.apply(this,arguments);this.update_cp();},update_cp:function(){if(!this.$buttons){this.renderButtons();}
var status={cp_content:{$buttons:this.$buttons,$searchview_buttons:this.$searchview_buttons,$pager:this.$pager,$searchview:this.$searchview,},};return this.updateControlPanel(status,{clear:true});},reload:function(){var self=this;return this._rpc({model:this.report_model,method:'get_report_informations',args:[self.financial_id,self.report_options],context:self.odoo_context,}).then(function(result){self.parse_reports_informations(result);return self.render();});},render:function(){var self=this;this.render_template();this.render_footnotes();this.render_searchview_buttons();this.update_cp();this.batch_fold(this.$('.js_account_report_foldable').filter(function(){return!$(this).data('unfolded');}));},render_template:function(){this.$('.o_content').html(this.main_html);this.$('.o_content').find('.o_account_reports_summary_edit').hide();this.$('[data-toggle="tooltip"]').tooltip();this._add_line_classes();},_add_line_classes:function(){var el=this.$el[0];var report_lines=el.getElementsByClassName('o_account_report_line');for(var l=0;l<report_lines.length;l++){var line=report_lines[l];var unfolded=line.dataset.unfolded;if(unfolded==='True'){line.parentNode.classList.add('o_js_account_report_parent_row_unfolded');}}
this.$('tr[data-parent-id]').addClass('o_js_account_report_inner_row');},filter_accounts:function(e){var self=this;var query=e.target.value.trim().toLowerCase();this.filterOn=false;this.$('.o_account_reports_level2').each(function(index,el){var $accountReportLineFoldable=$(el);var line_id=$accountReportLineFoldable.find('.o_account_report_line').data('id');var $childs=self.$('tr[data-parent-id="'+$.escapeSelector(String(line_id))+'"]');const lineNameEl=$accountReportLineFoldable.find('.account_report_line_name')[0];const displayName=lineNameEl.childNodes[0].nodeValue.trim();const accountCode=lineNameEl.dataset.accountCode||'';const accountName=displayName.slice(accountCode.length+1);const queryFound=accountCode.startsWith(query.split(' ')[0])||accountName.includes(query);$accountReportLineFoldable.toggleClass('o_account_reports_filtered_lines',!queryFound);$childs.toggleClass('o_account_reports_filtered_lines',!queryFound);if(!queryFound){self.filterOn=true;}});if(this.filterOn){this.$('.o_account_reports_level1.total').hide();}
else{this.$('.o_account_reports_level1.total').show();}
this.report_options['filter_accounts']=query;this.render_footnotes();},selected_column:function(e){var self=this;if(self.report_options.selected_column!==undefined){var col_number=Array.prototype.indexOf.call(e.currentTarget.parentElement.children,e.currentTarget)+1;if(self.report_options.selected_column&&self.report_options.selected_column==col_number){self.report_options.selected_column=-col_number;}else{self.report_options.selected_column=col_number;}
self.reload()}},_onChangeExpectedDate:function(event){var self=this;var targetID=parseInt($(event.target).attr('data-id'));var parentID=parseInt($(event.target).attr('parent-id').split("_")[1]);var $content=$(QWeb.render("paymentDateForm",{target_id:targetID}));var paymentDatePicker=new datepicker.DateWidget(this);paymentDatePicker.appendTo($content.find('div.o_account_reports_payment_date_picker'));var save=function(){return this._rpc({model:'res.partner',method:'change_expected_date',args:[[parentID],{move_line_id:parseInt($content.find("#target_id").val()),expected_pay_date:paymentDatePicker.getValue(),}],}).then(function(){self.reload();});};new Dialog(this,{title:'Odoo',size:'medium',$content:$content,buttons:[{text:_t('Save'),classes:'btn-primary',close:true,click:save},{text:_t('Cancel'),close:true}]}).open();},render_searchview_buttons:function(){var self=this;var $datetimepickers=this.$searchview_buttons.find('.js_account_reports_datetimepicker');var options={locale:moment.locale(),format:'L',icons:{date:"fa fa-calendar",},};$datetimepickers.each(function(){var name=$(this).find('input').attr('name');var defaultValue=$(this).data('default-value');$(this).datetimepicker(options);var dt=new datepicker.DateWidget(options);dt.replace($(this)).then(function(){dt.$el.find('input').attr('name',name);if(defaultValue){dt.setValue(moment(defaultValue));}});});_.each(this.$searchview_buttons.find('.js_format_date'),function(dt){var date_value=$(dt).html();$(dt).html((new moment(date_value)).format('ll'));});this.$searchview_buttons.find('.js_foldable_trigger').click(function(event){$(this).toggleClass('o_closed_menu o_open_menu');self.$searchview_buttons.find('.o_foldable_menu[data-filter="'+$(this).data('filter')+'"]').toggleClass('o_closed_menu');});_.each(self.report_options,function(k){if(k!==null&&k.filter!==undefined){self.$searchview_buttons.find('[data-filter="'+k.filter+'"]').addClass('selected');}});_.each(this.$searchview_buttons.find('.js_account_report_bool_filter'),function(k){$(k).toggleClass('selected',self.report_options[$(k).data('filter')]);});_.each(this.$searchview_buttons.find('.js_account_report_choice_filter'),function(k){$(k).toggleClass('selected',(_.filter(self.report_options[$(k).data('filter')],function(el){return''+el.id==''+$(k).data('id')&&el.selected===true;})).length>0);});$('.js_account_report_group_choice_filter',this.$searchview_buttons).each(function(i,el){var $el=$(el);var ids=$el.data('member-ids');$el.toggleClass('selected',_.every(self.report_options[$el.data('filter')],function(member){if(typeof member.id=='number'){return member.selected===(ids.indexOf(member.id)>-1);}else{return true;}}));});_.each(this.$searchview_buttons.find('.js_account_reports_one_choice_filter'),function(k){$(k).toggleClass('selected',''+self.report_options[$(k).data('filter')]===''+$(k).data('id'));});this.$searchview_buttons.find('.js_account_report_date_filter').click(function(event){self.report_options.date.filter=$(this).data('filter');var error=false;if($(this).data('filter')==='custom'){var date_from=self.$searchview_buttons.find('.o_datepicker_input[name="date_from"]');var date_to=self.$searchview_buttons.find('.o_datepicker_input[name="date_to"]');if(date_from.length>0){error=date_from.val()===""||date_to.val()==="";self.report_options.date.date_from=field_utils.parse.date(date_from.val());self.report_options.date.date_to=field_utils.parse.date(date_to.val());}
else{error=date_to.val()==="";self.report_options.date.date_to=field_utils.parse.date(date_to.val());}}
if(error){new WarningDialog(self,{title:_t("Odoo Warning"),},{message:_t("Date cannot be empty")}).open();}else{self.reload();}});this.$searchview_buttons.find('.js_account_report_bool_filter').click(function(event){var option_value=$(this).data('filter');self.report_options[option_value]=!self.report_options[option_value];if(option_value==='unfold_all'){self.unfold_all(self.report_options[option_value]);}
self.reload();});$('.js_account_report_group_choice_filter',this.$searchview_buttons).click(function(){var option_value=$(this).data('filter');var option_member_ids=$(this).data('member-ids')||[];var is_selected=$(this).hasClass('selected');_.each(self.report_options[option_value],function(el){el.selected=!is_selected&&(option_member_ids.indexOf(Number(el.id))>-1);});self.reload();});this.$searchview_buttons.find('.js_account_report_choice_filter').click(function(event){var option_value=$(this).data('filter');var option_id=$(this).data('id');_.filter(self.report_options[option_value],function(el){if(''+el.id==''+option_id){if(el.selected===undefined||el.selected===null){el.selected=false;}
el.selected=!el.selected;}else if(option_value==='ir_filters'){el.selected=false;}
return el;});self.reload();});this.$searchview_buttons.find('.js_account_reports_one_choice_filter').click(function(event){self.report_options[$(this).data('filter')]=$(this).data('id');self.reload();});this.$searchview_buttons.find('.js_account_report_date_cmp_filter').click(function(event){self.report_options.comparison.filter=$(this).data('filter');var error=false;var number_period=$(this).parent().find('input[name="periods_number"]');self.report_options.comparison.number_period=(number_period.length>0)?parseInt(number_period.val()):1;if($(this).data('filter')==='custom'){var date_from=self.$searchview_buttons.find('.o_datepicker_input[name="date_from_cmp"]');var date_to=self.$searchview_buttons.find('.o_datepicker_input[name="date_to_cmp"]');if(date_from.length>0){error=date_from.val()===""||date_to.val()==="";self.report_options.comparison.date_from=field_utils.parse.date(date_from.val());self.report_options.comparison.date_to=field_utils.parse.date(date_to.val());}
else{error=date_to.val()==="";self.report_options.comparison.date_to=field_utils.parse.date(date_to.val());}}
if(error){new WarningDialog(self,{title:_t("Odoo Warning"),},{message:_t("Date cannot be empty")}).open();}else{self.reload();}});if(this.report_options.partner){if(!this.M2MFilters){var fields={};if('partner_ids'in this.report_options){fields['partner_ids']={label:_t('Partners'),modelName:'res.partner',value:this.report_options.partner_ids.map(Number),};}
if('partner_categories'in this.report_options){fields['partner_categories']={label:_t('Tags'),modelName:'res.partner.category',value:this.report_options.partner_categories.map(Number),};}
if(!_.isEmpty(fields)){this.M2MFilters=new M2MFilters(this,fields);this.M2MFilters.appendTo(this.$searchview_buttons.find('.js_account_partner_m2m'));}}else{this.$searchview_buttons.find('.js_account_partner_m2m').append(this.M2MFilters.$el);}}
if(this.report_options.analytic){if(!this.M2MFilters){var fields={};if(this.report_options.analytic_accounts){fields['analytic_accounts']={label:_t('Accounts'),modelName:'account.analytic.account',value:this.report_options.analytic_accounts.map(Number),};}
if(this.report_options.analytic_tags){fields['analytic_tags']={label:_t('Tags'),modelName:'account.analytic.tag',value:this.report_options.analytic_tags.map(Number),};}
if(!_.isEmpty(fields)){this.M2MFilters=new M2MFilters(this,fields);this.M2MFilters.appendTo(this.$searchview_buttons.find('.js_account_analytic_m2m'));}}else{this.$searchview_buttons.find('.js_account_analytic_m2m').append(this.M2MFilters.$el);}}},format_date:function(moment_date){var date_format='YYYY-MM-DD';return moment_date.format(date_format);},renderButtons:function(){var self=this;this.$buttons=$(QWeb.render("accountReports.buttons",{buttons:this.buttons}));_.each(this.$buttons.siblings('button'),function(el){$(el).click(function(){self.$buttons.attr('disabled',true);return self._rpc({model:self.report_model,method:$(el).attr('action'),args:[self.financial_id,self.report_options],context:self.odoo_context,}).then(function(result){var doActionProm=self.do_action(result);self.$buttons.attr('disabled',false);return doActionProm;}).guardedCatch(function(){self.$buttons.attr('disabled',false);});});});return this.$buttons;},edit_summary:function(e){var $textarea=$(e.target).parents('.o_account_reports_body').find('textarea[name="summary"]');var height=Math.max($(e.target).parents('.o_account_reports_body').find('.o_account_report_summary').height(),100);var text=$textarea.val().replace(new RegExp('<br />','g'),'\n');$textarea.height(height);$textarea.val(text);$(e.target).parents('.o_account_reports_body').find('.o_account_reports_summary_edit').show();$(e.target).parents('.o_account_reports_body').find('.o_account_reports_summary').hide();$(e.target).parents('.o_account_reports_body').find('textarea[name="summary"]').focus();},save_summary:function(e){var self=this;var text=$(e.target).siblings().val().replace(/[ \t]+/g,' ');return this._rpc({model:'account.report.manager',method:'write',args:[this.report_manager_id,{summary:text}],context:this.odoo_context,}).then(function(result){self.$el.find('.o_account_reports_summary_edit').hide();self.$el.find('.o_account_reports_summary').show();if(!text){var $content=$("<input type='text' class='o_input' name='summary'/>");$content.attr('placeholder',_t('Add a note'));}else{var $content=$('<span />').text(text).html(function(i,value){return value.replace(/\n/g,'<br>');});}
return $(e.target).parent().siblings('.o_account_reports_summary').find('> .o_account_report_summary').html($content);});},render_footnotes:function(){var self=this;var $dom_footnotes=self.$el.find('.js_account_report_line_footnote:not(.folded)');$dom_footnotes.html('');var number=1;var footnote_to_render=[];_.each($dom_footnotes,function(el){if($(el).parents('.o_account_reports_filtered_lines').length>0){return;}
var line_id=$(el).data('id');var footnote=_.filter(self.footnotes,function(footnote){return''+footnote.line===''+line_id;});if(footnote.length!==0){$(el).html('<sup><b class="o_account_reports_footnote_sup"><a href="#footnote'+number+'">'+number+'</a></b></sup>');footnote[0].number=number;number+=1;footnote_to_render.push(footnote[0]);}});return this._rpc({model:this.report_model,method:'get_html_footnotes',args:[self.financial_id,footnote_to_render],context:self.odoo_context,}).then(function(result){return self.$el.find('.js_account_report_footnotes').html(result);});},add_edit_footnote:function(e){var self=this;var line_id=$(e.target).data('id');var existing_footnote=_.filter(self.footnotes,function(footnote){return''+footnote.line===''+line_id;});var text='';if(existing_footnote.length!==0){text=existing_footnote[0].text;}
var $content=$(QWeb.render('accountReports.footnote_dialog',{text:text,line:line_id}));var save=function(){var footnote_text=$('.js_account_reports_footnote_note').val().replace(/[ \t]+/g,' ');if(!footnote_text&&existing_footnote.length===0){return;}
if(existing_footnote.length!==0){if(!footnote_text){return self.$el.find('.footnote[data-id="'+existing_footnote[0].id+'"] .o_account_reports_footnote_icons').click();}
return this._rpc({model:'account.report.footnote',method:'write',args:[existing_footnote[0].id,{text:footnote_text}],context:this.odoo_context,}).then(function(result){_.each(self.footnotes,function(footnote){if(footnote.id===existing_footnote[0].id){footnote.text=footnote_text;}});return self.render_footnotes();});}
else{return this._rpc({model:'account.report.footnote',method:'create',args:[{line:line_id,text:footnote_text,manager_id:self.report_manager_id}],context:this.odoo_context,}).then(function(result){self.footnotes.push({id:result,line:line_id,text:footnote_text});return self.render_footnotes();});}};new Dialog(this,{title:'Annotate',size:'medium',$content:$content,buttons:[{text:'Save',classes:'btn-primary',close:true,click:save},{text:'Cancel',close:true}]}).open();},delete_footnote:function(e){var self=this;var footnote_id=$(e.target).parents('.footnote').data('id');return this._rpc({model:'account.report.footnote',method:'unlink',args:[footnote_id],context:this.odoo_context,}).then(function(result){self.footnotes=_.filter(self.footnotes,function(element){return element.id!==footnote_id;});return self.render_footnotes();});},fold_unfold:function(e){var self=this;if($(e.target).hasClass('caret')||$(e.target).parents('.o_account_reports_footnote_sup').length>0){return;}
e.stopPropagation();e.preventDefault();var line=$(e.target).parents('td');if(line.length===0){line=$(e.target);}
var method=line.data('unfolded')==='True'?this.batch_fold(line):this.unfold(line);Promise.resolve(method).then(function(){self.render_footnotes();self.persist_options();});},batch_fold:function(lines){var parent_ids=new Map();lines.each((it,line)=>{let $line=$(line);$line.find('.fa-caret-down').toggleClass('fa-caret-right fa-caret-down');$line.toggleClass('folded');$line.parent('tr').removeClass('o_js_account_report_parent_row_unfolded');parent_ids.set($line.data('id'),$line);var index=this.report_options.unfolded_lines.indexOf($line.data('id'));if(index>-1){this.report_options.unfolded_lines.splice(index,1);}});var rows=this.$el.find('tr');var children=rows.map((it,row)=>{let $row=$(row);if(parent_ids.has($row.data('parent-id'))){parent_ids.get($row.data('parent-id')).data('unfolded','False');$row.find('.js_account_report_line_footnote').addClass('folded');$row.hide();var child=$row.find('[data-id]:first');if(child){return child;}}});if(children.length>0){this.batch_fold(children);}},fold:function(line){var self=this;var line_id=line.data('id');line.find('.fa-caret-down').toggleClass('fa-caret-right fa-caret-down');line.toggleClass('folded');$(line).parent('tr').removeClass('o_js_account_report_parent_row_unfolded');var $lines_to_hide=this.$el.find('tr[data-parent-id="'+$.escapeSelector(String(line_id))+'"]');var index=self.report_options.unfolded_lines.indexOf(line_id);if(index>-1){self.report_options.unfolded_lines.splice(index,1);}
if($lines_to_hide.length>0){line.data('unfolded','False');$lines_to_hide.find('.js_account_report_line_footnote').addClass('folded');$lines_to_hide.hide();_.each($lines_to_hide,function(el){var child=$(el).find('[data-id]:first');if(child){self.fold(child);}})}
return false;},unfold:function(line){var self=this;var line_id=line.data('id');line.toggleClass('folded');self.report_options.unfolded_lines.push(line_id);var $lines_in_dom=this.$el.find('tr[data-parent-id="'+$.escapeSelector(String(line_id))+'"]');if($lines_in_dom.length>0){$lines_in_dom.find('.js_account_report_line_footnote').removeClass('folded');$lines_in_dom.show();line.find('.fa-caret-right').toggleClass('fa-caret-right fa-caret-down');line.data('unfolded','True');this._add_line_classes();return true;}
else{return this._rpc({model:this.report_model,method:'get_html',args:[self.financial_id,self.report_options,line.data('id')],context:self.odoo_context,}).then(function(result){$(line).parent('tr').replaceWith(result);self._add_line_classes();});}},load_more:function(ev){var $line=$(ev.target).parents('td');var id=$line.data('id');var offset=$line.data('offset')||0;var progress=$line.data('progress')||0;var remaining=$line.data('remaining')||0;var options=_.extend({},this.report_options,{lines_offset:offset,lines_progress:progress,lines_remaining:remaining});var self=this;this._rpc({model:this.report_model,method:'get_html',args:[this.financial_id,options,id],context:this.odoo_context,}).then(function(result){var $tr=$line.parents('.o_account_reports_load_more');$tr.after(result);$tr.remove();self._add_line_classes();});},unfold_all:function(bool){var self=this;var lines=this.$el.find('.js_account_report_foldable');self.report_options.unfolded_lines=[];if(bool){_.each(lines,function(el){self.report_options.unfolded_lines.push($(el).data('id'));});}},trigger_action:function(e){e.stopPropagation();var self=this;var action=$(e.target).attr('action');var id=$(e.target).parents('td').data('id');var params=$(e.target).data();var context=new Context(this.odoo_context,params.actionContext||{},{active_id:id});params=_.omit(params,'actionContext');if(action){return this._rpc({model:this.report_model,method:action,args:[this.financial_id,this.report_options,params],context:context.eval(),}).then(function(result){return self.do_action(result);});}},});core.action_registry.add('account_report',accountReportsWidget);return accountReportsWidget;});;

/* /account_reports/static/src/js/action_manager_account_report_dl.js defined in bundle 'web.assets_backend' */
odoo.define('account_reports.ActionManager',function(require){"use strict";var ActionManager=require('web.ActionManager');var framework=require('web.framework');var session=require('web.session');ActionManager.include({_executeAccountReportDownloadAction:function(action){var self=this;framework.blockUI();return new Promise(function(resolve,reject){session.get_file({url:'/account_reports',data:action.data,success:resolve,error:(error)=>{self.call('crash_manager','rpc_error',error);reject();},complete:framework.unblockUI,});});},_handleAction:function(action,options){if(action.type==='ir_actions_account_report_download'){return this._executeAccountReportDownloadAction(action,options);}
return this._super.apply(this,arguments);},});});;

/* /account_asset/static/src/js/account_asset.js defined in bundle 'web.assets_backend' */
odoo.define('account_asset.AssetFormView',function(require){"use strict";var FormRenderer=require('web.FormRenderer');var FormView=require('web.FormView');var core=require('web.core');var viewRegistry=require('web.view_registry');var _t=core._t;var AccountAssetFormRenderer=FormRenderer.extend({events:_.extend({},FormRenderer.prototype.events,{'click .add_original_move_line':'_onAddOriginalMoveLine',}),_onAddOriginalMoveLine:function(ev){_.find(this.allFieldWidgets[this.state.id],x=>x['name']=='original_move_line_ids').onAddRecordOpenDialog();},});var AssetFormView=FormView.extend({config:_.extend({},FormView.prototype.config,{Renderer:AccountAssetFormRenderer,}),});viewRegistry.add("asset_form",AssetFormView);return AssetFormView;});;

/* /account_asset/static/src/js/account_asset_reversed_widget.js defined in bundle 'web.assets_backend' */
odoo.define('account_asset.widget',function(require){"use strict";var AbstractField=require('web.AbstractField');var core=require('web.core');var registry=require('web.field_registry');var _t=core._t;var AccountAssetReversedWidget=AbstractField.extend({noLabel:true,isSet:function(){return true;},_render:function(){if(this.recordData.reversal_move_id.res_ids.length){var $icon=$('<i/>',{title:_t('This move has been reversed')}).addClass('fa fa-exclamation-circle')
this.$el.html($icon);}},});registry.add("deprec_lines_reversed",AccountAssetReversedWidget);});;

/* /account_followup/static/src/js/followup_form_view.js defined in bundle 'web.assets_backend' */
odoo.define('accountReports.FollowupFormView',function(require){"use strict";var FollowupFormController=require('account_followup.FollowupFormController');var FollowupFormModel=require('account_followup.FollowupFormModel');var FollowupFormRenderer=require('account_followup.FollowupFormRenderer');var FormView=require('web.FormView');var viewRegistry=require('web.view_registry');var FollowupFormView=FormView.extend({config:_.extend({},FormView.prototype.config,{Controller:FollowupFormController,Model:FollowupFormModel,Renderer:FollowupFormRenderer,}),});viewRegistry.add('followup_form',FollowupFormView);return FollowupFormView;});;

/* /account_followup/static/src/js/followup_form_model.js defined in bundle 'web.assets_backend' */
odoo.define('account_followup.FollowupFormModel',function(require){"use strict";var BasicModel=require('web.BasicModel');var field_utils=require('web.field_utils');var session=require('web.session');var time=require('web.time');var FollowupFormModel=BasicModel.extend({init:function(){this._super.apply(this,arguments);this.numberDone=undefined;this.numberTodo=undefined;this.numberSkipped=undefined;this.currentElementIndex=undefined;},changeBlockedMoveLine:function(moveLineID,blocked){return this._rpc({model:'account.move.line',method:'write_blocked',args:[[moveLineID],blocked]});},changeExpectedDate:function(handle,moveLineID,date){return this._rpc({model:'res.partner',method:'change_expected_date',args:[[this.localData[handle].res_id],{move_line_id:moveLineID,expected_pay_date:date}],});},changeTrust:function(handle,newTrust){return this._rpc({model:'res.partner',method:'write',args:[[this.localData[handle].res_id],{trust:newTrust}],});},getProgressInfos:function(){return{numberDone:this.numberDone,numberTodo:this.numberTodo,currentElementIndex:this.currentElementIndex};},getSkippedPartners:function(){return this.numberSkipped;},increaseNumberDone:function(){this.numberDone++;},increaseNumberSkipped:function(){this.numberSkipped++;},isJobComplete:function(){return this.numberTodo===0;},load:function(params){var self=this;this.modelName=params.modelName;this._computeProgressBar(params.res_id,params.res_ids);return this._super(params).then(function(id){return self._fetch(id);});},reload:function(handle,params){if(params.offset!==undefined||params.currentId!==undefined){this.localData[handle].data.report_manager_id=undefined;}
if(params.offset!==undefined){this.currentElementIndex=params.offset;}
if(params.ids!==undefined&&params.currentId!==undefined){this._computeProgressBar(params.currentId,params.ids);}
var self=this;return this._super(handle,params).then(function(id){return self._fetch(id);});},removeCurrentRecord:function(handle){this.numberTodo--;var index=this.localData[handle].res_ids.indexOf(this.localData[handle].res_id);this.localData[handle].res_ids.splice(index,1);if(this.currentElementIndex>=this.localData[handle].res_ids.length){this.currentElementIndex=this.localData[handle].res_ids.length-1;}
return this.currentElementIndex;},saveSummary:function(handle,text){return this._rpc({model:'account.report.manager',method:'write',args:[this.localData[handle].data.report_manager_id,{summary:text}],});},setNextActionDate:function(handle,date){this.localData[handle].data.next_action_date=date;},updateNextAction:function(handle,action){var record=this.localData[handle];var next_action_date=field_utils.parse.date(record.data.next_action_date,{},{});return this._rpc({model:'res.partner',method:'update_next_action',args:[[record.res_id],{next_action_type:record.data.next_action,next_action_date:next_action_date,action:action,}],});},doManualAction:function(handle){var level=this.localData[handle].data.followup_level;if(level&&level.manual_action){level.manual_action_done=true;}},doPrintLetter:function(handle){var level=this.localData[handle].data.followup_level;if(level&&level.print_letter){level.print_letter=false;}},doSendMail:function(handle){var level=this.localData[handle].data.followup_level;if(level&&level.send_email){level.send_email=false;}},doSendSMS:function(handle){var level=this.localData[handle].data.followup_level;if(level&&level.send_sms){level.send_sms=false;}},_computeProgressBar:function(id,records){records=records||[];this.numberTodo=records.length;this.currentElementIndex=records.indexOf(id);this.numberDone=0;this.numberSkipped=0;},_fetch:function(id){var self=this;var params={};if(this.localData[id].data.report_manager_id!==undefined){params.total_due=this.localData[id].data.total_due
params.keep_summary=true;}
return this._rpc({model:'account.followup.report',method:'get_followup_informations',args:[this.localData[id].res_id,params],kwargs:{context:session.user_context},}).then(function(data){self.localData[id].data.report_manager_id=data.report_manager_id;self.localData[id].data.followup_html=data.html;self.localData[id].data.total_due=data.total_due;if(!params.keep_summary){self.localData[id].data.followup_level=data.followup_level||{};}
if(data.next_action){self.localData[id].data.next_action=data.next_action.type;self.localData[id].data.next_action_date=data.next_action.date;}
return self.localData[id].id;});},});return FollowupFormModel;});;

/* /account_followup/static/src/js/followup_form_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('account_followup.FollowupFormRenderer',function(require){"use strict";var core=require('web.core');var datepicker=require('web.datepicker');var Dialog=require('web.Dialog');var dom=require('web.dom');var FormRenderer=require('web.FormRenderer');var SystrayMenu=require('web.SystrayMenu');var QWeb=core.qweb;var _t=core._t;var FollowupFormRenderer=FormRenderer.extend({events:_.extend({},FormRenderer.prototype.events,{'input .o_account_reports_next_action_date_picker input':'_onReminderDate','change *[name="blocked"]':'_onChangeBlocked','click .o_change_expected_date':'_onChangeExpectedDate','click .o_change_trust':'_onChangeTrust','click .o_account_reports_no_print .o_account_reports_summary':'_onEditSummary','click .js_account_report_save_summary':'_onSaveSummary','click [action]':'_onTriggerAction','click .o_account_reports_contact_info_call':'_onClickCall',}),init:function(){this._super.apply(this,arguments);this.nextActionDatePicker=new datepicker.DateWidget(this);this.nextActionDatePicker.on('datetime_changed',this,function(){this.trigger_up('next_action_date_changed',{newDate:this.nextActionDatePicker.getValue()});});},removeMailAlert:function(){if(this.chatter){this.chatter.trigger_up('reload_mail_fields',{activity:true,thread:true,followers:true});}
this.$('div.alert.alert-info.alert-dismissible').remove();},renderEditSummary:function(){dom.autoresize(this.$('textarea[name="summary"]'));this.$('.o_account_reports_summary_edit').show();this.$('.o_account_reports_no_print .o_account_reports_summary').hide();this.$('textarea[name="summary"]').focus();},renderMailAlert:function(){this.$('.o_form_sheet_bg div.o_account_reports_page').prepend(QWeb.render("CustomerStatements.send_mail"));},renderSMSAlert:function(){this.$('div.o_account_reports_page').prepend(QWeb.render("CustomerStatements.send_sms"));},renderSavedSummary:function(text){this.$('.o_account_reports_summary_edit').hide();this.$('.o_account_reports_no_print .o_account_reports_summary').show();var span=$('<span />')
if(!text){span.html("<input type='text' class='o_input o_field_widget' name='summary' />");}else{span.text(text);span.html(span.html().replace(/\n/g,'<br>'))}
this.$('.o_account_reports_no_print .o_account_report_summary').empty().append(span);},renderTrust:function(newTrust){var colorMap={good:'green',normal:'grey',bad:'red',};var color=colorMap[newTrust];this.$('i.oe-account_followup-trust').attr('style','color: '+color+'; font-size: 0.8em;');},_renderTagFollowup:function(){var self=this;var $element=$('<div>');$element.html(this.state.data.followup_html);$element.find('.o_account_reports_summary_edit').hide();this.nextActionDatePicker.appendTo($element.find('div.o_account_reports_next_action_date_picker')).then(function(){self.nextActionDatePicker.setValue(new moment(self.state.data.next_action_date));});return $element;},_onChangeBlocked:function(event){var checkbox=$(event.target).is(":checked");var targetID=$(event.target).parents('tr').find('td[data-id]').data('id');this.trigger_up('on_change_block',{checkbox:checkbox,targetID:targetID});},_onChangeExpectedDate:function(event){var self=this;var targetID=parseInt($(event.target).attr('data-id'));var $content=$(QWeb.render("paymentDateForm",{target_id:targetID}));var paymentDatePicker=new datepicker.DateWidget(this);paymentDatePicker.appendTo($content.find('div.o_account_reports_payment_date_picker'));var save=function(){self.trigger_up('expected_date_changed',{newDate:paymentDatePicker.getValue(),moveLineID:parseInt($content.find("#target_id").val())});};new Dialog(this,{title:'Odoo',size:'medium',$content:$content,buttons:[{text:'Save',classes:'btn-primary',close:true,click:save},{text:'Cancel',close:true}]}).open();},_onChangeTrust:function(event){var newTrust=$(event.target).data("new-trust");if(!newTrust){newTrust=$(event.target).parents('a.o_change_trust').data("new-trust");}
this.trigger_up('on_change_trust',{newTrust:newTrust});},_onClickCall:function(ev){var hasVoip=_.find(SystrayMenu.Items,function(SystrayMenuItem){return SystrayMenuItem.prototype.name==='voip';});if(!hasVoip){return;}
ev.preventDefault();var $el=$(ev.currentTarget);this.do_notify(_t('Start Calling'),_t('Calling')+' '+$el.data('number'));this.trigger_up('voip_call',{resModel:$el.data('model'),resId:$el.data('id'),number:$el.data('number').toString(),});},_onEditSummary:function(){this.renderEditSummary();},_onReminderDate:function(){this.trigger_up('on_change_reminder_date');},_onSaveSummary:function(event){var text=$(event.target).siblings().val().replace(/[ \t]+/g,' ');this.trigger_up('on_save_summary',{text:text});},_onTriggerAction:function(event){event.stopPropagation();var actionName=$(event.target).attr('action');var resId=parseInt($(event.target).attr('data-id'));var view=parseInt($(event.target).attr('view-id'));this.trigger_up('on_trigger_action',{actionName:actionName,resId:resId,view:view});},});return FollowupFormRenderer;});;

/* /account_followup/static/src/js/followup_form_controller.js defined in bundle 'web.assets_backend' */
odoo.define('account_followup.FollowupFormController',function(require){"use strict";var FormController=require('web.FormController');var core=require('web.core');var QWeb=core.qweb;var _t=core._t;var FollowupFormController=FormController.extend({events:_.extend({},FormController.prototype.events,{'click .o_account_followup_manual_action_button':'_onManualAction','click .o_account_followup_print_letter_button':'_onPrintLetter','click .o_account_followup_send_mail_button':'_onSendMail','click .o_account_followup_send_sms_button':'_onSendSMS','click .o_account_followup_do_it_later_button':'_onDoItLater','click .o_account_followup_done_button':'_onDone','click .o_account_followup_reconcile':'_onReconcile',}),custom_events:_.extend({},FormController.prototype.custom_events,{expected_date_changed:'_onExpectedDateChanged',next_action_date_changed:'_onChangeReminderDate',on_change_block:'_onChangeBlocked',on_change_trust:'_onChangeTrust',on_save_summary:'_onSaveSummary',on_trigger_action:'_onTriggerAction'}),init:function(){this._super.apply(this,arguments);delete this.searchView;this.hasSidebar=false;},renderButtons:function($node){this.$buttons=$(QWeb.render("CustomerStatements.buttons",{widget:this}));this.$buttons.appendTo($node);},_checkDone:function(){if(this.model.isJobComplete()){var message=_.str.sprintf(_t('You are done with the follow-ups!<br/>You have skipped %s partner(s).'),this.model.getSkippedPartners());this.trigger_up('show_effect',{type:'rainbow_man',fadeout:'no',message:message,});}},_displayDone:function(){this.$buttons.find('button.o_account_followup_done_button').show();this.renderer.removeMailAlert();},_displayNextFollowup:function(){var currentIndex=this.model.removeCurrentRecord(this.handle);var params={limit:1,offset:currentIndex,};this.update(params);this.$buttons.find('button.o_account_followup_done_button').hide();this._checkDone();},_removeHighlightEmail:function(){this.$buttons.find('button.o_account_followup_send_mail_button').removeClass('btn-primary').addClass('btn-secondary');},_removeHighlightSMS:function(){this.$buttons.find('button.o_account_followup_send_sms_button').removeClass('btn-primary').addClass('btn-secondary');},_removeHighlightPrint:function(){this.$buttons.find('button.o_account_followup_print_letter_button').removeClass('btn-primary').addClass('btn-secondary');},_update:function(){var self=this;return this._super.apply(this,arguments).then(function(){self._updateSearchView();self._updateButtons();});},_updatePager:function(){if(this.pager){var progressInfo=this.model.getProgressInfos();this.pager.updateState({current_min:progressInfo.currentElementIndex+1,size:progressInfo.numberTodo,});this.pager.do_toggle(true);}},_updateSearchView:function(){var progressInfo=this.model.getProgressInfos();var total=progressInfo.numberDone+progressInfo.numberTodo;this.$searchview=$(QWeb.render("CustomerStatements.followupProgressbar",{current:progressInfo.numberDone,max:progressInfo.numberDone+progressInfo.numberTodo,percent:(progressInfo.numberDone/total*100),}));this.updateControlPanel({cp_content:{$searchview:this.$searchview,}},{clear:false,});},_updateButtons:function(){let setButtonClass=(button,primary)=>{let addedClass=primary?'btn-primary':'btn-secondary'
let removedClass=!primary?'btn-secondary':'btn-primary'
this.$buttons.find(`button.${button}`).removeClass(removedClass).addClass(addedClass);}
if(!this.$buttons){return;}
var followupLevel=this.model.localData[this.handle].data.followup_level;setButtonClass('o_account_followup_print_letter_button',followupLevel.print_letter)
setButtonClass('o_account_followup_send_mail_button',followupLevel.send_email)
setButtonClass('o_account_followup_send_sms_button',followupLevel.send_sms)
if(followupLevel.manual_action){this.$buttons.find('button.o_account_followup_manual_action_button').html(followupLevel.manual_action_note);setButtonClass('o_account_followup_manual_action_button',!followupLevel.manual_action_done)}else{this.$buttons.find('button.o_account_followup_manual_action_button').hide();}},_getPartner(){return this.model.get(this.handle,{raw:true}).res_id;},_onChangeBlocked:function(event){var self=this;var checkbox=event.data.checkbox;var targetID=event.data.targetID;this.model.changeBlockedMoveLine(parseInt(targetID),checkbox).then(function(){self.reload();});},_onChangeTrust:function(event){var self=this;var newTrust=event.data.newTrust;this.model.changeTrust(this.handle,newTrust).then(function(){self.renderer.renderTrust(newTrust);});},_onChangeReminderDate:function(ev){ev.stopPropagation();this.model.setNextActionDate(this.handle,ev.data.newDate);this.model.updateNextAction(this.handle,'change_date')},_onDoItLater:function(){var self=this;this.model.updateNextAction(this.handle,'later').then(function(){self.model.increaseNumberSkipped();self._displayNextFollowup();});},_onDone:function(){var self=this;this.model.updateNextAction(this.handle,'done').then(function(){self.model.increaseNumberDone();self._displayNextFollowup();});},_onExpectedDateChanged:function(event){event.stopPropagation();var self=this;this.model.changeExpectedDate(this.handle,event.data.moveLineID,event.data.newDate).then(function(){self.reload();});},_onReconcile:function(){var context={'mode':'customers','partner_ids':[this._getPartner()],'all_entries':true,}
this.do_action({type:'ir.actions.client',tag:'manual_reconciliation_view',views:[[false,'form']],target:'current',context:context,});},_onPrintLetter:function(){var self=this;this.model.doPrintLetter(this.handle);var records={ids:[this._getPartner()],};this._rpc({model:'account.followup.report',method:'print_followups',args:[records],}).then(function(result){self.do_action(result);self._removeHighlightPrint();self._displayDone();});},_onManualAction:function(){var self=this;var partnerID=this.model.localData[this.handle].res_id;var followupLevel=this.model.localData[this.handle].data.followup_level.id;var options={partner_id:partnerID};this.model.doManualAction(this.handle);if(followupLevel){options['followup_level']=followupLevel;}
this._rpc({model:'account.followup.report',method:'do_manual_action',args:[options]}).then(function(){self.renderer.chatter.trigger_up('reload_mail_fields',{activity:true,thread:true,followers:true});self._displayDone();});},_onSaveSummary:function(event){var self=this;var text=event.data.text;this.model.saveSummary(this.handle,text).then(function(){self.renderer.renderSavedSummary(text);});},_onSendMail:function(){var self=this;this.model.doSendMail(this.handle);this.options={partner_id:this._getPartner(),keep_summary:true,};this._rpc({model:'account.followup.report',method:'send_email',args:[this.options],}).then(function(){self._removeHighlightEmail();self._displayDone();self.renderer.renderMailAlert();});},async _onSendSMS(){this.model.doSendSMS(this.handle);this.options={partner_id:this._getPartner()};let action=await this._rpc({model:'account.followup.report',method:'send_sms',args:[this.options],})
this.do_action(action,{on_close:(infos)=>{if(!infos){this._removeHighlightSMS()
this._displayDone();this.renderer.renderSMSAlert();}},})},_onTriggerAction:function(event){event.stopPropagation();var actionName=event.data.actionName;var action={type:'ir.actions.act_window',views:[[false,'form']],target:'current',};switch(actionName){case"open_partner_form":_.extend(action,{res_model:'res.partner',res_id:this.model.localData[this.handle].res_id,});break;case"open_invoice":_.extend(action,{res_model:'account.move',res_id:event.data.resId,});break;default:action=undefined;}
if(action){this.do_action(action);}},});return FollowupFormController;});;

/* /documents_account/static/src/js/reconciliation_model.js defined in bundle 'web.assets_backend' */
odoo.define('documents_account.StatementModel',function(require){"use strict";var reconciliationModel=require('account.ReconciliationModel');reconciliationModel.StatementModel.include({_executeActionList:function(list){var self=this;if(list.length===0){return Promise.resolve();}
var action=list.pop();return this.do_action(action,{on_close:function(){return self._executeActionList(list);}});},_validatePostProcess:function(data){if(data.documents_actions){return this._executeActionList(data.documents_actions);}
return this._super.apply(this,arguments);},});});;

/* /snailmail_account_followup/static/src/js/followup_form_controller.js defined in bundle 'web.assets_backend' */
odoo.define('snailmail_account_followup.FollowupFormController',function(require){"use strict";var FollowupFormController=require('account_followup.FollowupFormController');FollowupFormController.include({renderButtons:function($node){this._super.apply(this,arguments);this.$buttons.on('click','.o_account_followup_send_letter_button',this._onSendLetter.bind(this));},_update:function(){this._updateButtons();return this._super.apply(this,arguments);},_updateButtons:function(){if(!this.$buttons){return;}
this._super.apply(this,arguments);var followupLevel=this.model.localData[this.handle].data.followup_level;if(followupLevel.send_letter){this.$buttons.find('button.o_account_followup_send_letter_button').removeClass('btn-secondary').addClass('btn-primary');}else{this.$buttons.find('button.o_account_followup_send_letter_button').removeClass('btn-primary').addClass('btn-secondary');}},_onSendLetter:function(){var self=this;this.model.doSendLetter(this.handle);this._updateButtons();var res_id=this.model.get(this.handle,{raw:true}).res_id;this.do_action('snailmail_account_followup.followup_send',{additional_context:{active_ids:[res_id]},on_close:function(){self.trigger_up('reload');}});},});});;

/* /snailmail_account_followup/static/src/js/followup_form_model.js defined in bundle 'web.assets_backend' */
odoo.define('snailmail_account_followup.FollowupFormModel',function(require){"use strict";var FollowupFormModel=require('account_followup.FollowupFormModel');FollowupFormModel.include({doSendLetter:function(handle){var level=this.localData[handle].data.followup_level;if(level&&level.send_letter){level.send_letter=false;}},});});;

/* /sale/static/src/js/sale.js defined in bundle 'web.assets_backend' */
odoo.define('sale.sales_team_dashboard',function(require){"use strict";var core=require('web.core');var KanbanRecord=require('web.KanbanRecord');var _t=core._t;KanbanRecord.include({events:_.defaults({'click .sales_team_target_definition':'_onSalesTeamTargetClick',},KanbanRecord.prototype.events),_onSalesTeamTargetClick:function(ev){ev.preventDefault();var self=this;this.$target_input=$('<input>');this.$('.o_kanban_primary_bottom:last').html(this.$target_input);this.$('.o_kanban_primary_bottom:last').prepend(_t("Set an invoicing target: "));this.$target_input.focus();this.$target_input.on({blur:this._onSalesTeamTargetSet.bind(this),keydown:function(ev){if(ev.keyCode===$.ui.keyCode.ENTER){self._onSalesTeamTargetSet();}},});},_onSalesTeamTargetSet:function(){var self=this;var value=Number(this.$target_input.val());if(isNaN(value)){this.do_warn(_t("Wrong value entered!"),_t("Only Integer Value should be valid."));}else{this.trigger_up('kanban_record_update',{invoiced_target:value,onSuccess:function(){self.trigger_up('reload');},});}},});});;

/* /sale/static/src/js/tours/sale.js defined in bundle 'web.assets_backend' */
odoo.define('sale.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('sale_tour',{url:"/web",},[tour.STEPS.SHOW_APPS_MENU_ITEM,{trigger:'.o_app[data-menu-xmlid="sale.sale_menu_root"]',content:_t('Open Sales app to send your first quotation in a few clicks.'),position:'right',edition:'community'},{trigger:'.o_app[data-menu-xmlid="sale.sale_menu_root"]',content:_t('Open Sales app to send your first quotation in a few clicks.'),position:'bottom',edition:'enterprise'},{trigger:".o_list_button_add",extra_trigger:".o_sale_order",content:_t("Let's create a new quotation.<br/><i>Note that colored buttons usually point to the next logical actions.</i>"),position:"bottom",},{trigger:".o_form_editable .o_field_many2one[name='partner_id'] input",extra_trigger:".o_sale_order",content:_t("Write the name of your customer to create one on the fly, or select an existing one."),position:"bottom",run:'text Agrolait'},{trigger:".ui-menu-item > a",auto:true,in_modal:false,},{trigger:".o_field_x2many_list_row_add > a",extra_trigger:".o_field_many2one[name='partner_id'] .o_external_button",content:_t("Click here to add some products or services to your quotation."),position:"bottom",},{trigger:".o_field_widget[name=product_id] input, .o_field_widget[name=product_template_id] input",extra_trigger:".o_sale_order",content:_t("Select a product, or create a new one on the fly."),position:"right",run:function(actions){var $input=this.$anchor.find('input');actions.text("DESK0001",$input.length===0?this.$anchor:$input);var keyDownEvent=jQuery.Event("keydown");keyDownEvent.which=42;this.$anchor.trigger(keyDownEvent);var $descriptionElement=$('.o_form_editable textarea[name="name"]');$descriptionElement.change(function(){$descriptionElement.addClass('product_creation_success');});},id:'product_selection_step'},{trigger:'.ui-menu.ui-widget .ui-menu-item a:contains("DESK0001")'},{trigger:'.o_form_editable textarea[name="name"].product_creation_success',run:function(){}},{trigger:".o_form_button_save",extra_trigger:".o_sale_order",content:_t("Once your quotation is ready, you can save, print or send it by email."),position:"right",id:"form_button_save_clicked"},{trigger:".breadcrumb-item:not(.active):last",extra_trigger:".o_sale_order [data-value='draft'].btn-primary",content:_t("Use the breadcrumbs to <b>go back to preceeding screens</b>."),position:"bottom"},{trigger:'li a[data-menu-xmlid="sale.sale_order_menu"], .oe_secondary_menu_section[data-menu-xmlid="sale.sale_order_menu"]',content:_t("Use this menu to access quotations, sales orders and customers."),edition:"enterprise",position:"bottom"}]);});;

/* /sale/static/src/js/account_reconciliation.js defined in bundle 'web.assets_backend' */
odoo.define('sale.account_reconciliation',function(require){"use strict";var ReconciliationRenderers=require('account.ReconciliationRenderer');var ReconciliationAction=require('account.ReconciliationClientAction');var ReconciliationModel=require('account.ReconciliationModel');var LineRenderer=ReconciliationRenderers.LineRenderer;var StatementAction=ReconciliationAction.StatementAction;var core=require('web.core');var _t=core._t;LineRenderer.include({events:_.extend({},LineRenderer.prototype.events,{'click .o_notebook .js_open_so':'_onOpenSaleOrder'}),_onOpenSaleOrder:function(event){event.preventDefault();this.trigger_up('open_sale_orders');},});ReconciliationModel.StatementModel.include({_getDefaultMode:function(handle){var line=this.getLine(handle);var ret=this._super(handle)
if(ret!=='inactive'&&line.sale_order_ids&&line.sale_order_ids.length&&line.sale_order_prioritize){return'saleorder'}else{return ret;}},_getAvailableModes:function(handle){var line=this.getLine(handle);var modes=this._super(handle);if(line.sale_order_ids&&line.sale_order_ids.length&&line.sale_order_prioritize){modes.push('saleorder')}
return modes;},});StatementAction.include({custom_events:_.extend({},StatementAction.prototype.custom_events,{open_sale_orders:'_onOpenSaleOrders',}),_onOpenSaleOrders:function(event){var self=this;var handle=event.target.handle;var line=this.model.getLine(handle);if(line.sale_order_ids&&line.sale_order_ids.length>1){this.do_action({name:_t('Sale Orders'),type:'ir.actions.act_window',res_model:'sale.order',views:[[false,'list'],[false,'form']],view_mode:"list",target:'current',domain:[['id','in',line.sale_order_ids]]},{on_reverse_breadcrumb:function(){self.trigger_up('reload');},});}
else if(line.sale_order_ids&&line.sale_order_ids.length===1){this.do_action({name:_t('Sale Order'),type:'ir.actions.act_window',res_model:'sale.order',views:[[false,'form']],target:'current',res_id:line.sale_order_ids[0],},{on_reverse_breadcrumb:function(){self.trigger_up('reload');},});}},});});

/* /sale/static/src/js/product_configurator_widget.js defined in bundle 'web.assets_backend' */
odoo.define('sale.product_configurator',function(require){var relationalFields=require('web.relational_fields');var FieldsRegistry=require('web.field_registry');var core=require('web.core');var _t=core._t;var ProductConfiguratorWidget=relationalFields.FieldMany2One.extend({events:_.extend({},relationalFields.FieldMany2One.prototype.events,{'click .o_edit_product_configuration':'_onEditConfiguration'}),_render:function(){this._super.apply(this,arguments);if(this.mode==='edit'&&this.value&&(this._isConfigurableProduct()||this._isConfigurableLine())){this._addProductLinkButton();this._addConfigurationEditButton();}else if(this.mode==='edit'&&this.value){this._addProductLinkButton();this.$('.o_edit_product_configuration').hide();}else{this.$('.o_external_button').hide();this.$('.o_edit_product_configuration').hide();}},_addProductLinkButton:function(){if(this.$('.o_external_button').length===0){var $productLinkButton=$('<button>',{type:'button',class:'fa fa-external-link btn btn-secondary o_external_button',tabindex:'-1',draggable:false,'aria-label':_t('External Link'),title:_t('External Link')});var $inputDropdown=this.$('.o_input_dropdown');$inputDropdown.after($productLinkButton);}},_addConfigurationEditButton:function(){var $inputDropdown=this.$('.o_input_dropdown');if($inputDropdown.length!==0&&this.$('.o_edit_product_configuration').length===0){var $editConfigurationButton=$('<button>',{type:'button',class:'fa fa-pencil btn btn-secondary o_edit_product_configuration',tabindex:'-1',draggable:false,'aria-label':_t('Edit Configuration'),title:_t('Edit Configuration')});$inputDropdown.after($editConfigurationButton);}},_isConfigurableProduct:function(){return false;},_isConfigurableLine:function(){return false;},_onFieldChanged:function(ev){var self=this;this._super.apply(this,arguments);if(ev.data.changes&&!ev.data.preventProductIdCheck&&ev.data.changes.product_template_id){self._onTemplateChange(ev.data.changes.product_template_id.id,ev.data.dataPointID);}else if(ev.data.changes&&ev.data.changes.product_id){self._onProductChange(ev.data.changes.product_id.id,ev.data.dataPointID).then(function(wizardOpened){if(!wizardOpened){self._onLineConfigured();}});}},_onTemplateChange:function(productTemplateId,dataPointId){return Promise.resolve(false);},_onProductChange:function(productId,dataPointId){return Promise.resolve(false);},_onLineConfigured:function(){},_onEditConfiguration:function(){if(this._isConfigurableLine()){this._onEditLineConfiguration();}else if(this._isConfigurableProduct()){this._onEditProductConfiguration();}},_onEditLineConfiguration:function(){},_onEditProductConfiguration:function(){},_convertFromMany2Many:function(recordData){if(recordData){var convertedValues=[];_.each(recordData.res_ids,function(resId){convertedValues.push([4,parseInt(resId)]);});return convertedValues;}
return null;},_convertFromOne2Many:function(recordData){if(recordData){var convertedValues=[];_.each(recordData.res_ids,function(resId){if(isNaN(resId)){_.each(recordData.data,function(record){if(record.ref===resId){convertedValues.push([0,0,{custom_product_template_attribute_value_id:record.data.custom_product_template_attribute_value_id.data.id,custom_value:record.data.custom_value}]);}});}else{convertedValues.push([4,resId]);}});return convertedValues;}
return null;}});FieldsRegistry.add('product_configurator',ProductConfiguratorWidget);return ProductConfiguratorWidget;});;

/* /sale_expense/static/src/js/sale_order_many2one.js defined in bundle 'web.assets_backend' */
odoo.define('sale_expense.sale_order_many2one',function(require){"use strict";var FieldMany2One=require('web.relational_fields').FieldMany2One;var FieldRegistry=require('web.field_registry');var OrderField=FieldMany2One.extend({_manageSearchMore:function(values){return values;}});FieldRegistry.add('sale_order_many2one',OrderField);return OrderField;});;

/* /sale_timesheet_enterprise/static/src/js/timer.js defined in bundle 'web.assets_backend' */
odoo.define('sale_timesheet_enterprise.timer',function(require){"use strict";var fieldRegistry=require('web.field_registry');var AbstractField=require('web.AbstractField');var TimerFieldWidget=AbstractField.extend({isSet:function(){return true;},_getDuration:function(dateStart,datePause){if(datePause&&dateStart){return moment(datePause).diff(moment(dateStart));}
if(dateStart){return moment().diff(moment(dateStart));}
else return 0;},_render:function(){this._startTimeCounter();},destroy:function(){this._super.apply(this,arguments);clearTimeout(this.timer);},_startTimeCounter:function(){var self=this;clearTimeout(this.timer);if(self.record.data.timesheet_timer_start){this.timer=setTimeout(function(){self._startTimeCounter();},1000);this.$el.text(moment.utc(self._getDuration(self.record.data.timesheet_timer_start,self.record.data.timesheet_timer_pause)).format("HH:mm:ss"));}else if(!self.record.data.timesheet_timer_pause){clearTimeout(this.timer);}},});fieldRegistry.add('timesheet_timer',TimerFieldWidget);});;

/* /event_sale/static/src/js/event_configurator_controller.js defined in bundle 'web.assets_backend' */
odoo.define('event.EventConfiguratorFormController',function(require){"use strict";var FormController=require('web.FormController');var EventConfiguratorFormController=FormController.extend({saveRecord:function(){var self=this;return this._super.apply(this,arguments).then(function(){var state=self.renderer.state.data;self.do_action({type:'ir.actions.act_window_close',infos:{eventConfiguration:{event_id:{id:state.event_id.data.id},event_ticket_id:{id:state.event_ticket_id.data.id}}}});});}});return EventConfiguratorFormController;});;

/* /event_sale/static/src/js/event_configurator_view.js defined in bundle 'web.assets_backend' */
odoo.define('event.EventConfiguratorFormView',function(require){"use strict";var EventConfiguratorFormController=require('event.EventConfiguratorFormController');var FormView=require('web.FormView');var viewRegistry=require('web.view_registry');var EventConfiguratorFormView=FormView.extend({config:_.extend({},FormView.prototype.config,{Controller:EventConfiguratorFormController}),});viewRegistry.add('event_configurator_form',EventConfiguratorFormView);return EventConfiguratorFormView;});;

/* /event_sale/static/src/js/event_configurator_widget.js defined in bundle 'web.assets_backend' */
odoo.define('event_sale.product_configurator',function(require){var ProductConfiguratorWidget=require('sale.product_configurator');ProductConfiguratorWidget.include({_isConfigurableLine:function(){return this.recordData.event_ok||this._super.apply(this,arguments);},_onProductChange:function(productId,dataPointId){var self=this;return this._super.apply(this,arguments).then(function(stopPropagation){if(stopPropagation){return Promise.resolve(true);}else{return self._checkForEvent(productId,dataPointId);}});},_checkForEvent:function(productId,dataPointId){var self=this;return this._rpc({model:'product.product',method:'read',args:[productId,['event_ok']],}).then(function(result){if(result&&result[0].event_ok){self._openEventConfigurator({default_product_id:productId},dataPointId);return Promise.resolve(true);}
return Promise.resolve(false);});},_onEditLineConfiguration:function(){if(this.recordData.event_ok){var defaultValues={default_product_id:this.recordData.product_id.data.id};if(this.recordData.event_id){defaultValues.default_event_id=this.recordData.event_id.data.id;}
if(this.recordData.event_ticket_id){defaultValues.default_event_ticket_id=this.recordData.event_ticket_id.data.id;}
this._openEventConfigurator(defaultValues,this.dataPointID);}else{this._super.apply(this,arguments);}},_openEventConfigurator:function(data,dataPointId){var self=this;this.do_action('event_sale.event_configurator_action',{additional_context:data,on_close:function(result){if(result&&!result.special){self.trigger_up('field_changed',{dataPointID:dataPointId,changes:result.eventConfiguration,onSuccess:function(){self._onLineConfigured();}});}else{if(!self.recordData.event_id||!self.recordData.event_ticket_id){self.trigger_up('field_changed',{dataPointID:dataPointId,changes:{product_id:false,name:''},});}}}});}});return ProductConfiguratorWidget;});;

/* /stock/static/src/js/inventory_report_list_controller.js defined in bundle 'web.assets_backend' */
odoo.define('stock.InventoryReportListController',function(require){"use strict";var core=require('web.core');var ListController=require('web.ListController');var qweb=core.qweb;var InventoryReportListController=ListController.extend({init:function(parent,model,renderer,params){this.context=renderer.state.getContext();return this._super.apply(this,arguments);},renderButtons:function($node){this._super.apply(this,arguments);if(this.context.no_at_date){return;}
var $buttonToDate=$(qweb.render('InventoryReport.Buttons'));$buttonToDate.on('click',this._onOpenWizard.bind(this));$buttonToDate.prependTo($node.find('.o_list_buttons'));},_onOpenWizard:function(){var state=this.model.get(this.handle,{raw:true});var stateContext=state.getContext();var context={active_model:this.modelName,};if(stateContext.default_product_id){context.product_id=stateContext.default_product_id;}else if(stateContext.product_tmpl_id){context.product_tmpl_id=stateContext.product_tmpl_id;}
this.do_action({res_model:'stock.quantity.history',views:[[false,'form']],target:'new',type:'ir.actions.act_window',context:context,});},});return InventoryReportListController;});;

/* /stock/static/src/js/inventory_report_list_view.js defined in bundle 'web.assets_backend' */
odoo.define('stock.InventoryReportListView',function(require){"use strict";var ListView=require('web.ListView');var InventoryReportListController=require('stock.InventoryReportListController');var viewRegistry=require('web.view_registry');var InventoryReportListView=ListView.extend({config:_.extend({},ListView.prototype.config,{Controller:InventoryReportListController,}),});viewRegistry.add('inventory_report_list',InventoryReportListView);return InventoryReportListView;});;

/* /stock/static/src/js/inventory_singleton_list_controller.js defined in bundle 'web.assets_backend' */
odoo.define('stock.SingletonListController',function(require){"use strict";var core=require('web.core');var InventoryReportListController=require('stock.InventoryReportListController');var _t=core._t;var SingletonListController=InventoryReportListController.extend({_confirmSave:function(id){var newRecord=this.model.localData[id];var model=newRecord.model;var res_id=newRecord.res_id;var findSimilarRecords=function(record){if((record.groupedBy&&record.groupedBy.length>0)||record.data.length){var recordsToReturn=[];for(var i in record.data){var foundRecords=findSimilarRecords(record.data[i]);recordsToReturn=recordsToReturn.concat(foundRecords||[]);}
return recordsToReturn;}else{if(record.res_id===res_id&&record.model===model){if(record.count===0){return[record];}
else if(record.ref&&record.ref.indexOf('virtual')!==-1){return[record];}}}};var handle=this.model.get(this.handle);var similarRecords=findSimilarRecords(handle);if(similarRecords.length>1){var notification=_t("You tried to create a record who already exists."+"<br/>This last one has been modified instead.");this.do_notify(_t("This record already exists."),notification);this.reload();return Promise.reject();}
else{return this._super.apply(this,arguments);}},});return SingletonListController;});;

/* /stock/static/src/js/inventory_singleton_list_view.js defined in bundle 'web.assets_backend' */
odoo.define('stock.SingletonListView',function(require){'use strict';var InventoryReportListView=require('stock.InventoryReportListView');var SingletonListController=require('stock.SingletonListController');var viewRegistry=require('web.view_registry');var SingletonListView=InventoryReportListView.extend({config:_.extend({},InventoryReportListView.prototype.config,{Controller:SingletonListController,}),});viewRegistry.add('singleton_list',SingletonListView);return SingletonListView;});;

/* /stock/static/src/js/inventory_validate_button_controller.js defined in bundle 'web.assets_backend' */
odoo.define('stock.InventoryValidationController',function(require){"use strict";var core=require('web.core');var ListController=require('web.ListController');var _t=core._t;var qweb=core.qweb;var InventoryValidationController=ListController.extend({events:_.extend({'click .o_button_validate_inventory':'_onValidateInventory'},ListController.prototype.events),init:function(parent,model,renderer,params){var context=renderer.state.getContext();this.inventory_id=context.active_id;return this._super.apply(this,arguments);},renderButtons:function($node){this._super.apply(this,arguments);var $validationButton=$(qweb.render('InventoryLines.Buttons'));$validationButton.prependTo($node.find('.o_list_buttons'));},_onValidateInventory:function(){var self=this;var prom=Promise.resolve();var recordID=this.renderer.getEditableRecordID();if(recordID){prom=this.saveRecord(recordID);}
prom.then(function(){self._rpc({model:'stock.inventory',method:'action_validate',args:[self.inventory_id]}).then(function(res){var exitCallback=function(infos){if(infos&&infos.special){return;}
self.do_notify(_t("Success"),_t("The inventory has been validated"));self.trigger_up('history_back');};if(_.isObject(res)){self.do_action(res,{on_close:exitCallback});}else{return exitCallback();}});});},});return InventoryValidationController;});;

/* /stock/static/src/js/inventory_validate_button_view.js defined in bundle 'web.assets_backend' */
odoo.define('stock.InventoryValidationView',function(require){"use strict";var InventoryValidationController=require('stock.InventoryValidationController');var ListView=require('web.ListView');var viewRegistry=require('web.view_registry');var InventoryValidationView=ListView.extend({config:_.extend({},ListView.prototype.config,{Controller:InventoryValidationController})});viewRegistry.add('inventory_validate_button',InventoryValidationView);});;

/* /stock/static/src/js/stock_traceability_report_backend.js defined in bundle 'web.assets_backend' */
odoo.define('stock.stock_report_generic',function(require){'use strict';var AbstractAction=require('web.AbstractAction');var core=require('web.core');var session=require('web.session');var ReportWidget=require('stock.ReportWidget');var framework=require('web.framework');var QWeb=core.qweb;var stock_report_generic=AbstractAction.extend({hasControlPanel:true,init:function(parent,action){this._super.apply(this,arguments);this.actionManager=parent;this.given_context=_.extend({},session.user_context);this.controller_url=action.context.url;if(action.context.context){this.given_context=action.context.context;}
this.given_context.active_id=action.context.active_id||action.params.active_id;this.given_context.model=action.context.active_model||false;this.given_context.ttype=action.context.ttype||false;this.given_context.auto_unfold=action.context.auto_unfold||false;this.given_context.lot_name=action.context.lot_name||false;},willStart:function(){return Promise.all([this._super.apply(this,arguments),this.get_html()]);},set_html:function(){var self=this;var def=Promise.resolve();if(!this.report_widget){this.report_widget=new ReportWidget(this,this.given_context);def=this.report_widget.appendTo(this.$('.o_content'));}
return def.then(function(){self.report_widget.$el.html(self.html);self.report_widget.$el.find('.o_report_heading').html('<h1>Traceability Report</h1>');if(self.given_context.auto_unfold){_.each(self.$el.find('.fa-caret-right'),function(line){self.report_widget.autounfold(line,self.given_context.lot_name);});}});},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.set_html();});},get_html:function(){var self=this;var defs=[];return this._rpc({model:'stock.traceability.report',method:'get_html',args:[self.given_context],}).then(function(result){self.html=result.html;self.renderButtons();defs.push(self.update_cp());return Promise.all(defs);});},update_cp:function(){if(!this.$buttons){this.renderButtons();}
var status={cp_content:{$buttons:this.$buttons},};return this.updateControlPanel(status);},renderButtons:function(){var self=this;this.$buttons=$(QWeb.render("stockReports.buttons",{}));this.$buttons.bind('click',function(){var $element=$(self.$el[0]).find('.o_stock_reports_table tbody tr');var dict=[];$element.each(function(index){var $el=$($element[index]);dict.push({'id':$el.data('id'),'model_id':$el.data('model_id'),'model_name':$el.data('model'),'unfoldable':$el.data('unfold'),'level':$el.find('td:first').data('level')||1});});framework.blockUI();var url_data=self.controller_url.replace('active_id',self.given_context.active_id);session.get_file({url:url_data.replace('output_format','pdf'),data:{data:JSON.stringify(dict)},complete:framework.unblockUI,error:(error)=>self.call('crash_manager','rpc_error',error),});});return this.$buttons;},do_show:function(){this._super();this.update_cp();},});core.action_registry.add("stock_report_generic",stock_report_generic);return stock_report_generic;});;

/* /stock/static/src/js/stock_traceability_report_widgets.js defined in bundle 'web.assets_backend' */
odoo.define('stock.ReportWidget',function(require){'use strict';var core=require('web.core');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var ReportWidget=Widget.extend({events:{'click span.o_stock_reports_foldable':'fold','click span.o_stock_reports_unfoldable':'unfold','click .o_stock_reports_web_action':'boundLink','click .o_stock_reports_stream':'updownStream','click .o_stock_report_lot_action':'actionOpenLot'},init:function(parent){this._super.apply(this,arguments);},start:function(){QWeb.add_template("/stock/static/src/xml/stock_traceability_report_line.xml");return this._super.apply(this,arguments);},boundLink:function(e){e.preventDefault();return this.do_action({type:'ir.actions.act_window',res_model:$(e.target).data('res-model'),res_id:$(e.target).data('active-id'),views:[[false,'form']],target:'current'});},actionOpenLot:function(e){e.preventDefault();var $el=$(e.target).parents('tr');this.do_action({type:'ir.actions.client',tag:'stock_report_generic',name:$el.data('lot_name')!==undefined&&$el.data('lot_name').toString(),context:{active_id:$el.data('lot_id'),active_model:'stock.production.lot',url:'/stock/output_format/stock/active_id'},});},updownStream:function(e){var $el=$(e.target).parents('tr');this.do_action({type:"ir.actions.client",tag:'stock_report_generic',name:_t("Traceability Report"),context:{active_id:$el.data('model_id'),active_model:$el.data('model'),auto_unfold:true,lot_name:$el.data('lot_name')!==undefined&&$el.data('lot_name').toString(),url:'/stock/output_format/stock/active_id'},});},removeLine:function(element){var self=this;var el,$el;var rec_id=element.data('id');var $stockEl=element.nextAll('tr[data-parent_id='+rec_id+']')
for(el in $stockEl){$el=$($stockEl[el]).find(".o_stock_reports_domain_line_0, .o_stock_reports_domain_line_1");if($el.length===0){break;}
else{var $nextEls=$($el[0]).parents("tr");self.removeLine($nextEls);$nextEls.remove();}
$el.remove();}
return true;},fold:function(e){this.removeLine($(e.target).parents('tr'));var active_id=$(e.target).parents('tr').find('td.o_stock_reports_foldable').data('id');$(e.target).parents('tr').find('td.o_stock_reports_foldable').attr('class','o_stock_reports_unfoldable '+active_id);$(e.target).parents('tr').find('span.o_stock_reports_foldable').replaceWith(QWeb.render("unfoldable",{lineId:active_id}));$(e.target).parents('tr').toggleClass('o_stock_reports_unfolded');},autounfold:function(target,lot_name){var self=this;var $CurretElement;$CurretElement=$(target).parents('tr').find('td.o_stock_reports_unfoldable');var active_id=$CurretElement.data('id');var active_model_name=$CurretElement.data('model');var active_model_id=$CurretElement.data('model_id');var row_level=$CurretElement.data('level');var $cursor=$(target).parents('tr');this._rpc({model:'stock.traceability.report',method:'get_lines',args:[parseInt(active_id,10)],kwargs:{'model_id':active_model_id,'model_name':active_model_name,'level':parseInt(row_level)+30||1},}).then(function(lines){_.each(lines,function(line){$cursor.after(QWeb.render("report_mrp_line",{l:line}));$cursor=$cursor.next();if($cursor&&line.unfoldable&&line.lot_name==lot_name){self.autounfold($cursor.find(".fa-caret-right"),lot_name);}});});$CurretElement.attr('class','o_stock_reports_foldable '+active_id);$(target).parents('tr').find('span.o_stock_reports_unfoldable').replaceWith(QWeb.render("foldable",{lineId:active_id}));$(target).parents('tr').toggleClass('o_stock_reports_unfolded');},unfold:function(e){this.autounfold($(e.target));},});return ReportWidget;});;

/* /stock_enterprise/static/src/js/report_grid_controller.js defined in bundle 'web.assets_backend' */
odoo.define('stock_enterprise.ReportGridController',function(require){"use strict";var GridController=require('web_grid.GridController');var utils=require('web.utils');var core=require('web.core');var _t=core._t;var ReportGridController=GridController.extend({_onClickCellInformation:function(e){var self=this;var $target=$(e.target);var state=this.model.get();var cellPath=$target.parent().attr('data-path').split('.');var rowPath=cellPath.slice(0,-3).concat(['rows'],cellPath.slice(-2,-1));var row=utils.into(state,rowPath);var colPath=cellPath.slice(0,-3).concat(['cols'],cellPath.slice(-1));var col=utils.into(state,colPath);if(!row.values.product_id){this.do_warn(_t("Error: Only grouping by product is supported."));return;}
return this._rpc({model:'report.stock.quantity',method:'action_open_moves',args:[row.values.product_id[0],row.values.state,col.values.date[0].split('/')[0],]}).then(function(action){return self.do_action(action);});},});return ReportGridController;});;

/* /stock_enterprise/static/src/js/report_grid_view.js defined in bundle 'web.assets_backend' */
odoo.define('stock_enterprise.ReportGridView',function(require){'use strict';var GridView=require('web_grid.GridView');var ReportGridController=require('stock_enterprise.ReportGridController');var viewRegistry=require('web.view_registry');var ReportGridView=GridView.extend({config:_.extend({},GridView.prototype.config,{Controller:ReportGridController,}),});viewRegistry.add('stock_enterprise_report_grid',ReportGridView);return ReportGridView;});;

/* /sale_stock/static/src/js/qty_at_date_widget.js defined in bundle 'web.assets_backend' */
odoo.define('sale_stock.QtyAtDateWidget',function(require){"use strict";var core=require('web.core');var QWeb=core.qweb;var Widget=require('web.Widget');var Context=require('web.Context');var data_manager=require('web.data_manager');var widget_registry=require('web.widget_registry');var config=require('web.config');var _t=core._t;var time=require('web.time');var QtyAtDateWidget=Widget.extend({template:'sale_stock.qtyAtDate',events:_.extend({},Widget.prototype.events,{'click .fa-info-circle':'_onClickButton',}),init:function(parent,params){this.data=params.data;this._super(parent);},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){self._setPopOver();});},updateState:function(state){this.$el.popover('dispose');var candidate=state.data[this.getParent().currentRow];if(candidate){this.data=candidate.data;this.renderElement();this._setPopOver();}},_setPopOver:function(){var self=this;if(!this.data.scheduled_date){return;}
this.data.delivery_date=this.data.scheduled_date.clone().add(this.getSession().getTZOffset(this.data.scheduled_date),'minutes').format(time.getLangDateFormat());this.data.delivery_date_grid=this.data.scheduled_date.clone().add(this.getSession().getTZOffset(this.data.scheduled_date),'minutes').format('YYYY-MM-DD');this.data.debug=config.isDebug();var $content=$(QWeb.render('sale_stock.QtyDetailPopOver',{data:this.data,}));var $forecastButton=$content.find('.action_open_forecast');$forecastButton.on('click',function(ev){ev.stopPropagation();data_manager.load_action('stock.report_stock_quantity_action_product').then(function(action){self._rpc({model:'product.product',method:'get_components',args:[[self.data.product_id.data.id]]}).then(function(res){var additional_context={};additional_context.grid_anchor=self.data.delivery_date_grid;additional_context.search_default_warehouse_id=[self.data.warehouse_id.data.id];action.context=new Context(action.context,additional_context);action.domain=[['product_id','in',res]];self.do_action(action);});});});var options={content:$content,html:true,placement:'left',title:_t('Availability'),trigger:'focus',delay:{'show':0,'hide':100},};this.$el.popover(options);},_onClickButton:function(){this.$el.find('.fa-info-circle').prop('special_click',true);},});widget_registry.add('qty_at_date_widget',QtyAtDateWidget);return QtyAtDateWidget;});;

/* /hr_reminder/static/src/js/reminder_topbar.js defined in bundle 'web.assets_backend' */
odoo.define('hr_reminder.reminder_topbar',function(require){"use strict";var core=require('web.core');var SystrayMenu=require('web.SystrayMenu');var Widget=require('web.Widget');var QWeb=core.qweb;var ajax=require('web.ajax');var reminder_menu=Widget.extend({template:'reminder_menu',events:{"click .dropdown-toggle":"on_click_reminder","click .detail-client-address-country":"reminder_active",},on_click_reminder:function(event){var self=this
ajax.jsonRpc("/hr_reminder/all_reminder",'call',{}).then(function(all_reminder){self.all_reminder=all_reminder
self.$('.o_mail_navbar_dropdown_top').html(QWeb.render('reminder_menu',{values:self.all_reminder}));})},reminder_active:function(){var self=this;var value=$("#reminder_select").val();ajax.jsonRpc("/hr_reminder/reminder_active",'call',{'reminder_name':value}).then(function(reminder){self.reminder=reminder
for(var i=0;i<1;i++){var model=self.reminder[i]
var date=self.reminder[i+1]
console.log("DDDDDDDDDDDDDDDDDDDDDDDDDDDDDd",date,new Date())
if(self.reminder[i+2]=='today'){return self.do_action({type:'ir.actions.act_window',res_model:model,view_mode:'list',domain:[[date,'=',new Date()]],views:[[false,'list']],target:'new',})}
else if(self.reminder[i+2]=='set_date'){return self.do_action({type:'ir.actions.act_window',res_model:model,view_mode:'list',domain:[[date,'=',self.reminder[i+3]]],views:[[false,'list']],target:'new',})}
else if(self.reminder[i+2]=='set_period'){return self.do_action({type:'ir.actions.act_window',res_model:model,view_mode:'list',domain:[[date,'<',self.reminder[i+5]],[date,'>',self.reminder[i+4]]],views:[[false,'list']],target:'new',})}}});},});SystrayMenu.Items.push(reminder_menu);});;

/* /hr_leave_request_aliasing/static/src/js/web_planner_hr_leave.js defined in bundle 'web.assets_backend' */
odoo.define('planner_hr_leave.planner',function(require){"use strict";var planner=require('web.planner.common');});;

/* /board/static/src/js/action_manager_board_action.js defined in bundle 'web.assets_backend' */
odoo.define('board.ActionManager',function(require){"use strict";var ActionManager=require('web.ActionManager');ActionManager.include({_executeWindowAction:function(action){if(action.res_model==='board.board'&&action.view_mode==='form'){action.target='inline';_.extend(action.flags,{hasSearchView:false,hasSidebar:false,headless:true,});}
return this._super.apply(this,arguments);},});});;

/* /board/static/src/js/board_view.js defined in bundle 'web.assets_backend' */
odoo.define('board.BoardView',function(require){"use strict";var Context=require('web.Context');var config=require('web.config');var core=require('web.core');var dataManager=require('web.data_manager');var Dialog=require('web.Dialog');var Domain=require('web.Domain');var FormController=require('web.FormController');var FormRenderer=require('web.FormRenderer');var FormView=require('web.FormView');var pyUtils=require('web.py_utils');var session=require('web.session');var viewRegistry=require('web.view_registry');var _t=core._t;var _lt=core._lt;var QWeb=core.qweb;var BoardController=FormController.extend({custom_events:_.extend({},FormController.prototype.custom_events,{change_layout:'_onChangeLayout',enable_dashboard:'_onEnableDashboard',save_dashboard:'_saveDashboard',switch_view:'_onSwitchView',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.customViewID=params.customViewID;},getTitle:function(){if(this.inDashboard){return _t("My Dashboard");}
return this._super.apply(this,arguments);},_saveDashboard:function(){var board=this.renderer.getBoard();var arch=QWeb.render('DashBoard.xml',_.extend({},board));return this._rpc({route:'/web/view/edit_custom',params:{custom_id:this.customViewID,arch:arch,}}).then(dataManager.invalidate.bind(dataManager));},_onChangeLayout:function(event){var self=this;var dialog=new Dialog(this,{title:_t("Edit Layout"),$content:QWeb.render('DashBoard.layouts',_.clone(event.data))});dialog.opened().then(function(){dialog.$('li').click(function(){var layout=$(this).attr('data-layout');self.renderer.changeLayout(layout);self._saveDashboard();dialog.close();});});dialog.open();},_onEnableDashboard:function(){this.inDashboard=true;},_onSwitchView:function(event){event.stopPropagation();this.do_action({type:'ir.actions.act_window',res_model:event.data.model,views:[[event.data.formViewID||false,'form']],res_id:event.data.res_id,});},});var BoardRenderer=FormRenderer.extend({custom_events:_.extend({},FormRenderer.prototype.custom_events,{update_filters:'_onUpdateFilters',switch_view:'_onSwitchView',}),events:_.extend({},FormRenderer.prototype.events,{'click .oe_dashboard_column .oe_fold':'_onFoldClick','click .oe_dashboard_link_change_layout':'_onChangeLayout','click .oe_dashboard_column .oe_close':'_onCloseAction',}),init:function(parent,state,params){this._super.apply(this,arguments);this.noContentHelp=params.noContentHelp;this.actionsDescr={};this._boardSubcontrollers=[];this._boardFormViewIDs={};},on_attach_callback:function(){_.each(this._boardSubcontrollers,function(controller){if('on_attach_callback'in controller){controller.on_attach_callback();}});},on_detach_callback:function(){_.each(this._boardSubcontrollers,function(controller){if('on_detach_callback'in controller){controller.on_detach_callback();}});},changeLayout:function(layout){var $dashboard=this.$('.oe_dashboard');var current_layout=$dashboard.attr('data-layout');if(current_layout!==layout){var clayout=current_layout.split('-').length,nlayout=layout.split('-').length,column_diff=clayout-nlayout;if(column_diff>0){var $last_column=$();$dashboard.find('.oe_dashboard_column').each(function(k,v){if(k>=nlayout){$(v).find('.oe_action').appendTo($last_column);}else{$last_column=$(v);}});}
$dashboard.toggleClass('oe_dashboard_layout_'+current_layout+' oe_dashboard_layout_'+layout);$dashboard.attr('data-layout',layout);}},getBoard:function(){var self=this;var board={form_title:this.arch.attrs.string,style:this.$('.oe_dashboard').attr('data-layout'),columns:[],};this.$('.oe_dashboard_column').each(function(){var actions=[];$(this).find('.oe_action').each(function(){var actionID=$(this).attr('data-id');var newAttrs=_.clone(self.actionsDescr[actionID]);if(newAttrs.modifiers){newAttrs.modifiers=JSON.stringify(newAttrs.modifiers);}
actions.push(newAttrs);});board.columns.push(actions);});return board;},_createController:function(params){var self=this;return this._rpc({route:'/web/action/load',params:{action_id:params.actionID}}).then(function(action){if(!action){return Promise.resolve();}
var evalContext=new Context(params.context).eval();if(evalContext.group_by&&evalContext.group_by.length===0){delete evalContext.group_by;}
var rawContext=new Context(action.context,evalContext,{lang:session.user_context.lang});var context=pyUtils.eval('context',rawContext,evalContext);var domain=params.domain||pyUtils.eval('domain',action.domain||'[]',action.context);action.context=context;action.domain=domain;action._views=action.views;action.views=$.map(action.views,function(view){return{viewID:view[0],type:view[1]}});var viewType=params.viewType||action._views[0][1];var view=_.find(action._views,function(descr){return descr[1]===viewType;})||[false,viewType];return self.loadViews(action.res_model,context,[view]).then(function(viewsInfo){var viewInfo=viewsInfo[viewType];var View=viewRegistry.get(viewType);var view=new View(viewInfo,{action:action,hasSelectors:false,modelName:action.res_model,searchQuery:{context:context,domain:domain,groupBy:typeof context.group_by==='string'&&context.group_by?[context.group_by]:context.group_by||[],orderedBy:context.orderedBy||[],},withControlPanel:false,});return view.getController(self).then(function(controller){self._boardFormViewIDs[controller.handle]=_.first(_.find(action._views,function(descr){return descr[1]==='form';}));self._boardSubcontrollers.push(controller);return controller.appendTo(params.$node);});});});},_renderTagBoard:function(node){var self=this;this.$el.addClass('o_dashboard');this.trigger_up('enable_dashboard');var hasAction=_.detect(node.children,function(column){return _.detect(column.children,function(element){return element.tag==="action"?element:false;});});if(!hasAction){return $(QWeb.render('DashBoard.NoContent'));}
node=$.extend(true,{},node);if(!('layout'in node.attrs)){node.attrs.layout=node.attrs.style;}
for(var i=node.children.length;i<3;i++){node.children.push({tag:'column',attrs:{},children:[]});}
_.each(node.children,function(column,column_index){_.each(column.children,function(action,action_index){action.attrs.id='action_'+column_index+'_'+action_index;self.actionsDescr[action.attrs.id]=action.attrs;});});var $html=$('<div>').append($(QWeb.render('DashBoard',{node:node,isMobile:config.device.isMobile})));this._boardSubcontrollers=[];_.each(this.actionsDescr,function(action){self.defs.push(self._createController({$node:$html.find('.oe_action[data-id='+action.id+'] .oe_content'),actionID:_.str.toNumber(action.name),context:action.context,domain:Domain.prototype.stringToArray(action.domain,{}),viewType:action.view_mode,}));});$html.find('.oe_dashboard_column').sortable({connectWith:'.oe_dashboard_column',handle:'.oe_header',scroll:false}).bind('sortstop',function(){self.trigger_up('save_dashboard');});return $html;},_onChangeLayout:function(){var currentLayout=this.$('.oe_dashboard').attr('data-layout');this.trigger_up('change_layout',{currentLayout:currentLayout});},_onCloseAction:function(event){var self=this;var $container=$(event.currentTarget).parents('.oe_action:first');Dialog.confirm(this,(_t("Are you sure you want to remove this item?")),{confirm_callback:function(){$container.remove();self.trigger_up('save_dashboard');},});},_onFoldClick:function(event){var $e=$(event.currentTarget);var $action=$e.closest('.oe_action');var id=$action.data('id');var actionAttrs=this.actionsDescr[id];if($e.is('.oe_minimize')){actionAttrs.fold='1';}else{delete(actionAttrs.fold);}
$e.toggleClass('oe_minimize oe_maximize');$action.find('.oe_content').toggle();this.trigger_up('save_dashboard');},_onSwitchView:function(event){event.data.formViewID=this._boardFormViewIDs[event.target.handle];},_onUpdateFilters:function(event){event.stopPropagation();},});var BoardView=FormView.extend({config:_.extend({},FormView.prototype.config,{Controller:BoardController,Renderer:BoardRenderer,}),display_name:_lt('Board'),init:function(viewInfo){this._super.apply(this,arguments);this.controllerParams.customViewID=viewInfo.custom_view_id;},});return BoardView;});odoo.define('board.viewRegistry',function(require){"use strict";var BoardView=require('board.BoardView');var viewRegistry=require('web.view_registry');viewRegistry.add('board',BoardView);});;

/* /board/static/src/js/add_to_board_menu.js defined in bundle 'web.assets_backend' */
odoo.define('board.AddToBoardMenu',function(require){"use strict";var ActionManager=require('web.ActionManager');var Context=require('web.Context');var core=require('web.core');var Domain=require('web.Domain');var favorites_submenus_registry=require('web.favorites_submenus_registry');var pyUtils=require('web.py_utils');var Widget=require('web.Widget');var _t=core._t;var QWeb=core.qweb;var AddToBoardMenu=Widget.extend({events:_.extend({},Widget.prototype.events,{'click .o_add_to_board.o_menu_header':'_onMenuHeaderClick','click .o_add_to_board_confirm_button':'_onAddToBoardConfirmButtonClick','click .o_add_to_board_input':'_onAddToBoardInputClick','keyup .o_add_to_board_input':'_onKeyUp',}),init:function(parent,params){this._super(parent);this.action=params.action;this.isOpen=false;},start:function(){if(this.action.id&&this.action.type==='ir.actions.act_window'){this._render();}
return this._super.apply(this,arguments);},closeMenu:function(){this.isOpen=false;if(this.action.id&&this.action.type==='ir.actions.act_window'){this._render();}},_addToBoard:function(){var self=this;var searchQuery;this.trigger_up('get_search_query',{callback:function(query){searchQuery=query;}});var actionManager=this.findAncestor(function(ancestor){return ancestor instanceof ActionManager;});var controller=actionManager.getCurrentController();var context=new Context(this.action.context);context.add(searchQuery.context);context.add({group_by:searchQuery.groupBy,orderedBy:searchQuery.orderedBy,});this.trigger_up('get_controller_query_params',{callback:function(controllerQueryParams){var queryContext=controllerQueryParams.context;var allContext=_.extend(_.omit(controllerQueryParams,['context']),queryContext);context.add(allContext);}});var domain=new Domain(this.action.domain||[]);domain=Domain.prototype.normalizeArray(domain.toArray().concat(searchQuery.domain));var evalutatedContext=pyUtils.eval('context',context);for(var key in evalutatedContext){if(evalutatedContext.hasOwnProperty(key)&&/^search_default_/.test(key)){delete evalutatedContext[key];}}
evalutatedContext.dashboard_merge_domains_contexts=false;var name=this.$input.val();this.closeMenu();return self._rpc({route:'/board/add_to_dashboard',params:{action_id:self.action.id||false,context_to_save:evalutatedContext,domain:domain,view_mode:controller.viewType,name:name,},}).then(function(r){if(r){self.do_notify(_.str.sprintf(_t("'%s' added to dashboard"),name),_t('Please refresh your browser for the changes to take effect.'));}else{self.do_warn(_t("Could not add filter to dashboard"));}});},_render:function(){var $el=QWeb.render('AddToBoardMenu',{widget:this});this._replaceElement($el);if(this.isOpen){this.$input=this.$('.o_add_to_board_input');this.$input.val(this.action.name);this.$input.focus();}},_toggleMenu:function(){this.isOpen=!this.isOpen;this._render();},_onAddToBoardInputClick:function(event){event.preventDefault();event.stopPropagation();this.$input.focus();},_onAddToBoardConfirmButtonClick:function(event){event.preventDefault();event.stopPropagation();this._addToBoard();},_onKeyUp:function(event){if(event.which===$.ui.keyCode.ENTER){this._addToBoard();}},_onMenuHeaderClick:function(event){event.preventDefault();event.stopPropagation();this._toggleMenu();},});favorites_submenus_registry.add('add_to_board_menu',AddToBoardMenu,10);return AddToBoardMenu;});;

/* /azk_appraisal_batch/static/src/js/action_call.js defined in bundle 'web.assets_backend' */
odoo.define('so_tree_menu.tree_view_button',function(require){"use strict";var core=require('web.core');var _t=core._t;var ListController=require('web.ListController');var KanbanController=require('web.KanbanController');var framework=require('web.framework');ListController.include({renderButtons:function(){this._super.apply(this,arguments);if(this.$buttons){console.log('Onclick for Create Batch');var self=this;this.$buttons.on('click','.oe_button_create_batch',function(){var state=self.model.get(self.handle,{raw:true});var context=state.getContext()
self.do_action({type:'ir.actions.act_window',name:'Create Batches',res_model:'azk_appraisal_batch.appraisal.batch',target:'new',views:[[false,'form']],context:{}});});}}});KanbanController.include({renderButtons:function(){this._super.apply(this,arguments);if(this.$buttons){console.log('Onclick for Create Batch');var self=this;this.$buttons.on('click','.oe_button_create_batch',function(){var state=self.model.get(self.handle,{raw:true});var context=state.getContext()
self.do_action({type:'ir.actions.act_window',name:'Create Batches',res_model:'azk_appraisal_batch.appraisal.batch',target:'new',views:[[false,'form']],context:{}});});}}});});;

/* /mass_mailing/static/src/js/mass_mailing.js defined in bundle 'web.assets_backend' */
odoo.define('mass_mailing.mass_mailing',function(require){"use strict";var KanbanColumn=require('web.KanbanColumn');KanbanColumn.include({init:function(){this._super.apply(this,arguments);if(this.modelName==='mailing.mailing'){this.draggable=false;}},});});;

/* /mass_mailing/static/src/js/mass_mailing_widget.js defined in bundle 'web.assets_backend' */
odoo.define('mass_mailing.FieldHtml',function(require){'use strict';var config=require('web.config');var core=require('web.core');var FieldHtml=require('web_editor.field.html');var fieldRegistry=require('web.field_registry');var convertInline=require('web_editor.convertInline');var _t=core._t;var MassMailingFieldHtml=FieldHtml.extend({xmlDependencies:(FieldHtml.prototype.xmlDependencies||[]).concat(["/mass_mailing/static/src/xml/mass_mailing.xml"]),jsLibs:[],custom_events:_.extend({},FieldHtml.prototype.custom_events,{snippets_loaded:'_onSnippetsLoaded',}),init:function(){this._super.apply(this,arguments);if(!this.nodeOptions.snippets){this.nodeOptions.snippets='mass_mailing.email_designer_snippets';}
this.__extraAssetsForIframe=[{jsLibs:['/mass_mailing/static/src/js/mass_mailing_snippets.js'],}];},commitChanges:function(){var self=this;if(config.isDebug()&&this.mode==='edit'){var layoutInfo=$.summernote.core.dom.makeLayoutInfo(this.wysiwyg.$editor);$.summernote.pluginEvents.codeview(undefined,undefined,layoutInfo,false);}
if(this.mode==='readonly'||!this.isRendered){return this._super();}
var fieldName=this.nodeOptions['inline-field'];if(this.$content.find('.o_basic_theme').length){this.$content.find('*').css('font-family','');}
var $editable=this.wysiwyg.getEditable();return this.wysiwyg.saveCroppedImages(this.$content).then(function(){return self.wysiwyg.save().then(function(result){self._isDirty=result.isDirty;convertInline.attachmentThumbnailToLinkImg($editable);convertInline.fontToImg($editable);convertInline.classToStyle($editable);_.each(['width','height'],function(attribute){$editable.find('img[style*="width"], img[style*="height"]').attr(attribute,function(){return $(this)[attribute]();}).css(attribute,function(){return $(this).get(0).style[attribute]||'auto';});});self.trigger_up('field_changed',{dataPointID:self.dataPointID,changes:_.object([fieldName],[self._unWrap($editable.html())])});self.wysiwyg.setValue(result.html);if(self._isDirty&&self.mode==='edit'){return self._doAction();}});});},getDatarecord:function(){return _.omit(this._super(),['mailing_domain','contact_list_ids','body_html','attachment_ids']);},_checkIfMustForceThemeChoice:function(){var firstChoice=this._editableAreaIsEmpty();this.$content.closest('body').toggleClass("o_force_mail_theme_choice",firstChoice);return firstChoice;},_editableAreaIsEmpty:function($layout){$layout=$layout||this.$content.find(".o_layout");var $mailWrapper=$layout.children(".o_mail_wrapper");var $mailWrapperContent=$mailWrapper.find('.o_mail_wrapper_td');if(!$mailWrapperContent.length){$mailWrapperContent=$mailWrapper;}
var value;if($mailWrapperContent.length>0){value=$mailWrapperContent.html();}else if($layout.length){value=$layout.html();}else{value=this.wysiwyg.getValue();}
var blankEditable="<p><br></p>";return value===""||value===blankEditable;},_renderEdit:function(){this._isFromInline=!!this.value;if(!this.value){this.value=this.recordData[this.nodeOptions['inline-field']];}
return this._super.apply(this,arguments);},_renderReadonly:function(){this.value=this.recordData[this.nodeOptions['inline-field']];return this._super.apply(this,arguments);},_renderTranslateButton:function(){var fieldName=this.nodeOptions['inline-field'];if(_t.database.multi_lang&&this.record.fields[fieldName].translate&&this.res_id){return $('<button>',{type:'button','class':'o_field_translate fa fa-globe btn btn-link',}).on('click',this._onTranslate.bind(this));}
return $();},_getSelectedTheme:function(themesParams){var $layout=this.$content.find(".o_layout");var selectedTheme=false;if($layout.length!==0){_.each(themesParams,function(themeParams){if($layout.hasClass(themeParams.className)){selectedTheme=themeParams;}});}
return selectedTheme;},_switchImages:function(themeParams,$container){if(!themeParams){return;}
$container.find("img").each(function(){var $img=$(this);var src=$img.attr("src");var m=src.match(/^\/web\/image\/\w+\.s_default_image_(?:theme_[a-z]+_)?(.+)$/);if(!m){m=src.match(/^\/\w+\/static\/src\/img\/(?:theme_[a-z]+\/)?s_default_image_(.+)\.[a-z]+$/);}
if(!m){return;}
var file=m[1];var img_info=themeParams.get_image_info(file);if(img_info.format){src="/"+img_info.module+"/static/src/img/theme_"+themeParams.name+"/s_default_image_"+file+"."+img_info.format;}else{src="/web/image/"+img_info.module+".s_default_image_theme_"+themeParams.name+"_"+file;}
$img.attr("src",src);});},_switchThemes:function(firstChoice,themeParams){if(!themeParams||this.switchThemeLast===themeParams){return;}
this.switchThemeLast=themeParams;this.$content.closest('body').removeClass(this._allClasses).addClass(themeParams.className);var $old_layout=this.$content.find('.o_layout');var $new_wrapper;var $newWrapperContent;if(themeParams.nowrap){$new_wrapper=$('<div/>',{class:'oe_structure'});$newWrapperContent=$new_wrapper;}else{$new_wrapper=$('<table/>',{class:'o_mail_wrapper'});$newWrapperContent=$('<td/>',{class:'o_mail_no_options o_mail_wrapper_td oe_structure'});$new_wrapper.append($('<tr/>').append($('<td/>',{class:'o_mail_no_resize o_not_editable',contenteditable:'false'}),$newWrapperContent,$('<td/>',{class:'o_mail_no_resize o_not_editable',contenteditable:'false'})));}
var $newLayout=$('<div/>',{class:'o_layout '+themeParams.className}).append($new_wrapper);var $contents;if(firstChoice){$contents=themeParams.template;}else if($old_layout.length){$contents=($old_layout.hasClass('oe_structure')?$old_layout:$old_layout.find('.oe_structure').first()).contents();}else{$contents=this.$content.find('.o_editable').contents();}
$newWrapperContent.append($contents);this._switchImages(themeParams,$newWrapperContent);this.$content.find('.o_editable').empty().append($newLayout);$old_layout.remove();if(firstChoice){$newWrapperContent.find('*').addBack().contents().filter(function(){return this.nodeType===3&&this.textContent.match(/\S/);}).parent().addClass('o_default_snippet_text');if(themeParams.name=='basic'){this.$content.focusIn();}}
this.wysiwyg.trigger('reload_snippet_dropzones');},_onLoadWysiwyg:function(){if(this._isFromInline){this._fromInline();}
if(this.snippetsLoaded){this._onSnippetsLoaded(this.snippetsLoaded);}
this._super();},_onSnippetsLoaded:function(ev){var self=this;if(!this.$content){this.snippetsLoaded=ev;return;}
var $snippetsSideBar=ev.data;var $themes=$snippetsSideBar.find("#email_designer_themes").children();var $snippets=$snippetsSideBar.find(".oe_snippet");var $snippets_menu=$snippetsSideBar.find("#snippets_menu");if(config.device.isMobile){$snippetsSideBar.hide();this.$content.attr('style','padding-left: 0px !important');}
if($themes.length===0){return;}
this._allClasses="";var themesParams=_.map($themes,function(theme){var $theme=$(theme);var name=$theme.data("name");var classname="o_"+name+"_theme";self._allClasses+=" "+classname;var imagesInfo=_.defaults($theme.data("imagesInfo")||{},{all:{}});_.each(imagesInfo,function(info){info=_.defaults(info,imagesInfo.all,{module:"mass_mailing",format:"jpg"});});return{name:name,className:classname||"",img:$theme.data("img")||"",template:$theme.html().trim(),nowrap:!!$theme.data('nowrap'),get_image_info:function(filename){if(imagesInfo[filename]){return imagesInfo[filename];}
return imagesInfo.all;}};});$themes.parent().remove();var $dropdown=$(core.qweb.render("mass_mailing.theme_selector",{themes:themesParams})).dropdown();var firstChoice=this._checkIfMustForceThemeChoice();var $mail_themes_upgrade=$dropdown.find(".o_mass_mailing_themes_upgrade");$mail_themes_upgrade.on("click",function(e){e.stopImmediatePropagation();e.preventDefault();self.do_action("mass_mailing.action_mass_mailing_configuration");});var selectedTheme=false;$dropdown.on("mouseenter",".dropdown-item",function(e){if(firstChoice){return;}
e.preventDefault();var themeParams=themesParams[$(e.currentTarget).index()];self._switchThemes(firstChoice,themeParams);});$dropdown.on("mouseleave",".dropdown-item",function(e){self._switchThemes(false,selectedTheme);});$dropdown.on("click",'[data-toggle="dropdown"]',function(e){var $menu=$dropdown.find('.dropdown-menu');var isVisible=$menu.hasClass('show');if(isVisible){e.preventDefault();e.stopImmediatePropagation();$menu.removeClass('show');}});$dropdown.on("click",".dropdown-item",function(e){e.preventDefault();e.stopImmediatePropagation();var themeParams=themesParams[$(e.currentTarget).index()];if(firstChoice){self._switchThemes(firstChoice,themeParams);self.$content.closest('body').removeClass("o_force_mail_theme_choice");firstChoice=false;if($mail_themes_upgrade.length){$dropdown.remove();$snippets_menu.empty();}}
self._switchImages(themeParams,$snippets);selectedTheme=themeParams;self.wysiwyg.getEditable().trigger('change');$dropdown.find('.dropdown-menu').removeClass('show');$dropdown.find('.dropdown-item.selected').removeClass('selected');$dropdown.find('.dropdown-item:eq('+themesParams.indexOf(selectedTheme)+')').addClass('selected');});$dropdown.on("shown.bs.dropdown",function(){selectedTheme=self._getSelectedTheme(themesParams);$dropdown.find(".dropdown-item").removeClass("selected").filter(function(){return($(this).has(".o_thumb[style=\""+"background-image: url("+(selectedTheme&&selectedTheme.img)+"_small.png)"+"\"]").length>0);}).addClass("selected");});$dropdown.on("hidden.bs.dropdown",function(){self._switchThemes(firstChoice,selectedTheme);});selectedTheme=this._getSelectedTheme(themesParams);if(selectedTheme){this.$content.closest('body').addClass(selectedTheme.className);$dropdown.find('.dropdown-item:eq('+themesParams.indexOf(selectedTheme)+')').addClass('selected');this._switchImages(selectedTheme,$snippets);}else if(this.$content.find('.o_layout').length){themesParams.push({name:'o_mass_mailing_no_theme',className:'o_mass_mailing_no_theme',img:"",template:this.$content.find('.o_layout').addClass('o_mass_mailing_no_theme').clone().find('oe_structure').empty().end().html().trim(),nowrap:true,get_image_info:function(){}});selectedTheme=this._getSelectedTheme(themesParams);}
$dropdown.insertAfter($snippets_menu);},_onTranslate:function(ev){this.trigger_up('translate',{fieldName:this.nodeOptions['inline-field'],id:this.dataPointID,isComingFromTranslationAlert:false,});},});fieldRegistry.add('mass_mailing_html',MassMailingFieldHtml);return MassMailingFieldHtml;});;

/* /mass_mailing/static/src/js/mass_mailing_list_kanban_record.js defined in bundle 'web.assets_backend' */
odoo.define('mass_mailing.ListKanbanRecord',function(require){"use strict";var KanbanRecord=require('web.KanbanRecord');var MassMailingListKanbanRecord=KanbanRecord.extend({_openRecord:function(){this.$('.o_mailing_list_kanban_boxes a').first().click();}});return MassMailingListKanbanRecord;});;

/* /mass_mailing/static/src/js/mass_mailing_list_kanban_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('mass_mailing.ListKanbanRenderer',function(require){"use strict";var MassMailingListKanbanRecord=require('mass_mailing.ListKanbanRecord');var KanbanRenderer=require('web.KanbanRenderer');var MassMailingListKanbanRenderer=KanbanRenderer.extend({config:_.extend({},KanbanRenderer.prototype.config,{KanbanRecord:MassMailingListKanbanRecord,})});return MassMailingListKanbanRenderer;});;

/* /mass_mailing/static/src/js/mass_mailing_list_kanban_view.js defined in bundle 'web.assets_backend' */
odoo.define('mass_mailing.ListKanbanView',function(require){"use strict";var MassMailingListKanbanRenderer=require('mass_mailing.ListKanbanRenderer');var KanbanView=require('web.KanbanView');var view_registry=require('web.view_registry');var MassMailingListKanbanView=KanbanView.extend({config:_.extend({},KanbanView.prototype.config,{Renderer:MassMailingListKanbanRenderer,}),});view_registry.add('mass_mailing_list_kanban',MassMailingListKanbanView);return MassMailingListKanbanView;});;

/* /mass_mailing/static/src/js/unsubscribe.js defined in bundle 'web.assets_backend' */
odoo.define('mass_mailing.unsubscribe',function(require){'use strict';var session=require('web.session');var ajax=require('web.ajax');var core=require('web.core');require('web.dom_ready');var _t=core._t;var email=$("input[name='email']").val();var mailing_id=parseInt($("input[name='mailing_id']").val());var res_id=parseInt($("input[name='res_id']").val());var token=(location.search.split('token'+'=')[1]||'').split('&')[0];if(!$('.o_unsubscribe_form').length){return Promise.reject("DOM doesn't contain '.o_unsubscribe_form'");}
session.load_translations().then(function(){if(email!=''&&email!=undefined){ajax.jsonRpc('/mailing/blacklist/check','call',{'email':email,'mailing_id':mailing_id,'res_id':res_id,'token':token}).then(function(result){if(result=='unauthorized'){$('#button_add_blacklist').hide();$('#button_remove_blacklist').hide();}
else if(result==true){$('#button_remove_blacklist').show();toggle_opt_out_section(false);}
else if(result==false){$('#button_add_blacklist').show();toggle_opt_out_section(true);}
else{$('#subscription_info').html(_t('An error occured. Please try again later or contact us.'));$('#info_state').removeClass('alert-success').removeClass('alert-info').removeClass('alert-warning').addClass('alert-error');}}).guardedCatch(function(){$('#subscription_info').html(_t('An error occured. Please try again later or contact us.'));$('#info_state').removeClass('alert-success').removeClass('alert-info').removeClass('alert-warning').addClass('alert-error');});}
else{$('#div_blacklist').hide();}
var unsubscribed_list=$("input[name='unsubscribed_list']").val();if(unsubscribed_list){$('#subscription_info').html(_.str.sprintf(_t("You have been <strong>successfully unsubscribed from %s</strong>."),_.escape(unsubscribed_list)));}
else{$('#subscription_info').html(_t('You have been <strong>successfully unsubscribed</strong>.'));}});$('#unsubscribe_form').on('submit',function(e){e.preventDefault();var checked_ids=[];$("input[type='checkbox']:checked").each(function(i){checked_ids[i]=parseInt($(this).val());});var unchecked_ids=[];$("input[type='checkbox']:not(:checked)").each(function(i){unchecked_ids[i]=parseInt($(this).val());});ajax.jsonRpc('/mail/mailing/unsubscribe','call',{'opt_in_ids':checked_ids,'opt_out_ids':unchecked_ids,'email':email,'mailing_id':mailing_id,'res_id':res_id,'token':token}).then(function(result){if(result=='unauthorized'){$('#subscription_info').html(_t('You are not authorized to do this!'));$('#info_state').removeClass('alert-success').removeClass('alert-info').removeClass('alert-error').addClass('alert-warning');}
else if(result==true){$('#subscription_info').html(_t('Your changes have been saved.'));$('#info_state').removeClass('alert-info').addClass('alert-success');}
else{$('#subscription_info').html(_t('An error occurred. Your changes have not been saved, try again later.'));$('#info_state').removeClass('alert-info').addClass('alert-warning');}}).guardedCatch(function(){$('#subscription_info').html(_t('An error occurred. Your changes have not been saved, try again later.'));$('#info_state').removeClass('alert-info').addClass('alert-warning');});});$('#button_add_blacklist').click(function(e){e.preventDefault();ajax.jsonRpc('/mailing/blacklist/add','call',{'email':email,'mailing_id':mailing_id,'res_id':res_id,'token':token}).then(function(result){if(result=='unauthorized'){$('#subscription_info').html(_t('You are not authorized to do this!'));$('#info_state').removeClass('alert-success').removeClass('alert-info').removeClass('alert-error').addClass('alert-warning');}
else
{if(result){$('#subscription_info').html(_t('You have been successfully <strong>added to our blacklist</strong>. '
+'You will not be contacted anymore by our services.'));$('#info_state').removeClass('alert-warning').removeClass('alert-info').removeClass('alert-error').addClass('alert-success');toggle_opt_out_section(false);}
else{$('#subscription_info').html(_t('An error occured. Please try again later or contact us.'));$('#info_state').removeClass('alert-success').removeClass('alert-info').removeClass('alert-warning').addClass('alert-error');}
$('#button_add_blacklist').hide();$('#button_remove_blacklist').show();$('#unsubscribed_info').hide();}}).guardedCatch(function(){$('#subscription_info').html(_t('An error occured. Please try again later or contact us.'));$('#info_state').removeClass('alert-success').removeClass('alert-info').removeClass('alert-warning').addClass('alert-error');});});$('#button_remove_blacklist').click(function(e){e.preventDefault();ajax.jsonRpc('/mailing/blacklist/remove','call',{'email':email,'mailing_id':mailing_id,'res_id':res_id,'token':token}).then(function(result){if(result=='unauthorized'){$('#subscription_info').html(_t('You are not authorized to do this!'));$('#info_state').removeClass('alert-success').removeClass('alert-info').removeClass('alert-error').addClass('alert-warning');}
else
{if(result){$('#subscription_info').html(_t("You have been successfully <strong>removed from our blacklist</strong>. "
+"You are now able to be contacted by our services."));$('#info_state').removeClass('alert-warning').removeClass('alert-info').removeClass('alert-error').addClass('alert-success');toggle_opt_out_section(true);}
else{$('#subscription_info').html(_t('An error occured. Please try again later or contact us.'));$('#info_state').removeClass('alert-success').removeClass('alert-info').removeClass('alert-warning').addClass('alert-error');}
$('#button_add_blacklist').show();$('#button_remove_blacklist').hide();$('#unsubscribed_info').hide();}}).guardedCatch(function(){$('#subscription_info').html(_t('An error occured. Please try again later or contact us.'));$('#info_state').removeClass('alert-success').removeClass('alert-info').removeClass('alert-warning').addClass('alert-error');});});$('#button_feedback').click(function(e){var feedback=$("textarea[name='opt_out_feedback']").val();e.preventDefault();ajax.jsonRpc('/mailing/feedback','call',{'mailing_id':mailing_id,'res_id':res_id,'email':email,'feedback':feedback,'token':token}).then(function(result){if(result=='unauthorized'){$('#subscription_info').html(_t('You are not authorized to do this!'));$('#info_state').removeClass('alert-success').removeClass('alert-info').removeClass('alert-error').addClass('alert-warning');}
else if(result==true){$('#subscription_info').html(_t('Thank you! Your feedback has been sent successfully!'));$('#info_state').removeClass('alert-warning').removeClass('alert-info').removeClass('alert-error').addClass('alert-success');$("#div_feedback").hide();}
else{$('#subscription_info').html(_t('An error occured. Please try again later or contact us.'));$('#info_state').removeClass('alert-success').removeClass('alert-info').removeClass('alert-error').addClass('alert-warning');}}).guardedCatch(function(){$('#subscription_info').html(_t('An error occured. Please try again later or contact us.'));$('#info_state').removeClass('alert-info').removeClass('alert-success').removeClass('alert-error').addClass('alert-warning');});});});function toggle_opt_out_section(value){var result=!value;$("#div_opt_out").find('*').attr('disabled',result);$("#button_add_blacklist").attr('disabled',false);$("#button_remove_blacklist").attr('disabled',false);if(value){$('[name="button_subscription"]').addClass('clickable');}
else{$('[name="button_subscription"]').removeClass('clickable');}};

/* /app_web_widget_ztree/static/src/lib/ztree_v3/js/jquery.ztree.core.js defined in bundle 'web.assets_backend' */
(function($){var settings={},roots={},caches={},_consts={className:{BUTTON:"button",LEVEL:"level",ICO_LOADING:"ico_loading",SWITCH:"switch",NAME:'node_name'},event:{NODECREATED:"ztree_nodeCreated",CLICK:"ztree_click",EXPAND:"ztree_expand",COLLAPSE:"ztree_collapse",ASYNC_SUCCESS:"ztree_async_success",ASYNC_ERROR:"ztree_async_error",REMOVE:"ztree_remove",SELECTED:"ztree_selected",UNSELECTED:"ztree_unselected"},id:{A:"_a",ICON:"_ico",SPAN:"_span",SWITCH:"_switch",UL:"_ul"},line:{ROOT:"root",ROOTS:"roots",CENTER:"center",BOTTOM:"bottom",NOLINE:"noline",LINE:"line"},folder:{OPEN:"open",CLOSE:"close",DOCU:"docu"},node:{CURSELECTED:"curSelectedNode"}},_setting={treeId:"",treeObj:null,view:{addDiyDom:null,autoCancelSelected:true,dblClickExpand:true,expandSpeed:"fast",fontCss:{},nameIsHTML:false,selectedMulti:true,showIcon:true,showLine:true,showTitle:true,txtSelectedEnable:false},data:{key:{isParent:"isParent",children:"children",name:"name",title:"",url:"url",icon:"icon"},simpleData:{enable:false,idKey:"id",pIdKey:"pId",rootPId:null},keep:{parent:false,leaf:false}},async:{enable:false,contentType:"application/x-www-form-urlencoded",type:"post",dataType:"text",headers:{},xhrFields:{},url:"",autoParam:[],otherParam:[],dataFilter:null},callback:{beforeAsync:null,beforeClick:null,beforeDblClick:null,beforeRightClick:null,beforeMouseDown:null,beforeMouseUp:null,beforeExpand:null,beforeCollapse:null,beforeRemove:null,onAsyncError:null,onAsyncSuccess:null,onNodeCreated:null,onClick:null,onDblClick:null,onRightClick:null,onMouseDown:null,onMouseUp:null,onExpand:null,onCollapse:null,onRemove:null}},_initRoot=function(setting){var r=data.getRoot(setting);if(!r){r={};data.setRoot(setting,r);}
data.nodeChildren(setting,r,[]);r.expandTriggerFlag=false;r.curSelectedList=[];r.noSelection=true;r.createdNodes=[];r.zId=0;r._ver=(new Date()).getTime();},_initCache=function(setting){var c=data.getCache(setting);if(!c){c={};data.setCache(setting,c);}
c.nodes=[];c.doms=[];},_bindEvent=function(setting){var o=setting.treeObj,c=consts.event;o.bind(c.NODECREATED,function(event,treeId,node){tools.apply(setting.callback.onNodeCreated,[event,treeId,node]);});o.bind(c.CLICK,function(event,srcEvent,treeId,node,clickFlag){tools.apply(setting.callback.onClick,[srcEvent,treeId,node,clickFlag]);});o.bind(c.EXPAND,function(event,treeId,node){tools.apply(setting.callback.onExpand,[event,treeId,node]);});o.bind(c.COLLAPSE,function(event,treeId,node){tools.apply(setting.callback.onCollapse,[event,treeId,node]);});o.bind(c.ASYNC_SUCCESS,function(event,treeId,node,msg){tools.apply(setting.callback.onAsyncSuccess,[event,treeId,node,msg]);});o.bind(c.ASYNC_ERROR,function(event,treeId,node,XMLHttpRequest,textStatus,errorThrown){tools.apply(setting.callback.onAsyncError,[event,treeId,node,XMLHttpRequest,textStatus,errorThrown]);});o.bind(c.REMOVE,function(event,treeId,treeNode){tools.apply(setting.callback.onRemove,[event,treeId,treeNode]);});o.bind(c.SELECTED,function(event,treeId,node){tools.apply(setting.callback.onSelected,[treeId,node]);});o.bind(c.UNSELECTED,function(event,treeId,node){tools.apply(setting.callback.onUnSelected,[treeId,node]);});},_unbindEvent=function(setting){var o=setting.treeObj,c=consts.event;o.unbind(c.NODECREATED).unbind(c.CLICK).unbind(c.EXPAND).unbind(c.COLLAPSE).unbind(c.ASYNC_SUCCESS).unbind(c.ASYNC_ERROR).unbind(c.REMOVE).unbind(c.SELECTED).unbind(c.UNSELECTED);},_eventProxy=function(event){var target=event.target,setting=data.getSetting(event.data.treeId),tId="",node=null,nodeEventType="",treeEventType="",nodeEventCallback=null,treeEventCallback=null,tmp=null;if(tools.eqs(event.type,"mousedown")){treeEventType="mousedown";}else if(tools.eqs(event.type,"mouseup")){treeEventType="mouseup";}else if(tools.eqs(event.type,"contextmenu")){treeEventType="contextmenu";}else if(tools.eqs(event.type,"click")){if(tools.eqs(target.tagName,"span")&&target.getAttribute("treeNode"+consts.id.SWITCH)!==null){tId=tools.getNodeMainDom(target).id;nodeEventType="switchNode";}else{tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(tmp){tId=tools.getNodeMainDom(tmp).id;nodeEventType="clickNode";}}}else if(tools.eqs(event.type,"dblclick")){treeEventType="dblclick";tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(tmp){tId=tools.getNodeMainDom(tmp).id;nodeEventType="switchNode";}}
if(treeEventType.length>0&&tId.length==0){tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(tmp){tId=tools.getNodeMainDom(tmp).id;}}
if(tId.length>0){node=data.getNodeCache(setting,tId);switch(nodeEventType){case"switchNode":var isParent=data.nodeIsParent(setting,node);if(!isParent){nodeEventType="";}else if(tools.eqs(event.type,"click")||(tools.eqs(event.type,"dblclick")&&tools.apply(setting.view.dblClickExpand,[setting.treeId,node],setting.view.dblClickExpand))){nodeEventCallback=handler.onSwitchNode;}else{nodeEventType="";}
break;case"clickNode":nodeEventCallback=handler.onClickNode;break;}}
switch(treeEventType){case"mousedown":treeEventCallback=handler.onZTreeMousedown;break;case"mouseup":treeEventCallback=handler.onZTreeMouseup;break;case"dblclick":treeEventCallback=handler.onZTreeDblclick;break;case"contextmenu":treeEventCallback=handler.onZTreeContextmenu;break;}
var proxyResult={stop:false,node:node,nodeEventType:nodeEventType,nodeEventCallback:nodeEventCallback,treeEventType:treeEventType,treeEventCallback:treeEventCallback};return proxyResult},_initNode=function(setting,level,n,parentNode,isFirstNode,isLastNode,openFlag){if(!n)return;var r=data.getRoot(setting),children=data.nodeChildren(setting,n);n.level=level;n.tId=setting.treeId+"_"+(++r.zId);n.parentTId=parentNode?parentNode.tId:null;n.open=(typeof n.open=="string")?tools.eqs(n.open,"true"):!!n.open;var isParent=data.nodeIsParent(setting,n);if(tools.isArray(children)&&!(isParent===false||(typeof isParent=="string"&&tools.eqs(isParent,"false")))){data.nodeIsParent(setting,n,true);n.zAsync=true;}else{isParent=data.nodeIsParent(setting,n,isParent);n.open=(isParent&&!setting.async.enable)?n.open:false;n.zAsync=!isParent;}
n.isFirstNode=isFirstNode;n.isLastNode=isLastNode;n.getParentNode=function(){return data.getNodeCache(setting,n.parentTId);};n.getPreNode=function(){return data.getPreNode(setting,n);};n.getNextNode=function(){return data.getNextNode(setting,n);};n.getIndex=function(){return data.getNodeIndex(setting,n);};n.getPath=function(){return data.getNodePath(setting,n);};n.isAjaxing=false;data.fixPIdKeyValue(setting,n);},_init={bind:[_bindEvent],unbind:[_unbindEvent],caches:[_initCache],nodes:[_initNode],proxys:[_eventProxy],roots:[_initRoot],beforeA:[],afterA:[],innerBeforeA:[],innerAfterA:[],zTreeTools:[]},data={addNodeCache:function(setting,node){data.getCache(setting).nodes[data.getNodeCacheId(node.tId)]=node;},getNodeCacheId:function(tId){return tId.substring(tId.lastIndexOf("_")+1);},addAfterA:function(afterA){_init.afterA.push(afterA);},addBeforeA:function(beforeA){_init.beforeA.push(beforeA);},addInnerAfterA:function(innerAfterA){_init.innerAfterA.push(innerAfterA);},addInnerBeforeA:function(innerBeforeA){_init.innerBeforeA.push(innerBeforeA);},addInitBind:function(bindEvent){_init.bind.push(bindEvent);},addInitUnBind:function(unbindEvent){_init.unbind.push(unbindEvent);},addInitCache:function(initCache){_init.caches.push(initCache);},addInitNode:function(initNode){_init.nodes.push(initNode);},addInitProxy:function(initProxy,isFirst){if(!!isFirst){_init.proxys.splice(0,0,initProxy);}else{_init.proxys.push(initProxy);}},addInitRoot:function(initRoot){_init.roots.push(initRoot);},addNodesData:function(setting,parentNode,index,nodes){var children=data.nodeChildren(setting,parentNode),params;if(!children){children=data.nodeChildren(setting,parentNode,[]);index=-1;}else if(index>=children.length){index=-1;}
if(children.length>0&&index===0){children[0].isFirstNode=false;view.setNodeLineIcos(setting,children[0]);}else if(children.length>0&&index<0){children[children.length-1].isLastNode=false;view.setNodeLineIcos(setting,children[children.length-1]);}
data.nodeIsParent(setting,parentNode,true);if(index<0){data.nodeChildren(setting,parentNode,children.concat(nodes));}else{params=[index,0].concat(nodes);children.splice.apply(children,params);}},addSelectedNode:function(setting,node){var root=data.getRoot(setting);if(!data.isSelectedNode(setting,node)){root.curSelectedList.push(node);}},addCreatedNode:function(setting,node){if(!!setting.callback.onNodeCreated||!!setting.view.addDiyDom){var root=data.getRoot(setting);root.createdNodes.push(node);}},addZTreeTools:function(zTreeTools){_init.zTreeTools.push(zTreeTools);},exSetting:function(s){$.extend(true,_setting,s);},fixPIdKeyValue:function(setting,node){if(setting.data.simpleData.enable){node[setting.data.simpleData.pIdKey]=node.parentTId?node.getParentNode()[setting.data.simpleData.idKey]:setting.data.simpleData.rootPId;}},getAfterA:function(setting,node,array){for(var i=0,j=_init.afterA.length;i<j;i++){_init.afterA[i].apply(this,arguments);}},getBeforeA:function(setting,node,array){for(var i=0,j=_init.beforeA.length;i<j;i++){_init.beforeA[i].apply(this,arguments);}},getInnerAfterA:function(setting,node,array){for(var i=0,j=_init.innerAfterA.length;i<j;i++){_init.innerAfterA[i].apply(this,arguments);}},getInnerBeforeA:function(setting,node,array){for(var i=0,j=_init.innerBeforeA.length;i<j;i++){_init.innerBeforeA[i].apply(this,arguments);}},getCache:function(setting){return caches[setting.treeId];},getNodeIndex:function(setting,node){if(!node)return null;var p=node.parentTId?node.getParentNode():data.getRoot(setting),children=data.nodeChildren(setting,p);for(var i=0,l=children.length-1;i<=l;i++){if(children[i]===node){return i;}}
return-1;},getNextNode:function(setting,node){if(!node)return null;var p=node.parentTId?node.getParentNode():data.getRoot(setting),children=data.nodeChildren(setting,p);for(var i=0,l=children.length-1;i<=l;i++){if(children[i]===node){return(i==l?null:children[i+1]);}}
return null;},getNodeByParam:function(setting,nodes,key,value){if(!nodes||!key)return null;for(var i=0,l=nodes.length;i<l;i++){var node=nodes[i];if(node[key]==value){return nodes[i];}
var children=data.nodeChildren(setting,node);var tmp=data.getNodeByParam(setting,children,key,value);if(tmp)return tmp;}
return null;},getNodeCache:function(setting,tId){if(!tId)return null;var n=caches[setting.treeId].nodes[data.getNodeCacheId(tId)];return n?n:null;},getNodePath:function(setting,node){if(!node)return null;var path;if(node.parentTId){path=node.getParentNode().getPath();}else{path=[];}
if(path){path.push(node);}
return path;},getNodes:function(setting){return data.nodeChildren(setting,data.getRoot(setting));},getNodesByParam:function(setting,nodes,key,value){if(!nodes||!key)return[];var result=[];for(var i=0,l=nodes.length;i<l;i++){var node=nodes[i];if(node[key]==value){result.push(node);}
var children=data.nodeChildren(setting,node);result=result.concat(data.getNodesByParam(setting,children,key,value));}
return result;},getNodesByParamFuzzy:function(setting,nodes,key,value){if(!nodes||!key)return[];var result=[];value=value.toLowerCase();for(var i=0,l=nodes.length;i<l;i++){var node=nodes[i];if(typeof node[key]=="string"&&nodes[i][key].toLowerCase().indexOf(value)>-1){result.push(node);}
var children=data.nodeChildren(setting,node);result=result.concat(data.getNodesByParamFuzzy(setting,children,key,value));}
return result;},getNodesByFilter:function(setting,nodes,filter,isSingle,invokeParam){if(!nodes)return(isSingle?null:[]);var result=isSingle?null:[];for(var i=0,l=nodes.length;i<l;i++){var node=nodes[i];if(tools.apply(filter,[node,invokeParam],false)){if(isSingle){return node;}
result.push(node);}
var children=data.nodeChildren(setting,node);var tmpResult=data.getNodesByFilter(setting,children,filter,isSingle,invokeParam);if(isSingle&&!!tmpResult){return tmpResult;}
result=isSingle?tmpResult:result.concat(tmpResult);}
return result;},getPreNode:function(setting,node){if(!node)return null;var p=node.parentTId?node.getParentNode():data.getRoot(setting),children=data.nodeChildren(setting,p);for(var i=0,l=children.length;i<l;i++){if(children[i]===node){return(i==0?null:children[i-1]);}}
return null;},getRoot:function(setting){return setting?roots[setting.treeId]:null;},getRoots:function(){return roots;},getSetting:function(treeId){return settings[treeId];},getSettings:function(){return settings;},getZTreeTools:function(treeId){var r=this.getRoot(this.getSetting(treeId));return r?r.treeTools:null;},initCache:function(setting){for(var i=0,j=_init.caches.length;i<j;i++){_init.caches[i].apply(this,arguments);}},initNode:function(setting,level,node,parentNode,preNode,nextNode){for(var i=0,j=_init.nodes.length;i<j;i++){_init.nodes[i].apply(this,arguments);}},initRoot:function(setting){for(var i=0,j=_init.roots.length;i<j;i++){_init.roots[i].apply(this,arguments);}},isSelectedNode:function(setting,node){var root=data.getRoot(setting);for(var i=0,j=root.curSelectedList.length;i<j;i++){if(node===root.curSelectedList[i])return true;}
return false;},nodeChildren:function(setting,node,newChildren){if(!node){return null;}
var key=setting.data.key.children;if(typeof newChildren!=='undefined'){node[key]=newChildren;}
return node[key];},nodeIsParent:function(setting,node,newIsParent){if(!node){return false;}
var key=setting.data.key.isParent;if(typeof newIsParent!=='undefined'){if(typeof newIsParent==="string"){newIsParent=tools.eqs(newIsParent,"true");}
newIsParent=!!newIsParent;node[key]=newIsParent;}
return node[key];},nodeName:function(setting,node,newName){var key=setting.data.key.name;if(typeof newName!=='undefined'){node[key]=newName;}
return""+node[key];},nodeTitle:function(setting,node){var t=setting.data.key.title===""?setting.data.key.name:setting.data.key.title;return""+node[t];},removeNodeCache:function(setting,node){var children=data.nodeChildren(setting,node);if(children){for(var i=0,l=children.length;i<l;i++){data.removeNodeCache(setting,children[i]);}}
data.getCache(setting).nodes[data.getNodeCacheId(node.tId)]=null;},removeSelectedNode:function(setting,node){var root=data.getRoot(setting);for(var i=0,j=root.curSelectedList.length;i<j;i++){if(node===root.curSelectedList[i]||!data.getNodeCache(setting,root.curSelectedList[i].tId)){root.curSelectedList.splice(i,1);setting.treeObj.trigger(consts.event.UNSELECTED,[setting.treeId,node]);i--;j--;}}},setCache:function(setting,cache){caches[setting.treeId]=cache;},setRoot:function(setting,root){roots[setting.treeId]=root;},setZTreeTools:function(setting,zTreeTools){for(var i=0,j=_init.zTreeTools.length;i<j;i++){_init.zTreeTools[i].apply(this,arguments);}},transformToArrayFormat:function(setting,nodes){if(!nodes)return[];var r=[];if(tools.isArray(nodes)){for(var i=0,l=nodes.length;i<l;i++){var node=nodes[i];_do(node);}}else{_do(nodes);}
return r;function _do(_node){r.push(_node);var children=data.nodeChildren(setting,_node);if(children){r=r.concat(data.transformToArrayFormat(setting,children));}}},transformTozTreeFormat:function(setting,sNodes){var i,l,key=setting.data.simpleData.idKey,parentKey=setting.data.simpleData.pIdKey;if(!key||key==""||!sNodes)return[];if(tools.isArray(sNodes)){var r=[];var tmpMap={};for(i=0,l=sNodes.length;i<l;i++){tmpMap[sNodes[i][key]]=sNodes[i];}
for(i=0,l=sNodes.length;i<l;i++){var p=tmpMap[sNodes[i][parentKey]];if(p&&sNodes[i][key]!=sNodes[i][parentKey]){var children=data.nodeChildren(setting,p);if(!children){children=data.nodeChildren(setting,p,[]);}
children.push(sNodes[i]);}else{r.push(sNodes[i]);}}
return r;}else{return[sNodes];}}},event={bindEvent:function(setting){for(var i=0,j=_init.bind.length;i<j;i++){_init.bind[i].apply(this,arguments);}},unbindEvent:function(setting){for(var i=0,j=_init.unbind.length;i<j;i++){_init.unbind[i].apply(this,arguments);}},bindTree:function(setting){var eventParam={treeId:setting.treeId},o=setting.treeObj;if(!setting.view.txtSelectedEnable){o.bind('selectstart',handler.onSelectStart).css({"-moz-user-select":"-moz-none"});}
o.bind('click',eventParam,event.proxy);o.bind('dblclick',eventParam,event.proxy);o.bind('mouseover',eventParam,event.proxy);o.bind('mouseout',eventParam,event.proxy);o.bind('mousedown',eventParam,event.proxy);o.bind('mouseup',eventParam,event.proxy);o.bind('contextmenu',eventParam,event.proxy);},unbindTree:function(setting){var o=setting.treeObj;o.unbind('selectstart',handler.onSelectStart).unbind('click',event.proxy).unbind('dblclick',event.proxy).unbind('mouseover',event.proxy).unbind('mouseout',event.proxy).unbind('mousedown',event.proxy).unbind('mouseup',event.proxy).unbind('contextmenu',event.proxy);},doProxy:function(e){var results=[];for(var i=0,j=_init.proxys.length;i<j;i++){var proxyResult=_init.proxys[i].apply(this,arguments);results.push(proxyResult);if(proxyResult.stop){break;}}
return results;},proxy:function(e){var setting=data.getSetting(e.data.treeId);if(!tools.uCanDo(setting,e))return true;var results=event.doProxy(e),r=true,x=false;for(var i=0,l=results.length;i<l;i++){var proxyResult=results[i];if(proxyResult.nodeEventCallback){x=true;r=proxyResult.nodeEventCallback.apply(proxyResult,[e,proxyResult.node])&&r;}
if(proxyResult.treeEventCallback){x=true;r=proxyResult.treeEventCallback.apply(proxyResult,[e,proxyResult.node])&&r;}}
return r;}},handler={onSwitchNode:function(event,node){var setting=data.getSetting(event.data.treeId);if(node.open){if(tools.apply(setting.callback.beforeCollapse,[setting.treeId,node],true)==false)return true;data.getRoot(setting).expandTriggerFlag=true;view.switchNode(setting,node);}else{if(tools.apply(setting.callback.beforeExpand,[setting.treeId,node],true)==false)return true;data.getRoot(setting).expandTriggerFlag=true;view.switchNode(setting,node);}
return true;},onClickNode:function(event,node){var setting=data.getSetting(event.data.treeId),clickFlag=((setting.view.autoCancelSelected&&(event.ctrlKey||event.metaKey))&&data.isSelectedNode(setting,node))?0:(setting.view.autoCancelSelected&&(event.ctrlKey||event.metaKey)&&setting.view.selectedMulti)?2:1;if(tools.apply(setting.callback.beforeClick,[setting.treeId,node,clickFlag],true)==false)return true;if(clickFlag===0){view.cancelPreSelectedNode(setting,node);}else{view.selectNode(setting,node,clickFlag===2);}
setting.treeObj.trigger(consts.event.CLICK,[event,setting.treeId,node,clickFlag]);return true;},onZTreeMousedown:function(event,node){var setting=data.getSetting(event.data.treeId);if(tools.apply(setting.callback.beforeMouseDown,[setting.treeId,node],true)){tools.apply(setting.callback.onMouseDown,[event,setting.treeId,node]);}
return true;},onZTreeMouseup:function(event,node){var setting=data.getSetting(event.data.treeId);if(tools.apply(setting.callback.beforeMouseUp,[setting.treeId,node],true)){tools.apply(setting.callback.onMouseUp,[event,setting.treeId,node]);}
return true;},onZTreeDblclick:function(event,node){var setting=data.getSetting(event.data.treeId);if(tools.apply(setting.callback.beforeDblClick,[setting.treeId,node],true)){tools.apply(setting.callback.onDblClick,[event,setting.treeId,node]);}
return true;},onZTreeContextmenu:function(event,node){var setting=data.getSetting(event.data.treeId);if(tools.apply(setting.callback.beforeRightClick,[setting.treeId,node],true)){tools.apply(setting.callback.onRightClick,[event,setting.treeId,node]);}
return(typeof setting.callback.onRightClick)!="function";},onSelectStart:function(e){var n=e.originalEvent.srcElement.nodeName.toLowerCase();return(n==="input"||n==="textarea");}},tools={apply:function(fun,param,defaultValue){if((typeof fun)=="function"){return fun.apply(zt,param?param:[]);}
return defaultValue;},canAsync:function(setting,node){var children=data.nodeChildren(setting,node);var isParent=data.nodeIsParent(setting,node);return(setting.async.enable&&node&&isParent&&!(node.zAsync||(children&&children.length>0)));},clone:function(obj){if(obj===null)return null;var o=tools.isArray(obj)?[]:{};for(var i in obj){o[i]=(obj[i]instanceof Date)?new Date(obj[i].getTime()):(typeof obj[i]==="object"?tools.clone(obj[i]):obj[i]);}
return o;},eqs:function(str1,str2){return str1.toLowerCase()===str2.toLowerCase();},isArray:function(arr){return Object.prototype.toString.apply(arr)==="[object Array]";},isElement:function(o){return(typeof HTMLElement==="object"?o instanceof HTMLElement:o&&typeof o==="object"&&o!==null&&o.nodeType===1&&typeof o.nodeName==="string");},$:function(node,exp,setting){if(!!exp&&typeof exp!="string"){setting=exp;exp="";}
if(typeof node=="string"){return $(node,setting?setting.treeObj.get(0).ownerDocument:null);}else{return $("#"+node.tId+exp,setting?setting.treeObj:null);}},getMDom:function(setting,curDom,targetExpr){if(!curDom)return null;while(curDom&&curDom.id!==setting.treeId){for(var i=0,l=targetExpr.length;curDom.tagName&&i<l;i++){if(tools.eqs(curDom.tagName,targetExpr[i].tagName)&&curDom.getAttribute(targetExpr[i].attrName)!==null){return curDom;}}
curDom=curDom.parentNode;}
return null;},getNodeMainDom:function(target){return($(target).parent("li").get(0)||$(target).parentsUntil("li").parent().get(0));},isChildOrSelf:function(dom,parentId){return($(dom).closest("#"+parentId).length>0);},uCanDo:function(setting,e){return true;}},view={addNodes:function(setting,parentNode,index,newNodes,isSilent){var isParent=data.nodeIsParent(setting,parentNode);if(setting.data.keep.leaf&&parentNode&&!isParent){return;}
if(!tools.isArray(newNodes)){newNodes=[newNodes];}
if(setting.data.simpleData.enable){newNodes=data.transformTozTreeFormat(setting,newNodes);}
if(parentNode){var target_switchObj=$$(parentNode,consts.id.SWITCH,setting),target_icoObj=$$(parentNode,consts.id.ICON,setting),target_ulObj=$$(parentNode,consts.id.UL,setting);if(!parentNode.open){view.replaceSwitchClass(parentNode,target_switchObj,consts.folder.CLOSE);view.replaceIcoClass(parentNode,target_icoObj,consts.folder.CLOSE);parentNode.open=false;target_ulObj.css({"display":"none"});}
data.addNodesData(setting,parentNode,index,newNodes);view.createNodes(setting,parentNode.level+1,newNodes,parentNode,index);if(!isSilent){view.expandCollapseParentNode(setting,parentNode,true);}}else{data.addNodesData(setting,data.getRoot(setting),index,newNodes);view.createNodes(setting,0,newNodes,null,index);}},appendNodes:function(setting,level,nodes,parentNode,index,initFlag,openFlag){if(!nodes)return[];var html=[];var tmpPNode=(parentNode)?parentNode:data.getRoot(setting),tmpPChild=data.nodeChildren(setting,tmpPNode),isFirstNode,isLastNode;if(!tmpPChild||index>=tmpPChild.length-nodes.length){index=-1;}
for(var i=0,l=nodes.length;i<l;i++){var node=nodes[i];if(initFlag){isFirstNode=((index===0||tmpPChild.length==nodes.length)&&(i==0));isLastNode=(index<0&&i==(nodes.length-1));data.initNode(setting,level,node,parentNode,isFirstNode,isLastNode,openFlag);data.addNodeCache(setting,node);}
var isParent=data.nodeIsParent(setting,node);var childHtml=[];var children=data.nodeChildren(setting,node);if(children&&children.length>0){childHtml=view.appendNodes(setting,level+1,children,node,-1,initFlag,openFlag&&node.open);}
if(openFlag){view.makeDOMNodeMainBefore(html,setting,node);view.makeDOMNodeLine(html,setting,node);data.getBeforeA(setting,node,html);view.makeDOMNodeNameBefore(html,setting,node);data.getInnerBeforeA(setting,node,html);view.makeDOMNodeIcon(html,setting,node);data.getInnerAfterA(setting,node,html);view.makeDOMNodeNameAfter(html,setting,node);data.getAfterA(setting,node,html);if(isParent&&node.open){view.makeUlHtml(setting,node,html,childHtml.join(''));}
view.makeDOMNodeMainAfter(html,setting,node);data.addCreatedNode(setting,node);}}
return html;},appendParentULDom:function(setting,node){var html=[],nObj=$$(node,setting);if(!nObj.get(0)&&!!node.parentTId){view.appendParentULDom(setting,node.getParentNode());nObj=$$(node,setting);}
var ulObj=$$(node,consts.id.UL,setting);if(ulObj.get(0)){ulObj.remove();}
var children=data.nodeChildren(setting,node),childHtml=view.appendNodes(setting,node.level+1,children,node,-1,false,true);view.makeUlHtml(setting,node,html,childHtml.join(''));nObj.append(html.join(''));},asyncNode:function(setting,node,isSilent,callback){var i,l;var isParent=data.nodeIsParent(setting,node);if(node&&!isParent){tools.apply(callback);return false;}else if(node&&node.isAjaxing){return false;}else if(tools.apply(setting.callback.beforeAsync,[setting.treeId,node],true)==false){tools.apply(callback);return false;}
if(node){node.isAjaxing=true;var icoObj=$$(node,consts.id.ICON,setting);icoObj.attr({"style":"","class":consts.className.BUTTON+" "+consts.className.ICO_LOADING});}
var tmpParam={};var autoParam=tools.apply(setting.async.autoParam,[setting.treeId,node],setting.async.autoParam);for(i=0,l=autoParam.length;node&&i<l;i++){var pKey=autoParam[i].split("="),spKey=pKey;if(pKey.length>1){spKey=pKey[1];pKey=pKey[0];}
tmpParam[spKey]=node[pKey];}
var otherParam=tools.apply(setting.async.otherParam,[setting.treeId,node],setting.async.otherParam);if(tools.isArray(otherParam)){for(i=0,l=otherParam.length;i<l;i+=2){tmpParam[otherParam[i]]=otherParam[i+1];}}else{for(var p in otherParam){tmpParam[p]=otherParam[p];}}
var _tmpV=data.getRoot(setting)._ver;$.ajax({contentType:setting.async.contentType,cache:false,type:setting.async.type,url:tools.apply(setting.async.url,[setting.treeId,node],setting.async.url),data:setting.async.contentType.indexOf('application/json')>-1?JSON.stringify(tmpParam):tmpParam,dataType:setting.async.dataType,headers:setting.async.headers,xhrFields:setting.async.xhrFields,success:function(msg){if(_tmpV!=data.getRoot(setting)._ver){return;}
var newNodes=[];try{if(!msg||msg.length==0){newNodes=[];}else if(typeof msg=="string"){newNodes=eval("("+msg+")");}else{newNodes=msg;}}catch(err){newNodes=msg;}
if(node){node.isAjaxing=null;node.zAsync=true;}
view.setNodeLineIcos(setting,node);if(newNodes&&newNodes!==""){newNodes=tools.apply(setting.async.dataFilter,[setting.treeId,node,newNodes],newNodes);view.addNodes(setting,node,-1,!!newNodes?tools.clone(newNodes):[],!!isSilent);}else{view.addNodes(setting,node,-1,[],!!isSilent);}
setting.treeObj.trigger(consts.event.ASYNC_SUCCESS,[setting.treeId,node,msg]);tools.apply(callback);},error:function(XMLHttpRequest,textStatus,errorThrown){if(_tmpV!=data.getRoot(setting)._ver){return;}
if(node)node.isAjaxing=null;view.setNodeLineIcos(setting,node);setting.treeObj.trigger(consts.event.ASYNC_ERROR,[setting.treeId,node,XMLHttpRequest,textStatus,errorThrown]);}});return true;},cancelPreSelectedNode:function(setting,node,excludeNode){var list=data.getRoot(setting).curSelectedList,i,n;for(i=list.length-1;i>=0;i--){n=list[i];if(node===n||(!node&&(!excludeNode||excludeNode!==n))){$$(n,consts.id.A,setting).removeClass(consts.node.CURSELECTED);if(node){data.removeSelectedNode(setting,node);break;}else{list.splice(i,1);setting.treeObj.trigger(consts.event.UNSELECTED,[setting.treeId,n]);}}}},createNodeCallback:function(setting){if(!!setting.callback.onNodeCreated||!!setting.view.addDiyDom){var root=data.getRoot(setting);while(root.createdNodes.length>0){var node=root.createdNodes.shift();tools.apply(setting.view.addDiyDom,[setting.treeId,node]);if(!!setting.callback.onNodeCreated){setting.treeObj.trigger(consts.event.NODECREATED,[setting.treeId,node]);}}}},createNodes:function(setting,level,nodes,parentNode,index){if(!nodes||nodes.length==0)return;var root=data.getRoot(setting),openFlag=!parentNode||parentNode.open||!!$$(data.nodeChildren(setting,parentNode)[0],setting).get(0);root.createdNodes=[];var zTreeHtml=view.appendNodes(setting,level,nodes,parentNode,index,true,openFlag),parentObj,nextObj;if(!parentNode){parentObj=setting.treeObj;}else{var ulObj=$$(parentNode,consts.id.UL,setting);if(ulObj.get(0)){parentObj=ulObj;}}
if(parentObj){if(index>=0){nextObj=parentObj.children()[index];}
if(index>=0&&nextObj){$(nextObj).before(zTreeHtml.join(''));}else{parentObj.append(zTreeHtml.join(''));}}
view.createNodeCallback(setting);},destroy:function(setting){if(!setting)return;data.initCache(setting);data.initRoot(setting);event.unbindTree(setting);event.unbindEvent(setting);setting.treeObj.empty();delete settings[setting.treeId];},expandCollapseNode:function(setting,node,expandFlag,animateFlag,callback){var root=data.getRoot(setting);var tmpCb,_callback;if(!node){tools.apply(callback,[]);return;}
var children=data.nodeChildren(setting,node);var isParent=data.nodeIsParent(setting,node);if(root.expandTriggerFlag){_callback=callback;tmpCb=function(){if(_callback)_callback();if(node.open){setting.treeObj.trigger(consts.event.EXPAND,[setting.treeId,node]);}else{setting.treeObj.trigger(consts.event.COLLAPSE,[setting.treeId,node]);}};callback=tmpCb;root.expandTriggerFlag=false;}
if(!node.open&&isParent&&((!$$(node,consts.id.UL,setting).get(0))||(children&&children.length>0&&!$$(children[0],setting).get(0)))){view.appendParentULDom(setting,node);view.createNodeCallback(setting);}
if(node.open==expandFlag){tools.apply(callback,[]);return;}
var ulObj=$$(node,consts.id.UL,setting),switchObj=$$(node,consts.id.SWITCH,setting),icoObj=$$(node,consts.id.ICON,setting);if(isParent){node.open=!node.open;if(node.iconOpen&&node.iconClose){icoObj.attr("style",view.makeNodeIcoStyle(setting,node));}
if(node.open){view.replaceSwitchClass(node,switchObj,consts.folder.OPEN);view.replaceIcoClass(node,icoObj,consts.folder.OPEN);if(animateFlag==false||setting.view.expandSpeed==""){ulObj.show();tools.apply(callback,[]);}else{if(children&&children.length>0){ulObj.slideDown(setting.view.expandSpeed,callback);}else{ulObj.show();tools.apply(callback,[]);}}}else{view.replaceSwitchClass(node,switchObj,consts.folder.CLOSE);view.replaceIcoClass(node,icoObj,consts.folder.CLOSE);if(animateFlag==false||setting.view.expandSpeed==""||!(children&&children.length>0)){ulObj.hide();tools.apply(callback,[]);}else{ulObj.slideUp(setting.view.expandSpeed,callback);}}}else{tools.apply(callback,[]);}},expandCollapseParentNode:function(setting,node,expandFlag,animateFlag,callback){if(!node)return;if(!node.parentTId){view.expandCollapseNode(setting,node,expandFlag,animateFlag,callback);return;}else{view.expandCollapseNode(setting,node,expandFlag,animateFlag);}
if(node.parentTId){view.expandCollapseParentNode(setting,node.getParentNode(),expandFlag,animateFlag,callback);}},expandCollapseSonNode:function(setting,node,expandFlag,animateFlag,callback){var root=data.getRoot(setting),treeNodes=(node)?data.nodeChildren(setting,node):data.nodeChildren(setting,root),selfAnimateSign=(node)?false:animateFlag,expandTriggerFlag=data.getRoot(setting).expandTriggerFlag;data.getRoot(setting).expandTriggerFlag=false;if(treeNodes){for(var i=0,l=treeNodes.length;i<l;i++){if(treeNodes[i])view.expandCollapseSonNode(setting,treeNodes[i],expandFlag,selfAnimateSign);}}
data.getRoot(setting).expandTriggerFlag=expandTriggerFlag;view.expandCollapseNode(setting,node,expandFlag,animateFlag,callback);},isSelectedNode:function(setting,node){if(!node){return false;}
var list=data.getRoot(setting).curSelectedList,i;for(i=list.length-1;i>=0;i--){if(node===list[i]){return true;}}
return false;},makeDOMNodeIcon:function(html,setting,node){var nameStr=data.nodeName(setting,node),name=setting.view.nameIsHTML?nameStr:nameStr.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');html.push("<span id='",node.tId,consts.id.ICON,"' title='' treeNode",consts.id.ICON," class='",view.makeNodeIcoClass(setting,node),"' style='",view.makeNodeIcoStyle(setting,node),"'></span><span id='",node.tId,consts.id.SPAN,"' class='",consts.className.NAME,"'>",name,"</span>");},makeDOMNodeLine:function(html,setting,node){html.push("<span id='",node.tId,consts.id.SWITCH,"' title='' class='",view.makeNodeLineClass(setting,node),"' treeNode",consts.id.SWITCH,"></span>");},makeDOMNodeMainAfter:function(html,setting,node){html.push("</li>");},makeDOMNodeMainBefore:function(html,setting,node){html.push("<li id='",node.tId,"' class='",consts.className.LEVEL,node.level,"' tabindex='0' hidefocus='true' treenode>");},makeDOMNodeNameAfter:function(html,setting,node){html.push("</a>");},makeDOMNodeNameBefore:function(html,setting,node){var title=data.nodeTitle(setting,node),url=view.makeNodeUrl(setting,node),fontcss=view.makeNodeFontCss(setting,node),fontStyle=[];for(var f in fontcss){fontStyle.push(f,":",fontcss[f],";");}
html.push("<a id='",node.tId,consts.id.A,"' class='",consts.className.LEVEL,node.level,"' treeNode",consts.id.A," onclick=\"",(node.click||''),"\" ",((url!=null&&url.length>0)?"href='"+url+"'":"")," target='",view.makeNodeTarget(node),"' style='",fontStyle.join(''),"'");if(tools.apply(setting.view.showTitle,[setting.treeId,node],setting.view.showTitle)&&title){html.push("title='",title.replace(/'/g,"&#39;").replace(/</g,'&lt;').replace(/>/g,'&gt;'),"'");}
html.push(">");},makeNodeFontCss:function(setting,node){var fontCss=tools.apply(setting.view.fontCss,[setting.treeId,node],setting.view.fontCss);return(fontCss&&((typeof fontCss)!="function"))?fontCss:{};},makeNodeIcoClass:function(setting,node){var icoCss=["ico"];if(!node.isAjaxing){var isParent=data.nodeIsParent(setting,node);icoCss[0]=(node.iconSkin?node.iconSkin+"_":"")+icoCss[0];if(isParent){icoCss.push(node.open?consts.folder.OPEN:consts.folder.CLOSE);}else{icoCss.push(consts.folder.DOCU);}}
return consts.className.BUTTON+" "+icoCss.join('_');},makeNodeIcoStyle:function(setting,node){var icoStyle=[];if(!node.isAjaxing){var isParent=data.nodeIsParent(setting,node);var icon=(isParent&&node.iconOpen&&node.iconClose)?(node.open?node.iconOpen:node.iconClose):node[setting.data.key.icon];if(icon)icoStyle.push("background:url(",icon,") 0 0 no-repeat;");if(setting.view.showIcon==false||!tools.apply(setting.view.showIcon,[setting.treeId,node],true)){icoStyle.push("width:0px;height:0px;");}}
return icoStyle.join('');},makeNodeLineClass:function(setting,node){var lineClass=[];if(setting.view.showLine){if(node.level==0&&node.isFirstNode&&node.isLastNode){lineClass.push(consts.line.ROOT);}else if(node.level==0&&node.isFirstNode){lineClass.push(consts.line.ROOTS);}else if(node.isLastNode){lineClass.push(consts.line.BOTTOM);}else{lineClass.push(consts.line.CENTER);}}else{lineClass.push(consts.line.NOLINE);}
if(data.nodeIsParent(setting,node)){lineClass.push(node.open?consts.folder.OPEN:consts.folder.CLOSE);}else{lineClass.push(consts.folder.DOCU);}
return view.makeNodeLineClassEx(node)+lineClass.join('_');},makeNodeLineClassEx:function(node){return consts.className.BUTTON+" "+consts.className.LEVEL+node.level+" "+consts.className.SWITCH+" ";},makeNodeTarget:function(node){return(node.target||"_blank");},makeNodeUrl:function(setting,node){var urlKey=setting.data.key.url;return node[urlKey]?node[urlKey]:null;},makeUlHtml:function(setting,node,html,content){html.push("<ul id='",node.tId,consts.id.UL,"' class='",consts.className.LEVEL,node.level," ",view.makeUlLineClass(setting,node),"' style='display:",(node.open?"block":"none"),"'>");html.push(content);html.push("</ul>");},makeUlLineClass:function(setting,node){return((setting.view.showLine&&!node.isLastNode)?consts.line.LINE:"");},removeChildNodes:function(setting,node){if(!node)return;var nodes=data.nodeChildren(setting,node);if(!nodes)return;for(var i=0,l=nodes.length;i<l;i++){data.removeNodeCache(setting,nodes[i]);}
data.removeSelectedNode(setting);delete node[setting.data.key.children];if(!setting.data.keep.parent){data.nodeIsParent(setting,node,false);node.open=false;var tmp_switchObj=$$(node,consts.id.SWITCH,setting),tmp_icoObj=$$(node,consts.id.ICON,setting);view.replaceSwitchClass(node,tmp_switchObj,consts.folder.DOCU);view.replaceIcoClass(node,tmp_icoObj,consts.folder.DOCU);$$(node,consts.id.UL,setting).remove();}else{$$(node,consts.id.UL,setting).empty();}},scrollIntoView:function(setting,dom){if(!dom){return;}
if(typeof Element==='undefined'){var contRect=setting.treeObj.get(0).getBoundingClientRect(),findMeRect=dom.getBoundingClientRect();if(findMeRect.top<contRect.top||findMeRect.bottom>contRect.bottom||findMeRect.right>contRect.right||findMeRect.left<contRect.left){dom.scrollIntoView();}
return;}
if(!Element.prototype.scrollIntoViewIfNeeded){Element.prototype.scrollIntoViewIfNeeded=function(centerIfNeeded){function withinBounds(value,min,max,extent){if(false===centerIfNeeded||max<=value+extent&&value<=min+extent){return Math.min(max,Math.max(min,value));}else{return(min+max)/2;}}
function makeArea(left,top,width,height){return{"left":left,"top":top,"width":width,"height":height,"right":left+width,"bottom":top+height,"translate":function(x,y){return makeArea(x+left,y+top,width,height);},"relativeFromTo":function(lhs,rhs){var newLeft=left,newTop=top;lhs=lhs.offsetParent;rhs=rhs.offsetParent;if(lhs===rhs){return area;}
for(;lhs;lhs=lhs.offsetParent){newLeft+=lhs.offsetLeft+lhs.clientLeft;newTop+=lhs.offsetTop+lhs.clientTop;}
for(;rhs;rhs=rhs.offsetParent){newLeft-=rhs.offsetLeft+rhs.clientLeft;newTop-=rhs.offsetTop+rhs.clientTop;}
return makeArea(newLeft,newTop,width,height);}};}
var parent,elem=this,area=makeArea(this.offsetLeft,this.offsetTop,this.offsetWidth,this.offsetHeight);while(tools.isElement(parent=elem.parentNode)){var clientLeft=parent.offsetLeft+parent.clientLeft;var clientTop=parent.offsetTop+parent.clientTop;area=area.relativeFromTo(elem,parent).translate(-clientLeft,-clientTop);parent.scrollLeft=withinBounds(parent.scrollLeft,area.right-parent.clientWidth,area.left,parent.clientWidth);parent.scrollTop=withinBounds(parent.scrollTop,area.bottom-parent.clientHeight,area.top,parent.clientHeight);area=area.translate(clientLeft-parent.scrollLeft,clientTop-parent.scrollTop);elem=parent;}};}
dom.scrollIntoViewIfNeeded();},setFirstNode:function(setting,parentNode){var children=data.nodeChildren(setting,parentNode);if(children.length>0){children[0].isFirstNode=true;}},setLastNode:function(setting,parentNode){var children=data.nodeChildren(setting,parentNode);if(children.length>0){children[children.length-1].isLastNode=true;}},removeNode:function(setting,node){var root=data.getRoot(setting),parentNode=(node.parentTId)?node.getParentNode():root;node.isFirstNode=false;node.isLastNode=false;node.getPreNode=function(){return null;};node.getNextNode=function(){return null;};if(!data.getNodeCache(setting,node.tId)){return;}
$$(node,setting).remove();data.removeNodeCache(setting,node);data.removeSelectedNode(setting,node);var children=data.nodeChildren(setting,parentNode);for(var i=0,l=children.length;i<l;i++){if(children[i].tId==node.tId){children.splice(i,1);break;}}
view.setFirstNode(setting,parentNode);view.setLastNode(setting,parentNode);var tmp_ulObj,tmp_switchObj,tmp_icoObj,childLength=children.length;if(!setting.data.keep.parent&&childLength==0){data.nodeIsParent(setting,parentNode,false);parentNode.open=false;delete parentNode[setting.data.key.children];tmp_ulObj=$$(parentNode,consts.id.UL,setting);tmp_switchObj=$$(parentNode,consts.id.SWITCH,setting);tmp_icoObj=$$(parentNode,consts.id.ICON,setting);view.replaceSwitchClass(parentNode,tmp_switchObj,consts.folder.DOCU);view.replaceIcoClass(parentNode,tmp_icoObj,consts.folder.DOCU);tmp_ulObj.css("display","none");}else if(setting.view.showLine&&childLength>0){var newLast=children[childLength-1];tmp_ulObj=$$(newLast,consts.id.UL,setting);tmp_switchObj=$$(newLast,consts.id.SWITCH,setting);tmp_icoObj=$$(newLast,consts.id.ICON,setting);if(parentNode==root){if(children.length==1){view.replaceSwitchClass(newLast,tmp_switchObj,consts.line.ROOT);}else{var tmp_first_switchObj=$$(children[0],consts.id.SWITCH,setting);view.replaceSwitchClass(children[0],tmp_first_switchObj,consts.line.ROOTS);view.replaceSwitchClass(newLast,tmp_switchObj,consts.line.BOTTOM);}}else{view.replaceSwitchClass(newLast,tmp_switchObj,consts.line.BOTTOM);}
tmp_ulObj.removeClass(consts.line.LINE);}},replaceIcoClass:function(node,obj,newName){if(!obj||node.isAjaxing)return;var tmpName=obj.attr("class");if(tmpName==undefined)return;var tmpList=tmpName.split("_");switch(newName){case consts.folder.OPEN:case consts.folder.CLOSE:case consts.folder.DOCU:tmpList[tmpList.length-1]=newName;break;}
obj.attr("class",tmpList.join("_"));},replaceSwitchClass:function(node,obj,newName){if(!obj)return;var tmpName=obj.attr("class");if(tmpName==undefined)return;var tmpList=tmpName.split("_");switch(newName){case consts.line.ROOT:case consts.line.ROOTS:case consts.line.CENTER:case consts.line.BOTTOM:case consts.line.NOLINE:tmpList[0]=view.makeNodeLineClassEx(node)+newName;break;case consts.folder.OPEN:case consts.folder.CLOSE:case consts.folder.DOCU:tmpList[1]=newName;break;}
obj.attr("class",tmpList.join("_"));if(newName!==consts.folder.DOCU){obj.removeAttr("disabled");}else{obj.attr("disabled","disabled");}},selectNode:function(setting,node,addFlag){if(!addFlag){view.cancelPreSelectedNode(setting,null,node);}
$$(node,consts.id.A,setting).addClass(consts.node.CURSELECTED);data.addSelectedNode(setting,node);setting.treeObj.trigger(consts.event.SELECTED,[setting.treeId,node]);},setNodeFontCss:function(setting,treeNode){var aObj=$$(treeNode,consts.id.A,setting),fontCss=view.makeNodeFontCss(setting,treeNode);if(fontCss){aObj.css(fontCss);}},setNodeLineIcos:function(setting,node){if(!node)return;var switchObj=$$(node,consts.id.SWITCH,setting),ulObj=$$(node,consts.id.UL,setting),icoObj=$$(node,consts.id.ICON,setting),ulLine=view.makeUlLineClass(setting,node);if(ulLine.length==0){ulObj.removeClass(consts.line.LINE);}else{ulObj.addClass(ulLine);}
switchObj.attr("class",view.makeNodeLineClass(setting,node));if(data.nodeIsParent(setting,node)){switchObj.removeAttr("disabled");}else{switchObj.attr("disabled","disabled");}
icoObj.removeAttr("style");icoObj.attr("style",view.makeNodeIcoStyle(setting,node));icoObj.attr("class",view.makeNodeIcoClass(setting,node));},setNodeName:function(setting,node){var title=data.nodeTitle(setting,node),nObj=$$(node,consts.id.SPAN,setting);nObj.empty();if(setting.view.nameIsHTML){nObj.html(data.nodeName(setting,node));}else{nObj.text(data.nodeName(setting,node));}
if(tools.apply(setting.view.showTitle,[setting.treeId,node],setting.view.showTitle)){var aObj=$$(node,consts.id.A,setting);aObj.attr("title",!title?"":title);}},setNodeTarget:function(setting,node){var aObj=$$(node,consts.id.A,setting);aObj.attr("target",view.makeNodeTarget(node));},setNodeUrl:function(setting,node){var aObj=$$(node,consts.id.A,setting),url=view.makeNodeUrl(setting,node);if(url==null||url.length==0){aObj.removeAttr("href");}else{aObj.attr("href",url);}},switchNode:function(setting,node){if(node.open||!tools.canAsync(setting,node)){view.expandCollapseNode(setting,node,!node.open);}else if(setting.async.enable){if(!view.asyncNode(setting,node)){view.expandCollapseNode(setting,node,!node.open);return;}}else if(node){view.expandCollapseNode(setting,node,!node.open);}}};$.fn.zTree={consts:_consts,_z:{tools:tools,view:view,event:event,data:data},getZTreeObj:function(treeId){var o=data.getZTreeTools(treeId);return o?o:null;},destroy:function(treeId){if(!!treeId&&treeId.length>0){view.destroy(data.getSetting(treeId));}else{for(var s in settings){view.destroy(settings[s]);}}},init:function(obj,zSetting,zNodes){var setting=tools.clone(_setting);$.extend(true,setting,zSetting);setting.treeId=obj.attr("id");setting.treeObj=obj;setting.treeObj.empty();settings[setting.treeId]=setting;if(typeof document.body.style.maxHeight==="undefined"){setting.view.expandSpeed="";}
data.initRoot(setting);var root=data.getRoot(setting);zNodes=zNodes?tools.clone(tools.isArray(zNodes)?zNodes:[zNodes]):[];if(setting.data.simpleData.enable){data.nodeChildren(setting,root,data.transformTozTreeFormat(setting,zNodes));}else{data.nodeChildren(setting,root,zNodes);}
data.initCache(setting);event.unbindTree(setting);event.bindTree(setting);event.unbindEvent(setting);event.bindEvent(setting);var zTreeTools={setting:setting,addNodes:function(parentNode,index,newNodes,isSilent){if(!parentNode)parentNode=null;var isParent=data.nodeIsParent(setting,parentNode);if(parentNode&&!isParent&&setting.data.keep.leaf)return null;var i=parseInt(index,10);if(isNaN(i)){isSilent=!!newNodes;newNodes=index;index=-1;}else{index=i;}
if(!newNodes)return null;var xNewNodes=tools.clone(tools.isArray(newNodes)?newNodes:[newNodes]);function addCallback(){view.addNodes(setting,parentNode,index,xNewNodes,(isSilent==true));}
if(tools.canAsync(setting,parentNode)){view.asyncNode(setting,parentNode,isSilent,addCallback);}else{addCallback();}
return xNewNodes;},cancelSelectedNode:function(node){view.cancelPreSelectedNode(setting,node);},destroy:function(){view.destroy(setting);},expandAll:function(expandFlag){expandFlag=!!expandFlag;view.expandCollapseSonNode(setting,null,expandFlag,true);return expandFlag;},expandNode:function(node,expandFlag,sonSign,focus,callbackFlag){if(!node||!data.nodeIsParent(setting,node))return null;if(expandFlag!==true&&expandFlag!==false){expandFlag=!node.open;}
callbackFlag=!!callbackFlag;if(callbackFlag&&expandFlag&&(tools.apply(setting.callback.beforeExpand,[setting.treeId,node],true)==false)){return null;}else if(callbackFlag&&!expandFlag&&(tools.apply(setting.callback.beforeCollapse,[setting.treeId,node],true)==false)){return null;}
if(expandFlag&&node.parentTId){view.expandCollapseParentNode(setting,node.getParentNode(),expandFlag,false);}
if(expandFlag===node.open&&!sonSign){return null;}
data.getRoot(setting).expandTriggerFlag=callbackFlag;if(!tools.canAsync(setting,node)&&sonSign){view.expandCollapseSonNode(setting,node,expandFlag,true,showNodeFocus);}else{node.open=!expandFlag;view.switchNode(this.setting,node);showNodeFocus();}
return expandFlag;function showNodeFocus(){var a=$$(node,setting).get(0);if(a&&focus!==false){view.scrollIntoView(setting,a);}}},getNodes:function(){return data.getNodes(setting);},getNodeByParam:function(key,value,parentNode){if(!key)return null;return data.getNodeByParam(setting,parentNode?data.nodeChildren(setting,parentNode):data.getNodes(setting),key,value);},getNodeByTId:function(tId){return data.getNodeCache(setting,tId);},getNodesByParam:function(key,value,parentNode){if(!key)return null;return data.getNodesByParam(setting,parentNode?data.nodeChildren(setting,parentNode):data.getNodes(setting),key,value);},getNodesByParamFuzzy:function(key,value,parentNode){if(!key)return null;return data.getNodesByParamFuzzy(setting,parentNode?data.nodeChildren(setting,parentNode):data.getNodes(setting),key,value);},getNodesByFilter:function(filter,isSingle,parentNode,invokeParam){isSingle=!!isSingle;if(!filter||(typeof filter!="function"))return(isSingle?null:[]);return data.getNodesByFilter(setting,parentNode?data.nodeChildren(setting,parentNode):data.getNodes(setting),filter,isSingle,invokeParam);},getNodeIndex:function(node){if(!node)return null;var parentNode=(node.parentTId)?node.getParentNode():data.getRoot(setting);var children=data.nodeChildren(setting,parentNode);for(var i=0,l=children.length;i<l;i++){if(children[i]==node)return i;}
return-1;},getSelectedNodes:function(){var r=[],list=data.getRoot(setting).curSelectedList;for(var i=0,l=list.length;i<l;i++){r.push(list[i]);}
return r;},isSelectedNode:function(node){return data.isSelectedNode(setting,node);},reAsyncChildNodesPromise:function(parentNode,reloadType,isSilent){var promise=new Promise(function(resolve,reject){try{zTreeTools.reAsyncChildNodes(parentNode,reloadType,isSilent,function(){resolve(parentNode);});}catch(e){reject(e);}});return promise;},reAsyncChildNodes:function(parentNode,reloadType,isSilent,callback){if(!this.setting.async.enable)return;var isRoot=!parentNode;if(isRoot){parentNode=data.getRoot(setting);}
if(reloadType=="refresh"){var children=data.nodeChildren(setting,parentNode);for(var i=0,l=children?children.length:0;i<l;i++){data.removeNodeCache(setting,children[i]);}
data.removeSelectedNode(setting);data.nodeChildren(setting,parentNode,[]);if(isRoot){this.setting.treeObj.empty();}else{var ulObj=$$(parentNode,consts.id.UL,setting);ulObj.empty();}}
view.asyncNode(this.setting,isRoot?null:parentNode,!!isSilent,callback);},refresh:function(){this.setting.treeObj.empty();var root=data.getRoot(setting),nodes=data.nodeChildren(setting,root);data.initRoot(setting);data.nodeChildren(setting,root,nodes);data.initCache(setting);view.createNodes(setting,0,data.nodeChildren(setting,root),null,-1);},removeChildNodes:function(node){if(!node)return null;var nodes=data.nodeChildren(setting,node);view.removeChildNodes(setting,node);return nodes?nodes:null;},removeNode:function(node,callbackFlag){if(!node)return;callbackFlag=!!callbackFlag;if(callbackFlag&&tools.apply(setting.callback.beforeRemove,[setting.treeId,node],true)==false)return;view.removeNode(setting,node);if(callbackFlag){this.setting.treeObj.trigger(consts.event.REMOVE,[setting.treeId,node]);}},selectNode:function(node,addFlag,isSilent){if(!node)return;if(tools.uCanDo(setting)){addFlag=setting.view.selectedMulti&&addFlag;if(node.parentTId){view.expandCollapseParentNode(setting,node.getParentNode(),true,false,showNodeFocus);}else if(!isSilent){try{$$(node,setting).focus().blur();}catch(e){}}
view.selectNode(setting,node,addFlag);}
function showNodeFocus(){if(isSilent){return;}
var a=$$(node,setting).get(0);view.scrollIntoView(setting,a);}},transformTozTreeNodes:function(simpleNodes){return data.transformTozTreeFormat(setting,simpleNodes);},transformToArray:function(nodes){return data.transformToArrayFormat(setting,nodes);},updateNode:function(node,checkTypeFlag){if(!node)return;var nObj=$$(node,setting);if(nObj.get(0)&&tools.uCanDo(setting)){view.setNodeName(setting,node);view.setNodeTarget(setting,node);view.setNodeUrl(setting,node);view.setNodeLineIcos(setting,node);view.setNodeFontCss(setting,node);}}};root.treeTools=zTreeTools;data.setZTreeTools(setting,zTreeTools);var children=data.nodeChildren(setting,root);if(children&&children.length>0){view.createNodes(setting,0,children,null,-1);}else if(setting.async.enable&&setting.async.url&&setting.async.url!==''){view.asyncNode(setting);}
return zTreeTools;}};var zt=$.fn.zTree,$$=tools.$,consts=zt.consts;})(jQuery);;

/* /app_web_widget_ztree/static/src/js/widget_ztree.js defined in bundle 'web.assets_backend' */
odoo.define('app_web_widget_ztree.zTree',function(require){"use strict";var core=require('web.core');var Widget=require('web.Widget');var rpc=require('web.rpc');var session=require('web.session');var _t=core._t;var fieldRegistry=require('web.field_registry');var AbstractField=require('web.AbstractField');var relational_fields=require('web.relational_fields');var FieldMany2One=relational_fields.FieldMany2One;var ztree_Max=1000;var zTree=Widget.extend({className:'ztree',template:'App.zTree',init:function(setting,data){this._super.apply(this,arguments);this.setting={view:{selectedMulti:true,fontCss:function getFont(treeId,node){return node.font?node.font:{};},nameIsHTML:true,showIcon:false,txtSelectedEnable:true,},data:{key:{title:"title"},simpleData:{enable:true,}}};if(setting)
$.extend(this.setting,setting);if(data.zNodes&&data.zNodes.length)
this.zNodes=data.zNodes;this.ztree_field=data.ztree_field;this.ztree_model=data.ztree_model;this.ztree_parent_key=data.ztree_parent_key;this.ztree_root_id=data.ztree_root_id;this.ztree_domain=data.ztree_domain;this.ztree_context=data.ztree_context?data.ztree_context:session.user_context;this.order=data.order;this.ztree_selected_id=Number(data.ztree_selected_id);this.ztree_selected_vals=[];this.ztree_with_sub_node=data.ztree_with_sub_node;this.ztree_index=data.ztree_index;this.ztree_add_show_all=data.ztree_add_show_all;this.ztree_expend_level=data.ztree_expend_level?data.ztree_expend_level:2;this.ztree_name_field=data.ztree_name_field;this.limit=data.limit>0?data.limit:ztree_Max;this.ztree_id='ztree-'+this.guid();this.ztree_type=data.ztree_type;},willStart:function(){var self=this;var def;if(!self.zNodes||self.zNodes.length<=0){def=rpc.query({model:self.ztree_model,method:'search_ztree',kwargs:{domain:self.ztree_domain,context:self.ztree_context,parent_key:self.ztree_parent_key,root_id:self.ztree_root_id,expend_level:self.ztree_expend_level,name_field:self.ztree_name_field,order:self.order,limit:parseInt(self.limit?self.limit:ztree_Max),type:self.ztree_type,selected_id:self.ztree_selected_id,},}).then(function(result){var showall=[];if(result.length>0){self.zNodes=showall.concat(result);}});}
return $.when(this._super.apply(this,arguments),def);},start:function(){var self=this;this._super.apply(this,arguments);if(!self.$zTree){self.$zTree=$.fn.zTree.init(self.$el,self.setting,self.zNodes);if(self.ztree_selected_id!=null&&self.ztree_selected_id>0){var node=self.$zTree.getNodeByParam('id',self.ztree_selected_id,null);self.$zTree.selectNode(node);}}},destroy:function(){if(this.$zTree){this.$el.remove();this.$zTree=undefined;}
this._super();},guid:function(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=='x'?r:(r&0x3|0x8);return v.toString(16);});},getChildNodes:function getChildNodes(treeNode){var childNodes=this.$zTree.transformToArray(treeNode);var nodes=new Array();var i;for(i=0;i<childNodes.length;i++){nodes[i]=childNodes[i].id;}
return nodes.join(",");}});var FieldZTree=FieldMany2One.extend({supportedFieldTypes:['many2one'],template:'App.FieldZtree',SEARCH_MORE_LIMIT:1000,init:function(){this._super.apply(this,arguments);this.limit=this.attrs.limit?this.attrs.limit:1000;this.nodeOptions.quick_create=false;this.nodeOptions.no_quick_create=true;this.ztree_parent_key=this.nodeOptions.ztree_parent_key;this.ztree_root_id=this.nodeOptions.ztree_root_id;this.ztree_name_field=this.nodeOptions.ztree_name_field;this.order=this.nodeOptions.order;this.ztree_expend_level=this.nodeOptions.ztree_expend_level;},start:function(){this._super.apply(this,arguments);var self=this;$(document).delegate('body','click',function(ev){var $parent=$(ev.target).parents('.o_input_dropdown')
if(!$parent.length&&self.many2one){self._close();}else if(!$parent.find('.ztree').length){self._close();}});},_bindAutoComplete:function(){var self=this;this._super.apply(this,arguments);this.$input.autocomplete({source:function(req){if(!self.many2one)
self.buildTreeView(req.term);},focus:function(event,ui){event.preventDefault();},close:function(event,ui){if(event.which===$.ui.keyCode.ESCAPE){event.stopPropagation();}
console.log('ui close');},autoFocus:true,html:true,minLength:0,delay:this.AUTOCOMPLETE_DELAY,});this.$input.autocomplete("option","position",{my:"left top",at:"left bottom"});},_selectNode:function(event,item){var self=this;self.$input.autocomplete("close");event.stopImmediatePropagation();event.preventDefault();event.stopPropagation();self.floating=false;if(item.id){self.reinitialize({id:item.id,display_name:item.name});}else if(item.action){item.action();}
self._close();return false;},_onInputClick:function(ev){this._super.apply(this,arguments);var $parent=$(ev.target).parents('.o_input_dropdown')
if($parent.find('.ztree').length&&this.many2one){this._close();}},_onInputKeyup:function(ev){this._super.apply(this,arguments);if(event.which===$.ui.keyCode.ESCAPE){event.stopPropagation();this._close();}else
this.buildTreeView(ev.target.value);},_onInputFocusout:function(){;},_close:function(){var self=this;if(self.many2one)
self.many2one.destroy();try{self.many2one.$el.remove();}catch(err){;}
self.many2one=undefined;},_search:function(search_val){var self=this;var def=new Promise(function(resolve,reject){var context=self.record.getContext(self.recordParams);var domain=self.record.getDomain(self.recordParams);_.extend(context,self.additionalContext);var blacklisted_ids=self._getSearchBlacklist();if(blacklisted_ids.length>0){domain.push(['id','not in',blacklisted_ids]);}
if(search_val&&search_val!=""){domain.push(['name','ilike',search_val]);}
var parent_key=self.ztree_parent_key;var root_id=self.ztree_root_id;var expend_level=self.ztree_expend_level;var name_field=self.ztree_name_field;self._rpc({model:self.field.relation,method:"search_ztree",kwargs:{domain:domain,context:context,parent_key:parent_key,root_id:root_id,expend_level:expend_level,name_field:name_field,limit:parseInt(self.limit+1),order:self.order,}}).then(function(result){var values=result;if(values.length>self.limit){values=self._manageSearchMore(values,search_val,domain,context);}
var create_enabled=self.can_create&&!self.nodeOptions.no_create;var raw_result=_.map(result,function(x){return x[1];});if(create_enabled&&!self.nodeOptions.no_quick_create&&search_val.length>0&&!_.contains(raw_result,search_val)){values.push({id:null,name:_.str.sprintf(_t('Create "<strong>%s</strong>"'),$('<span />').text(search_val).html()),font:{'color':'#00A09D','font-weight':'bold'},label:_.str.sprintf(_t('Create "<strong>%s</strong>"'),$('<span />').text(search_val).html()),action:self._quickCreate.bind(self,search_val),classname:'o_m2o_dropdown_option'});}
if(create_enabled&&!self.nodeOptions.no_create_edit){var createAndEditAction=function(){self.$('input').val('');return self._searchCreatePopup("form",false,self._createContext(search_val));};values.push({id:null,name:_t("Create and Edit..."),font:{'color':'#00A09D','font-weight':'bold'},label:_t("Create and Edit..."),action:createAndEditAction,classname:'o_m2o_dropdown_option',});}else if(values.length===0){values.push({id:null,name:_t("No results to show..."),font:{'color':'#00A09D','font-weight':'bold'},label:_t("No results to show..."),});}
resolve(values);});});this.orderer.add(def);return def;},buildTreeView:function(search_val){var self=this;var domain=self.record.getDomain(self.recordParams);var blacklisted_ids=self._getSearchBlacklist();if(blacklisted_ids.length>0){domain.push(['id','not in',blacklisted_ids]);}
if(self.many2one){self.many2one.destroy();self.many2one=undefined;}
var setting={callback:{onClick:function(event,treeId,treeNode,clickFlag){self._selectNode(event,treeNode);}}};self._search(search_val).then(function(result){if(self.value&&self.value.data.id&&self.value.data.id>0)
var ztree_selected_id=self.value.data.id;self.many2one=new zTree(setting,{zNodes:result,ztree_domain:domain,ztree_field:self.field.name,ztree_model:self.field.relation,ztree_parent_key:self.ztree_parent_key,ztree_root_id:self.ztree_root_id,ztree_expend_level:self.ztree_expend_level,ztree_name_field:self.ztree_name_field,ztree_selected_id:ztree_selected_id,});self.many2one.appendTo(self.$input.parent());self.$input.css('height','auto');});},});var FieldZTreeChart=AbstractField.extend({noLabel:true,supportedFieldTypes:['one2many'],template:'App.FieldZtreeChart',SEARCH_MORE_LIMIT:1000,init:function(parent,name,record,options){this._super.apply(this,arguments);this.no_title=false;this.limit=this.attrs.limit?this.attrs.limit:1000;this.ztree_parent_key=this.nodeOptions.ztree_parent_key;this.ztree_root_id=this.nodeOptions.ztree_root_id;this.ztree_name_field=this.nodeOptions.ztree_name_field;this.order=this.nodeOptions.order;this.ztree_expend_level=this.nodeOptions.ztree_expend_level||5;},_selectNode:function(event,item){var self=this;var action={};event.stopImmediatePropagation();event.preventDefault();event.stopPropagation();var context=_.extend({},self.context);var clear=parseInt(item.pId)>0?false:true;if(item.id&&item.id!=self.res_id){action={type:'ir.actions.act_window',view_mode:'form',views:[[false,'form']],target:'current',res_model:this.model,res_id:item.id,context:context,};return this.do_action(action,{clear_breadcrumbs:clear,});}},_renderEdit:function(){var self=this;var domain=[];var setting={callback:{onClick:function(event,treeId,treeNode){self._selectNode(event,treeNode);}}};var $ztree=new zTree(setting,{ztree_field:self.field.name,ztree_model:self.field.relation,ztree_domain:domain,ztree_parent_key:self.ztree_parent_key,ztree_root_id:self.ztree_root_id,ztree_expend_level:self.ztree_expend_level,ztree_name_field:self.ztree_name_field,ztree_selected_id:self.record.res_id,ztree_type:'chart',});$ztree.appendTo(this.$el.find('.ztree_chart'));},_renderReadonly:function(){this._renderEdit();},});fieldRegistry.add('ztree_select',FieldZTree);fieldRegistry.add('ztree_chart',FieldZTreeChart);return{zTree:zTree,FieldZTree:FieldZTree,FieldZTreeChart:FieldZTreeChart,};});;

/* /stock_barcode/static/src/js/stock_barcode.js defined in bundle 'web.assets_backend' */
odoo.define('stock_barcode.MainMenu',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var core=require('web.core');var Dialog=require('web.Dialog');var Session=require('web.session');var _t=core._t;var MainMenu=AbstractAction.extend({contentTemplate:'main_menu',events:{"click .button_operations":function(){this.do_action('stock_barcode.stock_picking_type_action_kanban');},"click .button_inventory":function(){this.open_inventory();},"click .o_stock_barcode_menu":function(){this.trigger_up('toggle_fullscreen');this.trigger_up('show_home_menu');},},init:function(parent,action){this._super.apply(this,arguments);this.message_demo_barcodes=action.params.message_demo_barcodes;},willStart:function(){var self=this;return this._super.apply(this,arguments).then(function(){return Session.user_has_group('stock.group_stock_multi_locations').then(function(has_group){self.group_stock_multi_location=has_group;});});},start:function(){var self=this;core.bus.on('barcode_scanned',this,this._onBarcodeScanned);return this._super().then(function(){if(self.message_demo_barcodes){self.setup_message_demo_barcodes();}});},destroy:function(){core.bus.off('barcode_scanned',this,this._onBarcodeScanned);this._super();},setup_message_demo_barcodes:function(){var self=this;self.$(".message_demo_barcodes").on('close.bs.alert',function(){var message=_t("Do you want to permanently remove this message ?\
                It won't appear anymore, so make sure you don't need the barcodes sheet or you have a copy.");var options={title:_t("Don't show this message again"),size:'medium',buttons:[{text:_t("Remove it"),close:true,classes:'btn-primary',click:function(){Session.rpc('/stock_barcode/rid_of_message_demo_barcodes');}},{text:_t("Leave it"),close:true}],};Dialog.confirm(self,message,options);});},_onBarcodeScanned:function(barcode){var self=this;if(!$.contains(document,this.el)){return;}
Session.rpc('/stock_barcode/scan_from_main_menu',{barcode:barcode,}).then(function(result){if(result.action){self.do_action(result.action);}else if(result.warning){self.do_warn(result.warning);}});},open_inventory:function(){var self=this;return this._rpc({model:'stock.inventory',method:'open_new_inventory',}).then(function(result){self.do_action(result);});},});core.action_registry.add('stock_barcode_main_menu',MainMenu);return{MainMenu:MainMenu,};});;

/* /stock_barcode/static/src/js/forms/picking_barcode_handler.js defined in bundle 'web.assets_backend' */
odoo.define('stock_barcode.PickingBarcodeHandler',function(require){"use strict";var core=require('web.core');var AbstractField=require('web.AbstractField');var field_registry=require('web.field_registry');var FormController=require('web.FormController');var _t=core._t;FormController.include({_barcodeRecordFilter:function(record,barcode,activeBarcode){var matching=this._super.apply(this,arguments);if(activeBarcode.widget==='picking_barcode_handler'){var data=record.data;matching=matching&&!data.location_processed&&!data.result_package_id;}
return matching;},_barcodeSelectedCandidate:function(candidate,record,barcode,activeBarcode){if(activeBarcode.widget==='picking_barcode_handler'&&candidate.data.lots_visible){var self=this;return this.saveRecord(this.handle,{stayInEdit:true,reload:false}).then(function(){var rpcProm=self._rpc({model:'stock.picking',method:'get_po_to_split_from_barcode',args:[[record.data.id],barcode],});rpcProm.then(function(action){self._barcodeStopListening();self.do_action(action,{on_close:function(){self._barcodeStartListening();self.update({},{reload:true});}});});return rpcProm;});}
return this._super.apply(this,arguments);},_barcodePickingAddRecordId:function(barcode,activeBarcode){if(!activeBarcode.handle){return Promise.reject();}
var record=this.model.get(activeBarcode.handle);if(record.data.state==='cancel'||record.data.state==='done'){this.do_warn(_.str.sprintf(_t("Picking %s"),record.data.state),_.str.sprintf(_t("The picking is %s and cannot be edited."),record.data.state));return Promise.reject();}
return this._barcodeAddX2MQuantity(barcode,activeBarcode);}});var PickingBarcodeHandler=AbstractField.extend({init:function(){this._super.apply(this,arguments);this.data=this.record.data
var fieldName='move_line_ids_without_package';if(this.data.show_reserved==false||this.data.show_operations==false)
fieldName='move_line_nosuggest_ids';this.trigger_up('activeBarcode',{name:this.name,notifyChange:false,fieldName:fieldName,quantity:'qty_done',setQuantityWithKeypress:true,commands:{'barcode':'_barcodePickingAddRecordId','O-CMD.MAIN-MENU':_.bind(this.do_action,this,'stock_barcode.stock_barcode_action_main_menu',{clear_breadcrumbs:true}),}});},});field_registry.add('picking_barcode_handler',PickingBarcodeHandler);return PickingBarcodeHandler;});;

/* /stock_barcode/static/src/js/forms/lot_barcode_handler.js defined in bundle 'web.assets_backend' */
odoo.define('stock_barcode.LotBarcodeHandler',function(require){"use strict";var field_registry=require('web.field_registry');var AbstractField=require('web.AbstractField');var LotBarcodeHandler=AbstractField.extend({init:function(){this._super.apply(this,arguments);this.trigger_up('activeBarcode',{name:this.name,fieldName:'stock_barcode_lot_line_ids',quantity:'qty_done',setQuantityWithKeypress:true,commands:{'O-CMD.MAIN-MENU':_.bind(this.do_action,this,'stock_barcode.stock_barcode_action_main_menu',{clear_breadcrumbs:true}),barcode:'_barcodeAddX2MQuantity',}});},});field_registry.add('lot_barcode_handler',LotBarcodeHandler);});;

/* /stock_barcode/static/src/js/stock_picking_type.js defined in bundle 'web.assets_backend' */
odoo.define('stock_barcode.picking_type_kanban',function(require){'use strict';var KanbanRecord=require('web.KanbanRecord');KanbanRecord.include({_openRecord:function(){if(this.modelName==='stock.picking.type'&&this.$('button').length){this.$('button').first().click();}else{this._super.apply(this,arguments);}}});});;

/* /stock_barcode/static/src/js/stock_picking.js defined in bundle 'web.assets_backend' */
odoo.define('stock_barcode.picking_kanban',function(require){'use strict';var KanbanRecord=require('web.KanbanRecord');KanbanRecord.include({_openRecord:function(){if(this.modelName==='stock.picking'){this.$('button').first().click();}else{this._super.apply(this,arguments);}}});});;

/* /stock_barcode/static/src/js/tours/running_tour_action_helper.js defined in bundle 'web.assets_backend' */
odoo.define('stock_barcode.RunningTourActionHelper',function(require){"use strict";var RunningTourActionHelper=require('web_tour.RunningTourActionHelper');RunningTourActionHelper.include({_scan:function(element,barcode){odoo.__DEBUG__.services['web.core'].bus.trigger('barcode_scanned',barcode,element);},scan:function(barcode,element){this._scan(this._get_action_values(element),barcode);},});});;

/* /stock_barcode/static/src/js/tours/tour_test_barcode_flows.js defined in bundle 'web.assets_backend' */
odoo.define('test_barcode_flows.tour',function(require){'use strict';var tour=require('web_tour.tour');function fail(errorMessage){tour._consume_tour(tour.running_tour,errorMessage);}
function getLine(description){var $res;$('.o_barcode_line').each(function(){var $line=$(this);var barcode=$line.data('barcode').trim();if(description.barcode===barcode){if($res){$res.add($line);}else{$res=$line;}}});if(!$res){fail('cannot get the line with the barcode '+description.barcode);}
return $res;}
function assert(current,expected,info){if(current!==expected){fail(info+': "'+current+'" instead of "'+expected+'".');}}
function assertPageSummary(expected){var res='';var $src=$('.o_barcode_summary_location_src');if($src.length){res="From "+$src.text()+" ";}
var $dest=$('.o_barcode_summary_location_dest');if($dest.length){res+="To "+$dest.text();}
assert(res.trim(),expected.trim(),'Page summary');}
function assertPreviousVisible(expected){var $previousButton=$('.o_previous_page');var current=(!$previousButton.length&&!expected)||$previousButton.hasClass('o_hidden');assert(!current,expected,'Previous visible');}
function assertPreviousEnabled(expected){var $previousButton=$('.o_previous_page');var current=(!$previousButton.length&&!expected)||$previousButton.prop('disabled');assert(!current,expected,'Previous button enabled');}
function assertNextVisible(expected){var $nextButton=$('.o_next_page');var current=(!$nextButton.length&&!expected)||$nextButton.hasClass('o_hidden');assert(!current,expected,'Next visible');}
function assertNextEnabled(expected){var $nextButton=$('.o_next_page');var current=(!$nextButton.length&&!expected)||$nextButton.prop('disabled');assert(!current,expected,'Next button enabled');}
function assertNextIsHighlighted(expected){var $nextButton=$('.o_next_page');var current=$nextButton.hasClass('btn-primary');assert(current,expected,'Next button is highlighted');}
function assertValidateVisible(expected){var $validate=$('.o_validate_page');var current=(!$validate.length&&!expected)||$validate.hasClass('o_hidden');assert(!current,expected,'Validate visible');}
function assertValidateEnabled(expected){var $validate=$('.o_validate_page');var current=(!$validate.length&&!expected)||$validate.prop('disabled');assert(!current,expected,'Validate enabled');}
function assertValidateIsHighlighted(expected){var $validate=$('.o_validate_page');var current=$validate.hasClass('btn-success');assert(current,expected,'Validte button is highlighted');}
function assertLinesCount(expected){var $lines=$('.o_barcode_line');var current=$lines.length;assert(current,expected,"Number of lines");}
function assertScanMessage(expected){var $helps=$('.o_scan_message');var $help=$helps.filter('.o_scan_message_'+expected);if(!$help.length||$help.hasClass('o_hidden')){fail('assertScanMessage: "'+expected+'" is not displayed');}}
function assertLocationHighlight(expected){var $locationElem=$('.o_barcode_summary_location_src');assert($locationElem.hasClass('o_strong'),expected,'Location source is not bold');}
function assertDestinationLocationHighlight(expected){var $locationElem=$('.o_barcode_summary_location_dest');assert($locationElem.hasClass('o_strong'),expected,'Location destination is not bold');}
function assertPager(expected){var $pager=$('.o_barcode_move_number');assert($pager.text(),expected,'Pager is wrong');}
function assertLineIsHighlighted($line,expected){assert($line.hasClass('o_highlight'),expected,'line should be highlighted');}
function assertLineQty($line,qty){assert($line.find('.qty-done').text(),qty,'line quantity is wrong');}
function assertFormLocationSrc(expected){var $location=$('.o_field_widget[name="location_id"] input')
assert($location.val(),expected,'Wrong source location')}
function assertFormLocationDest(expected){var $location=$('.o_field_widget[name="location_dest_id"] input')
assert($location.val(),expected,'Wrong destination location')}
function assertFormQuantity(expected){var $location=$('.o_field_widget[name="qty_done"]')
assert($location.val(),expected,'Wrong destination location')}
function assertInventoryFormQuantity(expected){var $location=$('.o_field_widget[name="product_qty"]')
assert($location.val(),expected,'Wrong quantity')}
function assertErrorMessage(expected){var $errorMessage=$('.o_notification_content').eq(-1);assert($errorMessage[0].innerText,expected,'wrong or absent error message');}
function assertQuantsCount(expected){var $quantity=$('.o_kanban_view .o_kanban_record:not(.o_kanban_ghost)').length;assert($quantity,expected,'Wrong number of cards');}
tour.register('test_internal_picking_from_scratch_1',{test:true},[{trigger:'.o_barcode_client_action',run:function(){assertPageSummary('From WH/Stock To WH/Stock');assertPreviousVisible(true);assertPreviousEnabled(false);assertNextVisible(false);assertNextEnabled(false);assertNextIsHighlighted(false);assertLinesCount(0);assertScanMessage('scan_src');assertLocationHighlight(false);assertDestinationLocationHighlight(false);assertPager('1/1');assertValidateVisible(true);assertValidateIsHighlighted(false);assertValidateEnabled(false);}},{trigger:'.o_show_information',},{trigger:'.o_form_label:contains("Status")',},{trigger:'.o_close',},{trigger:'.o_barcode_summary_location_dest:contains("Stock")',},{trigger:'.o_barcode_client_action',run:'scan LOC-01-01-00'},{trigger:'.o_barcode_client_action',run:function(){assertPageSummary('From WH/Stock/Shelf 1 To WH/Stock');assertPreviousVisible(true);assertPreviousEnabled(false);assertNextVisible(false);assertNextEnabled(false);assertNextIsHighlighted(false);assertLinesCount(0);assertScanMessage('scan_products');assertLocationHighlight(true);assertDestinationLocationHighlight(false);assertPager('1/1');assertValidateVisible(true);assertValidateIsHighlighted(false);assertValidateEnabled(false);}},{trigger:'.o_barcode_client_action',run:'scan product1'},{trigger:'.o_barcode_client_action',run:function(){assertPageSummary('From WH/Stock/Shelf 1 To WH/Stock');assertPreviousVisible(true);assertPreviousEnabled(false);assertNextVisible(false);assertNextEnabled(false);assertNextIsHighlighted(false);assertLinesCount(1);assertScanMessage('scan_more_dest');assertLocationHighlight(true);assertDestinationLocationHighlight(false);assertPager('1/1');assertValidateVisible(true);assertValidateIsHighlighted(true);assertValidateEnabled(true);var $line=getLine({barcode:'product1'});assertLineIsHighlighted($line,true);}},{trigger:'.o_barcode_client_action',run:'scan product1'},{trigger:'.o_barcode_client_action',run:function(){assertPageSummary('From WH/Stock/Shelf 1 To WH/Stock');assertPreviousVisible(true);assertPreviousEnabled(false);assertNextVisible(false);assertNextEnabled(false);assertNextIsHighlighted(false);assertLinesCount(1);assertScanMessage('scan_more_dest');assertLocationHighlight(true);assertDestinationLocationHighlight(false);assertPager('1/1');assertValidateVisible(true);assertValidateIsHighlighted(true);assertValidateEnabled(true);var $line=getLine({barcode:'product1'});assertLineIsHighlighted($line,true);assertLineQty($line,"2");}},{trigger:'.o_barcode_client_action',run:'scan LOC-01-02-00'},{trigger:'.o_barcode_summary_location_dest:contains("WH/Stock/Shelf 2")',run:function(){assertPageSummary('From WH/Stock/Shelf 1 To WH/Stock/Shelf 2');assertPreviousVisible(true);assertPreviousEnabled(false);assertNextVisible(false);assertNextEnabled(false);assertNextIsHighlighted(false);assertLinesCount(1);assertScanMessage('scan_src');assertLocationHighlight(true);assertDestinationLocationHighlight(true);assertPager('1/1');assertValidateVisible(true);assertValidateIsHighlighted(true);assertValidateEnabled(true);var $line=getLine({barcode:'product1'});assertLineIsHighlighted($line,false);}},{trigger:'.o_barcode_client_action',run:'scan LOC-01-01-00'},{trigger:'.o_barcode_client_action',run:function(){assertPageSummary('From WH/Stock/Shelf 1 To WH/Stock/Shelf 2');assertPreviousVisible(true);assertPreviousEnabled(false);assertNextVisible(false);assertNextEnabled(false);assertNextIsHighlighted(false);assertLinesCount(1);assertScanMessage('scan_products');assertLocationHighlight(true);assertDestinationLocationHighlight(false);assertPager('1/1');assertValidateVisible(true);assertValidateIsHighlighted(true);assertValidateEnabled(true);var $line=getLine({barcode:'product1'});assertLineIsHighlighted($line,false);}},{trigger:'.o_barcode_client_action',run:'scan product2'},{trigger:'.o_barcode_client_action',run:function(){assertPageSummary('From WH/Stock/Shelf 1 To WH/Stock/Shelf 2');assertPreviousVisible(true);assertPreviousEnabled(false);assertNextVisible(false);assertNextEnabled(false);assertNextIsHighlighted(false);assertLinesCount(2);assertScanMessage('scan_more_dest');assertLocationHighlight(true);assertDestinationLocationHighlight(false);assertPager('1/1');assertValidateVisible(true);assertValidateIsHighlighted(true);assertValidateEnabled(true);var $lineproduct1=getLine({barcode:'product1'});assertLineIsHighlighted($lineproduct1,false);var $lineproduct2=getLine({barcode:'product2'});assertLineIsHighlighted($lineproduct2,true);}},{trigger:'.o_barcode_client_action',run:'scan shelf3'},{trigger:'.o_barcode_summary_location_dest:contains("WH/Stock/Shelf 3")',run:function(){assertPageSummary('From WH/Stock/Shelf 1 To WH/Stock/Shelf 3');assertPreviousVisible(true);assertPreviousEnabled(true);assertNextVisible(false);assertNextEnabled(false);assertNextIsHighlighted(false);assertLinesCount(1);assertScanMessage('scan_src');assertLocationHighlight(true);assertDestinationLocationHighlight(true);assertPager('2/2');assertValidateVisible(true);assertValidateIsHighlighted(true);assertValidateEnabled(true);var $lineproduct2=getLine({barcode:'product2'});assertLineIsHighlighted($lineproduct2,false);}},{trigger:'.o_barcode_client_action',run:'scan LOC-01-01-00'},{trigger:'.o_barcode_client_action',run:function(){assertPageSummary('From WH/Stock/Shelf 1 To WH/Stock/Shelf 3');assertPreviousVisible(true);assertPreviousEnabled(true);assertNextVisible(false);assertNextEnabled(false);assertNextIsHighlighted(false);assertLinesCount(1);assertScanMessage('scan_products');assertLocationHighlight(true);assertDestinationLocationHighlight(false);assertPager('2/2');assertValidateVisible(true);assertValidateIsHighlighted(true);assertValidateEnabled(true);var $lineproduct2=getLine({barcode:'product2'});assertLineIsHighlighted($lineproduct2,false);}},{trigger:'.o_barcode_client_action',run:'scan product2'},{trigger:'.o_barcode_client_action',run:function(){assertPageSummary('From WH/Stock/Shelf 1 To WH/Stock/Shelf 3');assertPreviousVisible(true);assertPreviousEnabled(true);assertNextVisible(false);assertNextEnabled(false);assertNextIsHighlighted(false);assertLinesCount(2);assertScanMessage('scan_more_dest');assertLocationHighlight(true);assertDestinationLocationHighlight(false);assertPager('2/2');assertValidateVisible(true);assertValidateIsHighlighted(true);assertValidateEnabled(true);var $lines=getLine({barcode:'product2'});if($lines.filter('.o_highlight').length!==1){fail('one of the two lins of product2 should be highlighted.');}}},{trigger:'.o_barcode_client_action',run:'scan LOC-01-02-00'},{trigger:'.o_barcode_summary_location_dest:contains("WH/Stock/Shelf 2")',run:function(){assertPageSummary('From WH/Stock/Shelf 1 To WH/Stock/Shelf 2');assertPreviousVisible(true);assertPreviousEnabled(true);assertNextVisible(true);assertNextEnabled(true);assertNextIsHighlighted(true);assertLinesCount(2);assertScanMessage('scan_src');assertLocationHighlight(true);assertDestinationLocationHighlight(true);assertPager('1/2');assertValidateVisible(false);assertValidateIsHighlighted(false);assertValidateEnabled(false);var $line=getLine({barcode:'product1'});assertLineIsHighlighted($line,false);}},]);tour.register('test_internal_picking_from_scratch_2',{test:true},[{trigger:'.o_add_line',},{extra_trigger:'.o_form_label:contains("Product")',trigger:"input.o_field_widget[name=qty_done]",run:'text 2',},{trigger:".o_field_widget[name=product_id] input",run:'text product1',},{trigger:".ui-menu-item > a:contains('product1')",},{trigger:".o_field_widget[name=location_id] input",run:'text Shelf 1',},{trigger:".ui-menu-item > a:contains('Shelf 1')",},{trigger:".o_field_widget[name=location_dest_id] input",run:'text Shelf 2',},{trigger:".ui-menu-item > a:contains('Shelf 2')",},{trigger:'.o_save',},{trigger:'.o_barcode_summary_location_dest:contains("Shelf 2")',run:function(){assertLinesCount(1);},},{trigger:'.o_add_line',},{extra_trigger:'.o_form_label:contains("Product")',trigger:".o_field_widget[name=product_id] input",run:'text product2',},{trigger:".ui-menu-item > a:contains('product2')",},{trigger:".o_field_widget[name=location_id] input",run:'text Shelf 1',},{trigger:".ui-menu-item > a:contains('Shelf 1')",},{trigger:".o_field_widget[name=location_dest_id] input",run:'text WH/Stock/Shelf 3',},{trigger:".ui-menu-item > a:contains('Shelf 3')",},{trigger:'.o_save',},{trigger:'.o_barcode_summary_location_dest:contains("Shelf 3")',run:function(){assertLinesCount(1);},},{trigger:'.o_previous_page',},{trigger:'.o_barcode_summary_location_dest:contains("Shelf 2")',run:function(){assertPager('1/2');assertPageSummary('From WH/Stock/Shelf 1 To WH/Stock/Shelf 2');assertLinesCount(1);assertPreviousVisible(true);assertPreviousEnabled(true);assertNextVisible(true);assertNextEnabled(true);assertNextIsHighlighted(true);var $line=getLine({barcode:'product1'});assertLineIsHighlighted($line,false);},},{trigger:'.o_edit',},{trigger:'.o_form_label:contains("Product")',run:function(){assertFormLocationSrc("WH/Stock/Shelf 1");assertFormLocationDest("WH/Stock/Shelf 2");assertFormQuantity("2");},},{trigger:'.o_save',},{trigger:'.o_add_line',},{extra_trigger:'.o_form_label:contains("Product")',trigger:".o_field_widget[name=product_id] input",run:'text product2',},{trigger:".ui-menu-item > a:contains('product2')",},{trigger:".o_field_widget[name=location_id] input",run:'text Shelf 1',},{trigger:".ui-menu-item > a:contains('Shelf 1')",},{trigger:".o_field_widget[name=location_dest_id] input",run:'text Shelf 2',},{trigger:".ui-menu-item > a:contains('Shelf 2')",},{trigger:'.o_save',},{trigger:'.o_barcode_summary_location_dest:contains("Shelf 2")',run:function(){assertLinesCount(2);},},{trigger:'.o_next_page',},{trigger:'.o_barcode_client_action',run:'scan LOC-01-01-00'},{trigger:'.o_barcode_client_action',run:'scan product1'},{trigger:'.o_edit',},{trigger:'.o_form_label:contains("Product")',},{trigger:'.o_save',},{trigger:'.o_validate_page',}]);tour.register('test_internal_picking_reserved_1',{test:true},[{trigger:'.o_barcode_client_action',run:function(){assertPageSummary('From WH/Stock/Shelf 1 To WH/Stock/Shelf 2');assertPreviousVisible(true);assertPreviousEnabled(true);assertNextVisible(true);assertNextEnabled(true);assertNextIsHighlighted(false);assertLinesCount(2);assertScanMessage('scan_src');assertLocationHighlight(false);assertDestinationLocationHighlight(false);assertPager('1/2');assertValidateVisible(false);assertValidateIsHighlighted(false);assertValidateEnabled(false);var $lineproduct1=getLine({barcode:'product1'});assertLineIsHighlighted($lineproduct1,false);var $lineproduct2=getLine({barcode:'product2'});assertLineIsHighlighted($lineproduct2,false);}},{trigger:'.o_barcode_client_action',run:'scan shelf3'},{trigger:'.o_barcode_client_action',run:function(){assertPageSummary('From WH/Stock/Shelf 3 To WH/Stock');assertPreviousVisible(true);assertPreviousEnabled(true);assertNextVisible(false);assertNextEnabled(false);assertNextIsHighlighted(false);assertLinesCount(0);assertScanMessage('scan_products');assertLocationHighlight(true);assertDestinationLocationHighlight(false);assertPager('3/3');assertValidateVisible(true);assertValidateIsHighlighted(false);assertValidateEnabled(false);}},{trigger:'.o_barcode_client_action',run:'scan product1'},{trigger:'.o_barcode_client_action',run:function(){assertPageSummary('From WH/Stock/Shelf 3 To WH/Stock');assertPreviousVisible(true);assertPreviousEnabled(true);assertNextVisible(false);assertNextEnabled(false);assertNextIsHighlighted(false);assertLinesCount(1);assertScanMessage('scan_more_dest');assertLocationHighlight(true);assertDestinationLocationHighlight(false);assertPager('3/3');assertValidateVisible(true);assertValidateIsHighlighted(true);assertValidateEnabled(true);var $lineproduct1=getLine({barcode:'product1'});assertLineIsHighlighted($lineproduct1,true);}},{trigger:'.o_barcode_client_action',run:'scan LOC-01-02-00'},{trigger:'.o_barcode_summary_location_dest:contains("WH/Stock/Shelf 2")',run:function(){assertPageSummary('From WH/Stock/Shelf 3 To WH/Stock/Shelf 2');assertPreviousVisible(true);assertPreviousEnabled(true);assertNextVisible(false);assertNextEnabled(false);assertNextIsHighlighted(false);assertLinesCount(1);assertScanMessage('scan_src');assertLocationHighlight(true);assertDestinationLocationHighlight(true);assertPager('3/3');assertValidateVisible(true);assertValidateIsHighlighted(true);assertValidateEnabled(true);var $lineproduct1=getLine({barcode:'product1'});assertLineIsHighlighted($lineproduct1,false);}},{'trigger':'.o_previous_page',},{'trigger':'.o_previous_page',},{trigger:'.o_barcode_client_action',run:function(){assertPageSummary('From WH/Stock/Shelf 1 To WH/Stock/Shelf 2');assertPreviousVisible(true);assertPreviousEnabled(true);assertNextVisible(true);assertNextEnabled(true);assertNextIsHighlighted(false);assertLinesCount(2);assertScanMessage('scan_src');assertLocationHighlight(false);assertDestinationLocationHighlight(false);assertPager('1/3');assertValidateVisible(false);assertValidateIsHighlighted(false);assertValidateVisible(false);var $lineproduct1=getLine({barcode:'product1'});assertLineIsHighlighted($lineproduct1,false);var $lineproduct2=getLine({barcode:'product2'});assertLineIsHighlighted($lineproduct2,false);}},{trigger:'.o_barcode_client_action',run:'scan LOC-01-01-00'},{trigger:'.o_barcode_client_action',run:function(){assertPageSummary('From WH/Stock/Shelf 1 To WH/Stock/Shelf 2');assertPreviousVisible(true);assertPreviousEnabled(true);assertNextVisible(true);assertNextEnabled(true);assertNextIsHighlighted(false);assertLinesCount(2);assertScanMessage('scan_products');assertLocationHighlight(true);assertDestinationLocationHighlight(false);assertPager('1/3');assertValidateVisible(false);assertValidateIsHighlighted(false);assertValidateEnabled(false);var $lineproduct1=getLine({barcode:'product1'});assertLineIsHighlighted($lineproduct1,false);var $lineproduct2=getLine({barcode:'product2'});assertLineIsHighlighted($lineproduct2,false);}},{trigger:'.o_barcode_client_action',run:'scan product1'},{trigger:'.o_barcode_client_action',run:function(){assertPageSummary('From WH/Stock/Shelf 1 To WH/Stock/Shelf 2');assertPreviousVisible(true);assertPreviousEnabled(true);assertNextVisible(true);assertNextEnabled(true);assertNextIsHighlighted(false);assertLinesCount(2);assertScanMessage('scan_more_dest');assertLocationHighlight(true);assertDestinationLocationHighlight(false);assertPager('1/3');assertValidateVisible(false);assertValidateIsHighlighted(false);assertValidateEnabled(false);var $lineproduct1=getLine({barcode:'product1'});assertLineIsHighlighted($lineproduct1,true);var $lineproduct2=getLine({barcode:'product2'});assertLineIsHighlighted($lineproduct2,false);}},{trigger:'.o_barcode_client_action',run:'scan product2'},{trigger:'.o_barcode_client_action',run:function(){assertPageSummary('From WH/Stock/Shelf 1 To WH/Stock/Shelf 2');assertPreviousVisible(true);assertPreviousEnabled(true);assertNextVisible(true);assertNextEnabled(true);assertNextIsHighlighted(true);assertLinesCount(2);assertScanMessage('scan_more_dest');assertLocationHighlight(true);assertDestinationLocationHighlight(false);assertPager('1/3');assertValidateVisible(false);assertValidateIsHighlighted(false);assertValidateEnabled(false);var $lineproduct1=getLine({barcode:'product1'});assertLineIsHighlighted($lineproduct1,false);var $lineproduct2=getLine({barcode:'product2'});assertLineIsHighlighted($lineproduct2,true);}},{trigger:'.o_barcode_client_action',run:'scan LOC-01-02-00'},{trigger:'.o_scan_message_scan_src',run:function(){assertPageSummary('From WH/Stock/Shelf 1 To WH/Stock/Shelf 2');assertPreviousVisible(true);assertPreviousEnabled(true);assertNextVisible(true);assertNextEnabled(true);assertNextIsHighlighted(true);assertLinesCount(2);assertScanMessage('scan_src');assertLocationHighlight(true);assertDestinationLocationHighlight(true);assertPager('1/3');assertValidateVisible(false);assertValidateIsHighlighted(false);assertValidateEnabled(false);$('.o_barcode_line .fa-cubes').parent().each(function(){var qty=$(this).text().trim();if(qty!=='1 / 1'){fail();}});var $lineproduct1=getLine({barcode:'product1'});assertLineIsHighlighted($lineproduct1,false);var $lineproduct2=getLine({barcode:'product2'});assertLineIsHighlighted($lineproduct2,false);}},{'trigger':'.o_next_page',},{trigger:'.o_barcode_summary_location_dest:contains("WH/Stock/Shelf 4")',run:function(){assertPageSummary('From WH/Stock/Shelf 3 To WH/Stock/Shelf 4');assertPreviousVisible(true);assertPreviousEnabled(true);assertNextVisible(true);assertNextEnabled(true);assertNextIsHighlighted(false);assertLinesCount(1);assertScanMessage('scan_src');assertLocationHighlight(false);assertDestinationLocationHighlight(false);assertPager('2/3');assertValidateVisible(false);assertValidateIsHighlighted(false);assertValidateEnabled(false);$('.o_barcode_line .fa-cubes').parent().each(function(){var qty=$(this).text().trim();if(qty!=='0 / 1'){fail();}});var $line=getLine({barcode:'product2'});assertLineIsHighlighted($line,false);}},]);tour.register('test_receipt_reserved_1',{test:true},[{trigger:'.o_barcode_client_action',run:function(){assertPageSummary(' To WH/Stock');assertPreviousVisible(true);assertPreviousEnabled(false);assertNextVisible(false);assertNextEnabled(false);assertNextIsHighlighted(false);assertLinesCount(2);assertScanMessage('scan_products');assertLocationHighlight(false);assertDestinationLocationHighlight(false);assertPager('1/1');assertValidateVisible(true);assertValidateIsHighlighted(false);assertValidateEnabled(true);}},{trigger:'.o_barcode_client_action',run:'scan product1'},{trigger:'.o_barcode_client_action',run:'scan product1'},{trigger:'.o_barcode_client_action',run:'scan product1'},{trigger:'.o_barcode_client_action',run:'scan product1'},{trigger:'.o_barcode_client_action',run:'scan product2'},{trigger:'.o_barcode_client_action',run:'scan product2'},{trigger:'.o_barcode_client_action',run:'scan product2'},{trigger:'.o_barcode_client_action',run:'scan product2'},{trigger:'.o_barcode_client_action',run:'scan LOC-01-01-00'},{trigger:'.o_barcode_summary_location_dest:contains("WH/Stock/Shelf 1")',run:function(){assertPageSummary(' To WH/Stock/Shelf 1');assertPreviousVisible(true);assertPreviousEnabled(false);assertNextVisible(false);assertNextEnabled(false);assertNextIsHighlighted(false);assertLinesCount(2);assertScanMessage('scan_products');assertDestinationLocationHighlight(true);assertPager('1/1');assertValidateVisible(true);assertValidateIsHighlighted(true);assertValidateEnabled(true);$('.o_barcode_line .fa-cubes').parent().each(function(){var qty=$(this).text().trim();if(qty!=='1 / 4'){fail();}});}},{trigger:'.o_add_line',},{trigger:'.o_form_label:contains("Product")',run:function(){assertFormLocationDest('WH/Stock/Shelf 1');},},]);tour.register('test_delivery_lot_with_package',{test:true},[{trigger:'.o_barcode_client_action',run:function(){assertLinesCount(2);assertScanMessage('scan_products');var $line1=$('.o_barcode_line').eq(0);var $line2=$('.o_barcode_line').eq(1);assert($line1.find('.o_line_lot_id').text(),'sn1');assert($line1.find('.fa-truck').parent().text().trim(),"pack_sn_1  pack_sn_1");assert($line2.find('.o_line_lot_id').text(),'sn2');assert($line2.find('.fa-truck').parent().text().trim(),"pack_sn_1  pack_sn_1");}},{trigger:'.o_barcode_client_action',run:'scan productserial1'},{trigger:'.o_barcode_client_action',run:'scan sn3'},{trigger:'.o_barcode_client_action',run:'scan sn4'},{trigger:'.o_barcode_client_action:contains("sn4")',run:function(){assertLinesCount(4);assertScanMessage('scan_products');var $line1=$('.o_barcode_line').eq(0);var $line2=$('.o_barcode_line').eq(1);var $line3=$('.o_barcode_line').eq(2);var $line4=$('.o_barcode_line').eq(3);assert($line1.find('.o_line_lot_name').text(),'sn4');assert($line1.find('.fa-user-o').parent().text().trim(),"Particulier");assert($line1.find('.fa-truck').parent().text().trim(),"pack_sn_2");assert($line2.find('.o_line_lot_name').text(),'sn3');assert($line2.find('.fa-user-o').parent().text().trim(),"");assert($line2.find('.fa-truck').parent().text().trim(),"pack_sn_2");assert($line3.find('.o_line_lot_id').text(),'sn1');assert($line3.find('.fa-user-o').parent().text().trim(),"");assert($line3.find('.fa-truck').parent().text().trim(),"pack_sn_1  pack_sn_1");assert($line4.find('.o_line_lot_id').text(),'sn2');assert($line4.find('.fa-user-o').parent().text().trim(),"");assert($line4.find('.fa-truck').parent().text().trim(),"pack_sn_1  pack_sn_1");}},{trigger:'.o_barcode_line:eq(0) .fa-pencil',},{trigger:'.o_form_label:contains("Product")',run:function(){assert($('input[name="qty_done"]').val(),"1");assert($('div[name="package_id"] input').val(),"pack_sn_2");assert($('div[name="result_package_id"] input').val(),"");assert($('div[name="owner_id"] input').val(),"Particulier");assert($('div[name="lot_id"] input').val(),"sn4");},},{trigger:'.o_discard',},{trigger:'.o_barcode_client_action',run:'scan O-BTN.validate',},{trigger:'.o_notification_title:contains("Success")'},]);tour.register('test_delivery_reserved_1',{test:true},[{trigger:'.o_barcode_client_action',run:function(){assertPageSummary('From WH/Stock ');assertPreviousVisible(true);assertPreviousEnabled(false);assertNextVisible(false);assertNextEnabled(false);assertNextIsHighlighted(false);assertLinesCount(2);assertScanMessage('scan_src');assertLocationHighlight(false);assertPager('1/1');assertValidateVisible(true);assertValidateIsHighlighted(false);assertValidateEnabled(true);}},{trigger:'.o_barcode_client_action',run:'scan LOC-01-00-00'},{trigger:'.o_barcode_client_action',run:function(){assertPageSummary('From WH/Stock ');assertPreviousVisible(true);assertPreviousEnabled(false);assertNextVisible(false);assertNextEnabled(false);assertNextIsHighlighted(false);assertLinesCount(2);assertScanMessage('scan_products');assertLocationHighlight(true);assertPager('1/1');assertValidateVisible(true);assertValidateIsHighlighted(false);assertValidateEnabled(true);}},{trigger:'.o_barcode_client_action',run:'scan product1'},{trigger:'.o_barcode_client_action',run:'scan product2'},{trigger:'.o_barcode_client_action',run:'scan LOC-01-01-00'},{trigger:'.o_barcode_summary_location_src:contains("WH/Stock/Shelf 1")',run:function(){assertPageSummary('From WH/Stock/Shelf 1 ');assertPreviousVisible(true);assertPreviousEnabled(true);assertNextVisible(false);assertNextEnabled(false);assertNextIsHighlighted(false);assertLinesCount(0);assertScanMessage('scan_products');assertLocationHighlight(true);assertPager('2/2');assertValidateVisible(true);assertValidateIsHighlighted(false);assertValidateEnabled(false);}},]);tour.register('test_delivery_reserved_2',{test:true},[{trigger:'.o_barcode_client_action',run:function(){assertPageSummary('');assertPreviousVisible(true);assertPreviousEnabled(false);assertNextVisible(false);assertNextEnabled(false);assertNextIsHighlighted(false);assertLinesCount(2);assertScanMessage('scan_products');assertLocationHighlight(false);assertValidateVisible(true);assertValidateIsHighlighted(false);assertValidateEnabled(true);}},{trigger:'.o_barcode_client_action',run:'scan product1'},{trigger:'.o_barcode_client_action',run:'scan product1'},{trigger:'.o_barcode_client_action',run:'scan product2'},{trigger:'.o_barcode_line_title:contains("product2")',run:function(){assertPageSummary('');assertPreviousVisible(true);assertPreviousEnabled(true);assertNextVisible(false);assertNextEnabled(false);assertNextIsHighlighted(false);assertLinesCount(3);assertScanMessage('scan_products');assertValidateVisible(true);assertValidateIsHighlighted(false);assertValidateEnabled(true);}},{trigger:'.o_barcode_client_action',run:'scan product1'},{trigger:'.o_barcode_client_action',run:'scan product1'},{trigger:'.o_barcode_line_title:contains("product2")',run:function(){assertPageSummary('');assertPreviousVisible(true);assertPreviousEnabled(true);assertNextVisible(false);assertNextEnabled(false);assertNextIsHighlighted(false);assertLinesCount(3);assertScanMessage('scan_products');assertValidateVisible(true);assertValidateIsHighlighted(true);assertValidateEnabled(true);var $lines=getLine({barcode:'product1'});for(var i=0;i<$lines.length;i++){assertLineQty($($lines[i]),"2");}}},{trigger:'.o_barcode_client_action',run:'scan product1'},{trigger:'.o_barcode_client_action',run:function(){assertPageSummary('');assertPreviousVisible(true);assertPreviousEnabled(true);assertNextVisible(false);assertNextEnabled(false);assertNextIsHighlighted(false);assertLinesCount(4);assertScanMessage('scan_products');assertValidateVisible(true);assertValidateIsHighlighted(true);assertValidateEnabled(true);}},]);tour.register('test_delivery_reserved_3',{test:true},[{trigger:'.o_barcode_client_action',run:function(){assertPageSummary('');assertPreviousVisible(true);assertPreviousEnabled(false);assertNextVisible(false);assertNextEnabled(false);assertNextIsHighlighted(false);assertLinesCount(1);assertScanMessage('scan_products');assertLocationHighlight(false);assertValidateVisible(true);assertValidateIsHighlighted(false);assertValidateEnabled(true);}},{trigger:'.o_barcode_client_action',run:'scan product1'},{trigger:'.o_barcode_client_action',run:'scan this_is_not_a_barcode_dude'},{trigger:'.o_barcode_client_action',run:function(){assertPageSummary('');assertPreviousVisible(true);assertPreviousEnabled(true);assertNextVisible(false);assertNextEnabled(false);assertNextIsHighlighted(false);assertLinesCount(1);assertScanMessage('scan_products');assertValidateVisible(true);assertValidateIsHighlighted(true);assertValidateEnabled(true);var $line=getLine({barcode:'product1'});assertLineIsHighlighted($line,true);assertLineQty($line,"1");}},]);tour.register('test_receipt_from_scratch_with_lots_1',{test:true},[{trigger:'.o_barcode_client_action',run:function(){assertPageSummary(' To WH/Stock');}},{trigger:'.o_barcode_client_action',run:'scan lot1',},{trigger:'.o_notification_title:contains("Warning")'},{trigger:'.o_barcode_client_action',run:function(){assertErrorMessage('You are expected to scan one or more products.');},},{trigger:'.o_barcode_client_action',run:'scan productserial1'},{trigger:'.o_barcode_client_action',run:'scan lot1',},{trigger:'.o_barcode_client_action',run:'scan LOC-01-00-00'},{trigger:'.o_barcode_client_action',run:'scan productserial1'},{trigger:'.o_barcode_client_action',run:'scan lot2',},{trigger:'.o_barcode_client_action',run:'scan LOC-01-01-00'},{trigger:'.o_barcode_summary_location_dest:contains("WH/Stock/Shelf 1")',run:function(){assertPageSummary(' To WH/Stock/Shelf 1');assertPreviousVisible(true);}},]);tour.register('test_receipt_from_scratch_with_lots_2',{test:true},[{trigger:'.o_barcode_client_action',run:function(){assertPageSummary(' To WH/Stock');}},{trigger:'.o_barcode_client_action',run:'scan productlot1'},{trigger:'.o_barcode_client_action',run:'scan lot1',},{trigger:'.o_barcode_client_action',run:'scan lot1',},{trigger:'.o_barcode_client_action',run:'scan lot2',},{trigger:'.o_barcode_client_action',run:'scan lot2',},{trigger:'.o_barcode_client_action',run:'scan LOC-01-01-00'},{trigger:'.o_barcode_summary_location_dest:contains("WH/Stock/Shelf 1")',run:function(){assertPageSummary(' To WH/Stock/Shelf 1');assertPreviousVisible(true);}},]);tour.register('test_receipt_from_scratch_with_lots_3',{test:true},[{trigger:'.o_barcode_client_action',run:function(){assertPageSummary('To WH/Stock');}},{trigger:'.o_barcode_client_action',run:'scan product1'},{trigger:'.o_barcode_line',run:function(){assertLinesCount(1);const $line=getLine({barcode:'product1'});assertLineIsHighlighted($line,true);assertLineQty($line,"1");}},{trigger:'.o_barcode_client_action',run:'scan productlot1'},{trigger:'.o_barcode_line:nth-child(2)',run:function(){assertLinesCount(2);const $line1=getLine({barcode:'product1'});const $line2=getLine({barcode:'productlot1'});assertLineIsHighlighted($line1,false);assertLineQty($line1,"1");assertLineIsHighlighted($line2,true);assertLineQty($line2,"0");}},{trigger:'.o_barcode_client_action',run:'scan lot1',},{trigger:'.o_barcode_client_action',run:'scan lot1',},{trigger:'.qty-done:contains(2)',run:function(){assertLinesCount(2);const $line1=getLine({barcode:'product1'});const $line2=getLine({barcode:'productlot1'});assertLineIsHighlighted($line1,false);assertLineQty($line1,"1");assertLineIsHighlighted($line2,true);assertLineQty($line2,"2");}},{trigger:'.o_barcode_client_action',run:'scan O-BTN.validate'},]);tour.register('test_receipt_from_scratch_with_lots_4',{test:true},[{trigger:'.o_barcode_client_action',run:'scan productserial1',},{trigger:'.o_barcode_client_action',run:'scan productserial1',},{trigger:'.o_barcode_client_action',run:'scan productserial1',},{trigger:'.o_add_line',},{trigger:'.o_form_label:contains("Product")',},]);tour.register('test_delivery_from_scratch_with_lots_1',{test:true},[{trigger:'.o_barcode_client_action',run:'scan lot1',},{trigger:'.o_barcode_client_action',run:'scan lot1',},{trigger:'.o_barcode_client_action',run:'scan lot2',},{trigger:'.o_barcode_client_action',run:'scan lot2',},{trigger:'.o_add_line',},{trigger:'.o_form_label:contains("Product")',},]);tour.register('test_delivery_from_scratch_with_sn_1',{test:true},[{trigger:'.o_barcode_client_action',run:'scan productserial1',},{trigger:'.o_barcode_client_action',run:'scan sn1',},{trigger:'.o_barcode_client_action',run:'scan sn1',},{trigger:'.o_notification_title:contains("Warning")'},{trigger:'.o_barcode_client_action',run:function(){assertErrorMessage('The scanned serial number is already used.');},},{trigger:'.o_barcode_client_action',run:'scan sn2',},{trigger:'.o_barcode_client_action',run:'scan sn3',},{trigger:'.o_barcode_client_action',run:'scan sn4',},{trigger:'.o_add_line',},{trigger:'.o_form_label:contains("Product")',},]);tour.register('test_delivery_reserved_lots_1',{test:true},[{trigger:'.o_barcode_client_action',run:'scan productlot1',},{trigger:'.o_barcode_client_action',run:'scan lot2',},{trigger:'.o_barcode_client_action',run:'scan lot1',},{trigger:'.o_barcode_client_action',run:'scan lot2',},{trigger:'.o_add_line',},{trigger:'.o_form_label:contains("Product")',},]);tour.register('test_delivery_different_products_with_same_lot_name',{test:true},[{trigger:'.o_barcode_client_action',run:'scan productlot1',},{trigger:'.o_barcode_client_action',run:'scan lot1',},{trigger:'.o_barcode_client_action',run:'scan lot1',},{trigger:'.o_barcode_client_action',run:'scan productlot2',},{trigger:'.o_barcode_client_action',run:'scan lot1',},{trigger:'.o_barcode_client_action',run:'scan lot1',},{trigger:'.o_add_line',},{trigger:'.o_form_label:contains("Product")',},]);tour.register('test_delivery_reserved_with_sn_1',{test:true},[{trigger:'.o_barcode_client_action',run:'scan productserial1',},{trigger:'.o_barcode_client_action',run:'scan sn3',},{trigger:'.o_barcode_client_action',run:'scan sn3',},{trigger:'.o_notification_title:contains("Warning")'},{trigger:'.o_barcode_client_action',run:function(){assertErrorMessage('The scanned serial number is already used.');},},{trigger:'.o_barcode_client_action',run:'scan sn1',},{trigger:'.o_barcode_client_action',run:'scan sn4',},{trigger:'.o_barcode_client_action',run:'scan sn2',},{trigger:'.o_add_line',},{trigger:'.o_form_label:contains("Product")',},]);tour.register('test_receipt_reserved_lots_multiloc_1',{test:true},[{trigger:'.o_barcode_client_action',run:'scan productlot1',},{trigger:'.o_barcode_client_action',run:'scan lot1',},{trigger:'.o_barcode_client_action',run:'scan lot1',},{trigger:'.o_barcode_client_action',run:'scan LOC-01-02-00',},{trigger:'.o_barcode_client_action',run:'scan productlot1',},{trigger:'.o_barcode_client_action',run:'scan lot2',},{trigger:'.o_barcode_client_action',run:'scan lot2',},{trigger:'.o_barcode_client_action',run:'scan LOC-01-01-00',},{trigger:'.o_add_line',},{trigger:'.o_form_label:contains("Product")',},]);tour.register('test_receipt_duplicate_serial_number',{test:true},[{trigger:'.o_stock_barcode_main_menu:contains("Barcode Scanning")',},{trigger:'.o_stock_barcode_main_menu',run:'scan WH-RECEIPTS',},{trigger:'.o_barcode_client_action',run:'scan productserial1',},{trigger:'.o_barcode_client_action',run:'scan sn1',},{trigger:'.o_barcode_client_action',run:'scan LOC-01-01-00',},{trigger:'.o_barcode_client_action',run:'scan productserial1',},{trigger:'.o_barcode_client_action',run:'scan sn1',},{trigger:'.o_notification_title:contains("Warning")'},{trigger:'.o_barcode_client_action',run:function(){assertErrorMessage('The scanned serial number is already used.');},},{trigger:'.o_barcode_client_action',run:'scan sn2',},{trigger:'.o_barcode_client_action',run:'scan LOC-01-02-00',},{trigger:'.o_barcode_client_action',run:'scan O-BTN.validate',},{trigger:'.o_notification_title:contains("Success")'},{trigger:'.o_stock_barcode_main_menu',run:function(){assertErrorMessage('The transfer has been validated');},},]);tour.register('test_delivery_duplicate_serial_number',{test:true},[{trigger:'.o_stock_barcode_main_menu',run:'scan WH-DELIVERY',},{trigger:'.o_barcode_client_action',run:'scan LOC-01-01-00',},{trigger:'.o_barcode_client_action',run:'scan productserial1',},{trigger:'.o_barcode_client_action',run:'scan sn1',},{trigger:'.o_barcode_client_action',run:'scan LOC-01-01-00',},{trigger:'.o_barcode_client_action',run:'scan productserial1',},{trigger:'.o_barcode_client_action',run:'scan sn1',},{trigger:'.o_notification_title:contains("Warning")'},{trigger:'.o_barcode_client_action',run:function(){assertErrorMessage('The scanned serial number is already used.');},},{trigger:'.o_barcode_client_action',run:'scan sn2',},{trigger:'.o_barcode_client_action',run:'scan O-BTN.validate',},{trigger:'.o_notification_title:contains("Success")'},{trigger:'.o_stock_barcode_main_menu',run:function(){assertErrorMessage('The transfer has been validated');},},]);tour.register('test_bypass_source_scan',{test:true},[{trigger:'.o_barcode_client_action',run:function(){assertPageSummary('From WH/Stock/Shelf 1');assertPreviousVisible(true);assertPreviousEnabled(true);assertNextVisible(true);assertNextEnabled(true);assertNextIsHighlighted(false);assertLinesCount(1);assertScanMessage('scan_src');assertLocationHighlight(false);assertDestinationLocationHighlight(false);assertPager('1/2');assertValidateVisible(false);assertValidateIsHighlighted(false);assertValidateEnabled(false);}},{trigger:'.o_barcode_client_action',run:'scan THEPACK',},{trigger:'.o_notification_title:contains("Warning")'},{trigger:'.o_barcode_client_action',run:function(){assertErrorMessage("You are expected to scan one or more products or a package available at the picking's location");},},{trigger:'.o_barcode_client_action',run:'scan serial1',},{trigger:'.o_edit'},{trigger:'.o_field_many2one[name=lot_id]',extra_trigger:'.o_form_label:contains("Product")',position:"bottom",run:function(actions){actions.text("",this.$anchor.find("input"));},},{trigger:'input.o_field_widget[name=qty_done]',run:'text 0',},{trigger:'.o_save'},{trigger:'.o_barcode_client_action',extra_trigger:'.o_barcode_line',run:'scan lot1',},{trigger:'.o_barcode_client_action',run:'scan lot1',},{trigger:'.o_barcode_client_action',run:'scan LOC-01-02-00',},{trigger:'.o_barcode_client_action',run:'scan THEPACK',},{trigger:'.o_barcode_client_action',run:'scan productserial1',},{trigger:'.o_barcode_client_action',run:'scan serial1',},{trigger:'.o_barcode_client_action',run:'scan O-BTN.validate',},{trigger:'.o_notification_title:contains("Success")'},]);tour.register('test_inventory_adjustment',{test:true},[{trigger:'.button_inventory',},{trigger:'.o_show_information',},{trigger:'.o_form_label:contains("Status")',},{trigger:'.o_close',},{trigger:'.o_barcode_message:contains("Scan products")',},{trigger:'.o_barcode_client_action',run:'scan product1',},{trigger:'.o_barcode_client_action',run:'scan product1',},{trigger:'.o_edit',},{trigger:'.o_form_label:contains("Product")',run:function(){assertInventoryFormQuantity('2.000');}},{trigger:'.o_save',},{trigger:'.o_add_line',},{trigger:".o_field_widget[name=product_id] input",run:'text product2',},{trigger:".ui-menu-item > a:contains('product2')",},{trigger:"input.o_field_widget[name=product_qty]",run:'text 2',},{trigger:'.o_save',},{extra_trigger:'.o_barcode_message:contains("Scan products")',trigger:'.o_barcode_client_action',run:'scan O-BTN.validate',},{trigger:'.o_notification_title:contains("Success")'},{trigger:'.o_stock_barcode_main_menu',run:function(){assertErrorMessage('The inventory adjustment has been validated');},},]);tour.register('test_inventory_adjustment_mutli_location',{test:true},[{trigger:'.button_inventory',},{trigger:'.o_barcode_client_action',run:'scan LOC-01-00-00'},{trigger:'.o_barcode_summary_location_src:contains("WH/Stock")',},{trigger:'.o_barcode_client_action',run:'scan product1',},{trigger:'.o_barcode_client_action',run:'scan product1',},{trigger:'.o_barcode_client_action',run:'scan product2',},{trigger:'.o_barcode_client_action',run:'scan LOC-01-01-00'},{trigger:'.o_barcode_summary_location_src:contains("WH/Stock/Shelf 1")',},{trigger:'.o_barcode_client_action',run:'scan product2',},{trigger:'.o_barcode_client_action',run:'scan LOC-01-02-00'},{trigger:'.o_barcode_summary_location_src:contains("WH/Stock/Shelf 2")',},{trigger:'.o_barcode_client_action',run:'scan product1',},{trigger:'.o_add_line',},{trigger:'.o_form_label:contains("Product")',},]);tour.register('test_inventory_adjustment_tracked_product',{test:true},[{trigger:'.button_inventory',},{trigger:'.o_barcode_client_action',run:'scan productlot1',},{trigger:'.o_barcode_client_action',run:'scan lot1',},{trigger:'.o_barcode_client_action',run:'scan lot1',},{trigger:'.o_barcode_client_action',run:'scan productserial1',},{trigger:'.o_barcode_client_action',run:'scan serial1',},{trigger:'.o_barcode_client_action',run:'scan serial1',},{trigger:'.o_notification_title:contains("Warning")'},{trigger:'.o_barcode_client_action',run:function(){assertErrorMessage('The scanned serial number is already used.');},},{trigger:'.o_barcode_client_action',run:'scan serial2',},{trigger:'.o_barcode_client_action',run:'scan productlot1',},{trigger:'.o_barcode_client_action',run:'scan lot1',},{trigger:'.o_barcode_client_action',run:'scan productserial1',},{trigger:'.o_barcode_client_action',run:'scan serial3',},{trigger:'.o_add_line',},{trigger:'.o_form_label:contains("Product")',},{trigger:'.o_discard',},{extra_trigger:'.o_barcode_message',trigger:'.o_barcode_client_action',run:'scan productlot1',},{trigger:'.o_barcode_client_action',run:'scan lot2',},{trigger:'.o_barcode_client_action',run:'scan lot3',},{trigger:'.o_barcode_line:nth-child(6)',run:function(){assertLinesCount(6);}},]);tour.register('test_inventory_nomenclature',{test:true},[{trigger:'.button_inventory',},{trigger:'.o_barcode_client_action',run:function(){assertScanMessage('scan_products');},},{trigger:'.o_barcode_client_action',run:'scan 2145631123457',},{trigger:'.product-label:contains("product_weight")'},{trigger:'.o_barcode_client_action',run:'scan O-BTN.validate',},{trigger:'.o_notification_title:contains("Success")'},{trigger:'.o_stock_barcode_main_menu',run:function(){assertErrorMessage('The inventory adjustment has been validated');},},]);tour.register('test_inventory_package',{test:true},[{trigger:'.button_inventory',},{trigger:'.o_barcode_client_action',run:'scan PACK001',},{trigger:'.o_barcode_line:contains("product2") .o_edit',},{trigger:'[name="product_qty"]',run:'text 21'},{trigger:'.o_save',},{trigger:'.o_validate_page',},{trigger:'.o_notification_title:contains("Success")'},{trigger:'.o_stock_barcode_main_menu',run:function(){assertErrorMessage('The inventory adjustment has been validated');},},]);tour.register('test_pack_multiple_scan',{test:true},[{trigger:'.o_stock_barcode_main_menu:contains("Barcode Scanning")',},{trigger:'.o_stock_barcode_main_menu',run:'scan WH-RECEIPTS',},{trigger:'.o_barcode_client_action',run:'scan product1',},{trigger:'.o_barcode_client_action',run:'scan product2',},{trigger:'.o_barcode_client_action',run:'scan O-BTN.pack',},{trigger:'.o_barcode_client_action',run:'scan O-BTN.validate',},{trigger:'.o_notification_title:contains("Success")'},{trigger:'.o_stock_barcode_main_menu',run:function(){assertErrorMessage('The transfer has been validated');},},{trigger:'.o_stock_barcode_main_menu',run:'scan WH-DELIVERY',},{trigger:'.o_barcode_client_action',run:'scan PACK0001000',},{trigger:'.o_barcode_client_action',run:'scan PACK0001000',},{trigger:'.o_notification_title:contains("Warning")'},{trigger:'.o_barcode_client_action',run:function(){assertErrorMessage('This package is already scanned.');var $line=getLine({barcode:'product1'});assertLineIsHighlighted($line,true);var $line=getLine({barcode:'product2'});assertLineIsHighlighted($line,true);},},{trigger:'.o_barcode_client_action',run:'scan O-BTN.validate',},{trigger:'.o_notification_title:contains("Success")'},{trigger:'.o_stock_barcode_main_menu',run:function(){assertErrorMessage('The transfer has been validated');},},]);tour.register('test_pack_common_content_scan',{test:true},[{trigger:'.o_stock_barcode_main_menu:contains("Barcode Scanning")',},{trigger:'.o_stock_barcode_main_menu',run:'scan WH-DELIVERY',},{trigger:'.o_barcode_client_action',run:'scan product1',},{trigger:'.o_barcode_client_action',run:'scan PACK1',},{trigger:'.o_barcode_client_action',run:'scan PACK2',},{trigger:'.o_barcode_client_action:contains("PACK2")',run:function(){assertLinesCount(5);},},{trigger:'.o_barcode_client_action',run:'scan O-BTN.validate',},{trigger:'.o_notification_title:contains("Success")'},{trigger:'.o_stock_barcode_main_menu',run:function(){assertErrorMessage('The transfer has been validated');},},]);tour.register('test_pack_multiple_location',{test:true},[{trigger:'.o_stock_barcode_main_menu:contains("Barcode Scanning")',},{trigger:'.o_stock_barcode_main_menu',run:'scan WH-INTERNAL',},{trigger:'.o_barcode_client_action',run:'scan LOC-01-01-00'},{trigger:'.o_barcode_summary_location_src:contains("WH/Stock/Shelf 1")',run:'scan PACK0000666',},{trigger:'.o_package_content',},{trigger:'.o_kanban_view:contains("product1")',run:function(){assertQuantsCount(2);},},{trigger:'.o_close',},{trigger:'.o_barcode_client_action',run:'scan LOC-01-02-00',},{trigger:'.o_barcode_summary_location_dest:contains("WH/Stock/Shelf 2")',run:'scan O-BTN.validate',},{trigger:'.o_notification_title:contains("Success")'},{trigger:'.o_stock_barcode_main_menu',run:function(){assertErrorMessage('The transfer has been validated');},},]);tour.register('test_pack_multiple_location_02',{test:true},[{trigger:'.o_barcode_client_action',run:'scan LOC-01-01-00'},{trigger:'.o_barcode_summary_location_src:contains("WH/Stock/Shelf 1")',run:'scan PACK0002020',},{trigger:'.o_barcode_client_action',run:'scan LOC-01-02-00',},{trigger:'.o_barcode_summary_location_dest:contains("WH/Stock/Shelf 2")',run:'scan O-BTN.validate',},{trigger:'.o_notification_title:contains("Success")'},]);tour.register('test_put_in_pack_from_multiple_pages',{test:true},[{trigger:'.o_barcode_client_action',run:function(){assertPageSummary('From WH/Stock/Shelf 1 To WH/Stock');assertPreviousVisible(true);assertPreviousEnabled(true);assertNextVisible(true);assertNextEnabled(true);assertNextIsHighlighted(false);assertLinesCount(2);assertScanMessage('scan_src');assertLocationHighlight(false);assertDestinationLocationHighlight(false);assertPager('1/2');assertValidateVisible(false);assertValidateIsHighlighted(false);assertValidateEnabled(false);},},{trigger:'.o_barcode_client_action',run:'scan LOC-01-01-00'},{trigger:'.o_barcode_client_action',run:function(){assertPageSummary('From WH/Stock/Shelf 1 To WH/Stock');assertPreviousVisible(true);assertPreviousEnabled(true);assertNextVisible(true);assertNextEnabled(true);assertNextIsHighlighted(false);assertLinesCount(2);assertScanMessage('scan_products');assertLocationHighlight(true);assertDestinationLocationHighlight(false);assertPager('1/2');assertValidateVisible(false);assertValidateIsHighlighted(false);assertValidateEnabled(false);},},{trigger:'.o_barcode_client_action',run:'scan product1',},{trigger:'.o_barcode_client_action',run:'scan product2',},{trigger:'.o_next_page',},{trigger:'.o_barcode_client_action',run:'scan LOC-01-02-00',},{trigger:'.o_barcode_client_action',run:'scan product1',},{trigger:'.o_barcode_client_action',run:'scan product2',},{trigger:'.o_barcode_client_action',run:'scan O-BTN.pack',},{trigger:'.o_barcode_summary_location_src:contains("WH/Stock/Shelf 2")',run:'scan O-BTN.validate',},{trigger:'.o_notification_title:contains("Success")'},]);tour.register('test_reload_flow',{test:true},[{trigger:'.o_stock_barcode_main_menu',run:'scan WH-RECEIPTS'},{trigger:'.o_barcode_client_action',run:'scan product1'},{trigger:'.o_edit',},{extra_trigger:'.o_form_label:contains("Product")',trigger:'input.o_field_widget[name=qty_done]',run:'text 2',},{trigger:'.o_save',},{trigger:'.o_add_line',},{trigger:".o_field_widget[name=product_id] input",run:'text product2',},{trigger:".ui-menu-item > a:contains('product2')",},{trigger:'.o_save',},{trigger:'.o_barcode_summary_location_dest:contains("WH/Stock")',run:function(){assertScanMessage('scan_more_dest');assertLocationHighlight(false);assertDestinationLocationHighlight(true);},},{trigger:'.o_barcode_summary_location_dest:contains("WH/Stock")',run:'scan LOC-01-01-00',},{trigger:'.o_barcode_summary_location_dest:contains("WH/Stock/Shelf 1")',},{trigger:'.o_barcode_client_action',run:'scan O-BTN.validate',},{trigger:'.o_notification_title:contains("Success")',},]);tour.register('test_highlight_packs',{test:true},[{trigger:'.o_barcode_client_action',run:function(){assertLinesCount(1);assertScanMessage('scan_products');assertValidateVisible(true);assertValidateIsHighlighted(false);assertValidateEnabled(true);var $line=$('.o_barcode_line');assertLineIsHighlighted($line,false);},},{trigger:'.o_barcode_client_action',run:'scan PACK002',},{trigger:'.o_barcode_client_action:contains("PACK002")',},{trigger:'.o_barcode_client_action',run:function(){assertLinesCount(2);assertScanMessage('scan_products');assertValidateVisible(true);assertValidateIsHighlighted(true);assertValidateEnabled(true);var $line=$('.o_barcode_line').eq(1);assertLineIsHighlighted($line,true);},},]);tour.register('test_put_in_pack_from_different_location',{test:true},[{trigger:'.o_barcode_client_action',run:'scan LOC-01-01-00',},{trigger:'.o_barcode_client_action',run:'scan product1',},{trigger:'.o_next_page',},{trigger:'.o_barcode_client_action',run:'scan shelf3',},{trigger:'.o_barcode_client_action',run:'scan product2',},{trigger:'.o_barcode_client_action',run:'scan O-BTN.pack',},{trigger:'.fa-truck',},{trigger:'.o_barcode_client_action',run:'scan LOC-01-01-00',},{trigger:'.o_barcode_summary_location_src:contains("WH/Stock/Shelf 1")',},{trigger:'.o_barcode_client_action',run:function(){assertPageSummary('From WH/Stock/Shelf 1 To WH/Stock');assertPreviousVisible(true);assertPreviousEnabled(true);assertNextVisible(false);assertNextEnabled(false);assertNextIsHighlighted(false);assertLinesCount(0);assertScanMessage('scan_products');assertLocationHighlight(true);assertDestinationLocationHighlight(false);assertPager('3/3');assertValidateVisible(true);assertValidateIsHighlighted(false);assertValidateEnabled(false);},},{trigger:'.o_previous_page',},{trigger:'.o_barcode_client_action',run:'scan O-BTN.validate',},{trigger:'.o_notification_title:contains("Success")',},]);tour.register('test_put_in_pack_before_dest',{test:true},[{trigger:'.o_barcode_client_action',run:'scan LOC-01-01-00',},{trigger:'.o_barcode_client_action',run:'scan product1',},{trigger:'.o_next_page',},{trigger:'.o_barcode_client_action',run:'scan shelf3',},{trigger:'.o_barcode_client_action',run:'scan product2',},{trigger:'.o_barcode_client_action',run:'scan shelf4',},{trigger:'.o_barcode_client_action',run:'scan O-BTN.pack'},{trigger:'.modal-title:contains("Choose destination location")',},{trigger:'.btn-primary',},{trigger:'.o_barcode_client_action',run:'scan O-BTN.validate',},{trigger:'.o_notification_title:contains("Success")',},]);});;

/* /stock_barcode/static/src/js/client_action/header_widget.js defined in bundle 'web.assets_backend' */
odoo.define('stock_barcode.HeaderWidget',function(require){'use strict';var Widget=require('web.Widget');var HeaderWidget=Widget.extend({'template':'stock_barcode_header_widget',events:{'click .o_exit':'_onClickExit','click .o_show_information':'_onClickShowInformation','click .o_show_settings':'_onClickShowSettings','click .o_close':'_onClickClose',},init:function(parent){this._super.apply(this,arguments);this.title=parent.title;},toggleDisplayContext:function(mode){var $showInformation=this.$('.o_show_information');var $showSettings=this.$('.o_show_settings');var $close=this.$('.o_close');var $exit=this.$('.o_exit');if(mode==='init'){$showInformation.toggleClass('o_hidden',false);$showSettings.toggleClass('o_hidden',false);$close.toggleClass('o_hidden',true);$exit.toggleClass('o_invisible',false);}else if(mode==='specialized'){$showInformation.toggleClass('o_hidden',true);$showSettings.toggleClass('o_hidden',true);$close.toggleClass('o_hidden',false);$exit.toggleClass('o_invisible',true);}},_onClickExit:function(ev){ev.stopPropagation();this.trigger_up('exit');},_onClickShowInformation:function(ev){ev.stopPropagation();this.trigger_up('show_information');},_onClickShowSettings:function(ev){ev.stopPropagation();this.trigger_up('show_settings');},_onClickClose:function(ev){ev.stopPropagation();this.trigger_up('reload');},});return HeaderWidget;});;

/* /stock_barcode/static/src/js/client_action/lines_widget.js defined in bundle 'web.assets_backend' */
odoo.define('stock_barcode.LinesWidget',function(require){'use strict';var core=require('web.core');var Widget=require('web.Widget');var QWeb=core.qweb;var LinesWidget=Widget.extend({template:'stock_barcode_lines_widget',events:{'click .o_add_line':'_onClickAddLine','click .o_validate_page':'_onClickValidatePage','click .o_next_page':'_onClickNextPage','click .o_previous_page':'_onClickPreviousPage','click .o_put_in_pack':'_onPutInPack',},init:function(parent,page,pageIndex,nbPages){this._super.apply(this,arguments);this.page=page;this.pageIndex=pageIndex;this.nbPages=nbPages;this.mode=parent.mode;this.groups=parent.groups;this.model=parent.actionParams.model;this.show_entire_packs=parent.show_entire_packs;this.requireLotNumber=parent.requireLotNumber;},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){return self._renderLines();});},incrementProduct:function(id_or_virtual_id,qty,model,doNotClearLineHighlight){var $line=this.$("[data-id='"+id_or_virtual_id+"']");var incrementClass=model==='stock.picking'?'.qty-done':'.product_qty';var qtyDone=parseFloat($line.find(incrementClass).text());$line.find(incrementClass).text(parseFloat((qtyDone+qty).toPrecision(15)));this._highlightLine($line,doNotClearLineHighlight);this._handleControlButtons();if(qty===0){this._toggleScanMessage('scan_lot');}else if(this.mode==='receipt'){this._toggleScanMessage('scan_more_dest');}else if(['delivery','inventory'].indexOf(this.mode)>=0){this._toggleScanMessage('scan_more_src');}else if(this.mode==='internal'){this._toggleScanMessage('scan_more_dest');}else if(this.mode==='no_multi_locations'){this._toggleScanMessage('scan_products');}},addProduct:function(lineDescription,model,doNotClearLineHighlight){var $body=this.$el.filter('.o_barcode_lines');var $line=$(QWeb.render('stock_barcode_lines_template',{lines:[lineDescription],groups:this.groups,model:model,requireLotNumber:this.requireLotNumber,}));$body.prepend($line);$line.on('click','.o_edit',this._onClickEditLine.bind(this));$line.on('click','.o_package_content',this._onClickTruckLine.bind(this));this._highlightLine($line,doNotClearLineHighlight);this._handleControlButtons();if(lineDescription.qty_done===0){this._toggleScanMessage('scan_lot');}else if(this.mode==='receipt'){this._toggleScanMessage('scan_more_dest');}else if(['delivery','inventory'].indexOf(this.mode)>=0){this._toggleScanMessage('scan_more_src');}else if(this.mode==='internal'){this._toggleScanMessage('scan_more_dest');}else if(this.mode==='no_multi_locations'){this._toggleScanMessage('scan_products');}},highlightPackage:function(barcode){var $line=this.$('.o_barcode_line:contains('+barcode+')');$line.length&&this._highlightLine($line);},highlightLocation:function(toggle){this.$('.o_barcode_summary_location_src').toggleClass('o_strong',toggle);this.$('.o_barcode_summary_location_dest').toggleClass('o_barcode_summary_location_highlight',toggle);this._toggleScanMessage('scan_products');},highlightDestinationLocation:function(toggle){this.$('.o_barcode_summary_location_dest').toggleClass('o_strong',toggle);if(toggle===false){return;}
this._handleControlButtons();if(this.mode==='receipt'){this._toggleScanMessage('scan_products');}else if(this.mode==='internal'){this._toggleScanMessage('scan_src');}},clearLineHighlight:function(){var $body=this.$el.filter('.o_barcode_lines');$body.find('.o_highlight').removeClass('o_highlight');},setLotName:function(id_or_virtual_id,lotName){var $line=this.$("[data-id='"+id_or_virtual_id+"']");var $lotName=$line.find('.o_line_lot_name');var $lotId=$line.find('.o_line_lot_id');if(!$lotName.text()&&!$lotId.text()){var $span=$('<span>',{class:'o_line_lot_name',text:lotName});$lotName.replaceWith($span);}},getProductLines:function(lines){if(!this.show_entire_packs){return lines;}
return _.filter(lines,function(line){return!line.package_id;});},getPackageLines:function(lines){if(!this.show_entire_packs){return[];}
lines=_.filter(lines,function(line){return line.package_id;});var groupedLines=_.groupBy(lines,function(line){return line.package_id[0]===line.result_package_id[0]&&line.package_id[0];});var packageLines=[];for(var key in groupedLines){var reservedPackage=true;for(var index in groupedLines[key]){if(groupedLines[key][index].product_uom_qty===0){reservedPackage=false;break;}}
if(groupedLines.hasOwnProperty(key)){groupedLines[key][0].reservedPackage=reservedPackage;packageLines.push(groupedLines[key][0]);}}
return packageLines;},getState:function(){return{'highlightLocationSource':this.$('.o_barcode_summary_location_src').hasClass('o_barcode_summary_location_highlight'),'highlightDestinationLocation':this.$('.o_barcode_summary_location_dest').hasClass('o_barcode_summary_location_highlight'),'scan_message':this.$('.o_scan_message:not(.o_hidden)').attr('class').split('o_scan_message_')[1].split(' ')[0],};},_renderLines:function(){if(this.mode==='done'){if(this.model==='stock.picking'){this._toggleScanMessage('picking_already_done');}else if(this.model==='stock.inventory'){this._toggleScanMessage('inv_already_done');}
return;}else if(this.mode==='cancel'){this._toggleScanMessage('picking_already_cancelled');return;}
var $header=this.$el.filter('.o_barcode_lines_header');var $pageSummary=$(QWeb.render('stock_barcode_summary_template',{locationName:this.page.location_name,locationDestName:this.page.location_dest_name,nbPages:this.nbPages,pageIndex:this.pageIndex+1,mode:this.mode,model:this.model,}));$header.append($pageSummary);var $body=this.$el.filter('.o_barcode_lines');if(this.page.lines.length){var $lines=$(QWeb.render('stock_barcode_lines_template',{lines:this.getProductLines(this.page.lines),packageLines:this.getPackageLines(this.page.lines),model:this.model,groups:this.groups,requireLotNumber:this.requireLotNumber,}));$body.prepend($lines);$lines.on('click','.o_edit',this._onClickEditLine.bind(this));$lines.on('click','.o_package_content',this._onClickTruckLine.bind(this));}
var $next=this.$('.o_next_page');var $previous=this.$('.o_previous_page');var $validate=this.$('.o_validate_page');if(this.nbPages===1){$next.prop('disabled',true);$previous.prop('disabled',true);}
if(this.pageIndex+1===this.nbPages){$next.toggleClass('o_hidden');$next.prop('disabled',true);}else{$validate.toggleClass('o_hidden');}
if(!this.page.lines.length&&this.model!=='stock.inventory'){$validate.prop('disabled',true);}
this._handleControlButtons();if(this.mode==='receipt'){this._toggleScanMessage('scan_products');}else if(['delivery','inventory'].indexOf(this.mode)>=0){this._toggleScanMessage('scan_src');}else if(this.mode==='internal'){this._toggleScanMessage('scan_src');}else if(this.mode==='no_multi_locations'){this._toggleScanMessage('scan_products');}
var $summary_src=this.$('.o_barcode_summary_location_src');var $summary_dest=this.$('.o_barcode_summary_location_dest');if(this.mode==='receipt'){$summary_dest.toggleClass('o_barcode_summary_location_highlight',true);}else if(this.mode==='delivery'||this.mode==='internal'){$summary_src.toggleClass('o_barcode_summary_location_highlight',true);}},_handleControlButtons:function(){var $next=this.$('.o_next_page');var $validate=this.$('.o_validate_page');if(!$next.hasClass('o_hidden')){this._highlightNextButtonIfNeeded();}else{$next.prop('disabled',true);}
if(!$validate.hasClass('o_hidden')){this._highlightValidateButtonIfNeeded();}else{$validate.prop('disabled',true);}},_toggleScanMessage:function(message){this.$('.o_scan_message').toggleClass('o_hidden',true);this.$('.o_scan_message_'+message).toggleClass('o_hidden',false);this.$('.o_barcode_pic').toggleClass('o_js_has_warning_msg',_.indexOf(["picking_already_done","picking_already_cancelled","inv_already_done"],message)>-1);},_isReservationProcessedLine:function($line){var qties=$line.find('.o_barcode_scanner_qty').text();qties=qties.split('/');if(parseInt(qties[0],10)<parseInt(qties[1],10)){return-1;}else if(parseInt(qties[0],10)===parseInt(qties[1],10)){return 0;}else{return 1;}},_isReservationProcessed:function(){var self=this;var $lines=this.$('.o_barcode_line');if(!$lines.length){return false;}else{var reservationProcessed=true;$lines.each(function(){var $line=$(this);reservationProcessed=self._isReservationProcessedLine($line);if(reservationProcessed===-1){reservationProcessed=false;return;}});if(reservationProcessed===0||reservationProcessed===1){reservationProcessed=true;}
return reservationProcessed;}},_highlightNextButtonIfNeeded:function(){var $next=this.$('.o_next_page');var shouldHighlight;if($next.prop('disabled')===true){shouldHighlight=false;}else{shouldHighlight=this._isReservationProcessed();}
if(shouldHighlight){$next.prop('disabled',false);$next.toggleClass('btn-secondary',false);$next.toggleClass('btn-primary',true);}else{$next.toggleClass('btn-secondary',true);$next.toggleClass('btn-primary',false);}
return shouldHighlight;},_highlightValidateButtonIfNeeded:function(){var $validate=this.$('.o_validate_page');var shouldHighlight;if($validate.hasClass('o_hidden')===true){shouldHighlight=false;}else{shouldHighlight=this._isReservationProcessed();}
if(shouldHighlight){$validate.prop('disabled',false);$validate.toggleClass('btn-secondary',false);$validate.toggleClass('btn-success',true);}else{$validate.toggleClass('btn-secondary',true);$validate.toggleClass('btn-success',false);}
return shouldHighlight;},_scrollToLine:function($body,$line){$body.animate({scrollTop:$body.scrollTop()+$line.position().top-$body.height()/2+$line.height()/2},500);},_highlightLine:function($line,doNotClearLineHighlight){var $body=this.$el.filter('.o_barcode_lines');if(!doNotClearLineHighlight){this.clearLineHighlight();}
$line.toggleClass('o_highlight',true);$line.parents('.o_barcode_lines').toggleClass('o_js_has_highlight',true);var isReservationProcessed;if($line.find('.o_barcode_scanner_qty').text().indexOf('/')===-1){isReservationProcessed=false;}else{isReservationProcessed=this._isReservationProcessedLine($line);}
if(isReservationProcessed===1){$line.toggleClass('o_highlight_green',false);$line.toggleClass('o_highlight_red',true);}else{$line.toggleClass('o_highlight_green',true);$line.toggleClass('o_highlight_red',false);}
this._scrollToLine($body,$line);},_onClickValidatePage:function(ev){ev.stopPropagation();this.trigger_up('validate');},_onClickAddLine:function(ev){ev.preventDefault();ev.stopPropagation();this.trigger_up('add_line');},_onClickEditLine:function(ev){ev.preventDefault();ev.stopPropagation();var id=$(ev.target).parents('.o_barcode_line').data('id');this.trigger_up('edit_line',{id:id});},_onClickNextPage:function(ev){ev.stopPropagation();this.trigger_up('next_page');},_onClickPreviousPage:function(ev){ev.stopPropagation();this.trigger_up('previous_page');},_onClickTruckLine:function(ev){ev.stopPropagation();var id=$(ev.target).parents('.o_barcode_line').data('id');this.trigger_up('open_package',{id:id});},_onPutInPack:function(ev){ev.stopPropagation();this.trigger_up('put_in_pack');},});return LinesWidget;});;

/* /stock_barcode/static/src/js/client_action/views_widget.js defined in bundle 'web.assets_backend' */
odoo.define('stock_barcode.ViewsWidget',function(require){'use strict';var Widget=require('web.Widget');var FormView=require('web.FormView');var KanbanView=require('web.KanbanView');var ViewsWidget=Widget.extend({'template':'stock_barcode_views_widget',events:{'click .o_save':'_onClickSave','click .o_discard':'_onClickDiscard',},init:function(clientAction,model,view,defaultValue,params,mode,view_type){this._super.apply(this,arguments);this.model=model;this.view=view;this.params=params||{};this.defaultValue=defaultValue;this.mode=mode||'edit';this.view_type=view_type||'form';},willStart:function(){var self=this;return this._super().then(function(){return self._getViewController().then(function(controller){self.controller=controller;});});},start:function(){var self=this;var def=this.controller.appendTo(this.$el.filter('.o_barcode_generic_view'));return Promise.all([def,this._super()]).then(function(){self.$el.find('.o_form_view').addClass('o_xxs_form_view');self.trigger_up('listen_to_barcode_scanned',{'listen':false});});},destroy:function(){this.trigger_up('listen_to_barcode_scanned',{'listen':true});this._super();},_getViewController:function(){var self=this;var views=[[false,'form']];if(self.view_type==="kanban"){views=[[false,'kanban']];}
var views_ref={form:{form_view_ref:this.view},kanban:{kanban_view_ref:this.view},};var context=_.extend({},this.defaultValue,this.context||{},views_ref[self.view_type]);return this.loadViews(this.model,context,views).then(function(fieldsViews){var params=_.extend(self.params||{},{context:context,modelName:self.model,userContext:self.getSession().user_context,mode:self.mode,withControlPanel:false,});var View;if(self.view_type==='form'){View=new FormView(fieldsViews.form,params);}else if(self.view_type==='kanban'){View=new KanbanView(fieldsViews.kanban,params);}
return View.getController(self);});},_onClickSave:function(ev){ev.stopPropagation();var self=this;var def=this.controller.saveRecord(this.controller.handle,{stayInEdit:true,reload:false});def.then(function(){var record=self.controller.model.get(self.controller.handle);self.trigger_up('reload',{'record':record});});},_onClickDiscard:function(ev){ev.stopPropagation();this.trigger_up('reload');},});return ViewsWidget;});;

/* /stock_barcode/static/src/js/client_action/settings_widget.js defined in bundle 'web.assets_backend' */
odoo.define('stock_barcode.SettingsWidget',function(require){'use strict';var Widget=require('web.Widget');var SettingsWidget=Widget.extend({'template':'stock_barcode_settings_widget',events:{'click .o_validate':'_onClickValidate','click .o_cancel':'_onClickCancel','click .o_print_picking':'_onClickPrintPicking','click .o_print_delivery_slip':'_onClickPrintDeliverySlip','click .o_print_barcodes_zpl':'_onClickPrintBarcodesZpl','click .o_print_barcodes_pdf':'_onClickPrintBarcodesPdf','click .o_print_inventory':'_onClickPrintInventory','click .o_scrap':'_onClickScrap',},init:function(parent,model,mode,allow_scrap){this._super.apply(this,arguments);this.model=model;this.mode=mode;this.allow_scrap=allow_scrap},_onClickValidate:function(ev){ev.stopPropagation();this.trigger_up('validate');},_onClickCancel:function(ev){ev.stopPropagation();this.trigger_up('cancel');},_onClickPrintPicking:function(ev){ev.stopPropagation();this.trigger_up('picking_print_picking');},_onClickPrintDeliverySlip:function(ev){ev.stopPropagation();this.trigger_up('picking_print_delivery_slip');},_onClickPrintBarcodesZpl:function(ev){ev.stopPropagation();this.trigger_up('picking_print_barcodes_zpl');},_onClickPrintBarcodesPdf:function(ev){ev.stopPropagation();this.trigger_up('picking_print_barcodes_pdf');},_onClickPrintInventory:function(ev){ev.stopPropagation();this.trigger_up('picking_print_inventory');},_onClickScrap:function(ev){ev.stopPropagation();this.trigger_up('picking_scrap');},});return SettingsWidget;});;

/* /stock_barcode/static/src/js/client_action/abstract_client_action.js defined in bundle 'web.assets_backend' */
odoo.define('stock_barcode.ClientAction',function(require){'use strict';var concurrency=require('web.concurrency');var core=require('web.core');var AbstractAction=require('web.AbstractAction');var BarcodeParser=require('barcodes.BarcodeParser');var ViewsWidget=require('stock_barcode.ViewsWidget');var HeaderWidget=require('stock_barcode.HeaderWidget');var LinesWidget=require('stock_barcode.LinesWidget');var SettingsWidget=require('stock_barcode.SettingsWidget');var utils=require('web.utils');var _t=core._t;function isChildOf(locationParent,locationChild){return _.str.startsWith(locationChild.parent_path,locationParent.parent_path);}
var cache={};var ClientAction=AbstractAction.extend({custom_events:{show_information:'_onShowInformation',show_settings:'_onShowSettings',exit:'_onExit',edit_line:'_onEditLine',add_line:'_onAddLine',next_page:'_onNextPage',previous_page:'_onPreviousPage',reload:'_onReload',listen_to_barcode_scanned:'_onListenToBarcodeScanned',},init:function(parent,action){this._super.apply(this,arguments);this.actionParams={pickingId:action.params.picking_id,inventoryId:action.params.inventory_id,model:action.params.model,};this.actionManager=parent;this.actionManagerInitHeight=this.actionManager.$el.height;this.actionManager.$el.height('100%');this.mutex=new concurrency.Mutex();this.commands={'O-CMD.PREV':this._previousPage.bind(this),'O-CMD.NEXT':this._nextPage.bind(this),'O-CMD.PAGER-FIRST':this._firstPage.bind(this),'O-CMD.PAGER-LAST':this._lastPage.bind(this),'O-CMD.MAIN-MENU':this._onMainMenu.bind(this),};this.initialState={};this.currentState={};this.pages=[];this.currentPageIndex=0;this.groups={};this.title=this.actionParams.model==='stock.inventory'?_('Inventory '):'';this.mode=undefined;this.scannedLocation=undefined;this.scannedLines=[];this.scannedLocationDest=undefined;this.currentStep=undefined;this.stepsByName={};for(var m in this){if(typeof this[m]==='function'&&_.str.startsWith(m,'_step_')){this.stepsByName[m.split('_step_')[1]]=this[m].bind(this);}}},willStart:function(){var self=this;var recordId=this.actionParams.pickingId||this.actionParams.inventoryId;return Promise.all([self._super.apply(self,arguments),self._getState(recordId),self._getProductBarcodes(),self._getLocationBarcodes()]).then(function(){return self._loadNomenclature();});},start:function(){var self=this;this.$('.o_content').addClass('o_barcode_client_action');core.bus.on('barcode_scanned',this,this._onBarcodeScannedHandler);this.headerWidget=new HeaderWidget(this);this.settingsWidget=new SettingsWidget(this,this.actionParams.model,this.mode,this.allow_scrap);return this._super.apply(this,arguments).then(function(){return Promise.all([self.headerWidget.prependTo(self.$('.o_content')),self.settingsWidget.appendTo(self.$('.o_content'))]).then(function(){self.settingsWidget.do_hide();return self._save();}).then(function(){return self._reloadLineWidget(self.currentPageIndex);});});},destroy:function(){core.bus.off('barcode_scanned',this,this._onBarcodeScannedHandler);this._super();},_getState:function(recordId,state){var self=this;var def;if(state){def=Promise.resolve(state);}else{def=this._rpc({'route':'/stock_barcode/get_set_barcode_view_state','params':{'record_id':recordId,'mode':'read','model_name':self.actionParams.model,},});}
return def.then(function(res){self.currentState=res[0];self.initialState=$.extend(true,{},res[0]);self.title+=self.initialState.name;self.groups={'group_stock_multi_locations':self.currentState.group_stock_multi_locations,'group_tracking_owner':self.currentState.group_tracking_owner,'group_tracking_lot':self.currentState.group_tracking_lot,'group_production_lot':self.currentState.group_production_lot,'group_uom':self.currentState.group_uom,};self.show_entire_packs=self.currentState.show_entire_packs;self.requireLotNumber=true;return res;});},_getProductBarcodes:function(){var self=this;if(cache.productsByBarcode){self.productsByBarcode=cache.productsByBarcode;return $.when();}
return this._rpc({'model':'product.product','method':'get_all_products_by_barcode','args':[],}).then(function(res){self.productsByBarcode=res;cache.productsByBarcode=res;});},_getProductByBarcode:async function(barcode){var self=this;var product=this.productsByBarcode[barcode];if(!product){var product_search=await this._rpc({model:'product.product',method:'search_read',args:[[['barcode','=',barcode],['type','!=','service']],['barcode','display_name','uom_id','tracking','type']],})
if(product_search.length){self.productsByBarcode[barcode]=product_search[0];product=product_search[0];}}
if(product&&product.type!='product'&&self.actionParams.model==='stock.inventory'){return Promise.reject(_.str.sprintf(_t("%s can't be inventoried. Only storable products can be inventoried."),product.display_name));}
return product;},_loadNomenclature:function(){this.barcodeParser=new BarcodeParser({'nomenclature_id':this.currentState.nomenclature_id});if(this.barcodeParser){return this.barcodeParser.load();}},_isProduct:function(barcode){var parsed=this.barcodeParser.parse_barcode(barcode);if(parsed.type==='weight'){return this._getProductByBarcode(parsed.base_code).then(function(product){if(product){product.qty=parsed.value;}
return product;});}else{return this._getProductByBarcode(parsed.code);}},_getLocationBarcodes:function(){var self=this;if(cache.locationsByBarcode){self.locationsByBarcode=cache.locationsByBarcode;return $.when();}
return this._rpc({'model':'stock.location','method':'get_all_locations_by_barcode','args':[],}).then(function(res){self.locationsByBarcode=res;cache.locationsByBarcode=res;});},_getLocationId:function(){return this.currentState.location_id||this.currentState.location_ids[0];},_getLines:function(state){return[];},_lot_name_used:function(product,lot_name){return false;},_getPageFields:function(){return[];},_getWriteableFields:function(){return[];},_compareStates:function(){var modifiedMovelines=[];var writeableFields=this._getWriteableFields();for(var i=0;i<this._getLines(this.initialState).length;i++){var currentLine=this._getLines(this.currentState)[i];var initialLine=this._getLines(this.initialState)[i];for(var j=0;j<writeableFields.length;j++){var writeableField=writeableFields[j];if(!_.isEqual(utils.into(initialLine,writeableField),utils.into(currentLine,writeableField))){modifiedMovelines.push(currentLine);break;}}}
if(this._getLines(this.initialState).length<this._getLines(this.currentState).length){modifiedMovelines=modifiedMovelines.concat(this._getLines(this.currentState).slice(this._getLines(this.initialState).length));}
return modifiedMovelines;},_showInformation:function(){var self=this;return this.mutex.exec(function(){self.headerWidget.toggleDisplayContext('specialized');return self._save();});},_applyChanges:function(changes){return Promise.resolve();},_makePages:function(){var pages=[];var defaultPage={};var self=this;if(this._getLines(this.currentState).length){var groups=_.groupBy(this._getLines(this.currentState),function(line){return _.map(self._getPageFields({line:true}),function(field){return utils.into(line,field[1]);}).join('#');});pages=_.map(groups,function(group){var page={};_.map(self._getPageFields({line:true}),function(field){page[field[0]]=utils.into(group[0],field[1]);});page.lines=group;return page;});}else{_.each(self._getPageFields(),function(field){defaultPage[field[0]]=utils.into(self.currentState,field[1]);});defaultPage.lines=[];}
pages=_.sortBy(pages,'location_name');var currentPage=this.pages[this.currentPageIndex];if(this.scanned_location&&currentPage.location_id!==this.scanned_location.id){var alreadyInPages=_.find(pages,function(page){return page.location_id===self.scanned_location.id&&(self.actionParams.model==='stock.inventory'||page.location_dest_id===self.currentState.location_dest_id.id);});if(!alreadyInPages){var pageValues={location_id:this.scanned_location.id,location_name:this.scanned_location.display_name,lines:[],};if(self.actionParams.model==='stock.picking'){pageValues.location_dest_id=this.currentState.location_dest_id.id;pageValues.location_dest_name=this.currentState.location_dest_id.display_name;}
pages.push(pageValues);}}
if(pages.length===0){pages.push(defaultPage);}
return pages;},_getNewVirtualId:function(){return _.uniqueId('virtual_line_');},_makeNewLine:function(product,barcode,qty_done){return{};},_reloadLineWidget:function(pageIndex){var self=this
if(this.linesWidget){this.linesWidget.destroy();}
var nbPages=this.pages.length;var preparedPage=$.extend(true,{},this.pages[pageIndex]);this.linesWidget=new LinesWidget(this,preparedPage,pageIndex,nbPages);return this.linesWidget.appendTo(this.$('.o_content')).then(function(){if(self.linesWidgetState){self.linesWidget.highlightLocation(self.linesWidgetState.highlightLocationSource);self.linesWidget.highlightDestinationLocation(self.linesWidgetState.highlightLocationDestination);self.linesWidget._toggleScanMessage(self.linesWidgetState.scan_message);delete self.linesWidgetState;}
if(self.lastScannedPackage){self.linesWidget.highlightPackage(self.lastScannedPackage);delete self.lastScannedPackage;}});},_save:function(params){params=params||{};var self=this;var currentPage=this.pages[this.currentPageIndex];if(!currentPage){currentPage={};}
var currentLocationId=currentPage.location_id;var currentLocationDestId=currentPage.location_dest_id;var recordId=this.actionParams.pickingId||this.actionParams.inventoryId;var applyChangesDef=this._applyChanges(this._compareStates()).then(function(state){var virtual_ids_to_fixup=_.filter(self._getLines(state[0]),function(line){return line.dummy_id;});_.each(virtual_ids_to_fixup,function(line){if(self.scannedLines.indexOf(line.dummy_id)!==-1){self.scannedLines=_.without(self.scannedLines,line.dummy_id);self.scannedLines.push(line.id);}});return self._getState(recordId,state);},function(error){if(error!==undefined){return Promise.reject();}
if(params.forceReload){return self._getState(recordId);}else{return Promise.resolve();}});return applyChangesDef.then(function(){self.pages=self._makePages();var newPageIndex=_.findIndex(self.pages,function(page){return page.location_id===(params.new_location_id||currentLocationId)&&(self.actionParams.model==='stock.inventory'||page.location_dest_id===(params.new_location_dest_id||currentLocationDestId));})||0;if(newPageIndex===-1){newPageIndex=0;}
self.currentPageIndex=newPageIndex;});},_onBarcodeScanned:function(barcode){var self=this;return this.stepsByName[this.currentStep||'source'](barcode,[]).then(function(res){var prom=Promise.resolve();var currentPage=self.pages[self.currentPageIndex];if((self.scanned_location&&!self.scannedLines.length&&self.scanned_location.id!==currentPage.location_id)||(self.scanned_location_dest&&self.scannedLines.length&&self.scanned_location_dest.id!==currentPage.location_dest_id)){var expectedLocationId=self.scanned_location.id;var expectedLocationDestId;if(self.actionParams.model==='stock.picking'){expectedLocationDestId=self.scanned_location_dest&&self.scanned_location_dest.id||self.currentState.location_dest_id.id;}
if(expectedLocationId!==currentPage.location_id||expectedLocationDestId!==currentPage.location_dest_id){var params={new_location_id:expectedLocationId,};if(expectedLocationDestId){params.new_location_dest_id=expectedLocationDestId;}
prom=self._save(params).then(function(){return self._reloadLineWidget(self.currentPageIndex);});}}
if(self.scannedLines&&self.scanned_location_dest){self._endBarcodeFlow();}
var linesActions=res.linesActions;var always=function(){_.each(linesActions,function(action){action[0].apply(self.linesWidget,action[1]);});};prom.then(always).guardedCatch(always);return prom;},function(errorMessage){self.do_warn(_t('Warning'),errorMessage);});},_endBarcodeFlow:function(){this.scanned_location=undefined;this.scannedLines=[];this.scanned_location_dest=undefined;this.currentStep=undefined;},_findCandidateLineToIncrement:function(params){var product=params.product;var lotId=params.lot_id;var lotName=params.lot_name;var packageId=params.package_id;var currentPage=this.pages[this.currentPageIndex];var res=false;for(var z=0;z<currentPage.lines.length;z++){var lineInCurrentPage=currentPage.lines[z];if(lineInCurrentPage.product_id.id===product.id){if(lineInCurrentPage.virtual_id&&(this.actionParams.model==='stock.picking'&&!lineInCurrentPage.qty_done&&!lineInCurrentPage.product_uom_qty&&!lineInCurrentPage.lot_id&&!lineInCurrentPage.lot_name&&!lineInCurrentPage.package_id)||(this.actionParams.model==='stock.inventory'&&!lineInCurrentPage.product_qty&&!lineInCurrentPage.prod_lot_id)){res=lineInCurrentPage;break;}
if(product.tracking==='serial'&&((this.actionParams.model==='stock.picking'&&lineInCurrentPage.qty_done>0&&this.requireLotNumber)||(this.actionParams.model==='stock.inventory'&&lineInCurrentPage.product_qty>0))){continue;}
if(lineInCurrentPage.qty_done&&(this.actionParams.model==='stock.inventory'||lineInCurrentPage.location_dest_id.id===currentPage.location_dest_id)&&this.scannedLines.indexOf(lineInCurrentPage.virtual_id||lineInCurrentPage.id)===-1&&lineInCurrentPage.qty_done>=lineInCurrentPage.product_uom_qty){continue;}
if(lotId&&((this.actionParams.model==='stock.picking'&&lineInCurrentPage.lot_id&&lineInCurrentPage.lot_id[0]!==lotId)||(this.actionParams.model==='stock.inventory'&&lineInCurrentPage.prod_lot_id&&lineInCurrentPage.prod_lot_id[0]!==lotId))){continue;}
if(lotName&&lineInCurrentPage.lot_name&&lineInCurrentPage.lot_name!==lotName){continue;}
if(packageId&&(!lineInCurrentPage.package_id||lineInCurrentPage.package_id[0]!==packageId[0])){continue;}
if(lineInCurrentPage.product_uom_qty&&lineInCurrentPage.qty_done>=lineInCurrentPage.product_uom_qty){continue;}
res=lineInCurrentPage;break;}}
return res;},_incrementLines:function(params){var line=this._findCandidateLineToIncrement(params);var isNewLine=false;if(line){if(params.product.tracking==='none'||params.lot_id||params.lot_name||!this.requireLotNumber){if(this.actionParams.model==='stock.picking'){line.qty_done+=params.product.qty||1;if(params.package_id){line.package_id=params.package_id;}
if(params.result_package_id){line.result_package_id=params.result_package_id;}}else if(this.actionParams.model==='stock.inventory'){line.product_qty+=params.product.qty||1;}}}else{isNewLine=true;if(params.product.tracking==='none'||params.lot_id||params.lot_name||!this.requireLotNumber){line=this._makeNewLine(params.product,params.barcode,params.product.qty||1,params.package_id,params.result_package_id,params.owner_id);}else{line=this._makeNewLine(params.product,params.barcode,0,params.package_id,params.result_package_id);}
this._getLines(this.currentState).push(line);this.pages[this.currentPageIndex].lines.push(line);}
if(this.actionParams.model==='stock.picking'){if(params.lot_id){line.lot_id=[params.lot_id];}
if(params.lot_name){line.lot_name=params.lot_name;}}else if(this.actionParams.model==='stock.inventory'){if(params.lot_id){line.prod_lot_id=[params.lot_id,params.lot_name];}}
return{'id':line.id,'virtualId':line.virtual_id,'lineDescription':line,'isNewLine':isNewLine,};},_step_source:function(barcode,linesActions){var self=this;this.currentStep='source';var errorMessage;var sourceLocation=this.locationsByBarcode[barcode];if(sourceLocation&&!(this.mode==='receipt'||this.mode==='no_multi_locations')){const locationId=this._getLocationId();if(locationId&&!isChildOf(locationId,sourceLocation)){errorMessage=_t('This location is not a child of the main location.');return Promise.reject(errorMessage);}else{linesActions.push([this.linesWidget.highlightLocation,[true]]);if(this.actionParams.model==='stock.picking'){linesActions.push([this.linesWidget.highlightDestinationLocation,[false]]);}
this.scanned_location=sourceLocation;this.currentStep='product';return Promise.resolve({linesActions:linesActions});}}
this.scanned_location={id:this.pages?this.pages[this.currentPageIndex].location_id:this.currentState.location_id.id,display_name:this.pages?this.pages[this.currentPageIndex].location_name:this.currentState.location_id.display_name,};linesActions.push([this.linesWidget.highlightLocation,[true]]);if(this.actionParams.model==='stock.picking'){linesActions.push([this.linesWidget.highlightDestinationLocation,[false]]);}
return this._step_product(barcode,linesActions).then(function(res){return Promise.resolve({linesActions:res.linesActions});},function(specializedErrorMessage){delete self.scanned_location;self.currentStep='source';if(specializedErrorMessage){return Promise.reject(specializedErrorMessage);}
var errorMessage=_t('You are expected to scan a source location.');return Promise.reject(errorMessage);});},_step_product:async function(barcode,linesActions){var self=this;this.currentStep='product';var errorMessage;var product=await this._isProduct(barcode)
if(product){if(product.tracking!=='none'&&self.requireLotNumber){this.currentStep='lot';}
var res=this._incrementLines({'product':product,'barcode':barcode});if(res.isNewLine){if(this.actionParams.model==='stock.inventory'){return this._rpc({model:'product.product',method:'get_theoretical_quantity',args:[res.lineDescription.product_id.id,res.lineDescription.location_id.id,],}).then(function(theoretical_qty){res.lineDescription.theoretical_qty=theoretical_qty;linesActions.push([self.linesWidget.addProduct,[res.lineDescription,self.actionParams.model]]);self.scannedLines.push(res.id||res.virtualId);return Promise.resolve({linesActions:linesActions});});}else{linesActions.push([this.linesWidget.addProduct,[res.lineDescription,this.actionParams.model]]);}}else{if(product.tracking==='none'||!self.requireLotNumber){linesActions.push([this.linesWidget.incrementProduct,[res.id||res.virtualId,product.qty||1,this.actionParams.model]]);}else{linesActions.push([this.linesWidget.incrementProduct,[res.id||res.virtualId,0,this.actionParams.model]]);}}
this.scannedLines.push(res.id||res.virtualId);return Promise.resolve({linesActions:linesActions});}else{var success=function(res){return Promise.resolve({linesActions:res.linesActions});};var fail=function(specializedErrorMessage){self.currentStep='product';if(specializedErrorMessage){return Promise.reject(specializedErrorMessage);}
if(!self.scannedLines.length){if(self.groups.group_tracking_lot){errorMessage=_t("You are expected to scan one or more products or a package available at the picking's location");}else{errorMessage=_t('You are expected to scan one or more products.');}
return Promise.reject(errorMessage);}
var destinationLocation=self.locationsByBarcode[barcode];if(destinationLocation){return self._step_destination(barcode,linesActions);}else{errorMessage=_t('You are expected to scan more products or a destination location.');return Promise.reject(errorMessage);}};return self._step_lot(barcode,linesActions).then(success,function(){return self._step_package(barcode,linesActions).then(success,fail);});}},_step_package:function(barcode,linesActions){if(!this.groups.group_tracking_lot){return Promise.reject();}
this.currentStep='product';var destinationLocation=this.locationsByBarcode[barcode];if(destinationLocation){return Promise.reject();}
var self=this;var search_read_quants=function(){return self._rpc({model:'stock.quant.package',method:'search_read',domain:[['name','=',barcode],['location_id','child_of',self.scanned_location.id]],limit:1,});};var read_products=function(product){return self._rpc({model:'product.product',method:'read',args:[product,['barcode','display_name','uom_id','tracking']],});};var get_contained_quants=function(quant_ids){return self._rpc({model:'stock.quant',method:'read',args:[quant_ids],});};var package_already_scanned=function(package_id,quants){var expectedNumberOfLines=quants.length;var currentNumberOfLines=0;var qtyField=self.actionParams.model==='stock.inventory'?"product_qty":"qty_done";var currentPage=self.pages[self.currentPageIndex];for(var i=0;i<currentPage.lines.length;i++){var currentLine=currentPage.lines[i];if(currentLine.package_id&&currentLine.package_id[0]===package_id&&currentLine[qtyField]>0){currentNumberOfLines+=1;}}
return currentNumberOfLines===expectedNumberOfLines;};return search_read_quants().then(function(packages){if(packages.length){self.lastScannedPackage=packages[0].name;return get_contained_quants(packages[0].quant_ids).then(function(quants){var packageAlreadyScanned=package_already_scanned(packages[0].id,quants);if(packageAlreadyScanned){return Promise.reject(_t('This package is already scanned.'));}
var products_without_barcode=_.map(quants,function(quant){if(!(quant.product_id[0]in self.productsByBarcode)){return quant.product_id[0];}});return read_products(products_without_barcode).then(function(products_without_barcode){_.each(quants,function(quant){var product_barcode=_.findKey(self.productsByBarcode,function(product){return product.id===quant.product_id[0];});var product=_.clone(self.productsByBarcode[product_barcode]);if(!product){var product_key=_.findKey(products_without_barcode,function(product){return product.id===quant.product_id[0];});product=products_without_barcode[product_key];}
product.qty=quant.quantity;var res=self._incrementLines({product:product,barcode:product_barcode,product_barcode:product_barcode,package_id:[packages[0].id,packages[0].display_name],result_package_id:[packages[0].id,packages[0].display_name],lot_id:quant.lot_id[0],lot_name:quant.lot_id[1]});self.scannedLines.push(res.id||res.virtualId);if(!self.show_entire_packs){if(res.isNewLine){linesActions.push([self.linesWidget.addProduct,[res.lineDescription,self.actionParams.model,true]]);}else{linesActions.push([self.linesWidget.incrementProduct,[res.id||res.virtualId,quant.quantity,self.actionParams.model,true]]);}}});return Promise.resolve({linesActions:linesActions});});});}else{return Promise.reject();}});},_step_lot:async function(barcode,linesActions){if(!this.groups.group_production_lot||!this.requireLotNumber){return Promise.reject();}
this.currentStep='lot';var errorMessage;var self=this;var product=await this._isProduct(barcode)
if(product){return this._step_product(barcode,linesActions);}else if(this.locationsByBarcode[barcode]){return this._step_destination(barcode,linesActions);}
var getProductFromLastScannedLine=function(){if(self.scannedLines.length){var idOrVirtualId=self.scannedLines[self.scannedLines.length-1];var line=_.find(self._getLines(self.currentState),function(line){return line.virtual_id===idOrVirtualId||line.id===idOrVirtualId;});if(line){var product=self.productsByBarcode[line.product_barcode||line.product_id.barcode];if(!product){return false;}
product.barcode=line.product_barcode||line.product_id.barcode;return product;}}
return false;};var getProductFromCurrentPage=function(){return _.map(self.pages[self.currentPageIndex].lines,function(line){return line.product_id.id;});};var getProductFromOperation=function(){return _.map(self._getLines(self.currentState),function(line){return line.product_id.id;});};var readProductQuant=function(product_id,lots){var advanceSettings=self.groups.group_tracking_lot||self.groups.group_tracking_owner;var product_barcode=_.findKey(self.productsByBarcode,function(product){return product.id===product_id;});var product=false;var prom=Promise.resolve();if(product_barcode){product=self.productsByBarcode[product_barcode];product.barcode=product_barcode;}
if(!product||advanceSettings){var lot_ids=_.map(lots,function(lot){return lot.id;});prom=self._rpc({model:'product.product',method:'read_product_and_package',args:[product_id],kwargs:{lot_ids:advanceSettings?lot_ids:false,fetch_product:!(product),},});}
return prom.then(function(res){product=product||res.product;var lot=_.find(lots,function(lot){return lot.product_id[0]===product.id;});var data={lot_id:lot.id,lot_name:lot.display_name,product:product};if(res&&res.quant){data.package_id=res.quant.package_id;data.owner_id=res.quant.owner_id;}
return Promise.resolve(data);});};var getLotInfo=function(lots){var products_in_lots=_.map(lots,function(lot){return lot.product_id[0];});var products=getProductFromLastScannedLine();var product_id=_.intersection(products,products_in_lots);if(!product_id.length){products=getProductFromCurrentPage();product_id=_.intersection(products,products_in_lots);}
if(!product_id.length){products=getProductFromOperation();product_id=_.intersection(products,products_in_lots);}
if(!product_id.length){product_id=[lots[0].product_id[0]];}
return readProductQuant(product_id[0],lots);};var searchRead=function(barcode){var lines_with_lot=_.filter(self.currentState.move_line_ids,function(line){return(line.lot_id&&line.lot_id[1]===barcode)||line.lot_name===barcode;});var line_with_lot;if(lines_with_lot.length>0){var line_index=0;var last_product=lines_with_lot.length>1&&getProductFromLastScannedLine();if(last_product){var last_product_index=_.findIndex(lines_with_lot,function(line){return line.product_id&&line.product_id.id===last_product.id;});if(last_product_index>-1){line_index=last_product_index;}}
line_with_lot=lines_with_lot[line_index];}
var def;if(line_with_lot){def=Promise.resolve([{name:barcode,display_name:barcode,id:line_with_lot.lot_id[0],product_id:[line_with_lot.product_id.id,line_with_lot.display_name],}]);}else{def=self._rpc({model:'stock.production.lot',method:'search_read',domain:[['name','=',barcode]],});}
return def.then(function(res){if(!res.length){errorMessage=_t('The scanned lot does not match an existing one.');return Promise.reject(errorMessage);}
return getLotInfo(res);});};var create=function(barcode,product){return self._rpc({model:'stock.production.lot',method:'create',args:[{'name':barcode,'product_id':product.id,'company_id':self.currentState.company_id[0],}],});};var def;if(this.currentState.use_create_lots&&!this.currentState.use_existing_lots){var product=getProductFromLastScannedLine();if(!product||product.tracking==="none"){return Promise.reject();}
def=Promise.resolve({lot_name:barcode,product:product});}else if(!this.currentState.use_create_lots&&this.currentState.use_existing_lots){def=searchRead(barcode);}else{def=searchRead(barcode).then(function(res){return Promise.resolve(res);},function(errorMessage){var product=getProductFromLastScannedLine();if(product&&product.tracking!=="none"){return create(barcode,product).then(function(lot_id){return Promise.resolve({lot_id:lot_id,lot_name:barcode,product:product});});}
return Promise.reject(errorMessage);});}
return def.then(function(lot_info){var product=lot_info.product;if(product.tracking==='serial'&&self._lot_name_used(product,barcode)){errorMessage=_t('The scanned serial number is already used.');return Promise.reject(errorMessage);}
var res=self._incrementLines({'product':product,'barcode':lot_info.product.barcode,'lot_id':lot_info.lot_id,'lot_name':lot_info.lot_name,'owner_id':lot_info.owner_id,'package_id':lot_info.package_id,});if(res.isNewLine){function handle_line(){self.scannedLines.push(res.lineDescription.virtual_id);linesActions.push([self.linesWidget.addProduct,[res.lineDescription,self.actionParams.model]]);}
if(self.actionParams.model==='stock.inventory'){return self._rpc({model:'product.product',method:'get_theoretical_quantity',args:[res.lineDescription.product_id.id,res.lineDescription.location_id.id,res.lineDescription.prod_lot_id[0],],}).then(function(theoretical_qty){res.lineDescription.theoretical_qty=theoretical_qty;handle_line();return Promise.resolve({linesActions:linesActions});});}
handle_line();}else{if(self.scannedLines.indexOf(res.lineDescription.id)===-1){self.scannedLines.push(res.lineDescription.id||res.lineDescription.virtual_id);}
linesActions.push([self.linesWidget.incrementProduct,[res.id||res.virtualId,1,self.actionParams.model]]);linesActions.push([self.linesWidget.setLotName,[res.id||res.virtualId,barcode]]);}
return Promise.resolve({linesActions:linesActions});});},_step_destination:function(barcode,linesActions){var errorMessage;if(this.mode==='delivery'||this.actionParams.model==='stock.inventory'){this._endBarcodeFlow();return this._step_source(barcode,linesActions);}
var destinationLocation=this.locationsByBarcode[barcode];if(!isChildOf(this.currentState.location_dest_id,destinationLocation)){errorMessage=_t('This location is not a child of the main location.');return Promise.reject(errorMessage);}else{if(!this.scannedLines.length||this.mode==='no_multi_locations'){if(this.groups.group_tracking_lot){errorMessage=_t("You are expected to scan one or more products or a package available at the picking's location");}else{errorMessage=_t('You are expected to scan one or more products.');}
return Promise.reject(errorMessage);}
var self=this;_.each(_.uniq(this.scannedLines),function(idOrVirtualId){var currentStateLine=_.find(self._getLines(self.currentState),function(line){return line.virtual_id&&line.virtual_id.toString()===idOrVirtualId||line.id===idOrVirtualId;});if(currentStateLine.qty_done-currentStateLine.product_uom_qty>=0){currentStateLine.location_dest_id.id=destinationLocation.id;currentStateLine.location_dest_id.display_name=destinationLocation.display_name;}else{var qty=currentStateLine.qty_done;currentStateLine.qty_done-=qty;var newLine=$.extend(true,{},currentStateLine);newLine.qty_done=qty;newLine.location_dest_id.id=destinationLocation.id;newLine.location_dest_id.display_name=destinationLocation.display_name;newLine.product_uom_qty=0;var virtualId=self._getNewVirtualId();newLine.virtual_id=virtualId;delete newLine.id;self._getLines(self.currentState).push(newLine);}});linesActions.push([this.linesWidget.clearLineHighlight,[undefined]]);linesActions.push([this.linesWidget.highlightLocation,[true]]);linesActions.push([this.linesWidget.highlightDestinationLocation,[true]]);this.scanned_location_dest=destinationLocation;return Promise.resolve({linesActions:linesActions});}},_nextPage:function(){var self=this;this.mutex.exec(function(){return self._save().then(function(){if(self.currentPageIndex<self.pages.length-1){self.currentPageIndex++;}
var prom=self._reloadLineWidget(self.currentPageIndex);self._endBarcodeFlow();return prom;});});},_previousPage:function(){var self=this;this.mutex.exec(function(){return self._save().then(function(){if(self.currentPageIndex>0){self.currentPageIndex--;}else{self.currentPageIndex=self.pages.length-1;}
var prom=self._reloadLineWidget(self.currentPageIndex);self._endBarcodeFlow();return prom;});});},_firstPage:function(){var self=this;return self._save().then(function(){if(self.currentPageIndex!==0){self.currentPageIndex=0;self._endBarcodeFlow();return self._reloadLineWidget(0);}});},_lastPage:function(){var self=this;return self._save().then(function(){if(self.currentPageIndex!==self.pages.length-1){self.currentPageIndex=self.pages.length-1;var prom=self._reloadLineWidget(self.pages.length-1);self._endBarcodeFlow();return prom;}});},_onBarcodeScannedHandler:function(barcode){var self=this;this.mutex.exec(function(){if(self.mode==='done'||self.mode==='cancel'){self.do_warn(_t('Warning'),_t('Scanning is disabled in this state.'));return Promise.resolve();}
var commandeHandler=self.commands[barcode];if(commandeHandler){return commandeHandler();}
return self._onBarcodeScanned(barcode).then(function(){if(self.show_entire_packs&&self.lastScannedPackage){return self._reloadLineWidget(self.currentPageIndex);}});});},_onExit:function(ev){ev.stopPropagation();var self=this;this.mutex.exec(function(){return self._save().then(function(){self.actionManager.$el.height(self.actionManagerInitHeight);self.trigger_up('history_back');});});},_onAddLine:function(ev){ev.stopPropagation();var self=this;this.mutex.exec(function(){self.linesWidgetState=self.linesWidget.getState();self.linesWidget.destroy();self.headerWidget.toggleDisplayContext('specialized');var currentPage=self.pages[self.currentPageIndex];var default_location_id=currentPage.location_id;var default_location_dest_id=currentPage.location_dest_id;var default_company_id=self.currentState.company_id[0];return self._save().then(function(){if(self.actionParams.model==='stock.picking'){self.ViewsWidget=new ViewsWidget(self,'stock.move.line','stock_barcode.stock_move_line_product_selector',{'default_picking_id':self.currentState.id,'default_company_id':default_company_id,'default_location_id':default_location_id,'default_location_dest_id':default_location_dest_id,'default_qty_done':1,},false);}else if(self.actionParams.model==='stock.inventory'){self.ViewsWidget=new ViewsWidget(self,'stock.inventory.line','stock_barcode.stock_inventory_line_barcode',{'default_company_id':default_company_id,'default_inventory_id':self.currentState.id,'default_location_id':default_location_id,'default_product_qty':1,},false);}
return self.ViewsWidget.appendTo(self.$('.o_content'));});});},_onEditLine:function(ev){ev.stopPropagation();this.linesWidgetState=this.linesWidget.getState();this.linesWidget.destroy();this.headerWidget.toggleDisplayContext('specialized');var virtual_id=_.isString(ev.data.id)?ev.data.id:false;var self=this;this.mutex.exec(function(){return self._save().then(function(){var id=ev.data.id;if(virtual_id){var currentPage=self.pages[self.currentPageIndex];var rec=_.find(currentPage.lines,function(line){return line.dummy_id===virtual_id;});id=rec.id;}
if(self.actionParams.model==='stock.picking'){self.ViewsWidget=new ViewsWidget(self,'stock.move.line','stock_barcode.stock_move_line_product_selector',{},{currentId:id});}else{self.ViewsWidget=new ViewsWidget(self,'stock.inventory.line','stock_barcode.stock_inventory_line_barcode',{},{currentId:id});}
return self.ViewsWidget.appendTo(self.$('.o_content'));});});},_onShowInformation:function(ev){this._showInformation();},_onShowSettings:function(ev){ev.stopPropagation();var self=this;this.mutex.exec(function(){return self._save().then(function(){if(self.ViewsWidget){self.ViewsWidget.destroy();}
if(self.linesWidget){self.linesWidget.destroy();}
self.headerWidget.toggleDisplayContext('specialized');self.settingsWidget.do_show();});});},_onReload:function(ev){ev.stopPropagation();if(this.ViewsWidget){this.ViewsWidget.destroy();}
if(this.settingsWidget){this.settingsWidget.do_hide();}
this.headerWidget.toggleDisplayContext('init');this.$('.o_show_information').toggleClass('o_hidden',true);var self=this;this._save({'forceReload':true}).then(function(){var record=ev.data.record;if(record){var newPageIndex=_.findIndex(self.pages,function(page){return page.location_id===record.data.location_id.res_id&&(self.actionParams.model==='stock.inventory'||page.location_dest_id===record.data.location_dest_id.res_id);});if(newPageIndex===-1){new Error('broken');}
self.currentPageIndex=newPageIndex;if(self.scannedLines.indexOf(record.data.id)===-1){self.scannedLines.push(record.data.id);}}
self._reloadLineWidget(self.currentPageIndex);self.$('.o_show_information').toggleClass('o_hidden',false);});},_onNextPage:function(ev){ev.stopPropagation();this._nextPage();},_onPreviousPage:function(ev){ev.stopPropagation();this._previousPage();},_onMainMenu:function(){var self=this;self._save().then(function(){self.do_action('stock_barcode.stock_barcode_action_main_menu',{clear_breadcrumbs:true,});});},_onListenToBarcodeScanned:function(ev){if(ev.data.listen){core.bus.on('barcode_scanned',this,this._onBarcodeScannedHandler);}else{core.bus.off('barcode_scanned',this,this._onBarcodeScannedHandler);}},});core.action_registry.add('stock_barcode_client_action',ClientAction);return ClientAction;});;

/* /stock_barcode/static/src/js/client_action/picking_client_action.js defined in bundle 'web.assets_backend' */
odoo.define('stock_barcode.picking_client_action',function(require){'use strict';var core=require('web.core');var ClientAction=require('stock_barcode.ClientAction');var ViewsWidget=require('stock_barcode.ViewsWidget');var _t=core._t;var PickingClientAction=ClientAction.extend({custom_events:_.extend({},ClientAction.prototype.custom_events,{'picking_print_delivery_slip':'_onPrintDeliverySlip','picking_print_picking':'_onPrintPicking','picking_print_barcodes_zpl':'_onPrintBarcodesZpl','picking_print_barcodes_pdf':'_onPrintBarcodesPdf','picking_scrap':'_onScrap','validate':'_onValidate','cancel':'_onCancel','put_in_pack':'_onPutInPack','open_package':'_onOpenPackage',}),init:function(parent,action){this._super.apply(this,arguments);this.context=action.context;this.commands['O-BTN.scrap']=this._scrap.bind(this);this.commands['O-BTN.validate']=this._validate.bind(this);this.commands['O-BTN.cancel']=this._cancel.bind(this);this.commands['O-BTN.pack']=this._putInPack.bind(this);this.commands['O-BTN.print-slip']=this._printDeliverySlip.bind(this);this.commands['O-BTN.print-op']=this._printPicking.bind(this);if(!this.actionParams.pickingId){this.actionParams.pickingId=action.context.active_id;this.actionParams.model='stock.picking';}},willStart:function(){var self=this;var res=this._super.apply(this,arguments);res.then(function(){var picking_type_code=self.currentState.picking_type_code;var picking_state=self.currentState.state;if(picking_type_code==='incoming'){self.mode='receipt';}else if(picking_type_code==='outgoing'){self.mode='delivery';}else{self.mode='internal';}
if(self.currentState.group_stock_multi_locations===false){self.mode='no_multi_locations';}
if(picking_state==='done'){self.mode='done';}else if(picking_state==='cancel'){self.mode='cancel';}
self.allow_scrap=((picking_type_code==='incoming')&&(picking_state==='done')||(picking_type_code==='outgoing')&&(picking_state!=='done')||(picking_type_code==='internal'))
self.requireLotNumber=self.currentState.use_create_lots||self.currentState.use_existing_lots;});return res;},_getLines:function(state){return state.move_line_ids;},_lot_name_used:function(product,lot_name){var lines=this._getLines(this.currentState);for(var i=0;i<lines.length;i++){var line=lines[i];if(line.qty_done!==0&&line.product_id.id===product.id&&(line.lot_name&&line.lot_name===lot_name)){return true;}}
return false;},_getPageFields:function(){return[['location_id','location_id.id'],['location_name','location_id.display_name'],['location_dest_id','location_dest_id.id'],['location_dest_name','location_dest_id.display_name'],];},_getWriteableFields:function(){return['qty_done','location_id.id','location_dest_id.id','lot_name','lot_id.id','result_package_id'];},_makeNewLine:function(product,barcode,qty_done,package_id,result_package_id,owner_id){var virtualId=this._getNewVirtualId();var currentPage=this.pages[this.currentPageIndex];var newLine={'picking_id':this.currentState.id,'product_id':{'id':product.id,'display_name':product.display_name,'barcode':barcode,'tracking':product.tracking,},'product_barcode':barcode,'display_name':product.display_name,'product_uom_qty':0,'product_uom_id':product.uom_id,'qty_done':qty_done,'location_id':{'id':currentPage.location_id,'display_name':currentPage.location_name,},'location_dest_id':{'id':currentPage.location_dest_id,'display_name':currentPage.location_dest_name,},'package_id':package_id,'result_package_id':result_package_id,'owner_id':owner_id,'state':'assigned','reference':this.name,'virtual_id':virtualId,};return newLine;},_validate:function(){var self=this;this.mutex.exec(function(){return self._save().then(function(){return self._rpc({'model':self.actionParams.model,'method':'button_validate','args':[[self.actionParams.pickingId]],'context':self.context,}).then(function(res){var def=Promise.resolve();var successCallback=function(){self.do_notify(_t("Success"),_t("The transfer has been validated"));self.trigger_up('exit');};var exitCallback=function(infos){if((infos===undefined||!infos.special)&&this.dialog.$modal.is(':visible')){successCallback();}
core.bus.on('barcode_scanned',self,self._onBarcodeScannedHandler);};if(_.isObject(res)){var options={on_close:exitCallback,};return def.then(function(){core.bus.off('barcode_scanned',self,self._onBarcodeScannedHandler);return self.do_action(res,options);});}else{return def.then(successCallback);}});});});},_cancel:function(){var self=this;this.mutex.exec(function(){return self._save().then(function(){return self._rpc({'model':self.actionParams.model,'method':'action_cancel','args':[[self.actionParams.pickingId]],}).then(function(){self.do_notify(_t("Cancel"),_t("The transfer has been cancelled"));self.trigger_up('exit');});});});},_scrap:function(){var self=this;this.mutex.exec(function(){return self._save().then(function(){return self._rpc({'model':'stock.picking','method':'button_scrap','args':[[self.actionParams.pickingId]],}).then(function(res){var exitCallback=function(){core.bus.on('barcode_scanned',self,self._onBarcodeScannedHandler);};var options={on_close:exitCallback,};core.bus.off('barcode_scanned',self,self._onBarcodeScannedHandler);return self.do_action(res,options);});});});},_applyChanges:function(changes){var formattedCommands=[];var cmd=[];for(var i in changes){var line=changes[i];if(line.id){cmd=[1,line.id,{'qty_done':line.qty_done,'location_id':line.location_id.id,'location_dest_id':line.location_dest_id.id,'lot_id':line.lot_id&&line.lot_id[0],'lot_name':line.lot_name,'package_id':line.package_id?line.package_id[0]:false,'result_package_id':line.result_package_id?line.result_package_id[0]:false,}];formattedCommands.push(cmd);}else{cmd=[0,0,{'picking_id':line.picking_id,'product_id':line.product_id.id,'product_uom_id':line.product_uom_id[0],'qty_done':line.qty_done,'location_id':line.location_id.id,'location_dest_id':line.location_dest_id.id,'lot_name':line.lot_name,'lot_id':line.lot_id&&line.lot_id[0],'state':'assigned','package_id':line.package_id?line.package_id[0]:false,'result_package_id':line.result_package_id?line.result_package_id[0]:false,'owner_id':line.owner_id?line.owner_id[0]:false,'dummy_id':line.virtual_id,}];formattedCommands.push(cmd);}}
if(formattedCommands.length>0){var params={'mode':'write','model_name':this.actionParams.model,'record_id':this.currentState.id,'write_vals':formattedCommands,'write_field':'move_line_ids',};return this._rpc({'route':'/stock_barcode/get_set_barcode_view_state','params':params,});}else{return Promise.reject();}},_showInformation:function(){var self=this;return this._super.apply(this,arguments).then(function(){if(self.formWidget){self.formWidget.destroy();}
self.linesWidget.destroy();self.ViewsWidget=new ViewsWidget(self,'stock.picking','stock_barcode.stock_picking_barcode',{},{currentId:self.currentState.id},'readonly');self.ViewsWidget.appendTo(self.$('.o_content'));});},_putInPack:function(){var self=this;if(this.currentState.group_tracking_lot===false){this.do_warn(_t("Delivery Packages needs to be enabled in Inventory Settings to use packages"));return;}
this.mutex.exec(function(){return self._save().then(function(){return self._rpc({'model':'stock.picking','method':'put_in_pack','args':[[self.actionParams.pickingId]],kwargs:{context:_.extend({},self.context||{},{barcode_view:true})},}).then(function(res){var def=Promise.resolve();self._endBarcodeFlow();if(res.type&&res.type==='ir.actions.act_window'){var exitCallback=function(infos){if(infos===undefined||!infos.special){self.trigger_up('reload');}
core.bus.on('barcode_scanned',self,self._onBarcodeScannedHandler);};var options={on_close:exitCallback,};return def.then(function(){core.bus.off('barcode_scanned',self,self._onBarcodeScannedHandler);return self.do_action(res,options);});}else{return def.then(function(){return self.trigger_up('reload');});}});});});},_onOpenPackage:function(ev){var self=this;ev.stopPropagation();this.linesWidget.destroy();this.headerWidget.toggleDisplayContext('specialized');var virtual_id=_.isString(ev.data.id)?ev.data.id:false;this.mutex.exec(function(){return self._save().then(function(){var currentPage=self.pages[self.currentPageIndex];var id=ev.data.id;if(virtual_id){var rec=_.find(currentPage.lines,function(line){return line.dummy_id===virtual_id;});id=rec.id;}
var package_id=_.find(currentPage.lines,function(line){return line.id===id;});package_id=package_id.package_id[0];var params={searchQuery:{context:self.context,domain:[['package_id','=',package_id]],},};self.ViewsWidget=new ViewsWidget(self,'stock.quant','stock_barcode.stock_quant_barcode_kanban',{},params,false,'kanban');return self.ViewsWidget.appendTo(self.$('.o_content'));});});},_printPicking:function(){var self=this;this.mutex.exec(function(){return self._save().then(function(){return self._rpc({'model':'stock.picking','method':'do_print_picking','args':[[self.actionParams.pickingId]],}).then(function(res){return self.do_action(res);});});});},_printDeliverySlip:function(){var self=this;this.mutex.exec(function(){return self._save().then(function(){return self.do_action(self.currentState.actionReportDeliverySlipId,{'additional_context':{'active_id':self.actionParams.pickingId,'active_ids':[self.actionParams.pickingId],'active_model':'stock.picking',}});});});},_printBarcodesZpl:function(){var self=this;this.mutex.exec(function(){return self._save().then(function(){return self.do_action(self.currentState.actionReportBarcodesZplId,{'additional_context':{'active_id':self.actionParams.pickingId,'active_ids':[self.actionParams.pickingId],'active_model':'stock.picking',}});});});},_printBarcodesPdf:function(){var self=this;this.mutex.exec(function(){return self._save().then(function(){return self.do_action(self.currentState.actionReportBarcodesPdfId,{'additional_context':{'active_id':self.actionParams.pickingId,'active_ids':[self.actionParams.pickingId],'active_model':'stock.picking',}});});});},_onValidate:function(ev){ev.stopPropagation();this._validate();},_onCancel:function(ev){ev.stopPropagation();this._cancel();},_onPrintPicking:function(ev){ev.stopPropagation();this._printPicking();},_onPrintDeliverySlip:function(ev){ev.stopPropagation();this._printDeliverySlip();},_onPrintBarcodesZpl:function(ev){ev.stopPropagation();this._printBarcodesZpl();},_onPrintBarcodesPdf:function(ev){ev.stopPropagation();this._printBarcodesPdf();},_onScrap:function(ev){ev.stopPropagation();this._scrap();},_onPutInPack:function(ev){ev.stopPropagation();this._putInPack();},});core.action_registry.add('stock_barcode_picking_client_action',PickingClientAction);return PickingClientAction;});;

/* /stock_barcode/static/src/js/client_action/inventory_client_action.js defined in bundle 'web.assets_backend' */
odoo.define('stock_barcode.inventory_client_action',function(require){'use strict';var core=require('web.core');var ClientAction=require('stock_barcode.ClientAction');var ViewsWidget=require('stock_barcode.ViewsWidget');var _t=core._t;var InventoryClientAction=ClientAction.extend({custom_events:_.extend({},ClientAction.prototype.custom_events,{validate:'_onValidate',cancel:'_onCancel',show_information:'_onShowInformation',picking_print_inventory:'_onPrintInventory'}),init:function(parent,action){this._super.apply(this,arguments);this.commands['O-BTN.validate']=this._validate.bind(this);this.commands['O-BTN.cancel']=this._cancel.bind(this);this.mode='inventory';if(!this.actionParams.inventoryId){this.actionParams.inventoryId=action.context.active_id;this.actionParams.model='stock.inventory';}},willStart:function(){var self=this;var res=this._super.apply(this,arguments);res.then(function(){if(self.currentState.group_stock_multi_locations===false){self.mode='no_multi_locations';}else{self.mode='inventory';}
if(self.currentState.state==='done'){self.mode='done';}});return res;},_getWriteableFields:function(){return['product_qty','location_id.id','prod_lot_id.id'];},_getPageFields:function(options){if(options&&options.line){return[['location_id','location_id.id'],['location_name','location_id.display_name'],];}
return[['location_id','location_ids.0.id'],['location_name','location_ids.0.display_name'],];},_getLines:function(state){return state.line_ids;},_lot_name_used:function(product,lot_name){var lines=this._getLines(this.currentState);for(var i=0;i<lines.length;i++){var line=lines[i];if(line.product_qty!==0&&line.product_id.id===product.id&&line.prod_lot_id&&line.prod_lot_id[1]===lot_name){return true;}}
return false;},_makeNewLine:function(product,barcode,qty_done,package_id){var virtualId=this._getNewVirtualId();var currentPage=this.pages[this.currentPageIndex];var newLine={'inventory_id':this.currentState.id,'product_id':{'id':product.id,'display_name':product.display_name,'barcode':barcode,'tracking':product.tracking,},'product_barcode':barcode,'display_name':product.display_name,'product_qty':qty_done,'theoretical_qty':0,'product_uom_id':product.uom_id[0],'location_id':{'id':currentPage.location_id,'name':currentPage.location_name,},'package_id':package_id,'state':'confirm','reference':this.name,'virtual_id':virtualId,};return newLine;},_applyChanges:function(changes){var formattedCommands=[];var cmd=[];for(var i in changes){var line=changes[i];if(line.id){cmd=[1,line.id,{'product_qty':line.product_qty,'prod_lot_id':line.prod_lot_id&&line.prod_lot_id[0],'package_id':line.package_id&&line.package_id[0],}];formattedCommands.push(cmd);}else{cmd=[0,0,{'product_id':line.product_id.id,'product_uom_id':line.product_uom_id,'product_qty':line.product_qty,'location_id':line.location_id.id,'prod_lot_id':line.prod_lot_id&&line.prod_lot_id[0],'package_id':line.package_id&&line.package_id[0],'dummy_id':line.virtual_id,}];formattedCommands.push(cmd);}}
if(formattedCommands.length>0){var params={'mode':'write','model_name':this.actionParams.model,'record_id':this.currentState.id,'write_vals':formattedCommands,'write_field':'line_ids',};return this._rpc({'route':'/stock_barcode/get_set_barcode_view_state','params':params,});}else{return Promise.reject();}},_showInformation:function(){var self=this;return this._super.apply(this,arguments).then(function(){if(self.ViewsWidget){self.ViewsWidget.destroy();}
self.linesWidget.destroy();self.ViewsWidget=new ViewsWidget(self,'stock.inventory','stock_barcode.stock_inventory_barcode2',{},{currentId:self.currentState.id},'readonly');self.ViewsWidget.appendTo(self.$('.o_content'));});},_validate:function(ev){var self=this;this.mutex.exec(function(){return self._save().then(function(){self._rpc({'model':self.actionParams.model,'method':'action_validate','args':[[self.currentState.id]],}).then(function(){self.do_notify(_t("Success"),_t("The inventory adjustment has been validated"));return self.trigger_up('exit');});});});},_cancel:function(){var self=this;this.mutex.exec(function(){return self._save().then(function(){return self._rpc({'model':self.actionParams.model,'method':'action_cancel_draft','args':[[self.currentState.id]],}).then(function(){self.do_notify(_t("Cancel"),_t("The inventory adjustment has been cancelled"));self.trigger_up('exit');});});});},_onValidate:function(ev){ev.stopPropagation();this._validate();},_onCancel:function(ev){ev.stopPropagation();this._cancel();},_onPrintInventory:function(ev){ev.stopPropagation();var self=this;this.mutex.exec(function(){return self._save().then(function(){return self.do_action(self.currentState.actionReportInventory,{'additional_context':{'active_id':self.actionParams.id,'active_ids':[self.actionParams.inventoryId],'active_model':'stock.inventory',}});});});},});core.action_registry.add('stock_barcode_inventory_client_action',InventoryClientAction);return InventoryClientAction;});;

/* /stock_barcode_mobile/static/src/js/stock_mobile_barcode.js defined in bundle 'web.assets_backend' */
odoo.define('web.stock.mobile_barcode',function(require){"use strict";var linesWidget=require('stock_barcode.LinesWidget');var BarcodeMainMenu=require('stock_barcode.MainMenu').MainMenu;var config=require('web.config');var core=require('web.core');var mobile=require('web_mobile.rpc');var _t=core._t;function openMobileScanner(callback){mobile.methods.scanBarcode().then(function(response){var barcode=response.data;if(barcode){callback(barcode);mobile.methods.vibrate({'duration':100});}else{mobile.methods.showToast({'message':_t('Please, Scan again !!')});}});}
BarcodeMainMenu.include({events:_.defaults({'click .o_stock_mobile_barcode':'open_mobile_scanner'},BarcodeMainMenu.prototype.events),init:function(){this.mobileMethods=mobile.methods;return this._super.apply(this,arguments);},open_mobile_scanner:function(){var self=this;openMobileScanner(function(barcode){self._onBarcodeScanned(barcode);});}});linesWidget.include({events:_.defaults({'click .o_stock_mobile_barcode':'_onOpenMobileScanner',},linesWidget.prototype.events),init:function(){this.mobileMethods=mobile.methods;return this._super.apply(this,arguments);},_scrollToLine:function($body,$line){if(config.device.isMobileDevice){$body=$('html, body');$body.animate({scrollTop:$line.position().top-$body.height()/2+$line.height()/2},500);}else{this._super.apply(this,arguments);}},_onOpenMobileScanner:function(){openMobileScanner(function(barcode){core.bus.trigger("barcode_scanned",barcode);});},});});;

/* /delivery_barcode/static/src/js/picking_barcode_handler.js defined in bundle 'web.assets_backend' */
odoo.define('delivery_barcode.PickingBarcodeHandler',function(require){"use strict";var StockPickingBarcodeHandler=require('stock_barcode.PickingBarcodeHandler');StockPickingBarcodeHandler.include({pre_onchange_hook:function(barcode){var self=this;return this.try_put_in_pack_delivery(barcode).then(function(){return Promise.resolve(false);},function(){return self._super.apply(self,arguments);});},try_put_in_pack_delivery:function(barcode){var self=this;var picking_id=this.view.datarecord.id;var packaging_field=this.form_view.fields.delivery_packaging_ids;var packaging_records=packaging_field.viewmanager.active_view.controller.records.records;var pack=_.find(packaging_records,function(pck){return pck.get('barcode')===barcode});if(pack){var pack_id=pack.attributes.id;return self.form_view.save().then(function(){return self.picking_model.call('put_in_pack',[[picking_id]]);}).then(function(put_in_pack_action){put_in_pack_action.context=_.extend({'default_delivery_packaging_id':pack_id,'active_id':picking_id},put_in_pack_action.context||{});self.open_wizard(put_in_pack_action);return Promise.resolve();});}else{return Promise.reject();}}});});;

/* /quality/static/src/js/tablet_image_widget.js defined in bundle 'web.assets_backend' */
odoo.define('quality.tablet_image_field',function(require){"use strict";var basic_fields=require('web.basic_fields');var core=require('web.core');var field_registry=require('web.field_registry');var FieldBinaryImage=basic_fields.FieldBinaryImage;var QWeb=core.qweb;var TabletImage=FieldBinaryImage.extend({template:'FieldBinaryTabletImage',events:_.extend({},FieldBinaryImage.prototype.events,{'click .o_form_image_controls':'_onOpenPreview','click .o_input_file':function(ev){ev.stopImmediatePropagation();},}),_render:function(){var def=this._super.apply(this,arguments);this.$('.o_form_image_controls').toggleClass('o_invisible_modifier',!this.value);return def;},_onClearClick:function(ev){ev.stopImmediatePropagation();this._super.apply(this,arguments);},_onOpenPreview:function(ev){ev.stopPropagation();this.src=this.$el.find('>img').attr('src');this.$modal=$(QWeb.render('FieldBinaryTabletImage.Preview',{url:this.src}));this.$modal.click(this._onClosePreview.bind(this));this.$modal.appendTo('body');this.$modal.modal('show');},_onClosePreview:function(ev){ev.preventDefault();this.$modal.remove();$('.modal-backdrop').remove();},});field_registry.add('tablet_image',TabletImage);return{TabletImage:TabletImage,}});

/* /stock_barcode_quality_control/static/src/js/client_action/lines_widget.js defined in bundle 'web.assets_backend' */
odoo.define('stock_barcode.LinesQualityWidget',function(require){'use strict';var LinesWidget=require('stock_barcode.LinesWidget');var LinesQualityWidget=LinesWidget.include({events:_.extend({},LinesWidget.prototype.events,{'click .o_check_quality':'_onClickCheckQuality',}),init:function(parent,page,pageIndex,nbPages){this._super.apply(this,arguments);this.quality_check_todo=parent.currentState.quality_check_todo;},_onClickCheckQuality:function(ev){ev.stopPropagation();this.trigger_up('picking_check_quality');},});return LinesQualityWidget;});;

/* /stock_barcode_quality_control/static/src/js/client_action/picking_client_action.js defined in bundle 'web.assets_backend' */
odoo.define('stock_barcode.picking_quality_client_action',function(require){'use strict';var core=require('web.core');var PickingClientAction=require('stock_barcode.picking_client_action');var _t=core._t;var PickingQualityClientAction=PickingClientAction.include({custom_events:_.extend({},PickingClientAction.prototype.custom_events,{'picking_check_quality':'_onCheckQuality',}),_checkQuality:function(){var self=this;this.mutex.exec(function(){return self._save().then(function(){return self._rpc({'model':'stock.picking','method':'check_quality','args':[[self.actionParams.pickingId]],}).then(function(res){var exitCallback=function(){self.trigger_up('reload');};if(_.isObject(res)){var options={on_close:exitCallback,};return self.do_action(res,options)}else{self.do_notify(_t("No more quality checks"),_t("All the quality checks have been done."));}});});});},_onCheckQuality:function(ev){ev.stopPropagation();this._checkQuality();},});return PickingQualityClientAction;});;

/* /az_customer_history/static/src/js/product_history_widget.js defined in bundle 'web.assets_backend' */
odoo.define('az_customer_history.ProductHistory',function(require){"use strict";var core=require('web.core');var QWeb=core.qweb;var Widget=require('web.Widget');var Context=require('web.Context');var data_manager=require('web.data_manager');var widget_registry=require('web.widget_registry');var config=require('web.config');var _t=core._t;var time=require('web.time');var ProductHistory=Widget.extend({template:'az_customer_history.product_history',events:_.extend({},Widget.prototype.events,{'click .fa-info-circle':'_onClickButton',}),init:function(parent,params){this.data=params.data;this._super(parent);},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){self._setPopOver();});},updateState:function(state){this.$el.popover('dispose');var candidate=state.data[this.getParent().currentRow];if(candidate){this.data=candidate.data;this.renderElement();this._setPopOver();}},_setPopOver:function(){var self=this;var $content=$(QWeb.render('az_customer_history.HistoryQtyDetailPopOver',{data:this.data,}));var $historyButton=$content.find('.action_open_history');$historyButton.on('click',function(ev){ev.stopPropagation();data_manager.load_action('az_customer_history.action_account_invoice_report_all_cus').then(function(action){self._rpc({model:'product.product',method:'get_components',args:[[self.data.product_id.data.id]]}).then(function(res){action.view_type='pivot';action.domain=[['product_id','in',res],['partner_id','=',self.data.partner_id]];self.do_action(action);});});});var options={content:$content,html:true,placement:'left',title:_t('Invoice History'),trigger:'focus',delay:{'show':0,'hide':100},};this.$el.popover(options);},_onClickButton:function(){this.$el.find('.fa-info-circle').prop('special_click',true);},});widget_registry.add('prouct_history_widget',ProductHistory);return ProductHistory;});;

/* /lb_account_reports/static/src/tagsinput/bootstrap-tagsinput.min.js defined in bundle 'web.assets_backend' */
!function(a){"use strict";function b(b,c){this.isInit=!0,this.itemsArray=[],this.$element=a(b),this.$element.hide(),this.isSelect="SELECT"===b.tagName,this.multiple=this.isSelect&&b.hasAttribute("multiple"),this.objectItems=c&&c.itemValue,this.placeholderText=b.hasAttribute("placeholder")?this.$element.attr("placeholder"):"",this.inputSize=Math.max(1,this.placeholderText.length),this.$container=a('<div class="bootstrap-tagsinput"></div>'),this.$input=a('<input type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container),this.$element.before(this.$container),this.build(c),this.isInit=!1}function c(a,b){if("function"!=typeof a[b]){var c=a[b];a[b]=function(a){return a[c]}}}function d(a,b){if("function"!=typeof a[b]){var c=a[b];a[b]=function(){return c}}}function e(a){return a?i.text(a).html():""}function f(a){var b=0;if(document.selection){a.focus();var c=document.selection.createRange();c.moveStart("character",-a.value.length),b=c.text.length}else(a.selectionStart||"0"==a.selectionStart)&&(b=a.selectionStart);return b}function g(b,c){var d=!1;return a.each(c,function(a,c){if("number"==typeof c&&b.which===c)return d=!0,!1;if(b.which===c.which){var e=!c.hasOwnProperty("altKey")||b.altKey===c.altKey,f=!c.hasOwnProperty("shiftKey")||b.shiftKey===c.shiftKey,g=!c.hasOwnProperty("ctrlKey")||b.ctrlKey===c.ctrlKey;if(e&&f&&g)return d=!0,!1}}),d}var h={tagClass:function(a){return"label label-info"},focusClass:"focus",itemValue:function(a){return a?a.toString():a},itemText:function(a){return this.itemValue(a)},itemTitle:function(a){return null},freeInput:!0,addOnBlur:!0,maxTags:void 0,maxChars:void 0,confirmKeys:[13,44],delimiter:",",delimiterRegex:null,cancelConfirmKeysOnEmpty:!1,onTagExists:function(a,b){b.hide().fadeIn()},trimValue:!1,allowDuplicates:!1,triggerChange:!0};b.prototype={constructor:b,add:function(b,c,d){var f=this;if(!(f.options.maxTags&&f.itemsArray.length>=f.options.maxTags)&&(b===!1||b)){if("string"==typeof b&&f.options.trimValue&&(b=a.trim(b)),"object"==typeof b&&!f.objectItems)throw"Can't add objects when itemValue option is not set";if(!b.toString().match(/^\s*$/)){if(f.isSelect&&!f.multiple&&f.itemsArray.length>0&&f.remove(f.itemsArray[0]),"string"==typeof b&&"INPUT"===this.$element[0].tagName){var g=f.options.delimiterRegex?f.options.delimiterRegex:f.options.delimiter,h=b.split(g);if(h.length>1){for(var i=0;i<h.length;i++)this.add(h[i],!0);return void(c||f.pushVal(f.options.triggerChange))}}var j=f.options.itemValue(b),k=f.options.itemText(b),l=f.options.tagClass(b),m=f.options.itemTitle(b),n=a.grep(f.itemsArray,function(a){return f.options.itemValue(a)===j})[0];if(!n||f.options.allowDuplicates){if(!(f.items().toString().length+b.length+1>f.options.maxInputLength)){var o=a.Event("beforeItemAdd",{item:b,cancel:!1,options:d});if(f.$element.trigger(o),!o.cancel){f.itemsArray.push(b);var p=a('<span class="tag '+e(l)+(null!==m?'" title="'+m:"")+'">'+e(k)+'<span data-role="remove"></span></span>');p.data("item",b),f.findInputWrapper().before(p),p.after(" ");var q=a('option[value="'+encodeURIComponent(j)+'"]',f.$element).length||a('option[value="'+e(j)+'"]',f.$element).length;if(f.isSelect&&!q){var r=a("<option selected>"+e(k)+"</option>");r.data("item",b),r.attr("value",j),f.$element.append(r)}c||f.pushVal(f.options.triggerChange),(f.options.maxTags===f.itemsArray.length||f.items().toString().length===f.options.maxInputLength)&&f.$container.addClass("bootstrap-tagsinput-max"),a(".typeahead, .twitter-typeahead",f.$container).length&&f.$input.typeahead("val",""),this.isInit?f.$element.trigger(a.Event("itemAddedOnInit",{item:b,options:d})):f.$element.trigger(a.Event("itemAdded",{item:b,options:d}))}}}else if(f.options.onTagExists){var s=a(".tag",f.$container).filter(function(){return a(this).data("item")===n});f.options.onTagExists(b,s)}}}},remove:function(b,c,d){var e=this;if(e.objectItems&&(b="object"==typeof b?a.grep(e.itemsArray,function(a){return e.options.itemValue(a)==e.options.itemValue(b)}):a.grep(e.itemsArray,function(a){return e.options.itemValue(a)==b}),b=b[b.length-1]),b){var f=a.Event("beforeItemRemove",{item:b,cancel:!1,options:d});if(e.$element.trigger(f),f.cancel)return;a(".tag",e.$container).filter(function(){return a(this).data("item")===b}).remove(),a("option",e.$element).filter(function(){return a(this).data("item")===b}).remove(),-1!==a.inArray(b,e.itemsArray)&&e.itemsArray.splice(a.inArray(b,e.itemsArray),1)}c||e.pushVal(e.options.triggerChange),e.options.maxTags>e.itemsArray.length&&e.$container.removeClass("bootstrap-tagsinput-max"),e.$element.trigger(a.Event("itemRemoved",{item:b,options:d}))},removeAll:function(){var b=this;for(a(".tag",b.$container).remove(),a("option",b.$element).remove();b.itemsArray.length>0;)b.itemsArray.pop();b.pushVal(b.options.triggerChange)},refresh:function(){var b=this;a(".tag",b.$container).each(function(){var c=a(this),d=c.data("item"),f=b.options.itemValue(d),g=b.options.itemText(d),h=b.options.tagClass(d);if(c.attr("class",null),c.addClass("tag "+e(h)),c.contents().filter(function(){return 3==this.nodeType})[0].nodeValue=e(g),b.isSelect){var i=a("option",b.$element).filter(function(){return a(this).data("item")===d});i.attr("value",f)}})},items:function(){return this.itemsArray},pushVal:function(){var b=this,c=a.map(b.items(),function(a){return b.options.itemValue(a).toString()});b.$element.val(c,!0),b.options.triggerChange&&b.$element.trigger("change")},build:function(b){var e=this;if(e.options=a.extend({},h,b),e.objectItems&&(e.options.freeInput=!1),c(e.options,"itemValue"),c(e.options,"itemText"),d(e.options,"tagClass"),e.options.typeahead){var i=e.options.typeahead||{};d(i,"source"),e.$input.typeahead(a.extend({},i,{source:function(b,c){function d(a){for(var b=[],d=0;d<a.length;d++){var g=e.options.itemText(a[d]);f[g]=a[d],b.push(g)}c(b)}this.map={};var f=this.map,g=i.source(b);a.isFunction(g.success)?g.success(d):a.isFunction(g.then)?g.then(d):a.when(g).then(d)},updater:function(a){return e.add(this.map[a]),this.map[a]},matcher:function(a){return-1!==a.toLowerCase().indexOf(this.query.trim().toLowerCase())},sorter:function(a){return a.sort()},highlighter:function(a){var b=new RegExp("("+this.query+")","gi");return a.replace(b,"<strong>$1</strong>")}}))}if(e.options.typeaheadjs){var j=null,k={},l=e.options.typeaheadjs;a.isArray(l)?(j=l[0],k=l[1]):k=l,e.$input.typeahead(j,k).on("typeahead:selected",a.proxy(function(a,b){k.valueKey?e.add(b[k.valueKey]):e.add(b),e.$input.typeahead("val","")},e))}e.$container.on("click",a.proxy(function(a){e.$element.attr("disabled")||e.$input.removeAttr("disabled"),e.$input.focus()},e)),e.options.addOnBlur&&e.options.freeInput&&e.$input.on("focusout",a.proxy(function(b){0===a(".typeahead, .twitter-typeahead",e.$container).length&&(e.add(e.$input.val()),e.$input.val(""))},e)),e.$container.on({focusin:function(){e.$container.addClass(e.options.focusClass)},focusout:function(){e.$container.removeClass(e.options.focusClass)}}),e.$container.on("keydown","input",a.proxy(function(b){var c=a(b.target),d=e.findInputWrapper();if(e.$element.attr("disabled"))return void e.$input.attr("disabled","disabled");switch(b.which){case 8:if(0===f(c[0])){var g=d.prev();g.length&&e.remove(g.data("item"))}break;case 46:if(0===f(c[0])){var h=d.next();h.length&&e.remove(h.data("item"))}break;case 37:var i=d.prev();0===c.val().length&&i[0]&&(i.before(d),c.focus());break;case 39:var j=d.next();0===c.val().length&&j[0]&&(j.after(d),c.focus())}var k=c.val().length;Math.ceil(k/5);c.attr("size",Math.max(this.inputSize,c.val().length))},e)),e.$container.on("keypress","input",a.proxy(function(b){var c=a(b.target);if(e.$element.attr("disabled"))return void e.$input.attr("disabled","disabled");var d=c.val(),f=e.options.maxChars&&d.length>=e.options.maxChars;e.options.freeInput&&(g(b,e.options.confirmKeys)||f)&&(0!==d.length&&(e.add(f?d.substr(0,e.options.maxChars):d),c.val("")),e.options.cancelConfirmKeysOnEmpty===!1&&b.preventDefault());var h=c.val().length;Math.ceil(h/5);c.attr("size",Math.max(this.inputSize,c.val().length))},e)),e.$container.on("click","[data-role=remove]",a.proxy(function(b){e.$element.attr("disabled")||e.remove(a(b.target).closest(".tag").data("item"))},e)),e.options.itemValue===h.itemValue&&("INPUT"===e.$element[0].tagName?e.add(e.$element.val()):a("option",e.$element).each(function(){e.add(a(this).attr("value"),!0)}))},destroy:function(){var a=this;a.$container.off("keypress","input"),a.$container.off("click","[role=remove]"),a.$container.remove(),a.$element.removeData("tagsinput"),a.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var b=this.$input[0],c=this.$container[0];b&&b.parentNode!==c;)b=b.parentNode;return a(b)}},a.fn.tagsinput=function(c,d,e){var f=[];return this.each(function(){var g=a(this).data("tagsinput");if(g)if(c||d){if(void 0!==g[c]){if(3===g[c].length&&void 0!==e)var h=g[c](d,null,e);else var h=g[c](d);void 0!==h&&f.push(h)}}else f.push(g);else g=new b(this,c),a(this).data("tagsinput",g),f.push(g),"SELECT"===this.tagName&&a("option",a(this)).attr("selected","selected"),a(this).val(a(this).val())}),"string"==typeof c?f.length>1?f:f[0]:f},a.fn.tagsinput.Constructor=b;var i=a("<div />");a(function(){a("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})}(window.jQuery);;

/* /lb_account_reports/static/src/js/account_reports.js defined in bundle 'web.assets_backend' */
odoo.define('lb_account_reports.account_report',function(require){'use strict';var core=require('web.core');var AccountReport=require('account_reports.account_report');var Widget=require('web.Widget');var StandaloneFieldManagerMixin=require('web.StandaloneFieldManagerMixin');var RelationalFields=require('web.relational_fields');var QWeb=core.qweb;var _t=core._t;var M2MFilters=Widget.extend(StandaloneFieldManagerMixin,{init:function(parent,fields){this._super.apply(this,arguments);StandaloneFieldManagerMixin.init.call(this);this.fields=fields;this.widgets={};},willStart:function(){var self=this;var defs=[this._super.apply(this,arguments)];_.each(this.fields,function(field,fieldName){defs.push(self._makeM2MWidget(field,fieldName));});return Promise.all(defs);},start:function(){var self=this;var $content=$(QWeb.render("m2mWidgetTable",{fields:this.fields}));self.$el.append($content);_.each(this.fields,function(field,fieldName){self.widgets[fieldName].appendTo($content.find('#'+fieldName+'_field'));});return this._super.apply(this,arguments);},_confirmChange:function(){var self=this;var result=StandaloneFieldManagerMixin._confirmChange.apply(this,arguments);var data={};_.each(this.fields,function(filter,fieldName){data[fieldName]=self.widgets[fieldName].value.res_ids;});this.trigger_up('value_changed',data);return result;},_makeM2MWidget:function(fieldInfo,fieldName){var self=this;var options={};options[fieldName]={options:{no_create_edit:true,no_create:true,}};return this.model.makeRecord(fieldInfo.modelName,[{fields:[{name:'id',type:'integer',},{name:'display_name',type:'char',}],name:fieldName,relation:fieldInfo.modelName,type:'many2many',value:fieldInfo.value,}],options).then(function(recordID){self.widgets[fieldName]=new RelationalFields.FieldMany2ManyTags(self,fieldName,self.model.get(recordID),{mode:'edit',});self._registerWidget(recordID,fieldName,self.widgets[fieldName]);});},});AccountReport.include({events:{'input .o_account_reports_filter_input':'filter_accounts','click .o_account_reports_summary':'edit_summary','click .js_account_report_save_summary':'save_summary','click .o_account_reports_footnote_icons':'delete_footnote','click .js_account_reports_add_footnote':'add_edit_footnote','click .js_account_report_foldable':'fold_unfold','click [action]':'trigger_action','click .o_account_reports_load_more span':'load_more','click .search_account_range':'_searchAccountRange','click .search_account_range_clear':'clearFilter',},custom_events:{'value_changed':function(ev){var self=this;self.report_options.account_ids=ev.data.account_ids;self.report_options.partner_ids=ev.data.partner_ids;self.report_options.partner_categories=ev.data.partner_categories;self.report_options.analytic_accounts=ev.data.analytic_accounts;self.report_options.analytic_tags=ev.data.analytic_tags;return self.reload().then(function(){self.$searchview_buttons.find('.account_partner_filter').click();self.$searchview_buttons.find('.account_analytic_filter').click();});},},render_searchview_buttons:function(){if('search_values'in this.report_options){var values=this.report_options.search_values;for(let x in values){$('.bootstrap-tagsinput input').val(values[x]);$('.o_account_reports_filter_from_input').val(values[x]).tagsinput();}}
if(this.report_options.partner||this.report_options.accounts){if(!this.M2MFilters){var fields={};if(this.report_options.partner){if('partner_ids'in this.report_options){fields['partner_ids']={label:_t('Partners'),modelName:'res.partner',value:this.report_options.partner_ids.map(Number),};}
if('partner_categories'in this.report_options){fields['partner_categories']={label:_t('Tags'),modelName:'res.partner.category',value:this.report_options.partner_categories.map(Number),};}}
if(this.report_options.accounts){if('account_ids'in this.report_options){fields['account_ids']={label:_t('Accounts'),modelName:'account.account',value:this.report_options.account_ids.map(Number),};}}
if(!_.isEmpty(fields)){this.M2MFilters=new M2MFilters(this,fields);this.M2MFilters.appendTo(this.$searchview_buttons.find('.js_account_partner_m2m'));}}else{this.$searchview_buttons.find('.js_account_partner_m2m').append(this.M2MFilters.$el);}}
this._super.apply(this,arguments);},_add_line_classes:function(){var el=this.$el[0];var report_lines=el.getElementsByClassName('o_account_report_line');for(var l=0;l<report_lines.length;l++){var line=report_lines[l];var unfolded=line.dataset.unfolded;if(unfolded==='True'){line.parentNode.classList.add('o_js_account_report_parent_row_unfolded');}}
this.$('tr[data-parent-id]').addClass('o_js_account_report_inner_row');if(this.report_options['filter_accounts_ledger']){console.log("Getting filter by account ledger from trial balance");this.$el.find('.o_account_reports_filter_input').val(this.report_options['filter_accounts_ledger']);this.$el.find('.o_account_reports_filter_input').trigger('input');}},filter_accounts:function(e){var self=this;var query=e.target.value.trim().toLowerCase();this.filterOn=false;var availableTags=[];this.$('.o_account_reports_table').find('tbody').find('tr').each(function(index,el){var $accountReportLineFoldable=$(el);var line_id=$accountReportLineFoldable.find('.o_account_report_line').data('id');var $childs=self.$('tr[data-parent-id="'+line_id+'"]');var lineText='';if($accountReportLineFoldable.find('.o_account_reports_domain_line_2').length>0){var lineText=$accountReportLineFoldable.find('.o_account_reports_domain_line_2').contents().get(0).nodeValue.trim();}else if($accountReportLineFoldable.find('.account_report_line_name').length>0){var lineText=$accountReportLineFoldable.find('.account_report_line_name').contents().get(0).nodeValue.trim();}
var queryFound=lineText.split('  ').some(function(str){var str_found=str.toLowerCase().includes(query);if(str_found&&availableTags.indexOf(str)==-1){availableTags.push(str)}
return str_found});$accountReportLineFoldable.toggleClass('o_account_reports_filtered_lines',!queryFound);$childs.toggleClass('o_account_reports_filtered_lines',!queryFound);if(!queryFound){self.filterOn=true;}});$(".o_account_reports_filter_input").autocomplete({source:availableTags,select:function(event,ui){self.$('.o_account_reports_table').find('tbody').find('tr').each(function(index,el){var $accountReportLineFoldable=$(el);var line_id=$accountReportLineFoldable.find('.o_account_report_line').data('id');var $childs=self.$('tr[data-parent-id="'+line_id+'"]');var lineText='';if($accountReportLineFoldable.find('.o_account_reports_domain_line_2').length>0){var lineText=$accountReportLineFoldable.find('.o_account_reports_domain_line_2').contents().get(0).nodeValue.trim();}else if($accountReportLineFoldable.find('.account_report_line_name').length>0){var lineText=$accountReportLineFoldable.find('.account_report_line_name').contents().get(0).nodeValue.trim();}
var q=ui.item.value
query=q.trim().toLowerCase();var queryFound=lineText.split('  ').some(function(str){var str_found=str.toLowerCase().includes(query);if(str_found&&availableTags.indexOf(str)==-1){availableTags.push(str)}
return str_found});$accountReportLineFoldable.toggleClass('o_account_reports_filtered_lines',!queryFound);$childs.toggleClass('o_account_reports_filtered_lines',!queryFound);if(!queryFound){self.filterOn=true;}});},focus:function(event,ui){if(ui.item!=undefined){var q=ui.item.value
query=q.trim().toLowerCase();if(self.filterOn){self.$('.o_account_reports_level1.total').hide();}
else{self.$('.o_account_reports_level1.total').css({'display':'table-row'});}
self.report_options['filter_accounts']=query;self.render_footnotes();}}});if(this.filterOn){this.$('.o_account_reports_level1.total').hide();}
else{this.$('.o_account_reports_level1.total').css({'display':'table-row'});}
this.report_options['filter_accounts']=query;this.render_footnotes();},_searchAccountRange:function(e){var self=this;this.filterOn=false;var account_from_value_list=$(".o_account_reports_filter_from_input").tagsinput('items');this._rpc({model:this.report_model,method:'get_search_data',args:[self.financial_id,account_from_value_list],}).then(function(result){self.reload();});},clearFilter:function(){var self=this;this._rpc({model:this.report_model,method:'clear_data',args:[self.financial_id],}).then(function(result){self.reload();});},unfold:function(line){var self=this;var line_id=line.data('id');line.toggleClass('folded');self.report_options.unfolded_lines.push(line_id);var $lines_in_dom=this.$el.find('tr[data-parent-id="'+line_id+'"]');if($lines_in_dom.length>0){$lines_in_dom.find('.js_account_report_line_footnote').removeClass('folded');$lines_in_dom.show();$lines_in_dom.css({'display':'table-row'});line.find('.fa-caret-right').toggleClass('fa-caret-right fa-caret-down');line.data('unfolded','True');this._add_line_classes();return true;}else{return this._rpc({model:this.report_model,method:'get_html',args:[self.financial_id,self.report_options,line.data('id')],context:self.odoo_context,}).then(function(result){$(line).parent('tr').replaceWith(result);self._add_line_classes();});}},});});;

/* /mail_activity_done/static/src/js/mail_activity.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Activity.done',function(require){"use strict";var mailUtils=require('mail.utils');var core=require('web.core');var time=require('web.time');var mail_activity=require('mail.Activity');var QWeb=core.qweb;var _t=core._t;var setDelayLabel=function(activities){var today=moment().startOf('day');_.each(activities,function(activity){var to_display='';var deadline=moment(activity.date_deadline).startOf('day');var diff=deadline.diff(today,'days',true);if(diff===0){to_display=_t('Today');}else{if(diff<0){if(diff===-1){to_display=_t('Yesterday');}else{to_display=_.str.sprintf(_t('%d days overdue'),Math.abs(diff));}}else{if(diff===1){to_display=_t('Tomorrow');}else{to_display=_.str.sprintf(_t('Due in %d days'),Math.abs(diff));}}}
activity.label_delay=to_display;});var open_activities=_.filter(activities,function(activity){return activity.done!==true;});return open_activities;};mail_activity.include({_render:function(){_.each(this._activities,function(activity){var note=mailUtils.parseAndTransform(activity.note||'',mailUtils.inline);var is_blank=(/^\s*$/).test(note);if(is_blank){activity.note='';}else{activity.note=mailUtils.parseAndTransform(activity.note,mailUtils.addLink);}});var activities=setDelayLabel(this._activities);if(activities.length){var nbActivities=_.countBy(activities,'state');this.$el.html(QWeb.render('mail.activity_items',{activities:activities,nbPlannedActivities:nbActivities.planned,nbTodayActivities:nbActivities.today,nbOverdueActivities:nbActivities.overdue,dateFormat:time.getLangDateFormat(),datetimeFormat:time.getLangDatetimeFormat(),}));}else{this.$el.empty();}},});});;

/* /mail_activity_board/static/src/js/override_chatter.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Chatter.activity',function(require){"use strict";var chatter=require('mail.Chatter');chatter.include({events:_.extend({},chatter.prototype.events,{'click .o_chatter_button_list_activity':'_onListActivity',}),_onListActivity:function(){this._rpc({model:this.record.model,method:'redirect_to_activities',args:[[]],kwargs:{'id':this.record.res_id,'model':this.record.model,},context:this.record.getContext(),}).then($.proxy(this,"do_action"));},});});;

/* /account_batch_payment/static/src/js/account_batch_payment_reconciliation.js defined in bundle 'web.assets_backend' */
odoo.define('account_batch_payment.reconciliation',function(require){"use strict";var ReconciliationClientAction=require('account.ReconciliationClientAction');var ReconciliationModel=require('account.ReconciliationModel');var ReconciliationRenderer=require('account.ReconciliationRenderer');var core=require('web.core');var _t=core._t;var QWeb=core.qweb;var Action={custom_events:_.defaults({select_batch:'_onAction',},ReconciliationClientAction.StatementAction.prototype.custom_events),};ReconciliationClientAction.StatementAction.include(Action);ReconciliationClientAction.ManualAction.include(Action);var Model={init:function(){this._super.apply(this,arguments);this.batchPayments=[];this.modes=[...this.modes,'batch'];this.filter_batch="";},load:function(context){var self=this;return this._super(context).then(function(){self.batchPayments=self.statement&&self.statement.batch_payments||[];});},selectBatch:function(handle,batchId){return this._rpc({model:'account.reconciliation.widget',method:'get_move_lines_by_batch_payment',args:[this.getLine(handle).id,batchId],}).then(this._addSelectedBatchLines.bind(this,handle,batchId));},validate:function(handle){var self=this;return this._super(handle).then(function(data){if(_.any(data.handles,function(handle){return!!self.getLine(handle).batch_payment_id;})){return self._updateBatchPayments().then(function(){return data;});}
return data;});},_computeLine:function(line){if(line.st_line.partner_id){line.relevant_payments=[];}else{line.relevant_payments=this.batchPayments;}
return this._super.apply(this,arguments);},_addSelectedBatchLines:function(handle,batchId,batchLines){var line=this.getLine(handle);var selectedIds=[];for(var hand in this.lines){if(handle===hand){continue;}
var rec=this.lines[hand].reconciliation_proposition||[];for(var k in rec){if(!isNaN(rec[k].id)){selectedIds.push(rec[k].id);}}}
selectedIds=_.filter(batchLines,function(batch_line){return selectedIds.indexOf(batch_line.id)!==-1;});if(selectedIds.length>0){var message=_t("Some journal items from the selected batch payment are already selected in another reconciliation : ");message+=_.map(selectedIds,function(l){return l.name;}).join(', ');this.do_warn(_t("Incorrect Operation"),message,true);return;}
if(line.reconciliation_proposition){batchLines=_.filter(batchLines,function(batch_line){return!_.any(line.reconciliation_proposition,function(prop){return prop.id===batch_line.id;});});}
this._formatLineProposition(line,batchLines);for(var k in batchLines){this._addProposition(line,batchLines[k]);line['mv_lines_match_rp']=_.filter(line['mv_lines_match_rp'],l=>l['id']!=batchLines[k].id);}
line.batch_payment_id=batchId;return Promise.all([this._computeLine(line)]);},_updateBatchPayments:function(statement_ids){var self=this;return this._rpc({model:'account.reconciliation.widget',method:'get_batch_payments_data',args:[statement_ids],}).then(function(data){self.batchPayments=data;});},changeFilter:function(handle,filter){var line=this.getLine(handle);if(line.mode=='batch'){this.filter_batch=filter;return Promise.resolve();}else{return this._super.apply(this,arguments);}},_getAvailableModes:function(handle){var line=this.getLine(handle);var modes=this._super(handle);if(line.batchPayments&&line.batchPayments.length){modes.push('batch')}
return modes;},};ReconciliationModel.StatementModel.include(Model);ReconciliationModel.ManualModel.include(Model);var Renderer={events:_.defaults({"click .batch_payment":"_onBatch",},ReconciliationRenderer.LineRenderer.prototype.events),update:function(state){this._super(state);this.$(".o_notebook .tab-content .batch_payments_selector").html("");if(state.relevant_payments.length){this.$(".o_notebook .tab-content .batch_payments_selector").append(QWeb.render("batch.payment.tab",{payments:state.relevant_payments.filter(pay=>pay.name.toUpperCase().includes(this.model.filter_batch.toUpperCase())||pay.date.toUpperCase().includes(this.model.filter_batch.toUpperCase())),filter:this.model.filter_batch,}));}
this.$(".o_notebook .batch_payments_selector").toggleClass('d-none',state.relevant_payments.length==0);},_onBatch:function(e){e.preventDefault();var batchId=parseInt(e.currentTarget.dataset.batch_payment_id);this.trigger_up('select_batch',{'data':batchId});},};ReconciliationRenderer.LineRenderer.include(Renderer);ReconciliationRenderer.ManualLineRenderer.include(Renderer);});;

/* /web_action_conditionable/static/src/js/field_one2many.js defined in bundle 'web.assets_backend' */
odoo.define("web.web_action_conditionable",function(require){"use strict";var FieldOne2Many=require("web.relational_fields").FieldOne2Many;FieldOne2Many.include({init:function(){var self=this;try{return this._super.apply(this,arguments);}catch(error){var arch=this.view&&this.view.arch;if(arch){["create","delete"].forEach(function(item){if(!_.has(arch.attrs,item)){return;}
var expr=arch.attrs[item];try{self.activeActions[item]=py.evaluate(py.parse(py.tokenize(expr)),self.recordData).toJSON();}catch(ignored){}});this.editable=arch.attrs.editable;}
if(this.attrs.columnInvisibleFields){this._processColumnInvisibleFields();}}},});});;

/* /approvals/static/src/js/activity.js defined in bundle 'web.assets_backend' */
odoo.define('approvals.Activity',function(require){"use strict";var field_registry=require('web.field_registry');require('mail.Activity');var KanbanActivity=field_registry.get('kanban_activity');var MailActivity=field_registry.get('mail_activity');function applyInclude(Activity){Activity.include({events:_.extend({},Activity.prototype.events,{'click .o_activity_action_approve':'_onValidateApproval','click .o_activity_action_refuse':'_onRefuseApproval',}),_onValidateApproval:function(event){var self=this;var approverID=$(event.currentTarget).data('approver-id');this._rpc({model:'approval.approver',method:'action_approve',args:[[approverID]],}).then(function(result){self.trigger_up('reload');});},_onRefuseApproval:function(event){var self=this;var approverID=$(event.currentTarget).data('approver-id');this._rpc({model:'approval.approver',method:'action_refuse',args:[[approverID]],}).then(function(result){self.trigger_up('reload');});},});}
applyInclude(KanbanActivity);applyInclude(MailActivity);});;

/* /sign/static/src/js/sign_backend.js defined in bundle 'web.assets_backend' */
odoo.define('sign.views_custo',function(require){'use strict';var config=require('web.config');var core=require('web.core');var KanbanController=require("web.KanbanController");var KanbanColumn=require("web.KanbanColumn");var KanbanRecord=require("web.KanbanRecord");var ListController=require("web.ListController");var utils=require('web.utils');var _t=core._t;KanbanController.include(_make_custo("button.o-kanban-button-new"));ListController.include(_make_custo(".o_list_button_add"));KanbanColumn.include({init:function(){this._super.apply(this,arguments);if(this.modelName==="sign.request"){this.draggable=false;}},});KanbanRecord.include({_openRecord:function(){var self=this;if(this.modelName==='sign.template'&&this.$el.parents('.o_kanban_dashboard').length){if(config.device.isMobile){return;}
self._rpc({model:'sign.template',method:'go_to_custom_template',args:[self.recordData.id],}).then(function(action){self.do_action(action);});}else if(this.modelName==='sign.request'&&this.$el.parents('.o_sign_request_kanban').length){this._rpc({model:'sign.request',method:'go_to_document',args:[self.recordData.id],}).then(function(action){self.do_action(action);});}else{this._super.apply(this,arguments);}},async _render(){await this._super(...arguments);if(config.device.isMobile&&(this.modelName==="sign.template"||this.modelName==="sign.request")){this.$('.o_kanban_record_bottom .oe_kanban_bottom_left button:not(.o_kanban_sign_directly)').attr('data-mobile','{"fullscreen": true}');}}});function _make_custo(selector_button){return{renderButtons:function(){this._super.apply(this,arguments);if(!this.$buttons){return;}
if(this.modelName==="sign.template"){this._sign_upload_file_button();this.$buttons.find('button.o_button_import').hide();}else if(this.modelName==="sign.request"){if(this.$buttons){this._sign_create_request_button();this.$buttons.find('button.o_button_import').hide();}}},_sign_upload_file_button:function(){var self=this;this.$buttons.find(selector_button).text(_t("Send a Request")).off("click").on("click",function(e){e.preventDefault();e.stopImmediatePropagation();_sign_upload_file.call(self,true,false,'sign_send_request');});if(config.device.isMobile){this.$buttons.find(selector_button).hide();return;}
this.$buttons.find(selector_button).after($('<button class="btn btn-primary o-kanban-button-new o-direct ml8" type="button">'+_t('Sign Now')+'</button>').off('click').on('click',function(e){e.preventDefault();e.stopImmediatePropagation();_sign_upload_file.call(self,true,true,'sign_sign_now');}));this.$buttons.find(selector_button+'.o-direct').after($('<button class="btn btn-link o-kanban-button-new ml8" type="button">'+_t('UPLOAD A PDF TEMPLATE')+'</button>').off('click').on('click',function(e){e.preventDefault();e.stopImmediatePropagation();_sign_upload_file.call(self,false,false,'sign_template_edit');}));},_sign_create_request_button:function(){var self=this;this.$buttons.find(selector_button).text(_t("Request a Signature")).off("click").on("click",function(e){e.preventDefault();e.stopImmediatePropagation();_sign_create_request.call(self);});},};}
function _sign_upload_file(inactive,sign_directly_without_mail,sign_edit_context){var self=this;var sign_directly_without_mail=sign_directly_without_mail||false;var $upload_input=$('<input type="file" name="files[]" accept="application/pdf, application/x-pdf, application/vnd.cups-pdf"/>');$upload_input.on('change',function(e){var f=e.target.files[0];utils.getDataURLFromFile(f).then(function(result){var args;if(inactive){args=[f.name,result,false];}else{args=[f.name,result];}
self._rpc({model:'sign.template',method:'upload_template',args:args,}).then(function(data){self.do_action({type:"ir.actions.client",tag:'sign.Template',name:_('Template ')+' "'+f.name+'"',context:{sign_edit_call:sign_edit_context,id:data.template,sign_directly_without_mail:sign_directly_without_mail,},});}).then(function(){$upload_input.removeAttr('disabled');$upload_input.val("");}).guardedCatch(function(){$upload_input.removeAttr('disabled');$upload_input.val("");});});});$upload_input.click();}
function _sign_create_request(){this.do_action("sign.sign_template_action");}});odoo.define('sign.template',function(require){'use strict';var AbstractAction=require('web.AbstractAction');var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var framework=require('web.framework');var session=require('web.session');var Widget=require('web.Widget');var PDFIframe=require('sign.PDFIframe');var sign_utils=require('sign.utils');var _t=core._t;var SignItemCustomPopover=Widget.extend({template:'sign.sign_item_custom_popover',events:{'click .o_sign_delete_field_button':function(e){this.$currentTarget.popover("hide");this.$currentTarget.trigger('itemDelete');},'click .o_sign_validate_field_button':function(e){this.hide();}},init:function(parent,parties,options,select_options){options=options||{};this._super(parent,options);this.parties=parties;this.select_options=select_options;this.debug=config.isDebug();},start:function(){this.$responsibleSelect=this.$('.o_sign_responsible_select');this.$optionsSelect=this.$('.o_sign_options_select');sign_utils.resetResponsibleSelectConfiguration();sign_utils.resetOptionsSelectConfiguration();var self=this;return this._super().then(function(){sign_utils.setAsResponsibleSelect(self.$responsibleSelect.find('select'),self.$currentTarget.data('responsible'),self.parties);sign_utils.setAsOptionsSelect(self.$optionsSelect.find('input'),self.$currentTarget.data('itemId'),self.$currentTarget.data('option_ids'),self.select_options);self.$('input[type="checkbox"]').prop('checked',self.$currentTarget.data('required'));self.$('#o_sign_name').val(self.$currentTarget.data('name')||"");self.title=self.$currentTarget.prop('field-name');if(self.$currentTarget.prop('field-type')!=='selection'){self.$('.o_sign_options_group').hide();}});},create:function($targetEl){var self=this;this.$currentTarget=$targetEl;this.$elPopover=$("<div class='o_sign_item_popover'/>");var buttonClose='<button class="o_sign_close_button">&times;</button>';this.appendTo(this.$elPopover).then(function(){var options={title:self.title+buttonClose,content:function(){return self.$el;},html:true,placement:'right',trigger:'focus',container:'.o_sign_template',};self.$currentTarget.popover(options).one('inserted.bs.popover',function(e){$('.popover').addClass('o_popover_offset');$('.o_sign_close_button').on('click',function(e){self.$currentTarget.popover("hide");});});self.$currentTarget.popover("toggle");if(self.$currentTarget.prop('field-type')==='checkbox'){$('.o_popover_placeholder').text('');}});},hide:function(){var self=this;var resp=parseInt(this.$responsibleSelect.find('select').val());var selected_options=this.$optionsSelect.find('#o_sign_options_select_input').data('item_options');var required=this.$('input[type="checkbox"]').prop('checked');var name=this.$('#o_sign_name').val();this.getParent().currentRole=resp;if(!name){name=self.$currentTarget.prop('field-name');}
if(self.$currentTarget.prop('field-type')!="checkbox"){this.$currentTarget.find(".o_placeholder").text(name);}
this.$currentTarget.data({responsible:resp,required:required,name:name,option_ids:selected_options}).trigger('itemChange');this.$currentTarget.popover("hide");}});var InitialAllPagesDialog=Dialog.extend({template:'sign.initial_all_pages_dialog',init:function(parent,parties,options){options=options||{};options.title=options.title||_t("Add Initials");options.size=options.size||"medium";if(!options.buttons){options.buttons=[];options.buttons.push({text:_t('Add once'),classes:'btn-primary',close:true,click:function(e){this.updateTargetResponsible();this.$currentTarget.trigger('itemChange');}});options.buttons.push({text:_t('Add on all pages'),classes:'btn-secondary',close:true,click:function(e){this.updateTargetResponsible();this.$currentTarget.draggable('destroy').resizable('destroy');this.$currentTarget.trigger('itemClone');}});}
this._super(parent,options);this.parties=parties;},start:function(){this.$responsibleSelect=this.$('.o_sign_responsible_select_initials');var self=this;return this._super.apply(this,arguments).then(function(){sign_utils.setAsResponsibleSelect(self.$responsibleSelect.find('select'),self.getParent().currentRole,self.parties);});},open:function($signatureItem){this.$currentTarget=$signatureItem;this._super.apply(this,arguments);},updateTargetResponsible:function(){var resp=parseInt(this.$responsibleSelect.find('select').val());this.getParent().currentRole=resp;this.$currentTarget.data('responsible',resp);},});var EditablePDFIframe=PDFIframe.extend({init:function(){this._super.apply(this,arguments);this.customPopovers={};this.events=_.extend(this.events||{},{'itemChange .o_sign_sign_item':function(e){this.updateSignItem($(e.target));this.$iframe.trigger('templateChange');},'itemDelete .o_sign_sign_item':function(e){this.deleteSignItem($(e.target));this.$iframe.trigger('templateChange');},'itemClone .o_sign_sign_item':function(e){var $target=$(e.target);this.updateSignItem($target);page_loop:for(var i=1;i<=this.nbPages;i++){for(var j=0;j<this.configuration[i].length;j++){if(this.types[this.configuration[i][j].data('type')].item_type==='signature'){continue page_loop;}}
var $newElem=$target.clone(true);this.enableCustom($newElem);this.configuration[i].push($newElem);}
this.deleteSignItem($target);this.refreshSignItems();this.$iframe.trigger('templateChange');},});},doPDFPostLoad:function(){var self=this;this.fullyLoaded.then(function(){if(self.editMode){if(self.$iframe.prop('disabled')){var $div=$('<div/>').css({position:"absolute",top:0,left:0,width:"100%",height:"100%",'z-index':110,opacity:0.75});self.$('#viewer').css('position','relative').prepend($div);$div.on('click mousedown mouseup mouveover mouseout',function(e){return false;});}else{self.$hBarTop=$('<div/>');self.$hBarBottom=$('<div/>');self.$hBarTop.add(self.$hBarBottom).css({position:'absolute',"border-top":"1px dashed orange",width:"100%",height:0,"z-index":103,left:0});self.$vBarLeft=$('<div/>');self.$vBarRight=$('<div/>');self.$vBarLeft.add(self.$vBarRight).css({position:'absolute',"border-left":"1px dashed orange",width:0,height:"10000px","z-index":103,top:0});var typesArr=_.toArray(self.types);var $fieldTypeButtons=$(core.qweb.render('sign.type_buttons',{sign_item_types:typesArr}));self.$fieldTypeToolbar=$('<div/>').addClass('o_sign_field_type_toolbar');self.$fieldTypeToolbar.prependTo(self.$('#viewerContainer'));$fieldTypeButtons.appendTo(self.$fieldTypeToolbar).draggable({cancel:false,helper:function(e){var type=self.types[$(this).data('item-type-id')];var $signatureItem=self.createSignItem(type,true,self.currentRole,0,0,type.default_width,type.default_height,'',[]);if(!e.ctrlKey){self.$('.o_sign_sign_item').removeClass('ui-selected');}
$signatureItem.addClass('o_sign_sign_item_to_add ui-selected');self.$('.page').first().append($signatureItem);self.updateSignItem($signatureItem);$signatureItem.css('width',$signatureItem.css('width')).css('height',$signatureItem.css('height'));$signatureItem.detach();return $signatureItem;}});$fieldTypeButtons.each(function(i,el){self.enableCustomBar($(el));});self.$('.page').droppable({accept:'*',tolerance:'touch',drop:function(e,ui){if(!ui.helper.hasClass('o_sign_sign_item_to_add')){return true;}
var $parent=$(e.target);var pageNo=parseInt($parent.prop('id').substr('pageContainer'.length));ui.helper.removeClass('o_sign_sign_item_to_add');var $signatureItem=ui.helper.clone(true).removeClass().addClass('o_sign_sign_item o_sign_sign_item_required');var posX=(ui.offset.left-$parent.find('.textLayer').offset().left)/$parent.innerWidth();var posY=(ui.offset.top-$parent.find('.textLayer').offset().top)/$parent.innerHeight();$signatureItem.data({posx:posX,posy:posY});self.configuration[pageNo].push($signatureItem);self.refreshSignItems();self.updateSignItem($signatureItem);self.enableCustom($signatureItem);self.$iframe.trigger('templateChange');if(self.types[$signatureItem.data('type')].item_type==='initial'){(new InitialAllPagesDialog(self,self.parties)).open($signatureItem);}
return false;}});self.$('#viewer').selectable({appendTo:self.$('body'),filter:'.o_sign_sign_item',});$(document).add(self.$el).on('keyup',function(e){if(e.which!==46){return true;}
self.$('.ui-selected').each(function(i,el){self.deleteSignItem($(el));var popovers=window.document.querySelectorAll('[id^="popover"]');for(let i=0;i<popovers.length;i+=1){document.getElementById(popovers[i].id).remove();}});self.$iframe.trigger('templateChange');});}
self.$('.o_sign_sign_item').each(function(i,el){self.enableCustom($(el));});}});this._super.apply(this,arguments);},enableCustom:function($signatureItem){var self=this;$signatureItem.prop('field-type',this.types[$signatureItem.data('type')].item_type);$signatureItem.prop('field-name',this.types[$signatureItem.data('type')].name);var itemId=$signatureItem.data('itemId');var $configArea=$signatureItem.find('.o_sign_config_area');$configArea.find('.o_sign_item_display').off('mousedown').on('mousedown',function(e){e.stopPropagation();self.$('.ui-selected').removeClass('ui-selected');$signatureItem.addClass('ui-selected');_.each(_.keys(self.customPopovers),function(keyId){if(keyId!=itemId&&self.customPopovers[keyId]&&((keyId&&itemId)||(keyId!='undefined'&&!itemId))){self.customPopovers[keyId].$currentTarget.popover('hide');self.customPopovers[keyId]=false;}});if(self.customPopovers[itemId]){self.customPopovers[itemId].$currentTarget.popover('hide');self.customPopovers[itemId]=false;}else{self.customPopovers[itemId]=new SignItemCustomPopover(self,self.parties,{'field_name':$signatureItem[0]['field-name'],'field_type':$signatureItem[0]['field-type']},self.select_options);self.customPopovers[itemId].create($signatureItem);}});$configArea.find('.fa.fa-arrows').off('mouseup').on('mouseup',function(e){if(!e.ctrlKey){self.$('.o_sign_sign_item').filter(function(i){return(this!==$signatureItem[0]);}).removeClass('ui-selected');}
$signatureItem.toggleClass('ui-selected');});$signatureItem.draggable({containment:"parent",handle:".fa-arrows"}).resizable({containment:"parent"}).css('position','absolute');$signatureItem.off('dragstart resizestart').on('dragstart resizestart',function(e,ui){if(!e.ctrlKey){self.$('.o_sign_sign_item').removeClass('ui-selected');}
$signatureItem.addClass('ui-selected');});$signatureItem.off('dragstop').on('dragstop',function(e,ui){$signatureItem.data({posx:Math.round((ui.position.left/$signatureItem.parent().innerWidth())*1000)/1000,posy:Math.round((ui.position.top/$signatureItem.parent().innerHeight())*1000)/1000,});});$signatureItem.off('resizestop').on('resizestop',function(e,ui){$signatureItem.data({width:Math.round(ui.size.width/$signatureItem.parent().innerWidth()*1000)/1000,height:Math.round(ui.size.height/$signatureItem.parent().innerHeight()*1000)/1000,});});$signatureItem.on('dragstop resizestop',function(e,ui){self.updateSignItem($signatureItem);self.$iframe.trigger('templateChange');$signatureItem.removeClass('ui-selected');});this.enableCustomBar($signatureItem);},enableCustomBar:function($item){var self=this;$item.on('dragstart resizestart',function(e,ui){var $target=$(e.target);if(!$target.hasClass('ui-draggable')&&!$target.hasClass('ui-resizable')){return;}
start.call(self,ui.helper);});$item.find('.o_sign_config_area .fa.fa-arrows').on('mousedown',function(e){start.call(self,$item);process.call(self,$item,$item.position());});$item.on('drag resize',function(e,ui){var $target=$(e.target);if(!$target.hasClass('ui-draggable')&&!$target.hasClass('ui-resizable')){return;}
process.call(self,ui.helper,ui.position);});$item.on('dragstop resizestop',function(e,ui){end.call(self);});$item.find('.o_sign_config_area .fa.fa-arrows').on('mouseup',function(e){end.call(self);});function start($helper){this.$hBarTop.detach().insertAfter($helper).show();this.$hBarBottom.detach().insertAfter($helper).show();this.$vBarLeft.detach().insertAfter($helper).show();this.$vBarRight.detach().insertAfter($helper).show();}
function process($helper,position){this.$hBarTop.css('top',position.top);this.$hBarBottom.css('top',position.top+parseFloat($helper.css('height'))-1);this.$vBarLeft.css('left',position.left);this.$vBarRight.css('left',position.left+parseFloat($helper.css('width'))-1);}
function end(){this.$hBarTop.hide();this.$hBarBottom.hide();this.$vBarLeft.hide();this.$vBarRight.hide();}},updateSignItem:function($signatureItem){this._super.apply(this,arguments);if(this.editMode){var responsibleName=this.parties[$signatureItem.data('responsible')].name;$signatureItem.find('.o_sign_responsible_display').text(responsibleName).prop('title',responsibleName);var option_ids=$signatureItem.data('option_ids')||[];var $options_display=$signatureItem.find('.o_sign_select_options_display');this.display_select_options($options_display,this.select_options,option_ids);}},});var Template=AbstractAction.extend({hasControlPanel:true,events:{'click .fa-pencil':function(e){this.$templateNameInput.focus().select();},'input .o_sign_template_name_input':function(e){this.$templateNameInput.attr('size',this.$templateNameInput.val().length);},'change .o_sign_template_name_input':function(e){this.saveTemplate();if(this.$templateNameInput.val()===""){this.$templateNameInput.val(this.initialTemplateName);}},'keydown .o_sign_template_name_input':function(e){if(e.keyCode===13){this.$templateNameInput.blur();}},'templateChange iframe.o_sign_pdf_iframe':function(e){this.saveTemplate();},'click .o_sign_duplicate_sign_template':function(e){this.saveTemplate(true);},},go_back_to_kanban:function(){return this.do_action("sign.sign_template_action",{clear_breadcrumbs:true,});},init:function(parent,options){this._super.apply(this,arguments);if(options.context.id===undefined){return;}
this.templateID=options.context.id;this.rolesToChoose={};var self=this;var $closeButton=$('<button/>',{html:_t("Close"),type:"button"}).addClass('btn btn-secondary').on('click',function(){return self.do_action('sign.sign_template_action',{clear_breadcrumbs:true});});var $sendButton=$('<button/>',{html:_t("Send"),type:"button"}).addClass('btn btn-secondary').on('click',function(){self.do_action('sign.action_sign_send_request',{additional_context:{'active_id':self.templateID,'sign_directly_without_mail':false,},});});var $signNowButton=$('<button/>',{html:_t("Sign Now"),type:"button"}).addClass('btn btn-secondary').on('click',function(){self.do_action('sign.action_sign_send_request',{additional_context:{'active_id':self.templateID,'sign_directly_without_mail':true,},});});var $shareButton=$('<button/>',{html:_t("Share"),type:"button"}).addClass('btn btn-secondary').on('click',function(){self.do_action('sign.action_sign_template_share',{additional_context:{active_id:self.templateID,},});});if(!options.context.sign_edit_call||options.context.sign_edit_call==='sign_template_edit'){$closeButton.switchClass('btn-secondary','btn-primary');this.cp_content={$buttons:$closeButton.add($sendButton).add($signNowButton).add($shareButton)};}else if(options.context.sign_edit_call==='sign_sign_now'){$signNowButton.switchClass('btn-secondary','btn-primary');this.cp_content={$buttons:$signNowButton.add($sendButton).add($closeButton)};}else if(options.context.sign_edit_call==='sign_send_request'){$sendButton.switchClass('btn-secondary','btn-primary');this.cp_content={$buttons:$sendButton.add($signNowButton).add($closeButton)};}},willStart:function(){if(this.templateID===undefined){return this._super.apply(this,arguments);}
return Promise.all([this._super(),this.perform_rpc()]);},perform_rpc:function(){var self=this;var defTemplates=this._rpc({model:'sign.template',method:'read',args:[[this.templateID]],}).then(function prepare_template(template){template=template[0];self.sign_template=template;self.has_sign_requests=(template.sign_request_ids.length>0);var defSignItems=self._rpc({model:'sign.item',method:'search_read',args:[[['template_id','=',template.id]]],kwargs:{context:session.user_context},}).then(function(sign_items){self.sign_items=sign_items;return self._rpc({model:'sign.item.option',method:'search_read',args:[[],['id','value']],kwargs:{context:session.user_context},});});var defIrAttachments=self._rpc({model:'ir.attachment',method:'read',args:[[template.attachment_id[0]],['mimetype','name']],kwargs:{context:session.user_context},}).then(function(attachment){attachment=attachment[0];self.sign_template.attachment_id=attachment;self.isPDF=(attachment.mimetype.indexOf('pdf')>-1);});return Promise.all([defSignItems,defIrAttachments]);});var defSelectOptions=this._rpc({model:'sign.item.option',method:'search_read',args:[[]],kwargs:{context:session.user_context},}).then(function(options){self.sign_item_options=options;});var defParties=this._rpc({model:'sign.item.role',method:'search_read',kwargs:{context:session.user_context},}).then(function(parties){self.sign_item_parties=parties;});var defItemTypes=this._rpc({model:'sign.item.type',method:'search_read',kwargs:{context:session.user_context},}).then(function(types){self.sign_item_types=types;});return Promise.all([defTemplates,defParties,defItemTypes,defSelectOptions]);},start:function(){if(this.templateID===undefined){return this.go_back_to_kanban();}
this.initialize_content();if(this.$('iframe').length){core.bus.on('DOM_updated',this,init_iframe);}
this.$('.o_content').addClass('o_sign_template');return this._super();function init_iframe(){if(this.$el.parents('html').length&&!this.$el.parents('html').find('.modal-dialog').length){var self=this;framework.blockUI({overlayCSS:{opacity:0},blockMsgClass:'o_hidden'});this.iframeWidget=new EditablePDFIframe(this,'/web/content/'+this.sign_template.attachment_id.id,true,{parties:this.sign_item_parties,types:this.sign_item_types,signatureItems:this.sign_items,select_options:this.sign_item_options,});return this.iframeWidget.attachTo(this.$('iframe')).then(function(){framework.unblockUI();self.iframeWidget.currentRole=self.sign_item_parties[0].id;});}}},initialize_content:function(){this.$('.o_content').append(core.qweb.render('sign.template',{widget:this}));this.$('iframe,.o_sign_template_name_input').prop('disabled',this.has_sign_requests);this.$templateNameInput=this.$('.o_sign_template_name_input').first();this.$templateNameInput.trigger('input');this.initialTemplateName=this.$templateNameInput.val();this.refresh_cp();},do_show:function(){this._super();var self=this;return this.perform_rpc().then(function(){if(self.iframeWidget){self.iframeWidget.destroy();self.iframeWidget=undefined;}
self.$('iframe').remove();self.initialize_content();});},refresh_cp:function(){this.updateControlPanel({cp_content:this.cp_content,});},prepareTemplateData:function(){this.rolesToChoose={};var data={},newId=0;var configuration=(this.iframeWidget)?this.iframeWidget.configuration:{};for(var page in configuration){for(var i=0;i<configuration[page].length;i++){var id=configuration[page][i].data('item-id')||(newId--);var resp=configuration[page][i].data('responsible');data[id]={'type_id':configuration[page][i].data('type'),'required':configuration[page][i].data('required'),'name':configuration[page][i].data('name'),'option_ids':configuration[page][i].data('option_ids'),'responsible_id':resp,'page':page,'posX':configuration[page][i].data('posx'),'posY':configuration[page][i].data('posy'),'width':configuration[page][i].data('width'),'height':configuration[page][i].data('height'),};this.rolesToChoose[resp]=this.iframeWidget.parties[resp];}}
return data;},saveTemplate:function(duplicate){duplicate=(duplicate===undefined)?false:duplicate;var data=this.prepareTemplateData();var $majInfo=this.$('.o_sign_template_saved_info').first();var self=this;this._rpc({model:'sign.template',method:'update_from_pdfviewer',args:[this.templateID,!!duplicate,data,this.$templateNameInput.val()||this.initialTemplateName],}).then(function(templateID){if(!templateID){Dialog.alert(self,_t('Somebody is already filling a document which uses this template'),{confirm_callback:function(){self.go_back_to_kanban();},});}
if(duplicate){self.do_action({type:"ir.actions.client",tag:'sign.Template',name:_t("Duplicated Template"),context:{id:templateID,},});}else{$majInfo.stop().css('opacity',1).animate({'opacity':0},1500);}});},});core.action_registry.add('sign.Template',Template);});odoo.define('sign.DocumentBackend',function(require){'use strict';var AbstractAction=require('web.AbstractAction');var core=require('web.core');var Document=require('sign.Document');var framework=require('web.framework');var _t=core._t;var DocumentBackend=AbstractAction.extend({hasControlPanel:true,go_back_to_kanban:function(){return this.do_action("sign.sign_request_action",{clear_breadcrumbs:true,});},init:function(parent,action){this._super.apply(this,arguments);var context=action.context;if(context.id===undefined){return;}
this.documentID=context.id;this.token=context.token;this.create_uid=context.create_uid;this.state=context.state;this.current_name=context.current_signor_name;this.token_list=context.token_list;this.name_list=context.name_list;this.$downloadButton=$('<a/>',{html:_t("Download Document")}).addClass('btn btn-primary o_hidden');this.$downloadLogButton=$('<a/>',{html:_t("Activity Logs")}).addClass('btn btn-secondary o_hidden');this.cp_content={$buttons:this.$downloadButton.add(this.$downloadLogButton)};},start:function(){var self=this;if(this.documentID===undefined){return this.go_back_to_kanban();}
var def=this._rpc({route:'/sign/get_document/'+this.documentID+'/'+this.token,params:{message:this.message}}).then(function(html){self.$('.o_content').append($(html.trim()));self.$('.o_content').addClass('o_sign_document');var $cols=self.$('.col-lg-4').toggleClass('col-lg-6 col-lg-4');var $buttonsContainer=$cols.first().remove();var url=$buttonsContainer.find('.o_sign_download_document_button').attr('href');self.$downloadButton.attr('href',url).toggleClass('o_hidden',!url);var logUrl=$buttonsContainer.find('.o_sign_download_log_button').attr('href');self.$downloadLogButton.attr('href',logUrl).toggleClass('o_hidden',!logUrl);var init_page=function(){if(self.$el.parents('html').length){self.refresh_cp();framework.blockUI({overlayCSS:{opacity:0},blockMsgClass:'o_hidden'});var def;if(!self.documentPage){self.documentPage=new(self.get_document_class())(self);def=self.documentPage.attachTo(self.$el);}else{def=self.documentPage.initialize_iframe();}
def.then(function(){framework.unblockUI();});}};core.bus.on('DOM_updated',null,init_page);});return Promise.all([this._super(),def]);},get_document_class:function(){return Document;},refresh_cp:function(){this.updateControlPanel({cp_content:this.cp_content,});},});return DocumentBackend;});odoo.define('sign.document_edition',function(require){'use strict';var core=require('web.core');var session=require('web.session');var DocumentBackend=require('sign.DocumentBackend');var _t=core._t;var EditableDocumentBackend=DocumentBackend.extend({events:{'click .o_sign_resend_access_button':function(e){var $envelope=$(e.target);this._rpc({model:'sign.request.item',method:'resend_access',args:[parseInt($envelope.parent('.o_sign_signer_status').data('id'))],context:session.user_context,}).then(function(){$envelope.html(_t("Resent !"));});},},init:function(parent,action,options){this._super.apply(this,arguments);var self=this;this.is_author=(this.create_uid===session.uid);this.is_sent=(this.state==='sent');if(action&&action.context&&action.context.sign_token){var $signButton=$('<button/>',{html:_t("Sign Document"),type:"button",'class':'btn btn-primary'});$signButton.on('click',function(){self.do_action({type:"ir.actions.client",tag:'sign.SignableDocument',name:_t('Sign'),},{additional_context:_.extend({},action.context,{token:action.context.sign_token,}),});});this.cp_content.$buttons=$signButton.add(this.cp_content.$buttons);}},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){if(self.is_author&&self.is_sent){self.$('.o_sign_signer_status').each(function(i,el){$(el).append($('<button/>',{type:'button',title:_t("Resend the invitation"),text:_t('Resend'),class:'o_sign_resend_access_button btn btn-link ml8',style:'vertical-align: baseline;',}));});}});},});core.action_registry.add('sign.Document',EditableDocumentBackend);});odoo.define('sign.document_signing_backend',function(require){'use strict';var core=require('web.core');var DocumentBackend=require('sign.DocumentBackend');var document_signing=require('sign.document_signing');var _t=core._t;var NoPubThankYouDialog=document_signing.ThankYouDialog.extend({template:"sign.no_pub_thank_you_dialog",init:function(parent,RedirectURL,RedirectURLText,requestID,options){options=(options||{});if(!options.buttons){options.buttons=[{text:_t("Ok"),close:true}];}
this._super(parent,RedirectURL,RedirectURLText,requestID,options);},on_closed:function(){var self=this;self._rpc({model:'sign.request',method:'go_to_document',args:[self.requestID],}).then(function(action){self.do_action(action);self.destroy();});},});var SignableDocument2=document_signing.SignableDocument.extend({get_thankyoudialog_class:function(){return NoPubThankYouDialog;},});var SignableDocumentBackend=DocumentBackend.extend({get_document_class:function(){return SignableDocument2;},});core.action_registry.add('sign.SignableDocument',SignableDocumentBackend);});;

/* /stock_barcodes/static/src/js/stock_barcodes.js defined in bundle 'web.assets_backend' */
odoo.define("stock_barcodes.FormController",function(require){"use strict";var FormController=require("web.FormController");FormController.include({_barcodeScanned:function(barcode,target){var self=this;this._super(barcode,target).then(function(){var manual_entry_mode=self.$("div[name='manual_entry'] input").val();if(manual_entry_mode){var packaging=self.$("div[name='packaging_id'] input").val();if(packaging){self.$("input[name='packaging_qty']").focus();}else{self.$("input[name='product_qty']").focus();}}});},renderButtons:function($node){this._super($node);if(this.modelName.includes("wiz.stock.barcodes.read.")){this.$buttons.find(".o_form_buttons_edit").css({display:"none"});}},canBeDiscarded:function(recordID){if(!this.modelName.includes("wiz.stock.barcodes.read.")){return this._super(recordID);}
return Promise.resolve(false);},});});;

/* /stock_barcodes/static/src/js/basic_fields.js defined in bundle 'web.assets_backend' */
odoo.define("stock_barcodes.FieldFloatNumericMode",function(require){"use strict";var basic_fields=require("web.basic_fields");var field_registry=require("web.field_registry");var FieldFloatNumericMode=basic_fields.FieldFloat.extend({events:_.extend({},basic_fields.FieldFloat.prototype.events,{focusin:"_onFocusIn",}),_onFocusIn:function(){this.$input.select();},_prepareInput:function($input){var $input_numeric=this._super($input);$input_numeric.attr({inputmode:"numeric"});return $input_numeric;},});var FieldBarcodeBooleanToggle=basic_fields.BooleanToggle.extend({_onClick:function(event){this._super(event);$(this.el).find("input").blur();},});field_registry.add("FieldFloatNumericMode",FieldFloatNumericMode);field_registry.add("barcode_boolean_toggle",FieldBarcodeBooleanToggle);return{FieldFloatNumericMode:FieldFloatNumericMode,FieldBarcodeBooleanToggle:FieldBarcodeBooleanToggle,};});;

/* /helpdesk/static/src/js/helpdesk_dashboard.js defined in bundle 'web.assets_backend' */
odoo.define('helpdesk.dashboard',function(require){"use strict";var core=require('web.core');var KanbanController=require('web.KanbanController');var KanbanModel=require('web.KanbanModel');var KanbanRenderer=require('web.KanbanRenderer');var KanbanView=require('web.KanbanView');var session=require('web.session');var view_registry=require('web.view_registry');var QWeb=core.qweb;var _t=core._t;var _lt=core._lt;var HelpdeskDashboardRenderer=KanbanRenderer.extend({_notifyTargetChange:function(target_name,value){this.trigger_up('dashboard_edit_target',{target_name:target_name,target_value:value,});},_render:function(){var self=this;return this._super.apply(this,arguments).then(function(){var values=self.state.dashboardValues;var helpdesk_dashboard=QWeb.render('helpdesk.HelpdeskDashboard',{widget:self,show_demo:values.show_demo,rating_enable:values.rating_enable,success_rate_enable:values.success_rate_enable,values:values,});if(!self.$el.parent('.o_kanban_view_wrapper').length){self.$el.wrap('<div class="o_kanban_view_wrapper d-flex flex-column align-items-start"></div>');}
self.$el.parent().find(".o_helpdesk_dashboard").remove();self.$el.before(helpdesk_dashboard);self.$el.parent().find('.o_dashboard_action').on('click',self,self._onDashboardActionClicked.bind(self));self.$el.parent().find('.o_target_to_set').on('click',self,self._onDashboardTargetClicked.bind(self));});},_onDashboardActionClicked:function(e){e.preventDefault();var $action=$(e.currentTarget);this.trigger_up('dashboard_open_action',{action_name:$action.attr('name'),});},_onDashboardTargetClicked:function(e){var self=this;var $target=$(e.currentTarget);var target_name=$target.attr('name');var target_value=$target.attr('value');var $input=$('<input/>',{type:"text",name:target_name});if(target_value){$input.attr('value',target_value);}
$input.on('keyup input',function(e){if(e.which===$.ui.keyCode.ENTER){self._notifyTargetChange(target_name,$input.val());}});$input.on('blur',function(){self._notifyTargetChange(target_name,$input.val());});$input.replaceAll($target).focus().select();},});var HelpdeskDashboardModel=KanbanModel.extend({init:function(){this.dashboardValues={};this._super.apply(this,arguments);},get:function(localID){var result=this._super.apply(this,arguments);if(_.isObject(result)){result.dashboardValues=this.dashboardValues[localID];}
return result;},load:function(){return this._loadDashboard(this._super.apply(this,arguments));},reload:function(){return this._loadDashboard(this._super.apply(this,arguments));},_loadDashboard:function(super_def){var self=this;var dashboard_def=this._rpc({model:'helpdesk.team',method:'retrieve_dashboard',});return Promise.all([super_def,dashboard_def]).then(function(results){var id=results[0];var dashboardValues=results[1];self.dashboardValues[id]=dashboardValues;return id;});},});var HelpdeskDashboardController=KanbanController.extend({custom_events:_.extend({},KanbanController.prototype.custom_events,{dashboard_open_action:'_onDashboardOpenAction',dashboard_edit_target:'_onDashboardEditTarget',}),_onDashboardEditTarget:function(e){var target_name=e.data.target_name;var target_value=e.data.target_value;if(isNaN(target_value)){this.do_warn(_t("Wrong value entered!"),_t("Only Integer Value should be valid."));}else{var values={};values[target_name]=parseInt(target_value);this._rpc({model:'res.users',method:'write',args:[[session.uid],values],}).then(this.reload.bind(this));}},_onDashboardOpenAction:function(e){var self=this;var action_name=e.data.action_name;if(_.contains(['action_view_rating_today','action_view_rating_7days'],action_name)){return this._rpc({model:this.modelName,method:action_name}).then(function(data){if(data){return self.do_action(data);}});}
return this.do_action(action_name);},});var HelpdeskDashboardView=KanbanView.extend({config:_.extend({},KanbanView.prototype.config,{Model:HelpdeskDashboardModel,Renderer:HelpdeskDashboardRenderer,Controller:HelpdeskDashboardController,}),display_name:_lt('Dashboard'),icon:'fa-dashboard',searchview_hidden:true,});view_registry.add('helpdesk_dashboard',HelpdeskDashboardView);return{Model:HelpdeskDashboardModel,Renderer:HelpdeskDashboardRenderer,Controller:HelpdeskDashboardController,};});;

/* /helpdesk/static/src/js/tours/helpdesk.js defined in bundle 'web.assets_backend' */
odoo.define('helpdesk.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('helpdesk_tour',{url:"/web",},[{trigger:'.o_app[data-menu-xmlid="helpdesk.menu_helpdesk_root"]',content:_t('Want to <b>boost your customer satisfaction</b>?<br/><i>Click Helpdesk to start.</i>'),position:'bottom',},{trigger:'.oe_kanban_action_button',extra_trigger:'.o_kanban_primary_left',content:_t('Click here to view this team\'s tickets.'),position:'bottom',width:200,},{trigger:'.o-kanban-button-new',extra_trigger:'.o_kanban_helpdesk_ticket',content:_t('Let\'s create your first ticket.'),position:'bottom',width:200,},{trigger:'input.field_name',extra_trigger:'.o_form_editable',content:_t('Enter a subject or title for this ticket.<br/><i>(e.g. Problem with installation, Wrong order, Can\'t understand bill, etc.)</i>'),position:'right',},{trigger:'.o_field_widget.field_partner_id',extra_trigger:'.o_form_editable',content:_t('Enter the customer. Feel free to create it on the fly.'),position:'top',},{trigger:'.o_field_widget.field_user_id',extra_trigger:'.o_form_editable',content:_t('Assign the ticket to someone.'),position:'right',},{trigger:'.o_form_button_save',content:_t('Save this ticket and the modifications you\'ve made to it.'),position:'bottom',},{trigger:'.o_back_button',extra_trigger:'.o_form_view.o_form_readonly',content:_t('Use the breadcrumbs to go back to the Kanban view.'),position:'bottom',},{trigger:'.o_kanban_record',content:_t('Click these cards to open their form view, or <b>drag &amp; drop</b> them through the different stages of this team.'),position:'right',run:"drag_and_drop .o_kanban_group:eq(2) ",},{trigger:'.o_priority',extra_trigger:'.o_kanban_record',content:_t('<b>Stars</b> mark the <b>ticket priority</b>. You can change it directly from here!'),position:'bottom',run:"drag_and_drop .o_kanban_group:eq(2) ",},{trigger:".o_column_quick_create .o_quick_create_folded",content:_t('Add columns to configure <b>stages for your tickets</b>.<br/><i>e.g. Awaiting Customer Feedback, Customer Followup, ...</i>'),position:'right',}]);});;

/* /barcodes_search/static/src/js/barcodes_search.js defined in bundle 'web.assets_backend' */
odoo.define('barcodes_search.systray',function(require){"use strict";var SystrayMenu=require('web.SystrayMenu');var Widget=require('web.Widget');var BarcodeSearchItem=Widget.extend({template:'barcodes_search.BarcodeSearchItem',events:{"click":"onClick",},onClick:function(event){event.preventDefault();return this.do_action('barcodes_search.action_barcode_search_form');},});SystrayMenu.Items.push(BarcodeSearchItem);});;

/* /azk_stock_forecast/static/js/forecast_report_list.js defined in bundle 'web.assets_backend' */
odoo.define('azk_stock_forecast.ForecastReportListView',function(require){"use strict";var ListView=require('web.ListView');var ForecastReportListController=require('azk_stock_forecast.ForecastReportListController');var viewRegistry=require('web.view_registry');var ForecastReportListView=ListView.extend({config:_.extend({},ListView.prototype.config,{Controller:ForecastReportListController,}),});viewRegistry.add('forecast_report_list',ForecastReportListView);return ForecastReportListView;});;

/* /azk_stock_forecast/static/js/forecast_report_listview_controller.js defined in bundle 'web.assets_backend' */
odoo.define('azk_stock_forecast.ForecastReportListController',function(require){"use strict";var core=require('web.core');var ListController=require('web.ListController');var qweb=core.qweb;var ForecastReportListController=ListController.extend({init:function(parent,model,renderer,params){this.context=renderer.state.getContext();return this._super.apply(this,arguments);},renderButtons:function($node){this._super.apply(this,arguments);if(this.context.no_at_date){return;}
var $buttonToDate=$(qweb.render('ForecastReport.Buttons'));$buttonToDate.on('click',this._onOpenWizard.bind(this));$buttonToDate.prependTo($node.find('.o_list_buttons'));},_onOpenWizard:function(){var state=this.model.get(this.handle,{raw:true});var stateContext=state.getContext();var context={active_model:this.modelName,};if(stateContext.default_product_id){context.product_id=stateContext.default_product_id;}else if(stateContext.product_tmpl_id){context.product_tmpl_id=stateContext.product_tmpl_id;}
this.do_action({res_model:'forecast.date.wizard',views:[[false,'form']],target:'new',type:'ir.actions.act_window',context:context,});},});return ForecastReportListController;});;

/* /azk_purchase_valuation_report/static/src/js/inventory_report_list_controller.js defined in bundle 'web.assets_backend' */
console.error("Could not get content for /azk_purchase_valuation_report/static/src/js/inventory_report_list_controller.js defined in bundle 'web.assets_backend'.");;

/* /azk_purchase_valuation_report/static/src/js/inventory_report_list_view_inherited.js defined in bundle 'web.assets_backend' */
console.error("Could not get content for /azk_purchase_valuation_report/static/src/js/inventory_report_list_view_inherited.js defined in bundle 'web.assets_backend'.");;

/* /ks_dashboard_ninja/static/src/js/ks_global_functions.js defined in bundle 'web.assets_backend' */
odoo.define('ks_dashboard_ninja.KsGlobalFunction',function(require){"use strict";var session=require('web.session');var field_utils=require('web.field_utils');return{ksNumIndianFormatter:function(num,digits){var negative;var si=[{value:1,symbol:""},{value:1E3,symbol:"Th"},{value:1E5,symbol:"Lakh"},{value:1E7,symbol:"Cr"},{value:1E9,symbol:"Arab"}];if(num<0){num=Math.abs(num)
negative=true}
var rx=/\.0+$|(\.[0-9]*[1-9])0+$/;var i;for(i=si.length-1;i>0;i--){if(num>=si[i].value){break;}}
if(negative){return"-"+(num/si[i].value).toFixed(digits).replace(rx,"$1")+si[i].symbol;}else{return(num/si[i].value).toFixed(digits).replace(rx,"$1")+si[i].symbol;}},ksNumFormatter:function(num,digits){var negative;var si=[{value:1,symbol:""},{value:1E3,symbol:"k"},{value:1E6,symbol:"M"},{value:1E9,symbol:"G"},{value:1E12,symbol:"T"},{value:1E15,symbol:"P"},{value:1E18,symbol:"E"}];if(num<0){num=Math.abs(num)
negative=true}
var rx=/\.0+$|(\.[0-9]*[1-9])0+$/;var i;for(i=si.length-1;i>0;i--){if(num>=si[i].value){break;}}
if(negative){return"-"+(num/si[i].value).toFixed(digits).replace(rx,"$1")+si[i].symbol;}else{return(num/si[i].value).toFixed(digits).replace(rx,"$1")+si[i].symbol;}},ks_monetary:function(value,currency_id){var currency=session.get_currency(currency_id);if(!currency){return value;}
if(currency.position==="after"){return value+=' '+currency.symbol;}else{return currency.symbol+' '+value;}},_onKsGlobalFormatter:function(ks_record_count,ks_data_format,ks_precision_digits){var self=this;if(ks_data_format=='exact'){return field_utils.format.float(ks_record_count,Float64Array,{digits:[0,ks_precision_digits]});}else{if(ks_data_format=='indian'){return self.ksNumIndianFormatter(ks_record_count,1);}else if(ks_data_format=='colombian'){return self.ksNumColombianFormatter(ks_record_count,1,ks_precision_digits);}else{return self.ksNumFormatter(ks_record_count,1);}}},ksNumColombianFormatter:function(num,digits,ks_precision_digits){var negative;var si=[{value:1,symbol:""},{value:1E3,symbol:""},{value:1E6,symbol:"M"},{value:1E9,symbol:"M"},{value:1E12,symbol:"M"},{value:1E15,symbol:"M"},{value:1E18,symbol:"M"}];if(num<0){num=Math.abs(num)
negative=true}
var rx=/\.0+$|(\.[0-9]*[1-9])0+$/;var i;for(i=si.length-1;i>0;i--){if(num>=si[i].value){break;}}
if(si[i].symbol==='M'){num=parseInt(num)/1000000
num=field_utils.format.integer(num,Float64Array)
if(negative){return"-"+num+si[i].symbol;}else{return num+si[i].symbol;}}else{if(num%1===0){num=field_utils.format.integer(num,Float64Array)}else{num=field_utils.format.float(num,Float64Array,{digits:[0,ks_precision_digits]});}
if(negative){return"-"+num;}else{return num;}}},}});;

/* /ks_dashboard_ninja/static/src/js/ks_dashboard_ninja.js defined in bundle 'web.assets_backend' */
odoo.define('ks_dashboard_ninja.ks_dashboard',function(require){"use strict";var core=require('web.core');var Dialog=require('web.Dialog');var viewRegistry=require('web.view_registry');var _t=core._t;var QWeb=core.qweb;var utils=require('web.utils');var config=require('web.config');var framework=require('web.framework');var time=require('web.time');var datepicker=require("web.datepicker");var session=require('web.session');var AbstractAction=require('web.AbstractAction');var ajax=require('web.ajax');var framework=require('web.framework');var field_utils=require('web.field_utils');var KsGlobalFunction=require('ks_dashboard_ninja.KsGlobalFunction');var KsQuickEditView=require('ks_dashboard_ninja.quick_edit_view');var KsDashboardNinja=AbstractAction.extend({hasControlPanel:false,dependencies:['bus_service'],jsLibs:['/ks_dashboard_ninja/static/lib/js/Chart.bundle.min.js','/ks_dashboard_ninja/static/lib/js/gridstack-h5.js','/ks_dashboard_ninja/static/lib/js/chartjs-plugin-datalabels.js','/ks_dashboard_ninja/static/lib/js/pdfmake.min.js','/ks_dashboard_ninja/static/lib/js/vfs_fonts.js',],cssLibs:['/ks_dashboard_ninja/static/lib/css/Chart.css','/ks_dashboard_ninja/static/lib/css/Chart.min.css'],init:function(parent,state,params){this._super.apply(this,arguments);this.ks_mode='active';this.action_manager=parent;this.controllerID=params.controllerID;this.name="ks_dashboard";this.ksIsDashboardManager=false;this.ksDashboardEditMode=false;this.ksNewDashboardName=false;this.file_type_magic_word={'/':'jpg','R':'gif','i':'png','P':'svg+xml',};this.ksAllowItemClick=true;var l10n=_t.database.parameters;this.form_template='ks_dashboard_ninja_template_view';this.date_format=time.strftime_to_moment_format(_t.database.parameters.date_format)
this.date_format=this.date_format.replace(/\bYY\b/g,"YYYY");this.datetime_format=time.strftime_to_moment_format((_t.database.parameters.date_format+' '+l10n.time_format))
this.ks_date_filter_data;this.ks_date_filter_selections={'l_none':_t('Date Filter'),'l_day':_t('Today'),'t_week':_t('This Week'),'t_month':_t('This Month'),'t_quarter':_t('This Quarter'),'t_year':_t('This Year'),'n_day':_t('Next Day'),'n_week':_t('Next Week'),'n_month':_t('Next Month'),'n_quarter':_t('Next Quarter'),'n_year':_t('Next Year'),'ls_day':_t('Last Day'),'ls_week':_t('Last Week'),'ls_month':_t('Last Month'),'ls_quarter':_t('Last Quarter'),'ls_year':_t('Last Year'),'l_week':_t('Last 7 days'),'l_month':_t('Last 30 days'),'l_quarter':_t('Last 90 days'),'l_year':_t('Last 365 days'),'ls_past_until_now':_t('Past Till Now'),'ls_pastwithout_now':_t('Past Excluding Today'),'n_future_starting_now':_t('Future Starting Now'),'n_futurestarting_tomorrow':_t('Future Starting Tomorrow'),'l_custom':_t('Custom Filter'),};this.ks_date_filter_selection_order=['l_day','t_week','t_month','t_quarter','t_year','n_day','n_week','n_month','n_quarter','n_year','ls_day','ls_week','ls_month','ls_quarter','ls_year','l_week','l_month','l_quarter','l_year','ls_past_until_now','ls_pastwithout_now','n_future_starting_now','n_futurestarting_tomorrow','l_custom'];this.ks_dashboard_id=state.params.ks_dashboard_id;this.gridstack_options={staticGrid:true,float:false,cellHeight:80,styleInHead:true,};this.gridstackConfig={};this.grid=false;this.chartMeasure={};this.chart_container={};this.list_container={};this.ksChartColorOptions=['default','cool','warm','neon'];this.ksUpdateDashboardItem=this.ksUpdateDashboardItem.bind(this);this.ksDateFilterSelection=false;this.ksDateFilterStartDate=false;this.ksDateFilterEndDate=false;this.ksUpdateDashboard={};},getContext:function(){var self=this;var context={ksDateFilterSelection:self.ksDateFilterSelection,ksDateFilterStartDate:self.ksDateFilterStartDate,ksDateFilterEndDate:self.ksDateFilterEndDate,}
return Object.assign(context,odoo.session_info.user_context)},on_attach_callback:function(){var self=this;$.when(self.ks_fetch_items_data()).then(function(result){self.ksRenderDashboard();self.ks_set_update_interval();if(self.ks_dashboard_data.ks_item_data){self._ksSaveCurrentLayout();}});},ks_set_update_interval:function(){var self=this;if(self.ks_dashboard_data.ks_item_data){Object.keys(self.ks_dashboard_data.ks_item_data).forEach(function(item_id){var item_data=self.ks_dashboard_data.ks_item_data[item_id]
var updateValue=item_data["ks_update_items_data"];if(updateValue){if(!(item_id in self.ksUpdateDashboard)){if(['ks_tile','ks_list_view','ks_kpi','ks_to_do'].indexOf(item_data['ks_dashboard_item_type'])>=0){var ksItemUpdateInterval=setInterval(function(){self.ksFetchUpdateItem(item_id)},updateValue);}else{var ksItemUpdateInterval=setInterval(function(){self.ksFetchChartItem(item_id)},updateValue);}
self.ksUpdateDashboard[item_id]=ksItemUpdateInterval;}}});}},on_detach_callback:function(){var self=this;self.ks_remove_update_interval();if(self.ksDashboardEditMode)self._ksSaveCurrentLayout();self.ksDateFilterSelection=false;self.ksDateFilterStartDate=false;self.ksDateFilterEndDate=false;},ks_remove_update_interval:function(){var self=this;if(self.ksUpdateDashboard){Object.values(self.ksUpdateDashboard).forEach(function(itemInterval){clearInterval(itemInterval);});self.ksUpdateDashboard={};}},events:{'click #ks_add_item_selection > li':'onAddItemTypeClick','click .ks_dashboard_add_layout':'_onKsAddLayoutClick','click .ks_dashboard_edit_layout':'_onKsEditLayoutClick','click .ks_dashboard_select_item':'onKsSelectItemClick','click .ks_dashboard_save_layout':'_onKsSaveLayoutClick','click .ks_dashboard_create_new_layout':'_onKsCreateLayoutClick','click .ks_dashboard_cancel_layout':'_onKsCancelLayoutClick','click .ks_item_click':'_onKsItemClick','click .ks_load_previous':'ksLoadPreviousRecords','click .ks_load_next':'ksLoadMoreRecords','click .ks_dashboard_item_customize':'_onKsItemCustomizeClick','click .ks_dashboard_item_delete':'_onKsDeleteItemClick','change .ks_dashboard_header_name':'_onKsInputChange','click .ks_duplicate_item':'onKsDuplicateItemClick','click .ks_move_item':'onKsMoveItemClick','change .ks_input_import_item_button':'ksImportItem','click .ks_dashboard_menu_container':function(e){e.stopPropagation();},'click .ks_qe_dropdown_menu':function(e){e.stopPropagation();},'click .ks_chart_json_export':'ksItemExportJson','click .ks_dashboard_item_action':'ksStopClickPropagation','show.bs.dropdown .ks_dropdown_container':'onKsDashboardMenuContainerShow','hide.bs.dropdown .ks_dashboard_item_button_container':'onKsDashboardMenuContainerHide','click .apply-dashboard-date-filter':'_onKsApplyDateFilter','click .clear-dashboard-date-filter':'_onKsClearDateValues','change #ks_start_date_picker':'_ksShowApplyClearDateButton','change #ks_end_date_picker':'_ksShowApplyClearDateButton','click .ks_date_filters_menu':'_ksOnDateFilterMenuSelect','click #ks_item_info':'ksOnListItemInfoClick','click .ks_chart_color_options':'ksRenderChartColorOptions','click #ks_chart_canvas_id':'onChartCanvasClick','click .ks_list_canvas_click':'onChartCanvasClick','click .ks_dashboard_item_chart_info':'onChartMoreInfoClick','click .ks_chart_xls_csv_export':'ksChartExportXlsCsv','click .ks_chart_pdf_export':'ksChartExportPdf','click .ks_dashboard_quick_edit_action_popup':'ksOnQuickEditView','click .ks_dashboard_item_drill_up':'ksOnDrillUp','click .ks_dashboard_layout_event':'_ksOnDnLayoutMenuSelect','click .ks_dashboard_set_current_layout':'_ksSetCurrentLayoutClick','click .ks_dashboard_cancel_current_layout':'_ksSetDiscardCurrentLayoutClick','click .ks_add_dashboard_item_on_empty':'ks_add_dashboard_item_on_empty',},_ksOnDnLayoutMenuSelect:function(ev){var selected_layout_id=$(ev.currentTarget).data('ks_layout_id');this.ksOnLayoutSelection(selected_layout_id);},ksOnLayoutSelection:function(layout_id){var self=this;var selected_layout_name=this.ks_dashboard_data.ks_child_boards[layout_id][0];var selected_layout_grid_config=this.ks_dashboard_data.ks_child_boards[layout_id][1];this.gridstackConfig=JSON.parse(selected_layout_grid_config);_(this.gridstackConfig).each((x,y)=>{self.grid.update(self.$el.find(".grid-stack-item[gs-id="+y+"]")[0],{x:x['x'],y:x['y'],w:x['w'],h:x['h'],autoPosition:false});});this.$el.find("#ks_dashboard_layout_dropdown_container .ks_layout_selected").removeClass("ks_layout_selected");this.$el.find("li.ks_dashboard_layout_event[data-ks_layout_id='"+layout_id+"']").addClass('ks_layout_selected');this.$el.find("#ks_dn_layout_button span:first-child").text(selected_layout_name);this.$el.find(".ks_dashboard_top_menu .ks_dashboard_top_settings").addClass("ks_hide");this.$el.find(".ks_dashboard_top_menu .ks_am_content_element").addClass("ks_hide");this.$el.find(".ks_dashboard_layout_edit_mode_settings").removeClass("ks_hide");},_ksSetCurrentLayoutClick:function(){var self=this;this.ks_dashboard_data.ks_selected_board_id=this.$el.find("#ks_dashboard_layout_dropdown_container .ks_layout_selected").data('ks_layout_id');this.$el.find(".ks_dashboard_top_menu .ks_dashboard_top_settings").removeClass("ks_hide");this.$el.find(".ks_dashboard_top_menu .ks_am_content_element").removeClass("ks_hide");this.$el.find(".ks_dashboard_layout_edit_mode_settings").addClass("ks_hide");this.ks_dashboard_data.name=this.ks_dashboard_data.ks_child_boards[this.ks_dashboard_data.ks_selected_board_id][0];this._rpc({model:'ks_dashboard_ninja.board',method:'update_child_board',args:['update',self.ks_dashboard_id,{"ks_selected_board_id":this.ks_dashboard_data.ks_selected_board_id,}],});},_ksSetDiscardCurrentLayoutClick:function(){this.ksOnLayoutSelection(this.ks_dashboard_data.ks_selected_board_id);this.$el.find(".ks_dashboard_top_menu .ks_dashboard_top_settings").removeClass("ks_hide");this.$el.find(".ks_dashboard_top_menu .ks_am_content_element").removeClass("ks_hide");this.$el.find(".ks_dashboard_layout_edit_mode_settings").addClass("ks_hide");},ksOnQuickEditView:function(e){var self=this;var item_id=e.currentTarget.dataset.itemId;var item_data=this.ks_dashboard_data.ks_item_data[item_id];var item_el=$.find('[gs-id='+item_id+']');var $quickEditButton=$(QWeb.render('ksQuickEditButtonContainer',{grid:$.extend({},item_el[0].gridstackNode)}));$(item_el).before($quickEditButton);var ksQuickEditViewWidget=new KsQuickEditView.QuickEditView(this,{item:item_data,});ksQuickEditViewWidget.appendTo($quickEditButton.find('.dropdown-menu'));ksQuickEditViewWidget.on("canBeDestroyed",this,function(result){if(ksQuickEditViewWidget){ksQuickEditViewWidget=false;$quickEditButton.find('.ks_dashboard_item_action').click();}});ksQuickEditViewWidget.on("canBeRendered",this,function(result){$quickEditButton.find('.ks_dashboard_item_action').click();});ksQuickEditViewWidget.on("openFullItemForm",this,function(result){ksQuickEditViewWidget.destroy();$quickEditButton.find('.ks_dashboard_item_action').click();self.ks_open_item_form_page(parseInt(item_id));});$quickEditButton.on("hide.bs.dropdown",function(ev){if(ev.hasOwnProperty("clickEvent")&&document.contains(ev.clickEvent.target)){if(ksQuickEditViewWidget){ksQuickEditViewWidget.ksDiscardChanges();ksQuickEditViewWidget=false;self.ks_set_update_interval();$quickEditButton.remove();}else{self.ks_set_update_interval();$quickEditButton.remove();}}else if(!ev.hasOwnProperty("clickEvent")){self.ks_set_update_interval();$quickEditButton.remove();}else{return false;}});$quickEditButton.on("show.bs.dropdown",function(){self.ks_remove_update_interval();});e.stopPropagation();},willStart:function(){var self=this;return $.when(ajax.loadLibs(this),this._super()).then(function(){return self.ks_fetch_data();});},start:function(){var self=this;self.ks_set_default_chart_view();return this._super().then(function(){self.call('bus_service','onNotification',self,function(notifications){_.each(notifications,(function(notification){if(notification[1].hasOwnProperty('type')&&notification[1]['type']==="ks_dashboard_ninja.notification"&&self.ks_mode==='active'){var item_to_update=_(notification[1].changes).filter((x)=>{return self.ks_dashboard_data.ks_dashboard_items_ids.indexOf(x)>=0});if(item_to_update){var msg=""+item_to_update.length+" Dashboard item has been updated."
if(item_to_update.length>1){msg=""+item_to_update.length+" Dashboard items has been updated."}
var update_notification_ids=_(item_to_update).filter((x)=>{return self.ks_dashboard_data.ks_item_data[x].ks_auto_update_type==='ks_live_update'&&self.ks_dashboard_data.ks_item_data[x].ks_show_live_pop_up===true});if(update_notification_ids.length>0){self.call('notification','notify',{message:msg,type:'info',});}
for(var i=0;i<update_notification_ids.length;i++){self.ksFetchUpdateItem(update_notification_ids[i])}}}}).bind(this));});});},ks_set_default_chart_view:function(){Chart.plugins.unregister(ChartDataLabels);var backgroundColor='white';Chart.plugins.register({beforeDraw:function(c){var ctx=c.chart.ctx;ctx.fillStyle=backgroundColor;ctx.fillRect(0,0,c.chart.width,c.chart.height);}});Chart.plugins.register({afterDraw:function(chart){if(chart.data.labels.length===0){var ctx=chart.chart.ctx;var width=chart.chart.width;var height=chart.chart.height
chart.clear();ctx.save();ctx.textAlign='center';ctx.textBaseline='middle';ctx.font="3rem 'Lucida Grande'";ctx.fillText('No data available',width/2,height/2);ctx.restore();}}});Chart.Legend.prototype.afterFit=function(){var chart_type=this.chart.config.type;if(chart_type==="pie"||chart_type==="doughnut"){this.height=this.height;}else{this.height=this.height+20;};};},ksFetchUpdateItem:function(item_id){var self=this;return self._rpc({model:'ks_dashboard_ninja.board',method:'ks_fetch_item',args:[[parseInt(item_id)],self.ks_dashboard_id,self.ksGetParamsForItemFetch(parseInt(item_id))],context:self.getContext(),}).then(function(new_item_data){this.ks_dashboard_data.ks_item_data[item_id]=new_item_data[item_id];this.ksUpdateDashboardItem([item_id]);}.bind(this));},ksRenderChartColorOptions:function(e){var self=this;if(!$(e.currentTarget).parent().hasClass('ks_date_filter_selected')){var $parent=$(e.currentTarget).parent().parent();$parent.find('.ks_date_filter_selected').removeClass('ks_date_filter_selected')
$(e.currentTarget).parent().addClass('ks_date_filter_selected')
var item_data=self.ks_dashboard_data.ks_item_data[$parent.data().itemId];var chart_data=JSON.parse(item_data.ks_chart_data);this.ksChartColors(e.currentTarget.dataset.chartColor,this.chart_container[$parent.data().itemId],$parent.data().chartType,$parent.data().chartFamily,item_data.ks_bar_chart_stacked,item_data.ks_semi_circle_chart,item_data.ks_show_data_value,chart_data,item_data)
this._rpc({model:'ks_dashboard_ninja.item',method:'write',args:[$parent.data().itemId,{"ks_chart_item_color":e.currentTarget.dataset.chartColor}],}).then(function(){self.ks_dashboard_data.ks_item_data[$parent.data().itemId]['ks_chart_item_color']=e.currentTarget.dataset.chartColor;});}},ks_fetch_data:function(){var self=this;return this._rpc({model:'ks_dashboard_ninja.board',method:'ks_fetch_dashboard_data',args:[self.ks_dashboard_id],context:self.getContext(),}).then(function(result){self.ks_dashboard_data=result;});},normalize_dn_data:function(result){_(result.ks_child_boards).each((x,y)=>{if(typeof(y)==='number'){result[y.toString()]=result[y];delete result[y];}})
return result;},ks_fetch_items_data:function(){var self=this;var items_promises=[]
self.ks_dashboard_data.ks_dashboard_items_ids.forEach(function(item_id){items_promises.push(self._rpc({model:"ks_dashboard_ninja.board",method:"ks_fetch_item",context:self.getContext(),args:[[item_id],self.ks_dashboard_id,self.ksGetParamsForItemFetch(item_id)]}).then(function(result){self.ks_dashboard_data.ks_item_data[item_id]=result[item_id];}));});return Promise.all(items_promises)},ksGetParamsForItemFetch:function(){return{};},on_reverse_breadcrumb:function(state){var self=this;this.action_manager.trigger_up('push_state',{controllerID:this.controllerID,state:state||{},});return $.when(self.ks_fetch_data());},ksStopClickPropagation:function(e){this.ksAllowItemClick=false;},onKsDashboardMenuContainerShow:function(e){$(e.currentTarget).addClass('ks_dashboard_item_menu_show');var item_id=e.currentTarget.dataset.item_id;if(this.ksUpdateDashboard[item_id]){clearInterval(this.ksUpdateDashboard[item_id]);delete this.ksUpdateDashboard[item_id]}
if($(e.target).hasClass('ks_dashboard_more_action')){var chart_id=e.target.dataset.itemId;var name=this.ks_dashboard_data.ks_item_data[chart_id].name;var base64_image=this.chart_container[chart_id].toBase64Image();$(e.target).find('.dropdown-menu').empty();$(e.target).find('.dropdown-menu').append($(QWeb.render('ksMoreChartOptions',{href:base64_image,download_fileName:name,chart_id:chart_id})))}},onKsDashboardMenuContainerHide:function(e){var self=this;$(e.currentTarget).removeClass('ks_dashboard_item_menu_show');var item_id=e.currentTarget.dataset.item_id;var updateValue=this.ks_dashboard_data.ks_item_data[item_id]["ks_update_items_data"];if(updateValue){var updateinterval=setInterval(function(){self.ksFetchUpdateItem(item_id)},updateValue);self.ksUpdateDashboard[item_id]=updateinterval;}
if(this.ks_dashboard_data.ks_item_data[item_id]['isDrill']==true){clearInterval(this.ksUpdateDashboard[item_id]);}},ks_get_dark_color:function(color,opacity,percent){var num=parseInt(color.slice(1),16),amt=Math.round(2.55*percent),R=(num>>16)+amt,G=(num>>8&0x00FF)+amt,B=(num&0x0000FF)+amt;return"#"+(0x1000000+(R<255?R<1?0:R:255)*0x10000+(G<255?G<1?0:G:255)*0x100+(B<255?B<1?0:B:255)).toString(16).slice(1)+","+opacity;},_ks_get_rgba_format:function(val){var rgba=val.split(',')[0].match(/[A-Za-z0-9]{2}/g);rgba=rgba.map(function(v){return parseInt(v,16)}).join(",");return"rgba("+rgba+","+val.split(',')[1]+")";},ksRenderDashboard:function(){var self=this;self.$el.empty();self.$el.addClass('ks_dashboard_ninja d-flex flex-column');var dash_name=$('ul[id="ks_dashboard_layout_dropdown_container"] li[class="ks_dashboard_layout_event ks_layout_selected"] span').text()
if(self.ks_dashboard_data.ks_child_boards)self.ks_dashboard_data.name=this.ks_dashboard_data.ks_child_boards[self.ks_dashboard_data.ks_selected_board_id][0];var $ks_header=$(QWeb.render('ksDashboardNinjaHeader',{ks_dashboard_name:self.ks_dashboard_data.name,ks_multi_layout:self.ks_dashboard_data.multi_layouts,ks_dash_name:self.ks_dashboard_data.name,ks_dashboard_manager:self.ks_dashboard_data.ks_dashboard_manager,date_selection_data:self.ks_date_filter_selections,date_selection_order:self.ks_date_filter_selection_order,ks_show_create_layout_option:(Object.keys(self.ks_dashboard_data.ks_item_data).length>0)&&self.ks_dashboard_data.ks_dashboard_manager,ks_show_layout:self.ks_dashboard_data.ks_dashboard_manager&&self.ks_dashboard_data.ks_child_boards&&true,ks_selected_board_id:self.ks_dashboard_data.ks_selected_board_id,ks_child_boards:self.ks_dashboard_data.ks_child_boards,ks_dashboard_data:self.ks_dashboard_data,ks_dn_pre_defined_filters:_(self.ks_dashboard_data.ks_dashboard_pre_domain_filter).values().sort(function(a,b){return a.sequence-b.sequence}),}));if(!config.device.isMobile){$ks_header.addClass("ks_dashboard_header_sticky")}
self.$el.append($ks_header);if(Object.keys(self.ks_dashboard_data.ks_item_data).length===0){self.$el.find('.ks_dashboard_link').addClass("d-none");self.$el.find('.ks_dashboard_edit_layout').addClass("d-none");}
self.ksRenderDashboardMainContent();if(Object.keys(self.ks_dashboard_data.ks_item_data).length===0){self._ksRenderNoItemView();}},ksRenderDashboardMainContent:function(){var self=this;if(self.ks_dashboard_data.ks_item_data){self._renderDateFilterDatePicker();self.$el.find('.ks_dashboard_link').removeClass("ks_hide");$('.ks_dashboard_items_list').remove();var $dashboard_body_container=$(QWeb.render('ks_main_body_container'))
var $gridstackContainer=$dashboard_body_container.find(".grid-stack");$dashboard_body_container.appendTo(self.$el)
self.grid=GridStack.init(self.gridstack_options,$gridstackContainer[0]);var items=self.ksSortItems(self.ks_dashboard_data.ks_item_data);self.ksRenderDashboardItems(items);self.grid.setStatic(true);}else if(!self.ks_dashboard_data.ks_item_data){self.$el.find('.ks_dashboard_link').addClass("ks_hide");self._ksRenderNoItemView();}},ksSortItems:function(ks_item_data){var items=[]
var self=this;var item_data=Object.assign({},ks_item_data);if(self.ks_dashboard_data.ks_gridstack_config){self.gridstackConfig=JSON.parse(self.ks_dashboard_data.ks_gridstack_config);var a=Object.values(self.gridstackConfig);var b=Object.keys(self.gridstackConfig);for(var i=0;i<a.length;i++){a[i]['id']=b[i];}
a.sort(function(a,b){return(35*a.y+a.x)-(35*b.y+b.x);});for(var i=0;i<a.length;i++){if(item_data[a[i]['id']]){items.push(item_data[a[i]['id']]);delete item_data[a[i]['id']];}}}
return items.concat(Object.values(item_data));},ksRenderDashboardItems:function(items){var self=this;self.$el.find('.print-dashboard-btn').addClass("ks_pro_print_hide");if(self.ks_dashboard_data.ks_gridstack_config){self.gridstackConfig=JSON.parse(self.ks_dashboard_data.ks_gridstack_config);}
var item_view;var ks_container_class='grid-stack-item',ks_inner_container_class='grid-stack-item-content';for(var i=0;i<items.length;i++){if(self.grid){if(items[i].ks_dashboard_item_type==='ks_tile'){var item_view=self._ksRenderDashboardTile(items[i])
if(items[i].id in self.gridstackConfig){self.grid.addWidget($(item_view)[0],{x:self.gridstackConfig[items[i].id].x,y:self.gridstackConfig[items[i].id].y,w:self.gridstackConfig[items[i].id].w,h:self.gridstackConfig[items[i].id].h,autoPosition:true,minW:2,maxW:null,minH:2,maxH:null,id:items[i].id});}else{self.grid.addWidget($(item_view)[0],{x:0,y:0,w:4,h:2,autoPosition:true,minW:2,maxW:null,minH:2,maxH:2,id:items[i].id});}}else if(items[i].ks_dashboard_item_type==='ks_list_view'){self._renderListView(items[i],self.grid)}else if(items[i].ks_dashboard_item_type==='ks_kpi'){var kpi_preview=self.renderKpi(items[i],self.grid)
if(items[i].id in self.gridstackConfig){self.grid.addWidget($kpi_preview[0],{x:self.gridstackConfig[items[i].id].x,y:self.gridstackConfig[items[i].id].y,w:self.gridstackConfig[items[i].id].w,h:self.gridstackConfig[items[i].id].h,autoPosition:true,minW:2,maxW:null,minH:2,maxH:null,id:items[i].id});}else{self.grid.addWidget($kpi_preview[0],{x:0,y:0,w:3,h:2,autoPosition:true,minW:2,maxW:null,minH:2,maxH:null,id:items[i].id});}}else{self._renderGraph(items[i],self.grid)}}}},_ksRenderDashboardTile:function(tile){var self=this;var ks_container_class='grid-stack-item';var ks_inner_container_class='grid-stack-item-content';var ks_icon_url,item_view;var ks_rgba_background_color,ks_rgba_font_color,ks_rgba_default_icon_color,ks_rgba_button_color;var style_main_body,style_image_body_l2,style_domain_count_body,style_button_customize_body,style_button_delete_body;if(tile.ks_multiplier_active){var ks_record_count=tile.ks_record_count*tile.ks_multiplier
var data_count=KsGlobalFunction._onKsGlobalFormatter(ks_record_count,tile.ks_data_formatting,tile.ks_precision_digits);var count=ks_record_count;}else{var data_count=KsGlobalFunction._onKsGlobalFormatter(tile.ks_record_count,tile.ks_data_formatting,tile.ks_precision_digits);var count=ks_record_count}
if(tile.ks_icon_select=="Custom"){if(tile.ks_icon[0]){ks_icon_url='data:image/'+(self.file_type_magic_word[tile.ks_icon[0]]||'png')+';base64,'+tile.ks_icon;}else{ks_icon_url=false;}}
tile.ksIsDashboardManager=self.ks_dashboard_data.ks_dashboard_manager;ks_rgba_background_color=self._ks_get_rgba_format(tile.ks_background_color);ks_rgba_font_color=self._ks_get_rgba_format(tile.ks_font_color);ks_rgba_default_icon_color=self._ks_get_rgba_format(tile.ks_default_icon_color);ks_rgba_button_color=self._ks_get_rgba_format(tile.ks_button_color);style_main_body="background-color:"+ks_rgba_background_color+";color : "+ks_rgba_font_color+";";switch(tile.ks_layout){case'layout1':item_view=QWeb.render('ks_dashboard_item_layout1',{item:tile,style_main_body:style_main_body,ks_icon_url:ks_icon_url,ks_rgba_default_icon_color:ks_rgba_default_icon_color,ks_rgba_button_color:ks_rgba_button_color,ks_container_class:ks_container_class,ks_inner_container_class:ks_inner_container_class,ks_dashboard_list:self.ks_dashboard_data.ks_dashboard_list,data_count:data_count,count:count});break;case'layout2':var ks_rgba_dark_background_color_l2=self._ks_get_rgba_format(self.ks_get_dark_color(tile.ks_background_color.split(',')[0],tile.ks_background_color.split(',')[1],-10));style_image_body_l2="background-color:"+ks_rgba_dark_background_color_l2+";";item_view=QWeb.render('ks_dashboard_item_layout2',{item:tile,style_image_body_l2:style_image_body_l2,style_main_body:style_main_body,ks_icon_url:ks_icon_url,ks_rgba_default_icon_color:ks_rgba_default_icon_color,ks_rgba_button_color:ks_rgba_button_color,ks_container_class:ks_container_class,ks_inner_container_class:ks_inner_container_class,ks_dashboard_list:self.ks_dashboard_data.ks_dashboard_list,data_count:data_count,count:count});break;case'layout3':item_view=QWeb.render('ks_dashboard_item_layout3',{item:tile,style_main_body:style_main_body,ks_icon_url:ks_icon_url,ks_rgba_default_icon_color:ks_rgba_default_icon_color,ks_rgba_button_color:ks_rgba_button_color,ks_container_class:ks_container_class,ks_inner_container_class:ks_inner_container_class,ks_dashboard_list:self.ks_dashboard_data.ks_dashboard_list,data_count:data_count,count:count});break;case'layout4':style_main_body="color : "+ks_rgba_font_color+";border : solid;border-width : 1px;border-color:"+ks_rgba_background_color+";"
style_image_body_l2="background-color:"+ks_rgba_background_color+";";style_domain_count_body="color:"+ks_rgba_background_color+";";item_view=QWeb.render('ks_dashboard_item_layout4',{item:tile,style_main_body:style_main_body,style_image_body_l2:style_image_body_l2,style_domain_count_body:style_domain_count_body,ks_icon_url:ks_icon_url,ks_rgba_default_icon_color:ks_rgba_default_icon_color,ks_rgba_button_color:ks_rgba_button_color,ks_container_class:ks_container_class,ks_inner_container_class:ks_inner_container_class,ks_dashboard_list:self.ks_dashboard_data.ks_dashboard_list,data_count:data_count,count:count});break;case'layout5':item_view=QWeb.render('ks_dashboard_item_layout5',{item:tile,style_main_body:style_main_body,ks_icon_url:ks_icon_url,ks_rgba_default_icon_color:ks_rgba_default_icon_color,ks_rgba_button_color:ks_rgba_button_color,ks_container_class:ks_container_class,ks_inner_container_class:ks_inner_container_class,ks_dashboard_list:self.ks_dashboard_data.ks_dashboard_list,data_count:data_count,count:count});break;case'layout6':ks_rgba_default_icon_color=self._ks_get_rgba_format(tile.ks_default_icon_color);item_view=QWeb.render('ks_dashboard_item_layout6',{item:tile,style_image_body_l2:style_image_body_l2,style_main_body:style_main_body,ks_icon_url:ks_icon_url,ks_rgba_default_icon_color:ks_rgba_default_icon_color,ks_rgba_button_color:ks_rgba_button_color,ks_container_class:ks_container_class,ks_inner_container_class:ks_inner_container_class,ks_dashboard_list:self.ks_dashboard_data.ks_dashboard_list,data_count:data_count,count:count});break;default:item_view=QWeb.render('ks_dashboard_item_layout_default',{item:tile});break;}
return item_view},_renderGraph:function(item){var self=this;var chart_data=JSON.parse(item.ks_chart_data);var isDrill=item.isDrill?item.isDrill:false;var chart_id=item.id,chart_title=item.name;var chart_title=item.name;var chart_type=item.ks_dashboard_item_type.split('_')[1];switch(chart_type){case"pie":case"doughnut":case"polarArea":var chart_family="circle";break;case"bar":case"horizontalBar":case"line":case"area":var chart_family="square"
break;default:var chart_family="none";break;}
var $ks_gridstack_container=$(QWeb.render('ks_gridstack_container',{ks_chart_title:chart_title,ksIsDashboardManager:self.ks_dashboard_data.ks_dashboard_manager,ks_dashboard_list:self.ks_dashboard_data.ks_dashboard_list,chart_id:chart_id,chart_family:chart_family,chart_type:chart_type,ksChartColorOptions:this.ksChartColorOptions,})).addClass('ks_dashboarditem_id');$ks_gridstack_container.find('.ks_li_'+item.ks_chart_item_color).addClass('ks_date_filter_selected');var ksLayoutGridId=$(self.$el[0]).find('.ks_layout_selected').attr('data-ks_layout_id')
if(ksLayoutGridId&&ksLayoutGridId!='ks_default'){self.gridstackConfig=JSON.parse(self.ks_dashboard_data.ks_child_boards[parseInt(ksLayoutGridId)][1])}
parseInt($(self.$el[0]).find('.ks_layout_selected').attr('data-ks_layout_id'))
if(chart_id in self.gridstackConfig){self.grid.addWidget($ks_gridstack_container[0],{x:self.gridstackConfig[chart_id].x,y:self.gridstackConfig[chart_id].y,w:self.gridstackConfig[chart_id].w,h:self.gridstackConfig[chart_id].h,autoPosition:false,minW:4,maxW:null,minH:3,maxH:null,id:chart_id});}else{self.grid.addWidget($ks_gridstack_container[0],{x:0,y:0,w:5,h:4,autoPosition:true,minW:4,maxW:null,minH:3,maxH:null,id:chart_id});}
self._renderChart($ks_gridstack_container,item);},_renderChart:function($ks_gridstack_container,item){var self=this;var chart_data=JSON.parse(item.ks_chart_data);if(item.ks_chart_cumulative_field){for(var i=0;i<chart_data.datasets.length;i++){var ks_temp_com=0
var data=[]
var datasets={}
if(chart_data.datasets[i].ks_chart_cumulative_field){for(var j=0;j<chart_data.datasets[i].data.length;j++)
{ks_temp_com=ks_temp_com+chart_data.datasets[i].data[j];data.push(ks_temp_com);}
datasets.label='Cumulative'+chart_data.datasets[i].label;datasets.data=data;if(item.ks_chart_cumulative){datasets.type='line';}
chart_data.datasets.push(datasets);}}}
var isDrill=item.isDrill?item.isDrill:false;var chart_id=item.id,chart_title=item.name;var chart_title=item.name;var chart_type=item.ks_dashboard_item_type.split('_')[1];switch(chart_type){case"pie":case"doughnut":case"polarArea":var chart_family="circle";break;case"bar":case"horizontalBar":case"line":case"area":var chart_family="square"
break;default:var chart_family="none";break;}
$ks_gridstack_container.find('.ks_color_pallate').data({chartType:chart_type,chartFamily:chart_family});{chartType:"pie"}
var $ksChartContainer=$('<canvas id="ks_chart_canvas_id" data-chart-id='+chart_id+'/>');$ks_gridstack_container.find('.card-body').append($ksChartContainer);if(!item.ks_show_records){$ks_gridstack_container.find('.ks_dashboard_item_chart_info').hide();}
item.$el=$ks_gridstack_container;if(chart_family==="circle"){if(chart_data&&chart_data['labels'].length>30){$ks_gridstack_container.find(".ks_dashboard_color_option").remove();$ks_gridstack_container.find(".card-body").empty().append($("<div style='font-size:20px;'>Too many records for selected Chart Type. Consider using <strong>Domain</strong> to filter records or <strong>Record Limit</strong> to limit the no of records under <strong>30.</strong>"));return;}}
if(chart_data["ks_show_second_y_scale"]&&item.ks_dashboard_item_type==='ks_bar_chart'){var scales={}
scales.yAxes=[{type:"linear",display:true,position:"left",id:"y-axis-0",gridLines:{display:true},labels:{show:true,}},{type:"linear",display:true,position:"right",id:"y-axis-1",labels:{show:true,},ticks:{beginAtZero:true,callback:function(value,index,values){var ks_selection=chart_data.ks_selection;if(ks_selection==='monetary'){var ks_currency_id=chart_data.ks_currency;var ks_data=value;ks_data=KsGlobalFunction._onKsGlobalFormatter(ks_data,item.ks_data_formatting,item.ks_precision_digits);ks_data=KsGlobalFunction.ks_monetary(ks_data,ks_currency_id);return ks_data;}else if(ks_selection==='custom'){var ks_field=chart_data.ks_field;return KsGlobalFunction._onKsGlobalFormatter(value,item.ks_data_formatting,item.ks_precision_digits)+' '+ks_field;}else{return KsGlobalFunction._onKsGlobalFormatter(value,item.ks_data_formatting,item.ks_precision_digits);}},}}]}
var chart_plugin=[];if(item.ks_show_data_value){chart_plugin.push(ChartDataLabels);}
var ksMyChart=new Chart($ksChartContainer[0],{type:chart_type==="area"?"line":chart_type,plugins:chart_plugin,data:{labels:chart_data['labels'],groupByIds:chart_data['groupByIds'],domains:chart_data['domains'],datasets:chart_data.datasets,},options:{maintainAspectRatio:false,responsiveAnimationDuration:1000,animation:{easing:'easeInQuad',},legend:{display:item.ks_hide_legend},scales:scales,layout:{padding:{bottom:0,}},plugins:{datalabels:{backgroundColor:function(context){return context.dataset.backgroundColor;},borderRadius:4,color:'white',font:{weight:'bold'},anchor:'right',textAlign:'center',display:'auto',clamp:true,formatter:function(value,ctx){let sum=0;let dataArr=ctx.dataset.data;dataArr.map(data=>{sum+=data;});let percentage=sum===0?0+"%":(value*100/sum).toFixed(2)+"%";return percentage;},},},}});this.chart_container[chart_id]=ksMyChart;if(chart_data&&chart_data["datasets"].length>0)self.ksChartColors(item.ks_chart_item_color,ksMyChart,chart_type,chart_family,item.ks_bar_chart_stacked,item.ks_semi_circle_chart,item.ks_show_data_value,chart_data,item);},ksHideFunction:function(options,item,ksChartFamily,chartType){return options;},ksChartColors:function(palette,ksMyChart,ksChartType,ksChartFamily,stack,semi_circle,ks_show_data_value,chart_data,item){chart_data;var self=this;var currentPalette="cool";if(!palette)palette=currentPalette;currentPalette=palette;var gradient;switch(palette){case'cool':gradient={0:[255,255,255,1],20:[220,237,200,1],45:[66,179,213,1],65:[26,39,62,1],100:[0,0,0,1]};break;case'warm':gradient={0:[255,255,255,1],20:[254,235,101,1],45:[228,82,27,1],65:[77,52,47,1],100:[0,0,0,1]};break;case'neon':gradient={0:[255,255,255,1],20:[255,236,179,1],45:[232,82,133,1],65:[106,27,154,1],100:[0,0,0,1]};break;case'default':var color_set=['#F04F65','#f69032','#fdc233','#53cfce','#36a2ec','#8a79fd','#b1b5be','#1c425c','#8c2620','#71ecef','#0b4295','#f2e6ce','#1379e7']}
var chartType=ksMyChart.config.type;switch(chartType){case"pie":case"doughnut":case"polarArea":if(ksMyChart.config.data.datasets[0]){var datasets=ksMyChart.config.data.datasets[0];var setsCount=datasets.data.length;}
break;case"bar":case"horizontalBar":case"line":if(ksMyChart.config.data.datasets[0]){var datasets=ksMyChart.config.data.datasets;var setsCount=datasets.length;}
break;}
var chartColors=[];if(palette!=="default"){var gradientKeys=Object.keys(gradient);gradientKeys.sort(function(a,b){return+a-+b;});for(var i=0;i<setsCount;i++){var gradientIndex=(i+1)*(100/(setsCount+1));for(var j=0;j<gradientKeys.length;j++){var gradientKey=gradientKeys[j];if(gradientIndex===+gradientKey){chartColors[i]='rgba('+gradient[gradientKey].toString()+')';break;}else if(gradientIndex<+gradientKey){var prevKey=gradientKeys[j-1];var gradientPartIndex=(gradientIndex-prevKey)/(gradientKey-prevKey);var color=[];for(var k=0;k<4;k++){color[k]=gradient[prevKey][k]-((gradient[prevKey][k]-gradient[gradientKey][k])*gradientPartIndex);if(k<3)color[k]=Math.round(color[k]);}
chartColors[i]='rgba('+color.toString()+')';break;}}}}else{for(var i=0,counter=0;i<setsCount;i++,counter++){if(counter>=color_set.length)counter=0;chartColors.push(color_set[counter]);}}
var datasets=ksMyChart.config.data.datasets;var options=ksMyChart.config.options;options.legend.labels.usePointStyle=true;if(ksChartFamily=="circle"){if(ks_show_data_value){options.legend.position='bottom';options.layout.padding.top=10;options.layout.padding.bottom=20;options.layout.padding.left=20;options.layout.padding.right=20;}else{options.legend.position='top';}
options=self.ksHideFunction(options,item,ksChartFamily,chartType);options.plugins.datalabels.align='center';options.plugins.datalabels.anchor='end';options.plugins.datalabels.borderColor='white';options.plugins.datalabels.borderRadius=25;options.plugins.datalabels.borderWidth=2;options.plugins.datalabels.clamp=true;options.plugins.datalabels.clip=false;options.tooltips.callbacks={title:function(tooltipItem,data){var ks_self=self;var k_amount=data.datasets[tooltipItem[0].datasetIndex]['data'][tooltipItem[0].index];var ks_selection=chart_data.ks_selection;if(ks_selection==='monetary'){var ks_currency_id=chart_data.ks_currency;k_amount=KsGlobalFunction.ks_monetary(k_amount,ks_currency_id);return data.datasets[tooltipItem[0].datasetIndex]['label']+" : "+k_amount}else if(ks_selection==='custom'){var ks_field=chart_data.ks_field;k_amount=field_utils.format.float(k_amount,Float64Array,{digits:[0,item.ks_precision_digits]});return data.datasets[tooltipItem[0].datasetIndex]['label']+" : "+k_amount+" "+ks_field;}else{k_amount=field_utils.format.float(k_amount,Float64Array,{digits:[0,item.ks_precision_digits]});return data.datasets[tooltipItem[0].datasetIndex]['label']+" : "+k_amount}},label:function(tooltipItem,data){return data.labels[tooltipItem.index];},}
for(var i=0;i<datasets.length;i++){datasets[i].backgroundColor=chartColors;datasets[i].borderColor="rgba(255,255,255,1)";}
if(semi_circle&&(chartType==="pie"||chartType==="doughnut")){options.rotation=1*Math.PI;options.circumference=1*Math.PI;}}else if(ksChartFamily=="square"){options=self.ksHideFunction(options,item,ksChartFamily,chartType);options.scales.xAxes[0].gridLines.display=false;options.scales.yAxes[0].ticks.beginAtZero=true;options.plugins.datalabels.align='end';options.plugins.datalabels.formatter=function(value,ctx){var ks_selection=chart_data.ks_selection;if(ks_selection==='monetary'){var ks_currency_id=chart_data.ks_currency;var ks_data=value;ks_data=KsGlobalFunction._onKsGlobalFormatter(ks_data,item.ks_data_formatting,item.ks_precision_digits);ks_data=KsGlobalFunction.ks_monetary(ks_data,ks_currency_id);return ks_data;}else if(ks_selection==='custom'){var ks_field=chart_data.ks_field;return KsGlobalFunction._onKsGlobalFormatter(value,item.ks_data_formatting,item.ks_precision_digits)+' '+ks_field;}else{return KsGlobalFunction._onKsGlobalFormatter(value,item.ks_data_formatting,item.ks_precision_digits);}};if(chartType==="line"){options.plugins.datalabels.backgroundColor=function(context){return context.dataset.borderColor;};}
if(chartType==="horizontalBar"){options.scales.xAxes[0].ticks.callback=function(value,index,values){var ks_selection=chart_data.ks_selection;if(ks_selection==='monetary'){var ks_currency_id=chart_data.ks_currency;var ks_data=value;ks_data=KsGlobalFunction._onKsGlobalFormatter(ks_data,item.ks_data_formatting,item.ks_precision_digits);ks_data=KsGlobalFunction.ks_monetary(ks_data,ks_currency_id);return ks_data;}else if(ks_selection==='custom'){var ks_field=chart_data.ks_field;return KsGlobalFunction._onKsGlobalFormatter(value,item.ks_data_formatting,item.ks_precision_digits)+' '+ks_field;}else{return KsGlobalFunction._onKsGlobalFormatter(value,item.ks_data_formatting,item.ks_precision_digits);}}
options.scales.xAxes[0].ticks.beginAtZero=true;}else{options.scales.yAxes[0].ticks.callback=function(value,index,values){var ks_selection=chart_data.ks_selection;if(ks_selection==='monetary'){var ks_currency_id=chart_data.ks_currency;var ks_data=value;ks_data=KsGlobalFunction._onKsGlobalFormatter(ks_data,item.ks_data_formatting,item.ks_precision_digits);ks_data=KsGlobalFunction.ks_monetary(ks_data,ks_currency_id);return ks_data;}else if(ks_selection==='custom'){var ks_field=chart_data.ks_field;return KsGlobalFunction._onKsGlobalFormatter(value,item.ks_data_formatting,item.ks_precision_digits)+' '+ks_field;}else{return KsGlobalFunction._onKsGlobalFormatter(value,item.ks_data_formatting,item.ks_precision_digits);}}}
options.tooltips.callbacks={label:function(tooltipItem,data){var ks_self=self;var k_amount=data.datasets[tooltipItem.datasetIndex]['data'][tooltipItem.index];var ks_selection=chart_data.ks_selection;if(ks_selection==='monetary'){var ks_currency_id=chart_data.ks_currency;k_amount=KsGlobalFunction.ks_monetary(k_amount,ks_currency_id);return data.datasets[tooltipItem.datasetIndex]['label']+" : "+k_amount}else if(ks_selection==='custom'){var ks_field=chart_data.ks_field;k_amount=field_utils.format.float(k_amount,Float64Array,{digits:[0,item.ks_precision_digits]});return data.datasets[tooltipItem.datasetIndex]['label']+" : "+k_amount+" "+ks_field;}else{k_amount=field_utils.format.float(k_amount,Float64Array,{digits:[0,item.ks_precision_digits]});return data.datasets[tooltipItem.datasetIndex]['label']+" : "+k_amount}}}
for(var i=0;i<datasets.length;i++){switch(ksChartType){case"bar":case"horizontalBar":if(datasets[i].type&&datasets[i].type=="line"){datasets[i].borderColor=chartColors[i];datasets[i].backgroundColor="rgba(255,255,255,0)";datasets[i]['datalabels']={backgroundColor:chartColors[i],}}else{datasets[i].backgroundColor=chartColors[i];datasets[i].borderColor="rgba(255,255,255,0)";options.scales.xAxes[0].stacked=stack;options.scales.yAxes[0].stacked=stack;}
break;case"line":datasets[i].borderColor=chartColors[i];datasets[i].backgroundColor="rgba(255,255,255,0)";break;case"area":datasets[i].borderColor=chartColors[i];break;}}}
ksMyChart.update();},onChartCanvasClick:function(evt){var self=this;if(evt.currentTarget.classList.value!=='ks_list_canvas_click'){var item_id=evt.currentTarget.dataset.chartId;if(item_id in self.ksUpdateDashboard){clearInterval(self.ksUpdateDashboard[item_id]);delete self.ksUpdateDashboard[item_id]}
var myChart=self.chart_container[item_id];var activePoint=myChart.getElementAtEvent(evt)[0];if(activePoint){var item_data=self.ks_dashboard_data.ks_item_data[item_id];var groupBy=JSON.parse(item_data["ks_chart_data"])['groupby'];if(activePoint._chart.data.domains){var sequnce=item_data.sequnce?item_data.sequnce:0;var domain=activePoint._chart.data.domains[activePoint._index]
if(item_data.max_sequnce!=0&&sequnce<item_data.max_sequnce){self._rpc({model:'ks_dashboard_ninja.item',method:'ks_fetch_drill_down_data',args:[item_id,domain,sequnce]}).then(function(result){self.ks_dashboard_data.ks_item_data[item_id]['sequnce']=result.sequence;self.ks_dashboard_data.ks_item_data[item_id]['isDrill']=true;if(result.ks_chart_data){self.ks_dashboard_data.ks_item_data[item_id]['ks_dashboard_item_type']=result.ks_chart_type;self.ks_dashboard_data.ks_item_data[item_id]['ks_chart_data']=result.ks_chart_data;if(self.ks_dashboard_data.ks_item_data[item_id].domains){self.ks_dashboard_data.ks_item_data[item_id]['domains'][result.sequence]=JSON.parse(result.ks_chart_data).previous_domain;}else{self.ks_dashboard_data.ks_item_data[item_id]['domains']={}
self.ks_dashboard_data.ks_item_data[item_id]['domains'][result.sequence]=JSON.parse(result.ks_chart_data).previous_domain;}
$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_item_drill_up").removeClass('d-none');$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_item_chart_info").removeClass('d-none')
$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_color_option").removeClass('d-none')
$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_quick_edit_action_popup").removeClass('d-sm-block ');$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_more_action").addClass('d-none');$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".card-body").empty();var item_data=self.ks_dashboard_data.ks_item_data[item_id]
self._renderChart($(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]),item_data);}else{if('domains'in self.ks_dashboard_data.ks_item_data[item_id]){self.ks_dashboard_data.ks_item_data[item_id]['domains'][result.sequence]=JSON.parse(result.ks_list_view_data).previous_domain;}else{self.ks_dashboard_data.ks_item_data[item_id]['domains']={}
self.ks_dashboard_data.ks_item_data[item_id]['domains'][result.sequence]=JSON.parse(result.ks_list_view_data).previous_domain;}
self.ks_dashboard_data.ks_item_data[item_id]['isDrill']=true;self.ks_dashboard_data.ks_item_data[item_id]['sequnce']=result.sequence;self.ks_dashboard_data.ks_item_data[item_id]['ks_list_view_data']=result.ks_list_view_data;self.ks_dashboard_data.ks_item_data[item_id]['ks_list_view_type']=result.ks_list_view_type;self.ks_dashboard_data.ks_item_data[item_id]['ks_dashboard_item_type']='ks_list_view';$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_item_drill_up").removeClass('d-none');$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_item_chart_info").addClass('d-none')
$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_color_option").addClass('d-none')
$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".card-body").empty();$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_quick_edit_action_popup").removeClass('d-sm-block ');$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_more_action").addClass('d-none');var item_data=self.ks_dashboard_data.ks_item_data[item_id]
var $container=self.renderListViewData(item_data);$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".card-body").append($container).addClass('ks_overflow');}});}else{if(item_data.action){if(!item_data.ks_is_client_action){var action=Object.assign({},item_data.action);if(action.view_mode.includes('tree'))action.view_mode=action.view_mode.replace('tree','list');for(var i=0;i<action.views.length;i++)action.views[i][1].includes('tree')?action.views[i][1]=action.views[i][1].replace('tree','list'):action.views[i][1];action['domain']=domain||[];action['search_view_id']=[action.search_view_id,'search']}else{var action=Object.assign({},item_data.action[0]);if(action.params){action.params.default_active_id||'mailbox_inbox';}else{action.params={'default_active_id':'mailbox_inbox'};action.context={}
action.context.params={'active_model':false};}}}else{var action={name:_t(item_data.name),type:'ir.actions.act_window',res_model:item_data.ks_model_name,domain:domain||[],context:{'group_by':groupBy?groupBy:false,},views:[[false,'list'],[false,'form']],view_mode:'list',target:'current',}}
if(item_data.ks_show_records){self.do_action(action,{on_reverse_breadcrumb:self.on_reverse_breadcrumb,});}}}}}else{var item_id=$(evt.target).parent().data().itemId;if(this.ksUpdateDashboard[item_id]){clearInterval(this.ksUpdateDashboard[item_id]);delete self.ksUpdateDashboard[item_id];}
var item_data=self.ks_dashboard_data.ks_item_data[item_id]
if(self.ks_dashboard_data.ks_item_data[item_id].max_sequnce){var sequence=item_data.sequnce?item_data.sequnce:0
var domain=$(evt.target).parent().data().domain;if($(evt.target).parent().data().last_seq!==sequence){self._rpc({model:'ks_dashboard_ninja.item',method:'ks_fetch_drill_down_data',args:[item_id,domain,sequence]}).then(function(result){if(result.ks_list_view_data){if(self.ks_dashboard_data.ks_item_data[item_id].domains){self.ks_dashboard_data.ks_item_data[item_id]['domains'][result.sequence]=JSON.parse(result.ks_list_view_data).previous_domain;}else{self.ks_dashboard_data.ks_item_data[item_id]['domains']={}
self.ks_dashboard_data.ks_item_data[item_id]['domains'][result.sequence]=JSON.parse(result.ks_list_view_data).previous_domain;}
self.ks_dashboard_data.ks_item_data[item_id]['isDrill']=true;self.ks_dashboard_data.ks_item_data[item_id]['sequnce']=result.sequence;self.ks_dashboard_data.ks_item_data[item_id]['ks_list_view_data']=result.ks_list_view_data;self.ks_dashboard_data.ks_item_data[item_id]['ks_list_view_type']=result.ks_list_view_type;self.ks_dashboard_data.ks_item_data[item_id]['ks_dashboard_item_type']='ks_list_view';self.ks_dashboard_data.ks_item_data[item_id]['sequnce']=result.sequence;$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".card-body").empty();$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_search_plus").addClass('d-none')
$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_search_minus").addClass('d-none')
$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_item_drill_up").removeClass('d-none');$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_pager").addClass('d-none');$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_item_action_export").addClass('d-none');$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_quick_edit_action_popup").removeClass('d-sm-block ');var item_data=self.ks_dashboard_data.ks_item_data[item_id]
var $container=self.renderListViewData(item_data);$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".card-body").append($container);}else{self.ks_dashboard_data.ks_item_data[item_id]['ks_chart_data']=result.ks_chart_data;self.ks_dashboard_data.ks_item_data[item_id]['sequnce']=result.sequence;self.ks_dashboard_data.ks_item_data[item_id]['ks_dashboard_item_type']=result.ks_chart_type;self.ks_dashboard_data.ks_item_data[item_id]['isDrill']=true;if(self.ks_dashboard_data.ks_item_data[item_id].domains){self.ks_dashboard_data.ks_item_data[item_id]['domains'][result.sequence]=JSON.parse(result.ks_chart_data).previous_domain;}else{self.ks_dashboard_data.ks_item_data[item_id]['domains']={}
self.ks_dashboard_data.ks_item_data[item_id]['domains'][result.sequence]=JSON.parse(result.ks_chart_data).previous_domain;}
$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_item_chart_info").removeClass('d-none')
$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_color_option").removeClass('d-none')
$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_search_plus").addClass('d-none')
$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_search_minus").addClass('d-none')
$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_item_drill_up").removeClass('d-none');$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_pager").addClass('d-none');$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_quick_edit_action_popup").removeClass('d-sm-block ');$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_item_action_export").addClass('d-none');$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".card-body").empty();var item_data=self.ks_dashboard_data.ks_item_data[item_id]
self._renderChart($(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]),item_data);}});}}}
evt.stopPropagation();},ksOnDrillUp:function(e){var self=this;var item_id=e.currentTarget.dataset.itemId;var item_data=self.ks_dashboard_data.ks_item_data[item_id];var domain;if(item_data){if('domains'in item_data){domain=item_data['domains'][item_data.sequnce-1]?item_data['domains'][item_data.sequnce-1]:[]
var sequnce=item_data.sequnce-2;if(sequnce>=0){self._rpc({model:'ks_dashboard_ninja.item',method:'ks_fetch_drill_down_data',args:[item_id,domain,sequnce]}).then(function(result){self.ks_dashboard_data.ks_item_data[item_id]['ks_chart_data']=result.ks_chart_data;self.ks_dashboard_data.ks_item_data[item_id]['sequnce']=result.sequence;if(result.ks_chart_type)self.ks_dashboard_data.ks_item_data[item_id]['ks_dashboard_item_type']=result.ks_chart_type;$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_item_drill_up").removeClass('d-none');$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".card-body").empty();if(result.ks_chart_data){var item_data=self.ks_dashboard_data.ks_item_data[item_id];$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_item_chart_info").removeClass('d-none')
$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_color_option").removeClass('d-none')
self._renderChart($(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]),item_data);}else{self.ks_dashboard_data.ks_item_data[item_id]['ks_list_view_data']=result.ks_list_view_data;self.ks_dashboard_data.ks_item_data[item_id]['ks_list_view_type']=result.ks_list_view_type;self.ks_dashboard_data.ks_item_data[item_id]['ks_dashboard_item_type']='ks_list_view';var item_data=self.ks_dashboard_data.ks_item_data[item_id]
var $container=self.renderListViewData(item_data);$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_pager").addClass('d-none');$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_item_chart_info").addClass('d-none')
$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_color_option").addClass('d-none')
$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".card-body").append($container);}});}else{$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_item_drill_up").addClass('d-none');$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_item_chart_info").removeClass('d-none')
$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_color_option").removeClass('d-none')
$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_quick_edit_action_popup").addClass('d-sm-block ');$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_more_action").removeClass('d-none');$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_item_action_export").removeClass('d-none')
$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_search_plus").removeClass('d-none')
$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_search_minus").removeClass('d-none')
self.ksFetchUpdateItem(item_id)
var updateValue=self.ks_dashboard_data.ks_item_data[item_id]["ks_update_items_data"];if(updateValue){var updateinterval=setInterval(function(){self.ksFetchChartItem(item_id)},updateValue);self.ksUpdateDashboard[item_id]=updateinterval;}}}else{if(!domain){$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_dashboard_item_drill_up").addClass('d-none');}}}
e.stopPropagation();},ksFetchChartItem:function(id){var self=this;var item_data=self.ks_dashboard_data.ks_item_data[id];return self._rpc({model:'ks_dashboard_ninja.board',method:'ks_fetch_item',args:[[item_data.id],self.ks_dashboard_id,self.ksGetParamsForItemFetch(id)],context:self.getContext(),}).then(function(new_item_data){this.ks_dashboard_data.ks_item_data[id]=new_item_data[id];$(self.$el.find(".grid-stack-item[gs-id="+id+"]").children()[0]).find(".card-body").empty();var item_data=self.ks_dashboard_data.ks_item_data[id]
if(item_data.ks_list_view_data){var item_view=$(self.$el.find(".grid-stack-item[gs-id="+id+"]").children()[0]);var $container=self.renderListViewData(item_data);item_view.find(".card-body").append($container);var ks_length=JSON.parse(item_data['ks_list_view_data']).data_rows.length
if(new_item_data["ks_list_view_type"]==="ungrouped"&&JSON.parse(item_data['ks_list_view_data']).data_rows.length){item_view.find('.ks_pager').removeClass('d-none');if(item.ks_record_count<=item.ks_pagination_limit)item_view.find('.ks_load_next').addClass('ks_event_offer_list');item_view.find('.ks_value').text("1-"+JSON.parse(item_data['ks_list_view_data']).data_rows.length);}else{item_view.find('.ks_pager').addClass('d-none');}}else{self._renderChart($(self.$el.find(".grid-stack-item[gs-id="+id+"]").children()[0]),item_data);}}.bind(this));},onChartMoreInfoClick:function(evt){var self=this;var item_id=evt.currentTarget.dataset.itemId;var item_data=self.ks_dashboard_data.ks_item_data[item_id];var groupBy=item_data.ks_chart_groupby_type==='relational_type'?item_data.ks_chart_relation_groupby_name:item_data.ks_chart_relation_groupby_name+':'+item_data.ks_chart_date_groupby;var domain=JSON.parse(item_data.ks_chart_data).previous_domain
if(item_data.ks_show_records){if(item_data.action){if(!item_data.ks_is_client_action){var action=Object.assign({},item_data.action);if(action.view_mode.includes('tree'))action.view_mode=action.view_mode.replace('tree','list');for(var i=0;i<action.views.length;i++)action.views[i][1].includes('tree')?action.views[i][1]=action.views[i][1].replace('tree','list'):action.views[i][1];action['domain']=item_data.ks_domain||[];action['search_view_id']=[action.search_view_id,'search']}else{var action=Object.assign({},item_data.action[0]);if(action.params){action.params.default_active_id||'mailbox_inbox';}else{action.params={'default_active_id':'mailbox_inbox'}
action.context={}
action.context.params={'active_model':false};}}}else{var action={name:_t(item_data.name),type:'ir.actions.act_window',res_model:item_data.ks_model_name,domain:domain||[],context:{'group_by':groupBy?groupBy:false,},views:[[false,'list'],[false,'form']],view_mode:'list',target:'current',}}
self.do_action(action,{on_reverse_breadcrumb:self.on_reverse_breadcrumb,});}},_ksRenderNoItemView:function(){$('.ks_dashboard_items_list').remove();var self=this;$(QWeb.render('ksNoItemView')).appendTo(self.$el)},_ksRenderEditMode:function(){var self=this;self.ks_mode='edit';self.ks_remove_update_interval();$('#ks_dashboard_title_input').val(self.ks_dashboard_data.name);$('.ks_am_element').addClass("ks_hide");$('.ks_em_element').removeClass("ks_hide");$('.ks_dashboard_print_pdf').addClass("ks_hide");self.$el.find('.ks_item_click').addClass('ks_item_not_click').removeClass('ks_item_click');self.$el.find('.ks_dashboard_item').removeClass('ks_dashboard_item_header_hover');self.$el.find('.ks_dashboard_item_header').removeClass('ks_dashboard_item_header_hover');self.$el.find('.ks_dashboard_item_l2').removeClass('ks_dashboard_item_header_hover');self.$el.find('.ks_dashboard_item_header_l2').removeClass('ks_dashboard_item_header_hover');self.$el.find('.ks_dashboard_item_l5').removeClass('ks_dashboard_item_header_hover');self.$el.find('.ks_dashboard_item_button_container').removeClass('ks_dashboard_item_header_hover');self.$el.find('.ks_dashboard_link').addClass("ks_hide")
self.$el.find('.ks_dashboard_top_settings').addClass("ks_hide")
self.$el.find('.ks_dashboard_edit_mode_settings').removeClass("ks_hide")
self.$el.find('.ks_start_tv_dashboard').addClass('ks_hide');self.$el.find('.ks_chart_container').addClass('ks_item_not_click');self.$el.find('.ks_list_view_container').addClass('ks_item_not_click');if(self.grid){self.grid.enable();}},_ksRenderActiveMode:function(){var self=this
self.ks_mode='active';if(self.grid&&$('.grid-stack').data('gridstack')){$('.grid-stack').data('gridstack').disable();}
if(self.ks_dashboard_data.ks_child_boards){var dash_name=$('ul[id="ks_dashboard_layout_dropdown_container"] li[class="ks_dashboard_layout_event ks_layout_selected"] span').text()
var $layout_container=$(QWeb.render('ks_dn_layout_container',{ks_selected_board_id:self.ks_dashboard_data.ks_selected_board_id,ks_child_boards:self.ks_dashboard_data.ks_child_boards,ks_multi_layout:self.ks_dashboard_data.multi_layouts,ks_dash_name:dash_name}));$('#ks_dashboard_title .ks_am_element').replaceWith($layout_container);$('#ks_dashboard_title_label').replaceWith($layout_container);}else{$('#ks_dashboard_title_label').text(self.ks_dashboard_data.name);}
$('#ks_dashboard_title_label').text(self.ks_dashboard_data.name);$('.ks_am_element').removeClass("ks_hide");$('.ks_em_element').addClass("ks_hide");$('.ks_dashboard_print_pdf').removeClass("ks_hide");if(self.ks_dashboard_data.ks_item_data)$('.ks_am_content_element').removeClass("ks_hide");self.$el.find('.ks_item_not_click').addClass('ks_item_click').removeClass('ks_item_not_click')
self.$el.find('.ks_dashboard_item').addClass('ks_dashboard_item_header_hover')
self.$el.find('.ks_dashboard_item_header').addClass('ks_dashboard_item_header_hover')
self.$el.find('.ks_dashboard_item_l2').addClass('ks_dashboard_item_header_hover')
self.$el.find('.ks_dashboard_item_header_l2').addClass('ks_dashboard_item_header_hover')
self.$el.find('.ks_dashboard_item_l5').addClass('ks_dashboard_item_header_hover')
self.$el.find('.ks_dashboard_item_button_container').addClass('ks_dashboard_item_header_hover');self.$el.find('.ks_dashboard_top_settings').removeClass("ks_hide")
self.$el.find('.ks_dashboard_edit_mode_settings').addClass("ks_hide")
self.$el.find('.ks_start_tv_dashboard').removeClass('ks_hide');self.$el.find('.ks_chart_container').removeClass('ks_item_not_click ks_item_click');self.$el.find('.ks_list_view_container').removeClass('ks_item_click');self.ks_set_update_interval();self.grid.commit();},_ksToggleEditMode:function(){var self=this
if(self.ksDashboardEditMode){self._ksRenderActiveMode()
self.ksDashboardEditMode=false}else if(!self.ksDashboardEditMode){self._ksRenderEditMode()
self.ksDashboardEditMode=true}},onAddItemTypeClick:function(e){var self=this;if(e.currentTarget.dataset.item!=="ks_json"){self.do_action({type:'ir.actions.act_window',res_model:'ks_dashboard_ninja.item',view_id:'ks_dashboard_ninja_list_form_view',views:[[false,'form']],target:'current',context:{'ks_dashboard_id':self.ks_dashboard_id,'ks_dashboard_item_type':e.currentTarget.dataset.item,'form_view_ref':'ks_dashboard_ninja.item_form_view','form_view_initial_mode':'edit','ks_set_interval':self.ks_dashboard_data.ks_set_interval,'ks_data_formatting':self.ks_dashboard_data.ks_data_formatting,},},{on_reverse_breadcrumb:this.on_reverse_breadcrumb,});}else{self.ksImportItemJson(e);}},ksImportItemJson:function(e){var self=this;$('.ks_input_import_item_button').click();},ksImportItem:function(e){var self=this;var fileReader=new FileReader();fileReader.onload=function(){$('.ks_input_import_item_button').val('');framework.blockUI();self._rpc({model:'ks_dashboard_ninja.board',method:'ks_import_item',args:[self.ks_dashboard_id],kwargs:{file:fileReader.result,dashboard_id:self.ks_dashboard_id}}).then(function(result){if(result==="Success"){$.when(self.ks_fetch_data()).then(function(){$.when(self.ks_fetch_items_data()).then(function(result){self.ksRenderDashboard();});framework.unblockUI();});}});};fileReader.readAsText($('.ks_input_import_item_button').prop('files')[0]);},_onKsAddLayoutClick:function(){var self=this;self.do_action({type:'ir.actions.act_window',res_model:'ks_dashboard_ninja.item',view_id:'ks_dashboard_ninja_list_form_view',views:[[false,'form']],target:'current',context:{'ks_dashboard_id':self.ks_dashboard_id,'form_view_ref':'ks_dashboard_ninja.item_form_view','form_view_initial_mode':'edit',},},{on_reverse_breadcrumb:this.on_reverse_breadcrumb,});},_onKsEditLayoutClick:function(){var self=this;self.grid.setStatic(false);self._ksRenderEditMode();},_onKsSaveLayoutClick:function(){this.grid.setStatic(true)
var self=this;var dashboard_title=$('#ks_dashboard_title_input').val();if(dashboard_title!=false&&dashboard_title!=0&&dashboard_title!==self.ks_dashboard_data.name){self.ks_dashboard_data.name=dashboard_title;var model='ks_dashboard_ninja.board';var rec_id=self.ks_dashboard_id;if(this.ks_dashboard_data.ks_selected_board_id&&this.ks_dashboard_data.ks_child_boards){this.ks_dashboard_data.ks_child_boards[this.ks_dashboard_data.ks_selected_board_id][0]=dashboard_title;if(this.ks_dashboard_data.ks_selected_board_id!=='ks_default'){model='ks_dashboard_ninja.child_board';rec_id=this.ks_dashboard_data.ks_selected_board_id;}}
this._rpc({model:model,method:'write',args:[rec_id,{'name':dashboard_title}],})}
if(this.ks_dashboard_data.ks_item_data)self._ksSaveCurrentLayout();self._ksRenderActiveMode();},_onKsCreateLayoutClick:function(){var self=this;self.grid.setStatic(true)
var dashboard_title=$('#ks_dashboard_title_input').val();if(dashboard_title===""){self.call('notification','notify',{message:"Dashboard Name is required to save as New Layout.",type:'warning',});}else{if(!self.ks_dashboard_data.ks_child_boards){self.ks_dashboard_data.ks_child_boards={'ks_default':[this.ks_dashboard_data.name,self.ks_dashboard_data.ks_gridstack_config]}}
this.ks_dashboard_data.name=dashboard_title;var grid_config=self.ks_get_current_gridstack_config();this._rpc({model:'ks_dashboard_ninja.board',method:'update_child_board',args:['create',self.ks_dashboard_id,{"ks_gridstack_config":JSON.stringify(grid_config),"ks_dashboard_ninja_id":self.ks_dashboard_id,"name":dashboard_title,"ks_active":true,"company_id":self.ks_dashboard_data.ks_company_id,}],}).then(function(res_id){self.ks_update_child_board_value(dashboard_title,res_id,grid_config),self._ksRenderActiveMode();});}},ks_update_child_board_value:function(dashboard_title,res_id,grid_config){var self=this;var child_board_id=res_id.toString();self.ks_dashboard_data.ks_selected_board_id=child_board_id;var update_data={};update_data[child_board_id]=[dashboard_title,JSON.stringify(grid_config)];self.ks_dashboard_data.ks_child_boards=_.extend(update_data,self.ks_dashboard_data.ks_child_boards);},_onKsCancelLayoutClick:function(){var self=this;$.when(self.ks_fetch_data()).then(function(){$.when(self.ks_fetch_items_data()).then(function(result){self.ksRenderDashboard();self.ks_set_update_interval();});});},_onKsItemClick:function(e){var self=this;if(self.ksAllowItemClick){e.preventDefault();if(e.target.title!="Customize Item"){var item_id=parseInt(e.currentTarget.firstElementChild.id);var item_data=self.ks_dashboard_data.ks_item_data[item_id];if(item_data&&item_data.ks_show_records){if(item_data.action){if(!item_data.ks_is_client_action){var action=Object.assign({},item_data.action);if(action.view_mode.includes('tree'))action.view_mode=action.view_mode.replace('tree','list');for(var i=0;i<action.views.length;i++)action.views[i][1].includes('tree')?action.views[i][1]=action.views[i][1].replace('tree','list'):action.views[i][1];action['domain']=item_data.ks_domain||[];action['search_view_id']=[action.search_view_id,'search']}else{var action=Object.assign({},item_data.action[0]);if(action.params){action.params.default_active_id||'mailbox_inbox';}else{action.params={'default_active_id':'mailbox_inbox'}
action.context={}
action.context.params={'active_model':false};}}}else{var action={name:_t(item_data.name),type:'ir.actions.act_window',res_model:item_data.ks_model_name,domain:item_data.ks_domain||"[]",views:[[false,'list'],[false,'form']],view_mode:'list',target:'current',}}
self.do_action(action,{on_reverse_breadcrumb:self.on_reverse_breadcrumb,});}}}else{self.ksAllowItemClick=true;}},_onKsItemCustomizeClick:function(e){var self=this;var id=parseInt($($(e.currentTarget).parentsUntil('.grid-stack').slice(-1)[0]).attr('id'))
self.ks_open_item_form_page(id);e.stopPropagation();},ks_open_item_form_page:function(id){var self=this;self.do_action({type:'ir.actions.act_window',res_model:'ks_dashboard_ninja.item',view_id:'ks_dashboard_ninja_list_form_view',views:[[false,'form']],target:'current',context:{'form_view_ref':'ks_dashboard_ninja.item_form_view','form_view_initial_mode':'edit',},res_id:id},{on_reverse_breadcrumb:this.on_reverse_breadcrumb,});},ksUpdateDashboardItem:function(ids){var self=this;for(var i=0;i<ids.length;i++){var item_data=self.ks_dashboard_data.ks_item_data[ids[i]]
if(item_data['ks_dashboard_item_type']=='ks_list_view'){var item_view=self.$el.find(".grid-stack-item[gs-id="+item_data.id+"]");var name=item_data.name?item_data.name:item_data.ks_model_display_name;item_view.children().find('.ks_list_view_heading').prop('title',name);item_view.children().find('.ks_list_view_heading').text(name);item_view.find('.card-body').empty();item_view.find('.ks_dashboard_item_drill_up').addClass('d-none')
item_view.find('.ks_dashboard_item_action_export').removeClass('d-none')
item_view.find('.ks_dashboard_quick_edit_action_popup ').removeClass('d-none')
item_view.find('.card-body').append(self.renderListViewData(item_data));var rows=JSON.parse(item_data['ks_list_view_data']).data_rows;var ks_length=rows?rows.length:false;if(ks_length){if(item_view.find('.ks_pager_name')){item_view.find('.ks_pager_name').empty();var $ks_pager_container=QWeb.render('ks_pager_template',{item_id:ids[i],intial_count:item_data.ks_pagination_limit,offset:1})
item_view.find('.ks_pager_name').append($($ks_pager_container));}
if(ks_length<item_data.ks_pagination_limit)item_view.find('.ks_load_next').addClass('ks_event_offer_list');item_view.find('.ks_value').text("1-"+JSON.parse(item_data['ks_list_view_data']).data_rows.length);if(item_data.ks_record_data_limit==item_data.ks_pagination_limit||item_data.ks_record_count==item_data.ks_pagination_limit){item_view.find('.ks_load_next').addClass('ks_event_offer_list');}}else{item_view.find('.ks_pager').addClass('d-none');}}else if(item_data['ks_dashboard_item_type']=='ks_tile'){var item_view=self._ksRenderDashboardTile(item_data);self.$el.find(".grid-stack-item[gs-id="+item_data.id+"]").find(".ks_dashboard_item_hover").replaceWith($(item_view).find('.ks_dashboarditem_id'));}else if(item_data['ks_dashboard_item_type']=='ks_kpi'){var item_view=self.renderKpi(item_data);self.$el.find(".grid-stack-item[gs-id="+item_data.id+"]").find(".ks_dashboard_item_hover").replaceWith($(item_view).find('.ks_dashboarditem_id'));}else{self.grid.removeWidget(self.$el.find(".grid-stack-item[gs-id="+item_data.id+"]")[0]);self.ksRenderDashboardItems([item_data]);}}
self.grid.setStatic(true);},_onKsDeleteItemClick:function(e){var self=this;var item=$($(e.currentTarget).parentsUntil('.grid-stack').slice(-1)[0])
var id=parseInt($($(e.currentTarget).parentsUntil('.grid-stack').slice(-1)[0]).attr('gs-id'));self.ks_delete_item(id,item);e.stopPropagation();},ks_delete_item:function(id,item){var self=this;Dialog.confirm(this,(_t("Are you sure you want to remove this item?")),{confirm_callback:function(){self._rpc({model:'ks_dashboard_ninja.item',method:'unlink',args:[id],}).then(function(result){self.ks_remove_update_interval();delete self.ks_dashboard_data.ks_item_data[id];self.grid.removeWidget(item);self.ks_set_update_interval();if(Object.keys(self.ks_dashboard_data.ks_item_data).length>0){self._ksSaveCurrentLayout();}
else{self._ksRenderNoItemView();self.ksRenderDashboard();}
$.when(self.ks_fetch_data()).then(function(){$.when(self.ks_fetch_items_data()).then(function(){self.ks_remove_update_interval();self.ksRenderDashboard();self.ks_set_update_interval();});});});},});},ks_add_dashboard_item_on_empty:function(e){var self=this;if(e.currentTarget.dataset.item!=="ks_json"){self.do_action({type:'ir.actions.act_window',res_model:'ks_dashboard_ninja.item',view_id:'ks_dashboard_ninja_list_form_view',views:[[false,'form']],target:'current',context:{'ks_dashboard_id':self.ks_dashboard_id,'form_view_ref':'ks_dashboard_ninja.item_form_view','form_view_initial_mode':'edit',},},{on_reverse_breadcrumb:this.on_reverse_breadcrumb,});}else{self.ksImportItemJson(e);}},_ksSaveCurrentLayout:function(){var self=this;var grid_config=self.ks_get_current_gridstack_config();var model='ks_dashboard_ninja.child_board';var rec_id=self.ks_dashboard_data.ks_gridstack_config_id;self.ks_dashboard_data.ks_gridstack_config=JSON.stringify(grid_config);if(this.ks_dashboard_data.ks_selected_board_id&&this.ks_dashboard_data.ks_child_boards){this.ks_dashboard_data.ks_child_boards[this.ks_dashboard_data.ks_selected_board_id][1]=JSON.stringify(grid_config);if(this.ks_dashboard_data.ks_selected_board_id!=='ks_default'){rec_id=this.ks_dashboard_data.ks_selected_board_id;}}
if(!config.device.isMobile){this._rpc({model:model,method:'write',args:[rec_id,{"ks_gridstack_config":JSON.stringify(grid_config)}],});}},ks_get_current_gridstack_config:function(){var self=this;if(document.querySelector('.grid-stack').gridstack){var items=document.querySelector('.grid-stack').gridstack.el.gridstack.engine.nodes;}
var grid_config={}
if(self.ks_dashboard_data.ks_gridstack_config){_.extend(grid_config,JSON.parse(self.ks_dashboard_data.ks_gridstack_config))}
if(items){for(var i=0;i<items.length;i++){grid_config[items[i].id]={'x':items[i].x,'y':items[i].y,'w':items[i].w,'h':items[i].h,}}}
return grid_config;},_renderListView:function(item,grid){var self=this;var list_view_data=JSON.parse(item.ks_list_view_data),pager=true,item_id=item.id,data_rows=list_view_data.data_rows,length=data_rows?data_rows.length:false,item_title=item.name;var $ksItemContainer=self.renderListViewData(item);var ks_data_calculation_type=self.ks_dashboard_data.ks_item_data[item_id].ks_data_calculation_type
var $ks_gridstack_container=$(QWeb.render('ks_gridstack_list_view_container',{ks_chart_title:item_title,ksIsDashboardManager:self.ks_dashboard_data.ks_dashboard_manager,ks_dashboard_list:self.ks_dashboard_data.ks_dashboard_list,item_id:item_id,count:'1-'+length,offset:1,intial_count:length,ks_pager:pager,calculation_type:ks_data_calculation_type})).addClass('ks_dashboarditem_id');if(item.ks_pagination_limit<length){$ks_gridstack_container.find('.ks_load_next').addClass('ks_event_offer_list');}
if(length<item.ks_pagination_limit){$ks_gridstack_container.find('.ks_load_next').addClass('ks_event_offer_list');}
if(item.ks_record_data_limit===item.ks_pagination_limit){$ks_gridstack_container.find('.ks_load_next').addClass('ks_event_offer_list');}
if(length==0){$ks_gridstack_container.find('.ks_pager').addClass('d-none');}
if(item.ks_pagination_limit==0){$ks_gridstack_container.find('.ks_pager_name').addClass('d-none');}
$ks_gridstack_container.find('.card-body').append($ksItemContainer);if(item.ks_data_calculation_type==='query'||item.ks_list_view_type==="ungrouped"){$ks_gridstack_container.find('.ks_list_canvas_click').removeClass('ks_list_canvas_click');}
item.$el=$ks_gridstack_container;if(item_id in self.gridstackConfig){grid.addWidget($ks_gridstack_container[0],{x:self.gridstackConfig[item_id].x,y:self.gridstackConfig[item_id].y,w:self.gridstackConfig[item_id].w,h:self.gridstackConfig[item_id].h,autoPosition:false,minW:3,maxW:null,minH:3,maxH:null,id:item_id});}else{grid.addWidget($ks_gridstack_container[0],{x:0,y:0,w:5,h:4,autoPosition:true,minW:4,maxW:null,minH:3,maxH:null,id:item_id});}},renderListViewData:function(item){var self=this;var list_view_data=JSON.parse(item.ks_list_view_data);var item_id=item.id,data_rows=list_view_data.data_rows,item_title=item.name;if(item.ks_list_view_type==="ungrouped"&&list_view_data){if(list_view_data.date_index){var index_data=list_view_data.date_index;for(var i=0;i<index_data.length;i++){for(var j=0;j<list_view_data.data_rows.length;j++){var index=index_data[i]
var date=list_view_data.data_rows[j]["data"][index]
if(date){if(list_view_data.fields_type[index]==='date'){list_view_data.data_rows[j]["data"][index]=field_utils.format.date(moment(moment(date).utc(true)._d),{},{timezone:false});}else{list_view_data.data_rows[j]["data"][index]=field_utils.format.datetime(moment(moment(date).utc(true)._d),{},{timezone:false});}}else{list_view_data.data_rows[j]["data"][index]="";}}}}}
if(list_view_data){for(var i=0;i<list_view_data.data_rows.length;i++){for(var j=0;j<list_view_data.data_rows[0]["data"].length;j++){if(typeof(list_view_data.data_rows[i].data[j])==="number"||list_view_data.data_rows[i].data[j]){if(typeof(list_view_data.data_rows[i].data[j])==="number"){list_view_data.data_rows[i].data[j]=field_utils.format.float(list_view_data.data_rows[i].data[j],Float64Array,{digits:[0,item.ks_precision_digits]})}}else{list_view_data.data_rows[i].data[j]="";}}}}
var $ksItemContainer=$(QWeb.render('ks_list_view_table',{list_view_data:list_view_data,item_id:item_id,list_type:item.ks_list_view_type,isDrill:self.ks_dashboard_data.ks_item_data[item_id]['isDrill']}));self.list_container=$ksItemContainer;if(list_view_data){var $ksitemBody=self.ksListViewBody(list_view_data,item_id)
self.list_container.find('.ks_table_body').append($ksitemBody)}
if(item.ks_list_view_type==="ungrouped"){$ksItemContainer.find('.ks_list_canvas_click').removeClass('ks_list_canvas_click');}
if(!item.ks_show_records){$ksItemContainer.find('#ks_item_info').hide();}
return $ksItemContainer},ksListViewBody:function(list_view_data,item_id){var self=this;var itemid=item_id
var ks_data_calculation_type=self.ks_dashboard_data.ks_item_data[item_id].ks_data_calculation_type;var list_view_type=self.ks_dashboard_data.ks_item_data[item_id].ks_list_view_type
var $ksitemBody=$(QWeb.render('ks_list_view_tmpl',{list_view_data:list_view_data,item_id:itemid,calculation_type:ks_data_calculation_type,isDrill:self.ks_dashboard_data.ks_item_data[item_id]['isDrill'],list_type:list_view_type,}));return $ksitemBody;},ksSum:function(count_1,count_2,item_info,field,target_1,$kpi_preview,kpi_data){var self=this;var count=count_1+count_2;if(field.ks_multiplier_active){item_info['count']=KsGlobalFunction._onKsGlobalFormatter(count*field.ks_multiplier,field.ks_data_formatting,field.ks_precision_digits);item_info['count_tooltip']=field_utils.format.float(count*field.ks_multiplier,Float64Array,{digits:[0,field.ks_precision_digits]});}else{item_info['count']=KsGlobalFunction._onKsGlobalFormatter(count,field.ks_data_formatting,field.ks_precision_digits);item_info['count_tooltip']=field_utils.format.float(parseFloat(count),Float64Array,{digits:[0,field.ks_precision_digits]});}
if(field.ks_multiplier_active){count=count*field.ks_multiplier;}
item_info['target_enable']=field.ks_goal_enable;var ks_color=(target_1-count)>0?"red":"green";item_info.pre_arrow=(target_1-count)>0?"down":"up";item_info['ks_comparison']=true;var target_deviation=(target_1-count)>0?Math.round(((target_1-count)/target_1)*100):Math.round((Math.abs((target_1-count))/target_1)*100);if(target_deviation!==Infinity)item_info.target_deviation=field_utils.format.integer(target_deviation)+"%";else{item_info.target_deviation=target_deviation;item_info.pre_arrow=false;}
var target_progress_deviation=target_1==0?0:Math.round((count/target_1)*100);item_info.target_progress_deviation=field_utils.format.integer(target_progress_deviation)+"%";$kpi_preview=$(QWeb.render("ks_kpi_template_2",item_info));$kpi_preview.find('.target_deviation').css({"color":ks_color});if(field.ks_target_view==="Progress Bar"){$kpi_preview.find('#ks_progressbar').val(target_progress_deviation)}
return $kpi_preview;},ksPercentage:function(count_1,count_2,field,item_info,target_1,$kpi_preview,kpi_data){if(field.ks_multiplier_active){count_1=count_1*field.ks_multiplier;count_2=count_2*field.ks_multiplier;}
var count=parseInt((count_1/count_2)*100);if(field.ks_multiplier_active){count=count*field.ks_multiplier;}
item_info['count']=count?field_utils.format.integer(count)+"%":"0%";item_info['count_tooltip']=count?count+"%":"0%";item_info.target_progress_deviation=item_info['count']
target_1=target_1>100?100:target_1;item_info.target=target_1+"%";item_info.pre_arrow=(target_1-count)>0?"down":"up";var ks_color=(target_1-count)>0?"red":"green";item_info['target_enable']=field.ks_goal_enable;item_info['ks_comparison']=false;item_info.target_deviation=item_info.target>100?100:item_info.target;$kpi_preview=$(QWeb.render("ks_kpi_template_2",item_info));$kpi_preview.find('.target_deviation').css({"color":ks_color});if(field.ks_target_view==="Progress Bar"){if(count)$kpi_preview.find('#ks_progressbar').val(count);else $kpi_preview.find('#ks_progressbar').val(0);}
return $kpi_preview;},renderKpi:function(item,grid){var self=this;var field=item;var ks_date_filter_selection=field.ks_date_filter_selection;if(field.ks_date_filter_selection==="l_none")ks_date_filter_selection=self.ks_dashboard_data.ks_date_filter_selection;var ks_valid_date_selection=['l_day','t_week','t_month','t_quarter','t_year'];var kpi_data=JSON.parse(field.ks_kpi_data);var count_1=kpi_data[0].record_data;var count_2=kpi_data[1]?kpi_data[1].record_data:undefined;var target_1=kpi_data[0].target;var target_view=field.ks_target_view,pre_view=field.ks_prev_view;var ks_rgba_background_color=self._ks_get_rgba_format(field.ks_background_color);var ks_rgba_button_color=self._ks_get_rgba_format(field.ks_button_color);var ks_rgba_font_color=self._ks_get_rgba_format(field.ks_font_color);if(field.ks_goal_enable){var diffrence=0.0
if(field.ks_multiplier_active){diffrence=(count_1*field.ks_multiplier)-target_1}else{diffrence=count_1-target_1}
var acheive=diffrence>=0?true:false;diffrence=Math.abs(diffrence);var deviation=Math.round((diffrence/target_1)*100)
if(deviation!==Infinity)deviation=deviation?field_utils.format.integer(deviation)+'%':0+'%';}
if(field.ks_previous_period&&ks_valid_date_selection.indexOf(ks_date_filter_selection)>=0){var previous_period_data=kpi_data[0].previous_period;var pre_diffrence=(count_1-previous_period_data);if(field.ks_multiplier_active){var previous_period_data=kpi_data[0].previous_period*field.ks_multiplier;var pre_diffrence=(count_1*field.ks_multiplier-previous_period_data);}
var pre_acheive=pre_diffrence>0?true:false;pre_diffrence=Math.abs(pre_diffrence);var pre_deviation=previous_period_data?field_utils.format.integer(parseInt((pre_diffrence/previous_period_data)*100))+'%':"100%"}
item['ksIsDashboardManager']=self.ks_dashboard_data.ks_dashboard_manager;var ks_icon_url;if(field.ks_icon_select=="Custom"){if(field.ks_icon[0]){ks_icon_url='data:image/'+(self.file_type_magic_word[field.ks_icon[0]]||'png')+';base64,'+field.ks_icon;}else{ks_icon_url=false;}}
var target_progress_deviation=String(Math.round((count_1/target_1)*100));if(field.ks_multiplier_active){var target_progress_deviation=String(Math.round(((count_1*field.ks_multiplier)/target_1)*100));}
var ks_rgba_icon_color=self._ks_get_rgba_format(field.ks_default_icon_color)
var item_info={item:item,id:field.id,count_1:KsGlobalFunction.ksNumFormatter(kpi_data[0]['record_data'],1),count_1_tooltip:kpi_data[0]['record_data'],count_2:kpi_data[1]?String(kpi_data[1]['record_data']):false,name:field.name?field.name:field.ks_model_id.data.display_name,target_progress_deviation:target_progress_deviation,icon_select:field.ks_icon_select,default_icon:field.ks_default_icon,icon_color:ks_rgba_icon_color,target_deviation:deviation,target_arrow:acheive?'up':'down',ks_enable_goal:field.ks_goal_enable,ks_previous_period:ks_valid_date_selection.indexOf(ks_date_filter_selection)>=0?field.ks_previous_period:false,target:KsGlobalFunction.ksNumFormatter(target_1,1),previous_period_data:previous_period_data,pre_deviation:pre_deviation,pre_arrow:pre_acheive?'up':'down',target_view:field.ks_target_view,pre_view:field.ks_prev_view,ks_dashboard_list:self.ks_dashboard_data.ks_dashboard_list,ks_icon_url:ks_icon_url,ks_rgba_button_color:ks_rgba_button_color,}
if(item_info.target_deviation===Infinity)item_info.target_arrow=false;item_info.target_progress_deviation=parseInt(item_info.target_progress_deviation)?field_utils.format.integer(parseInt(item_info.target_progress_deviation)):"0"
if(field.ks_multiplier_active){item_info['count_1']=KsGlobalFunction._onKsGlobalFormatter(kpi_data[0]['record_data']*field.ks_multiplier,field.ks_data_formatting,field.ks_precision_digits);item_info['count_1_tooltip']=kpi_data[0]['record_data']*field.ks_multiplier}else{item_info['count_1']=KsGlobalFunction._onKsGlobalFormatter(kpi_data[0]['record_data'],field.ks_data_formatting,field.ks_precision_digits);}
item_info['target']=KsGlobalFunction._onKsGlobalFormatter(kpi_data[0].target,field.ks_data_formatting,field.ks_precision_digits);var $kpi_preview;if(!kpi_data[1]){if(field.ks_target_view==="Number"||!field.ks_goal_enable){$kpi_preview=$(QWeb.render("ks_kpi_template",item_info));}else if(field.ks_target_view==="Progress Bar"&&field.ks_goal_enable){$kpi_preview=$(QWeb.render("ks_kpi_template_3",item_info));$kpi_preview.find('#ks_progressbar').val(parseInt(item_info.target_progress_deviation));}
if(field.ks_goal_enable){if(acheive){$kpi_preview.find(".target_deviation").css({"color":"green",});}else{$kpi_preview.find(".target_deviation").css({"color":"red",});}}
if(field.ks_previous_period&&String(previous_period_data)&&ks_valid_date_selection.indexOf(ks_date_filter_selection)>=0){if(pre_acheive){$kpi_preview.find(".pre_deviation").css({"color":"green",});}else{$kpi_preview.find(".pre_deviation").css({"color":"red",});}}
if($kpi_preview.find('.ks_target_previous').children().length!==2){$kpi_preview.find('.ks_target_previous').addClass('justify-content-center');}}else{switch(field.ks_data_comparison){case"None":if(field.ks_multiplier_active){var count_tooltip=String(count_1*field.ks_multiplier)+"/"+String(count_2*field.ks_multiplier);var count=String(KsGlobalFunction.ksNumFormatter(count_1*field.ks_multiplier,1))+"/"+String(KsGlobalFunction.ksNumFormatter(count_2*field.ks_multiplier,1));item_info['count']=String(KsGlobalFunction._onKsGlobalFormatter(count_1*field.ks_multiplier,field.ks_data_formatting,field.ks_precision_digits))+"/"+String(KsGlobalFunction._onKsGlobalFormatter(count_2*field.ks_multiplier,field.ks_data_formatting,field.ks_precision_digits));}else{var count_tooltip=String(count_1)+"/"+String(count_2);var count=String(KsGlobalFunction.ksNumFormatter(count_1,1))+"/"+String(KsGlobalFunction.ksNumFormatter(count_2,1));item_info['count']=String(KsGlobalFunction._onKsGlobalFormatter(count_1,field.ks_data_formatting,field.ks_precision_digits))+"/"+String(KsGlobalFunction._onKsGlobalFormatter(count_2,field.ks_data_formatting,field.ks_precision_digits));}
item_info['count_tooltip']=count_tooltip;item_info['target_enable']=false;$kpi_preview=$(QWeb.render("ks_kpi_template_2",item_info));break;case"Sum":$kpi_preview=self.ksSum(count_1,count_2,item_info,field,target_1,$kpi_preview,kpi_data);break;case"Percentage":$kpi_preview=self.ksPercentage(count_1,count_2,field,item_info,target_1,$kpi_preview,kpi_data);break;case"Ratio":var gcd=self.ks_get_gcd(Math.round(count_1),Math.round(count_2));if(item.ks_data_formatting=='exact'){if(count_1&&count_2){item_info['count_tooltip']=count_1/gcd+":"+count_2/gcd;item_info['count']=field_utils.format.float(count_1/gcd,Float64Array,{digits:[0,field.ks_precision_digits]})+":"+field_utils.format.float(count_2/gcd,Float64Array,{digits:[0,field.ks_precision_digits]});}else{item_info['count_tooltip']=count_1+":"+count_2;item_info['count']=count_1+":"+count_2}}else{if(count_1&&count_2){item_info['count_tooltip']=count_1/gcd+":"+count_2/gcd;item_info['count']=KsGlobalFunction.ksNumFormatter(count_1/gcd,1)+":"+KsGlobalFunction.ksNumFormatter(count_2/gcd,1);}else{item_info['count_tooltip']=(count_1)+":"+count_2;item_info['count']=KsGlobalFunction.ksNumFormatter(count_1,1)+":"+KsGlobalFunction.ksNumFormatter(count_2,1);}}
item_info['target_enable']=false;$kpi_preview=$(QWeb.render("ks_kpi_template_2",item_info));break;}}
$kpi_preview.find('.ks_dashboarditem_id').css({"background-color":ks_rgba_background_color,"color":ks_rgba_font_color,});return $kpi_preview},ks_get_gcd:function(a,b){return(b==0)?a:this.ks_get_gcd(b,a%b);},_onKsInputChange:function(e){this.ksNewDashboardName=e.target.value},onKsDuplicateItemClick:function(e){var self=this;var ks_item_id=$($(e.target).parentsUntil(".ks_dashboarditem_id").slice(-1)[0]).parent().attr('id');var dashboard_id=$($(e.target).parentsUntil(".ks_dashboarditem_id").slice(-1)[0]).find('.ks_dashboard_select').val();var dashboard_name=$($(e.target).parentsUntil(".ks_dashboarditem_id").slice(-1)[0]).find('.ks_dashboard_select option:selected').text();this._rpc({model:'ks_dashboard_ninja.item',method:'copy',args:[parseInt(ks_item_id),{'ks_dashboard_ninja_board_id':parseInt(dashboard_id)}],}).then(function(result){self.do_notify(_t("Item Duplicated"),_t('Selected item is duplicated to '+dashboard_name+' .'));$.when(self.ks_fetch_data()).then(function(){self.ks_fetch_items_data().then(function(){self.ksRenderDashboard();});});})},ksOnListItemInfoClick:function(e){var self=this;var item_id=e.currentTarget.dataset.itemId;var item_data=self.ks_dashboard_data.ks_item_data[item_id];var action={name:_t(item_data.name),type:'ir.actions.act_window',res_model:e.currentTarget.dataset.model,domain:item_data.ks_domain||[],views:[[false,'list'],[false,'form']],target:'current',}
if(e.currentTarget.dataset.listViewType==="ungrouped"){action['view_mode']='form';action['views']=[[false,'form']];action['res_id']=parseInt(e.currentTarget.dataset.recordId);}else{if(e.currentTarget.dataset.listType==="date_type"){var domain=JSON.parse(e.currentTarget.parentElement.parentElement.dataset.domain);action['view_mode']='list';action['context']={'group_by':e.currentTarget.dataset.groupby,};action['domain']=domain;}else if(e.currentTarget.dataset.listType==="relational_type"){var domain=JSON.parse(e.currentTarget.parentElement.parentElement.dataset.domain);action['view_mode']='list';action['context']={'group_by':e.currentTarget.dataset.groupby,};action['domain']=domain;action['context']['search_default_'+e.currentTarget.dataset.groupby]=parseInt(e.currentTarget.dataset.recordId);}else if(e.currentTarget.dataset.listType==="other"){var domain=JSON.parse(e.currentTarget.parentElement.parentElement.dataset.domain);action['view_mode']='list';action['context']={'group_by':e.currentTarget.dataset.groupby,};action['context']['search_default_'+e.currentTarget.dataset.groupby]=parseInt(e.currentTarget.dataset.recordId);action['domain']=domain;}}
self.do_action(action,{on_reverse_breadcrumb:this.on_reverse_breadcrumb,});},onKsMoveItemClick:function(e){var self=this;var ks_item_id=$($(e.target).parentsUntil(".ks_dashboarditem_id").slice(-1)[0]).parent().attr('id');var dashboard_id=$($(e.target).parentsUntil(".ks_dashboarditem_id").slice(-1)[0]).find('.ks_dashboard_select').val();var dashboard_name=$($(e.target).parentsUntil(".ks_dashboarditem_id").slice(-1)[0]).find('.ks_dashboard_select option:selected').text();this._rpc({model:'ks_dashboard_ninja.item',method:'write',args:[parseInt(ks_item_id),{'ks_dashboard_ninja_board_id':parseInt(dashboard_id)}],}).then(function(result){self.do_notify(_t("Item Moved"),_t('Selected item is moved to '+dashboard_name+' .'));$.when(self.ks_fetch_data()).then(function(){$.when(self.ks_fetch_items_data()).then(function(){self.ks_remove_update_interval();self.ksRenderDashboard();self.ks_set_update_interval();});});});},_KsGetDateValues:function(){var self=this;var date_filter_selected=self.ks_dashboard_data.ks_date_filter_selection;if(self.ksDateFilterSelection=='l_none'){date_filter_selected=self.ksDateFilterSelection;}
self.$el.find('#'+date_filter_selected).addClass("ks_date_filter_selected");self.$el.find('#ks_date_filter_selection').text(self.ks_date_filter_selections[date_filter_selected]);if(self.ks_dashboard_data.ks_date_filter_selection==='l_custom'){self.$el.find('.ks_date_input_fields').removeClass("ks_hide");self.$el.find('.ks_date_filter_dropdown').addClass("ks_btn_first_child_radius");}else if(self.ks_dashboard_data.ks_date_filter_selection!=='l_custom'){self.$el.find('.ks_date_input_fields').addClass("ks_hide");}},_onKsClearDateValues:function(ks_l_none=false){var self=this;self.ksDateFilterSelection='l_none';self.ksDateFilterStartDate=false;self.ksDateFilterEndDate=false;self.ks_fetch_items_data().then(function(){self.ksRenderDashboard();$('.ks_date_input_fields').addClass("ks_hide");$('.ks_date_filter_dropdown').removeClass("ks_btn_first_child_radius");});},_renderDateFilterDatePicker:function(){var self=this;self.$el.find(".ks_dashboard_link").removeClass("ks_hide");var startDate=self.ks_dashboard_data.ks_dashboard_start_date?moment.utc(self.ks_dashboard_data.ks_dashboard_start_date).local():moment();var endDate=self.ks_dashboard_data.ks_dashboard_end_date?moment.utc(self.ks_dashboard_data.ks_dashboard_end_date).local():moment();this.ksStartDatePickerWidget=new(datepicker.DateTimeWidget)(this);this.ksStartDatePickerWidget.appendTo(self.$el.find(".ks_date_input_fields")).then((function(){this.ksStartDatePickerWidget.$el.addClass("ks_btn_middle_child o_input");this.ksStartDatePickerWidget.$el.find("input").attr("placeholder","Start Date");this.ksStartDatePickerWidget.setValue(startDate);this.ksStartDatePickerWidget.on("datetime_changed",this,function(){self.$el.find(".apply-dashboard-date-filter").removeClass("ks_hide");self.$el.find(".clear-dashboard-date-filter").removeClass("ks_hide");});}).bind(this));this.ksEndDatePickerWidget=new(datepicker.DateTimeWidget)(this);this.ksEndDatePickerWidget.appendTo(self.$el.find(".ks_date_input_fields")).then((function(){this.ksEndDatePickerWidget.$el.addClass("ks_btn_last_child o_input");this.ksStartDatePickerWidget.$el.find("input").attr("placeholder","Start Date");this.ksEndDatePickerWidget.setValue(endDate);this.ksEndDatePickerWidget.on("datetime_changed",this,function(){self.$el.find(".apply-dashboard-date-filter").removeClass("ks_hide");self.$el.find(".clear-dashboard-date-filter").removeClass("ks_hide");});}).bind(this));self._KsGetDateValues();},_onKsApplyDateFilter:function(e){var self=this;var start_date=self.ksStartDatePickerWidget.$input.val();var end_date=self.ksEndDatePickerWidget.$input.val();if(start_date==="Invalid date"){alert("Invalid Date is given in Start Date.")}else if(end_date==="Invalid date"){alert("Invalid Date is given in End Date.")}else if(self.$el.find('.ks_date_filter_selected').attr('id')!=="l_custom"){self.ksDateFilterSelection=self.$el.find('.ks_date_filter_selected').attr('id');self.ks_fetch_items_data().then(function(result){self.ksUpdateDashboardItem(Object.keys(self.ks_dashboard_data.ks_item_data));self.$el.find(".apply-dashboard-date-filter").addClass("ks_hide");self.$el.find(".clear-dashboard-date-filter").addClass("ks_hide");});}else{if(start_date&&end_date){if(moment(start_date,self.datetime_format)<=moment(end_date,self.datetime_format)){var start_date=new moment(start_date,self.datetime_format).format("YYYY-MM-DD H:m:s");var end_date=new moment(end_date,self.datetime_format).format("YYYY-MM-DD H:m:s");if(start_date==="Invalid date"||end_date==="Invalid date"){alert(_t("Invalid Date"));}else{self.ksDateFilterSelection=self.$el.find('.ks_date_filter_selected').attr('id');self.ksDateFilterStartDate=start_date;self.ksDateFilterEndDate=end_date;self.ks_fetch_items_data().then(function(result){self.ksUpdateDashboardItem(Object.keys(self.ks_dashboard_data.ks_item_data));self.$el.find(".apply-dashboard-date-filter").addClass("ks_hide");self.$el.find(".clear-dashboard-date-filter").addClass("ks_hide");});}}else{alert(_t("Start date should be less than end date"));}}else{alert(_t("Please enter start date and end date"));}}},_ksOnDateFilterMenuSelect:function(e){if(e.target.id!=='ks_date_selector_container'){var self=this;_.each($('.ks_date_filter_selected'),function($filter_options){$($filter_options).removeClass("ks_date_filter_selected")});$(e.target.parentElement).addClass("ks_date_filter_selected");$('#ks_date_filter_selection').text(self.ks_date_filter_selections[e.target.parentElement.id]);if(e.target.parentElement.id!=="l_custom"){e.target.parentElement.id==="l_none"?self._onKsClearDateValues(true):self._onKsApplyDateFilter();$('.ks_date_input_fields').addClass("ks_hide");$('.ks_date_filter_dropdown').removeClass("ks_btn_first_child_radius");}else if(e.target.parentElement.id==="l_custom"){$("#ks_start_date_picker").val(null).removeClass("ks_hide");$("#ks_end_date_picker").val(null).removeClass("ks_hide");$('.ks_date_input_fields').removeClass("ks_hide");$('.ks_date_filter_dropdown').addClass("ks_btn_first_child_radius");self.$el.find(".apply-dashboard-date-filter").removeClass("ks_hide");self.$el.find(".clear-dashboard-date-filter").removeClass("ks_hide");}}},ksChartExportXlsCsv:function(e){var chart_id=e.currentTarget.dataset.chartId;var name=this.ks_dashboard_data.ks_item_data[chart_id].name;var context=this.getContext();if(this.ks_dashboard_data.ks_item_data[chart_id].ks_dashboard_item_type==='ks_list_view'){var params=this.ksGetParamsForItemFetch(parseInt(chart_id));var data={"header":name,"chart_data":this.ks_dashboard_data.ks_item_data[chart_id].ks_list_view_data,"ks_item_id":chart_id,"ks_export_boolean":true,"context":context,'params':params,}}else{var data={"header":name,"chart_data":this.ks_dashboard_data.ks_item_data[chart_id].ks_chart_data,}}
framework.blockUI();this.getSession().get_file({url:'/ks_dashboard_ninja/export/'+e.currentTarget.dataset.format,data:{data:JSON.stringify(data)},complete:framework.unblockUI,error:(error)=>this.call('crash_manager','rpc_error',error),});},ksChartExportPdf:function(e){var self=this;var chart_id=e.currentTarget.dataset.chartId;var name=this.ks_dashboard_data.ks_item_data[chart_id].name;var base64_image=this.chart_container[chart_id].toBase64Image();var $ks_el=$($(self.$el.find(".grid-stack-item[gs-id="+chart_id+"]")).find('.ks_chart_card_body'));var ks_height=$ks_el.height()
var ks_image_def={content:[{image:base64_image,width:500,height:ks_height,}],images:{bee:base64_image}};pdfMake.createPdf(ks_image_def).download(name+'.pdf');},ksItemExportJson:function(e){var itemId=$(e.target).parents('.ks_dashboard_item_button_container')[0].dataset.item_id;var name=this.ks_dashboard_data.ks_item_data[itemId].name;var data={'header':name,item_id:itemId,}
framework.blockUI();this.getSession().get_file({url:'/ks_dashboard_ninja/export/item_json',data:{data:JSON.stringify(data)},complete:framework.unblockUI,error:(error)=>this.call('crash_manager','rpc_error',error),});e.stopPropagation();},ksLoadMoreRecords:function(e){var self=this;var ks_intial_count=e.target.parentElement.dataset.prevOffset;var ks_offset=e.target.parentElement.dataset.next_offset;var itemId=e.currentTarget.dataset.itemId;var offset=self.ks_dashboard_data.ks_item_data[itemId].ks_pagination_limit;if(itemId in self.ksUpdateDashboard){clearInterval(self.ksUpdateDashboard[itemId])
delete self.ksUpdateDashboard[itemId];}
var params=self.ksGetParamsForItemFetch(parseInt(itemId));this._rpc({model:'ks_dashboard_ninja.board',method:'ks_get_list_view_data_offset',context:self.getContext(),args:[parseInt(itemId),{ks_intial_count:ks_intial_count,offset:ks_offset,},parseInt(self.ks_dashboard_id),params],}).then(function(result){var item_data=self.ks_dashboard_data.ks_item_data[itemId];self.ks_dashboard_data.ks_item_data[itemId]['ks_list_view_data']=result.ks_list_view_data;var item_view=self.$el.find(".grid-stack-item[gs-id="+item_data.id+"]");item_view.find('.card-body').empty();item_view.find('.card-body').append(self.renderListViewData(item_data));$(e.currentTarget).parents('.ks_pager').find('.ks_value').text(result.offset+"-"+result.next_offset);e.target.parentElement.dataset.next_offset=result.next_offset;e.target.parentElement.dataset.prevOffset=result.offset;$(e.currentTarget.parentElement).find('.ks_load_previous').removeClass('ks_event_offer_list');if(result.next_offset<parseInt(result.offset)+(offset-1)||result.next_offset==item_data.ks_record_count||result.next_offset===result.limit){$(e.currentTarget).addClass('ks_event_offer_list');}});},ksLoadPreviousRecords:function(e){var self=this;var itemId=e.currentTarget.dataset.itemId;var offset=self.ks_dashboard_data.ks_item_data[itemId].ks_pagination_limit;var ks_offset=parseInt(e.target.parentElement.dataset.prevOffset)-(offset+1);var ks_intial_count=e.target.parentElement.dataset.next_offset;if(ks_offset<=0){var updateValue=self.ks_dashboard_data.ks_item_data[itemId]["ks_update_items_data"];if(updateValue){var updateinterval=setInterval(function(){self.ksFetchUpdateItem(itemId)},updateValue);self.ksUpdateDashboard[itemId]=updateinterval;}}
var params=self.ksGetParamsForItemFetch(parseInt(itemId));this._rpc({model:'ks_dashboard_ninja.board',method:'ks_get_list_view_data_offset',context:self.getContext(),args:[parseInt(itemId),{ks_intial_count:ks_intial_count,offset:ks_offset,},parseInt(self.ks_dashboard_id),params],}).then(function(result){var item_data=self.ks_dashboard_data.ks_item_data[itemId];self.ks_dashboard_data.ks_item_data[itemId]['ks_list_view_data']=result.ks_list_view_data;var item_view=self.$el.find(".grid-stack-item[gs-id="+item_data.id+"]");item_view.find('.card-body').empty();item_view.find('.card-body').append(self.renderListViewData(item_data));$(e.currentTarget).parents('.ks_pager').find('.ks_value').text(result.offset+"-"+result.next_offset);e.target.parentElement.dataset.next_offset=result.next_offset;e.target.parentElement.dataset.prevOffset=result.offset;$(e.currentTarget.parentElement).find('.ks_load_next').removeClass('ks_event_offer_list');if(result.offset===1){$(e.currentTarget).addClass('ks_event_offer_list');}});},});core.action_registry.add('ks_dashboard_ninja',KsDashboardNinja);return KsDashboardNinja;});;

/* /ks_dashboard_ninja/static/src/js/ks_to_do_dashboard.js defined in bundle 'web.assets_backend' */
odoo.define('ks_dashboard_ninja.ks_to_do_dashboard_filter',function(require){"use strict";var KsDashboard=require('ks_dashboard_ninja.ks_dashboard');var core=require('web.core');var _t=core._t;var QWeb=core.qweb;var Dialog=require('web.Dialog');return KsDashboard.include({events:_.extend({},KsDashboard.prototype.events,{'click .ks_edit_content':'_onKsEditTask','click .ks_delete_content':'_onKsDeleteContent','click .header_add_btn':'_onKsAddTask','click .ks_li_tab':'_onKsUpdateAddButtonAttribute','click .ks_do_item_active_handler':'_onKsActiveHandler',}),ksRenderDashboardItems:function(items){var self=this;self.$el.find('.print-dashboard-btn').addClass("ks_pro_print_hide");if(self.ks_dashboard_data.ks_gridstack_config){self.gridstackConfig=JSON.parse(self.ks_dashboard_data.ks_gridstack_config);}
var item_view;var ks_container_class='grid-stack-item',ks_inner_container_class='grid-stack-item-content';for(var i=0;i<items.length;i++){if(self.grid){if(items[i].ks_dashboard_item_type==='ks_tile'){var item_view=self._ksRenderDashboardTile(items[i])
if(items[i].id in self.gridstackConfig){self.grid.addWidget($(item_view)[0],{x:self.gridstackConfig[items[i].id].x,y:self.gridstackConfig[items[i].id].y,w:self.gridstackConfig[items[i].id].w,h:self.gridstackConfig[items[i].id].h,autoPosition:false,minW:2,maxW:null,minH:2,maxH:2,id:items[i].id,});}else{self.grid.addWidget($(item_view)[0],{x:0,y:0,w:3,h:2,autoPosition:true,minW:2,maxW:null,minH:2,maxH:2,id:items[i].id});}}else if(items[i].ks_dashboard_item_type==='ks_list_view'){self._renderListView(items[i],self.grid)}else if(items[i].ks_dashboard_item_type==='ks_kpi'){var $kpi_preview=self.renderKpi(items[i],self.grid)
if(items[i].id in self.gridstackConfig){self.grid.addWidget($kpi_preview[0],{x:self.gridstackConfig[items[i].id].x,y:self.gridstackConfig[items[i].id].y,w:self.gridstackConfig[items[i].id].w,h:self.gridstackConfig[items[i].id].h,autoPosition:false,minW:2,maxW:null,minH:2,maxH:3,id:items[i].id});}else{self.grid.addWidget($kpi_preview[0],{x:0,y:0,w:3,h:2,autoPosition:true,minW:2,maxW:null,minH:2,maxH:3,id:items[i].id});}}else if(items[i].ks_dashboard_item_type==='ks_to_do'){var $to_do_preview=self.ksRenderToDoDashboardView(items[i]);if(items[i].id in self.gridstackConfig){self.grid.addWidget($to_do_preview[0],{x:self.gridstackConfig[items[i].id].x,y:self.gridstackConfig[items[i].id].y,w:self.gridstackConfig[items[i].id].w,h:self.gridstackConfig[items[i].id].h,autoPosition:false,minW:5,maxW:null,minH:2,maxH:null,id:items[i].id});}else{self.grid.addWidget($to_do_preview[0],{x:0,y:0,w:6,h:4,autoPosition:true,minW:5,maxW:null,minH:2,maxH:null,id:items[i].id})}}else{self._renderGraph(items[i],self.grid)}}}},ksRenderToDoDashboardView:function(item){var self=this;var item_title=item.name;var item_id=item.id;var list_to_do_data=JSON.parse(item.ks_to_do_data)
var ks_header_color=self._ks_get_rgba_format(item.ks_header_bg_color);var ks_font_color=self._ks_get_rgba_format(item.ks_font_color);var ks_rgba_button_color=self._ks_get_rgba_format(item.ks_button_color);var $ksItemContainer=self.ksRenderToDoView(item);var $ks_gridstack_container=$(QWeb.render('ks_to_do_dashboard_container',{ks_chart_title:item_title,ksIsDashboardManager:self.ks_dashboard_data.ks_dashboard_manager,ks_dashboard_list:self.ks_dashboard_data.ks_dashboard_list,item_id:item_id,to_do_view_data:list_to_do_data,ks_rgba_button_color:ks_rgba_button_color,})).addClass('ks_dashboarditem_id')
$ks_gridstack_container.find('.ks_card_header').addClass('ks_bg_to_color').css({"background-color":ks_header_color});$ks_gridstack_container.find('.ks_card_header').addClass('ks_bg_to_color').css({"color":ks_font_color+' !important'});$ks_gridstack_container.find('.ks_li_tab').addClass('ks_bg_to_color').css({"color":ks_font_color+' !important'});$ks_gridstack_container.find('.ks_list_view_heading').addClass('ks_bg_to_color').css({"color":ks_font_color+' !important'});$ks_gridstack_container.find('.ks_to_do_card_body').append($ksItemContainer)
return $ks_gridstack_container;},ksRenderToDoView:function(item,ks_tv_play=false){var self=this;var item_id=item.id;var list_to_do_data=JSON.parse(item.ks_to_do_data);var $todoViewContainer=$(QWeb.render('ks_to_do_dashboard_inner_container',{ks_to_do_view_name:"Test",to_do_view_data:list_to_do_data,item_id:item_id,ks_tv_play:ks_tv_play}));return $todoViewContainer},_onKsEditTask:function(e){var self=this;var ks_description_id=e.currentTarget.dataset.contentId;var ks_item_id=e.currentTarget.dataset.itemId;var ks_section_id=e.currentTarget.dataset.sectionId;var ks_description=$(e.currentTarget.parentElement.parentElement).find('.ks_description').attr('value');var $content="<div><input type='text' class='ks_description' value='"+ks_description+"' placeholder='Task'></input></div>"
var dialog=new Dialog(this,{title:_t('Edit Task'),size:'medium',$content:$content,buttons:[{text:'Save',classes:'btn-primary',click:function(e){var content=$(e.currentTarget.parentElement.parentElement).find('.ks_description').val();if(content.length===0){content=ks_description;}
self.onSaveTask(content,parseInt(ks_description_id),parseInt(ks_item_id),parseInt(ks_section_id));},close:true,},{text:_t('Close'),classes:'btn-secondary o_form_button_cancel',close:true,}],});dialog.open();},onSaveTask:function(content,ks_description_id,ks_item_id,ks_section_id){var self=this;this._rpc({model:'ks_to.do.description',method:'write',args:[ks_description_id,{"ks_description":content}],}).then(function(){self.ksFetchUpdateItem(ks_item_id).then(function(){$(".ks_li_tab[data-item-id="+ks_item_id+"]").removeClass('active');$(".ks_li_tab[data-section-id="+ks_section_id+"]").addClass('active');$(".ks_tab_section[data-item-id="+ks_item_id+"]").removeClass('active');$(".ks_tab_section[data-item-id="+ks_item_id+"]").removeClass('show');$(".ks_tab_section[data-section-id="+ks_section_id+"]").addClass('active');$(".ks_tab_section[data-section-id="+ks_section_id+"]").addClass('show');$(".header_add_btn[data-item-id="+ks_item_id+"]").attr('data-section-id',ks_section_id);});});},_onKsDeleteContent:function(e){var self=this;var ks_description_id=e.currentTarget.dataset.contentId;var ks_item_id=e.currentTarget.dataset.itemId;var ks_section_id=e.currentTarget.dataset.sectionId;Dialog.confirm(this,(_t("Are you sure you want to remove this task?")),{confirm_callback:function(){self._rpc({model:'ks_to.do.description',method:'unlink',args:[parseInt(ks_description_id)],}).then(function(){self.ksFetchUpdateItem(ks_item_id).then(function(){$(".ks_li_tab[data-item-id="+ks_item_id+"]").removeClass('active');$(".ks_li_tab[data-section-id="+ks_section_id+"]").addClass('active');$(".ks_tab_section[data-item-id="+ks_item_id+"]").removeClass('active');$(".ks_tab_section[data-item-id="+ks_item_id+"]").removeClass('show');$(".ks_tab_section[data-section-id="+ks_section_id+"]").addClass('active');$(".ks_tab_section[data-section-id="+ks_section_id+"]").addClass('show');$(".header_add_btn[data-item-id="+ks_item_id+"]").attr('data-section-id',ks_section_id);});});},});},_onKsAddTask:function(e){var self=this;var ks_section_id=e.currentTarget.dataset.sectionId;var ks_item_id=e.currentTarget.dataset.itemId;var $content="<div><input type='text' class='ks_section' placeholder='Task' required></input></div>"
var dialog=new Dialog(this,{title:_t('New Task'),$content:$content,size:'medium',buttons:[{text:'Save',classes:'btn-primary',click:function(e){var content=$(e.currentTarget.parentElement.parentElement).find('.ks_section').val();if(content.length===0){}
else{self._onCreateTask(content,parseInt(ks_section_id),parseInt(ks_item_id));}},close:true,},{text:_t('Close'),classes:'btn-secondary o_form_button_cancel',close:true,}],});dialog.open();},_onCreateTask:function(content,ks_section_id,ks_item_id){var self=this;this._rpc({model:'ks_to.do.description',method:'create',args:[{ks_to_do_header_id:ks_section_id,ks_description:content,}],}).then(function(){self.ksFetchUpdateItem(ks_item_id).then(function(){$(".ks_li_tab[data-item-id="+ks_item_id+"]").removeClass('active');$(".ks_li_tab[data-section-id="+ks_section_id+"]").addClass('active');$(".ks_tab_section[data-item-id="+ks_item_id+"]").removeClass('active');$(".ks_tab_section[data-item-id="+ks_item_id+"]").removeClass('show');$(".ks_tab_section[data-section-id="+ks_section_id+"]").addClass('active');$(".ks_tab_section[data-section-id="+ks_section_id+"]").addClass('show');$(".header_add_btn[data-item-id="+ks_item_id+"]").attr('data-section-id',ks_section_id);});});},_onKsUpdateAddButtonAttribute:function(e){var item_id=e.currentTarget.dataset.itemId;var sectionId=e.currentTarget.dataset.sectionId;$(".header_add_btn[data-item-id="+item_id+"]").attr('data-section-id',sectionId);},_onKsActiveHandler:function(e){var self=this;var ks_item_id=e.currentTarget.dataset.itemId;var content_id=e.currentTarget.dataset.contentId;var ks_task_id=e.currentTarget.dataset.contentId;var ks_section_id=e.currentTarget.dataset.sectionId;var ks_value=e.currentTarget.dataset.valueId;if(ks_value=='True'){ks_value=false}else{ks_value=true}
self.content_id=content_id;this._rpc({model:'ks_to.do.description',method:'write',args:[content_id,{"ks_active":ks_value}],}).then(function(){self.ksFetchUpdateItem(ks_item_id).then(function(){$(".ks_li_tab[data-item-id="+ks_item_id+"]").removeClass('active');$(".ks_li_tab[data-section-id="+ks_section_id+"]").addClass('active');$(".ks_tab_section[data-item-id="+ks_item_id+"]").removeClass('active');$(".ks_tab_section[data-item-id="+ks_item_id+"]").removeClass('show');$(".ks_tab_section[data-section-id="+ks_section_id+"]").addClass('active');$(".ks_tab_section[data-section-id="+ks_section_id+"]").addClass('show');$(".header_add_btn[data-item-id="+ks_item_id+"]").attr('data-section-id',ks_section_id);});});}})});;

/* /ks_dashboard_ninja/static/src/js/ks_filter_props.js defined in bundle 'web.assets_backend' */
odoo.define('ks_dashboard_ninja.ks_dashboard_filter',function(require){"use strict";var KsFilterProps=require('ks_dashboard_ninja.ks_dashboard');var core=require('web.core');var QWeb=core.qweb;var datepicker=require("web.datepicker");var _t=core._t
var KSFIELD_OPERATORS={date:[{symbol:"=",description:_t("is equal to")},{symbol:"!=",description:_t("is not equal to")},{symbol:">",description:_t("is after")},{symbol:"<",description:_t("is before")},{symbol:">=",description:_t("is after or equal to")},{symbol:"<=",description:_t("is before or equal to")},{symbol:"between",description:_t("is between")},{symbol:"!=",description:_t("is set"),value:false},{symbol:"=",description:_t("is not set"),value:false},],datetime:[{symbol:"between",description:_t("is between")},{symbol:"=",description:_t("is equal to")},{symbol:"!=",description:_t("is not equal to")},{symbol:">",description:_t("is after")},{symbol:"<",description:_t("is before")},{symbol:">=",description:_t("is after or equal to")},{symbol:"<=",description:_t("is before or equal to")},{symbol:"!=",description:_t("is set"),value:false},{symbol:"=",description:_t("is not set"),value:false},],id:[{symbol:"=",description:_t("is")},],number:[{symbol:"=",description:_t("is equal to")},{symbol:"!=",description:_t("is not equal to")},{symbol:">",description:_t("greater than")},{symbol:"<",description:_t("less than")},{symbol:">=",description:_t("greater than or equal to")},{symbol:"<=",description:_t("less than or equal to")},{symbol:"!=",description:_t("is set"),value:false},{symbol:"=",description:_t("is not set"),value:false},],selection:[{symbol:"=",description:_t("is")},{symbol:"!=",description:_t("is not")},{symbol:"!=",description:_t("is set"),value:false},{symbol:"=",description:_t("is not set"),value:false},],boolean:[{symbol:"=",description:_t("is true"),value:true},{symbol:"!=",description:_t("is false"),value:true},],char:[{symbol:"ilike",description:_t("contains")},{symbol:"not ilike",description:_t("doesn't contain")},{symbol:"=",description:_t("is equal to")},{symbol:"!=",description:_t("is not equal to")},{symbol:"!=",description:_t("is set"),value:false},{symbol:"=",description:_t("is not set"),value:false},],};var KSFIELD_TYPES={id:'id',integer:'number',html:'char',many2many:'char',many2one:'char',monetary:'number',one2many:'char',text:'char',selection:'selection',boolean:'boolean',char:'char',date:'date',datetime:'datetime',float:'number',};var field_utils=require('web.field_utils');return KsFilterProps.include({events:_.extend({},KsFilterProps.prototype.events,{'hide.bs.dropdown .ks_dn_selection_box > div':'onKsDnFilterBoxContainerHide','click .dn_filter_click_event_selector':'onKsDnDynamicFilterSelect','click .ks_custom_filter_add_condition':'ksOnCustomFilterConditionAdd','click .ks_custom_filter_section_delete':'ksOnCustomFilterConditionRemove','click .ks_dn_filter_apply':'ksOnCustomFilterApply','click .ks_dn_filter_remove_event':'ksOnRemoveFilterFromSearchPanel','change .ks_custom_filter_field_selector':'ksOnCustomFilterFieldSelect','change .ks_custom_filter_field_selector':'ksOnCustomFilterFieldSelect','change .ks_operator_option_selector':'ksOnCustomFilterOperatorSelect','change .ks_operator_option_selector':'ksOnCustomFilterOperatorSelect',}),init:function(){this._super.apply(this,arguments);this.ksCustomFilterData={OPERATORS:KSFIELD_OPERATORS,KSFIELD_TYPES:KSFIELD_TYPES,DECIMAL_POINT:2,}},onKsDnFilterBoxContainerHide:function(ev){if(ev.clickEvent&&ev.clickEvent.target&&$(ev.clickEvent.target).parents(".ks_dn_filter_dropdown_container").length){return false;}},onKsDnDynamicFilterSelect:function(ev){var self=this;if($(ev.currentTarget).hasClass('dn_dynamic_filter_selected')){self._ksRemoveDynamicFilter(ev.currentTarget.dataset['filterId']);$(ev.currentTarget).removeClass('dn_dynamic_filter_selected');}else{self._ksAppendDynamicFilter(ev.currentTarget.dataset['filterId']);$(ev.currentTarget).addClass('dn_dynamic_filter_selected');}},_ksAppendDynamicFilter:function(filterId){this.ks_dashboard_data.ks_dashboard_pre_domain_filter[filterId].active=true;var action='add_dynamic_filter';var categ=this.ks_dashboard_data.ks_dashboard_pre_domain_filter[filterId].categ;var params={'model':this.ks_dashboard_data.ks_dashboard_pre_domain_filter[filterId].model,'model_name':this.ks_dashboard_data.ks_dashboard_pre_domain_filter[filterId].model_name,}
this._ksUpdateAddDomainIndexData(action,categ,params);},_ksRemoveDynamicFilter:function(filterId){this.ks_dashboard_data.ks_dashboard_pre_domain_filter[filterId].active=false;var action='remove_dynamic_filter';var categ=this.ks_dashboard_data.ks_dashboard_pre_domain_filter[filterId].categ;var params={'model':this.ks_dashboard_data.ks_dashboard_pre_domain_filter[filterId].model,'model_name':this.ks_dashboard_data.ks_dashboard_pre_domain_filter[filterId].model_name,}
this._ksUpdateRemoveDomainIndexData(action,categ,params);},_ksUpdateAddDomainIndexData:function(action,categ,params){var self=this;var model=params['model']||false;var model_name=params['model_name']||'';$(".ks_dn_filter_applied_container").removeClass('ks_hide');var filters_to_update=_(this.ks_dashboard_data.ks_dashboard_pre_domain_filter).values().filter((x)=>{return x.active===true&&x.categ===categ});var domain_data=self.ks_dashboard_data.ks_dashboard_domain_data[model];if(domain_data){var domain_index=_(domain_data.ks_domain_index_data).find((x)=>{return x.categ===categ});if(domain_index){domain_index['domain']=[];domain_index['label']=[];_(filters_to_update).each((x)=>{if(domain_index['domain'].length>0)domain_index['domain'].unshift('|');domain_index['domain']=domain_index['domain'].concat(x['domain']);domain_index['label']=domain_index['label'].concat(x['name']);})}else{domain_index={categ:categ,domain:[],label:[],model:model,}
_(filters_to_update).each((x)=>{if(domain_index['domain'].length>0)domain_index['domain'].unshift('|');domain_index['domain']=domain_index['domain'].concat(x['domain']);domain_index['label']=domain_index['label'].concat(x['name']);})
domain_data.ks_domain_index_data.push(domain_index);}
var $filter_container=$(QWeb.render('ks_dn_filter_section_container_template',{ks_domain_data:domain_data,ks_model:model,}));$('.ks_dn_filter_section_container[data-ks-model-selector="'+model+'"]').replaceWith($filter_container);}else{var domain_index={categ:categ,domain:[],label:[],model:model,}
_(filters_to_update).each((x)=>{if(domain_index['domain'].length>0)domain_index['domain'].unshift('|');domain_index['domain']=domain_index['domain'].concat(x['domain']);domain_index['label']=domain_index['label'].concat(x['name']);})
domain_data={'domain':[],'model_name':model_name,'item_ids':self.ks_dashboard_data.ks_model_item_relation[model],'ks_domain_index_data':[domain_index],}
self.ks_dashboard_data.ks_dashboard_domain_data[model]=domain_data;var $filter_container=$(QWeb.render('ks_dn_filter_section_container_template',{ks_domain_data:domain_data,ks_model:model,}));$('.ks_dn_filter_applied_container').prepend($filter_container);}
domain_data['domain']=self._ksMakeDomainFromDomainIndex(domain_data.ks_domain_index_data);_(domain_data['item_ids']).each((x)=>{self.ksFetchUpdateItem(x)});},_ksUpdateRemoveDomainIndexData:function(action,categ,params){var self=this;var model=params['model']||false;var model_name=params['model_name']||'';var filters_to_update=_(this.ks_dashboard_data.ks_dashboard_pre_domain_filter).values().filter((x)=>{return x.active===true&&x.categ===categ});var domain_data=self.ks_dashboard_data.ks_dashboard_domain_data[model];var domain_index=_(domain_data.ks_domain_index_data).find((x)=>{return x.categ===categ});if(filters_to_update.length<1){if(domain_data.ks_domain_index_data.length>1){domain_data.ks_domain_index_data.splice(domain_data.ks_domain_index_data.indexOf(domain_index),1);$('.o_searchview_facet[data-ks-categ="'+categ+'"]').remove();}else{$('.ks_dn_filter_section_container[data-ks-model-selector="'+model+'"]').remove();delete self.ks_dashboard_data.ks_dashboard_domain_data[model];if(!_(self.ks_dashboard_data.ks_dashboard_domain_data).keys().length){$(".ks_dn_filter_applied_container").addClass('ks_hide');}}}else{domain_index['domain']=[];domain_index['label']=[];_(filters_to_update).each((x)=>{if(domain_index['domain'].length>0)domain_index['domain'].unshift('|');domain_index['domain']=domain_index['domain'].concat(x['domain']);domain_index['label']=domain_index['label'].concat(x['name']);})
var $filter_container=$(QWeb.render('ks_dn_filter_section_container_template',{ks_domain_data:domain_data,ks_model:model,}));$('.ks_dn_filter_section_container[data-ks-model-selector="'+model+'"]').replaceWith($filter_container);}
domain_data['domain']=self._ksMakeDomainFromDomainIndex(domain_data.ks_domain_index_data);_(domain_data['item_ids']).each((x)=>{self.ksFetchUpdateItem(x)});},_ksMakeDomainFromDomainIndex:function(ks_domain_index_data){var domain=[];_(ks_domain_index_data).each((x)=>{if(domain.length>0)domain.unshift('&');domain=domain.concat((x['domain']));})
return domain;},ksGetParamsForItemFetch:function(item_id){var self=this;var model1=self.ks_dashboard_data.ks_item_model_relation[item_id][0];var model2=self.ks_dashboard_data.ks_item_model_relation[item_id][1];if(model1 in self.ks_dashboard_data.ks_model_item_relation){if(self.ks_dashboard_data.ks_model_item_relation[model1].indexOf(item_id)<0)
self.ks_dashboard_data.ks_model_item_relation[model1].push(item_id);}else{self.ks_dashboard_data.ks_model_item_relation[model1]=[item_id];}
if(model2 in self.ks_dashboard_data.ks_model_item_relation){if(self.ks_dashboard_data.ks_model_item_relation[model2].indexOf(item_id)<0)
self.ks_dashboard_data.ks_model_item_relation[model2].push(item_id);}else{self.ks_dashboard_data.ks_model_item_relation[model2]=[item_id];}
var ks_domain_1=self.ks_dashboard_data.ks_dashboard_domain_data[model1]&&self.ks_dashboard_data.ks_dashboard_domain_data[model1]['domain']||[];var ks_domain_2=self.ks_dashboard_data.ks_dashboard_domain_data[model2]&&self.ks_dashboard_data.ks_dashboard_domain_data[model2]['domain']||[];return{ks_domain_1:ks_domain_1,ks_domain_2:ks_domain_2,}},ks_fetch_items_data:function(){var self=this;return this._super.apply(this,arguments).then(function(){if(self.ks_dashboard_data.ks_dashboard_domain_data)self.ks_init_domain_data_index();});},ks_init_domain_data_index:function(){var self=this;var temp_data={};var to_insert=_(this.ks_dashboard_data.ks_dashboard_pre_domain_filter).values().filter((x)=>{return x.type==='filter'&&x.active&&self.ks_dashboard_data.ks_dashboard_domain_data[x.model].ks_domain_index_data.length===0});_(to_insert).each((x)=>{if(x['categ']in temp_data){temp_data[x['categ']]['domain']=temp_data[x['categ']]['domain'].concat(x['domain']);temp_data[x['categ']]['label']=temp_data[x['categ']]['label'].concat(x['name']);}else{temp_data[x['categ']]={'domain':x['domain'],'label':[x['name']],'categ':x['categ'],'model':x['model']};}})
_(temp_data).values().forEach((x)=>{self.ks_dashboard_data.ks_dashboard_domain_data[x.model].ks_domain_index_data.push(x);})},ksRenderDashboard:function(){var self=this;this._super.apply(this,arguments);var show_remove_option=false;if(Object.values(self.ks_dashboard_data.ks_dashboard_custom_domain_filter).length>0)self.ks_render_custom_filter(show_remove_option);},ks_render_custom_filter:function(show_remove_option){var $container=$(QWeb.render('ks_dn_custom_filter_input_container',{ks_dashboard_custom_domain_filter:Object.values(this.ks_dashboard_data.ks_dashboard_custom_domain_filter),show_remove_option:show_remove_option,}));var first_field_select=Object.values(this.ks_dashboard_data.ks_dashboard_custom_domain_filter)[0]
var field_type=first_field_select.field_type;var operators=this.ksCustomFilterData.OPERATORS[this.ksCustomFilterData.KSFIELD_TYPES[field_type]];var operator_type=operators[0];var $operator_input=$(QWeb.render('ks_dn_custom_domain_input_operator',{operators:operators,}));$container.append($operator_input);var $value_input=this._ksRenderCustomFilterInputSection(operator_type,this.ksCustomFilterData.KSFIELD_TYPES[field_type],first_field_select.special_data)
if($value_input)$container.append($value_input);$("#ks_dn_custom_filters_container").append($container);},_ksRenderCustomFilterInputSection:function(operator_type,field_type,special_data){var $value_input;switch(field_type){case'boolean':return false;break;case'selection':if('value'in operator_type)return false;else $value_input=$(QWeb.render('ks_dn_custom_domain_input_selection',{selection_input:special_data['select_options']||[],}));break;case'date':case'datetime':if('value'in operator_type)return false;$value_input=this._ksRenderDateTimeFilterInput(operator_type,field_type);break;case'char':case'id':case'number':if('value'in operator_type)return false;else $value_input=$(QWeb.render('ks_dn_custom_domain_input_text',{}));break;default:return;}
return $value_input;},_ksRenderDateTimeFilterInput:function(operator,field_type){var $value_container=$(QWeb.render('ks_dn_custom_domain_input_date'));switch(field_type){case'date':var $date_time_picker=new(datepicker.DateWidget)(this);$date_time_picker.appendTo($value_container).then((function(){$date_time_picker.$el.addClass("ks_dn_filter_first_date_time_widget o_input");$date_time_picker.setValue(moment());}).bind(this));if(operator.symbol==='between'){var $date_time_picker_2=new(datepicker.DateWidget)(this);$date_time_picker_2.appendTo($value_container).then((function(){$date_time_picker_2.$el.addClass("ks_dn_filter_second_date_time_widget o_input");$date_time_picker_2.setValue(moment());}).bind(this));}
break;case'datetime':var $date_time_picker=new(datepicker.DateTimeWidget)(this);$date_time_picker.appendTo($value_container).then((function(){$date_time_picker.$el.addClass("ks_dn_filter_first_date_time_widget o_input");$date_time_picker.setValue(moment('00:00:00','hh:mm:ss'));}).bind(this));if(operator.symbol==='between'){var $date_time_picker_2=new(datepicker.DateTimeWidget)(this);$date_time_picker_2.appendTo($value_container).then((function(){$date_time_picker_2.$el.addClass("ks_dn_filter_second_date_time_widget o_input");$date_time_picker_2.setValue(moment('23:59:59','hh:mm:ss'));}).bind(this));}
break;}
return $value_container;},ksOnCustomFilterConditionAdd:function(){var show_remove_option=true;this.ks_render_custom_filter(show_remove_option);},ksOnCustomFilterConditionRemove:function(ev){ev.stopPropagation();$(ev.currentTarget.parentElement).remove();},ksOnCustomFilterFieldSelect:function(ev){var $parent_container=$(ev.currentTarget.parentElement);$parent_container.find('.ks_operator_option_selector').remove();$parent_container.find('.o_generator_menu_value').remove();var field_id=ev.currentTarget.value;var field_select=this.ks_dashboard_data.ks_dashboard_custom_domain_filter[field_id];var field_type=field_select.field_type;var operators=this.ksCustomFilterData.OPERATORS[this.ksCustomFilterData.KSFIELD_TYPES[field_type]];var operator_type=operators[0];var $operator_input=$(QWeb.render('ks_dn_custom_domain_input_operator',{operators:operators,}));$parent_container.append($operator_input);var $value_input=this._ksRenderCustomFilterInputSection(operator_type,this.ksCustomFilterData.KSFIELD_TYPES[field_type],field_select.special_data)
if($value_input)$parent_container.append($value_input);},ksOnCustomFilterOperatorSelect:function(ev){var $parent_container=$(ev.currentTarget.parentElement);var operator_symbol=ev.currentTarget.value;var field_id=$parent_container.find('.ks_custom_filter_field_selector').val();var field_select=this.ks_dashboard_data.ks_dashboard_custom_domain_filter[field_id];var field_type=field_select.field_type;var operator_type=this.ksCustomFilterData.OPERATORS[this.ksCustomFilterData.KSFIELD_TYPES[field_type]][ev.currentTarget.selectedIndex];$parent_container.find('.o_generator_menu_value').remove();var $value_input=this._ksRenderCustomFilterInputSection(operator_type,this.ksCustomFilterData.KSFIELD_TYPES[field_type],field_select.special_data)
if($value_input)$parent_container.append($value_input);},ksOnCustomFilterApply:function(){var model_domain={};$('.ks_dn_custom_filter_input_container_section').each((index,filter_container)=>{var field_id=$(filter_container).find('.ks_custom_filter_field_selector').val();var field_select=this.ks_dashboard_data.ks_dashboard_custom_domain_filter[field_id];var field_type=field_select.field_type;var domainValue=[];var domainArray=[];var operator=this.ksCustomFilterData.OPERATORS[this.ksCustomFilterData.KSFIELD_TYPES[field_type]][$(filter_container).find('.ks_operator_option_selector').prop('selectedIndex')];var label=field_select.name+' '+operator.description;if('value'in operator){domainValue=[operator.value];}else if(['date','datetime'].includes(field_type)){var dateValue=[];$(filter_container).find(".o_generator_menu_value .o_datepicker").each((index,$input_val)=>{var a=$($input_val).find("input").val();;var b=field_utils.parse[field_type](a,{field_type},{timezone:true});var c=field_utils.format[field_type](b,{field_type},{timezone:true});domainValue.push(b.toJSON());dateValue.push(c);});label=label+' '+dateValue.join(" and ");}else if(field_type==='selection'){domainValue=[$(filter_container).find(".o_generator_menu_value").val()]
label=label+' '+$(filter_container).find(".o_generator_menu_value").val();}
else{domainValue=[$(filter_container).find(".o_generator_menu_value input").val()]
label=label+' '+$(filter_container).find(".o_generator_menu_value input").val();}
if(operator.symbol==='between'){domainArray.push([field_select.field_name,'>=',domainValue[0]],[field_select.field_name,'<=',domainValue[1]]);domainArray.unshift('&');}else{domainArray.push([field_select.field_name,operator.symbol,domainValue[0]]);}
if(field_select.model in model_domain){model_domain[field_select.model]['domain']=model_domain[field_select.model]['domain'].concat(domainArray);model_domain[field_select.model]['domain'].unshift('|');model_domain[field_select.model]['label']=model_domain[field_select.model]['label']+' or '+label;}else{model_domain[field_select.model]={'domain':domainArray,'label':label,'model_name':field_select.model_name,}}});this._ksAddCustomDomain(model_domain);},_ksAddCustomDomain:function(model_domain){var self=this;$(".ks_dn_filter_applied_container").removeClass('ks_hide');_(model_domain).each((val,model)=>{var domain_data=self.ks_dashboard_data.ks_dashboard_domain_data[model];var domain_index={categ:false,domain:val['domain'],label:[val['label']],model:model,}
if(domain_data){domain_data.ks_domain_index_data.push(domain_index);var $filter_container=$(QWeb.render('ks_dn_filter_section_container_template',{ks_domain_data:domain_data,ks_model:model,}));$('.ks_dn_filter_section_container[data-ks-model-selector="'+model+'"]').replaceWith($filter_container);}else{domain_data={'domain':[],'model_name':val.model_name,'item_ids':self.ks_dashboard_data.ks_model_item_relation[model],'ks_domain_index_data':[domain_index],}
self.ks_dashboard_data.ks_dashboard_domain_data[model]=domain_data;var $filter_container=$(QWeb.render('ks_dn_filter_section_container_template',{ks_domain_data:domain_data,ks_model:model,}));$('.ks_dn_filter_applied_container').prepend($filter_container);}
$("#ks_dn_custom_filters_container").empty();var show_remove_option=false;self.ks_render_custom_filter(show_remove_option);domain_data['domain']=self._ksMakeDomainFromDomainIndex(domain_data.ks_domain_index_data);_(domain_data['item_ids']).each((x)=>{self.ksFetchUpdateItem(x)});})},ksOnRemoveFilterFromSearchPanel:function(ev){var self=this;ev.stopPropagation();var $search_section=$(ev.currentTarget).parent();var model=$search_section.data('ksModel');if($search_section.data('ksCateg')){var categ=$search_section.data('ksCateg');var action='remove_dynamic_filter';var $selected_pre_define_filter=$(".dn_dynamic_filter_selected.dn_filter_click_event_selector[data-ks-categ='"+categ+"']");$selected_pre_define_filter.removeClass("dn_dynamic_filter_selected");_($selected_pre_define_filter).each((x,y)=>{var filter_id=$(x).data('filterId');self.ks_dashboard_data.ks_dashboard_pre_domain_filter[filter_id].active=false;})
var params={'model':model,'model_name':$search_section.data('ksModelName'),}
this._ksUpdateRemoveDomainIndexData(action,categ,params);}else{var index=$search_section.index();var domain_data=self.ks_dashboard_data.ks_dashboard_domain_data[model];domain_data.ks_domain_index_data.splice(index,1);if(domain_data.ks_domain_index_data.length===0){$('.ks_dn_filter_section_container[data-ks-model-selector="'+model+'"]').remove();delete self.ks_dashboard_data.ks_dashboard_domain_data[model];if(!_(self.ks_dashboard_data.ks_dashboard_domain_data).keys().length){$(".ks_dn_filter_applied_container").addClass('ks_hide');}}else{$search_section.remove();}
domain_data['domain']=self._ksMakeDomainFromDomainIndex(domain_data.ks_domain_index_data);_(domain_data['item_ids']).each((x)=>{self.ksFetchUpdateItem(x)});}},})});;

/* /ks_dashboard_ninja/static/src/js/ks_color_picker.js defined in bundle 'web.assets_backend' */
odoo.define('ks_dashboard_ninja_list.ks_color_picker',function(require){"use strict";require('web.dom_ready');var registry=require('web.field_registry');var AbstractField=require('web.AbstractField');var core=require('web.core');var QWeb=core.qweb;var KsColorPicker=AbstractField.extend({supportedFieldTypes:['char'],events:_.extend({},AbstractField.prototype.events,{'change.spectrum .ks_color_picker':'_ksOnColorChange','change .ks_color_opacity':'_ksOnOpacityChange','input .ks_color_opacity':'_ksOnOpacityInput'}),jsLibs:['/ks_dashboard_ninja/static/lib/js/spectrum.js'],cssLibs:['/ks_dashboard_ninja/static/lib/css/spectrum.css',],_render:function(){this.$el.empty();var ks_color_value='#376CAE';var ks_color_opacity='0.99';if(this.value){ks_color_value=this.value.split(',')[0];ks_color_opacity=this.value.split(',')[1];};var $view=$(QWeb.render('ks_color_picker_opacity_view',{ks_color_value:ks_color_value,ks_color_opacity:ks_color_opacity}));this.$el.append($view)
this.$el.find(".ks_color_picker").spectrum({color:ks_color_value,showInput:true,hideAfterPaletteSelect:true,clickoutFiresChange:true,showInitial:true,preferredFormat:"rgb",});if(this.mode==='readonly'){this.$el.find('.ks_color_picker').addClass('ks_not_click');this.$el.find('.ks_color_opacity').addClass('ks_not_click');this.$el.find('.ks_color_picker').spectrum("disable");}else{this.$el.find('.ks_color_picker').spectrum("enable");}},_ksOnColorChange:function(e,tinycolor){this._setValue(tinycolor.toHexString().concat(","+this.value.split(',')[1]));},_ksOnOpacityChange:function(event){this._setValue(this.value.split(',')[0].concat(","+event.currentTarget.value));},_ksOnOpacityInput:function(event){var self=this;var color;if(self.name=="ks_background_color"){color=$('.ks_db_item_preview_color_picker').css("background-color")
$('.ks_db_item_preview_color_picker').css("background-color",self.get_color_opacity_value(color,event.currentTarget.value))
color=$('.ks_db_item_preview_l2').css("background-color")
$('.ks_db_item_preview_l2').css("background-color",self.get_color_opacity_value(color,event.currentTarget.value))}else if(self.name=="ks_default_icon_color"){color=$('.ks_dashboard_icon_color_picker > span').css('color')
$('.ks_dashboard_icon_color_picker > span').css('color',self.get_color_opacity_value(color,event.currentTarget.value))}else if(self.name=="ks_font_color"){color=$('.ks_db_item_preview').css("color")
color=$('.ks_db_item_preview').css("color",self.get_color_opacity_value(color,event.currentTarget.value))}},get_color_opacity_value:function(color,val){if(color){return color.replace(color.split(',')[3],val+")");}else{return false;}},});registry.add('ks_color_dashboard_picker',KsColorPicker);return{KsColorPicker:KsColorPicker};});;

/* /ks_dashboard_ninja/static/src/js/ks_dashboard_ninja_item_preview.js defined in bundle 'web.assets_backend' */
odoo.define('ks_dashboard_ninja_list.ks_dashboard_item_preview',function(require){"use strict";var registry=require('web.field_registry');var AbstractField=require('web.AbstractField');var core=require('web.core');var field_utils=require('web.field_utils');var session=require('web.session');var utils=require('web.utils');var QWeb=core.qweb;var KsItemPreview=AbstractField.extend({supportedFieldTypes:['integer'],resetOnAnyFieldChange:true,file_type_magic_word:{'/':'jpg','R':'gif','i':'png','P':'svg+xml',},ksNumFormatter:function(num,digits){var negative;var si=[{value:1,symbol:""},{value:1E3,symbol:"k"},{value:1E6,symbol:"M"},{value:1E9,symbol:"G"},{value:1E12,symbol:"T"},{value:1E15,symbol:"P"},{value:1E18,symbol:"E"}];if(num<0){num=Math.abs(num)
negative=true}
var rx=/\.0+$|(\.[0-9]*[1-9])0+$/;var i;for(i=si.length-1;i>0;i--){if(num>=si[i].value){break;}}
if(negative){return"-"+(num/si[i].value).toFixed(digits).replace(rx,"$1")+si[i].symbol;}else{return(num/si[i].value).toFixed(digits).replace(rx,"$1")+si[i].symbol;}},ksNumColombianFormatter:function(num,digits,ks_precision_digits){var negative;var si=[{value:1,symbol:""},{value:1E3,symbol:""},{value:1E6,symbol:"M"},{value:1E9,symbol:"M"},{value:1E12,symbol:"M"},{value:1E15,symbol:"M"},{value:1E18,symbol:"M"}];if(num<0){num=Math.abs(num)
negative=true}
var rx=/\.0+$|(\.[0-9]*[1-9])0+$/;var i;for(i=si.length-1;i>0;i--){if(num>=si[i].value){break;}}
if(si[i].symbol==='M'){num=parseInt(num)/1000000
num=field_utils.format.integer(num,Float64Array)
if(negative){return"-"+num+si[i].symbol;}else{return num+si[i].symbol;}}else{if(num%1===0){num=field_utils.format.integer(num,Float64Array)}else{num=field_utils.format.float(num,Float64Array,{digits:[0,ks_precision_digits]});}
if(negative){return"-"+num;}else{return num;}}},ksNumIndianFormatter:function(num,digits){var negative;var si=[{value:1,symbol:""},{value:1E3,symbol:"Th"},{value:1E5,symbol:"Lakh"},{value:1E7,symbol:"Cr"},{value:1E9,symbol:'Arab'}];if(num<0){num=Math.abs(num)
negative=true}
var rx=/\.0+$|(\.[0-9]*[1-9])0+$/;var i;for(i=si.length-1;i>0;i--){if(num>=si[i].value){break;}}
if(negative){return"-"+(num/si[i].value).toFixed(digits).replace(rx,"$1")+si[i].symbol;}else{return(num/si[i].value).toFixed(digits).replace(rx,"$1")+si[i].symbol;}},ks_get_dark_color:function(color,opacity,percent){var num=parseInt(color.slice(1),16),amt=Math.round(2.55*percent),R=(num>>16)+amt,G=(num>>8&0x00FF)+amt,B=(num&0x0000FF)+amt;return"#"+(0x1000000+(R<255?R<1?0:R:255)*0x10000+(G<255?G<1?0:G:255)*0x100+(B<255?B<1?0:B:255)).toString(16).slice(1)+","+opacity;},_render:function(){var self=this;var field=self.recordData;var $val;var item_info;var ks_rgba_background_color,ks_rgba_font_color,ks_rgba_icon_color;self.$el.empty();ks_rgba_background_color=self._get_rgba_format(field.ks_background_color)
ks_rgba_font_color=self._get_rgba_format(field.ks_font_color)
ks_rgba_icon_color=self._get_rgba_format(field.ks_default_icon_color)
item_info={name:field.name,count:self.ksNumFormatter(field.ks_record_count,1),icon_select:field.ks_icon_select,default_icon:field.ks_default_icon,icon_color:ks_rgba_icon_color,count_tooltip:field_utils.format.float(field.ks_record_count,Float64Array,{digits:[0,field.ks_precision_digits]}),}
if(field.ks_icon){if(!utils.is_bin_size(field.ks_icon)){item_info['img_src']='data:image/'+(self.file_type_magic_word[field.ks_icon[0]]||'png')+';base64,'+field.ks_icon;}else{item_info['img_src']=session.url('/web/image',{model:self.model,id:JSON.stringify(self.res_id),field:"ks_icon",unique:field_utils.format.datetime(self.recordData.__last_update).replace(/[^0-9]/g,''),});}}
if(!field.name){if(field.ks_model_name){item_info['name']=field.ks_model_id.data.display_name;}else{item_info['name']="Name";}}
if(field.ks_multiplier_active){var ks_record_count=field.ks_record_count*field.ks_multiplier
item_info['count']=self._onKsGlobalFormatter(ks_record_count,field.ks_data_format,field.ks_precision_digits);item_info['count_tooltip']=ks_record_count;}else{item_info['count']=self._onKsGlobalFormatter(field.ks_record_count,field.ks_data_format,field.ks_precision_digits);}
switch(field.ks_layout){case'layout1':$val=$(QWeb.render('ks_db_list_preview_layout1',item_info));$val.css({"background-color":ks_rgba_background_color,"color":ks_rgba_font_color});break;case'layout2':$val=$(QWeb.render('ks_db_list_preview_layout2',item_info));var ks_rgba_dark_background_color_l2=self._get_rgba_format(self.ks_get_dark_color(field.ks_background_color.split(',')[0],field.ks_background_color.split(',')[1],-10));$val.find('.ks_dashboard_icon_l2').css({"background-color":ks_rgba_dark_background_color_l2,});$val.css({"background-color":ks_rgba_background_color,"color":ks_rgba_font_color});break;case'layout3':$val=$(QWeb.render('ks_db_list_preview_layout3',item_info));$val.css({"background-color":ks_rgba_background_color,"color":ks_rgba_font_color});break;case'layout4':$val=$(QWeb.render('ks_db_list_preview_layout4',item_info));$val.find('.ks_dashboard_icon_l4').css({"background-color":ks_rgba_background_color,});$val.find('.ks_dashboard_item_preview_customize').css({"color":ks_rgba_background_color,});$val.find('.ks_dashboard_item_preview_delete').css({"color":ks_rgba_background_color,});$val.css({"border-color":ks_rgba_background_color,"color":ks_rgba_font_color});break;case'layout5':$val=$(QWeb.render('ks_db_list_preview_layout5',item_info));$val.css({"background-color":ks_rgba_background_color,"color":ks_rgba_font_color});break;case'layout6':$val=$(QWeb.render('ks_db_list_preview_layout6',item_info));$val.css({"background-color":ks_rgba_background_color,"color":ks_rgba_font_color});break;default:$val=$(QWeb.render('ks_db_list_preview'));break;}
self.$el.append($val);self.$el.append(QWeb.render('ks_db_item_preview_footer_note'));},_onKsGlobalFormatter:function(ks_record_count,ks_data_format,ks_precision_digits){var self=this;if(ks_data_format=='exact'){return field_utils.format.float(ks_record_count,Float64Array,{digits:[0,ks_precision_digits]});}else{if(ks_data_format=='indian'){return self.ksNumIndianFormatter(ks_record_count,1);}else if(ks_data_format=='colombian'){return self.ksNumColombianFormatter(ks_record_count,1,ks_precision_digits);}else{return self.ksNumFormatter(ks_record_count,1);}}},_renderReadonly:function($val){var self=this;var ks_icon_url;this._rpc({model:'ks_dashboard_ninja.item',method:'ks_set_preview_image',args:[self.res_id],}).then(function(data){ks_icon_url='data:image/'+(self.file_type_magic_word[data[0]]||'png')+';base64,'+data;$val.find('.ks_db_list_image').attr('src',ks_icon_url)
self.$el.append($val)});},_get_rgba_format:function(val){var rgba=val.split(',')[0].match(/[A-Za-z0-9]{2}/g);rgba=rgba.map(function(v){return parseInt(v,16)}).join(",");return"rgba("+rgba+","+val.split(',')[1]+")";}});registry.add('ks_dashboard_item_preview',KsItemPreview);return{KsItemPreview:KsItemPreview};});;

/* /ks_dashboard_ninja/static/src/js/ks_image_basic_widget.js defined in bundle 'web.assets_backend' */
odoo.define('ks_dashboard_ninja_list.ks_image_basic_widget',function(require){"use strict";var core=require('web.core');var basic_fields=require('web.basic_fields');var core=require('web.core');var registry=require('web.field_registry');var QWeb=core.qweb;var KsImageWidget=basic_fields.FieldBinaryImage.extend({init:function(parent,state,params){this._super.apply(this,arguments);this.ksSelectedIcon=false;this.ks_icon_set=['home','puzzle-piece','clock-o','comments-o','car','calendar','calendar-times-o','bar-chart','commenting-o','star-half-o','address-book-o','tachometer','search','money','line-chart','area-chart','pie-chart','check-square-o','users','shopping-cart','truck','user-circle-o','user-plus','sun-o','paper-plane','rss','gears','check','book'];},template:'KsFieldBinaryImage',events:_.extend({},basic_fields.FieldBinaryImage.prototype.events,{'click .ks_icon_container_list':'ks_icon_container_list','click .ks_image_widget_icon_container':'ks_image_widget_icon_container','click .ks_icon_container_open_button':'ks_icon_container_open_button','click .ks_fa_icon_search':'ks_fa_icon_search','keyup .ks_modal_icon_input':'ks_modal_icon_input_enter',}),_render:function(){var ks_self=this;var url=this.placeholder;if(ks_self.value){ks_self.$('> img').remove();ks_self.$('> span').remove();$('<span>').addClass('fa fa-'+ks_self.recordData.ks_default_icon+' fa-5x').appendTo(ks_self.$el).css('color','black');}else{var $img=$(QWeb.render("FieldBinaryImage-img",{widget:this,url:url}));ks_self.$('> img').remove();ks_self.$('> span').remove();ks_self.$el.prepend($img);}
var $ks_icon_container_modal=$(QWeb.render('ks_icon_container_modal_template',{ks_fa_icons_set:ks_self.ks_icon_set}));$ks_icon_container_modal.prependTo(ks_self.$el);},ks_image_widget_icon_container:function(e){$('#ks_icon_container_modal_id').modal({show:true,});},ks_icon_container_list:function(e){var self=this;self.ksSelectedIcon=$(e.currentTarget).find('span').attr('id').split('.')[1]
_.each($('.ks_icon_container_list'),function(selected_icon){$(selected_icon).removeClass('ks_icon_selected');});$(e.currentTarget).addClass('ks_icon_selected')
$('.ks_icon_container_open_button').show()},ks_icon_container_open_button:function(e){var ks_self=this;ks_self._setValue(ks_self.ksSelectedIcon);},ks_fa_icon_search:function(e){var self=this
self.$el.find('.ks_fa_search_icon').remove()
var ks_fa_icon_name=self.$el.find('.ks_modal_icon_input')[0].value
if(ks_fa_icon_name.slice(0,3)==="fa-"){ks_fa_icon_name=ks_fa_icon_name.slice(3)}
var ks_fa_icon_render=$('<div>').addClass('ks_icon_container_list ks_fa_search_icon')
$('<span>').attr('id','ks.'+ks_fa_icon_name.toLocaleLowerCase()).addClass("fa fa-"+ks_fa_icon_name.toLocaleLowerCase()+" fa-4x").appendTo($(ks_fa_icon_render))
$(ks_fa_icon_render).appendTo(self.$el.find('.ks_icon_container_grid_view'))},ks_modal_icon_input_enter:function(e){var ks_self=this
if(e.keyCode==13){ks_self.$el.find('.ks_fa_icon_search').click()}},});registry.add('ks_image_widget',KsImageWidget);return{KsImageWidget:KsImageWidget,};});;

/* /ks_dashboard_ninja/static/src/js/ks_dashboard_item_theme.js defined in bundle 'web.assets_backend' */
odoo.define('ks_dashboard_ninja_list.ks_dashboard_item_theme',function(require){"use strict";var registry=require('web.field_registry');var AbstractField=require('web.AbstractField');var core=require('web.core');var QWeb=core.qweb;var KsDashboardTheme=AbstractField.extend({supportedFieldTypes:['char'],events:_.extend({},AbstractField.prototype.events,{'click .ks_dashboard_theme_input_container':'ks_dashboard_theme_input_container_click',}),_render:function(){var self=this;self.$el.empty();var $view=$(QWeb.render('ks_dashboard_theme_view'));if(self.value){$view.find("input[value='"+self.value+"']").prop("checked",true);}
self.$el.append($view)
if(this.mode==='readonly'){this.$el.find('.ks_dashboard_theme_view_render').addClass('ks_not_click');}},ks_dashboard_theme_input_container_click:function(e){var self=this;var $box=$(e.currentTarget).find(':input');if($box.is(":checked")){self.$el.find('.ks_dashboard_theme_input').prop('checked',false)
$box.prop("checked",true);}else{$box.prop("checked",false);}
self._setValue($box[0].value);},});registry.add('ks_dashboard_item_theme',KsDashboardTheme);return{KsDashboardTheme:KsDashboardTheme};});;

/* /ks_dashboard_ninja/static/src/js/ks_widget_toggle.js defined in bundle 'web.assets_backend' */
odoo.define('ks_dashboard_ninja_list.ks_widget_toggle',function(require){"use strict";var registry=require('web.field_registry');var AbstractField=require('web.AbstractField');var core=require('web.core');var QWeb=core.qweb;var KsWidgetToggle=AbstractField.extend({supportedFieldTypes:['char'],events:_.extend({},AbstractField.prototype.events,{'change .ks_toggle_icon_input':'ks_toggle_icon_input_click',}),_render:function(){var self=this;self.$el.empty();var $view=$(QWeb.render('ks_widget_toggle'));if(self.value){$view.find("input[value='"+self.value+"']").prop("checked",true);}
this.$el.append($view)
if(this.mode==='readonly'){this.$el.find('.ks_select_dashboard_item_toggle').addClass('ks_not_click');}},ks_toggle_icon_input_click:function(e){var self=this;self._setValue(e.currentTarget.value);}});var KsWidgetToggleKPI=AbstractField.extend({supportedFieldTypes:['char'],events:_.extend({},AbstractField.prototype.events,{'change .ks_toggle_icon_input':'ks_toggle_icon_input_click',}),_render:function(){var self=this;self.$el.empty();var $view=$(QWeb.render('ks_widget_toggle_kpi'));if(self.value){$view.find("input[value='"+self.value+"']").prop("checked",true);}
this.$el.append($view)
if(this.mode==='readonly'){this.$el.find('.ks_select_dashboard_item_toggle').addClass('ks_not_click');}},ks_toggle_icon_input_click:function(e){var self=this;self._setValue(e.currentTarget.value);}});var KsWidgetToggleKpiTarget=AbstractField.extend({supportedFieldTypes:['char'],events:_.extend({},AbstractField.prototype.events,{'change .ks_toggle_icon_input':'ks_toggle_icon_input_click',}),_render:function(){var self=this;self.$el.empty();var $view=$(QWeb.render('ks_widget_toggle_kpi_target_view'));if(self.value){$view.find("input[value='"+self.value+"']").prop("checked",true);}
this.$el.append($view)
if(this.mode==='readonly'){this.$el.find('.ks_select_dashboard_item_toggle').addClass('ks_not_click');}},ks_toggle_icon_input_click:function(e){var self=this;self._setValue(e.currentTarget.value);}});registry.add('ks_widget_toggle',KsWidgetToggle);registry.add('ks_widget_toggle_kpi',KsWidgetToggleKPI);registry.add('ks_widget_toggle_kpi_target',KsWidgetToggleKpiTarget);return{KsWidgetToggle:KsWidgetToggle,KsWidgetToggleKPI:KsWidgetToggleKPI,KsWidgetToggleKpiTarget:KsWidgetToggleKpiTarget};});;

/* /ks_dashboard_ninja/static/src/js/ks_import_dashboard.js defined in bundle 'web.assets_backend' */
odoo.define('ks_dashboard_ninja.import_button',function(require){"use strict";var core=require('web.core');var _t=core._t;var Sidebar=require('web.Sidebar');var ListController=require('web.ListController');var framework=require('web.framework');var Dialog=require('web.Dialog');ListController.include({renderSidebar:function($node){var self=this;if(this.modelName=="ks_dashboard_ninja.board"){if(this.hasSidebar){var other=[{label:_t("Export Dashboard"),callback:this.ks_dashboard_export.bind(this)}];if(this.archiveEnabled){other.push({label:_t("Archive"),callback:function(){Dialog.confirm(self,_t("Are you sure that you want to archive all the selected records?"),{confirm_callback:self._toggleArchiveState.bind(self,true),});}});other.push({label:_t("Unarchive"),callback:this._toggleArchiveState.bind(this,false)});}
if(this.is_action_enabled('delete')){other.push({label:_t('Delete'),callback:this._onDeleteSelectedRecords.bind(this)});}
this.sidebar=new Sidebar(this,{editable:this.is_action_enabled('edit'),env:{context:this.model.get(this.handle,{raw:true}).getContext(),activeIds:this.getSelectedIds(),model:this.modelName,},actions:_.extend(this.toolbarActions,{other:other}),});return this.sidebar.appendTo($node).then(function(){self._toggleSidebar();});}
return Promise.resolve();}else{this._super.apply(this,arguments);}},ks_dashboard_export:function(){this.ks_on_dashboard_export(this.getSelectedIds());},ks_on_dashboard_export:function(ids){var self=this;this._rpc({model:'ks_dashboard_ninja.board',method:'ks_dashboard_export',args:[JSON.stringify(ids)],}).then(function(result){var name="dashboard_ninja";var data={"header":name,"dashboard_data":result,}
framework.blockUI();self.getSession().get_file({url:'/ks_dashboard_ninja/export/dashboard_json',data:{data:JSON.stringify(data)},complete:framework.unblockUI,error:(error)=>this.call('crash_manager','rpc_error',error),});})},});core.action_registry.add('ks_dashboard_ninja.import_button',ListController);return ListController;});;

/* /ks_dashboard_ninja/static/src/js/ks_domain_fix.js defined in bundle 'web.assets_backend' */
odoo.define('ks_dashboard_ninja.domain_fix',function(require){"use strict";var BasicModel=require('web.BasicModel');var BasicFields=require('web.basic_fields');var view_dialogs=require('web.view_dialogs');var core=require("web.core");var Domain=require('web.Domain');var _t=core._t;BasicModel.include({_fetchSpecialDomain:function(record,fieldName,fieldInfo){var self=this;var fieldName_temp=fieldName;if(record._changes&&record._changes[fieldName]){if(record._changes[fieldName].includes("%UID")||record._changes[fieldName].includes("%MYCOMPANY")){fieldName_temp=fieldName+'_temp';record._changes[fieldName_temp]=record._changes[fieldName]
while(record._changes[fieldName_temp].includes("%UID")){record._changes[fieldName_temp]=record._changes[fieldName_temp].replace('"%UID"',record.getContext().uid);}
while(record._changes[fieldName_temp].includes("%MYCOMPANY")){record._changes[fieldName_temp]=record._changes[fieldName_temp].replace('"%MYCOMPANY"',this.getSession().user_context.allowed_company_ids[0])}}}else if(record.data[fieldName]&&(record.data[fieldName].includes("%UID")||record.data[fieldName].includes("%MYCOMPANY"))){fieldName_temp=fieldName+'_temp';record.data[fieldName_temp]=record.data[fieldName];while(record.data[fieldName_temp].includes("%UID")){record.data[fieldName_temp]=record.data[fieldName_temp].replace('"%UID"',record.getContext().uid);}
while(record.data[fieldName_temp].includes("%MYCOMPANY")){record.data[fieldName_temp]=record.data[fieldName_temp].replace('"%MYCOMPANY"',this.getSession().user_context.allowed_company_ids[0])}}
return this._super(record,fieldName_temp,fieldInfo);},});BasicFields.FieldDomain.include({_onShowSelectionButtonClick:function(e){if(this.value&&(this.value.includes("%MYCOMPANY")||this.value&&this.value.includes("%UID"))){var temp_value=this.value;while(temp_value.includes("%MYCOMPANY")){var temp_value=temp_value.includes("%MYCOMPANY")?temp_value.replace('"%MYCOMPANY"',this.getSession().user_context.allowed_company_ids[0]):temp_value;}
while(temp_value.includes("%UID")){temp_value=temp_value.includes("%UID")?temp_value.replace('"%UID"',this.record.getContext().uid):temp_value;}
e.preventDefault();new view_dialogs.SelectCreateDialog(this,{title:_t("Selected records"),res_model:this._domainModel,domain:temp_value,no_create:true,readonly:true,disable_multiple_selection:true,}).open();}else{this._super.apply(this,arguments);}},});});;

/* /ks_dashboard_ninja/static/src/js/ks_quick_edit_view.js defined in bundle 'web.assets_backend' */
odoo.define('ks_dashboard_ninja.quick_edit_view',function(require){"use strict";var core=require('web.core');var Widget=require("web.Widget");var _t=core._t;var QWeb=core.qweb;var data=require('web.data');var QuickCreateFormView=require('web.QuickCreateFormView');var AbstractAction=require('web.AbstractAction');var QuickEditView=Widget.extend({template:'ksQuickEditViewOption',events:{'click .ks_quick_edit_action':'ksOnQuickEditViewAction',},init:function(parent,options){this._super.apply(this,arguments);this.ksDashboardController=parent;this.ksOriginalItemData=$.extend({},options.item);this.item=options.item;this.item_name=options.item.name;},willStart:function(){var self=this;return $.when(this._super()).then(function(){return self._ksCreateController();});},_ksCreateController:function(){var self=this;self.context=$.extend({},odoo.session_info.user_context);self.context['form_view_ref']='ks_dashboard_ninja.item_quick_edit_form_view';self.context['res_id']=this.item.id;self.res_model="ks_dashboard_ninja.item";self.dataset=new data.DataSet(this,this.res_model,self.context);var def=self.loadViews(this.dataset.model,self.context,[[false,'list'],[false,'form']],{});return $.when(def).then(function(fieldsViews){self.formView=new QuickCreateFormView(fieldsViews.form,{context:self.context,modelName:self.res_model,userContext:self.getSession().user_context,currentId:self.item.id,index:0,mode:'edit',footerToButtons:true,default_buttons:false,withControlPanel:false,ids:[self.item.id],});var def2=self.formView.getController(self);return $.when(def2).then(function(controller){self.controller=controller;self.controller._confirmChange=self._confirmChange.bind(self);});});},_confirmChange:function(id,fields,e){if(e.name==='discard_changes'&&e.target.reset){return e.target.reset(this.controller.model.get(e.target.dataPointID),e,true);}
var state=this.controller.model.get(this.controller.handle);this.controller.renderer.confirmChange(state,id,fields,e);return this.ks_Update_item();},ks_Update_item:function(){var self=this;var ksChanges=this.controller.renderer.state.data;if(ksChanges['name'])this.item['name']=ksChanges['name'];self.item['ks_font_color']=ksChanges['ks_font_color'];self.item['ks_icon_select']=ksChanges['ks_icon_select'];self.item['ks_icon']=ksChanges['ks_icon'];self.item['ks_background_color']=ksChanges['ks_background_color'];self.item['ks_default_icon_color']=ksChanges['ks_default_icon_color'];self.item['ks_layout']=ksChanges['ks_layout'];self.item['ks_record_count']=ksChanges['ks_record_count'];if(ksChanges['ks_list_view_data'])self.item['ks_list_view_data']=ksChanges['ks_list_view_data'];if(ksChanges['ks_chart_data'])self.item['ks_chart_data']=ksChanges['ks_chart_data'];if(ksChanges['ks_kpi_data'])self.item['ks_kpi_data']=ksChanges['ks_kpi_data'];if(ksChanges['ks_list_view_type'])self.item['ks_list_view_type']=ksChanges['ks_list_view_type'];if(ksChanges['ks_chart_item_color'])self.item['ks_chart_item_color']=ksChanges['ks_chart_item_color'];self.ksUpdateItemView();},start:function(){var self=this;this._super.apply(this,arguments);},renderElement:function(){var self=this;self._super.apply(this,arguments);self.controller.appendTo(self.$el.find(".ks_item_field_info"));self.trigger('canBeRendered',{});},ksUpdateItemView:function(){var self=this;self.ksDashboardController.ksUpdateDashboardItem([self.item.id]);self.item_el=$.find('#'+self.item.id+'.ks_dashboarditem_id');},ksDiscardChanges:function(){var self=this;self.ksDashboardController.ksFetchUpdateItem(self.item.id);self.destroy();},ksOnQuickEditViewAction:function(e){var self=this;self.need_reset=false;var options={'need_item_reload':false}
if(e.currentTarget.dataset['ksItemAction']==='saveItemInfo'){this.controller.saveRecord().then(function(){self.ksDiscardChanges();})}else if(e.currentTarget.dataset['ksItemAction']==='fullItemInfo'){this.trigger('openFullItemForm',{});}else{self.ksDiscardChanges();}},destroy:function(options){this.trigger('canBeDestroyed',{});this.controller.destroy();this._super();},});return{QuickEditView:QuickEditView,};});;

/* /ks_dashboard_ninja/static/src/js/ks_dashboard_ninja_kpi_preview.js defined in bundle 'web.assets_backend' */
odoo.define('ks_dashboard_ninja_list.ks_dashboard_kpi_preview',function(require){"use strict";var registry=require('web.field_registry');var AbstractField=require('web.AbstractField');var core=require('web.core');var field_utils=require('web.field_utils');var session=require('web.session');var utils=require('web.utils');var KsGlobalFunction=require('ks_dashboard_ninja.KsGlobalFunction');var Qweb=core.qweb;var KsKpiPreview=AbstractField.extend({supportedFieldTypes:['char'],resetOnAnyFieldChange:true,file_type_magic_word:{'/':'jpg','R':'gif','i':'png','P':'svg+xml',},ksNumFormatter:function(num,digits){var negative;var si=[{value:1,symbol:""},{value:1E3,symbol:"k"},{value:1E6,symbol:"M"},{value:1E9,symbol:"G"},{value:1E12,symbol:"T"},{value:1E15,symbol:"P"},{value:1E18,symbol:"E"}];if(num<0){num=Math.abs(num)
negative=true}
var rx=/\.0+$|(\.[0-9]*[1-9])0+$/;var i;for(i=si.length-1;i>0;i--){if(num>=si[i].value){break;}}
if(negative){return"-"+(num/si[i].value).toFixed(digits).replace(rx,"$1")+si[i].symbol;}else{return(num/si[i].value).toFixed(digits).replace(rx,"$1")+si[i].symbol;}},ksNumIndianFormatter:function(num,digits){var negative;var si=[{value:1,symbol:""},{value:1E3,symbol:"Th"},{value:1E5,symbol:"Lakh"},{value:1E7,symbol:"Cr"},{value:1E9,symbol:"Arab"}];if(num<0){num=Math.abs(num)
negative=true}
var rx=/\.0+$|(\.[0-9]*[1-9])0+$/;var i;for(i=si.length-1;i>0;i--){if(num>=si[i].value){break;}}
if(negative){return"-"+(num/si[i].value).toFixed(digits).replace(rx,"$1")+si[i].symbol;}else{return(num/si[i].value).toFixed(digits).replace(rx,"$1")+si[i].symbol;}},_render:function(){this.$el.empty();if(this.recordData.ks_model_id&&this.recordData.ks_dashboard_item_type==="ks_kpi"){if(!this.recordData.ks_model_id_2){if(!(this.recordData.ks_record_count_type==='count')){if(this.recordData.ks_record_field){this.renderKpi();}else{this.$el.append("Select a Record field ")}}else{this.renderKpi();}}else{if(!(this.recordData.ks_record_count_type_2==='count')&&!(this.recordData.ks_record_count_type==='count')){if(this.recordData.ks_record_field_2&&this.recordData.ks_record_field){this.renderKpi();}else{this.$el.append("Select a Record fields ")}}else if(!(this.recordData.ks_record_count_type_2==='count')&&(this.recordData.ks_record_count_type==='count')){if(this.recordData.ks_record_field_2){this.renderKpi();}else{this.$el.append("Select a Record field")}}else if((this.recordData.ks_record_count_type_2==='count')&&!(this.recordData.ks_record_count_type==='count')){if(this.recordData.ks_record_field){this.renderKpi();}else{this.$el.append("Select a Record field")}}else{this.renderKpi();}}}else{this.$el.append("Select a Model first")}},ksSum:function(count_1,count_2,item_info,field,target_1,$kpi_preview,kpi_data){var self=this;var count=count_1+count_2
if(field.ks_multiplier_active){item_info['count']=KsGlobalFunction._onKsGlobalFormatter(count*field.ks_multiplier,field.ks_data_format,field.ks_precision_digits);item_info['count_tooltip']=field_utils.format.float(count*field.ks_multiplier,Float64Array,{digits:[0,field.ks_precision_digits]});}else{item_info['count']=KsGlobalFunction._onKsGlobalFormatter(count,field.ks_data_format,field.ks_precision_digits,field.ks_precision_digits);item_info['count_tooltip']=field_utils.format.float(count,Float64Array,{digits:[0,field.ks_precision_digits]});}
if(field.ks_multiplier_active){count=count*field.ks_multiplier;}
item_info['target_enable']=field.ks_goal_enable;var ks_color=(target_1-count)>0?"red":"green";item_info.pre_arrow=(target_1-count)>0?"down":"up";item_info['ks_comparison']=true;var target_deviation=(target_1-count)>0?Math.round(((target_1-count)/target_1)*100):Math.round((Math.abs((target_1-count))/target_1)*100);if(target_deviation!==Infinity)item_info.target_deviation=field_utils.format.integer(target_deviation)+"%";else{item_info.pre_arrow=false;item_info.target_deviation=target_deviation;}
var target_progress_deviation=target_1==0?0:Math.round((count/target_1)*100);item_info.target_progress_deviation=field_utils.format.integer(target_progress_deviation)+"%";$kpi_preview=$(Qweb.render("ks_kpi_preview_template_2",item_info));$kpi_preview.find('.target_deviation').css({"color":ks_color});if(this.recordData.ks_target_view==="Progress Bar"){$kpi_preview.find('#ks_progressbar').val(target_progress_deviation)}
return $kpi_preview},ksPercentage:function(count_1,count_2,field,item_info,target_1,$kpi_preview){if(field.ks_multiplier_active){count_1=count_1*field.ks_multiplier;count_2=count_2*field.ks_multiplier;}
var count=parseInt((count_1/count_2)*100);if(field.ks_multiplier_active){count=count*field.ks_multiplier;}
if(!count)count=0;item_info['count']=count?field_utils.format.integer(count)+"%":"0%";item_info['count_tooltip']=count?count+"%":"0%";item_info.target_progress_deviation=item_info['count']
target_1=target_1>100?100:target_1;item_info.target=target_1+"%";item_info.pre_arrow=(target_1-count)>0?"down":"up";var ks_color=(target_1-count)>0?"red":"green";item_info['target_enable']=field.ks_goal_enable;item_info['ks_comparison']=false;item_info.target_deviation=item_info.target>100?100:item_info.target;$kpi_preview=$(Qweb.render("ks_kpi_preview_template_2",item_info));$kpi_preview.find('.target_deviation').css({"color":ks_color});if(this.recordData.ks_target_view==="Progress Bar"){$kpi_preview.find('#ks_progressbar').val(count)}
return $kpi_preview;},renderKpi:function(){var self=this;var field=this.recordData;var kpi_data=JSON.parse(field.ks_kpi_data);var count_1=kpi_data[0].record_data;var count_2=kpi_data[1]?kpi_data[1].record_data:undefined;var target_1=kpi_data[0].target;var ks_valid_date_selection=['l_day','t_week','t_month','t_quarter','t_year'];var target_view=field.ks_target_view,pre_view=field.ks_prev_view;var ks_rgba_background_color=self._get_rgba_format(field.ks_background_color);var ks_rgba_font_color=self._get_rgba_format(field.ks_font_color)
if(field.ks_goal_enable){var diffrence=0.0
if(field.ks_multiplier_active){diffrence=(count_1*field.ks_multiplier)-target_1}else{diffrence=count_1-target_1}
var acheive=diffrence>=0?true:false;diffrence=Math.abs(diffrence);var deviation=Math.round((diffrence/target_1)*100)
if(deviation!==Infinity)deviation=deviation?field_utils.format.integer(deviation)+'%':0+'%';}
if(field.ks_previous_period&&ks_valid_date_selection.indexOf(field.ks_date_filter_selection)>=0){var previous_period_data=kpi_data[0].previous_period;var pre_diffrence=(count_1-previous_period_data);if(field.ks_multiplier_active){var previous_period_data=kpi_data[0].previous_period*field.ks_multiplier;var pre_diffrence=(count_1*field.ks_multiplier-previous_period_data);}
var pre_acheive=pre_diffrence>0?true:false;pre_diffrence=Math.abs(pre_diffrence);var pre_deviation=previous_period_data?field_utils.format.integer(parseInt((pre_diffrence/previous_period_data)*100))+'%':"100%"}
var target_progress_deviation=String(Math.round((count_1/target_1)*100));if(field.ks_multiplier_active){var target_progress_deviation=String(Math.round(((count_1*field.ks_multiplier)/target_1)*100));}
var ks_rgba_icon_color=self._get_rgba_format(field.ks_default_icon_color)
var item_info={count_1:self.ksNumFormatter(kpi_data[0]['record_data'],1),count_1_tooltip:kpi_data[0]['record_data'],count_2:kpi_data[1]?String(kpi_data[1]['record_data']):false,name:field.name?field.name:field.ks_model_id.data.display_name,target_progress_deviation:target_progress_deviation,icon_select:field.ks_icon_select,default_icon:field.ks_default_icon,icon_color:ks_rgba_icon_color,target_deviation:deviation,target_arrow:acheive?'up':'down',ks_enable_goal:field.ks_goal_enable,ks_previous_period:ks_valid_date_selection.indexOf(field.ks_date_filter_selection)>=0?field.ks_previous_period:false,target:self.ksNumFormatter(target_1,1),previous_period_data:previous_period_data,pre_deviation:pre_deviation,pre_arrow:pre_acheive?'up':'down',target_view:field.ks_target_view,}
if(item_info.target_deviation===Infinity)item_info.target_arrow=false;item_info.target_progress_deviation=parseInt(item_info.target_progress_deviation)?field_utils.format.integer(parseInt(item_info.target_progress_deviation)):"0"
if(field.ks_icon){if(!utils.is_bin_size(field.ks_icon)){item_info['img_src']='data:image/'+(self.file_type_magic_word[field.ks_icon[0]]||'png')+';base64,'+field.ks_icon;}else{item_info['img_src']=session.url('/web/image',{model:self.model,id:JSON.stringify(self.res_id),field:"ks_icon",unique:field_utils.format.datetime(self.recordData.__last_update).replace(/[^0-9]/g,''),});}}
if(field.ks_multiplier_active){item_info['count_1']=KsGlobalFunction._onKsGlobalFormatter(kpi_data[0]['record_data']*field.ks_multiplier,field.ks_data_format,field.ks_precision_digits);item_info['count_1_tooltip']=kpi_data[0]['record_data']*field.ks_multiplier}else{item_info['count_1']=KsGlobalFunction._onKsGlobalFormatter(kpi_data[0]['record_data'],field.ks_data_format,field.ks_precision_digits);}
item_info['target']=KsGlobalFunction._onKsGlobalFormatter(kpi_data[0].target,field.ks_data_format,field.ks_precision_digits);var $kpi_preview;if(!kpi_data[1]){if(target_view==="Number"||!field.ks_goal_enable){$kpi_preview=$(Qweb.render("ks_kpi_preview_template",item_info));}else if(target_view==="Progress Bar"&&field.ks_goal_enable){$kpi_preview=$(Qweb.render("ks_kpi_preview_template_3",item_info));$kpi_preview.find('#ks_progressbar').val(parseInt(item_info.target_progress_deviation));}
if(field.ks_goal_enable){if(acheive){$kpi_preview.find(".target_deviation").css({"color":"green",});}else{$kpi_preview.find(".target_deviation").css({"color":"red",});}}
if(field.ks_previous_period&&String(previous_period_data)&&ks_valid_date_selection.indexOf(field.ks_date_filter_selection)>=0){if(pre_acheive){$kpi_preview.find(".pre_deviation").css({"color":"green",});}else{$kpi_preview.find(".pre_deviation").css({"color":"red",});}}
if($kpi_preview.find('.row').children().length!==2){$kpi_preview.find('.row').children().addClass('text-center');}}else{switch(field.ks_data_comparison){case"None":if(field.ks_multiplier_active){var count_tooltip=String(count_1*field.ks_multiplier)+"/"+String(count_2*field.ks_multiplier);var count=String(self.ksNumFormatter(count_1*field.ks_multiplier,1))+"/"+String(self.ksNumFormatter(count_2*field.ks_multiplier,1));item_info['count']=String(KsGlobalFunction._onKsGlobalFormatter(count_1*field.ks_multiplier,field.ks_data_format,field.ks_precision_digits))+"/"+String(KsGlobalFunction._onKsGlobalFormatter(count_2*field.ks_multiplier,field.ks_data_format,field.ks_precision_digits));}else{var count_tooltip=String(count_1)+"/"+String(count_2);var count=String(self.ksNumFormatter(count_1,1))+"/"+String(self.ksNumFormatter(count_2,1));item_info['count']=String(KsGlobalFunction._onKsGlobalFormatter(count_1,field.ks_data_format,field.ks_precision_digits))+"/"+String(KsGlobalFunction._onKsGlobalFormatter(count_2,field.ks_data_format,field.ks_precision_digits));}
item_info['count_tooltip']=count_tooltip
item_info['target_enable']=false;$kpi_preview=$(Qweb.render("ks_kpi_preview_template_2",item_info));break;case"Sum":$kpi_preview=self.ksSum(count_1,count_2,item_info,field,target_1,$kpi_preview,kpi_data);break;case"Percentage":$kpi_preview=self.ksPercentage(count_1,count_2,field,item_info,target_1,$kpi_preview);break;case"Ratio":var gcd=self.ks_get_gcd(Math.round(count_1),Math.round(count_2));if(field.ks_data_format=='exact'){if(count_1&&count_2){item_info['count_tooltip']=count_1/gcd+":"+count_2/gcd;item_info['count']=field_utils.format.float(count_1/gcd,Float64Array,{digits:[0,field.ks_precision_digits]})+":"+field_utils.format.float(count_2/gcd,Float64Array,{digits:[0,field.ks_precision_digits]});}else{item_info['count_tooltip']=count_1+":"+count_2;item_info['count']=count_1+":"+count_2}}else{if(count_1&&count_2){item_info['count_tooltip']=count_1/gcd+":"+count_2/gcd;item_info['count']=KsGlobalFunction.ksNumFormatter(count_1/gcd,1)+":"+KsGlobalFunction.ksNumFormatter(count_2/gcd,1);}else{item_info['count_tooltip']=(count_1)+":"+count_2;item_info['count']=KsGlobalFunction.ksNumFormatter(count_1,1)+":"+KsGlobalFunction.ksNumFormatter(count_2,1);}}
item_info['target_enable']=false;$kpi_preview=$(Qweb.render("ks_kpi_preview_template_2",item_info));break;}}
$kpi_preview.css({"background-color":ks_rgba_background_color,"color":ks_rgba_font_color,});this.$el.append($kpi_preview);},ks_get_gcd:function(a,b){return(b==0)?a:this.ks_get_gcd(b,a%b);},_get_rgba_format:function(val){var rgba=val.split(',')[0].match(/[A-Za-z0-9]{2}/g);rgba=rgba.map(function(v){return parseInt(v,16)}).join(",");return"rgba("+rgba+","+val.split(',')[1]+")";}});registry.add('ks_dashboard_kpi_preview',KsKpiPreview);return{KsKpiPreview:KsKpiPreview};});;

/* /ks_dashboard_ninja/static/src/js/ks_date_picker.js defined in bundle 'web.assets_backend' */
odoo.define("ks_dashboard_ninja.ks_date_picker",function(require){"use strict";var datepicker=require("web.datepicker");datepicker.DateWidget.include({_onDateTimePickerShow:function(){this._super.apply(this,arguments);if(this.name==="ks_dashboard"){window.removeEventListener('scroll',this._onScroll,true);}},});return datepicker;});

/* /ks_dashboard_ninja/static/lib/js/gridstack-h5.js defined in bundle 'web.assets_backend' */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.GridStack=e():t.GridStack=e()}(self,(function(){return(()=>{"use strict";var t={21:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GridStackDD=void 0;const s=i(334),o=i(270),r=i(593);class n extends s.GridStackDDI{static get(){return s.GridStackDDI.get()}remove(t){return this.draggable(t,"destroy").resizable(t,"destroy"),t.gridstackNode&&delete t.gridstackNode._initDD,this}}function l(t,e){let i=t?t.gridstackNode:void 0;i&&i.grid&&(e?i._isAboutToRemove=!0:delete i._isAboutToRemove,e?t.classList.add("grid-stack-item-removing"):t.classList.remove("grid-stack-item-removing"))}e.GridStackDD=n,o.GridStack.prototype._setupAcceptWidget=function(){if(this.opts.staticGrid||!this.opts.acceptWidgets&&!this.opts.removable)return n.get().droppable(this.el,"destroy"),this;let t,e,i,s=(s,o,l)=>{let a=o.gridstackNode;if(!a)return;let h=(l=l||o).getBoundingClientRect(),d=h.left-t.left,g=h.top-t.top,p={position:{top:g,left:d}};if(a._temporaryRemoved){if(a.x=Math.max(0,Math.round(d/i)),a.y=Math.max(0,Math.round(g/e)),delete a.autoPosition,this.engine.nodeBoundFix(a),!this.engine.willItFit(a)){if(a.autoPosition=!0,!this.engine.willItFit(a))return void n.get().off(o,"drag");a._willFitPos&&(r.Utils.copyPos(a,a._willFitPos),delete a._willFitPos)}this._onStartMoving(l,s,p,a,i,e)}else this._dragOrResize(l,s,p,a,i,e)};return n.get().droppable(this.el,{accept:t=>{let e=t.gridstackNode;if((null==e?void 0:e.grid)===this)return!0;if(!this.opts.acceptWidgets)return!1;let i=!0;if("function"==typeof this.opts.acceptWidgets)i=this.opts.acceptWidgets(t);else{let e=!0===this.opts.acceptWidgets?".grid-stack-item":this.opts.acceptWidgets;i=t.matches(e)}if(i&&e&&this.opts.maxRow){let t={w:e.w,h:e.h,minW:e.minW,minH:e.minH};i=this.engine.willItFit(t)}return i}}).on(this.el,"dropover",((o,r,a)=>{let h=r.gridstackNode;if((null==h?void 0:h.grid)===this&&!h._temporaryRemoved)return!1;(null==h?void 0:h.grid)&&h.grid!==this&&!h._temporaryRemoved&&h.grid._leave(r,a);let d=this.el.getBoundingClientRect();t={top:d.top,left:d.left},i=this.cellWidth(),e=this.getCellHeight(!0),h||(h=this._readAttr(r)),h.grid||(h._isExternal=!0,r.gridstackNode=h),a=a||r;let g=h.w||Math.round(a.offsetWidth/i)||1,p=h.h||Math.round(a.offsetHeight/e)||1;return h.grid&&h.grid!==this?(r._gridstackNodeOrig||(r._gridstackNodeOrig=h),r.gridstackNode=h=Object.assign(Object.assign({},h),{w:g,h:p,grid:this}),this.engine.cleanupNode(h).nodeBoundFix(h),h._initDD=h._isExternal=h._temporaryRemoved=!0):(h.w=g,h.h=p,h._temporaryRemoved=!0),l(h.el,!1),n.get().on(r,"drag",s),s(o,r,a),!1})).on(this.el,"dropout",((t,e,i)=>{let s=e.gridstackNode;return!!s&&(s.grid&&s.grid!==this||this._leave(e,i),!1)})).on(this.el,"drop",((t,e,i)=>{let s=e.gridstackNode;if((null==s?void 0:s.grid)===this&&!s._isExternal)return!1;let o=!!this.placeholder.parentElement;this.placeholder.remove();let l=e._gridstackNodeOrig;if(delete e._gridstackNodeOrig,o&&l&&l.grid&&l.grid!==this){let t=l.grid;t.engine.removedNodes.push(l),t._triggerRemoveEvent()}return!!s&&(o&&(this.engine.cleanupNode(s),s.grid=this),n.get().off(e,"drag"),i!==e?(i.remove(),e.gridstackNode=l,o&&(e=e.cloneNode(!0))):(e.remove(),n.get().remove(e)),!!o&&(e.gridstackNode=s,s.el=e,r.Utils.copyPos(s,this._readAttr(this.placeholder)),r.Utils.removePositioningStyles(e),this._writeAttr(e,s),this.el.appendChild(e),this._updateContainerHeight(),this.engine.addedNodes.push(s),this._triggerAddEvent(),this._triggerChangeEvent(),this.engine.endUpdate(),this._gsEventHandler.dropped&&this._gsEventHandler.dropped(Object.assign(Object.assign({},t),{type:"dropped"}),l&&l.grid?l:void 0,s),window.setTimeout((()=>{s.el&&s.el.parentElement?this._prepareDragDropByNode(s):this.engine.removeNode(s)})),!1))})),this},o.GridStack.prototype._setupRemoveDrop=function(){if(!this.opts.staticGrid&&"string"==typeof this.opts.removable){let t=document.querySelector(this.opts.removable);if(!t)return this;n.get().isDroppable(t)||n.get().droppable(t,this.opts.removableOptions).on(t,"dropover",((t,e)=>l(e,!0))).on(t,"dropout",((t,e)=>l(e,!1)))}return this},o.GridStack.setupDragIn=function(t,e){let i,s;if(t&&(i=t,s=Object.assign(Object.assign({},{revert:"invalid",handle:".grid-stack-item-content",scroll:!1,appendTo:"body"}),e||{})),"string"!=typeof i)return;let o=n.get();r.Utils.getElements(i).forEach((t=>{o.isDraggable(t)||o.dragIn(t,s)}))},o.GridStack.prototype._prepareDragDropByNode=function(t){let e=t.el,i=n.get();if(this.opts.staticGrid||(t.noMove||this.opts.disableDrag)&&(t.noResize||this.opts.disableResize))return t._initDD&&(i.remove(e),delete t._initDD),e.classList.add("ui-draggable-disabled","ui-resizable-disabled"),this;if(!t._initDD){let s,o,n=(i,r)=>{this._gsEventHandler[i.type]&&this._gsEventHandler[i.type](i,i.target),s=this.cellWidth(),o=this.getCellHeight(!0),this._onStartMoving(e,i,r,t,s,o)},l=(i,r)=>{this._dragOrResize(e,i,r,t,s,o)},a=s=>{this.placeholder.remove(),delete t._moving,delete t._lastTried;let o=s.target;if(o.gridstackNode&&o.gridstackNode.grid===this){if(t.el=o,t._isAboutToRemove){let r=e.gridstackNode.grid;r._gsEventHandler[s.type]&&r._gsEventHandler[s.type](s,o),i.remove(e),r.engine.removedNodes.push(t),r._triggerRemoveEvent(),delete e.gridstackNode,delete t.el,e.remove()}else t._temporaryRemoved?(r.Utils.removePositioningStyles(o),r.Utils.copyPos(t,t._orig),this._writePosAttr(o,t),this.engine.addNode(t)):(r.Utils.removePositioningStyles(o),this._writePosAttr(o,t)),this._gsEventHandler[s.type]&&this._gsEventHandler[s.type](s,o);this._extraDragRow=0,this._updateContainerHeight(),this._triggerChangeEvent(),this.engine.endUpdate()}};i.draggable(e,{start:n,stop:a,drag:l}).resizable(e,{start:n,stop:a,resize:l}),t._initDD=!0}return t.noMove||this.opts.disableDrag?(i.draggable(e,"disable"),e.classList.add("ui-draggable-disabled")):(i.draggable(e,"enable"),e.classList.remove("ui-draggable-disabled")),t.noResize||this.opts.disableResize?(i.resizable(e,"disable"),e.classList.add("ui-resizable-disabled")):(i.resizable(e,"enable"),e.classList.remove("ui-resizable-disabled")),this},o.GridStack.prototype._onStartMoving=function(t,e,i,s,o,r){if(this.engine.cleanNodes().beginUpdate(s),this._writePosAttr(this.placeholder,s),this.el.appendChild(this.placeholder),s.el=this.placeholder,s._lastUiPosition=i.position,s._prevYPix=i.position.top,s._moving="dragstart"===e.type,delete s._lastTried,"dropover"===e.type&&s._temporaryRemoved&&(this.engine.addNode(s),s._moving=!0),this.engine.cacheRects(o,r,this.opts.marginTop,this.opts.marginRight,this.opts.marginBottom,this.opts.marginLeft),"resizestart"===e.type){let e=n.get().resizable(t,"option","minWidth",o*(s.minW||1)).resizable(t,"option","minHeight",r*(s.minH||1));s.maxW&&e.resizable(t,"option","maxWidth",o*s.maxW),s.maxH&&e.resizable(t,"option","maxHeight",r*s.maxH)}},o.GridStack.prototype._leave=function(t,e){let i=t.gridstackNode;i&&(n.get().off(t,"drag"),i._temporaryRemoved||(i._temporaryRemoved=!0,this.engine.removeNode(i),i.el=i._isExternal&&e?e:t,!0===this.opts.removable&&l(t,!0),t._gridstackNodeOrig?(t.gridstackNode=t._gridstackNodeOrig,delete t._gridstackNodeOrig):i._isExternal&&(delete i.el,delete t.gridstackNode,this.engine.restoreInitial())))},o.GridStack.prototype._dragOrResize=function(t,e,i,s,o,n){let l,a=Object.assign({},s._orig),h=this.opts.marginLeft,d=this.opts.marginRight,g=this.opts.marginTop,p=this.opts.marginBottom,c=Math.round(.1*n),u=Math.round(.1*o);if(h=Math.min(h,u),d=Math.min(d,u),g=Math.min(g,c),p=Math.min(p,c),"drag"===e.type){if(s._temporaryRemoved)return;let e=i.position.top-s._prevYPix;s._prevYPix=i.position.top,r.Utils.updateScrollPosition(t,i.position,e);let l=i.position.left+(i.position.left>s._lastUiPosition.left?-d:h),c=i.position.top+(i.position.top>s._lastUiPosition.top?-p:g);a.x=Math.round(l/o),a.y=Math.round(c/n);let u=this._extraDragRow;if(this.engine.collide(s,a)){let t=this.getRow(),e=Math.max(0,a.y+s.h-t);this.opts.maxRow&&t+e>this.opts.maxRow&&(e=Math.max(0,this.opts.maxRow-t)),this._extraDragRow=e}else this._extraDragRow=0;if(this._extraDragRow!==u&&this._updateContainerHeight(),s.x===a.x&&s.y===a.y)return}else if("resize"===e.type){if(a.x<0)return;if(r.Utils.updateScrollResize(e,t,n),a.w=Math.round((i.size.width-h)/o),a.h=Math.round((i.size.height-g)/n),s.w===a.w&&s.h===a.h)return;if(s._lastTried&&s._lastTried.w===a.w&&s._lastTried.h===a.h)return;let d=i.position.left+h,p=i.position.top+g;a.x=Math.round(d/o),a.y=Math.round(p/n),l=!0}s._lastTried=a;let m={x:i.position.left+h,y:i.position.top+g,w:(i.size?i.size.width:s.w*o)-h-d,h:(i.size?i.size.height:s.h*n)-g-p};if(this.engine.moveNodeCheck(s,Object.assign(Object.assign({},a),{cellWidth:o,cellHeight:n,rect:m,resizing:l}))){s._lastUiPosition=i.position,this.engine.cacheRects(o,n,g,d,p,h),delete s._skipDown,l&&s.subGrid&&s.subGrid.onParentResize(),this._extraDragRow=0,this._updateContainerHeight();let t=e.target;this._writePosAttr(t,s),this._gsEventHandler[e.type]&&this._gsEventHandler[e.type](e,t)}},o.GridStack.prototype.movable=function(t,e){return this.opts.staticGrid||o.GridStack.getElements(t).forEach((t=>{let i=t.gridstackNode;i&&(e?delete i.noMove:i.noMove=!0,this._prepareDragDropByNode(i))})),this},o.GridStack.prototype.resizable=function(t,e){return this.opts.staticGrid||o.GridStack.getElements(t).forEach((t=>{let i=t.gridstackNode;i&&(e?delete i.noResize:i.noResize=!0,this._prepareDragDropByNode(i))})),this},o.GridStack.prototype.disable=function(){if(!this.opts.staticGrid)return this.enableMove(!1),this.enableResize(!1),this._triggerEvent("disable"),this},o.GridStack.prototype.enable=function(){if(!this.opts.staticGrid)return this.enableMove(!0),this.enableResize(!0),this._triggerEvent("enable"),this},o.GridStack.prototype.enableMove=function(t){return this.opts.staticGrid||(this.opts.disableDrag=!t,this.engine.nodes.forEach((e=>this.movable(e.el,t)))),this},o.GridStack.prototype.enableResize=function(t){return this.opts.staticGrid||(this.opts.disableResize=!t,this.engine.nodes.forEach((e=>this.resizable(e.el,t)))),this}},334:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GridStackDDI=void 0;class i{static registerPlugin(t){return i.ddi=new t,i.ddi}static get(){return i.ddi||i.registerPlugin(i)}remove(t){return this}}e.GridStackDDI=i},62:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GridStackEngine=void 0;const s=i(593);class o{constructor(t={}){this.addedNodes=[],this.removedNodes=[],this.column=t.column||12,this.onChange=t.onChange,this._float=t.float,this.maxRow=t.maxRow,this.nodes=t.nodes||[]}batchUpdate(){return this.batchMode||(this.batchMode=!0,this._prevFloat=this._float,this._float=!0,this.saveInitial()),this}commit(){return this.batchMode?(this.batchMode=!1,this._float=this._prevFloat,delete this._prevFloat,this._packNodes()._notify()):this}_useEntireRowArea(t,e){return!this.float&&!this._hasLocked&&(!t._moving||t._skipDown||e.y<=t.y)}_fixCollisions(t,e=t,i,o={}){if(this._sortNodes(-1),!(i=i||this.collide(t,e)))return!1;if(t._moving&&!o.nested&&!this.float&&this.swap(t,i))return!0;let r=e;this._useEntireRowArea(t,e)&&(r={x:0,w:this.column,y:e.y,h:e.h},i=this.collide(t,r,o.skip));let n=!1,l={nested:!0,pack:!1};for(;i=i||this.collide(t,r,o.skip);){let r;if(i.locked||t._moving&&!t._skipDown&&e.y>t.y&&!this.float&&(!this.collide(i,Object.assign(Object.assign({},i),{y:t.y}),t)||!this.collide(i,Object.assign(Object.assign({},i),{y:e.y-i.h}),t))?(t._skipDown=t._skipDown||e.y>t.y,r=this.moveNode(t,Object.assign(Object.assign(Object.assign({},e),{y:i.y+i.h}),l)),i.locked&&r?s.Utils.copyPos(e,t):!i.locked&&r&&o.pack&&(this._packNodes(),e.y=i.y+i.h,s.Utils.copyPos(t,e)),n=n||r):r=this.moveNode(i,Object.assign(Object.assign(Object.assign({},i),{y:e.y+e.h,skip:t}),l)),!r)return n;i=void 0}return n}collide(t,e=t,i){return this.nodes.find((o=>o!==t&&o!==i&&s.Utils.isIntercepted(o,e)))}collideAll(t,e=t,i){return this.nodes.filter((o=>o!==t&&o!==i&&s.Utils.isIntercepted(o,e)))}collideCoverage(t,e,i){if(!e.rect||!t._rect)return;let s,o=t._rect,r=Object.assign({},e.rect);return r.y>o.y?(r.h+=r.y-o.y,r.y=o.y):r.h+=o.y-r.y,r.x>o.x?(r.w+=r.x-o.x,r.x=o.x):r.w+=o.x-r.x,i.forEach((t=>{if(t.locked||!t._rect)return;let e=t._rect,i=Number.MAX_VALUE,n=Number.MAX_VALUE,l=.5;o.y<e.y?i=(r.y+r.h-e.y)/e.h:o.y+o.h>e.y+e.h&&(i=(e.y+e.h-r.y)/e.h),o.x<e.x?n=(r.x+r.w-e.x)/e.w:o.x+o.w>e.x+e.w&&(n=(e.x+e.w-r.x)/e.w);let a=Math.min(n,i);a>l&&(l=a,s=t)})),s}cacheRects(t,e,i,s,o,r){return this.nodes.forEach((n=>n._rect={y:n.y*e+i,x:n.x*t+r,w:n.w*t-r-s,h:n.h*e-i-o})),this}swap(t,e){if(!e||e.locked||!t||t.locked)return!1;function i(){let i=e.x,s=e.y;return e.x=t.x,e.y=t.y,t.h!=e.h?(t.x=i,t.y=e.y+e.h):t.w!=e.w?(t.x=e.x+e.w,t.y=s):(t.x=i,t.y=s),t._dirty=e._dirty=!0,!0}let o;if(t.w===e.w&&t.h===e.h&&(t.x===e.x||t.y===e.y)&&(o=s.Utils.isTouching(t,e)))return i();if(!1!==o){if(t.w===e.w&&t.x===e.x&&(o||(o=s.Utils.isTouching(t,e)))){if(e.y<t.y){let i=t;t=e,e=i}return i()}if(!1!==o){if(t.h===e.h&&t.y===e.y&&(o||(o=s.Utils.isTouching(t,e)))){if(e.x<t.x){let i=t;t=e,e=i}return i()}return!1}}}isAreaEmpty(t,e,i,s){let o={x:t||0,y:e||0,w:i||1,h:s||1};return!this.collide(o)}compact(){if(0===this.nodes.length)return this;this.batchUpdate()._sortNodes();let t=this.nodes;return this.nodes=[],t.forEach((t=>{t.locked||(t.autoPosition=!0),this.addNode(t,!1),t._dirty=!0})),this.commit()}set float(t){this._float!==t&&(this._float=t||!1,t||this._packNodes()._notify())}get float(){return this._float||!1}_sortNodes(t){return this.nodes=s.Utils.sort(this.nodes,t,this.column),this}_packNodes(){return this.batchMode||(this._sortNodes(),this.float?this.nodes.forEach((t=>{if(t._updating||void 0===t._orig||t.y===t._orig.y)return;let e=t.y;for(;e>t._orig.y;)--e,this.collide(t,{x:t.x,y:e,w:t.w,h:t.h})||(t._dirty=!0,t.y=e)})):this.nodes.forEach(((t,e)=>{if(!t.locked)for(;t.y>0;){let i=0===e?0:t.y-1;if(0!==e&&this.collide(t,{x:t.x,y:i,w:t.w,h:t.h}))break;t._dirty=t.y!==i,t.y=i}}))),this}prepareNode(t,e){(t=t||{})._id=t._id||o._idSeq++,void 0!==t.x&&void 0!==t.y&&null!==t.x&&null!==t.y||(t.autoPosition=!0);let i={x:0,y:0,w:1,h:1};return s.Utils.defaults(t,i),t.autoPosition||delete t.autoPosition,t.noResize||delete t.noResize,t.noMove||delete t.noMove,"string"==typeof t.x&&(t.x=Number(t.x)),"string"==typeof t.y&&(t.y=Number(t.y)),"string"==typeof t.w&&(t.w=Number(t.w)),"string"==typeof t.h&&(t.h=Number(t.h)),isNaN(t.x)&&(t.x=i.x,t.autoPosition=!0),isNaN(t.y)&&(t.y=i.y,t.autoPosition=!0),isNaN(t.w)&&(t.w=i.w),isNaN(t.h)&&(t.h=i.h),this.nodeBoundFix(t,e)}nodeBoundFix(t,e){let i=t._orig||s.Utils.copyPos({},t);return t.maxW&&(t.w=Math.min(t.w,t.maxW)),t.maxH&&(t.h=Math.min(t.h,t.maxH)),t.minW&&t.minW<=this.column&&(t.w=Math.max(t.w,t.minW)),t.minH&&(t.h=Math.max(t.h,t.minH)),t.w>this.column?(this.column<12&&!this._inColumnResize&&(t.w=Math.min(12,t.w),this.cacheOneLayout(t,12)),t.w=this.column):t.w<1&&(t.w=1),this.maxRow&&t.h>this.maxRow?t.h=this.maxRow:t.h<1&&(t.h=1),t.x<0&&(t.x=0),t.y<0&&(t.y=0),t.x+t.w>this.column&&(e?t.w=this.column-t.x:t.x=this.column-t.w),this.maxRow&&t.y+t.h>this.maxRow&&(e?t.h=this.maxRow-t.y:t.y=this.maxRow-t.h),s.Utils.samePos(t,i)||(t._dirty=!0),t}getDirtyNodes(t){return t?this.nodes.filter((t=>t._dirty&&!s.Utils.samePos(t,t._orig))):this.nodes.filter((t=>t._dirty))}_notify(t,e=!0){if(this.batchMode)return this;let i=(t=void 0===t?[]:Array.isArray(t)?t:[t]).concat(this.getDirtyNodes());return this.onChange&&this.onChange(i,e),this}cleanNodes(){return this.batchMode||this.nodes.forEach((t=>{delete t._dirty,delete t._lastTried})),this}saveInitial(){return this.nodes.forEach((t=>{t._orig=s.Utils.copyPos({},t),delete t._dirty})),this._hasLocked=this.nodes.some((t=>t.locked)),this}restoreInitial(){return this.nodes.forEach((t=>{s.Utils.samePos(t,t._orig)||(s.Utils.copyPos(t,t._orig),t._dirty=!0)})),this._notify(),this}addNode(t,e=!1){let i=this.nodes.find((e=>e._id===t._id));if(i)return i;if(delete(t=this._inColumnResize?this.nodeBoundFix(t):this.prepareNode(t))._temporaryRemoved,delete t._removeDOM,t.autoPosition){this._sortNodes();for(let e=0;;++e){let i=e%this.column,o=Math.floor(e/this.column);if(i+t.w>this.column)continue;let r={x:i,y:o,w:t.w,h:t.h};if(!this.nodes.find((t=>s.Utils.isIntercepted(r,t)))){t.x=i,t.y=o,delete t.autoPosition;break}}}return this.nodes.push(t),e&&this.addedNodes.push(t),this._fixCollisions(t),this.batchMode||this._packNodes()._notify(),t}removeNode(t,e=!0,i=!1){return this.nodes.find((e=>e===t))?(i&&this.removedNodes.push(t),e&&(t._removeDOM=!0),this.nodes=this.nodes.filter((e=>e!==t)),this._packNodes()._notify(t)):this}removeAll(t=!0){return delete this._layouts,0===this.nodes.length?this:(t&&this.nodes.forEach((t=>t._removeDOM=!0)),this.removedNodes=this.nodes,this.nodes=[],this._notify(this.removedNodes))}moveNodeCheck(t,e){if(!this.changedPosConstrain(t,e))return!1;if(e.pack=!0,!this.maxRow)return this.moveNode(t,e);let i,r=new o({column:this.column,float:this.float,nodes:this.nodes.map((e=>e===t?(i=Object.assign({},e),i):Object.assign({},e)))});if(!i)return!1;let n=r.moveNode(i,e);if(this.maxRow&&n&&(n=r.getRow()<=this.maxRow,!n&&!e.resizing)){let i=this.collide(t,e);if(i&&this.swap(t,i))return this._notify(),!0}return!!n&&(r.nodes.filter((t=>t._dirty)).forEach((t=>{let e=this.nodes.find((e=>e._id===t._id));e&&(s.Utils.copyPos(e,t),e._dirty=!0)})),this._notify(),!0)}willItFit(t){if(delete t._willFitPos,!this.maxRow)return!0;let e=new o({column:this.column,float:this.float,nodes:this.nodes.map((t=>Object.assign({},t)))}),i=Object.assign({},t);return this.cleanupNode(i),delete i.el,delete i._id,delete i.content,delete i.grid,e.addNode(i),e.getRow()<=this.maxRow&&(t._willFitPos=s.Utils.copyPos({},i),!0)}changedPosConstrain(t,e){return e.w=e.w||t.w,e.h=e.h||t.h,t.x!==e.x||t.y!==e.y||(t.maxW&&(e.w=Math.min(e.w,t.maxW)),t.maxH&&(e.h=Math.min(e.h,t.maxH)),t.minW&&(e.w=Math.max(e.w,t.minW)),t.minH&&(e.h=Math.max(e.h,t.minH)),t.w!==e.w||t.h!==e.h)}moveNode(t,e){if(!t||!e)return!1;void 0===e.pack&&(e.pack=!0),"number"!=typeof e.x&&(e.x=t.x),"number"!=typeof e.y&&(e.y=t.y),"number"!=typeof e.w&&(e.w=t.w),"number"!=typeof e.h&&(e.h=t.h);let i=t.w!==e.w||t.h!==e.h,o=s.Utils.copyPos({},t,!0);if(s.Utils.copyPos(o,e),o=this.nodeBoundFix(o,i),s.Utils.copyPos(e,o),s.Utils.samePos(t,e))return!1;let r=s.Utils.copyPos({},t),n=o,l=this.collideAll(t,n,e.skip),a=!0;if(l.length){let i=t._moving&&!e.nested?this.collideCoverage(t,e,l):l[0];a=!!i&&!this._fixCollisions(t,o,i,e)}return a&&(t._dirty=!0,s.Utils.copyPos(t,o)),e.pack&&this._packNodes()._notify(),!s.Utils.samePos(t,r)}getRow(){return this.nodes.reduce(((t,e)=>Math.max(t,e.y+e.h)),0)}beginUpdate(t){return t._updating||(t._updating=!0,delete t._skipDown,this.batchMode||this.saveInitial()),this}endUpdate(){let t=this.nodes.find((t=>t._updating));return t&&(delete t._updating,delete t._skipDown),this}save(t=!0){var e;let i=null===(e=this._layouts)||void 0===e?void 0:e.length,s=i&&this.column!==i-1?this._layouts[i-1]:null,o=[];return this._sortNodes(),this.nodes.forEach((e=>{let i=null==s?void 0:s.find((t=>t._id===e._id)),r=Object.assign({},e);i&&(r.x=i.x,r.y=i.y,r.w=i.w);for(let t in r)"_"!==t[0]&&null!==r[t]&&void 0!==r[t]||delete r[t];delete r.grid,t||delete r.el,r.autoPosition||delete r.autoPosition,r.noResize||delete r.noResize,r.noMove||delete r.noMove,r.locked||delete r.locked,o.push(r)})),o}layoutsNodesChange(t){return!this._layouts||this._inColumnResize||this._layouts.forEach(((e,i)=>{if(!e||i===this.column)return this;if(i<this.column)this._layouts[i]=void 0;else{let s=i/this.column;t.forEach((t=>{if(!t._orig)return;let i=e.find((e=>e._id===t._id));i&&(t.y!==t._orig.y&&(i.y+=t.y-t._orig.y),t.x!==t._orig.x&&(i.x=Math.round(t.x*s)),t.w!==t._orig.w&&(i.w=Math.round(t.w*s)))}))}})),this}updateNodeWidths(t,e,i,o="moveScale"){var r;if(!this.nodes.length||!e||t===e)return this;this.cacheLayout(this.nodes,t),this.batchUpdate();let n=[],l=!1;if(1===e&&(null==i?void 0:i.length)){l=!0;let t=0;i.forEach((e=>{e.x=0,e.w=1,e.y=Math.max(e.y,t),t=e.y+e.h})),n=i,i=[]}else i=s.Utils.sort(this.nodes,-1,t);let a=[];if(e>t){a=this._layouts[e]||[];let s=this._layouts.length-1;!a.length&&t!==s&&(null===(r=this._layouts[s])||void 0===r?void 0:r.length)&&(t=s,this._layouts[s].forEach((t=>{let e=i.find((e=>e._id===t._id));e&&(e.x=t.x,e.y=t.y,e.w=t.w)})))}if(a.forEach((t=>{let e=i.findIndex((e=>e._id===t._id));-1!==e&&(i[e].x=t.x,i[e].y=t.y,i[e].w=t.w,n.push(i[e]),i.splice(e,1))})),i.length)if("function"==typeof o)o(e,t,n,i);else if(!l){let s=e/t,r="move"===o||"moveScale"===o,l="scale"===o||"moveScale"===o;i.forEach((i=>{i.x=1===e?0:r?Math.round(i.x*s):Math.min(i.x,e-1),i.w=1===e||1===t?1:l?Math.round(i.w*s)||1:Math.min(i.w,e),n.push(i)})),i=[]}return n=s.Utils.sort(n,-1,e),this._inColumnResize=!0,this.nodes=[],n.forEach((t=>{this.addNode(t,!1),delete t._orig})),this.commit(),delete this._inColumnResize,this}cacheLayout(t,e,i=!1){let s=[];return t.forEach(((t,e)=>{t._id=t._id||o._idSeq++,s[e]={x:t.x,y:t.y,w:t.w,_id:t._id}})),this._layouts=i?[]:this._layouts||[],this._layouts[e]=s,this}cacheOneLayout(t,e){t._id=t._id||o._idSeq++;let i={x:t.x,y:t.y,w:t.w,_id:t._id};this._layouts=this._layouts||[],this._layouts[e]=this._layouts[e]||[];let s=this._layouts[e].findIndex((e=>e._id===t._id));return-1===s?this._layouts[e].push(i):this._layouts[e][s]=i,this}cleanupNode(t){for(let e in t)"_"===e[0]&&"_id"!==e&&delete t[e];return this}}e.GridStackEngine=o,o._idSeq=1},930:function(t,e,i){var s=this&&this.__createBinding||(Object.create?function(t,e,i,s){void 0===s&&(s=i),Object.defineProperty(t,s,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,s){void 0===s&&(s=i),t[s]=e[i]}),o=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||e.hasOwnProperty(i)||s(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),o(i(699),e),o(i(593),e),o(i(62),e),o(i(334),e),o(i(270),e),o(i(761),e)},270:function(t,e,i){var s=this&&this.__createBinding||(Object.create?function(t,e,i,s){void 0===s&&(s=i),Object.defineProperty(t,s,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,s){void 0===s&&(s=i),t[s]=e[i]}),o=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||e.hasOwnProperty(i)||s(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),e.GridStack=void 0;const r=i(62),n=i(593),l=i(334);o(i(699),e),o(i(593),e),o(i(62),e),o(i(334),e);const a={column:12,minRow:0,maxRow:0,itemClass:"grid-stack-item",placeholderClass:"grid-stack-placeholder",placeholderText:"",handle:".grid-stack-item-content",handleClass:null,styleInHead:!1,cellHeight:"auto",cellHeightThrottle:100,margin:10,auto:!0,minWidth:768,float:!1,staticGrid:!1,animate:!0,alwaysShowResizeHandle:!1,resizable:{autoHide:!0,handles:"se"},draggable:{handle:".grid-stack-item-content",scroll:!1,appendTo:"body"},disableDrag:!1,disableResize:!1,rtl:"auto",removable:!1,removableOptions:{accept:".grid-stack-item"},marginUnit:"px",cellHeightUnit:"px",disableOneColumnMode:!1,oneColumnModeDomSort:!1};class h{constructor(t,e={}){this._gsEventHandler={},this._extraDragRow=0,this.el=t,(e=e||{}).row&&(e.minRow=e.maxRow=e.row,delete e.row);let i=n.Utils.toNumber(t.getAttribute("gs-row")),s=Object.assign(Object.assign({},n.Utils.cloneDeep(a)),{column:n.Utils.toNumber(t.getAttribute("gs-column"))||12,minRow:i||n.Utils.toNumber(t.getAttribute("gs-min-row"))||0,maxRow:i||n.Utils.toNumber(t.getAttribute("gs-max-row"))||0,staticGrid:n.Utils.toBool(t.getAttribute("gs-static"))||!1,_styleSheetClass:"grid-stack-instance-"+(1e4*Math.random()).toFixed(0),alwaysShowResizeHandle:e.alwaysShowResizeHandle||!1,resizable:{autoHide:!e.alwaysShowResizeHandle,handles:"se"},draggable:{handle:(e.handleClass?"."+e.handleClass:e.handle?e.handle:"")||".grid-stack-item-content",scroll:!1,appendTo:"body"},removableOptions:{accept:"."+(e.itemClass||"grid-stack-item")}});t.getAttribute("gs-animate")&&(s.animate=n.Utils.toBool(t.getAttribute("gs-animate"))),this.opts=n.Utils.defaults(e,s),e=null,this.initMargin(),1!==this.opts.column&&!this.opts.disableOneColumnMode&&this._widthOrContainer()<=this.opts.minWidth&&(this._prevColumn=this.opts.column,this.opts.column=1),"auto"===this.opts.rtl&&(this.opts.rtl="rtl"===t.style.direction),this.opts.rtl&&this.el.classList.add("grid-stack-rtl");let o=n.Utils.closestByClass(this.el,a.itemClass);if(o&&o.gridstackNode&&(this.opts._isNested=o.gridstackNode,this.opts._isNested.subGrid=this,this.el.classList.add("grid-stack-nested")),this._isAutoCellHeight="auto"===this.opts.cellHeight,this._isAutoCellHeight||"initial"===this.opts.cellHeight?this.cellHeight(void 0,!1):("number"==typeof this.opts.cellHeight&&this.opts.cellHeightUnit&&this.opts.cellHeightUnit!==a.cellHeightUnit&&(this.opts.cellHeight=this.opts.cellHeight+this.opts.cellHeightUnit,delete this.opts.cellHeightUnit),this.cellHeight(this.opts.cellHeight,!1)),this.el.classList.add(this.opts._styleSheetClass),this._setStaticClass(),this.engine=new r.GridStackEngine({column:this.opts.column,float:this.opts.float,maxRow:this.opts.maxRow,onChange:t=>{let e=0;this.engine.nodes.forEach((t=>{e=Math.max(e,t.y+t.h)})),t.forEach((t=>{let e=t.el;e&&(t._removeDOM?(e&&e.remove(),delete t._removeDOM):this._writePosAttr(e,t))})),this._updateStyles(!1,e)}}),this.opts.auto){this.batchUpdate();let t=[];this.getGridItems().forEach((e=>{let i=parseInt(e.getAttribute("gs-x")),s=parseInt(e.getAttribute("gs-y"));t.push({el:e,i:(Number.isNaN(i)?1e3:i)+(Number.isNaN(s)?1e3:s)*this.opts.column})})),t.sort(((t,e)=>t.i-e.i)).forEach((t=>this._prepareElement(t.el))),this.commit()}this.setAnimation(this.opts.animate),this._updateStyles(),12!=this.opts.column&&this.el.classList.add("grid-stack-"+this.opts.column),this.opts.dragIn&&h.setupDragIn(this.opts.dragIn,this.opts.dragInOptions),delete this.opts.dragIn,delete this.opts.dragInOptions,this._setupRemoveDrop(),this._setupAcceptWidget(),this._updateWindowResizeEvent()}static init(t={},e=".grid-stack"){let i=h.getGridElement(e);return i?(i.gridstack||(i.gridstack=new h(i,n.Utils.cloneDeep(t))),i.gridstack):("string"==typeof e?console.error('GridStack.initAll() no grid was found with selector "'+e+'" - element missing or wrong selector ?\nNote: ".grid-stack" is required for proper CSS styling and drag/drop, and is the default selector.'):console.error("GridStack.init() no grid element was passed."),null)}static initAll(t={},e=".grid-stack"){let i=[];return h.getGridElements(e).forEach((e=>{e.gridstack||(e.gridstack=new h(e,n.Utils.cloneDeep(t)),delete t.dragIn,delete t.dragInOptions),i.push(e.gridstack)})),0===i.length&&console.error('GridStack.initAll() no grid was found with selector "'+e+'" - element missing or wrong selector ?\nNote: ".grid-stack" is required for proper CSS styling and drag/drop, and is the default selector.'),i}static addGrid(t,e={}){if(!t)return null;let i=t;if(!t.classList.contains("grid-stack")){let s=document.implementation.createHTMLDocument("");s.body.innerHTML=`<div class="grid-stack ${e.class||""}"></div>`,i=s.body.children[0],t.appendChild(i)}let s=h.init(e,i);if(s.opts.children){let t=s.opts.children;delete s.opts.children,s.load(t)}return s}get placeholder(){if(!this._placeholder){let t=document.createElement("div");t.className="placeholder-content",this.opts.placeholderText&&(t.innerHTML=this.opts.placeholderText),this._placeholder=document.createElement("div"),this._placeholder.classList.add(this.opts.placeholderClass,a.itemClass,this.opts.itemClass),this.placeholder.appendChild(t)}return this._placeholder}addWidget(t,e){if(arguments.length>2){console.warn("gridstack.ts: `addWidget(el, x, y, width...)` is deprecated. Use `addWidget({x, y, w, content, ...})`. It will be removed soon");let e=arguments,i=1,s={x:e[i++],y:e[i++],w:e[i++],h:e[i++],autoPosition:e[i++],minW:e[i++],maxW:e[i++],minH:e[i++],maxH:e[i++],id:e[i++]};return this.addWidget(t,s)}let i;if("string"==typeof t){let e=document.implementation.createHTMLDocument("");e.body.innerHTML=t,i=e.body.children[0]}else if(0===arguments.length||1===arguments.length&&(void 0!==(s=t).x||void 0!==s.y||void 0!==s.w||void 0!==s.h||void 0!==s.content)){let s=t&&t.content||"";e=t;let o=document.implementation.createHTMLDocument("");o.body.innerHTML=`<div class="grid-stack-item ${this.opts.itemClass||""}"><div class="grid-stack-item-content">${s}</div></div>`,i=o.body.children[0]}else i=t;var s;let o=this._readAttr(i);e=n.Utils.cloneDeep(e)||{},n.Utils.defaults(e,o);let r=this.engine.prepareNode(e);if(this._writeAttr(i,e),this._insertNotAppend?this.el.prepend(i):this.el.appendChild(i),this._prepareElement(i,!0,e),this._updateContainerHeight(),r.subGrid&&!r.subGrid.el){let t=r.el.querySelector(".grid-stack-item-content");r.subGrid=h.addGrid(t,r.subGrid)}return this._triggerAddEvent(),this._triggerChangeEvent(),i}save(t=!0,e=!1){let i=this.engine.save(t);if(i.forEach((e=>{if(t&&e.el&&!e.subGrid){let t=e.el.querySelector(".grid-stack-item-content");e.content=t?t.innerHTML:void 0,e.content||delete e.content}else t||delete e.content,e.subGrid&&(e.subGrid=e.subGrid.save(t,!0));delete e.el})),e){let t=n.Utils.cloneDeep(this.opts);return t.marginBottom===t.marginTop&&t.marginRight===t.marginLeft&&t.marginTop===t.marginRight&&(t.margin=t.marginTop,delete t.marginTop,delete t.marginRight,delete t.marginBottom,delete t.marginLeft),t.rtl===("rtl"===this.el.style.direction)&&(t.rtl="auto"),this._isAutoCellHeight&&(t.cellHeight="auto"),n.Utils.removeInternalAndSame(t,a),t.children=i,t}return i}load(t,e=!0){let i=h.Utils.sort([...t],-1,this._prevColumn||this.opts.column);this._insertNotAppend=!0,this._prevColumn&&this._prevColumn!==this.opts.column&&i.some((t=>t.x+t.w>this.opts.column))&&(this._ignoreLayoutsNodeChange=!0,this.engine.cacheLayout(i,this._prevColumn,!0));let s=[];return this.batchUpdate(),e&&[...this.engine.nodes].forEach((t=>{i.find((e=>t.id===e.id))||("function"==typeof e?e(this,t,!1):(s.push(t),this.removeWidget(t.el,!0,!1)))})),i.forEach((t=>{let i=t.id||0===t.id?this.engine.nodes.find((e=>e.id===t.id)):void 0;if(i){if(this.update(i.el,t),t.subGrid&&t.subGrid.children){let e=i.el.querySelector(".grid-stack");e&&e.gridstack&&(e.gridstack.load(t.subGrid.children),this._insertNotAppend=!0)}}else e&&(t="function"==typeof e?e(this,t,!0).gridstackNode:this.addWidget(t).gridstackNode)})),this.engine.removedNodes=s,this.commit(),delete this._ignoreLayoutsNodeChange,delete this._insertNotAppend,this}batchUpdate(){return this.engine.batchUpdate(),this}getCellHeight(t=!1){return!this.opts.cellHeight||"auto"===this.opts.cellHeight||t&&this.opts.cellHeightUnit&&"px"!==this.opts.cellHeightUnit?Math.round(this.el.getBoundingClientRect().height)/parseInt(this.el.getAttribute("gs-current-row")):this.opts.cellHeight}cellHeight(t,e=!0){if(e&&void 0!==t&&this._isAutoCellHeight!==("auto"===t)&&(this._isAutoCellHeight="auto"===t,this._updateWindowResizeEvent()),"initial"!==t&&"auto"!==t||(t=void 0),void 0===t){let e=-this.opts.marginRight-this.opts.marginLeft+this.opts.marginTop+this.opts.marginBottom;t=this.cellWidth()+e}let i=n.Utils.parseHeight(t);return this.opts.cellHeightUnit===i.unit&&this.opts.cellHeight===i.h||(this.opts.cellHeightUnit=i.unit,this.opts.cellHeight=i.h,e&&this._updateStyles(!0,this.getRow())),this}cellWidth(){return this._widthOrContainer()/this.opts.column}_widthOrContainer(){return this.el.clientWidth||this.el.parentElement.clientWidth||window.innerWidth}commit(){return this.engine.commit(),this._triggerRemoveEvent(),this._triggerAddEvent(),this._triggerChangeEvent(),this}compact(){return this.engine.compact(),this._triggerChangeEvent(),this}column(t,e="moveScale"){if(t<1||this.opts.column===t)return this;let i,s=this.opts.column;return 1===t?this._prevColumn=s:delete this._prevColumn,this.el.classList.remove("grid-stack-"+s),this.el.classList.add("grid-stack-"+t),this.opts.column=this.engine.column=t,1===t&&this.opts.oneColumnModeDomSort&&(i=[],this.getGridItems().forEach((t=>{t.gridstackNode&&i.push(t.gridstackNode)})),i.length||(i=void 0)),this.engine.updateNodeWidths(s,t,i,e),this._isAutoCellHeight&&this.cellHeight(),this._ignoreLayoutsNodeChange=!0,this._triggerChangeEvent(),delete this._ignoreLayoutsNodeChange,this}getColumn(){return this.opts.column}getGridItems(){return Array.from(this.el.children).filter((t=>t.matches("."+this.opts.itemClass)&&!t.matches("."+this.opts.placeholderClass)))}destroy(t=!0){if(this.el)return this._updateWindowResizeEvent(!0),this.setStatic(!0,!1),this.setAnimation(!1),t?this.el.parentNode.removeChild(this.el):(this.removeAll(t),this.el.classList.remove(this.opts._styleSheetClass)),this._removeStylesheet(),this.el.removeAttribute("gs-current-row"),delete this.opts._isNested,delete this.opts,delete this._placeholder,delete this.engine,delete this.el.gridstack,delete this.el,this}float(t){return this.engine.float=t,this._triggerChangeEvent(),this}getFloat(){return this.engine.float}getCellFromPixel(t,e=!1){let i,s=this.el.getBoundingClientRect();i=e?{top:s.top+document.documentElement.scrollTop,left:s.left}:{top:this.el.offsetTop,left:this.el.offsetLeft};let o=t.left-i.left,r=t.top-i.top,n=s.width/this.opts.column,l=s.height/parseInt(this.el.getAttribute("gs-current-row"));return{x:Math.floor(o/n),y:Math.floor(r/l)}}getRow(){return Math.max(this.engine.getRow(),this.opts.minRow)}isAreaEmpty(t,e,i,s){return this.engine.isAreaEmpty(t,e,i,s)}makeWidget(t){let e=h.getElement(t);return this._prepareElement(e,!0),this._updateContainerHeight(),this._triggerAddEvent(),this._triggerChangeEvent(),e}on(t,e){if(-1!==t.indexOf(" "))return t.split(" ").forEach((t=>this.on(t,e))),this;if("change"===t||"added"===t||"removed"===t||"enable"===t||"disable"===t){let i="enable"===t||"disable"===t;this._gsEventHandler[t]=i?t=>e(t):t=>e(t,t.detail),this.el.addEventListener(t,this._gsEventHandler[t])}else"drag"===t||"dragstart"===t||"dragstop"===t||"resizestart"===t||"resize"===t||"resizestop"===t||"dropped"===t?this._gsEventHandler[t]=e:console.log("GridStack.on("+t+') event not supported, but you can still use $(".grid-stack").on(...) while jquery-ui is still used internally.');return this}off(t){return-1!==t.indexOf(" ")?(t.split(" ").forEach((t=>this.off(t))),this):("change"!==t&&"added"!==t&&"removed"!==t&&"enable"!==t&&"disable"!==t||this._gsEventHandler[t]&&this.el.removeEventListener(t,this._gsEventHandler[t]),delete this._gsEventHandler[t],this)}removeWidget(t,e=!0,i=!0){return h.getElements(t).forEach((t=>{if(t.parentElement!==this.el)return;let s=t.gridstackNode;s||(s=this.engine.nodes.find((e=>t===e.el))),s&&(delete t.gridstackNode,l.GridStackDDI.get().remove(t),this.engine.removeNode(s,e,i),e&&t.parentElement&&t.remove())})),i&&(this._triggerRemoveEvent(),this._triggerChangeEvent()),this}removeAll(t=!0){return this.engine.nodes.forEach((t=>{delete t.el.gridstackNode,l.GridStackDDI.get().remove(t.el)})),this.engine.removeAll(t),this._triggerRemoveEvent(),this}setAnimation(t){return t?this.el.classList.add("grid-stack-animate"):this.el.classList.remove("grid-stack-animate"),this}setStatic(t,e=!0){return this.opts.staticGrid===t||(this.opts.staticGrid=t,this._setupRemoveDrop(),this._setupAcceptWidget(),this.engine.nodes.forEach((t=>this._prepareDragDropByNode(t))),e&&this._setStaticClass()),this}update(t,e){if(arguments.length>2){console.warn("gridstack.ts: `update(el, x, y, w, h)` is deprecated. Use `update(el, {x, w, content, ...})`. It will be removed soon");let i=arguments,s=1;return e={x:i[s++],y:i[s++],w:i[s++],h:i[s++]},this.update(t,e)}return h.getElements(t).forEach((t=>{if(!t||!t.gridstackNode)return;let i=t.gridstackNode,s=n.Utils.cloneDeep(e);delete s.autoPosition;let o,r=["x","y","w","h"];if(r.some((t=>void 0!==s[t]&&s[t]!==i[t]))&&(o={},r.forEach((t=>{o[t]=void 0!==s[t]?s[t]:i[t],delete s[t]}))),!o&&(s.minW||s.minH||s.maxW||s.maxH)&&(o={}),s.content){let e=t.querySelector(".grid-stack-item-content");e&&e.innerHTML!==s.content&&(e.innerHTML=s.content),delete s.content}let l=!1,a=!1;for(const t in s)"_"!==t[0]&&i[t]!==s[t]&&(i[t]=s[t],l=!0,a=a||!this.opts.staticGrid&&("noResize"===t||"noMove"===t||"locked"===t));o&&(this.engine.cleanNodes().beginUpdate(i).moveNode(i,o),this._updateContainerHeight(),this._triggerChangeEvent(),this.engine.endUpdate()),l&&this._writeAttr(t,i),a&&this._prepareDragDropByNode(i)})),this}margin(t){if(!("string"==typeof t&&t.split(" ").length>1)){let e=n.Utils.parseHeight(t);if(this.opts.marginUnit===e.unit&&this.opts.margin===e.h)return}return this.opts.margin=t,this.opts.marginTop=this.opts.marginBottom=this.opts.marginLeft=this.opts.marginRight=void 0,this.initMargin(),this._updateStyles(!0),this}getMargin(){return this.opts.margin}willItFit(t){if(arguments.length>1){console.warn("gridstack.ts: `willItFit(x,y,w,h,autoPosition)` is deprecated. Use `willItFit({x, y,...})`. It will be removed soon");let t=arguments,e=0,i={x:t[e++],y:t[e++],w:t[e++],h:t[e++],autoPosition:t[e++]};return this.willItFit(i)}return this.engine.willItFit(t)}_triggerChangeEvent(){if(this.engine.batchMode)return this;let t=this.engine.getDirtyNodes(!0);return t&&t.length&&(this._ignoreLayoutsNodeChange||this.engine.layoutsNodesChange(t),this._triggerEvent("change",t)),this.engine.saveInitial(),this}_triggerAddEvent(){return this.engine.batchMode||this.engine.addedNodes&&this.engine.addedNodes.length>0&&(this._ignoreLayoutsNodeChange||this.engine.layoutsNodesChange(this.engine.addedNodes),this.engine.addedNodes.forEach((t=>{delete t._dirty})),this._triggerEvent("added",this.engine.addedNodes),this.engine.addedNodes=[]),this}_triggerRemoveEvent(){return this.engine.batchMode||this.engine.removedNodes&&this.engine.removedNodes.length>0&&(this._triggerEvent("removed",this.engine.removedNodes),this.engine.removedNodes=[]),this}_triggerEvent(t,e){let i=e?new CustomEvent(t,{bubbles:!1,detail:e}):new Event(t);return this.el.dispatchEvent(i),this}_removeStylesheet(){return this._styles&&(n.Utils.removeStylesheet(this._styles._id),delete this._styles),this}_updateStyles(t=!1,e){if(t&&this._removeStylesheet(),this._updateContainerHeight(),0===this.opts.cellHeight)return this;let i=this.opts.cellHeight,s=this.opts.cellHeightUnit,o=`.${this.opts._styleSheetClass} > .${this.opts.itemClass}`;if(!this._styles){let t="gridstack-style-"+(1e5*Math.random()).toFixed(),e=this.opts.styleInHead?void 0:this.el.parentNode;if(this._styles=n.Utils.createStylesheet(t,e),!this._styles)return this;this._styles._id=t,this._styles._max=0,n.Utils.addCSSRule(this._styles,o,`min-height: ${i}${s}`);let r=this.opts.marginTop+this.opts.marginUnit,l=this.opts.marginBottom+this.opts.marginUnit,a=this.opts.marginRight+this.opts.marginUnit,h=this.opts.marginLeft+this.opts.marginUnit,d=`${o} > .grid-stack-item-content`,g=`.${this.opts._styleSheetClass} > .grid-stack-placeholder > .placeholder-content`;n.Utils.addCSSRule(this._styles,d,`top: ${r}; right: ${a}; bottom: ${l}; left: ${h};`),n.Utils.addCSSRule(this._styles,g,`top: ${r}; right: ${a}; bottom: ${l}; left: ${h};`),n.Utils.addCSSRule(this._styles,`${o} > .ui-resizable-ne`,`right: ${a}`),n.Utils.addCSSRule(this._styles,`${o} > .ui-resizable-e`,`right: ${a}`),n.Utils.addCSSRule(this._styles,`${o} > .ui-resizable-se`,`right: ${a}; bottom: ${l}`),n.Utils.addCSSRule(this._styles,`${o} > .ui-resizable-nw`,`left: ${h}`),n.Utils.addCSSRule(this._styles,`${o} > .ui-resizable-w`,`left: ${h}`),n.Utils.addCSSRule(this._styles,`${o} > .ui-resizable-sw`,`left: ${h}; bottom: ${l}`)}if((e=e||this._styles._max)>this._styles._max){let t=t=>i*t+s;for(let i=this._styles._max+1;i<=e;i++){let e=t(i);n.Utils.addCSSRule(this._styles,`${o}[gs-y="${i-1}"]`,`top: ${t(i-1)}`),n.Utils.addCSSRule(this._styles,`${o}[gs-h="${i}"]`,`height: ${e}`),n.Utils.addCSSRule(this._styles,`${o}[gs-min-h="${i}"]`,`min-height: ${e}`),n.Utils.addCSSRule(this._styles,`${o}[gs-max-h="${i}"]`,`max-height: ${e}`)}this._styles._max=e}return this}_updateContainerHeight(){if(!this.engine||this.engine.batchMode)return this;let t=this.getRow()+this._extraDragRow,e=parseInt(getComputedStyle(this.el)["min-height"]);if(e>0){let i=Math.round(e/this.getCellHeight(!0));t<i&&(t=i)}if(this.el.setAttribute("gs-current-row",String(t)),0===t)return this.el.style.removeProperty("height"),this;let i=this.opts.cellHeight,s=this.opts.cellHeightUnit;return i?(this.el.style.height=t*i+s,this):this}_prepareElement(t,e=!1,i){i||(t.classList.add(this.opts.itemClass),i=this._readAttr(t)),t.gridstackNode=i,i.el=t,i.grid=this;let s=Object.assign({},i);return i=this.engine.addNode(i,e),n.Utils.same(i,s)||this._writeAttr(t,i),this._prepareDragDropByNode(i),this}_writePosAttr(t,e){return void 0!==e.x&&null!==e.x&&t.setAttribute("gs-x",String(e.x)),void 0!==e.y&&null!==e.y&&t.setAttribute("gs-y",String(e.y)),e.w&&t.setAttribute("gs-w",String(e.w)),e.h&&t.setAttribute("gs-h",String(e.h)),this}_writeAttr(t,e){if(!e)return this;this._writePosAttr(t,e);let i={autoPosition:"gs-auto-position",minW:"gs-min-w",minH:"gs-min-h",maxW:"gs-max-w",maxH:"gs-max-h",noResize:"gs-no-resize",noMove:"gs-no-move",locked:"gs-locked",id:"gs-id",resizeHandles:"gs-resize-handles"};for(const s in i)e[s]?t.setAttribute(i[s],String(e[s])):t.removeAttribute(i[s]);return this}_readAttr(t){let e={};e.x=n.Utils.toNumber(t.getAttribute("gs-x")),e.y=n.Utils.toNumber(t.getAttribute("gs-y")),e.w=n.Utils.toNumber(t.getAttribute("gs-w")),e.h=n.Utils.toNumber(t.getAttribute("gs-h")),e.maxW=n.Utils.toNumber(t.getAttribute("gs-max-w")),e.minW=n.Utils.toNumber(t.getAttribute("gs-min-w")),e.maxH=n.Utils.toNumber(t.getAttribute("gs-max-h")),e.minH=n.Utils.toNumber(t.getAttribute("gs-min-h")),e.autoPosition=n.Utils.toBool(t.getAttribute("gs-auto-position")),e.noResize=n.Utils.toBool(t.getAttribute("gs-no-resize")),e.noMove=n.Utils.toBool(t.getAttribute("gs-no-move")),e.locked=n.Utils.toBool(t.getAttribute("gs-locked")),e.resizeHandles=t.getAttribute("gs-resize-handles"),e.id=t.getAttribute("gs-id");for(const t in e){if(!e.hasOwnProperty(t))return;e[t]||0===e[t]||delete e[t]}return e}_setStaticClass(){let t=["grid-stack-static"];return this.opts.staticGrid?(this.el.classList.add(...t),this.el.setAttribute("gs-static","true")):(this.el.classList.remove(...t),this.el.removeAttribute("gs-static")),this}onParentResize(){if(!this.el||!this.el.clientWidth)return;let t=!this.opts.disableOneColumnMode&&this.el.clientWidth<=this.opts.minWidth,e=!1;return 1===this.opts.column!==t&&(e=!0,this.opts.animate&&this.setAnimation(!1),this.column(t?1:this._prevColumn),this.opts.animate&&this.setAnimation(!0)),this._isAutoCellHeight&&(!e&&this.opts.cellHeightThrottle?(this._cellHeightThrottle||(this._cellHeightThrottle=n.Utils.throttle((()=>this.cellHeight()),this.opts.cellHeightThrottle)),this._cellHeightThrottle()):this.cellHeight()),this.engine.nodes.forEach((t=>{t.subGrid&&t.subGrid.onParentResize()})),this}_updateWindowResizeEvent(t=!1){const e=(this._isAutoCellHeight||!this.opts.disableOneColumnMode)&&!this.opts._isNested;return t||!e||this._windowResizeBind?!t&&e||!this._windowResizeBind||(window.removeEventListener("resize",this._windowResizeBind),delete this._windowResizeBind):(this._windowResizeBind=this.onParentResize.bind(this),window.addEventListener("resize",this._windowResizeBind)),this}static getElement(t=".grid-stack-item"){return n.Utils.getElement(t)}static getElements(t=".grid-stack-item"){return n.Utils.getElements(t)}static getGridElement(t){return h.getElement(t)}static getGridElements(t){return n.Utils.getElements(t)}initMargin(){let t,e=0,i=[];return"string"==typeof this.opts.margin&&(i=this.opts.margin.split(" ")),2===i.length?(this.opts.marginTop=this.opts.marginBottom=i[0],this.opts.marginLeft=this.opts.marginRight=i[1]):4===i.length?(this.opts.marginTop=i[0],this.opts.marginRight=i[1],this.opts.marginBottom=i[2],this.opts.marginLeft=i[3]):(t=n.Utils.parseHeight(this.opts.margin),this.opts.marginUnit=t.unit,e=this.opts.margin=t.h),void 0===this.opts.marginTop?this.opts.marginTop=e:(t=n.Utils.parseHeight(this.opts.marginTop),this.opts.marginTop=t.h,delete this.opts.margin),void 0===this.opts.marginBottom?this.opts.marginBottom=e:(t=n.Utils.parseHeight(this.opts.marginBottom),this.opts.marginBottom=t.h,delete this.opts.margin),void 0===this.opts.marginRight?this.opts.marginRight=e:(t=n.Utils.parseHeight(this.opts.marginRight),this.opts.marginRight=t.h,delete this.opts.margin),void 0===this.opts.marginLeft?this.opts.marginLeft=e:(t=n.Utils.parseHeight(this.opts.marginLeft),this.opts.marginLeft=t.h,delete this.opts.margin),this.opts.marginUnit=t.unit,this.opts.marginTop===this.opts.marginBottom&&this.opts.marginLeft===this.opts.marginRight&&this.opts.marginTop===this.opts.marginRight&&(this.opts.margin=this.opts.marginTop),this}static setupDragIn(t,e){}movable(t,e){return this}resizable(t,e){return this}disable(){return this}enable(){return this}enableMove(t){return this}enableResize(t){return this}_setupAcceptWidget(){return this}_setupRemoveDrop(){return this}_prepareDragDropByNode(t){return this}_onStartMoving(t,e,i,s,o,r){}_dragOrResize(t,e,i,s,o,r){}_leave(t,e){}}e.GridStack=h,h.Utils=n.Utils,h.Engine=r.GridStackEngine},861:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DDBaseImplement=void 0,e.DDBaseImplement=class{constructor(){this._disabled=!1,this._eventRegister={}}get disabled(){return this._disabled}on(t,e){this._eventRegister[t]=e}off(t){delete this._eventRegister[t]}enable(){this._disabled=!1}disable(){this._disabled=!0}destroy(){delete this._eventRegister}triggerEvent(t,e){if(!this.disabled&&this._eventRegister&&this._eventRegister[t])return this._eventRegister[t](e)}}},311:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DDDraggable=void 0;const s=i(849),o=i(943),r=i(861);class n extends r.DDBaseImplement{constructor(t,e={}){super(),this.dragging=!1,this.ui=()=>{const t=this.el.parentElement.getBoundingClientRect(),e=this.helper.getBoundingClientRect();return{position:{top:e.top-t.top,left:e.left-t.left}}},this.el=t,this.option=e;let i=e.handle.substring(1);this.dragEl=t.classList.contains(i)?t:t.querySelector(e.handle)||t,this._dragStart=this._dragStart.bind(this),this._drag=this._drag.bind(this),this._dragEnd=this._dragEnd.bind(this),this.enable()}on(t,e){super.on(t,e)}off(t){super.off(t)}enable(){super.enable(),this.dragEl.draggable=!0,this.dragEl.addEventListener("dragstart",this._dragStart),this.el.classList.remove("ui-draggable-disabled"),this.el.classList.add("ui-draggable")}disable(t=!1){super.disable(),this.dragEl.removeAttribute("draggable"),this.dragEl.removeEventListener("dragstart",this._dragStart),this.el.classList.remove("ui-draggable"),t||this.el.classList.add("ui-draggable-disabled")}destroy(){this.dragging&&this._dragEnd({}),this.disable(!0),delete this.el,delete this.helper,delete this.option,super.destroy()}updateOption(t){return Object.keys(t).forEach((e=>this.option[e]=t[e])),this}_dragStart(t){s.DDManager.dragElement=this,this.helper=this._createHelper(t),this._setupHelperContainmentStyle(),this.dragOffset=this._getDragOffset(t,this.el,this.helperContainment);const e=o.DDUtils.initEvent(t,{target:this.el,type:"dragstart"});this.helper!==this.el?(this._setupDragFollowNodeNotifyStart(e),this._dragFollow(t)):this.dragFollowTimer=window.setTimeout((()=>{delete this.dragFollowTimer,this._setupDragFollowNodeNotifyStart(e)}),0),this._cancelDragGhost(t)}_setupDragFollowNodeNotifyStart(t){return this._setupHelperStyle(),document.addEventListener("dragover",this._drag,n.dragEventListenerOption),this.dragEl.addEventListener("dragend",this._dragEnd),this.option.start&&this.option.start(t,this.ui()),this.dragging=!0,this.helper.classList.add("ui-draggable-dragging"),this.triggerEvent("dragstart",t),this}_drag(t){t.preventDefault(),this._dragFollow(t);const e=o.DDUtils.initEvent(t,{target:this.el,type:"drag"});this.option.drag&&this.option.drag(e,this.ui()),this.triggerEvent("drag",e)}_dragEnd(t){if(this.dragFollowTimer)return clearTimeout(this.dragFollowTimer),void delete this.dragFollowTimer;this.paintTimer&&cancelAnimationFrame(this.paintTimer),document.removeEventListener("dragover",this._drag,n.dragEventListenerOption),this.dragEl.removeEventListener("dragend",this._dragEnd),this.dragging=!1,this.helper.classList.remove("ui-draggable-dragging"),this.helperContainment.style.position=this.parentOriginStylePosition||null,this.helper===this.el?this._removeHelperStyle():this.helper.remove();const e=o.DDUtils.initEvent(t,{target:this.el,type:"dragstop"});this.option.stop&&this.option.stop(e),this.triggerEvent("dragstop",e),delete s.DDManager.dragElement,delete this.helper}_createHelper(t){let e=this.el;return"function"==typeof this.option.helper?e=this.option.helper(t):"clone"===this.option.helper&&(e=o.DDUtils.clone(this.el)),document.body.contains(e)||o.DDUtils.appendTo(e,"parent"===this.option.appendTo?this.el.parentNode:this.option.appendTo),e===this.el&&(this.dragElementOriginStyle=n.originStyleProp.map((t=>this.el.style[t]))),e}_setupHelperStyle(){return this.helper.style.pointerEvents="none",this.helper.style.width=this.dragOffset.width+"px",this.helper.style.height=this.dragOffset.height+"px",this.helper.style.willChange="left, top",this.helper.style.transition="none",this.helper.style.position=this.option.basePosition||n.basePosition,this.helper.style.zIndex="1000",setTimeout((()=>{this.helper&&(this.helper.style.transition=null)}),0),this}_removeHelperStyle(){let t=this.helper?this.helper.gridstackNode:void 0;return t&&t._isAboutToRemove||n.originStyleProp.forEach((t=>{this.helper.style[t]=this.dragElementOriginStyle[t]||null})),delete this.dragElementOriginStyle,this}_dragFollow(t){this.paintTimer&&cancelAnimationFrame(this.paintTimer),this.paintTimer=requestAnimationFrame((()=>{delete this.paintTimer;const e=this.dragOffset;let i={left:0,top:0};if("absolute"===this.helper.style.position){const{left:t,top:e}=this.helperContainment.getBoundingClientRect();i={left:t,top:e}}this.helper.style.left=t.clientX+e.offsetLeft-i.left+"px",this.helper.style.top=t.clientY+e.offsetTop-i.top+"px"}))}_setupHelperContainmentStyle(){return this.helperContainment=this.helper.parentElement,"fixed"!==this.option.basePosition&&(this.parentOriginStylePosition=this.helperContainment.style.position,window.getComputedStyle(this.helperContainment).position.match(/static/)&&(this.helperContainment.style.position="relative")),this}_cancelDragGhost(t){let e=document.createElement("div");return e.style.width="1px",e.style.height="1px",e.style.position="fixed",document.body.appendChild(e),t.dataTransfer.setDragImage(e,0,0),setTimeout((()=>document.body.removeChild(e))),t.stopPropagation(),this}_getDragOffset(t,e,i){let s=0,r=0;if(i){const t=document.createElement("div");o.DDUtils.addElStyles(t,{opacity:"0",position:"fixed",top:"0px",left:"0px",width:"1px",height:"1px",zIndex:"-999999"}),i.appendChild(t);const e=t.getBoundingClientRect();i.removeChild(t),s=e.left,r=e.top}const n=e.getBoundingClientRect();return{left:n.left,top:n.top,offsetLeft:-t.clientX+n.left-s,offsetTop:-t.clientY+n.top-r,width:n.width,height:n.height}}}e.DDDraggable=n,n.basePosition="absolute",n.dragEventListenerOption=!0,n.originStyleProp=["transition","pointerEvents","position","left","top","opacity","zIndex","width","height","willChange"]},54:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DDDroppable=void 0;const s=i(849),o=i(861),r=i(943);class n extends o.DDBaseImplement{constructor(t,e={}){super(),this.el=t,this.option=e,this._dragEnter=this._dragEnter.bind(this),this._dragOver=this._dragOver.bind(this),this._dragLeave=this._dragLeave.bind(this),this._drop=this._drop.bind(this),this.el.classList.add("ui-droppable"),this.el.addEventListener("dragenter",this._dragEnter),this._setupAccept()}on(t,e){super.on(t,e)}off(t){super.off(t)}enable(){this.disabled&&(super.enable(),this.el.classList.remove("ui-droppable-disabled"),this.el.addEventListener("dragenter",this._dragEnter))}disable(t=!1){this.disabled||(super.disable(),t||this.el.classList.add("ui-droppable-disabled"),this.el.removeEventListener("dragenter",this._dragEnter))}destroy(){this.moving&&this._removeLeaveCallbacks(),this.disable(!0),this.el.classList.remove("ui-droppable"),this.el.classList.remove("ui-droppable-disabled"),delete this.moving,super.destroy()}updateOption(t){return Object.keys(t).forEach((e=>this.option[e]=t[e])),this._setupAccept(),this}_dragEnter(t){if(!this._canDrop())return;if(t.preventDefault(),this.moving)return;this.moving=!0;const e=r.DDUtils.initEvent(t,{target:this.el,type:"dropover"});this.option.over&&this.option.over(e,this._ui(s.DDManager.dragElement)),this.triggerEvent("dropover",e),this.el.addEventListener("dragover",this._dragOver),this.el.addEventListener("drop",this._drop),this.el.addEventListener("dragleave",this._dragLeave),this.el.classList.add("ui-droppable-over")}_dragOver(t){t.preventDefault(),t.stopPropagation()}_dragLeave(t){if(t.relatedTarget){if(this.el.contains(t.relatedTarget))return}else{const{bottom:e,left:i,right:s,top:o}=this.el.getBoundingClientRect();if(t.x<s&&t.x>i&&t.y<e&&t.y>o)return}if(this._removeLeaveCallbacks(),this.moving){t.preventDefault();const e=r.DDUtils.initEvent(t,{target:this.el,type:"dropout"});this.option.out&&this.option.out(e,this._ui(s.DDManager.dragElement)),this.triggerEvent("dropout",e)}delete this.moving}_drop(t){if(!this.moving)return;t.preventDefault();const e=r.DDUtils.initEvent(t,{target:this.el,type:"drop"});this.option.drop&&this.option.drop(e,this._ui(s.DDManager.dragElement)),this.triggerEvent("drop",e),this._removeLeaveCallbacks(),delete this.moving}_removeLeaveCallbacks(){this.el.removeEventListener("dragleave",this._dragLeave),this.el.classList.remove("ui-droppable-over"),this.moving&&(this.el.removeEventListener("dragover",this._dragOver),this.el.removeEventListener("drop",this._drop))}_canDrop(){return s.DDManager.dragElement&&(!this.accept||this.accept(s.DDManager.dragElement.el))}_setupAccept(){return this.option.accept&&"string"==typeof this.option.accept?this.accept=t=>t.matches(this.option.accept):this.accept=this.option.accept,this}_ui(t){return Object.assign({draggable:t.el},t.ui())}}e.DDDroppable=n},485:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DDElement=void 0;const s=i(97),o=i(311),r=i(54);class n{constructor(t){this.el=t}static init(t){return t.ddElement||(t.ddElement=new n(t)),t.ddElement}on(t,e){return this.ddDraggable&&["drag","dragstart","dragstop"].indexOf(t)>-1?this.ddDraggable.on(t,e):this.ddDroppable&&["drop","dropover","dropout"].indexOf(t)>-1?this.ddDroppable.on(t,e):this.ddResizable&&["resizestart","resize","resizestop"].indexOf(t)>-1&&this.ddResizable.on(t,e),this}off(t){return this.ddDraggable&&["drag","dragstart","dragstop"].indexOf(t)>-1?this.ddDraggable.off(t):this.ddDroppable&&["drop","dropover","dropout"].indexOf(t)>-1?this.ddDroppable.off(t):this.ddResizable&&["resizestart","resize","resizestop"].indexOf(t)>-1&&this.ddResizable.off(t),this}setupDraggable(t){return this.ddDraggable?this.ddDraggable.updateOption(t):this.ddDraggable=new o.DDDraggable(this.el,t),this}cleanDraggable(){return this.ddDraggable&&(this.ddDraggable.destroy(),delete this.ddDraggable),this}setupResizable(t){return this.ddResizable?this.ddResizable.updateOption(t):this.ddResizable=new s.DDResizable(this.el,t),this}cleanResizable(){return this.ddResizable&&(this.ddResizable.destroy(),delete this.ddResizable),this}setupDroppable(t){return this.ddDroppable?this.ddDroppable.updateOption(t):this.ddDroppable=new r.DDDroppable(this.el,t),this}cleanDroppable(){return this.ddDroppable&&(this.ddDroppable.destroy(),delete this.ddDroppable),this}}e.DDElement=n},849:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DDManager=void 0,e.DDManager=class{}},680:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DDResizableHandle=void 0;class i{constructor(t,e,i){this.moving=!1,this.host=t,this.dir=e,this.option=i,this._mouseDown=this._mouseDown.bind(this),this._mouseMove=this._mouseMove.bind(this),this._mouseUp=this._mouseUp.bind(this),this._init()}_init(){const t=document.createElement("div");return t.classList.add("ui-resizable-handle"),t.classList.add(`${i.prefix}${this.dir}`),t.style.zIndex="100",t.style.userSelect="none",this.el=t,this.host.appendChild(this.el),this.el.addEventListener("mousedown",this._mouseDown),this}destroy(){return this.moving&&this._mouseUp(this.mouseDownEvent),this.el.removeEventListener("mousedown",this._mouseDown),this.host.removeChild(this.el),delete this.el,delete this.host,this}_mouseDown(t){t.preventDefault(),this.mouseDownEvent=t,document.addEventListener("mousemove",this._mouseMove,!0),document.addEventListener("mouseup",this._mouseUp)}_mouseMove(t){let e=this.mouseDownEvent;!this.moving&&Math.abs(t.x-e.x)+Math.abs(t.y-e.y)>2?(this.moving=!0,this._triggerEvent("start",this.mouseDownEvent)):this.moving&&this._triggerEvent("move",t)}_mouseUp(t){this.moving&&this._triggerEvent("stop",t),document.removeEventListener("mousemove",this._mouseMove,!0),document.removeEventListener("mouseup",this._mouseUp),delete this.moving,delete this.mouseDownEvent}_triggerEvent(t,e){return this.option[t]&&this.option[t](e),this}}e.DDResizableHandle=i,i.prefix="ui-resizable-"},97:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DDResizable=void 0;const s=i(680),o=i(861),r=i(943),n=i(593);class l extends o.DDBaseImplement{constructor(t,e={}){super(),this._showHandlers=()=>{this.el.classList.remove("ui-resizable-autohide")},this._hideHandlers=()=>{this.el.classList.add("ui-resizable-autohide")},this._ui=()=>{const t=this.el.parentElement.getBoundingClientRect(),e={width:this.originalRect.width,height:this.originalRect.height+this.scrolled,left:this.originalRect.left,top:this.originalRect.top-this.scrolled},i=this.temporalRect||e;return{position:{left:i.left-t.left,top:i.top-t.top},size:{width:i.width,height:i.height}}},this.el=t,this.option=e,this.enable(),this._setupAutoHide(),this._setupHandlers()}on(t,e){super.on(t,e)}off(t){super.off(t)}enable(){super.enable(),this.el.classList.add("ui-resizable"),this.el.classList.remove("ui-resizable-disabled")}disable(){super.disable(),this.el.classList.add("ui-resizable-disabled"),this.el.classList.remove("ui-resizable")}destroy(){this._removeHandlers(),this.option.autoHide&&(this.el.removeEventListener("mouseover",this._showHandlers),this.el.removeEventListener("mouseout",this._hideHandlers)),this.el.classList.remove("ui-resizable"),delete this.el,super.destroy()}updateOption(t){let e=t.handles&&t.handles!==this.option.handles,i=t.autoHide&&t.autoHide!==this.option.autoHide;return Object.keys(t).forEach((e=>this.option[e]=t[e])),e&&(this._removeHandlers(),this._setupHandlers()),i&&this._setupAutoHide(),this}_setupAutoHide(){return this.option.autoHide?(this.el.classList.add("ui-resizable-autohide"),this.el.addEventListener("mouseover",this._showHandlers),this.el.addEventListener("mouseout",this._hideHandlers)):(this.el.classList.remove("ui-resizable-autohide"),this.el.removeEventListener("mouseover",this._showHandlers),this.el.removeEventListener("mouseout",this._hideHandlers)),this}_setupHandlers(){let t=this.option.handles||"e,s,se";return"all"===t&&(t="n,e,s,w,se,sw,ne,nw"),this.handlers=t.split(",").map((t=>t.trim())).map((t=>new s.DDResizableHandle(this.el,t,{start:t=>{this._resizeStart(t)},stop:t=>{this._resizeStop(t)},move:e=>{this._resizing(e,t)}}))),this}_resizeStart(t){this.originalRect=this.el.getBoundingClientRect(),this.scrollEl=n.Utils.getScrollElement(this.el),this.scrollY=this.scrollEl.scrollTop,this.scrolled=0,this.startEvent=t,this._setupHelper(),this._applyChange();const e=r.DDUtils.initEvent(t,{type:"resizestart",target:this.el});return this.option.start&&this.option.start(e,this._ui()),this.el.classList.add("ui-resizable-resizing"),this.triggerEvent("resizestart",e),this}_resizing(t,e){this.scrolled=this.scrollEl.scrollTop-this.scrollY,this.temporalRect=this._getChange(t,e),this._applyChange();const i=r.DDUtils.initEvent(t,{type:"resize",target:this.el});return this.option.resize&&this.option.resize(i,this._ui()),this.triggerEvent("resize",i),this}_resizeStop(t){const e=r.DDUtils.initEvent(t,{type:"resizestop",target:this.el});return this.option.stop&&this.option.stop(e),this.el.classList.remove("ui-resizable-resizing"),this.triggerEvent("resizestop",e),this._cleanHelper(),delete this.startEvent,delete this.originalRect,delete this.temporalRect,delete this.scrollY,delete this.scrolled,this}_setupHelper(){return this.elOriginStyleVal=l._originStyleProp.map((t=>this.el.style[t])),this.parentOriginStylePosition=this.el.parentElement.style.position,window.getComputedStyle(this.el.parentElement).position.match(/static/)&&(this.el.parentElement.style.position="relative"),this.el.style.position=this.option.basePosition||"absolute",this.el.style.opacity="0.8",this.el.style.zIndex="1000",this}_cleanHelper(){return l._originStyleProp.forEach(((t,e)=>{this.el.style[t]=this.elOriginStyleVal[e]||null})),this.el.parentElement.style.position=this.parentOriginStylePosition||null,this}_getChange(t,e){const i=this.startEvent,s={width:this.originalRect.width,height:this.originalRect.height+this.scrolled,left:this.originalRect.left,top:this.originalRect.top-this.scrolled},o=t.clientX-i.clientX,r=t.clientY-i.clientY;e.indexOf("e")>-1?s.width+=o:e.indexOf("w")>-1&&(s.width-=o,s.left+=o),e.indexOf("s")>-1?s.height+=r:e.indexOf("n")>-1&&(s.height-=r,s.top+=r);const n=this._constrainSize(s.width,s.height);return Math.round(s.width)!==Math.round(n.width)&&(e.indexOf("w")>-1&&(s.left+=s.width-n.width),s.width=n.width),Math.round(s.height)!==Math.round(n.height)&&(e.indexOf("n")>-1&&(s.top+=s.height-n.height),s.height=n.height),s}_constrainSize(t,e){const i=this.option.maxWidth||Number.MAX_SAFE_INTEGER,s=this.option.minWidth||t,o=this.option.maxHeight||Number.MAX_SAFE_INTEGER,r=this.option.minHeight||e;return{width:Math.min(i,Math.max(s,t)),height:Math.min(o,Math.max(r,e))}}_applyChange(){let t={left:0,top:0,width:0,height:0};if("absolute"===this.el.style.position){const e=this.el.parentElement,{left:i,top:s}=e.getBoundingClientRect();t={left:i,top:s,width:0,height:0}}return this.temporalRect?(Object.keys(this.temporalRect).forEach((e=>{const i=this.temporalRect[e];this.el.style[e]=i-t[e]+"px"})),this):this}_removeHandlers(){return this.handlers.forEach((t=>t.destroy())),delete this.handlers,this}}e.DDResizable=l,l._originStyleProp=["width","height","position","left","top","opacity","zIndex"]},943:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DDUtils=void 0;class i{static clone(t){const e=t.cloneNode(!0);return e.removeAttribute("id"),e}static appendTo(t,e){let i;i="string"==typeof e?document.querySelector(e):e,i&&i.appendChild(t)}static setPositionRelative(t){/^(?:r|a|f)/.test(window.getComputedStyle(t).position)||(t.style.position="relative")}static addElStyles(t,e){if(e instanceof Object)for(const i in e)e.hasOwnProperty(i)&&(Array.isArray(e[i])?e[i].forEach((e=>{t.style[i]=e})):t.style[i]=e[i])}static initEvent(t,e){const i={type:e.type},s={button:0,which:0,buttons:1,bubbles:!0,cancelable:!0,target:e.target?e.target:t.target};return t.dataTransfer&&(i.dataTransfer=t.dataTransfer),["altKey","ctrlKey","metaKey","shiftKey"].forEach((e=>i[e]=t[e])),["pageX","pageY","clientX","clientY","screenX","screenY"].forEach((e=>i[e]=t[e])),Object.assign(Object.assign({},i),s)}}e.DDUtils=i,i.isEventSupportPassiveOption=(()=>{let t=!1,e=()=>{};return document.addEventListener("test",e,{get passive(){return t=!0,!0}}),document.removeEventListener("test",e),t})()},761:function(t,e,i){var s=this&&this.__createBinding||(Object.create?function(t,e,i,s){void 0===s&&(s=i),Object.defineProperty(t,s,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,s){void 0===s&&(s=i),t[s]=e[i]}),o=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||e.hasOwnProperty(i)||s(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),e.GridStackDDNative=void 0;const r=i(849),n=i(485),l=i(21),a=i(593);o(i(21),e);class h extends l.GridStackDD{resizable(t,e,i,s){return this._getDDElements(t).forEach((t=>{if("disable"===e||"enable"===e)t.ddResizable&&t.ddResizable[e]();else if("destroy"===e)t.ddResizable&&t.cleanResizable();else if("option"===e)t.setupResizable({[i]:s});else{const i=t.el.gridstackNode.grid;let s=t.el.getAttribute("gs-resize-handles")?t.el.getAttribute("gs-resize-handles"):i.opts.resizable.handles;t.setupResizable(Object.assign(Object.assign(Object.assign({},i.opts.resizable),{handles:s}),{start:e.start,stop:e.stop,resize:e.resize}))}})),this}draggable(t,e,i,s){return this._getDDElements(t).forEach((t=>{if("disable"===e||"enable"===e)t.ddDraggable&&t.ddDraggable[e]();else if("destroy"===e)t.ddDraggable&&t.cleanDraggable();else if("option"===e)t.setupDraggable({[i]:s});else{const i=t.el.gridstackNode.grid;t.setupDraggable(Object.assign(Object.assign({},i.opts.draggable),{containment:i.opts._isNested&&!i.opts.dragOut?i.el.parentElement:i.opts.draggable.containment||null,start:e.start,stop:e.stop,drag:e.drag}))}})),this}dragIn(t,e){return this._getDDElements(t).forEach((t=>t.setupDraggable(e))),this}droppable(t,e,i,s){return"function"!=typeof e.accept||e._accept||(e._accept=e.accept,e.accept=t=>e._accept(t)),this._getDDElements(t).forEach((t=>{"disable"===e||"enable"===e?t.ddDroppable&&t.ddDroppable[e]():"destroy"===e?t.ddDroppable&&t.cleanDroppable():"option"===e?t.setupDroppable({[i]:s}):t.setupDroppable(e)})),this}isDroppable(t){return!(!(t&&t.ddElement&&t.ddElement.ddDroppable)||t.ddElement.ddDroppable.disabled)}isDraggable(t){return!(!(t&&t.ddElement&&t.ddElement.ddDraggable)||t.ddElement.ddDraggable.disabled)}isResizable(t){return!(!(t&&t.ddElement&&t.ddElement.ddResizable)||t.ddElement.ddResizable.disabled)}on(t,e,i){return this._getDDElements(t).forEach((t=>t.on(e,(t=>{i(t,r.DDManager.dragElement?r.DDManager.dragElement.el:t.target,r.DDManager.dragElement?r.DDManager.dragElement.helper:null)})))),this}off(t,e){return this._getDDElements(t).forEach((t=>t.off(e))),this}_getDDElements(t,e=!0){let i=a.Utils.getElements(t);if(!i.length)return[];let s=i.map((t=>t.ddElement||(e?n.DDElement.init(t):null)));return e||s.filter((t=>t)),s}}e.GridStackDDNative=h,l.GridStackDD.registerPlugin(h)},699:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0})},593:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Utils=e.obsoleteAttr=e.obsoleteOptsDel=e.obsoleteOpts=e.obsolete=void 0,e.obsolete=function(t,e,i,s,o){let r=(...r)=>(console.warn("gridstack.js: Function `"+i+"` is deprecated in "+o+" and has been replaced with `"+s+"`. It will be **completely** removed in v1.0"),e.apply(t,r));return r.prototype=e.prototype,r},e.obsoleteOpts=function(t,e,i,s){void 0!==t[e]&&(t[i]=t[e],console.warn("gridstack.js: Option `"+e+"` is deprecated in "+s+" and has been replaced with `"+i+"`. It will be **completely** removed in v1.0"))},e.obsoleteOptsDel=function(t,e,i,s){void 0!==t[e]&&console.warn("gridstack.js: Option `"+e+"` is deprecated in "+i+s)},e.obsoleteAttr=function(t,e,i,s){let o=t.getAttribute(e);null!==o&&(t.setAttribute(i,o),console.warn("gridstack.js: attribute `"+e+"`="+o+" is deprecated on this object in "+s+" and has been replaced with `"+i+"`. It will be **completely** removed in v1.0"))};class i{static getElements(t){if("string"==typeof t){let e=document.querySelectorAll(t);return e.length||"."===t[0]||"#"===t[0]||(e=document.querySelectorAll("."+t),e.length||(e=document.querySelectorAll("#"+t))),Array.from(e)}return[t]}static getElement(t){if("string"==typeof t){if(!t.length)return null;if("#"===t[0])return document.getElementById(t.substring(1));if("."===t[0]||"["===t[0])return document.querySelector(t);if(!isNaN(+t[0]))return document.getElementById(t);let e=document.querySelector(t);return e||(e=document.getElementById(t)),e||(e=document.querySelector("."+t)),e}return t}static isIntercepted(t,e){return!(t.y>=e.y+e.h||t.y+t.h<=e.y||t.x+t.w<=e.x||t.x>=e.x+e.w)}static isTouching(t,e){return i.isIntercepted(t,{x:e.x-.5,y:e.y-.5,w:e.w+1,h:e.h+1})}static sort(t,e,i){return i=i||t.reduce(((t,e)=>Math.max(e.x+e.w,t)),0)||12,-1===e?t.sort(((t,e)=>e.x+e.y*i-(t.x+t.y*i))):t.sort(((t,e)=>t.x+t.y*i-(e.x+e.y*i)))}static createStylesheet(t,e){let i=document.createElement("style");return i.setAttribute("type","text/css"),i.setAttribute("gs-style-id",t),i.styleSheet?i.styleSheet.cssText="":i.appendChild(document.createTextNode("")),e?e.insertBefore(i,e.firstChild):(e=document.getElementsByTagName("head")[0]).appendChild(i),i.sheet}static removeStylesheet(t){let e=document.querySelector("STYLE[gs-style-id="+t+"]");e&&e.parentNode&&e.remove()}static addCSSRule(t,e,i){"function"==typeof t.addRule?t.addRule(e,i):"function"==typeof t.insertRule&&t.insertRule(`${e}{${i}}`)}static toBool(t){return"boolean"==typeof t?t:"string"==typeof t?!(""===(t=t.toLowerCase())||"no"===t||"false"===t||"0"===t):Boolean(t)}static toNumber(t){return null===t||0===t.length?void 0:Number(t)}static parseHeight(t){let e,i="px";if("string"==typeof t){let s=t.match(/^(-[0-9]+\.[0-9]+|[0-9]*\.[0-9]+|-[0-9]+|[0-9]+)(px|em|rem|vh|vw|%)?$/);if(!s)throw new Error("Invalid height");i=s[2]||"px",e=parseFloat(s[1])}else e=t;return{h:e,unit:i}}static defaults(t,...e){return e.forEach((e=>{for(const i in e){if(!e.hasOwnProperty(i))return;null===t[i]||void 0===t[i]?t[i]=e[i]:"object"==typeof e[i]&&"object"==typeof t[i]&&this.defaults(t[i],e[i])}})),t}static same(t,e){if("object"!=typeof t)return t==e;if(typeof t!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const i in t)if(t[i]!==e[i])return!1;return!0}static copyPos(t,e,i=!1){return t.x=e.x,t.y=e.y,t.w=e.w,t.h=e.h,i?(e.minW&&(t.minW=e.minW),e.minH&&(t.minH=e.minH),e.maxW&&(t.maxW=e.maxW),e.maxH&&(t.maxH=e.maxH),t):t}static samePos(t,e){return t&&e&&t.x===e.x&&t.y===e.y&&t.w===e.w&&t.h===e.h}static removeInternalAndSame(t,e){if("object"==typeof t&&"object"==typeof e)for(let i in t){let s=t[i];if("_"===i[0]||s===e[i])delete t[i];else if(s&&"object"==typeof s&&void 0!==e[i]){for(let t in s)s[t]!==e[i][t]&&"_"!==t[0]||delete s[t];Object.keys(s).length||delete t[i]}}}static closestByClass(t,e){for(;t=t.parentElement;)if(t.classList.contains(e))return t;return null}static throttle(t,e){let i=!1;return(...s)=>{i||(i=!0,setTimeout((()=>{t(...s),i=!1}),e))}}static removePositioningStyles(t){let e=t.style;e.position&&e.removeProperty("position"),e.left&&e.removeProperty("left"),e.top&&e.removeProperty("top"),e.width&&e.removeProperty("width"),e.height&&e.removeProperty("height")}static getScrollElement(t){if(!t)return document.scrollingElement||document.documentElement;const e=getComputedStyle(t);return/(auto|scroll)/.test(e.overflow+e.overflowY)?t:this.getScrollElement(t.parentElement)}static updateScrollPosition(t,e,i){let s=t.getBoundingClientRect(),o=window.innerHeight||document.documentElement.clientHeight;if(s.top<0||s.bottom>o){let r=s.bottom-o,n=s.top,l=this.getScrollElement(t);if(null!==l){let a=l.scrollTop;s.top<0&&i<0?t.offsetHeight>o?l.scrollTop+=i:l.scrollTop+=Math.abs(n)>Math.abs(i)?i:n:i>0&&(t.offsetHeight>o?l.scrollTop+=i:l.scrollTop+=r>i?i:r),e.top+=l.scrollTop-a}}}static updateScrollResize(t,e,i){const s=this.getScrollElement(e),o=s.clientHeight,r=s===this.getScrollElement()?0:s.getBoundingClientRect().top,n=t.clientY-r,l=n>o-i;n<i?s.scrollBy({behavior:"smooth",top:n-i}):l&&s.scrollBy({behavior:"smooth",top:i-(o-n)})}static clone(t){return null==t||"object"!=typeof t?t:t instanceof Array?[...t]:Object.assign({},t)}static cloneDeep(t){const e=i.clone(t);for(const o in e)e.hasOwnProperty(o)&&"object"==typeof e[o]&&"__"!==o.substring(0,2)&&!s.find((t=>t===o))&&(e[o]=i.cloneDeep(t[o]));return e}}e.Utils=i;const s=["_isNested","el","grid","subGrid","engine"]}},e={},i=function i(s){var o=e[s];if(void 0!==o)return o.exports;var r=e[s]={exports:{}};return t[s].call(r.exports,r,r.exports,i),r.exports}(930);return i.GridStack})()}));;

/* /ks_dashboard_ninja/static/src/js/ks_dashboard_ninja_graph_preview.js defined in bundle 'web.assets_backend' */
odoo.define('ks_dashboard_ninja_list.ks_dashboard_graph_preview',function(require){"use strict";var registry=require('web.field_registry');var AbstractField=require('web.AbstractField');var core=require('web.core');var rpc=require('web.rpc');var field_utils=require('web.field_utils');var session=require('web.session');var utils=require('web.utils');var config=require('web.config');var field_utils=require('web.field_utils');var KsGlobalFunction=require('ks_dashboard_ninja.KsGlobalFunction');var QWeb=core.qweb;var MAX_LEGEND_LENGTH=25*(Math.max(1,config.device.size_class));var KsGraphPreview=AbstractField.extend({supportedFieldTypes:['char'],resetOnAnyFieldChange:true,jsLibs:['/ks_dashboard_ninja/static/lib/js/Chart.bundle.min.js','/ks_dashboard_ninja/static/lib/js/chartjs-plugin-datalabels.js'],cssLibs:['/ks_dashboard_ninja/static/lib/css/Chart.min.css'],init:function(parent,state,params){this._super.apply(this,arguments);},start:function(){var self=this;self.ks_set_default_chart_view();core.bus.on("DOM_updated",this,function(){if(self.shouldRenderChart&&$.find('#ksMyChart').length>0)self.renderChart();});Chart.plugins.unregister(ChartDataLabels);return this._super();},ks_set_default_chart_view:function(){Chart.plugins.register({afterDraw:function(chart){if(chart.data.labels.length===0){var ctx=chart.chart.ctx;var width=chart.chart.width;var height=chart.chart.height
chart.clear();ctx.save();ctx.textAlign='center';ctx.textBaseline='middle';ctx.font="3rem 'Lucida Grande'";ctx.fillText('No data available',width/2,height/2);ctx.restore();}}});Chart.Legend.prototype.afterFit=function(){var chart_type=this.chart.config.type;if(chart_type==="pie"||chart_type==="doughnut"){this.height=this.height;}else{this.height=this.height+20;};}},_render:function(){this.$el.empty()
if(this.recordData.ks_dashboard_item_type!=='ks_tile'&&this.recordData.ks_dashboard_item_type!=='ks_kpi'&&this.recordData.ks_dashboard_item_type!=='ks_list_view'&&this.recordData.ks_dashboard_item_type!=='ks_to_do'){if(this.recordData.ks_model_id){if(this.recordData.ks_chart_groupby_type=='date_type'&&!this.recordData.ks_chart_date_groupby){return this.$el.append($('<div>').text("Select Group by date to create chart based on date groupby"));}else if(this.recordData.ks_chart_data_count_type==="count"&&!this.recordData.ks_chart_relation_groupby){this.$el.append($('<div>').text("Select Group By to create chart view"));}else if(this.recordData.ks_chart_data_count_type!=="count"&&(this.recordData.ks_chart_measure_field.count===0||!this.recordData.ks_chart_relation_groupby)){this.$el.append($('<div>').text("Select Measure and Group By to create chart view"));}else if(!this.recordData.ks_chart_data_count_type){this.$el.append($('<div>').text("Select Chart Data Count Type"));}else{this._getChartData();}}else{this.$el.append($('<div>').text("Select a Model first."));}}},_getChartData:function(){var self=this;self.shouldRenderChart=true;var field=this.recordData;var ks_chart_name;if(field.name)ks_chart_name=field.name;else if(field.ks_model_name)ks_chart_name=field.ks_model_id.data.display_name;else ks_chart_name="Name";this.chart_type=this.recordData.ks_dashboard_item_type.split('_')[1];this.chart_data=JSON.parse(this.recordData.ks_chart_data);if(field.ks_chart_cumulative_field){for(var i=0;i<this.chart_data.datasets.length;i++){var ks_temp_com=0
var datasets={}
var data=[]
if(this.chart_data.datasets[i].ks_chart_cumulative_field){for(var j=0;j<this.chart_data.datasets[i].data.length;j++)
{ks_temp_com=ks_temp_com+this.chart_data.datasets[i].data[j];data.push(ks_temp_com);}
datasets.label='Cumulative'+this.chart_data.datasets[i].label;datasets.data=data;if(field.ks_chart_cumulative){datasets.type='line';}
this.chart_data.datasets.push(datasets);}}}
var $chartContainer=$(QWeb.render('ks_chart_form_view_container',{ks_chart_name:ks_chart_name}));this.$el.append($chartContainer);switch(this.chart_type){case"pie":case"doughnut":case"polarArea":this.chart_family="circle";break;case"bar":case"horizontalBar":case"line":case"area":this.chart_family="square"
break;default:this.chart_family="none";break;}
if(this.chart_family==="circle"){if(this.chart_data&&this.chart_data['labels'].length>30){this.$el.find(".card-body").empty().append($("<div style='font-size:20px;'>Too many records for selected Chart Type. Consider using <strong>Domain</strong> to filter records or <strong>Record Limit</strong> to limit the no of records under <strong>30.</strong>"));return;}}
if($.find('#ksMyChart').length>0){this.renderChart();}},renderChart:function(){var self=this;if(this.recordData.ks_chart_measure_field_2.count&&this.recordData.ks_dashboard_item_type==='ks_bar_chart'){var self=this;var scales={}
scales.yAxes=[{type:"linear",display:true,position:"left",id:"y-axis-0",gridLines:{display:true},labels:{show:true,}},{type:"linear",display:true,position:"right",id:"y-axis-1",labels:{show:true,},ticks:{beginAtZero:true,callback:function(value,index,values){var ks_selection=self.chart_data.ks_selection;if(ks_selection==='monetary'){var ks_currency_id=self.chart_data.ks_currency;var ks_data=KsGlobalFunction._onKsGlobalFormatter(value,self.recordData.ks_data_format,self.recordData.ks_precision_digits);ks_data=KsGlobalFunction.ks_monetary(ks_data,ks_currency_id);return ks_data;}else if(ks_selection==='custom'){var ks_field=self.chart_data.ks_field;return KsGlobalFunction._onKsGlobalFormatter(value,self.recordData.ks_data_format,self.recordData.ks_precision_digits)+' '+ks_field;}else{return KsGlobalFunction._onKsGlobalFormatter(value,self.recordData.ks_data_format,self.recordData.ks_precision_digits);}},}}]}
var chart_plugin=[];if(this.recordData.ks_show_data_value){chart_plugin.push(ChartDataLabels);}
this.ksMyChart=new Chart($.find('#ksMyChart')[0],{type:this.chart_type==="area"?"line":this.chart_type,plugins:chart_plugin,data:{labels:this.chart_data['labels'],datasets:this.chart_data.datasets,},options:{maintainAspectRatio:false,animation:{easing:'easeInQuad',},legend:{display:this.recordData.ks_hide_legend},layout:{padding:{bottom:0,}},scales:scales,plugins:{datalabels:{backgroundColor:function(context){return context.dataset.backgroundColor;},borderRadius:4,color:'white',font:{weight:'bold'},anchor:'center',textAlign:'center',display:'auto',clamp:true,formatter:function(value,ctx){let sum=0;let dataArr=ctx.dataset.data;dataArr.map(data=>{sum+=data;});let percentage=sum===0?0+"%":(value*100/sum).toFixed(2)+"%";return percentage;},},},}});if(this.chart_data&&this.chart_data["datasets"].length>0){self.ksChartColors(this.recordData.ks_chart_item_color,this.ksMyChart,this.chart_type,this.chart_family,this.recordData.ks_show_data_value);}},ksHideFunction:function(options,recordData,ksChartFamily,chartType){return options;},ksChartColors:function(palette,ksMyChart,ksChartType,ksChartFamily,ks_show_data_value){var self=this;var currentPalette="cool";if(!palette)palette=currentPalette;currentPalette=palette;var gradient;switch(palette){case'cool':gradient={0:[255,255,255,1],20:[220,237,200,1],45:[66,179,213,1],65:[26,39,62,1],100:[0,0,0,1]};break;case'warm':gradient={0:[255,255,255,1],20:[254,235,101,1],45:[228,82,27,1],65:[77,52,47,1],100:[0,0,0,1]};break;case'neon':gradient={0:[255,255,255,1],20:[255,236,179,1],45:[232,82,133,1],65:[106,27,154,1],100:[0,0,0,1]};break;case'default':var color_set=['#F04F65','#f69032','#fdc233','#53cfce','#36a2ec','#8a79fd','#b1b5be','#1c425c','#8c2620','#71ecef','#0b4295','#f2e6ce','#1379e7']}
var chartType=ksMyChart.config.type;switch(chartType){case"pie":case"doughnut":case"polarArea":var datasets=ksMyChart.config.data.datasets[0];var setsCount=datasets.data.length;break;case"bar":case"horizontalBar":case"line":var datasets=ksMyChart.config.data.datasets;var setsCount=datasets.length;break;}
var chartColors=[];if(palette!=="default"){var gradientKeys=Object.keys(gradient);gradientKeys.sort(function(a,b){return+a-+b;});for(var i=0;i<setsCount;i++){var gradientIndex=(i+1)*(100/(setsCount+1));for(var j=0;j<gradientKeys.length;j++){var gradientKey=gradientKeys[j];if(gradientIndex===+gradientKey){chartColors[i]='rgba('+gradient[gradientKey].toString()+')';break;}else if(gradientIndex<+gradientKey){var prevKey=gradientKeys[j-1];var gradientPartIndex=(gradientIndex-prevKey)/(gradientKey-prevKey);var color=[];for(var k=0;k<4;k++){color[k]=gradient[prevKey][k]-((gradient[prevKey][k]-gradient[gradientKey][k])*gradientPartIndex);if(k<3)color[k]=Math.round(color[k]);}
chartColors[i]='rgba('+color.toString()+')';break;}}}}else{for(var i=0,counter=0;i<setsCount;i++,counter++){if(counter>=color_set.length)counter=0;chartColors.push(color_set[counter]);}}
var datasets=ksMyChart.config.data.datasets;var options=ksMyChart.config.options;options.legend.labels.usePointStyle=true;if(ksChartFamily=="circle"){if(ks_show_data_value){options.legend.position='top';options.layout.padding.top=10;options.layout.padding.bottom=20;}else{options.legend.position='bottom';}
options=this.ksHideFunction(options,this.recordData,ksChartFamily,chartType);options.plugins.datalabels.align='center';options.plugins.datalabels.anchor='end';options.plugins.datalabels.borderColor='white';options.plugins.datalabels.borderRadius=25;options.plugins.datalabels.borderWidth=2;options.plugins.datalabels.clamp=true;options.plugins.datalabels.clip=false;options.tooltips.callbacks={title:function(tooltipItem,data){var ks_self=self;var k_amount=data.datasets[tooltipItem[0].datasetIndex]['data'][tooltipItem[0].index];var ks_selection=ks_self.chart_data.ks_selection;if(ks_selection==='monetary'){var ks_currency_id=ks_self.chart_data.ks_currency;k_amount=KsGlobalFunction.ks_monetary(k_amount,ks_currency_id);return data.datasets[tooltipItem[0].datasetIndex]['label']+" : "+k_amount}else if(ks_selection==='custom'){var ks_field=ks_self.chart_data.ks_field;k_amount=field_utils.format.float(k_amount,Float64Array,{digits:[0,self.recordData.ks_precision_digits]});return data.datasets[tooltipItem[0].datasetIndex]['label']+" : "+k_amount+" "+ks_field;}else{k_amount=field_utils.format.float(k_amount,Float64Array,{digits:[0,self.recordData.ks_precision_digits]});return data.datasets[tooltipItem[0].datasetIndex]['label']+" : "+k_amount}},label:function(tooltipItem,data){return data.labels[tooltipItem.index];},}
for(var i=0;i<datasets.length;i++){datasets[i].backgroundColor=chartColors;datasets[i].borderColor="rgba(255,255,255,1)";}
if(this.recordData.ks_semi_circle_chart&&(chartType==="pie"||chartType==="doughnut")){options.rotation=1*Math.PI;options.circumference=1*Math.PI;}}else if(ksChartFamily=="square"){options=this.ksHideFunction(options,this.recordData,ksChartFamily,chartType);options.scales.xAxes[0].gridLines.display=false;options.scales.yAxes[0].ticks.beginAtZero=true;options.plugins.datalabels.align='end';options.plugins.datalabels.formatter=function(value,ctx){var ks_self=self;var ks_selection=self.chart_data.ks_selection;if(ks_selection==='monetary'){var ks_currency_id=self.chart_data.ks_currency;var ks_data=KsGlobalFunction._onKsGlobalFormatter(value,self.recordData.ks_data_format,self.recordData.ks_precision_digits);ks_data=KsGlobalFunction.ks_monetary(ks_data,ks_currency_id);return ks_data;}else if(ks_selection==='custom'){var ks_field=self.chart_data.ks_field;return KsGlobalFunction._onKsGlobalFormatter(value,self.recordData.ks_data_format,self.recordData.ks_precision_digits)+' '+ks_field;}else{return KsGlobalFunction._onKsGlobalFormatter(value,self.recordData.ks_data_format,self.recordData.ks_precision_digits);}};if(chartType==="line"){options.plugins.datalabels.backgroundColor=function(context){return context.dataset.borderColor;};}
if(chartType==="horizontalBar"){options.scales.xAxes[0].ticks.callback=function(value,index,values){var ks_self=self;var ks_selection=self.chart_data.ks_selection;if(ks_selection==='monetary'){var ks_currency_id=self.chart_data.ks_currency;var ks_data=KsGlobalFunction._onKsGlobalFormatter(value,self.recordData.ks_data_format,self.recordData.ks_precision_digits);ks_data=KsGlobalFunction.ks_monetary(ks_data,ks_currency_id);return ks_data;}else if(ks_selection==='custom'){var ks_field=self.chart_data.ks_field;return KsGlobalFunction._onKsGlobalFormatter(value,self.recordData.ks_data_format,self.recordData.ks_precision_digits)+' '+ks_field;}else{return KsGlobalFunction._onKsGlobalFormatter(value,self.recordData.ks_data_format,self.recordData.ks_precision_digits);}}
options.scales.xAxes[0].ticks.beginAtZero=true;}else{options.scales.yAxes[0].ticks.callback=function(value,index,values){var ks_self=self;var ks_selection=ks_self.chart_data.ks_selection;var ks_selection=self.chart_data.ks_selection;if(ks_selection==='monetary'){var ks_currency_id=self.chart_data.ks_currency;var ks_data=KsGlobalFunction._onKsGlobalFormatter(value,self.recordData.ks_data_format,self.recordData.ks_precision_digits);ks_data=KsGlobalFunction.ks_monetary(ks_data,ks_currency_id);return ks_data;}else if(ks_selection==='custom'){var ks_field=self.chart_data.ks_field;return KsGlobalFunction._onKsGlobalFormatter(value,self.recordData.ks_data_format,self.recordData.ks_precision_digits)+' '+ks_field;}else{return KsGlobalFunction._onKsGlobalFormatter(value,self.recordData.ks_data_format,self.recordData.ks_precision_digits);}}}
options.tooltips.callbacks={label:function(tooltipItem,data){var ks_self=self;var k_amount=data.datasets[tooltipItem.datasetIndex]['data'][tooltipItem.index];var ks_selection=ks_self.chart_data.ks_selection;if(ks_selection==='monetary'){var ks_currency_id=ks_self.chart_data.ks_currency;k_amount=KsGlobalFunction.ks_monetary(k_amount,ks_currency_id);return data.datasets[tooltipItem.datasetIndex]['label']+" : "+k_amount}else if(ks_selection==='custom'){var ks_field=ks_self.chart_data.ks_field;k_amount=field_utils.format.float(k_amount,Float64Array,{digits:[0,self.recordData.ks_precision_digits]});return data.datasets[tooltipItem.datasetIndex]['label']+" : "+k_amount+" "+ks_field;}else{k_amount=field_utils.format.float(k_amount,Float64Array,{digits:[0,self.recordData.ks_precision_digits]});return data.datasets[tooltipItem.datasetIndex]['label']+" : "+k_amount}}}
for(var i=0;i<datasets.length;i++){switch(ksChartType){case"bar":case"horizontalBar":if(datasets[i].type&&datasets[i].type=="line"){datasets[i].borderColor=chartColors[i];datasets[i].backgroundColor="rgba(255,255,255,0)";datasets[i]['datalabels']={backgroundColor:chartColors[i],}}else{datasets[i].backgroundColor=chartColors[i];datasets[i].borderColor="rgba(255,255,255,0)";options.scales.xAxes[0].stacked=this.recordData.ks_bar_chart_stacked;options.scales.yAxes[0].stacked=this.recordData.ks_bar_chart_stacked;}
break;case"line":datasets[i].borderColor=chartColors[i];datasets[i].backgroundColor="rgba(255,255,255,0)";break;case"area":datasets[i].borderColor=chartColors[i];break;}}}
ksMyChart.update();if(this.$el.find('canvas').height()<250){this.$el.find('canvas').height(250);}},});registry.add('ks_dashboard_graph_preview',KsGraphPreview);return{KsGraphPreview:KsGraphPreview,};});;

/* /ks_dashboard_ninja/static/src/js/ks_dashboard_ninja_list_view_preview.js defined in bundle 'web.assets_backend' */
odoo.define('ks_dashboard_ninja_list.ks_dashboard_ninja_list_view_preview',function(require){"use strict";var registry=require('web.field_registry');var AbstractField=require('web.AbstractField');var core=require('web.core');var QWeb=core.qweb;var field_utils=require('web.field_utils');var KsListViewPreview=AbstractField.extend({supportedFieldTypes:['char'],resetOnAnyFieldChange:true,init:function(parent,state,params){this._super.apply(this,arguments);this.state={};},_render:function(){this.$el.empty()
var rec=this.recordData;if(rec.ks_dashboard_item_type==='ks_list_view'){if(rec.ks_list_view_type=="ungrouped"){if(rec.ks_list_view_fields.count!==0){this.ksRenderListView();}else{this.$el.append($('<div>').text("Select Fields to show in list view."));}}else if(rec.ks_list_view_type=="grouped"){if(rec.ks_list_view_group_fields.count!==0&&rec.ks_chart_relation_groupby){if(rec.ks_chart_groupby_type==='relational_type'||rec.ks_chart_groupby_type==='selection'||rec.ks_chart_groupby_type==='other'||rec.ks_chart_groupby_type==='date_type'&&rec.ks_chart_date_groupby){this.ksRenderListView();}else{this.$el.append($('<div>').text("Select Group by Date to show list data."));}}else{this.$el.append($('<div>').text("Select Fields and Group By to show in list view."));}}}},ksRenderListView:function(){var self=this;var field=this.recordData;var ks_list_view_name;var list_view_data=JSON.parse(field.ks_list_view_data);var count=field.ks_record_count;if(field.name)ks_list_view_name=field.name;else if(field.ks_model_name)ks_list_view_name=field.ks_model_id.data.display_name;else ks_list_view_name="Name";if(field.ks_list_view_type==="ungrouped"&&list_view_data){var index_data=list_view_data.date_index;if(index_data){for(var i=0;i<index_data.length;i++){for(var j=0;j<list_view_data.data_rows.length;j++){var index=index_data[i]
var date=list_view_data.data_rows[j]["data"][index]
if(date){if(list_view_data.fields_type[index]==='date'){list_view_data.data_rows[j]["data"][index]=field_utils.format.date(moment(moment(date).utc(true)._d),{},{timezone:false});}else{list_view_data.data_rows[j]["data"][index]=field_utils.format.datetime(moment(moment(date).utc(true)._d),{},{timezone:false});}}else{list_view_data.data_rows[j]["data"][index]="";}}}}}
if(field.ks_list_view_data){var data_rows=list_view_data.data_rows;if(data_rows){for(var i=0;i<list_view_data.data_rows.length;i++){for(var j=0;j<list_view_data.data_rows[0]["data"].length;j++){if(typeof(list_view_data.data_rows[i].data[j])==="number"||list_view_data.data_rows[i].data[j]){if(typeof(list_view_data.data_rows[i].data[j])==="number"){list_view_data.data_rows[i].data[j]=field_utils.format.float(list_view_data.data_rows[i].data[j],Float64Array)}}else{list_view_data.data_rows[i].data[j]="";}}}}}else list_view_data=false;count=list_view_data&&field.ks_list_view_type==="ungrouped"?count-list_view_data.data_rows.length:false;count=count?count<=0?false:count:false;var $listViewContainer=$(QWeb.render('ks_list_view_container',{ks_list_view_name:ks_list_view_name,list_view_data:list_view_data,count:count,layout:self.recordData.ks_list_view_layout,}));if(!this.recordData.ks_show_records===true){$listViewContainer.find('#ks_item_info').hide();}
this.$el.append($listViewContainer);},});registry.add('ks_dashboard_list_view_preview',KsListViewPreview);return{KsListViewPreview:KsListViewPreview,};});;

/* /ks_dashboard_ninja/static/src/js/ks_to_do_preview.js defined in bundle 'web.assets_backend' */
odoo.define('ks_dashboard_ninja_list.ks_to_do_preview',function(require){"use strict";var registry=require('web.field_registry');var AbstractField=require('web.AbstractField');var core=require('web.core');var QWeb=core.qweb;var field_utils=require('web.field_utils');var KsToDOViewPreview=AbstractField.extend({supportedFieldTypes:['char'],resetOnAnyFieldChange:true,init:function(parent,state,params){this._super.apply(this,arguments);this.state={};},_render:function(){var self=this;this.$el.empty()
var rec=self.recordData;var ks_rgba_font_color;if(rec.ks_dashboard_item_type==='ks_to_do'){self.ksRenderToDoView(rec);}},_ks_get_rgba_format:function(val){var rgba=val.split(',')[0].match(/[A-Za-z0-9]{2}/g);rgba=rgba.map(function(v){return parseInt(v,16)}).join(",");return"rgba("+rgba+","+val.split(',')[1]+")";},ksRenderToDoView:function(rec){var self=this;var ks_header_color=self._ks_get_rgba_format(rec.ks_header_bg_color);var ks_font_color=self._ks_get_rgba_format(rec.ks_font_color);var ks_rgba_button_color=self._ks_get_rgba_format(rec.ks_button_color);var list_to_do_data={}
if(rec.ks_to_do_data){list_to_do_data=JSON.parse(rec.ks_to_do_data)}
var $todoViewContainer=$(QWeb.render('ks_to_do_container',{ks_to_do_view_name:rec.name?rec.name:'Name',to_do_view_data:list_to_do_data,}));$todoViewContainer.find('.ks_card_header').addClass('ks_bg_to_color').css({"background-color":ks_header_color});$todoViewContainer.find('.ks_card_header').addClass('ks_bg_to_color').css({"color":ks_font_color+' !important'});$todoViewContainer.find('.ks_li_tab').addClass('ks_bg_to_color').css({"color":ks_font_color+' !important'});$todoViewContainer.find('.ks_chart_heading').addClass('ks_bg_to_color').css({"color":ks_font_color+' !important'});this.$el.append($todoViewContainer);},});registry.add('ks_dashboard_to_do_preview',KsToDOViewPreview);return{KsToDOViewPreview:KsToDOViewPreview,};});;

/* /rp_hide_edit_btn_v13/static/src/js/hide_edit_btn.js defined in bundle 'web.assets_backend' */
odoo.define('rp_hide_edit_btn_v13.hide_edit_btn',function(require){"use strict";var FormController=require('web.FormController');var core=require('web.core');var _t=core._t;FormController.include({_updateButtons:function(){var self=this;this._super.apply(this,arguments);if(this.$buttons&&this.mode==='readonly'){var attrs=this.renderer.arch.attrs;var action_edit=['edit','create'];_.each(action_edit,function(action){var expr=attrs['rp_'+action];var res=expr?self._evalExpression(expr):self.activeActions[action];self.$buttons.find('.o_form_button_'+action).toggleClass('o_hidden',!res);});}},_evalExpression:function(expr){var tokens=py.tokenize(expr);var tree=py.parse(tokens);var evalcontext=this.renderer.state.evalContext
var expr_eval=py.evaluate(tree,evalcontext);return py.PY_isTrue(expr_eval);}});});;

/* /authorized_ledger_account/static/src/js/account_report_js.js defined in bundle 'web.assets_backend' */
odoo.define('authorized_ledger_account.account_report_js',function(require){'use strict';var core=require('web.core');var AccountReport=require('account_reports.account_report');var session=require('web.session')
var QWeb=core.qweb;var _t=core._t;var accountReportExtended=AccountReport.include({render_searchview_buttons:function(){var parent=this.$searchview_buttons;self=this;this.$searchview_buttons.find('.selectalljournals').click(function(event){parent.find('.js_account_report_choice_filter').each(function(){var option_value=$(this).data('filter');var option_id=$(this).data('id');_.filter(self.report_options[option_value],function(el){el.selected=true;return el;});});self.reload();});this.$searchview_buttons.find('.deselectalljournals').click(function(event){parent.find('.js_account_report_choice_filter').each(function(){var option_value=$(this).data('filter');var option_id=$(this).data('id');_.filter(self.report_options[option_value],function(el){el.selected=false;return el;});});self.reload();});this._super.apply(this,arguments);},});core.action_registry.add('account_report_js',accountReportExtended);return accountReportExtended;});;

/* /ocn_client/static/src/js/mobile_device_register.js defined in bundle 'web.assets_backend' */
odoo.define('mail_push.fcm',function(require){"use strict";var mobile=require('web_mobile.rpc');var ajax=require('web.ajax');if(mobile.methods.getFCMKey){var sessionInfo=odoo.session_info;var registerDevice=function(fcm_project_id){mobile.methods.getFCMKey({project_id:fcm_project_id,inbox_action:sessionInfo.inbox_action,}).then(function(response){if(response.success){ajax.rpc('/web/dataset/call_kw/res.config.settings/register_device',{model:'res.config.settings',method:'register_device',args:[response.data.subscription_id,response.data.device_name],kwargs:{},}).then(function(ocn_token){if(mobile.methods.setOCNToken){mobile.methods.setOCNToken({ocn_token:ocn_token});}});}});};if(sessionInfo.fcm_project_id){registerDevice(sessionInfo.fcm_project_id);}else{ajax.rpc('/web/dataset/call_kw/res.config.settings/get_fcm_project_id',{model:'res.config.settings',method:'get_fcm_project_id',args:[],kwargs:{},}).then(function(response){if(response){registerDevice(response);}});}}
if(mobile.methods.hashChange){var currentHash;$(window).bind('hashchange',function(event){var hash=event.getState();if(!_.isEqual(currentHash,hash)){mobile.methods.hashChange(hash);}
currentHash=hash;});}});;

/* /az_profit_loss_report_filters/static/src/js/account_reports.js defined in bundle 'web.assets_backend' */
odoo.define('az_divisions_reports.account_report',function(require){'use strict';var core=require('web.core');var AccountReport=require('account_reports.account_report');var RelationalFields=require('web.relational_fields');var StandaloneFieldManagerMixin=require('web.StandaloneFieldManagerMixin');var _t=core._t;var Widget=require('web.Widget');var QWeb=core.qweb;var M2MFilters=Widget.extend(StandaloneFieldManagerMixin,{init:function(parent,fields){this._super.apply(this,arguments);StandaloneFieldManagerMixin.init.call(this);this.fields=fields;this.widgets={};},willStart:function(){var self=this;var defs=[this._super.apply(this,arguments)];_.each(this.fields,function(field,fieldName){defs.push(self._makeM2MWidget(field,fieldName));});return Promise.all(defs);},start:function(){var self=this;var $content=$(QWeb.render("m2mWidgetTable",{fields:this.fields}));self.$el.append($content);_.each(this.fields,function(field,fieldName){self.widgets[fieldName].appendTo($content.find('#'+fieldName+'_field'));});return this._super.apply(this,arguments);},_confirmChange:function(){var self=this;var result=StandaloneFieldManagerMixin._confirmChange.apply(this,arguments);var data={};_.each(this.fields,function(filter,fieldName){data[fieldName]=self.widgets[fieldName].value.res_ids;});this.trigger_up('value_changed',data);return result;},_makeM2MWidget:function(fieldInfo,fieldName){var self=this;var options={};options[fieldName]={options:{no_create_edit:true,no_create:true,}};return this.model.makeRecord(fieldInfo.modelName,[{fields:[{name:'id',type:'integer',},{name:'display_name',type:'char',}],name:fieldName,relation:fieldInfo.modelName,type:'many2many',value:fieldInfo.value,}],options).then(function(recordID){self.widgets[fieldName]=new RelationalFields.FieldMany2ManyTags(self,fieldName,self.model.get(recordID),{mode:'edit',});self._registerWidget(recordID,fieldName,self.widgets[fieldName]);});},});AccountReport.include({custom_events:{'value_changed':function(ev){var self=this;self.report_options.division_ids=ev.data.division_ids;self.report_options.end_user_ids=ev.data.end_user_ids;self.report_options.partner_ids=ev.data.partner_ids;self.report_options.partner_categories=ev.data.partner_categories;self.report_options.analytic_accounts=ev.data.analytic_accounts;self.report_options.analytic_tags=ev.data.analytic_tags;return self.reload().then(function(){self.$searchview_buttons.find('.account_partner_filter').click();});},},render_searchview_buttons:function(){if(!this.M2MFilters1){var fields1={};if(this.report_options.division_ids){fields1['division_ids']={label:_t('Divisions'),modelName:'azk_sales_division.division',value:this.report_options.division_ids.map(Number),};}
if(!_.isEmpty(fields1)){this.M2MFilters1=new M2MFilters(this,fields1);this.M2MFilters1.appendTo(this.$searchview_buttons.find('.js_divisions_m2m'));}}else{this.$searchview_buttons.find('.js_divisions_m2m').append(this.M2MFilters1.$el);}
if(!this.M2MFilters2){var fields2={};if(this.report_options.end_user_ids){fields2['end_user_ids']={label:_t('End User'),modelName:'res.partner',value:this.report_options.end_user_ids.map(Number),};}
if(!_.isEmpty(fields2)){this.M2MFilters2=new M2MFilters(this,fields2);this.M2MFilters2.appendTo(this.$searchview_buttons.find('.js_end_users_m2m'));}}else{this.$searchview_buttons.find('.js_end_users_m2m').append(this.M2MFilters2.$el);}
this._super.apply(this,arguments);},});});;

/* /ks_dn_advance/static/src/js/ks_labels.js defined in bundle 'web.assets_backend' */
odoo.define('ks_dashboard_ninja_list.ks_labels',function(require){"use strict";var registry=require('web.field_registry');var AbstractField=require('web.AbstractField');var core=require('web.core');var field_utils=require('web.field_utils');var session=require('web.session');var utils=require('web.utils');var QWeb=core.qweb;var KsLabels=AbstractField.extend({resetOnAnyFieldChange:true,supportedFieldTypes:['char'],events:_.extend({},AbstractField.prototype.events,{'change select':'ks_toggle_icon_input_click',}),init:function(){this.ks_columns={};this._super.apply(this,arguments);},_renderEdit:function(){var self=this;self.$el.empty();var field=self.recordData;if(field.ks_query_result){var ks_query_result=JSON.parse(field.ks_query_result);if(ks_query_result.header.length){self.ks_check_for_labels();var $view=$(QWeb.render('ks_select_labels',{ks_columns_list:self.ks_columns,mode:self.mode,}));if(self.value){$view.val(self.value);}
this.$el.append($view)
if(this.mode==='readonly'){this.$el.find('.ks_label_select').addClass('ks_not_click');}}else{this.$el.append("No Data Available");}}else{this.$el.append("Please Enter the Appropriate Query for this");}},_renderReadonly:function(){var self=this;self.$el.empty();var field=self.recordData;if(field.ks_query_result){var ks_query_result=JSON.parse(field.ks_query_result);if(ks_query_result.records.length){self.ks_check_for_labels();var $view=$(QWeb.render('ks_select_labels',{ks_columns_list:self.ks_columns,value:self.ks_columns[self.value],mode:self.mode,}));self.$el.append($view);}else{this.$el.append("No Data Available");}}else{this.$el.append("Please Enter the Appropriate Query for this")}},ks_toggle_icon_input_click:function(e){var self=this;self._setValue(e.currentTarget.value);},ks_check_for_labels:function(){var self=this;self.ks_columns={false:false};var query_result=JSON.parse(self.recordData.ks_query_result);if(self.name==="ks_ylabels"){query_result.header.forEach(function(key){if(typeof(query_result[0][key])==="number"){self.ks_columns[key]=self.ks_title(key.replace("_"," "));}});}else{query_result.header.forEach(function(key){self.ks_columns[key]=self.ks_title(key.replace("_"," "));});}},ks_title:function(str){var split_str=str.toLowerCase().split(' ');for(var i=0;i<split_str.length;i++){split_str[i]=split_str[i].charAt(0).toUpperCase()+split_str[i].substring(1);str=split_str.join(' ');}
return str;}});registry.add('ks_labels',KsLabels);return KsLabels});;

/* /ks_dn_advance/static/src/js/ks_ylabels.js defined in bundle 'web.assets_backend' */
odoo.define("ks_dashboard_ninja.ks_ylabels",function(require){var registry=require('web.field_registry');var AbstractField=require('web.AbstractField');var core=require('web.core');var field_utils=require('web.field_utils');var session=require('web.session');var utils=require('web.utils');var QWeb=core.qweb;var KsYLabels=AbstractField.extend({resetOnAnyFieldChange:true,supportedFieldTypes:['char'],events:_.extend({},AbstractField.prototype.events,{'change select':'ks_toggle_icon_input_click','blur .ks_stack_group':'ks_group_input_click',}),init:function(){this.ks_columns={};this.ks_rows_keys=[];this.ks_rows_chart_type={}
this._super.apply(this,arguments);},_render:function(){var self=this;self.$el.empty();var field=self.recordData;if(field.ks_query_result){var ks_query_result=JSON.parse(field.ks_query_result);if(ks_query_result.header.length){if(field.ks_dashboard_item_type!=='ks_list_view'&&field.ks_dashboard_item_type!=='ks_kpi'&&field.ks_dashboard_item_type!=='ks_tile'){self.ks_check_for_labels();var $view=$(QWeb.render('ks_y_label_table',{label_rows:self.ks_columns,chart_type:self.ks_rows_chart_type,mode:self.mode,ks_is_group_column:ks_query_result.ks_is_group_column}));self.ks_rows_keys.forEach(function(key){$view.find('#'+key).val(self.ks_rows_chart_type[key]);})
self.$el.append($view);if(this.mode=='edit')self.ks_toggle_icon_input_click();}}else{this.$el.append("No Data Available");}}else{this.$el.append("Please Enter the Appropriate Query for this");}
if(this.mode==='readonly'){this.$el.find('select').addClass('ks_not_click');this.$el.find('td.ks_stack_group').addClass('ks_not_click');}},ks_check_for_labels:function(){var self=this;self.ks_columns={};if(self.value){var ks_columns=JSON.parse(self.value);Object.keys(ks_columns).forEach(function(key){var chart_type=ks_columns[key]['chart_type'];self.ks_rows_chart_type[key]=chart_type;ks_columns[key]['chart_type']={}
if(self.recordData.ks_dashboard_item_type==='ks_bar_chart'){var chart_type_temp=self.recordData.ks_dashboard_item_type.split("_")[1];if(chart_type_temp!==chart_type){chart_type=chart_type_temp;}
ks_columns[key]['chart_type'][chart_type]=self.ks_title(chart_type);if(chart_type==="bar"){ks_columns[key]['chart_type']["line"]="Line";}else{ks_columns[key]['chart_type']["bar"]="Bar"}}else{var chart_type=self.recordData.ks_dashboard_item_type.split("_")[1];ks_columns[key]['chart_type'][chart_type]=self.ks_title(chart_type);if(chart_type==="bar")ks_columns[key]['chart_type']["line"]="Line";}
self.ks_rows_keys.push(key);});self.ks_columns=ks_columns;}else{var query_result=JSON.parse(self.recordData.ks_query_result);query_result.header.forEach(function(key){for(var i=0;i<query_result.header.length;i++){if(query_result.type_code[query_result.header.indexOf(key)]!=='numeric'){continue;}
if(query_result.type_code[query_result.header.indexOf(key)]=='numeric'){var ks_row={}
ks_row['measure']=self.ks_title(key.replace("_"," "));ks_row['chart_type']={}
var chart_type=self.recordData.ks_dashboard_item_type.split("_")[1];ks_row['chart_type'][chart_type]=self.ks_title(chart_type);if(chart_type==="bar")ks_row['chart_type']["line"]="Line";ks_row['group']=" ";self.ks_columns[key]=ks_row;}
break;}});}},ks_toggle_icon_input_click:function(e){var self=this;var ks_tbody=this.$el.find('tbody.ks_y_axis');ks_tbody.find('select').each(function(){self.ks_columns[this.id]['chart_type']=this.value;});var value=JSON.stringify(self.ks_columns);self._setValue(value);},ks_title:function(str){var split_str=str.toLowerCase().split(' ');for(var i=0;i<split_str.length;i++){split_str[i]=split_str[i].charAt(0).toUpperCase()+split_str[i].substring(1);str=split_str.join(' ');}
return str;},ks_group_input_click:function(e){var self=this;var ks_tbody=this.$el.find('tbody.ks_y_axis');ks_tbody.find('select').each(function(){self.ks_columns[this.id]['chart_type']=this.value;});self.ks_columns[e.currentTarget.id]['group']=e.currentTarget.textContent.trim();var value=JSON.stringify(self.ks_columns);self._setValue(value);}});registry.add('ks_y_labels',KsYLabels);return KsYLabels;});;

/* /ks_dn_advance/static/src/js/ks_dashboard_ninja_tv_graph_preview.js defined in bundle 'web.assets_backend' */
odoo.define('ks_dashboard_ninja_list_tv.ks_dashboard_graph_preview',function(require){"use strict";var KsGraphPreview=require('ks_dashboard_ninja_list.ks_dashboard_graph_preview');KsGraphPreview.KsGraphPreview.include({_render:function(){this.$el.empty();if(this.recordData.ks_dashboard_item_type!=='ks_tile'&&this.recordData.ks_dashboard_item_type!=='ks_kpi'&&this.recordData.ks_dashboard_item_type!=='ks_list_view'){if(this.recordData.ks_data_calculation_type!=="query"){this._super.apply(this,arguments);}
else if(this.recordData.ks_data_calculation_type==="query"&&this.recordData.ks_query_result){if(this.recordData.ks_xlabels&&this.recordData.ks_ylabels){this._getChartData();}else{this.$el.append($('<div>').text("Please choose the X-labels and Y-labels"));}}else{this.$el.append($('<div>').text("Please run the appropriate Query"));}}},});return KsGraphPreview;});;

/* /ks_dn_advance/static/src/js/ks_dashboard_ninja_tv_list_preview.js defined in bundle 'web.assets_backend' */
odoo.define('ks_dashboard_tv_ninja.ks_list_view_preview',function(require){var KsListPreview=require('ks_dashboard_ninja_list.ks_dashboard_ninja_list_view_preview');var viewRegistry=require('web.view_registry');var field_utils=require('web.field_utils');var core=require('web.core');var QWeb=core.qweb;KsListPreview.KsListViewPreview.include({_render:function(){this.$el.empty();var rec=this.recordData;if(rec.ks_dashboard_item_type==='ks_list_view'){if(rec.ks_data_calculation_type==="custom"){this._super.apply(this,arguments);}else{this.ksRenderListView();}}},ksRenderListView:function(){var field=this.recordData;var ks_list_view_name;var list_view_data=JSON.parse(field.ks_list_view_data);var count=field.ks_record_count;var calculation_type=this.recordData.ks_data_calculation_type;if(field.name)ks_list_view_name=field.name;else if(field.ks_model_name)ks_list_view_name=field.ks_model_id.data.display_name;else ks_list_view_name="Name";if(field.ks_list_view_type==="ungrouped"&&list_view_data){var index_data=list_view_data.date_index;if(index_data){for(var i=0;i<index_data.length;i++){for(var j=0;j<list_view_data.data_rows.length;j++){var index=index_data[i]
var date=list_view_data.data_rows[j]["data"][index]
if(date){if(list_view_data.fields_type[index]==='date'){list_view_data.data_rows[j]["data"][index]=field_utils.format.date(moment(moment(date).utc(true)._d),{},{timezone:false});}else{list_view_data.data_rows[j]["data"][index]=field_utils.format.datetime(moment(moment(date).utc(true)._d),{},{timezone:false});}}else{list_view_data.data_rows[j]["data"][index]="";}}}}}
if(field.ks_list_view_data){var data_rows=list_view_data.data_rows;if(data_rows){for(var i=0;i<list_view_data.data_rows.length;i++){for(var j=0;j<list_view_data.data_rows[0]["data"].length;j++){if(typeof(list_view_data.data_rows[i].data[j])==="number"||list_view_data.data_rows[i].data[j]){if(typeof(list_view_data.data_rows[i].data[j])==="number"){list_view_data.data_rows[i].data[j]=field_utils.format.float(list_view_data.data_rows[i].data[j],Float64Array,{digits:[0,field.ks_precision_digits]})}}else{list_view_data.data_rows[i].data[j]="";}}}}}else list_view_data=false;count=list_view_data&&field.ks_list_view_type==="ungrouped"?count-list_view_data.data_rows.length:false;count=count?count<=0?false:count:false;var $listViewContainer=$(QWeb.render('ks_list_view_container',{ks_list_view_name:ks_list_view_name,list_view_data:list_view_data,count:count,layout:field.ks_list_view_layout,calculation_type:calculation_type,}));if(list_view_data){var $ksitemBody=this.ksListViewBody(ks_list_view_name,list_view_data,count,field.ks_list_view_layout,field.ks_data_calculation_type)
$listViewContainer.find('.ks_table_body').append($ksitemBody)}
if(!this.recordData.ks_show_records===true){$listViewContainer.find('#ks_item_info').hide();}
this.$el.append($listViewContainer);},ksListViewBody:function(ks_list_view_name,list_view_data,count,ks_list_view_layout,ks_data_calculation_type){var self=this;var $ksitemBody=$(QWeb.render('ks_list_view_tmpl',{ks_list_view_name:ks_list_view_name,list_view_data:list_view_data,count:count,layout:ks_list_view_layout,calculation_type:ks_data_calculation_type}));return $ksitemBody;},get_rgba_format:function(val){var rgba=val.split(',')[0].match(/[A-Za-z0-9]{2}/g);rgba=rgba.map(function(v){return parseInt(v,16)}).join(",");return"rgba("+rgba+","+val.split(',')[1]+")";},});return KsListPreview;});;

/* /ks_dn_advance/static/src/js/ks_tv_dashboard.js defined in bundle 'web.assets_backend' */
odoo.define('ks_dn_advance.ks_tv_dashboard',function(require){var KsDashboardNinja=require('ks_dashboard_ninja.ks_dashboard');var core=require('web.core');var _t=core._t;var QWeb=core.qweb;var field_utils=require('web.field_utils');var config=require('web.config');var KsGlobalFunction=require('ks_dashboard_ninja.KsGlobalFunction');KsDashboardNinja.include({jsLibs:['/ks_dashboard_ninja/static/lib/js/Chart.bundle.min.js','/ks_dashboard_ninja/static/lib/js/gridstack-h5.js','/ks_dashboard_ninja/static/lib/js/chartjs-plugin-datalabels.js','/ks_dashboard_ninja/static/lib/js/pdfmake.min.js','/ks_dashboard_ninja/static/lib/js/vfs_fonts.js','ks_dn_advance/static/lib/js/print.min.js','ks_dn_advance/static/lib/js/pdf.min.js',],events:_.extend(KsDashboardNinja.prototype.events,{'click .ks_start_tv_dashboard':'startTvDashboard','click .ks_stop_tv_dashboard':'ksStopTvDashboard','click .ks_dn_asc':'_ksSortAscOrder','click .ks_dn_desc':'_ksSortDescOrder','click .ks_dashboard_print_pdf':'ks_dash_print',}),ks_dash_print:function(id){var self=this;var ks_dashboard_name=self.ks_dashboard_data.name
setTimeout(function(){const input=document.getElementById('ks_dash1');const divHeight=input.clientHeight
const divWidth=input.clientWidth
const ratio=divHeight/divWidth
window.scrollTo(0,0);html2canvas(document.querySelector("#ks_dash1"),{scale:2}).then(canvas=>{var ks_image_date=canvas.toDataURL("image/jpeg",1)
window.jsPDF=window.jspdf.jsPDF("p","px","a4")
var pdf=window.jsPDF;var pageWidth=pdf.internal.pageSize.getWidth();var pageHeight=pdf.internal.pageSize.getHeight();var imageWidth=canvas.width;var imageHeight=canvas.height;imageWidth=divWidth;imageHeight=divHeight;var ratio=imageWidth/imageHeight>=pageWidth/pageHeight?pageWidth/imageWidth:pageHeight/imageHeight;pdf.addImage(ks_image_date,'JPEG',0,0,divWidth*ratio,pageHeight);pdf.save(ks_dashboard_name+'.pdf');});},500);},_ksRenderNoItemView:function(){$('.ks_dashboard_items_list').remove();var self=this;self.$el.find('.ks_dashboard_link').addClass("d-none");self.$el.find('.ks_dashboard_edit_layout').addClass("d-none");self.$el.find('.ks_start_tv_dashboard').addClass("ks_hide_display");$(QWeb.render('ksNoItemView')).appendTo(self.$el)},_ksSortAscOrder:function(e){var self=this;var ks_value_offfset=$(e.currentTarget.parentElement.parentElement.parentElement.offsetParent).find('.ks_pager').find('.ks_counter').find('.ks_value').text();var offset=0;var initial_count=0;if(ks_value_offfset)
{initial_count=parseInt(ks_value_offfset.split('-')[0])
offset=parseInt(ks_value_offfset.split('-')[1])}
var item_id=e.currentTarget.dataset.itemId;var field=e.currentTarget.dataset.fields;var context=self.getContext();var searchList=[]
var searchField=[]
var user_id=odoo.session_info.uid;var context=self.getContext();context.user_id=user_id;context.offset=offset;context.initial_count=initial_count;var store=e.currentTarget.dataset.store;context.field=field;context.sort_order="ASC"
var ks_domain=self.ksGetParamsForItemFetch(parseInt(item_id));if(store=="true"){self._rpc({model:'ks_dashboard_ninja.item',method:'ks_get_list_data_orderby_extend',args:[[parseInt(item_id)],ks_domain],context:context,}).then(function(result){if(result){var list_view_data=result;var $listBody=self._ksListViewBody(list_view_data,item_id);$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_table_body").empty();$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_table_body").append($listBody);}}.bind(this));$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_sort_up[data-fields="+field+"]").removeClass('ks_plus')
$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_sort_down[data-fields="+field+"]").addClass('ks_plus')
$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".list_header[data-fields="+field+"]").removeClass('ks_dn_asc')
$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".list_header[data-fields="+field+"]").addClass('ks_dn_desc')}},_ksSortDescOrder:function(e){var self=this;var ks_value_offfset=$(e.currentTarget.parentElement.parentElement.parentElement.offsetParent).find('.ks_pager').find('.ks_counter').find('.ks_value').text();var offset=0;var initial_count=0;if(ks_value_offfset)
{initial_count=parseInt(ks_value_offfset.split('-')[0])
offset=parseInt(ks_value_offfset.split('-')[1])}
var item_id=e.currentTarget.dataset.itemId;var field=e.currentTarget.dataset.fields;var context=self.getContext();var user_id=odoo.session_info.uid;var context=self.getContext();context.user_id=user_id;context.offset=offset;context.initial_count=initial_count;var store=e.currentTarget.dataset.store;context.field=field;context.sort_order="DESC";var ks_domain=self.ksGetParamsForItemFetch(parseInt(item_id));if(store=="true"){self._rpc({model:'ks_dashboard_ninja.item',method:'ks_get_list_data_orderby_extend',args:[[parseInt(item_id)],ks_domain],context:context,}).then(function(result){if(result){var list_view_data=result;var $listBody=self._ksListViewBody(list_view_data,item_id);$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_table_body").empty();$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_table_body").append($listBody);}}.bind(this));$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_sort_down[data-fields="+field+"]").removeClass('ks_plus')
$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".ks_sort_up[data-fields="+field+"]").addClass('ks_plus')
$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".list_header[data-fields="+field+"]").addClass('ks_dn_asc')
$(self.$el.find(".grid-stack-item[gs-id="+item_id+"]").children()[0]).find(".list_header[data-fields="+field+"]").removeClass('ks_dn_desc')}},_ksListViewBody:function(list_view_data,item_id){var self=this;var itemid=item_id
var ks_data_calculation_type=self.ks_dashboard_data.ks_item_data[item_id].ks_data_calculation_type;var list_view_type=self.ks_dashboard_data.ks_item_data[item_id].ks_list_view_type
if(list_view_type==="ungrouped"&&list_view_data){if(list_view_data.date_index){var index_data=list_view_data.date_index;for(var i=0;i<index_data.length;i++){for(var j=0;j<list_view_data.data_rows.length;j++){var index=index_data[i]
var date=list_view_data.data_rows[j]["data"][index]
if(date){if(list_view_data.fields_type[index]==='date'){list_view_data.data_rows[j]["data"][index]=field_utils.format.date(moment(moment(date).utc(true)._d),{},{timezone:false});}else{list_view_data.data_rows[j]["data"][index]=field_utils.format.datetime(moment(moment(date).utc(true)._d),{},{timezone:false});}}else{list_view_data.data_rows[j]["data"][index]="";}}}}}
if(list_view_data){for(var i=0;i<list_view_data.data_rows.length;i++){for(var j=0;j<list_view_data.data_rows[0]["data"].length;j++){if(typeof(list_view_data.data_rows[i].data[j])==="number"||list_view_data.data_rows[i].data[j]){if(typeof(list_view_data.data_rows[i].data[j])==="number"){list_view_data.data_rows[i].data[j]=field_utils.format.float(list_view_data.data_rows[i].data[j],Float64Array)}}else{list_view_data.data_rows[i].data[j]="";}}}}
var $ksitemBody=$(QWeb.render('ks_list_view_tmpl',{list_view_data:list_view_data,item_id:itemid,calculation_type:ks_data_calculation_type,isDrill:self.ks_dashboard_data.ks_item_data[item_id]['isDrill'],list_type:list_view_type,}));return $ksitemBody;},rendertvDashboard:function(){var self=this;this.$el.find('.ks_float_tv').remove();this.container_owl=$(QWeb.render('ks_owl_carssel'));var items=self.ksSortItems(self.ks_dashboard_data.ks_item_data);self.$el.find('.ks_dashboard_main_content').append(this.container_owl);this.container_owl=this.container_owl.find('.owl-carousel');self.ksRenderTvDashboardItems(items);},ksRenderTvDashboardItems:function(items){var self=this;this.ks_dashboard_manager=self.ks_dashboard_data.ks_dashboard_manager
self.ks_dashboard_data.ks_dashboard_manager=false;this.tiles=[];this.kpi=[];for(var i=0;i<items.length;i++){if(items[i].ks_dashboard_item_type==='ks_tile'){this.tiles.push(items[i]);}else if(items[i].ks_dashboard_item_type==='ks_list_view'){var item_view=self.renderTvListView(items[i],self.grid);this.container_owl.append(item_view);}else if(items[i].ks_dashboard_item_type==='ks_kpi'){this.kpi.push(items[i]);}else if(items[i].ks_dashboard_item_type==='ks_to_do'){var active_section_id=false
if($(".grid-stack-item[gs-id="+items[i].id+"]").find('.ks_card_header').find('.active').data()){active_section_id=$(".grid-stack-item[gs-id="+items[i].id+"]").find('.ks_card_header').find('.active').data().sectionId}
var item_view=self.renderTvTodoView(items[i],active_section_id,self.grid);this.container_owl.append(item_view);}else{self._renderTvGraph(items[i],self.grid)}}
self._renderTiles();self._renderKPi();self.ks_dashboard_data.ks_dashboard_manager=this.ks_dashboard_manager;},renderTvTodoView:function(item,active_section_id){var self=this;var item_title=item.name;var item_id=item.id;var list_to_do_data=JSON.parse(item.ks_to_do_data)
var ks_header_color=self._ks_get_rgba_format(item.ks_header_bg_color);var ks_font_color=self._ks_get_rgba_format(item.ks_font_color);var ks_rgba_button_color=self._ks_get_rgba_format(item.ks_button_color);var $ksItemContainer=self.ksRenderToDoView(item,ks_tv_play=true);var $ks_gridstack_container=$(QWeb.render('ks_gridstack_todo_tv_view_container',{ks_chart_title:item_title,ks_dashboard_list:self.ks_dashboard_data.ks_dashboard_list,item_id:item_id,to_do_view_data:list_to_do_data,})).addClass('ks_dashboarditem_id')
$ks_gridstack_container.find('.ks_card_header').addClass('ks_bg_to_color').css({"background-color":ks_header_color});$ks_gridstack_container.find('.ks_card_header').addClass('ks_bg_to_color').css({"color":ks_font_color+' !important'});$ks_gridstack_container.find('.ks_dna_li_tab').addClass('ks_bg_to_color').css({"color":ks_font_color+' !important'});$ks_gridstack_container.find('.ks_list_view_heading').addClass('ks_bg_to_color').css({"color":ks_font_color+' !important'});if(active_section_id){$ks_gridstack_container.find('.ks_card_header').find('.nav-link').removeClass('active')
$ks_gridstack_container.find('.ks_card_header').find(".nav-link[data-section-id="+active_section_id+"]").addClass('active')
$ksItemContainer.find('.ks_tab_section').removeClass('active');$ksItemContainer.find(".ks_tab_section[data-section-id="+active_section_id+"]").addClass('active');$ksItemContainer.find(".ks_tab_section[data-section-id="+active_section_id+"]").addClass('show');}
$ks_gridstack_container.find('.ks_to_do_card_body').append($ksItemContainer)
return $ks_gridstack_container;},_renderTiles:function(){var self=this;var count=Math.round(this.tiles.length/2)
var $kscontainer=$('<div class="d-flex align-items-center justify-content-center flex-column h-100 ks_tv_item">')
for(var i=1;i<=count;i++){var ks_tiles=this.tiles.splice(0,2);var $container=$('<div class="d-flex align-items-center ks-tv-item">');for(var j=0;j<ks_tiles.length;j++){var item_data=ks_tiles[j];var item_view=self._ksRenderDashboardTile(item_data);$container.append(item_view);}
$kscontainer.append($container)
if(i%2===0){this.container_owl.append($kscontainer);$kscontainer=$('<div class="d-flex align-items-center justify-content-center flex-column h-100 ks_tv_item">');}}
if($kscontainer[0].childElementCount){this.container_owl.append($kscontainer);}},_renderKPi:function(){var self=this;var count=Math.round(this.kpi.length/2);for(var i=1;i<=count;i++){var $kscontainer=$('<div class="d-flex align-items-center justify-content-center h-100 ks_tv_item ks-tv-kpi">');var ks_tiles=this.kpi.splice(0,2)
for(var j=0;j<ks_tiles.length;j++){var item_data=ks_tiles[j];var item_view=self.renderKpi(item_data);$kscontainer.append(item_view);}
this.container_owl.append($kscontainer);}},_renderGraph:function(item){var self=this;this._super.apply(this,arguments);if(item.ks_data_calculation_type==='query'){$(self.$el.find(".grid-stack-item[gs-id="+item.id+"]").children()[0]).find(".ks_dashboard_item_chart_info").addClass('d-none');}},onChartCanvasClick:function(evt){var self=this;var item_id;if(evt.currentTarget.classList.value!=='ks_list_canvas_click'){item_id=evt.currentTarget.dataset.chartId;}else{item_id=$(evt.target).parent().data().itemId;}
var item_data=self.ks_dashboard_data.ks_item_data[item_id];if(item_data.ks_data_calculation_type==='custom'){this._super.apply(this,arguments);}},startTvDashboard:function(e){this.rendertvDashboard();var self=this;var speed=self.ks_dashboard_data.ks_croessel_speed?parseInt(self.ks_dashboard_data.ks_croessel_speed):5000
$('.ks_float_tv').removeClass('d-none');$('.owl-carousel').owlCarousel({rtl:$('.o_rtl').length>0,loop:true,nav:true,dots:false,items:1,margin:10,autoplay:true,autoplayTimeout:speed,responsiveClass:true,autoplayHoverPause:true,navText:['<i class="fa fa fa-angle-left"></i>','<i class="fa fa fa-angle-right"></i>'],});},ksStopTvDashboard:function(e){$('.owl-carousel').owlCarousel('destroy');$('.ks_float_tv').addClass('d-none');},ksUpdateDashboardItem:function(ids){var self=this;for(var i=0;i<ids.length;i++){var item_data=self.ks_dashboard_data.ks_item_data[ids[i]]
if(item_data['ks_dashboard_item_type']=='ks_list_view'){var item_view=self.$el.find(".grid-stack-item[gs-id="+item_data.id+"]");item_view.find('.card-body').empty();var name=item_data.name?item_data.name:item_data.ks_model_display_name;item_view.children().find('.ks_list_view_heading').prop('title',name);item_view.children().find('.ks_list_view_heading').text(name);item_view.find('.ks_dashboard_item_drill_up').addClass('d-none')
item_view.find('.ks_dashboard_item_action_export').removeClass('d-none')
item_view.find('.ks_dashboard_quick_edit_action_popup ').removeClass('d-none')
item_view.find('.card-body').append(self.renderListViewData(item_data));var rows=JSON.parse(item_data['ks_list_view_data']).data_rows;var ks_length=rows?rows.length:false;if(ks_length){if(item_view.find('.ks_pager_name')){item_view.find('.ks_pager_name').empty();var $ks_pager_container=QWeb.render('ks_pager_template',{item_id:ids[i],intial_count:item_data.ks_pagination_limit,offset:1})
item_view.find('.ks_pager_name').append($($ks_pager_container));}
if(ks_length<item_data.ks_pagination_limit)item_view.find('.ks_load_next').addClass('ks_event_offer_list');item_view.find('.ks_value').text("1-"+JSON.parse(item_data['ks_list_view_data']).data_rows.length);if(item_data.ks_record_data_limit==item_data.ks_pagination_limit||item_data.ks_record_count==item_data.ks_pagination_limit){item_view.find('.ks_load_next').addClass('ks_event_offer_list');}}
else{item_view.find('.ks_pager').addClass('d-none');}}else if(item_data['ks_dashboard_item_type']=='ks_tile'){var item_view=self._ksRenderDashboardTile(item_data);self.$el.find(".grid-stack-item[gs-id="+item_data.id+"]").find(".ks_dashboard_item_hover").replaceWith($(item_view).find('.ks_dashboarditem_id'));}else if(item_data['ks_dashboard_item_type']=='ks_kpi'){var item_view=self.renderKpi(item_data);self.$el.find(".grid-stack-item[gs-id="+item_data.id+"]").find(".ks_dashboard_item_hover").replaceWith($(item_view).find('.ks_dashboarditem_id'));}else{self.grid.removeWidget(self.$el.find(".grid-stack-item[gs-id="+item_data.id+"]")[0]);self.ksRenderDashboardItems([item_data]);}}
self.grid.setStatic(true);},renderListViewData:function(item){var self=this;var list_view_data=JSON.parse(item.ks_list_view_data);var item_id=item.id,data_rows=list_view_data.data_rows,item_title=item.name;if(item.ks_list_view_type==="ungrouped"&&list_view_data){if(list_view_data.date_index){var index_data=list_view_data.date_index;for(var i=0;i<index_data.length;i++){for(var j=0;j<list_view_data.data_rows.length;j++){var index=index_data[i]
var date=list_view_data.data_rows[j]["data"][index]
if(date){if(list_view_data.fields_type[index]==='date'){list_view_data.data_rows[j]["data"][index]=field_utils.format.date(moment(moment(date)._d),{},{timezone:false});}else{list_view_data.data_rows[j]["data"][index]=field_utils.format.datetime(moment(moment(date).utc(true)._d),{},{timezone:false});}}else{list_view_data.data_rows[j]["data"][index]="";}}}}}
if(list_view_data){for(var i=0;i<list_view_data.data_rows.length;i++){for(var j=0;j<list_view_data.data_rows[0]["data"].length;j++){if(typeof(list_view_data.data_rows[i].data[j])==="number"||list_view_data.data_rows[i].data[j]){if(typeof(list_view_data.data_rows[i].data[j])==="number"){list_view_data.data_rows[i].data[j]=field_utils.format.float(list_view_data.data_rows[i].data[j],Float64Array,{digits:[0,item.ks_precision_digits]})}}else{list_view_data.data_rows[i].data[j]="";}}}}
var template;switch(item.ks_list_view_layout){case'layout_1':template='ks_list_view_table';break;case'layout_2':template='ks_list_view_layout_2';break;case'layout_3':template='ks_list_view_layout_3';break;case'layout_4':template='ks_list_view_layout_4';break;default:template='ks_list_view_table';break;}
var $ksItemContainer=$(QWeb.render(template,{list_view_data:list_view_data,item_id:item_id,list_type:item.ks_list_view_type,calculation_type:item.ks_data_calculation_type,isDrill:self.ks_dashboard_data.ks_item_data[item_id]['isDrill']}));self.list_container=$ksItemContainer;if(list_view_data){var $ksitemBody=self.ksListViewBody(list_view_data,item_id)
self.list_container.find('.ks_table_body').append($ksitemBody)}
if(item.ks_list_view_type==="ungrouped"&&item.ks_data_calculation_type==='custom'){$ksItemContainer.find('.ks_list_canvas_click').removeClass('ks_list_canvas_click');}
if(item.ks_goal_liness){$ksItemContainer.find('.ks_sort_icon').addClass('d-none')
$ksItemContainer.find('.ks_sort_down').removeClass('ks_sort_down')
$ksItemContainer.find('.ks_sort_up').removeClass('ks_sort_up')
$ksItemContainer.find('.list_header').removeClass('ks_dn_asc');}
if(!item.ks_show_records){$ksItemContainer.find('#ks_item_info').hide();}
return $ksItemContainer},renderTvListView:function(item){var self=this;var list_view_data=JSON.parse(item.ks_list_view_data),pager=false,item_id=item.id,data_rows=list_view_data.data_rows,length=data_rows?data_rows.length:false,item_title=item.name;var $ks_gridstack_container=$(QWeb.render('ks_gridstack_list_tv_view_container',{ks_chart_title:item_title,ksIsDashboardManager:self.ks_dashboard_data.ks_dashboard_manager,ks_pager:pager,calculation_type:item.ks_data_calculation_type,}));var $container=self.renderListViewData(item);$container.find('.list_header').removeClass('ks_dn_asc');if(item.ks_data_calculation_type==='custom'){$container.find('.ks_list_canvas_click').removeClass('ks_list_canvas_click');}
$container.find('.ks_sort_icon').addClass('d-none');$ks_gridstack_container.find('.card-body').append($container);return $ks_gridstack_container},_renderListView:function(item,grid){var self=this;var list_view_data=JSON.parse(item.ks_list_view_data),pager=true,item_id=item.id,data_rows=list_view_data.data_rows,length=data_rows?data_rows.length:0,item_title=item.name;var $ksItemContainer=self.renderListViewData(item)
var $ks_gridstack_container=$(QWeb.render('ks_gridstack_list_view_container',{ks_chart_title:item_title,ksIsDashboardManager:self.ks_dashboard_data.ks_dashboard_manager,ks_dashboard_list:self.ks_dashboard_data.ks_dashboard_list,item_id:item_id,count:'1-'+length,offset:1,intial_count:length,ks_pager:pager,calculation_type:item.ks_data_calculation_type,})).addClass('ks_dashboarditem_id');if(item.ks_pagination_limit<length){$ks_gridstack_container.find('.ks_load_next').addClass('ks_event_offer_list');}
if(length<item.ks_pagination_limit){$ks_gridstack_container.find('.ks_load_next').addClass('ks_event_offer_list');}
if(item.ks_record_data_limit===item.ks_pagination_limit){$ks_gridstack_container.find('.ks_load_next').addClass('ks_event_offer_list');}
if(length==0){$ks_gridstack_container.find('.ks_pager').addClass('d-none');}
if(item.ks_pagination_limit==0){$ks_gridstack_container.find('.ks_pager_name').addClass('d-none');}
$ks_gridstack_container.find('.card-body').append($ksItemContainer);if(item.ks_data_calculation_type==='query'||item.ks_list_view_type==="ungrouped"){$ks_gridstack_container.find('.ks_list_canvas_click').removeClass('ks_list_canvas_click');}
item.$el=$ks_gridstack_container;if(item_id in self.gridstackConfig){grid.addWidget($ks_gridstack_container[0],{x:self.gridstackConfig[item_id].x,y:self.gridstackConfig[item_id].y,w:self.gridstackConfig[item_id].w,h:self.gridstackConfig[item_id].h,autoPosition:false,minW:3,maxW:null,minH:3,maxH:null,id:item_id});}else{grid.addWidget($ks_gridstack_container[0],{x:0,y:0,w:5,h:4,autoPosition:true,minW:3,maxW:null,minH:3,maxH:null,id:item_id});}},_renderTvGraph:function(item){var self=this;var chart_data=JSON.parse(item.ks_chart_data);var isDrill=item.isDrill?item.isDrill:false;var chart_id=item.id,chart_title=item.name;var chart_title=item.name;var chart_type=item.ks_dashboard_item_type.split('_')[1];switch(chart_type){case"pie":case"doughnut":case"polarArea":var chart_family="circle";break;case"bar":case"horizontalBar":case"line":case"area":var chart_family="square"
break;default:var chart_family="none";break;}
var $ks_gridstack_container=$(QWeb.render('ks_gridstack_tv_container',{ks_chart_title:chart_title,ksIsDashboardManager:self.ks_dashboard_data.ks_dashboard_manager,ks_dashboard_list:self.ks_dashboard_data.ks_dashboard_list,chart_id:chart_id,chart_family:chart_family,chart_type:chart_type,ksChartColorOptions:this.ksChartColorOptions,})).addClass('ks_dashboarditem_id');this.container_owl.append($ks_gridstack_container);self._rendertvChart($ks_gridstack_container,item);},_rendertvChart($ks_gridstack_container,item){var self=this;var chart_data=JSON.parse(item.ks_chart_data);if(item.ks_chart_cumulative_field){for(var i=0;i<chart_data.datasets.length;i++){var ks_temp_com=0
var data=[]
var datasets={}
if(chart_data.datasets[i].ks_chart_cumulative_field){for(var j=0;j<chart_data.datasets[i].data.length;j++)
{ks_temp_com=ks_temp_com+chart_data.datasets[i].data[j];data.push(ks_temp_com);}
datasets.label='Cumulative'+chart_data.datasets[i].label;datasets.data=data;if(item.ks_chart_cumulative){datasets.type='line';}
chart_data.datasets.push(datasets);}}}
var isDrill=item.isDrill?item.isDrill:false;var chart_id=item.id,chart_title=item.name;var chart_title=item.name;var chart_type=item.ks_dashboard_item_type.split('_')[1];switch(chart_type){case"pie":case"doughnut":case"polarArea":var chart_family="circle";break;case"bar":case"horizontalBar":case"line":case"area":var chart_family="square"
break;default:var chart_family="none";break;}
$ks_gridstack_container.find('.ks_color_pallate').data({chartType:chart_type,chartFamily:chart_family});var $ksChartContainer=$('<canvas id="ks_chart_canvas_id"  data-chart-id='+chart_id+' style="height:400px"/>');$ks_gridstack_container.find('.card-body').append($ksChartContainer);if(chart_family==="circle"){if(chart_data&&chart_data['labels'].length>30){$ks_gridstack_container.find(".ks_dashboard_color_option").remove();$ks_gridstack_container.find(".card-body").empty().append($("<div style='font-size:20px;'>Too many records for selected Chart Type. Consider using <strong>Domain</strong> to filter records or <strong>Record Limit</strong> to limit the no of records under <strong>30.</strong>"));return;}}
if(chart_data["ks_show_second_y_scale"]&&item.ks_dashboard_item_type==='ks_bar_chart'){var scales={}
scales.yAxes=[{type:"linear",display:true,position:"left",id:"y-axis-0",gridLines:{display:true},labels:{show:true,}},{type:"linear",display:true,position:"right",id:"y-axis-1",labels:{show:true,},ticks:{beginAtZero:true,callback:function(value,index,values){var ks_selection=chart_data.ks_selection;if(ks_selection==='monetary'){var ks_currency_id=chart_data.ks_currency;var ks_data=KsGlobalFunction.ksNumFormatter(value,1);var ks_data=KsGlobalFunction._onKsGlobalFormatter(value,item.ks_data_formatting,item.ks_precision_digits);ks_data=KsGlobalFunction.ks_monetary(ks_data,ks_currency_id);return ks_data;}
else if(ks_selection==='custom'){var ks_field=chart_data.ks_field;return KsGlobalFunction._onKsGlobalFormatter(value,item.ks_data_formatting,item.ks_precision_digits)+' '+ks_field;}
else{return KsGlobalFunction._onKsGlobalFormatter(value,item.ks_data_formatting,item.ks_precision_digits);}},}}]}
var chart_plugin=[];if(item.ks_show_data_value){chart_plugin.push(ChartDataLabels);}
var ksMyChart=new Chart($ksChartContainer[0].getContext('2d'),{type:chart_type==="area"?"line":chart_type,plugins:chart_plugin,data:{labels:chart_data['labels'],groupByIds:chart_data['groupByIds'],domains:chart_data['domains'],datasets:chart_data.datasets,},options:{maintainAspectRatio:false,responsiveAnimationDuration:1000,animation:{easing:'easeInQuad',},legend:{display:item.ks_hide_legend},scales:scales,layout:{padding:{bottom:0,}},plugins:{datalabels:{backgroundColor:function(context){return context.dataset.backgroundColor;},borderRadius:4,color:'white',font:{weight:'bold'},anchor:'center',display:'auto',clamp:true,formatter:function(value,ctx){let sum=0;let dataArr=ctx.dataset.data;dataArr.map(data=>{sum+=data;});let percentage=sum===0?0+"%":(value*100/sum).toFixed(2)+"%";return percentage;},},},}});if(chart_data&&chart_data["datasets"].length>0)self.ksChartColors(item.ks_chart_item_color,ksMyChart,chart_type,chart_family,item.ks_bar_chart_stacked,item.ks_semi_circle_chart,item.ks_show_data_value,chart_data,item);},})
return KsDashboardNinja;});

/* /ks_dn_advance/static/lib/js/owl.carousel.min.js defined in bundle 'web.assets_backend' */
!function(a,b,c,d){function e(b,c){this.settings=null,this.options=a.extend({},e.Defaults,c),this.$element=a(b),this._handlers={},this._plugins={},this._supress={},this._current=null,this._speed=null,this._coordinates=[],this._breakpoint=null,this._width=null,this._items=[],this._clones=[],this._mergers=[],this._widths=[],this._invalidated={},this._pipe=[],this._drag={time:null,target:null,pointer:null,stage:{start:null,current:null},direction:null},this._states={current:{},tags:{initializing:["busy"],animating:["busy"],dragging:["interacting"]}},a.each(["onResize","onThrottledResize"],a.proxy(function(b,c){this._handlers[c]=a.proxy(this[c],this)},this)),a.each(e.Plugins,a.proxy(function(a,b){this._plugins[a.charAt(0).toLowerCase()+a.slice(1)]=new b(this)},this)),a.each(e.Workers,a.proxy(function(b,c){this._pipe.push({filter:c.filter,run:a.proxy(c.run,this)})},this)),this.setup(),this.initialize()}e.Defaults={items:3,loop:!1,center:!1,rewind:!1,checkVisibility:!0,mouseDrag:!0,touchDrag:!0,pullDrag:!0,freeDrag:!1,margin:0,stagePadding:0,merge:!1,mergeFit:!0,autoWidth:!1,startPosition:0,rtl:!1,smartSpeed:250,fluidSpeed:!1,dragEndSpeed:!1,responsive:{},responsiveRefreshRate:200,responsiveBaseElement:b,fallbackEasing:"swing",slideTransition:"",info:!1,nestedItemSelector:!1,itemElement:"div",stageElement:"div",refreshClass:"owl-refresh",loadedClass:"owl-loaded",loadingClass:"owl-loading",rtlClass:"owl-rtl",responsiveClass:"owl-responsive",dragClass:"owl-drag",itemClass:"owl-item",stageClass:"owl-stage",stageOuterClass:"owl-stage-outer",grabClass:"owl-grab"},e.Width={Default:"default",Inner:"inner",Outer:"outer"},e.Type={Event:"event",State:"state"},e.Plugins={},e.Workers=[{filter:["width","settings"],run:function(){this._width=this.$element.width()}},{filter:["width","items","settings"],run:function(a){a.current=this._items&&this._items[this.relative(this._current)]}},{filter:["items","settings"],run:function(){this.$stage.children(".cloned").remove()}},{filter:["width","items","settings"],run:function(a){var b=this.settings.margin||"",c=!this.settings.autoWidth,d=this.settings.rtl,e={width:"auto","margin-left":d?b:"","margin-right":d?"":b};!c&&this.$stage.children().css(e),a.css=e}},{filter:["width","items","settings"],run:function(a){var b=(this.width()/this.settings.items).toFixed(3)-this.settings.margin,c=null,d=this._items.length,e=!this.settings.autoWidth,f=[];for(a.items={merge:!1,width:b};d--;)c=this._mergers[d],c=this.settings.mergeFit&&Math.min(c,this.settings.items)||c,a.items.merge=c>1||a.items.merge,f[d]=e?b*c:this._items[d].width();this._widths=f}},{filter:["items","settings"],run:function(){var b=[],c=this._items,d=this.settings,e=Math.max(2*d.items,4),f=2*Math.ceil(c.length/2),g=d.loop&&c.length?d.rewind?e:Math.max(e,f):0,h="",i="";for(g/=2;g>0;)b.push(this.normalize(b.length/2,!0)),h+=c[b[b.length-1]][0].outerHTML,b.push(this.normalize(c.length-1-(b.length-1)/2,!0)),i=c[b[b.length-1]][0].outerHTML+i,g-=1;this._clones=b,a(h).addClass("cloned").appendTo(this.$stage),a(i).addClass("cloned").prependTo(this.$stage)}},{filter:["width","items","settings"],run:function(){for(var a=this.settings.rtl?1:-1,b=this._clones.length+this._items.length,c=-1,d=0,e=0,f=[];++c<b;)d=f[c-1]||0,e=this._widths[this.relative(c)]+this.settings.margin,f.push(d+e*a);this._coordinates=f}},{filter:["width","items","settings"],run:function(){var a=this.settings.stagePadding,b=this._coordinates,c={width:Math.ceil(Math.abs(b[b.length-1]))+2*a,"padding-left":a||"","padding-right":a||""};this.$stage.css(c)}},{filter:["width","items","settings"],run:function(a){var b=this._coordinates.length,c=!this.settings.autoWidth,d=this.$stage.children();if(c&&a.items.merge)for(;b--;)a.css.width=this._widths[this.relative(b)],d.eq(b).css(a.css);else c&&(a.css.width=a.items.width,d.css(a.css))}},{filter:["items"],run:function(){this._coordinates.length<1&&this.$stage.removeAttr("style")}},{filter:["width","items","settings"],run:function(a){a.current=a.current?this.$stage.children().index(a.current):0,a.current=Math.max(this.minimum(),Math.min(this.maximum(),a.current)),this.reset(a.current)}},{filter:["position"],run:function(){this.animate(this.coordinates(this._current))}},{filter:["width","position","items","settings"],run:function(){var a,b,c,d,e=this.settings.rtl?1:-1,f=2*this.settings.stagePadding,g=this.coordinates(this.current())+f,h=g+this.width()*e,i=[];for(c=0,d=this._coordinates.length;c<d;c++)a=this._coordinates[c-1]||0,b=Math.abs(this._coordinates[c])+f*e,(this.op(a,"<=",g)&&this.op(a,">",h)||this.op(b,"<",g)&&this.op(b,">",h))&&i.push(c);this.$stage.children(".active").removeClass("active"),this.$stage.children(":eq("+i.join("), :eq(")+")").addClass("active"),this.$stage.children(".center").removeClass("center"),this.settings.center&&this.$stage.children().eq(this.current()).addClass("center")}}],e.prototype.initializeStage=function(){this.$stage=this.$element.find("."+this.settings.stageClass),this.$stage.length||(this.$element.addClass(this.options.loadingClass),this.$stage=a("<"+this.settings.stageElement+">",{class:this.settings.stageClass}).wrap(a("<div/>",{class:this.settings.stageOuterClass})),this.$element.append(this.$stage.parent()))},e.prototype.initializeItems=function(){var b=this.$element.find(".owl-item");if(b.length)return this._items=b.get().map(function(b){return a(b)}),this._mergers=this._items.map(function(){return 1}),void this.refresh();this.replace(this.$element.children().not(this.$stage.parent())),this.isVisible()?this.refresh():this.invalidate("width"),this.$element.removeClass(this.options.loadingClass).addClass(this.options.loadedClass)},e.prototype.initialize=function(){if(this.enter("initializing"),this.trigger("initialize"),this.$element.toggleClass(this.settings.rtlClass,this.settings.rtl),this.settings.autoWidth&&!this.is("pre-loading")){var a,b,c;a=this.$element.find("img"),b=this.settings.nestedItemSelector?"."+this.settings.nestedItemSelector:d,c=this.$element.children(b).width(),a.length&&c<=0&&this.preloadAutoWidthImages(a)}this.initializeStage(),this.initializeItems(),this.registerEventHandlers(),this.leave("initializing"),this.trigger("initialized")},e.prototype.isVisible=function(){return!this.settings.checkVisibility||this.$element.is(":visible")},e.prototype.setup=function(){var b=this.viewport(),c=this.options.responsive,d=-1,e=null;c?(a.each(c,function(a){a<=b&&a>d&&(d=Number(a))}),e=a.extend({},this.options,c[d]),"function"==typeof e.stagePadding&&(e.stagePadding=e.stagePadding()),delete e.responsive,e.responsiveClass&&this.$element.attr("class",this.$element.attr("class").replace(new RegExp("("+this.options.responsiveClass+"-)\\S+\\s","g"),"$1"+d))):e=a.extend({},this.options),this.trigger("change",{property:{name:"settings",value:e}}),this._breakpoint=d,this.settings=e,this.invalidate("settings"),this.trigger("changed",{property:{name:"settings",value:this.settings}})},e.prototype.optionsLogic=function(){this.settings.autoWidth&&(this.settings.stagePadding=!1,this.settings.merge=!1)},e.prototype.prepare=function(b){var c=this.trigger("prepare",{content:b});return c.data||(c.data=a("<"+this.settings.itemElement+"/>").addClass(this.options.itemClass).append(b)),this.trigger("prepared",{content:c.data}),c.data},e.prototype.update=function(){for(var b=0,c=this._pipe.length,d=a.proxy(function(a){return this[a]},this._invalidated),e={};b<c;)(this._invalidated.all||a.grep(this._pipe[b].filter,d).length>0)&&this._pipe[b].run(e),b++;this._invalidated={},!this.is("valid")&&this.enter("valid")},e.prototype.width=function(a){switch(a=a||e.Width.Default){case e.Width.Inner:case e.Width.Outer:return this._width;default:return this._width-2*this.settings.stagePadding+this.settings.margin}},e.prototype.refresh=function(){this.enter("refreshing"),this.trigger("refresh"),this.setup(),this.optionsLogic(),this.$element.addClass(this.options.refreshClass),this.update(),this.$element.removeClass(this.options.refreshClass),this.leave("refreshing"),this.trigger("refreshed")},e.prototype.onThrottledResize=function(){b.clearTimeout(this.resizeTimer),this.resizeTimer=b.setTimeout(this._handlers.onResize,this.settings.responsiveRefreshRate)},e.prototype.onResize=function(){return!!this._items.length&&(this._width!==this.$element.width()&&(!!this.isVisible()&&(this.enter("resizing"),this.trigger("resize").isDefaultPrevented()?(this.leave("resizing"),!1):(this.invalidate("width"),this.refresh(),this.leave("resizing"),void this.trigger("resized")))))},e.prototype.registerEventHandlers=function(){a.support.transition&&this.$stage.on(a.support.transition.end+".owl.core",a.proxy(this.onTransitionEnd,this)),!1!==this.settings.responsive&&this.on(b,"resize",this._handlers.onThrottledResize),this.settings.mouseDrag&&(this.$element.addClass(this.options.dragClass),this.$stage.on("mousedown.owl.core",a.proxy(this.onDragStart,this)),this.$stage.on("dragstart.owl.core selectstart.owl.core",function(){return!1})),this.settings.touchDrag&&(this.$stage.on("touchstart.owl.core",a.proxy(this.onDragStart,this)),this.$stage.on("touchcancel.owl.core",a.proxy(this.onDragEnd,this)))},e.prototype.onDragStart=function(b){var d=null;3!==b.which&&(a.support.transform?(d=this.$stage.css("transform").replace(/.*\(|\)| /g,"").split(","),d={x:d[16===d.length?12:4],y:d[16===d.length?13:5]}):(d=this.$stage.position(),d={x:this.settings.rtl?d.left+this.$stage.width()-this.width()+this.settings.margin:d.left,y:d.top}),this.is("animating")&&(a.support.transform?this.animate(d.x):this.$stage.stop(),this.invalidate("position")),this.$element.toggleClass(this.options.grabClass,"mousedown"===b.type),this.speed(0),this._drag.time=(new Date).getTime(),this._drag.target=a(b.target),this._drag.stage.start=d,this._drag.stage.current=d,this._drag.pointer=this.pointer(b),a(c).on("mouseup.owl.core touchend.owl.core",a.proxy(this.onDragEnd,this)),a(c).one("mousemove.owl.core touchmove.owl.core",a.proxy(function(b){var d=this.difference(this._drag.pointer,this.pointer(b));a(c).on("mousemove.owl.core touchmove.owl.core",a.proxy(this.onDragMove,this)),Math.abs(d.x)<Math.abs(d.y)&&this.is("valid")||(b.preventDefault(),this.enter("dragging"),this.trigger("drag"))},this)))},e.prototype.onDragMove=function(a){var b=null,c=null,d=null,e=this.difference(this._drag.pointer,this.pointer(a)),f=this.difference(this._drag.stage.start,e);this.is("dragging")&&(a.preventDefault(),this.settings.loop?(b=this.coordinates(this.minimum()),c=this.coordinates(this.maximum()+1)-b,f.x=((f.x-b)%c+c)%c+b):(b=this.settings.rtl?this.coordinates(this.maximum()):this.coordinates(this.minimum()),c=this.settings.rtl?this.coordinates(this.minimum()):this.coordinates(this.maximum()),d=this.settings.pullDrag?-1*e.x/5:0,f.x=Math.max(Math.min(f.x,b+d),c+d)),this._drag.stage.current=f,this.animate(f.x))},e.prototype.onDragEnd=function(b){var d=this.difference(this._drag.pointer,this.pointer(b)),e=this._drag.stage.current,f=d.x>0^this.settings.rtl?"left":"right";a(c).off(".owl.core"),this.$element.removeClass(this.options.grabClass),(0!==d.x&&this.is("dragging")||!this.is("valid"))&&(this.speed(this.settings.dragEndSpeed||this.settings.smartSpeed),this.current(this.closest(e.x,0!==d.x?f:this._drag.direction)),this.invalidate("position"),this.update(),this._drag.direction=f,(Math.abs(d.x)>3||(new Date).getTime()-this._drag.time>300)&&this._drag.target.one("click.owl.core",function(){return!1})),this.is("dragging")&&(this.leave("dragging"),this.trigger("dragged"))},e.prototype.closest=function(b,c){var e=-1,f=30,g=this.width(),h=this.coordinates();return this.settings.freeDrag||a.each(h,a.proxy(function(a,i){return"left"===c&&b>i-f&&b<i+f?e=a:"right"===c&&b>i-g-f&&b<i-g+f?e=a+1:this.op(b,"<",i)&&this.op(b,">",h[a+1]!==d?h[a+1]:i-g)&&(e="left"===c?a+1:a),-1===e},this)),this.settings.loop||(this.op(b,">",h[this.minimum()])?e=b=this.minimum():this.op(b,"<",h[this.maximum()])&&(e=b=this.maximum())),e},e.prototype.animate=function(b){var c=this.speed()>0;this.is("animating")&&this.onTransitionEnd(),c&&(this.enter("animating"),this.trigger("translate")),a.support.transform3d&&a.support.transition?this.$stage.css({transform:"translate3d("+b+"px,0px,0px)",transition:this.speed()/1e3+"s"+(this.settings.slideTransition?" "+this.settings.slideTransition:"")}):c?this.$stage.animate({left:b+"px"},this.speed(),this.settings.fallbackEasing,a.proxy(this.onTransitionEnd,this)):this.$stage.css({left:b+"px"})},e.prototype.is=function(a){return this._states.current[a]&&this._states.current[a]>0},e.prototype.current=function(a){if(a===d)return this._current;if(0===this._items.length)return d;if(a=this.normalize(a),this._current!==a){var b=this.trigger("change",{property:{name:"position",value:a}});b.data!==d&&(a=this.normalize(b.data)),this._current=a,this.invalidate("position"),this.trigger("changed",{property:{name:"position",value:this._current}})}return this._current},e.prototype.invalidate=function(b){return"string"===a.type(b)&&(this._invalidated[b]=!0,this.is("valid")&&this.leave("valid")),a.map(this._invalidated,function(a,b){return b})},e.prototype.reset=function(a){(a=this.normalize(a))!==d&&(this._speed=0,this._current=a,this.suppress(["translate","translated"]),this.animate(this.coordinates(a)),this.release(["translate","translated"]))},e.prototype.normalize=function(a,b){var c=this._items.length,e=b?0:this._clones.length;return!this.isNumeric(a)||c<1?a=d:(a<0||a>=c+e)&&(a=((a-e/2)%c+c)%c+e/2),a},e.prototype.relative=function(a){return a-=this._clones.length/2,this.normalize(a,!0)},e.prototype.maximum=function(a){var b,c,d,e=this.settings,f=this._coordinates.length;if(e.loop)f=this._clones.length/2+this._items.length-1;else if(e.autoWidth||e.merge){if(b=this._items.length)for(c=this._items[--b].width(),d=this.$element.width();b--&&!((c+=this._items[b].width()+this.settings.margin)>d););f=b+1}else f=e.center?this._items.length-1:this._items.length-e.items;return a&&(f-=this._clones.length/2),Math.max(f,0)},e.prototype.minimum=function(a){return a?0:this._clones.length/2},e.prototype.items=function(a){return a===d?this._items.slice():(a=this.normalize(a,!0),this._items[a])},e.prototype.mergers=function(a){return a===d?this._mergers.slice():(a=this.normalize(a,!0),this._mergers[a])},e.prototype.clones=function(b){var c=this._clones.length/2,e=c+this._items.length,f=function(a){return a%2==0?e+a/2:c-(a+1)/2};return b===d?a.map(this._clones,function(a,b){return f(b)}):a.map(this._clones,function(a,c){return a===b?f(c):null})},e.prototype.speed=function(a){return a!==d&&(this._speed=a),this._speed},e.prototype.coordinates=function(b){var c,e=1,f=b-1;return b===d?a.map(this._coordinates,a.proxy(function(a,b){return this.coordinates(b)},this)):(this.settings.center?(this.settings.rtl&&(e=-1,f=b+1),c=this._coordinates[b],c+=(this.width()-c+(this._coordinates[f]||0))/2*e):c=this._coordinates[f]||0,c=Math.ceil(c))},e.prototype.duration=function(a,b,c){return 0===c?0:Math.min(Math.max(Math.abs(b-a),1),6)*Math.abs(c||this.settings.smartSpeed)},e.prototype.to=function(a,b){var c=this.current(),d=null,e=a-this.relative(c),f=(e>0)-(e<0),g=this._items.length,h=this.minimum(),i=this.maximum();this.settings.loop?(!this.settings.rewind&&Math.abs(e)>g/2&&(e+=-1*f*g),a=c+e,(d=((a-h)%g+g)%g+h)!==a&&d-e<=i&&d-e>0&&(c=d-e,a=d,this.reset(c))):this.settings.rewind?(i+=1,a=(a%i+i)%i):a=Math.max(h,Math.min(i,a)),this.speed(this.duration(c,a,b)),this.current(a),this.isVisible()&&this.update()},e.prototype.next=function(a){a=a||!1,this.to(this.relative(this.current())+1,a)},e.prototype.prev=function(a){a=a||!1,this.to(this.relative(this.current())-1,a)},e.prototype.onTransitionEnd=function(a){if(a!==d&&(a.stopPropagation(),(a.target||a.srcElement||a.originalTarget)!==this.$stage.get(0)))return!1;this.leave("animating"),this.trigger("translated")},e.prototype.viewport=function(){var d;return this.options.responsiveBaseElement!==b?d=a(this.options.responsiveBaseElement).width():b.innerWidth?d=b.innerWidth:c.documentElement&&c.documentElement.clientWidth?d=c.documentElement.clientWidth:console.warn("Can not detect viewport width."),d},e.prototype.replace=function(b){this.$stage.empty(),this._items=[],b&&(b=b instanceof jQuery?b:a(b)),this.settings.nestedItemSelector&&(b=b.find("."+this.settings.nestedItemSelector)),b.filter(function(){return 1===this.nodeType}).each(a.proxy(function(a,b){b=this.prepare(b),this.$stage.append(b),this._items.push(b),this._mergers.push(1*b.find("[data-merge]").addBack("[data-merge]").attr("data-merge")||1)},this)),this.reset(this.isNumeric(this.settings.startPosition)?this.settings.startPosition:0),this.invalidate("items")},e.prototype.add=function(b,c){var e=this.relative(this._current);c=c===d?this._items.length:this.normalize(c,!0),b=b instanceof jQuery?b:a(b),this.trigger("add",{content:b,position:c}),b=this.prepare(b),0===this._items.length||c===this._items.length?(0===this._items.length&&this.$stage.append(b),0!==this._items.length&&this._items[c-1].after(b),this._items.push(b),this._mergers.push(1*b.find("[data-merge]").addBack("[data-merge]").attr("data-merge")||1)):(this._items[c].before(b),this._items.splice(c,0,b),this._mergers.splice(c,0,1*b.find("[data-merge]").addBack("[data-merge]").attr("data-merge")||1)),this._items[e]&&this.reset(this._items[e].index()),this.invalidate("items"),this.trigger("added",{content:b,position:c})},e.prototype.remove=function(a){(a=this.normalize(a,!0))!==d&&(this.trigger("remove",{content:this._items[a],position:a}),this._items[a].remove(),this._items.splice(a,1),this._mergers.splice(a,1),this.invalidate("items"),this.trigger("removed",{content:null,position:a}))},e.prototype.preloadAutoWidthImages=function(b){b.each(a.proxy(function(b,c){this.enter("pre-loading"),c=a(c),a(new Image).one("load",a.proxy(function(a){c.attr("src",a.target.src),c.css("opacity",1),this.leave("pre-loading"),!this.is("pre-loading")&&!this.is("initializing")&&this.refresh()},this)).attr("src",c.attr("src")||c.attr("data-src")||c.attr("data-src-retina"))},this))},e.prototype.destroy=function(){this.$element.off(".owl.core"),this.$stage.off(".owl.core"),a(c).off(".owl.core"),!1!==this.settings.responsive&&(b.clearTimeout(this.resizeTimer),this.off(b,"resize",this._handlers.onThrottledResize));for(var d in this._plugins)this._plugins[d].destroy();this.$stage.children(".cloned").remove(),this.$stage.unwrap(),this.$stage.children().contents().unwrap(),this.$stage.children().unwrap(),this.$stage.remove(),this.$element.removeClass(this.options.refreshClass).removeClass(this.options.loadingClass).removeClass(this.options.loadedClass).removeClass(this.options.rtlClass).removeClass(this.options.dragClass).removeClass(this.options.grabClass).attr("class",this.$element.attr("class").replace(new RegExp(this.options.responsiveClass+"-\\S+\\s","g"),"")).removeData("owl.carousel")},e.prototype.op=function(a,b,c){var d=this.settings.rtl;switch(b){case"<":return d?a>c:a<c;case">":return d?a<c:a>c;case">=":return d?a<=c:a>=c;case"<=":return d?a>=c:a<=c}},e.prototype.on=function(a,b,c,d){a.addEventListener?a.addEventListener(b,c,d):a.attachEvent&&a.attachEvent("on"+b,c)},e.prototype.off=function(a,b,c,d){a.removeEventListener?a.removeEventListener(b,c,d):a.detachEvent&&a.detachEvent("on"+b,c)},e.prototype.trigger=function(b,c,d,f,g){var h={item:{count:this._items.length,index:this.current()}},i=a.camelCase(a.grep(["on",b,d],function(a){return a}).join("-").toLowerCase()),j=a.Event([b,"owl",d||"carousel"].join(".").toLowerCase(),a.extend({relatedTarget:this},h,c));return this._supress[b]||(a.each(this._plugins,function(a,b){b.onTrigger&&b.onTrigger(j)}),this.register({type:e.Type.Event,name:b}),this.$element.trigger(j),this.settings&&"function"==typeof this.settings[i]&&this.settings[i].call(this,j)),j},e.prototype.enter=function(b){a.each([b].concat(this._states.tags[b]||[]),a.proxy(function(a,b){this._states.current[b]===d&&(this._states.current[b]=0),this._states.current[b]++},this))},e.prototype.leave=function(b){a.each([b].concat(this._states.tags[b]||[]),a.proxy(function(a,b){this._states.current[b]--},this))},e.prototype.register=function(b){if(b.type===e.Type.Event){if(a.event.special[b.name]||(a.event.special[b.name]={}),!a.event.special[b.name].owl){var c=a.event.special[b.name]._default;a.event.special[b.name]._default=function(a){return!c||!c.apply||a.namespace&&-1!==a.namespace.indexOf("owl")?a.namespace&&a.namespace.indexOf("owl")>-1:c.apply(this,arguments)},a.event.special[b.name].owl=!0}}else b.type===e.Type.State&&(this._states.tags[b.name]?this._states.tags[b.name]=this._states.tags[b.name].concat(b.tags):this._states.tags[b.name]=b.tags,this._states.tags[b.name]=a.grep(this._states.tags[b.name],a.proxy(function(c,d){return a.inArray(c,this._states.tags[b.name])===d},this)))},e.prototype.suppress=function(b){a.each(b,a.proxy(function(a,b){this._supress[b]=!0},this))},e.prototype.release=function(b){a.each(b,a.proxy(function(a,b){delete this._supress[b]},this))},e.prototype.pointer=function(a){var c={x:null,y:null};return a=a.originalEvent||a||b.event,a=a.touches&&a.touches.length?a.touches[0]:a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:a,a.pageX?(c.x=a.pageX,c.y=a.pageY):(c.x=a.clientX,c.y=a.clientY),c},e.prototype.isNumeric=function(a){return!isNaN(parseFloat(a))},e.prototype.difference=function(a,b){return{x:a.x-b.x,y:a.y-b.y}},a.fn.owlCarousel=function(b){var c=Array.prototype.slice.call(arguments,1);return this.each(function(){var d=a(this),f=d.data("owl.carousel");f||(f=new e(this,"object"==typeof b&&b),d.data("owl.carousel",f),a.each(["next","prev","to","destroy","refresh","replace","add","remove"],function(b,c){f.register({type:e.Type.Event,name:c}),f.$element.on(c+".owl.carousel.core",a.proxy(function(a){a.namespace&&a.relatedTarget!==this&&(this.suppress([c]),f[c].apply(this,[].slice.call(arguments,1)),this.release([c]))},f))})),"string"==typeof b&&"_"!==b.charAt(0)&&f[b].apply(f,c)})},a.fn.owlCarousel.Constructor=e}(window.Zepto||window.jQuery,window,document),function(a,b,c,d){var e=function(b){this._core=b,this._interval=null,this._visible=null,this._handlers={"initialized.owl.carousel":a.proxy(function(a){a.namespace&&this._core.settings.autoRefresh&&this.watch()},this)},this._core.options=a.extend({},e.Defaults,this._core.options),this._core.$element.on(this._handlers)};e.Defaults={autoRefresh:!0,autoRefreshInterval:500},e.prototype.watch=function(){this._interval||(this._visible=this._core.isVisible(),this._interval=b.setInterval(a.proxy(this.refresh,this),this._core.settings.autoRefreshInterval))},e.prototype.refresh=function(){this._core.isVisible()!==this._visible&&(this._visible=!this._visible,this._core.$element.toggleClass("owl-hidden",!this._visible),this._visible&&this._core.invalidate("width")&&this._core.refresh())},e.prototype.destroy=function(){var a,c;b.clearInterval(this._interval);for(a in this._handlers)this._core.$element.off(a,this._handlers[a]);for(c in Object.getOwnPropertyNames(this))"function"!=typeof this[c]&&(this[c]=null)},a.fn.owlCarousel.Constructor.Plugins.AutoRefresh=e}(window.Zepto||window.jQuery,window,document),function(a,b,c,d){var e=function(b){this._core=b,this._loaded=[],this._handlers={"initialized.owl.carousel change.owl.carousel resized.owl.carousel":a.proxy(function(b){if(b.namespace&&this._core.settings&&this._core.settings.lazyLoad&&(b.property&&"position"==b.property.name||"initialized"==b.type)){var c=this._core.settings,e=c.center&&Math.ceil(c.items/2)||c.items,f=c.center&&-1*e||0,g=(b.property&&b.property.value!==d?b.property.value:this._core.current())+f,h=this._core.clones().length,i=a.proxy(function(a,b){this.load(b)},this);for(c.lazyLoadEager>0&&(e+=c.lazyLoadEager,c.loop&&(g-=c.lazyLoadEager,e++));f++<e;)this.load(h/2+this._core.relative(g)),h&&a.each(this._core.clones(this._core.relative(g)),i),g++}},this)},this._core.options=a.extend({},e.Defaults,this._core.options),this._core.$element.on(this._handlers)};e.Defaults={lazyLoad:!1,lazyLoadEager:0},e.prototype.load=function(c){var d=this._core.$stage.children().eq(c),e=d&&d.find(".owl-lazy");!e||a.inArray(d.get(0),this._loaded)>-1||(e.each(a.proxy(function(c,d){var e,f=a(d),g=b.devicePixelRatio>1&&f.attr("data-src-retina")||f.attr("data-src")||f.attr("data-srcset");this._core.trigger("load",{element:f,url:g},"lazy"),f.is("img")?f.one("load.owl.lazy",a.proxy(function(){f.css("opacity",1),this._core.trigger("loaded",{element:f,url:g},"lazy")},this)).attr("src",g):f.is("source")?f.one("load.owl.lazy",a.proxy(function(){this._core.trigger("loaded",{element:f,url:g},"lazy")},this)).attr("srcset",g):(e=new Image,e.onload=a.proxy(function(){f.css({"background-image":'url("'+g+'")',opacity:"1"}),this._core.trigger("loaded",{element:f,url:g},"lazy")},this),e.src=g)},this)),this._loaded.push(d.get(0)))},e.prototype.destroy=function(){var a,b;for(a in this.handlers)this._core.$element.off(a,this.handlers[a]);for(b in Object.getOwnPropertyNames(this))"function"!=typeof this[b]&&(this[b]=null)},a.fn.owlCarousel.Constructor.Plugins.Lazy=e}(window.Zepto||window.jQuery,window,document),function(a,b,c,d){var e=function(c){this._core=c,this._previousHeight=null,this._handlers={"initialized.owl.carousel refreshed.owl.carousel":a.proxy(function(a){a.namespace&&this._core.settings.autoHeight&&this.update()},this),"changed.owl.carousel":a.proxy(function(a){a.namespace&&this._core.settings.autoHeight&&"position"===a.property.name&&this.update()},this),"loaded.owl.lazy":a.proxy(function(a){a.namespace&&this._core.settings.autoHeight&&a.element.closest("."+this._core.settings.itemClass).index()===this._core.current()&&this.update()},this)},this._core.options=a.extend({},e.Defaults,this._core.options),this._core.$element.on(this._handlers),this._intervalId=null;var d=this;a(b).on("load",function(){d._core.settings.autoHeight&&d.update()}),a(b).resize(function(){d._core.settings.autoHeight&&(null!=d._intervalId&&clearTimeout(d._intervalId),d._intervalId=setTimeout(function(){d.update()},250))})};e.Defaults={autoHeight:!1,autoHeightClass:"owl-height"},e.prototype.update=function(){var b=this._core._current,c=b+this._core.settings.items,d=this._core.settings.lazyLoad,e=this._core.$stage.children().toArray().slice(b,c),f=[],g=0;a.each(e,function(b,c){f.push(a(c).height())}),g=Math.max.apply(null,f),g<=1&&d&&this._previousHeight&&(g=this._previousHeight),this._previousHeight=g,this._core.$stage.parent().height(g).addClass(this._core.settings.autoHeightClass)},e.prototype.destroy=function(){var a,b;for(a in this._handlers)this._core.$element.off(a,this._handlers[a]);for(b in Object.getOwnPropertyNames(this))"function"!=typeof this[b]&&(this[b]=null)},a.fn.owlCarousel.Constructor.Plugins.AutoHeight=e}(window.Zepto||window.jQuery,window,document),function(a,b,c,d){var e=function(b){this._core=b,this._videos={},this._playing=null,this._handlers={"initialized.owl.carousel":a.proxy(function(a){a.namespace&&this._core.register({type:"state",name:"playing",tags:["interacting"]})},this),"resize.owl.carousel":a.proxy(function(a){a.namespace&&this._core.settings.video&&this.isInFullScreen()&&a.preventDefault()},this),"refreshed.owl.carousel":a.proxy(function(a){a.namespace&&this._core.is("resizing")&&this._core.$stage.find(".cloned .owl-video-frame").remove()},this),"changed.owl.carousel":a.proxy(function(a){a.namespace&&"position"===a.property.name&&this._playing&&this.stop()},this),"prepared.owl.carousel":a.proxy(function(b){if(b.namespace){var c=a(b.content).find(".owl-video");c.length&&(c.css("display","none"),this.fetch(c,a(b.content)))}},this)},this._core.options=a.extend({},e.Defaults,this._core.options),this._core.$element.on(this._handlers),this._core.$element.on("click.owl.video",".owl-video-play-icon",a.proxy(function(a){this.play(a)},this))};e.Defaults={video:!1,videoHeight:!1,videoWidth:!1},e.prototype.fetch=function(a,b){var c=function(){return a.attr("data-vimeo-id")?"vimeo":a.attr("data-vzaar-id")?"vzaar":"youtube"}(),d=a.attr("data-vimeo-id")||a.attr("data-youtube-id")||a.attr("data-vzaar-id"),e=a.attr("data-width")||this._core.settings.videoWidth,f=a.attr("data-height")||this._core.settings.videoHeight,g=a.attr("href");if(!g)throw new Error("Missing video URL.");if(d=g.match(/(http:|https:|)\/\/(player.|www.|app.)?(vimeo\.com|youtu(be\.com|\.be|be\.googleapis\.com|be\-nocookie\.com)|vzaar\.com)\/(video\/|videos\/|embed\/|channels\/.+\/|groups\/.+\/|watch\?v=|v\/)?([A-Za-z0-9._%-]*)(\&\S+)?/),d[3].indexOf("youtu")>-1)c="youtube";else if(d[3].indexOf("vimeo")>-1)c="vimeo";else{if(!(d[3].indexOf("vzaar")>-1))throw new Error("Video URL not supported.");c="vzaar"}d=d[6],this._videos[g]={type:c,id:d,width:e,height:f},b.attr("data-video",g),this.thumbnail(a,this._videos[g])},e.prototype.thumbnail=function(b,c){var d,e,f,g=c.width&&c.height?"width:"+c.width+"px;height:"+c.height+"px;":"",h=b.find("img"),i="src",j="",k=this._core.settings,l=function(c){e='<div class="owl-video-play-icon"></div>',d=k.lazyLoad?a("<div/>",{class:"owl-video-tn "+j,srcType:c}):a("<div/>",{class:"owl-video-tn",style:"opacity:1;background-image:url("+c+")"}),b.after(d),b.after(e)};if(b.wrap(a("<div/>",{class:"owl-video-wrapper",style:g})),this._core.settings.lazyLoad&&(i="data-src",j="owl-lazy"),h.length)return l(h.attr(i)),h.remove(),!1;"youtube"===c.type?(f="//img.youtube.com/vi/"+c.id+"/hqdefault.jpg",l(f)):"vimeo"===c.type?a.ajax({type:"GET",url:"//vimeo.com/api/v2/video/"+c.id+".json",jsonp:"callback",dataType:"jsonp",success:function(a){f=a[0].thumbnail_large,l(f)}}):"vzaar"===c.type&&a.ajax({type:"GET",url:"//vzaar.com/api/videos/"+c.id+".json",jsonp:"callback",dataType:"jsonp",success:function(a){f=a.framegrab_url,l(f)}})},e.prototype.stop=function(){this._core.trigger("stop",null,"video"),this._playing.find(".owl-video-frame").remove(),this._playing.removeClass("owl-video-playing"),this._playing=null,this._core.leave("playing"),this._core.trigger("stopped",null,"video")},e.prototype.play=function(b){var c,d=a(b.target),e=d.closest("."+this._core.settings.itemClass),f=this._videos[e.attr("data-video")],g=f.width||"100%",h=f.height||this._core.$stage.height();this._playing||(this._core.enter("playing"),this._core.trigger("play",null,"video"),e=this._core.items(this._core.relative(e.index())),this._core.reset(e.index()),c=a('<iframe frameborder="0" allowfullscreen mozallowfullscreen webkitAllowFullScreen ></iframe>'),c.attr("height",h),c.attr("width",g),"youtube"===f.type?c.attr("src","//www.youtube.com/embed/"+f.id+"?autoplay=1&rel=0&v="+f.id):"vimeo"===f.type?c.attr("src","//player.vimeo.com/video/"+f.id+"?autoplay=1"):"vzaar"===f.type&&c.attr("src","//view.vzaar.com/"+f.id+"/player?autoplay=true"),a(c).wrap('<div class="owl-video-frame" />').insertAfter(e.find(".owl-video")),this._playing=e.addClass("owl-video-playing"))},e.prototype.isInFullScreen=function(){var b=c.fullscreenElement||c.mozFullScreenElement||c.webkitFullscreenElement;return b&&a(b).parent().hasClass("owl-video-frame")},e.prototype.destroy=function(){var a,b;this._core.$element.off("click.owl.video");for(a in this._handlers)this._core.$element.off(a,this._handlers[a]);for(b in Object.getOwnPropertyNames(this))"function"!=typeof this[b]&&(this[b]=null)},a.fn.owlCarousel.Constructor.Plugins.Video=e}(window.Zepto||window.jQuery,window,document),function(a,b,c,d){var e=function(b){this.core=b,this.core.options=a.extend({},e.Defaults,this.core.options),this.swapping=!0,this.previous=d,this.next=d,this.handlers={"change.owl.carousel":a.proxy(function(a){a.namespace&&"position"==a.property.name&&(this.previous=this.core.current(),this.next=a.property.value)},this),"drag.owl.carousel dragged.owl.carousel translated.owl.carousel":a.proxy(function(a){a.namespace&&(this.swapping="translated"==a.type)},this),"translate.owl.carousel":a.proxy(function(a){a.namespace&&this.swapping&&(this.core.options.animateOut||this.core.options.animateIn)&&this.swap()},this)},this.core.$element.on(this.handlers)};e.Defaults={animateOut:!1,animateIn:!1},e.prototype.swap=function(){if(1===this.core.settings.items&&a.support.animation&&a.support.transition){this.core.speed(0);var b,c=a.proxy(this.clear,this),d=this.core.$stage.children().eq(this.previous),e=this.core.$stage.children().eq(this.next),f=this.core.settings.animateIn,g=this.core.settings.animateOut;this.core.current()!==this.previous&&(g&&(b=this.core.coordinates(this.previous)-this.core.coordinates(this.next),d.one(a.support.animation.end,c).css({left:b+"px"}).addClass("animated owl-animated-out").addClass(g)),f&&e.one(a.support.animation.end,c).addClass("animated owl-animated-in").addClass(f))}},e.prototype.clear=function(b){a(b.target).css({left:""}).removeClass("animated owl-animated-out owl-animated-in").removeClass(this.core.settings.animateIn).removeClass(this.core.settings.animateOut),this.core.onTransitionEnd()},e.prototype.destroy=function(){var a,b;for(a in this.handlers)this.core.$element.off(a,this.handlers[a]);for(b in Object.getOwnPropertyNames(this))"function"!=typeof this[b]&&(this[b]=null)},a.fn.owlCarousel.Constructor.Plugins.Animate=e}(window.Zepto||window.jQuery,window,document),function(a,b,c,d){var e=function(b){this._core=b,this._call=null,this._time=0,this._timeout=0,this._paused=!0,this._handlers={"changed.owl.carousel":a.proxy(function(a){a.namespace&&"settings"===a.property.name?this._core.settings.autoplay?this.play():this.stop():a.namespace&&"position"===a.property.name&&this._paused&&(this._time=0)},this),"initialized.owl.carousel":a.proxy(function(a){a.namespace&&this._core.settings.autoplay&&this.play()},this),"play.owl.autoplay":a.proxy(function(a,b,c){a.namespace&&this.play(b,c)},this),"stop.owl.autoplay":a.proxy(function(a){a.namespace&&this.stop()},this),"mouseover.owl.autoplay":a.proxy(function(){this._core.settings.autoplayHoverPause&&this._core.is("rotating")&&this.pause()},this),"mouseleave.owl.autoplay":a.proxy(function(){this._core.settings.autoplayHoverPause&&this._core.is("rotating")&&this.play()},this),"touchstart.owl.core":a.proxy(function(){this._core.settings.autoplayHoverPause&&this._core.is("rotating")&&this.pause()},this),"touchend.owl.core":a.proxy(function(){this._core.settings.autoplayHoverPause&&this.play()},this)},this._core.$element.on(this._handlers),this._core.options=a.extend({},e.Defaults,this._core.options)};e.Defaults={autoplay:!1,autoplayTimeout:5e3,autoplayHoverPause:!1,autoplaySpeed:!1},e.prototype._next=function(d){this._call=b.setTimeout(a.proxy(this._next,this,d),this._timeout*(Math.round(this.read()/this._timeout)+1)-this.read()),this._core.is("interacting")||c.hidden||this._core.next(d||this._core.settings.autoplaySpeed)},e.prototype.read=function(){return(new Date).getTime()-this._time},e.prototype.play=function(c,d){var e;this._core.is("rotating")||this._core.enter("rotating"),c=c||this._core.settings.autoplayTimeout,e=Math.min(this._time%(this._timeout||c),c),this._paused?(this._time=this.read(),this._paused=!1):b.clearTimeout(this._call),this._time+=this.read()%c-e,this._timeout=c,this._call=b.setTimeout(a.proxy(this._next,this,d),c-e)},e.prototype.stop=function(){this._core.is("rotating")&&(this._time=0,this._paused=!0,b.clearTimeout(this._call),this._core.leave("rotating"))},e.prototype.pause=function(){this._core.is("rotating")&&!this._paused&&(this._time=this.read(),this._paused=!0,b.clearTimeout(this._call))},e.prototype.destroy=function(){var a,b;this.stop();for(a in this._handlers)this._core.$element.off(a,this._handlers[a]);for(b in Object.getOwnPropertyNames(this))"function"!=typeof this[b]&&(this[b]=null)},a.fn.owlCarousel.Constructor.Plugins.autoplay=e}(window.Zepto||window.jQuery,window,document),function(a,b,c,d){"use strict";var e=function(b){this._core=b,this._initialized=!1,this._pages=[],this._controls={},this._templates=[],this.$element=this._core.$element,this._overrides={next:this._core.next,prev:this._core.prev,to:this._core.to},this._handlers={"prepared.owl.carousel":a.proxy(function(b){b.namespace&&this._core.settings.dotsData&&this._templates.push('<div class="'+this._core.settings.dotClass+'">'+a(b.content).find("[data-dot]").addBack("[data-dot]").attr("data-dot")+"</div>")},this),"added.owl.carousel":a.proxy(function(a){a.namespace&&this._core.settings.dotsData&&this._templates.splice(a.position,0,this._templates.pop())},this),"remove.owl.carousel":a.proxy(function(a){a.namespace&&this._core.settings.dotsData&&this._templates.splice(a.position,1)},this),"changed.owl.carousel":a.proxy(function(a){a.namespace&&"position"==a.property.name&&this.draw()},this),"initialized.owl.carousel":a.proxy(function(a){a.namespace&&!this._initialized&&(this._core.trigger("initialize",null,"navigation"),this.initialize(),this.update(),this.draw(),this._initialized=!0,this._core.trigger("initialized",null,"navigation"))},this),"refreshed.owl.carousel":a.proxy(function(a){a.namespace&&this._initialized&&(this._core.trigger("refresh",null,"navigation"),this.update(),this.draw(),this._core.trigger("refreshed",null,"navigation"))},this)},this._core.options=a.extend({},e.Defaults,this._core.options),this.$element.on(this._handlers)};e.Defaults={nav:!1,navText:['<span aria-label="Previous">&#x2039;</span>','<span aria-label="Next">&#x203a;</span>'],navSpeed:!1,navElement:'button type="button" role="presentation"',navContainer:!1,navContainerClass:"owl-nav",navClass:["owl-prev","owl-next"],slideBy:1,dotClass:"owl-dot",dotsClass:"owl-dots",dots:!0,dotsEach:!1,dotsData:!1,dotsSpeed:!1,dotsContainer:!1},e.prototype.initialize=function(){var b,c=this._core.settings;this._controls.$relative=(c.navContainer?a(c.navContainer):a("<div>").addClass(c.navContainerClass).appendTo(this.$element)).addClass("disabled"),this._controls.$previous=a("<"+c.navElement+">").addClass(c.navClass[0]).html(c.navText[0]).prependTo(this._controls.$relative).on("click",a.proxy(function(a){this.prev(c.navSpeed)},this)),this._controls.$next=a("<"+c.navElement+">").addClass(c.navClass[1]).html(c.navText[1]).appendTo(this._controls.$relative).on("click",a.proxy(function(a){this.next(c.navSpeed)},this)),c.dotsData||(this._templates=[a('<button role="button">').addClass(c.dotClass).append(a("<span>")).prop("outerHTML")]),this._controls.$absolute=(c.dotsContainer?a(c.dotsContainer):a("<div>").addClass(c.dotsClass).appendTo(this.$element)).addClass("disabled"),this._controls.$absolute.on("click","button",a.proxy(function(b){var d=a(b.target).parent().is(this._controls.$absolute)?a(b.target).index():a(b.target).parent().index();b.preventDefault(),this.to(d,c.dotsSpeed)},this));for(b in this._overrides)this._core[b]=a.proxy(this[b],this)},e.prototype.destroy=function(){var a,b,c,d,e;e=this._core.settings;for(a in this._handlers)this.$element.off(a,this._handlers[a]);for(b in this._controls)"$relative"===b&&e.navContainer?this._controls[b].html(""):this._controls[b].remove();for(d in this.overides)this._core[d]=this._overrides[d];for(c in Object.getOwnPropertyNames(this))"function"!=typeof this[c]&&(this[c]=null)},e.prototype.update=function(){var a,b,c,d=this._core.clones().length/2,e=d+this._core.items().length,f=this._core.maximum(!0),g=this._core.settings,h=g.center||g.autoWidth||g.dotsData?1:g.dotsEach||g.items;if("page"!==g.slideBy&&(g.slideBy=Math.min(g.slideBy,g.items)),g.dots||"page"==g.slideBy)for(this._pages=[],a=d,b=0,c=0;a<e;a++){if(b>=h||0===b){if(this._pages.push({start:Math.min(f,a-d),end:a-d+h-1}),Math.min(f,a-d)===f)break;b=0,++c}b+=this._core.mergers(this._core.relative(a))}},e.prototype.draw=function(){var b,c=this._core.settings,d=this._core.items().length<=c.items,e=this._core.relative(this._core.current()),f=c.loop||c.rewind;this._controls.$relative.toggleClass("disabled",!c.nav||d),c.nav&&(this._controls.$previous.toggleClass("disabled",!f&&e<=this._core.minimum(!0)),this._controls.$next.toggleClass("disabled",!f&&e>=this._core.maximum(!0))),this._controls.$absolute.toggleClass("disabled",!c.dots||d),c.dots&&(b=this._pages.length-this._controls.$absolute.children().length,c.dotsData&&0!==b?this._controls.$absolute.html(this._templates.join("")):b>0?this._controls.$absolute.append(new Array(b+1).join(this._templates[0])):b<0&&this._controls.$absolute.children().slice(b).remove(),this._controls.$absolute.find(".active").removeClass("active"),this._controls.$absolute.children().eq(a.inArray(this.current(),this._pages)).addClass("active"))},e.prototype.onTrigger=function(b){var c=this._core.settings;b.page={index:a.inArray(this.current(),this._pages),count:this._pages.length,size:c&&(c.center||c.autoWidth||c.dotsData?1:c.dotsEach||c.items)}},e.prototype.current=function(){var b=this._core.relative(this._core.current());return a.grep(this._pages,a.proxy(function(a,c){return a.start<=b&&a.end>=b},this)).pop()},e.prototype.getPosition=function(b){var c,d,e=this._core.settings;return"page"==e.slideBy?(c=a.inArray(this.current(),this._pages),d=this._pages.length,b?++c:--c,c=this._pages[(c%d+d)%d].start):(c=this._core.relative(this._core.current()),d=this._core.items().length,b?c+=e.slideBy:c-=e.slideBy),c},e.prototype.next=function(b){a.proxy(this._overrides.to,this._core)(this.getPosition(!0),b)},e.prototype.prev=function(b){a.proxy(this._overrides.to,this._core)(this.getPosition(!1),b)},e.prototype.to=function(b,c,d){var e;!d&&this._pages.length?(e=this._pages.length,a.proxy(this._overrides.to,this._core)(this._pages[(b%e+e)%e].start,c)):a.proxy(this._overrides.to,this._core)(b,c)},a.fn.owlCarousel.Constructor.Plugins.Navigation=e}(window.Zepto||window.jQuery,window,document),function(a,b,c,d){"use strict";var e=function(c){this._core=c,this._hashes={},this.$element=this._core.$element,this._handlers={"initialized.owl.carousel":a.proxy(function(c){c.namespace&&"URLHash"===this._core.settings.startPosition&&a(b).trigger("hashchange.owl.navigation")},this),"prepared.owl.carousel":a.proxy(function(b){if(b.namespace){var c=a(b.content).find("[data-hash]").addBack("[data-hash]").attr("data-hash");if(!c)return;this._hashes[c]=b.content}},this),"changed.owl.carousel":a.proxy(function(c){if(c.namespace&&"position"===c.property.name){var d=this._core.items(this._core.relative(this._core.current())),e=a.map(this._hashes,function(a,b){return a===d?b:null}).join();if(!e||b.location.hash.slice(1)===e)return;b.location.hash=e}},this)},this._core.options=a.extend({},e.Defaults,this._core.options),this.$element.on(this._handlers),a(b).on("hashchange.owl.navigation",a.proxy(function(a){var c=b.location.hash.substring(1),e=this._core.$stage.children(),f=this._hashes[c]&&e.index(this._hashes[c]);f!==d&&f!==this._core.current()&&this._core.to(this._core.relative(f),!1,!0)},this))};e.Defaults={URLhashListener:!1},e.prototype.destroy=function(){var c,d;a(b).off("hashchange.owl.navigation");for(c in this._handlers)this._core.$element.off(c,this._handlers[c]);for(d in Object.getOwnPropertyNames(this))"function"!=typeof this[d]&&(this[d]=null)},a.fn.owlCarousel.Constructor.Plugins.Hash=e}(window.Zepto||window.jQuery,window,document),function(a,b,c,d){function e(b,c){var e=!1,f=b.charAt(0).toUpperCase()+b.slice(1);return a.each((b+" "+h.join(f+" ")+f).split(" "),function(a,b){if(g[b]!==d)return e=!c||b,!1}),e}function f(a){return e(a,!0)}var g=a("<support>").get(0).style,h="Webkit Moz O ms".split(" "),i={transition:{end:{WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",transition:"transitionend"}},animation:{end:{WebkitAnimation:"webkitAnimationEnd",MozAnimation:"animationend",OAnimation:"oAnimationEnd",animation:"animationend"}}},j={csstransforms:function(){return!!e("transform")},csstransforms3d:function(){return!!e("perspective")},csstransitions:function(){return!!e("transition")},cssanimations:function(){return!!e("animation")}};j.csstransitions()&&(a.support.transition=new String(f("transition")),a.support.transition.end=i.transition.end[a.support.transition]),j.cssanimations()&&(a.support.animation=new String(f("animation")),a.support.animation.end=i.animation.end[a.support.animation]),j.csstransforms()&&(a.support.transform=new String(f("transform")),a.support.transform3d=j.csstransforms3d())}(window.Zepto||window.jQuery,window,document);;

/* /ks_dn_advance/static/lib/js/print.min.js defined in bundle 'web.assets_backend' */
!function(A,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(A="undefined"!=typeof globalThis?globalThis:A||self).html2canvas=e()}(this,function(){"use strict";var B=function(A,e){return(B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,e){A.__proto__=e}||function(A,e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(A[t]=e[t])})(A,e)};function A(A,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=A}B(A,e),A.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}var h=function(){return(h=Object.assign||function(A){for(var e,t=1,B=arguments.length;t<B;t++)for(var r in e=arguments[t])Object.prototype.hasOwnProperty.call(e,r)&&(A[r]=e[r]);return A}).apply(this,arguments)};function a(A,s,o,i){return new(o=o||Promise)(function(t,e){function B(A){try{n(i.next(A))}catch(A){e(A)}}function r(A){try{n(i.throw(A))}catch(A){e(A)}}function n(A){var e;A.done?t(A.value):((e=A.value)instanceof o?e:new o(function(A){A(e)})).then(B,r)}n((i=i.apply(A,s||[])).next())})}function H(t,B){var r,n,s,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},A={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(A[Symbol.iterator]=function(){return this}),A;function e(e){return function(A){return function(e){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(s=2&e[0]?n.return:e[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,e[1])).done)return s;switch(n=0,(e=s?[2&e[0],s.value]:e)[0]){case 0:case 1:s=e;break;case 4:return o.label++,{value:e[1],done:!1};case 5:o.label++,n=e[1],e=[0];continue;case 7:e=o.ops.pop(),o.trys.pop();continue;default:if(!(s=0<(s=o.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){o=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){o.label=e[1];break}if(6===e[0]&&o.label<s[1]){o.label=s[1],s=e;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(e);break}s[2]&&o.ops.pop(),o.trys.pop();continue}e=B.call(t,o)}catch(A){e=[6,A],n=0}finally{r=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,A])}}}function t(A,e,t){if(t||2===arguments.length)for(var B,r=0,n=e.length;r<n;r++)!B&&r in e||((B=B||Array.prototype.slice.call(e,0,r))[r]=e[r]);return A.concat(B||e)}var d=(r.prototype.add=function(A,e,t,B){return new r(this.left+A,this.top+e,this.width+t,this.height+B)},r.fromClientRect=function(A,e){return new r(e.left+A.windowBounds.left,e.top+A.windowBounds.top,e.width,e.height)},r.fromDOMRectList=function(A,e){e=e[0];return e?new r(e.x+A.windowBounds.left,e.y+A.windowBounds.top,e.width,e.height):r.EMPTY},r.EMPTY=new r(0,0,0,0),r);function r(A,e,t,B){this.left=A,this.top=e,this.width=t,this.height=B}for(var f=function(A,e){return d.fromClientRect(A,e.getBoundingClientRect())},Q=function(A){for(var e=[],t=0,B=A.length;t<B;){var r,n=A.charCodeAt(t++);55296<=n&&n<=56319&&t<B?56320==(64512&(r=A.charCodeAt(t++)))?e.push(((1023&n)<<10)+(1023&r)+65536):(e.push(n),t--):e.push(n)}return e},g=function(){for(var A=[],e=0;e<arguments.length;e++)A[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,A);var t=A.length;if(!t)return"";for(var B=[],r=-1,n="";++r<t;){var s=A[r];s<=65535?B.push(s):(s-=65536,B.push(55296+(s>>10),s%1024+56320)),(r+1===t||16384<B.length)&&(n+=String.fromCharCode.apply(String,B),B.length=0)}return n},e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c="undefined"==typeof Uint8Array?[]:new Uint8Array(256),n=0;n<e.length;n++)c[e.charCodeAt(n)]=n;function s(A,e,t){return A.slice?A.slice(e,t):new Uint16Array(Array.prototype.slice.call(A,e,t))}var o=(i.prototype.get=function(A){var e;if(0<=A){if(A<55296||56319<A&&A<=65535)return e=this.index[A>>5],this.data[e=(e<<2)+(31&A)];if(A<=65535)return e=this.index[2048+(A-55296>>5)],this.data[e=(e<<2)+(31&A)];if(A<this.highStart)return e=this.index[e=2080+(A>>11)],e=this.index[e+=A>>5&63],this.data[e=(e<<2)+(31&A)];if(A<=1114111)return this.data[this.highValueIndex]}return this.errorValue},i);function i(A,e,t,B,r,n){this.initialValue=A,this.errorValue=e,this.highStart=t,this.highValueIndex=B,this.index=r,this.data=n}function w(A,e,t,B){var r=B[t];if(Array.isArray(A)?-1!==A.indexOf(r):A===r)for(var n=t;n<=B.length;){if((o=B[++n])===e)return 1;if(o!==I)break}if(r===I)for(n=t;0<n;){var s=B[--n];if(Array.isArray(A)?-1!==A.indexOf(s):A===s)for(var o,i=t;i<=B.length;){if((o=B[++i])===e)return 1;if(o!==I)break}if(s!==I)break}}function U(A,e){for(var t=A;0<=t;){var B=e[t];if(B!==I)return B;t--}return 0}function C(t,A){var e=(r=function(A,B){void 0===B&&(B="strict");var r=[],n=[],s=[];return A.forEach(function(A,e){var t=j.get(A);if(50<t?(s.push(!0),t-=50):s.push(!1),-1!==["normal","auto","loose"].indexOf(B)&&-1!==[8208,8211,12316,12448].indexOf(A))return n.push(e),r.push(16);if(4!==t&&11!==t)return n.push(e),31===t?r.push("strict"===B?v:X):t===Z||29===t?r.push(V):43===t?131072<=A&&A<=196605||196608<=A&&A<=262141?r.push(X):r.push(V):void r.push(t);if(0===e)return n.push(e),r.push(V);t=r[e-1];return-1===tA.indexOf(t)?(n.push(n[e-1]),r.push(t)):(n.push(e),r.push(V))}),[n,r,s]}(t,(A=A||{lineBreak:"normal",wordBreak:"normal"}).lineBreak))[0],B=r[1],r=r[2];return[e,B="break-all"===A.wordBreak||"break-word"===A.wordBreak?B.map(function(A){return-1!==[S,V,Z].indexOf(A)?X:A}):B,"keep-all"===A.wordBreak?r.map(function(A,e){return A&&19968<=t[e]&&t[e]<=40959}):void 0]}var l,u,F,p,E,I=10,y=13,K=15,m=17,L=18,b=19,D=20,v=21,x=22,M=24,S=25,T=26,G=27,O=28,V=30,k=32,R=33,P=34,N=35,X=37,J=38,Y=39,W=40,Z=42,_=[9001,65288],q="×",j=(F=function(A){var e,t,B,r,n=.75*A.length,s=A.length,o=0;"="===A[A.length-1]&&(n--,"="===A[A.length-2]&&n--);for(var n=new("undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?ArrayBuffer:Array)(n),i=Array.isArray(n)?n:new Uint8Array(n),Q=0;Q<s;Q+=4)e=c[A.charCodeAt(Q)],t=c[A.charCodeAt(Q+1)],B=c[A.charCodeAt(Q+2)],r=c[A.charCodeAt(Q+3)],i[o++]=e<<2|t>>4,i[o++]=(15&t)<<4|B>>2,i[o++]=(3&B)<<6|63&r;return n}(l="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA=="),p=Array.isArray(F)?function(A){for(var e=A.length,t=[],B=0;B<e;B+=4)t.push(A[B+3]<<24|A[B+2]<<16|A[B+1]<<8|A[B]);return t}(F):new Uint32Array(F),E=Array.isArray(F)?function(A){for(var e=A.length,t=[],B=0;B<e;B+=2)t.push(A[B+1]<<8|A[B]);return t}(F):new Uint16Array(F),l=s(E,12,p[4]/2),u=2===p[5]?s(E,(24+p[4])/2):(F=p,E=Math.ceil((24+p[4])/4),F.slice?F.slice(E,u):new Uint32Array(Array.prototype.slice.call(F,E,u))),new o(p[0],p[1],p[2],p[3],l,u)),z=[V,36],$=[1,2,3,5],AA=[I,8],eA=[G,T],tA=$.concat(AA),BA=[J,Y,W,P,N],rA=[K,y],nA=(sA.prototype.slice=function(){return g.apply(void 0,this.codePoints.slice(this.start,this.end))},sA);function sA(A,e,t,B){this.codePoints=A,this.required="!"===e,this.start=t,this.end=B}function oA(A,e){var t=Q(A),B=(e=C(t,e))[0],r=e[1],n=e[2],s=t.length,o=0,i=0;return{next:function(){if(s<=i)return{done:!0,value:null};for(var A=q;i<s&&(A=function(A,e,t,B,r){if(0===t[B])return q;var n=B-1;if(Array.isArray(r)&&!0===r[n])return q;var s=n-1,o=1+n,i=e[n],B=0<=s?e[s]:0,r=e[o];if(2===i&&3===r)return q;if(-1!==$.indexOf(i))return"!";if(-1!==$.indexOf(r))return q;if(-1!==AA.indexOf(r))return q;if(8===U(n,e))return"÷";if(11===j.get(A[n]))return q;if((i===k||i===R)&&11===j.get(A[o]))return q;if(7===i||7===r)return q;if(9===i)return q;if(-1===[I,y,K].indexOf(i)&&9===r)return q;if(-1!==[m,L,b,M,O].indexOf(r))return q;if(U(n,e)===x)return q;if(w(23,x,n,e))return q;if(w([m,L],v,n,e))return q;if(w(12,12,n,e))return q;if(i===I)return"÷";if(23===i||23===r)return q;if(16===r||16===i)return"÷";if(-1!==[y,K,v].indexOf(r)||14===i)return q;if(36===B&&-1!==rA.indexOf(i))return q;if(i===O&&36===r)return q;if(r===D)return q;if(-1!==z.indexOf(r)&&i===S||-1!==z.indexOf(i)&&r===S)return q;if(i===G&&-1!==[X,k,R].indexOf(r)||-1!==[X,k,R].indexOf(i)&&r===T)return q;if(-1!==z.indexOf(i)&&-1!==eA.indexOf(r)||-1!==eA.indexOf(i)&&-1!==z.indexOf(r))return q;if(-1!==[G,T].indexOf(i)&&(r===S||-1!==[x,K].indexOf(r)&&e[1+o]===S)||-1!==[x,K].indexOf(i)&&r===S||i===S&&-1!==[S,O,M].indexOf(r))return q;if(-1!==[S,O,M,m,L].indexOf(r))for(var Q=n;0<=Q;){if((c=e[Q])===S)return q;if(-1===[O,M].indexOf(c))break;Q--}if(-1!==[G,T].indexOf(r))for(var c,Q=-1!==[m,L].indexOf(i)?s:n;0<=Q;){if((c=e[Q])===S)return q;if(-1===[O,M].indexOf(c))break;Q--}if(J===i&&-1!==[J,Y,P,N].indexOf(r)||-1!==[Y,P].indexOf(i)&&-1!==[Y,W].indexOf(r)||-1!==[W,N].indexOf(i)&&r===W)return q;if(-1!==BA.indexOf(i)&&-1!==[D,T].indexOf(r)||-1!==BA.indexOf(r)&&i===G)return q;if(-1!==z.indexOf(i)&&-1!==z.indexOf(r))return q;if(i===M&&-1!==z.indexOf(r))return q;if(-1!==z.concat(S).indexOf(i)&&r===x&&-1===_.indexOf(A[o])||-1!==z.concat(S).indexOf(r)&&i===L)return q;if(41===i&&41===r){for(var a=t[n],g=1;0<a&&41===e[--a];)g++;if(g%2!=0)return q}return i===k&&r===R?q:"÷"}(t,r,B,++i,n))===q;);if(A===q&&i!==s)return{done:!0,value:null};var e=new nA(t,A,o,i);return o=i,{value:e,done:!1}}}}function iA(A){return 48<=A&&A<=57}function QA(A){return iA(A)||65<=A&&A<=70||97<=A&&A<=102}function cA(A){return 10===A||9===A||32===A}function aA(A){return 97<=(t=e=A)&&t<=122||65<=(e=e)&&e<=90||128<=A||95===A;var e,t}function gA(A){return aA(A)||iA(A)||45===A}function wA(A,e){return 92===A&&10!==e}function UA(A,e,t){return 45===A?aA(e)||wA(e,t):!!aA(A)||92===A&&10!==e}function CA(A,e,t){return 43===A||45===A?!!iA(e)||46===e&&iA(t):iA(46===A?e:A)}var lA={type:2},uA={type:3},FA={type:4},hA={type:13},dA={type:8},fA={type:21},HA={type:9},pA={type:10},EA={type:11},IA={type:12},yA={type:14},KA={type:23},mA={type:1},LA={type:25},bA={type:24},DA={type:26},vA={type:27},xA={type:28},MA={type:29},SA={type:31},TA={type:32},GA=(OA.prototype.write=function(A){this._value=this._value.concat(Q(A))},OA.prototype.read=function(){for(var A=[],e=this.consumeToken();e!==TA;)A.push(e),e=this.consumeToken();return A},OA.prototype.consumeToken=function(){var A=this.consumeCodePoint();switch(A){case 34:return this.consumeStringToken(34);case 35:var e=this.peekCodePoint(0),t=this.peekCodePoint(1),B=this.peekCodePoint(2);if(gA(e)||wA(t,B)){var r=UA(e,t,B)?2:1;return{type:5,value:this.consumeName(),flags:r}}break;case 36:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),hA;break;case 39:return this.consumeStringToken(39);case 40:return lA;case 41:return uA;case 42:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),yA;break;case 43:if(CA(A,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(A),this.consumeNumericToken();break;case 44:return FA;case 45:var B=A,r=this.peekCodePoint(0),n=this.peekCodePoint(1);if(CA(B,r,n))return this.reconsumeCodePoint(A),this.consumeNumericToken();if(UA(B,r,n))return this.reconsumeCodePoint(A),this.consumeIdentLikeToken();if(45===r&&62===n)return this.consumeCodePoint(),this.consumeCodePoint(),bA;break;case 46:if(CA(A,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(A),this.consumeNumericToken();break;case 47:if(42===this.peekCodePoint(0))for(this.consumeCodePoint();;){var s=this.consumeCodePoint();if(42===s&&47===(s=this.consumeCodePoint()))return this.consumeToken();if(-1===s)return this.consumeToken()}break;case 58:return DA;case 59:return vA;case 60:if(33===this.peekCodePoint(0)&&45===this.peekCodePoint(1)&&45===this.peekCodePoint(2))return this.consumeCodePoint(),this.consumeCodePoint(),LA;break;case 64:var n=this.peekCodePoint(0),o=this.peekCodePoint(1),i=this.peekCodePoint(2);if(UA(n,o,i))return{type:7,value:this.consumeName()};break;case 91:return xA;case 92:if(wA(A,this.peekCodePoint(0)))return this.reconsumeCodePoint(A),this.consumeIdentLikeToken();break;case 93:return MA;case 61:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),dA;break;case 123:return EA;case 125:return IA;case 117:case 85:o=this.peekCodePoint(0),i=this.peekCodePoint(1);return 43!==o||!QA(i)&&63!==i||(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(A),this.consumeIdentLikeToken();case 124:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),HA;if(124===this.peekCodePoint(0))return this.consumeCodePoint(),fA;break;case 126:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),pA;break;case-1:return TA}return cA(A)?(this.consumeWhiteSpace(),SA):iA(A)?(this.reconsumeCodePoint(A),this.consumeNumericToken()):aA(A)?(this.reconsumeCodePoint(A),this.consumeIdentLikeToken()):{type:6,value:g(A)}},OA.prototype.consumeCodePoint=function(){var A=this._value.shift();return void 0===A?-1:A},OA.prototype.reconsumeCodePoint=function(A){this._value.unshift(A)},OA.prototype.peekCodePoint=function(A){return A>=this._value.length?-1:this._value[A]},OA.prototype.consumeUnicodeRangeToken=function(){for(var A=[],e=this.consumeCodePoint();QA(e)&&A.length<6;)A.push(e),e=this.consumeCodePoint();for(var t=!1;63===e&&A.length<6;)A.push(e),e=this.consumeCodePoint(),t=!0;if(t)return{type:30,start:parseInt(g.apply(void 0,A.map(function(A){return 63===A?48:A})),16),end:parseInt(g.apply(void 0,A.map(function(A){return 63===A?70:A})),16)};var B=parseInt(g.apply(void 0,A),16);if(45===this.peekCodePoint(0)&&QA(this.peekCodePoint(1))){this.consumeCodePoint();for(var e=this.consumeCodePoint(),r=[];QA(e)&&r.length<6;)r.push(e),e=this.consumeCodePoint();return{type:30,start:B,end:parseInt(g.apply(void 0,r),16)}}return{type:30,start:B,end:B}},OA.prototype.consumeIdentLikeToken=function(){var A=this.consumeName();return"url"===A.toLowerCase()&&40===this.peekCodePoint(0)?(this.consumeCodePoint(),this.consumeUrlToken()):40===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:19,value:A}):{type:20,value:A}},OA.prototype.consumeUrlToken=function(){var A=[];if(this.consumeWhiteSpace(),-1===this.peekCodePoint(0))return{type:22,value:""};var e,t=this.peekCodePoint(0);if(39===t||34===t){t=this.consumeStringToken(this.consumeCodePoint());return 0===t.type&&(this.consumeWhiteSpace(),-1===this.peekCodePoint(0)||41===this.peekCodePoint(0))?(this.consumeCodePoint(),{type:22,value:t.value}):(this.consumeBadUrlRemnants(),KA)}for(;;){var B=this.consumeCodePoint();if(-1===B||41===B)return{type:22,value:g.apply(void 0,A)};if(cA(B))return this.consumeWhiteSpace(),-1===this.peekCodePoint(0)||41===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:22,value:g.apply(void 0,A)}):(this.consumeBadUrlRemnants(),KA);if(34===B||39===B||40===B||(0<=(e=B)&&e<=8||11===e||14<=e&&e<=31||127===e))return this.consumeBadUrlRemnants(),KA;if(92===B){if(!wA(B,this.peekCodePoint(0)))return this.consumeBadUrlRemnants(),KA;A.push(this.consumeEscapedCodePoint())}else A.push(B)}},OA.prototype.consumeWhiteSpace=function(){for(;cA(this.peekCodePoint(0));)this.consumeCodePoint()},OA.prototype.consumeBadUrlRemnants=function(){for(;;){var A=this.consumeCodePoint();if(41===A||-1===A)return;wA(A,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},OA.prototype.consumeStringSlice=function(A){for(var e="";0<A;){var t=Math.min(6e4,A);e+=g.apply(void 0,this._value.splice(0,t)),A-=t}return this._value.shift(),e},OA.prototype.consumeStringToken=function(A){for(var e="",t=0;;){var B,r=this._value[t];if(-1===r||void 0===r||r===A)return{type:0,value:e+=this.consumeStringSlice(t)};if(10===r)return this._value.splice(0,t),mA;92!==r||-1!==(B=this._value[t+1])&&void 0!==B&&(10===B?(e+=this.consumeStringSlice(t),t=-1,this._value.shift()):wA(r,B)&&(e+=this.consumeStringSlice(t),e+=g(this.consumeEscapedCodePoint()),t=-1)),t++}},OA.prototype.consumeNumber=function(){var A=[],e=4;for(43!==(t=this.peekCodePoint(0))&&45!==t||A.push(this.consumeCodePoint());iA(this.peekCodePoint(0));)A.push(this.consumeCodePoint());var t=this.peekCodePoint(0),B=this.peekCodePoint(1);if(46===t&&iA(B))for(A.push(this.consumeCodePoint(),this.consumeCodePoint()),e=8;iA(this.peekCodePoint(0));)A.push(this.consumeCodePoint());t=this.peekCodePoint(0);var B=this.peekCodePoint(1),r=this.peekCodePoint(2);if((69===t||101===t)&&((43===B||45===B)&&iA(r)||iA(B)))for(A.push(this.consumeCodePoint(),this.consumeCodePoint()),e=8;iA(this.peekCodePoint(0));)A.push(this.consumeCodePoint());return[function(A){var e=0,t=1;43!==A[e]&&45!==A[e]||(45===A[e]&&(t=-1),e++);for(var B=[];iA(A[e]);)B.push(A[e++]);var r=B.length?parseInt(g.apply(void 0,B),10):0;46===A[e]&&e++;for(var n=[];iA(A[e]);)n.push(A[e++]);var s=n.length,o=s?parseInt(g.apply(void 0,n),10):0;69!==A[e]&&101!==A[e]||e++;var i=1;43!==A[e]&&45!==A[e]||(45===A[e]&&(i=-1),e++);for(var Q=[];iA(A[e]);)Q.push(A[e++]);var c=Q.length?parseInt(g.apply(void 0,Q),10):0;return t*(r+o*Math.pow(10,-s))*Math.pow(10,i*c)}(A),e]},OA.prototype.consumeNumericToken=function(){var A=this.consumeNumber(),e=A[0],t=A[1],B=this.peekCodePoint(0),r=this.peekCodePoint(1),A=this.peekCodePoint(2);return UA(B,r,A)?{type:15,number:e,flags:t,unit:this.consumeName()}:37===B?(this.consumeCodePoint(),{type:16,number:e,flags:t}):{type:17,number:e,flags:t}},OA.prototype.consumeEscapedCodePoint=function(){var A,e=this.consumeCodePoint();if(QA(e)){for(var t=g(e);QA(this.peekCodePoint(0))&&t.length<6;)t+=g(this.consumeCodePoint());cA(this.peekCodePoint(0))&&this.consumeCodePoint();var B=parseInt(t,16);return 0===B||55296<=(A=B)&&A<=57343||1114111<B?65533:B}return-1===e?65533:e},OA.prototype.consumeName=function(){for(var A="";;){var e=this.consumeCodePoint();if(gA(e))A+=g(e);else{if(!wA(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),A;A+=g(this.consumeEscapedCodePoint())}}},OA);function OA(){this._value=[]}var VA=(kA.create=function(A){var e=new GA;return e.write(A),new kA(e.read())},kA.parseValue=function(A){return kA.create(A).parseComponentValue()},kA.parseValues=function(A){return kA.create(A).parseComponentValues()},kA.prototype.parseComponentValue=function(){for(var A=this.consumeToken();31===A.type;)A=this.consumeToken();if(32===A.type)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(A);for(var e=this.consumeComponentValue();31===(A=this.consumeToken()).type;);if(32===A.type)return e;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},kA.prototype.parseComponentValues=function(){for(var A=[];;){var e=this.consumeComponentValue();if(32===e.type)return A;A.push(e),A.push()}},kA.prototype.consumeComponentValue=function(){var A=this.consumeToken();switch(A.type){case 11:case 28:case 2:return this.consumeSimpleBlock(A.type);case 19:return this.consumeFunction(A)}return A},kA.prototype.consumeSimpleBlock=function(A){for(var e={type:A,values:[]},t=this.consumeToken();;){if(32===t.type||re(t,A))return e;this.reconsumeToken(t),e.values.push(this.consumeComponentValue()),t=this.consumeToken()}},kA.prototype.consumeFunction=function(A){for(var e={name:A.value,values:[],type:18};;){var t=this.consumeToken();if(32===t.type||3===t.type)return e;this.reconsumeToken(t),e.values.push(this.consumeComponentValue())}},kA.prototype.consumeToken=function(){var A=this._tokens.shift();return void 0===A?TA:A},kA.prototype.reconsumeToken=function(A){this._tokens.unshift(A)},kA);function kA(A){this._tokens=A}function RA(A){return 15===A.type}function PA(A){return 17===A.type}function NA(A){return 20===A.type}function XA(A){return 0===A.type}function JA(A,e){return NA(A)&&A.value===e}function YA(A){return 31!==A.type}function WA(A){return 31!==A.type&&4!==A.type}function ZA(A){var e=[],t=[];return A.forEach(function(A){if(4===A.type){if(0===t.length)throw new Error("Error parsing function args, zero tokens for arg");return e.push(t),void(t=[])}31!==A.type&&t.push(A)}),t.length&&e.push(t),e}function _A(A){return 17===A.type||15===A.type}function qA(A){return 16===A.type||_A(A)}function jA(A){return 1<A.length?[A[0],A[1]]:[A[0]]}function zA(A,e,t){var B=A[0],A=A[1];return[ie(B,e),ie(void 0!==A?A:B,t)]}function $A(A){return 15===A.type&&("deg"===A.unit||"grad"===A.unit||"rad"===A.unit||"turn"===A.unit)}function Ae(A){switch(A.filter(NA).map(function(A){return A.value}).join(" ")){case"to bottom right":case"to right bottom":case"left top":case"top left":return[ne,ne];case"to top":case"bottom":return ce(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[ne,oe];case"to right":case"left":return ce(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[oe,oe];case"to bottom":case"top":return ce(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[oe,ne];case"to left":case"right":return ce(270)}return 0}function ee(A){return 0==(255&A)}function te(A){var e=255&A,t=255&A>>8,B=255&A>>16,A=255&A>>24;return e<255?"rgba("+A+","+B+","+t+","+e/255+")":"rgb("+A+","+B+","+t+")"}function Be(A,e){if(17===A.type)return A.number;if(16!==A.type)return 0;var t=3===e?1:255;return 3===e?A.number/100*t:Math.round(A.number/100*t)}var re=function(A,e){return 11===e&&12===A.type||(28===e&&29===A.type||2===e&&3===A.type)},ne={type:17,number:0,flags:4},se={type:16,number:50,flags:4},oe={type:16,number:100,flags:4},ie=function(A,e){if(16===A.type)return A.number/100*e;if(RA(A))switch(A.unit){case"rem":case"em":return 16*A.number;default:return A.number}return A.number},Qe=function(A,e){if(15===e.type)switch(e.unit){case"deg":return Math.PI*e.number/180;case"grad":return Math.PI/200*e.number;case"rad":return e.number;case"turn":return 2*Math.PI*e.number}throw new Error("Unsupported angle type")},ce=function(A){return Math.PI*A/180},ae=function(A,e){if(18===e.type){var t=He[e.name];if(void 0===t)throw new Error('Attempting to parse an unsupported color function "'+e.name+'"');return t(A,e.values)}if(5===e.type){if(3===e.value.length){var B=e.value.substring(0,1),r=e.value.substring(1,2),n=e.value.substring(2,3);return ge(parseInt(B+B,16),parseInt(r+r,16),parseInt(n+n,16),1)}if(4===e.value.length){var B=e.value.substring(0,1),r=e.value.substring(1,2),n=e.value.substring(2,3),s=e.value.substring(3,4);return ge(parseInt(B+B,16),parseInt(r+r,16),parseInt(n+n,16),parseInt(s+s,16)/255)}if(6===e.value.length){B=e.value.substring(0,2),r=e.value.substring(2,4),n=e.value.substring(4,6);return ge(parseInt(B,16),parseInt(r,16),parseInt(n,16),1)}if(8===e.value.length){B=e.value.substring(0,2),r=e.value.substring(2,4),n=e.value.substring(4,6),s=e.value.substring(6,8);return ge(parseInt(B,16),parseInt(r,16),parseInt(n,16),parseInt(s,16)/255)}}if(20===e.type){e=pe[e.value.toUpperCase()];if(void 0!==e)return e}return pe.TRANSPARENT},ge=function(A,e,t,B){return(A<<24|e<<16|t<<8|Math.round(255*B)<<0)>>>0},we=function(A,e){e=e.filter(WA);if(3===e.length){var t=e.map(Be),B=t[0],r=t[1],t=t[2];return ge(B,r,t,1)}if(4!==e.length)return 0;e=e.map(Be),B=e[0],r=e[1],t=e[2],e=e[3];return ge(B,r,t,e)};function Ue(A,e,t){return t<0&&(t+=1),1<=t&&--t,t<1/6?(e-A)*t*6+A:t<.5?e:t<2/3?6*(e-A)*(2/3-t)+A:A}function Ce(A,e){return ae(A,VA.create(e).parseComponentValue())}function le(A,e){return A=ae(A,e[0]),(e=e[1])&&qA(e)?{color:A,stop:e}:{color:A,stop:null}}function ue(A,t){var e=A[0],B=A[A.length-1];null===e.stop&&(e.stop=ne),null===B.stop&&(B.stop=oe);for(var r=[],n=0,s=0;s<A.length;s++){var o=A[s].stop;null!==o?(n<(o=ie(o,t))?r.push(o):r.push(n),n=o):r.push(null)}for(var i=null,s=0;s<r.length;s++){var Q=r[s];if(null===Q)null===i&&(i=s);else if(null!==i){for(var c=s-i,a=(Q-r[i-1])/(1+c),g=1;g<=c;g++)r[i+g-1]=a*g;i=null}}return A.map(function(A,e){return{color:A.color,stop:Math.max(Math.min(1,r[e]/t),0)}})}function Fe(A,e,t){var B="number"==typeof A?A:(s=e/2,B=(n=t)/2,s=ie((r=A)[0],e)-s,n=B-ie(r[1],n),(Math.atan2(n,s)+2*Math.PI)%(2*Math.PI)),r=Math.abs(e*Math.sin(B))+Math.abs(t*Math.cos(B)),n=e/2,s=t/2,e=r/2,t=Math.sin(B-Math.PI/2)*e,e=Math.cos(B-Math.PI/2)*e;return[r,n-e,n+e,s-t,s+t]}function he(A,e){return Math.sqrt(A*A+e*e)}function de(A,e,r,n,s){return[[0,0],[0,e],[A,0],[A,e]].reduce(function(A,e){var t=e[0],B=e[1],B=he(r-t,n-B);return(s?B<A.optimumDistance:B>A.optimumDistance)?{optimumCorner:e,optimumDistance:B}:A},{optimumDistance:s?1/0:-1/0,optimumCorner:null}).optimumCorner}var fe=function(A,e){var t=e.filter(WA),B=t[0],r=t[1],n=t[2],e=t[3],t=(17===B.type?ce(B.number):Qe(A,B))/(2*Math.PI),A=qA(r)?r.number/100:0,B=qA(n)?n.number/100:0,r=void 0!==e&&qA(e)?ie(e,1):1;if(0==A)return ge(255*B,255*B,255*B,1);n=B<=.5?B*(1+A):B+A-B*A,e=2*B-n,A=Ue(e,n,t+1/3),B=Ue(e,n,t),t=Ue(e,n,t-1/3);return ge(255*A,255*B,255*t,r)},He={hsl:fe,hsla:fe,rgb:we,rgba:we},pe={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},Ee={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(A,e){return e.map(function(A){if(NA(A))switch(A.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},Ie={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},fe=function(t,A){var B=ce(180),r=[];return ZA(A).forEach(function(A,e){if(0===e){e=A[0];if(20===e.type&&-1!==["top","left","right","bottom"].indexOf(e.value))return void(B=Ae(A));if($A(e))return void(B=(Qe(t,e)+ce(270))%ce(360))}A=le(t,A);r.push(A)}),{angle:B,stops:r,type:1}},ye="closest-side",Ke="farthest-side",me="closest-corner",Le="farthest-corner",be="ellipse",De="contain",we=function(B,A){var r=0,n=3,s=[],o=[];return ZA(A).forEach(function(A,e){var t=!0;0===e?t=A.reduce(function(A,e){if(NA(e))switch(e.value){case"center":return o.push(se),!1;case"top":case"left":return o.push(ne),!1;case"right":case"bottom":return o.push(oe),!1}else if(qA(e)||_A(e))return o.push(e),!1;return A},t):1===e&&(t=A.reduce(function(A,e){if(NA(e))switch(e.value){case"circle":return r=0,!1;case be:return!(r=1);case De:case ye:return n=0,!1;case Ke:return!(n=1);case me:return!(n=2);case"cover":case Le:return!(n=3)}else if(_A(e)||qA(e))return(n=!Array.isArray(n)?[]:n).push(e),!1;return A},t)),t&&(A=le(B,A),s.push(A))}),{size:n,shape:r,stops:s,position:o,type:2}},ve=function(A,e){if(22===e.type){var t={url:e.value,type:0};return A.cache.addImage(e.value),t}if(18!==e.type)throw new Error("Unsupported image type "+e.type);t=Me[e.name];if(void 0===t)throw new Error('Attempting to parse an unsupported image function "'+e.name+'"');return t(A,e.values)};var xe,Me={"linear-gradient":function(t,A){var B=ce(180),r=[];return ZA(A).forEach(function(A,e){if(0===e){e=A[0];if(20===e.type&&"to"===e.value)return void(B=Ae(A));if($A(e))return void(B=Qe(t,e))}A=le(t,A);r.push(A)}),{angle:B,stops:r,type:1}},"-moz-linear-gradient":fe,"-ms-linear-gradient":fe,"-o-linear-gradient":fe,"-webkit-linear-gradient":fe,"radial-gradient":function(r,A){var n=0,s=3,o=[],i=[];return ZA(A).forEach(function(A,e){var t,B=!0;0===e&&(t=!1,B=A.reduce(function(A,e){if(t)if(NA(e))switch(e.value){case"center":return i.push(se),A;case"top":case"left":return i.push(ne),A;case"right":case"bottom":return i.push(oe),A}else(qA(e)||_A(e))&&i.push(e);else if(NA(e))switch(e.value){case"circle":return n=0,!1;case be:return!(n=1);case"at":return!(t=!0);case ye:return s=0,!1;case"cover":case Ke:return!(s=1);case De:case me:return!(s=2);case Le:return!(s=3)}else if(_A(e)||qA(e))return(s=!Array.isArray(s)?[]:s).push(e),!1;return A},B)),B&&(A=le(r,A),o.push(A))}),{size:s,shape:n,stops:o,position:i,type:2}},"-moz-radial-gradient":we,"-ms-radial-gradient":we,"-o-radial-gradient":we,"-webkit-radial-gradient":we,"-webkit-gradient":function(B,A){var e=ce(180),r=[],n=1;return ZA(A).forEach(function(A,e){var t,A=A[0];if(0===e){if(NA(A)&&"linear"===A.value)return void(n=1);if(NA(A)&&"radial"===A.value)return void(n=2)}18===A.type&&("from"===A.name?(t=ae(B,A.values[0]),r.push({stop:ne,color:t})):"to"===A.name?(t=ae(B,A.values[0]),r.push({stop:oe,color:t})):"color-stop"!==A.name||2===(A=A.values.filter(WA)).length&&(t=ae(B,A[1]),A=A[0],PA(A)&&r.push({stop:{type:16,number:100*A.number,flags:A.flags},color:t})))}),1===n?{angle:(e+ce(180))%ce(360),stops:r,type:n}:{size:3,shape:0,stops:r,position:[],type:n}}},Se={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(e,A){if(0===A.length)return[];var t=A[0];return 20===t.type&&"none"===t.value?[]:A.filter(function(A){return WA(A)&&!(20===(A=A).type&&"none"===A.value||18===A.type&&!Me[A.name])}).map(function(A){return ve(e,A)})}},Te={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(A,e){return e.map(function(A){if(NA(A))switch(A.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},Ge={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(A,e){return ZA(e).map(function(A){return A.filter(qA)}).map(jA)}},Oe={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(A,e){return ZA(e).map(function(A){return A.filter(NA).map(function(A){return A.value}).join(" ")}).map(Ve)}},Ve=function(A){switch(A){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;default:return 0}};(we=xe=xe||{}).AUTO="auto",we.CONTAIN="contain";function ke(A,e){return NA(A)&&"normal"===A.value?1.2*e:17===A.type?e*A.number:qA(A)?ie(A,e):e}var Re,Pe,Ne={name:"background-size",initialValue:"0",prefix:!(we.COVER="cover"),type:1,parse:function(A,e){return ZA(e).map(function(A){return A.filter(Xe)})}},Xe=function(A){return NA(A)||qA(A)},we=function(A){return{name:"border-"+A+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},Je=we("top"),Ye=we("right"),We=we("bottom"),Ze=we("left"),we=function(A){return{name:"border-radius-"+A,initialValue:"0 0",prefix:!1,type:1,parse:function(A,e){return jA(e.filter(qA))}}},_e=we("top-left"),qe=we("top-right"),je=we("bottom-right"),ze=we("bottom-left"),we=function(A){return{name:"border-"+A+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(A,e){switch(e){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},$e=we("top"),At=we("right"),et=we("bottom"),tt=we("left"),we=function(A){return{name:"border-"+A+"-width",initialValue:"0",type:0,prefix:!1,parse:function(A,e){return RA(e)?e.number:0}}},Bt=we("top"),rt=we("right"),nt=we("bottom"),st=we("left"),ot={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},it={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(A,e){return"rtl"!==e?0:1}},Qt={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(A,e){return e.filter(NA).reduce(function(A,e){return A|ct(e.value)},0)}},ct=function(A){switch(A){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},at={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(A,e){switch(e){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},gt={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(A,e){return!(20===e.type&&"normal"===e.value||17!==e.type&&15!==e.type)?e.number:0}},wt={name:"line-break",initialValue:(we=Re=Re||{}).NORMAL="normal",prefix:!(we.STRICT="strict"),type:2,parse:function(A,e){return"strict"!==e?Re.NORMAL:Re.STRICT}},Ut={name:"line-height",initialValue:"normal",prefix:!1,type:4},Ct={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(A,e){return 20===e.type&&"none"===e.value?null:ve(A,e)}},lt={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(A,e){return"inside"!==e?1:0}},ut={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(A,e){switch(e){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;default:return-1}}},we=function(A){return{name:"margin-"+A,initialValue:"0",prefix:!1,type:4}},Ft=we("top"),ht=we("right"),dt=we("bottom"),ft=we("left"),Ht={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(A,e){return e.filter(NA).map(function(A){switch(A.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;default:return 0}})}},pt={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(A,e){return"break-word"!==e?"normal":"break-word"}},we=function(A){return{name:"padding-"+A,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},Et=we("top"),It=we("right"),yt=we("bottom"),Kt=we("left"),mt={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(A,e){switch(e){case"right":return 2;case"center":case"justify":return 1;default:return 0}}},Lt={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(A,e){switch(e){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},bt={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(n,A){return 1===A.length&&JA(A[0],"none")?[]:ZA(A).map(function(A){for(var e={color:pe.TRANSPARENT,offsetX:ne,offsetY:ne,blur:ne},t=0,B=0;B<A.length;B++){var r=A[B];_A(r)?(0===t?e.offsetX=r:1===t?e.offsetY=r:e.blur=r,t++):e.color=ae(n,r)}return e})}},Dt={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(A,e){switch(e){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},vt={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(A,e){if(20===e.type&&"none"===e.value)return null;if(18!==e.type)return null;var t=xt[e.name];if(void 0===t)throw new Error('Attempting to parse an unsupported transform function "'+e.name+'"');return t(e.values)}},xt={matrix:function(A){A=A.filter(function(A){return 17===A.type}).map(function(A){return A.number});return 6===A.length?A:null},matrix3d:function(A){var e=A.filter(function(A){return 17===A.type}).map(function(A){return A.number}),t=e[0],B=e[1];e[2],e[3];var r=e[4],n=e[5];e[6],e[7],e[8],e[9],e[10],e[11];var s=e[12],A=e[13];return e[14],e[15],16===e.length?[t,B,r,n,s,A]:null}},we={type:16,number:50,flags:4},Mt=[we,we],St={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(A,e){e=e.filter(qA);return 2!==e.length?Mt:[e[0],e[1]]}},Tt={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(A,e){switch(e){case"hidden":return 1;case"collapse":return 2;default:return 0}}};(we=Pe=Pe||{}).NORMAL="normal",we.BREAK_ALL="break-all";function Gt(A,e){return 0!=(A&e)}function Ot(A,e,t){return(A=A&&A[Math.min(e,A.length-1)])?t?A.open:A.close:""}var Vt={name:"word-break",initialValue:"normal",prefix:!(we.KEEP_ALL="keep-all"),type:2,parse:function(A,e){switch(e){case"break-all":return Pe.BREAK_ALL;case"keep-all":return Pe.KEEP_ALL;default:return Pe.NORMAL}}},kt={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(A,e){if(20===e.type)return{auto:!0,order:0};if(PA(e))return{auto:!1,order:e.number};throw new Error("Invalid z-index number parsed")}},Rt=function(A,e){if(15===e.type)switch(e.unit.toLowerCase()){case"s":return 1e3*e.number;case"ms":return e.number}throw new Error("Unsupported time type")},Pt={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(A,e){return PA(e)?e.number:1}},Nt={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Xt={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(A,e){return e.filter(NA).map(function(A){switch(A.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(A){return 0!==A})}},Jt={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(A,e){var t=[],B=[];return e.forEach(function(A){switch(A.type){case 20:case 0:t.push(A.value);break;case 17:t.push(A.number.toString());break;case 4:B.push(t.join(" ")),t.length=0}}),t.length&&B.push(t.join(" ")),B.map(function(A){return-1===A.indexOf(" ")?A:"'"+A+"'"})}},Yt={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},Wt={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(A,e){return PA(e)?e.number:!NA(e)||"bold"!==e.value?400:700}},Zt={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(A,e){return e.filter(NA).map(function(A){return A.value})}},_t={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(A,e){switch(e){case"oblique":return"oblique";case"italic":return"italic";default:return"normal"}}},qt={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(A,e){if(0===e.length)return[];var t=e[0];return 20===t.type&&"none"===t.value?[]:e}},jt={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(A,e){if(0===e.length)return null;var t=e[0];if(20===t.type&&"none"===t.value)return null;for(var B=[],r=e.filter(YA),n=0;n<r.length;n++){var s=r[n],o=r[n+1];20===s.type&&(o=o&&PA(o)?o.number:1,B.push({counter:s.value,increment:o}))}return B}},zt={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(A,e){if(0===e.length)return[];for(var t=[],B=e.filter(YA),r=0;r<B.length;r++){var n=B[r],s=B[r+1];NA(n)&&"none"!==n.value&&(s=s&&PA(s)?s.number:0,t.push({counter:n.value,reset:s}))}return t}},$t={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(e,A){return A.filter(RA).map(function(A){return Rt(e,A)})}},AB={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(A,e){if(0===e.length)return null;var t=e[0];if(20===t.type&&"none"===t.value)return null;var B=[],r=e.filter(XA);if(r.length%2!=0)return null;for(var n=0;n<r.length;n+=2){var s=r[n].value,o=r[n+1].value;B.push({open:s,close:o})}return B}},eB={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(n,A){return 1===A.length&&JA(A[0],"none")?[]:ZA(A).map(function(A){for(var e={color:255,offsetX:ne,offsetY:ne,blur:ne,spread:ne,inset:!1},t=0,B=0;B<A.length;B++){var r=A[B];JA(r,"inset")?e.inset=!0:_A(r)?(0===t?e.offsetX=r:1===t?e.offsetY=r:2===t?e.blur=r:e.spread=r,t++):e.color=ae(n,r)}return e})}},tB={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(A,e){var t=[];return e.filter(NA).forEach(function(A){switch(A.value){case"stroke":t.push(1);break;case"fill":t.push(0);break;case"markers":t.push(2)}}),[0,1,2].forEach(function(A){-1===t.indexOf(A)&&t.push(A)}),t}},BB={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},rB={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(A,e){return RA(e)?e.number:0}},nB=(sB.prototype.isVisible=function(){return 0<this.display&&0<this.opacity&&0===this.visibility},sB.prototype.isTransparent=function(){return ee(this.backgroundColor)},sB.prototype.isTransformed=function(){return null!==this.transform},sB.prototype.isPositioned=function(){return 0!==this.position},sB.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},sB.prototype.isFloating=function(){return 0!==this.float},sB.prototype.isInlineLevel=function(){return Gt(this.display,4)||Gt(this.display,33554432)||Gt(this.display,268435456)||Gt(this.display,536870912)||Gt(this.display,67108864)||Gt(this.display,134217728)},sB);function sB(A,e){this.animationDuration=QB(A,$t,e.animationDuration),this.backgroundClip=QB(A,Ee,e.backgroundClip),this.backgroundColor=QB(A,Ie,e.backgroundColor),this.backgroundImage=QB(A,Se,e.backgroundImage),this.backgroundOrigin=QB(A,Te,e.backgroundOrigin),this.backgroundPosition=QB(A,Ge,e.backgroundPosition),this.backgroundRepeat=QB(A,Oe,e.backgroundRepeat),this.backgroundSize=QB(A,Ne,e.backgroundSize),this.borderTopColor=QB(A,Je,e.borderTopColor),this.borderRightColor=QB(A,Ye,e.borderRightColor),this.borderBottomColor=QB(A,We,e.borderBottomColor),this.borderLeftColor=QB(A,Ze,e.borderLeftColor),this.borderTopLeftRadius=QB(A,_e,e.borderTopLeftRadius),this.borderTopRightRadius=QB(A,qe,e.borderTopRightRadius),this.borderBottomRightRadius=QB(A,je,e.borderBottomRightRadius),this.borderBottomLeftRadius=QB(A,ze,e.borderBottomLeftRadius),this.borderTopStyle=QB(A,$e,e.borderTopStyle),this.borderRightStyle=QB(A,At,e.borderRightStyle),this.borderBottomStyle=QB(A,et,e.borderBottomStyle),this.borderLeftStyle=QB(A,tt,e.borderLeftStyle),this.borderTopWidth=QB(A,Bt,e.borderTopWidth),this.borderRightWidth=QB(A,rt,e.borderRightWidth),this.borderBottomWidth=QB(A,nt,e.borderBottomWidth),this.borderLeftWidth=QB(A,st,e.borderLeftWidth),this.boxShadow=QB(A,eB,e.boxShadow),this.color=QB(A,ot,e.color),this.direction=QB(A,it,e.direction),this.display=QB(A,Qt,e.display),this.float=QB(A,at,e.cssFloat),this.fontFamily=QB(A,Jt,e.fontFamily),this.fontSize=QB(A,Yt,e.fontSize),this.fontStyle=QB(A,_t,e.fontStyle),this.fontVariant=QB(A,Zt,e.fontVariant),this.fontWeight=QB(A,Wt,e.fontWeight),this.letterSpacing=QB(A,gt,e.letterSpacing),this.lineBreak=QB(A,wt,e.lineBreak),this.lineHeight=QB(A,Ut,e.lineHeight),this.listStyleImage=QB(A,Ct,e.listStyleImage),this.listStylePosition=QB(A,lt,e.listStylePosition),this.listStyleType=QB(A,ut,e.listStyleType),this.marginTop=QB(A,Ft,e.marginTop),this.marginRight=QB(A,ht,e.marginRight),this.marginBottom=QB(A,dt,e.marginBottom),this.marginLeft=QB(A,ft,e.marginLeft),this.opacity=QB(A,Pt,e.opacity);var t=QB(A,Ht,e.overflow);this.overflowX=t[0],this.overflowY=t[1<t.length?1:0],this.overflowWrap=QB(A,pt,e.overflowWrap),this.paddingTop=QB(A,Et,e.paddingTop),this.paddingRight=QB(A,It,e.paddingRight),this.paddingBottom=QB(A,yt,e.paddingBottom),this.paddingLeft=QB(A,Kt,e.paddingLeft),this.paintOrder=QB(A,tB,e.paintOrder),this.position=QB(A,Lt,e.position),this.textAlign=QB(A,mt,e.textAlign),this.textDecorationColor=QB(A,Nt,null!==(t=e.textDecorationColor)&&void 0!==t?t:e.color),this.textDecorationLine=QB(A,Xt,null!==(t=e.textDecorationLine)&&void 0!==t?t:e.textDecoration),this.textShadow=QB(A,bt,e.textShadow),this.textTransform=QB(A,Dt,e.textTransform),this.transform=QB(A,vt,e.transform),this.transformOrigin=QB(A,St,e.transformOrigin),this.visibility=QB(A,Tt,e.visibility),this.webkitTextStrokeColor=QB(A,BB,e.webkitTextStrokeColor),this.webkitTextStrokeWidth=QB(A,rB,e.webkitTextStrokeWidth),this.wordBreak=QB(A,Vt,e.wordBreak),this.zIndex=QB(A,kt,e.zIndex)}for(var oB=function(A,e){this.content=QB(A,qt,e.content),this.quotes=QB(A,AB,e.quotes)},iB=function(A,e){this.counterIncrement=QB(A,jt,e.counterIncrement),this.counterReset=QB(A,zt,e.counterReset)},QB=function(A,e,t){var B=new GA,t=null!=t?t.toString():e.initialValue;B.write(t);var r=new VA(B.read());switch(e.type){case 2:var n=r.parseComponentValue();return e.parse(A,NA(n)?n.value:e.initialValue);case 0:return e.parse(A,r.parseComponentValue());case 1:return e.parse(A,r.parseComponentValues());case 4:return r.parseComponentValue();case 3:switch(e.format){case"angle":return Qe(A,r.parseComponentValue());case"color":return ae(A,r.parseComponentValue());case"image":return ve(A,r.parseComponentValue());case"length":var s=r.parseComponentValue();return _A(s)?s:ne;case"length-percentage":s=r.parseComponentValue();return qA(s)?s:ne;case"time":return Rt(A,r.parseComponentValue())}}},cB=function(A,e){A=function(A){switch(A.getAttribute("data-html2canvas-debug")){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}}(A);return 1===A||e===A},aB=function(A,e){this.context=A,this.textNodes=[],this.elements=[],this.flags=0,cB(e,3),this.styles=new nB(A,window.getComputedStyle(e,null)),Or(e)&&(this.styles.animationDuration.some(function(A){return 0<A})&&(e.style.animationDuration="0s"),null!==this.styles.transform&&(e.style.transform="none")),this.bounds=f(this.context,e),cB(e,4)&&(this.flags|=16)},gB="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",wB="undefined"==typeof Uint8Array?[]:new Uint8Array(256),UB=0;UB<gB.length;UB++)wB[gB.charCodeAt(UB)]=UB;function CB(A,e,t){return A.slice?A.slice(e,t):new Uint16Array(Array.prototype.slice.call(A,e,t))}var lB=(uB.prototype.get=function(A){var e;if(0<=A){if(A<55296||56319<A&&A<=65535)return e=this.index[A>>5],this.data[e=(e<<2)+(31&A)];if(A<=65535)return e=this.index[2048+(A-55296>>5)],this.data[e=(e<<2)+(31&A)];if(A<this.highStart)return e=this.index[e=2080+(A>>11)],e=this.index[e+=A>>5&63],this.data[e=(e<<2)+(31&A)];if(A<=1114111)return this.data[this.highValueIndex]}return this.errorValue},uB);function uB(A,e,t,B,r,n){this.initialValue=A,this.errorValue=e,this.highStart=t,this.highValueIndex=B,this.index=r,this.data=n}for(var FB="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",hB="undefined"==typeof Uint8Array?[]:new Uint8Array(256),dB=0;dB<FB.length;dB++)hB[FB.charCodeAt(dB)]=dB;function fB(A){return SB.get(A)}function HB(A){var t=function(A){for(var e=[],t=0,B=A.length;t<B;){var r,n=A.charCodeAt(t++);55296<=n&&n<=56319&&t<B?56320==(64512&(r=A.charCodeAt(t++)))?e.push(((1023&n)<<10)+(1023&r)+65536):(e.push(n),t--):e.push(n)}return e}(A),B=t.length,r=0,n=0,s=t.map(fB);return{next:function(){if(B<=r)return{done:!0,value:null};for(var A=TB;r<B&&(A=function(A,e){var t=e-2,B=A[t],r=A[e-1],e=A[e];if(2===r&&3===e)return TB;if(2===r||3===r||4===r)return"÷";if(2===e||3===e||4===e)return"÷";if(r===DB&&-1!==[DB,vB,xB,MB].indexOf(e))return TB;if(!(r!==xB&&r!==vB||e!==vB&&10!==e))return TB;if((r===MB||10===r)&&10===e)return TB;if(13===e||5===e)return TB;if(7===e)return TB;if(1===r)return TB;if(13===r&&14===e){for(;5===B;)B=A[--t];if(14===B)return TB}if(15===r&&15===e){for(var n=0;15===B;)n++,B=A[--t];if(n%2==0)return TB}return"÷"}(s,++r))===TB;);if(A===TB&&r!==B)return{done:!0,value:null};var e=function(){for(var A=[],e=0;e<arguments.length;e++)A[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,A);var t=A.length;if(!t)return"";for(var B=[],r=-1,n="";++r<t;){var s=A[r];s<=65535?B.push(s):(s-=65536,B.push(55296+(s>>10),s%1024+56320)),(r+1===t||16384<B.length)&&(n+=String.fromCharCode.apply(String,B),B.length=0)}return n}.apply(null,t.slice(n,r));return n=r,{value:e,done:!1}}}}function pB(A){for(var e,t=HB(A),B=[];!(e=t.next()).done;)e.value&&B.push(e.value.slice());return B}function EB(A){return 0===A[0]&&255===A[1]&&0===A[2]&&255===A[3]}var IB,yB,KB,mB,LB,bB,DB=8,vB=9,xB=11,MB=12,SB=(KB=function(A){var e,t,B,r,n=.75*A.length,s=A.length,o=0;"="===A[A.length-1]&&(n--,"="===A[A.length-2]&&n--);for(var n=new("undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?ArrayBuffer:Array)(n),i=Array.isArray(n)?n:new Uint8Array(n),Q=0;Q<s;Q+=4)e=wB[A.charCodeAt(Q)],t=wB[A.charCodeAt(Q+1)],B=wB[A.charCodeAt(Q+2)],r=wB[A.charCodeAt(Q+3)],i[o++]=e<<2|t>>4,i[o++]=(15&t)<<4|B>>2,i[o++]=(3&B)<<6|63&r;return n}(IB="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA="),mB=Array.isArray(KB)?function(A){for(var e=A.length,t=[],B=0;B<e;B+=4)t.push(A[B+3]<<24|A[B+2]<<16|A[B+1]<<8|A[B]);return t}(KB):new Uint32Array(KB),LB=Array.isArray(KB)?function(A){for(var e=A.length,t=[],B=0;B<e;B+=2)t.push(A[B+1]<<8|A[B]);return t}(KB):new Uint16Array(KB),IB=CB(LB,12,mB[4]/2),yB=2===mB[5]?CB(LB,(24+mB[4])/2):(KB=mB,LB=Math.ceil((24+mB[4])/4),KB.slice?KB.slice(LB,yB):new Uint32Array(Array.prototype.slice.call(KB,LB,yB))),new lB(mB[0],mB[1],mB[2],mB[3],IB,yB)),TB="×",GB=function(A,e,t,B,r){var n="http://www.w3.org/2000/svg",s=document.createElementNS(n,"svg"),n=document.createElementNS(n,"foreignObject");return s.setAttributeNS(null,"width",A.toString()),s.setAttributeNS(null,"height",e.toString()),n.setAttributeNS(null,"width","100%"),n.setAttributeNS(null,"height","100%"),n.setAttributeNS(null,"x",t.toString()),n.setAttributeNS(null,"y",B.toString()),n.setAttributeNS(null,"externalResourcesRequired","true"),s.appendChild(n),n.appendChild(r),s},OB=function(B){return new Promise(function(A,e){var t=new Image;t.onload=function(){return A(t)},t.onerror=e,t.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(B))})},VB={get SUPPORT_RANGE_BOUNDS(){var A=function(A){if(A.createRange){var e=A.createRange();if(e.getBoundingClientRect){var t=A.createElement("boundtest");t.style.height="123px",t.style.display="block",A.body.appendChild(t),e.selectNode(t);e=e.getBoundingClientRect(),e=Math.round(e.height);if(A.body.removeChild(t),123===e)return!0}}return!1}(document);return Object.defineProperty(VB,"SUPPORT_RANGE_BOUNDS",{value:A}),A},get SUPPORT_WORD_BREAKING(){var A=VB.SUPPORT_RANGE_BOUNDS&&function(A){var e=A.createElement("boundtest");e.style.width="50px",e.style.display="block",e.style.fontSize="12px",e.style.letterSpacing="0px",e.style.wordSpacing="0px",A.body.appendChild(e);var B=A.createRange();e.innerHTML="function"==typeof"".repeat?"&#128104;".repeat(10):"";var r=e.firstChild,t=Q(r.data).map(function(A){return g(A)}),n=0,s={},t=t.every(function(A,e){B.setStart(r,n),B.setEnd(r,n+A.length);var t=B.getBoundingClientRect();n+=A.length;A=t.x>s.x||t.y>s.y;return s=t,0===e||A});return A.body.removeChild(e),t}(document);return Object.defineProperty(VB,"SUPPORT_WORD_BREAKING",{value:A}),A},get SUPPORT_SVG_DRAWING(){var A=function(A){var e=new Image,t=A.createElement("canvas"),A=t.getContext("2d");if(!A)return!1;e.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{A.drawImage(e,0,0),t.toDataURL()}catch(A){return!1}return!0}(document);return Object.defineProperty(VB,"SUPPORT_SVG_DRAWING",{value:A}),A},get SUPPORT_FOREIGNOBJECT_DRAWING(){var A="function"==typeof Array.from&&"function"==typeof window.fetch?function(t){var A=t.createElement("canvas"),B=100;A.width=B,A.height=B;var r=A.getContext("2d");if(!r)return Promise.reject(!1);r.fillStyle="rgb(0, 255, 0)",r.fillRect(0,0,B,B);var e=new Image,n=A.toDataURL();e.src=n;e=GB(B,B,0,0,e);return r.fillStyle="red",r.fillRect(0,0,B,B),OB(e).then(function(A){r.drawImage(A,0,0);var e=r.getImageData(0,0,B,B).data;r.fillStyle="red",r.fillRect(0,0,B,B);A=t.createElement("div");return A.style.backgroundImage="url("+n+")",A.style.height="100px",EB(e)?OB(GB(B,B,0,0,A)):Promise.reject(!1)}).then(function(A){return r.drawImage(A,0,0),EB(r.getImageData(0,0,B,B).data)}).catch(function(){return!1})}(document):Promise.resolve(!1);return Object.defineProperty(VB,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:A}),A},get SUPPORT_CORS_IMAGES(){var A=void 0!==(new Image).crossOrigin;return Object.defineProperty(VB,"SUPPORT_CORS_IMAGES",{value:A}),A},get SUPPORT_RESPONSE_TYPE(){var A="string"==typeof(new XMLHttpRequest).responseType;return Object.defineProperty(VB,"SUPPORT_RESPONSE_TYPE",{value:A}),A},get SUPPORT_CORS_XHR(){var A="withCredentials"in new XMLHttpRequest;return Object.defineProperty(VB,"SUPPORT_CORS_XHR",{value:A}),A}},kB=function(A,e){this.text=A,this.bounds=e},RB=function(A,e){var t=e.ownerDocument;if(t){var B=t.createElement("html2canvaswrapper");B.appendChild(e.cloneNode(!0));t=e.parentNode;if(t){t.replaceChild(B,e);A=f(A,B);return B.firstChild&&t.replaceChild(B.firstChild,B),A}}return d.EMPTY},PB=function(A,e,t){var B=A.ownerDocument;if(!B)throw new Error("Node has no owner document");B=B.createRange();return B.setStart(A,e),B.setEnd(A,e+t),B},NB=function(A,e,t,B){return d.fromClientRect(A,PB(e,t,B).getBoundingClientRect())},XB=function(A,e){return 0!==e.letterSpacing?pB(A):YB(A,e)},JB=[32,160,4961,65792,65793,4153,4241],YB=function(A,e){for(var t,B=oA(A,{lineBreak:e.lineBreak,wordBreak:"break-word"===e.overflowWrap?"break-word":e.wordBreak}),r=[];!(t=B.next()).done;)!function(){var A,e;t.value&&(A=t.value.slice(),A=Q(A),e="",A.forEach(function(A){-1===JB.indexOf(A)?e+=g(A):(e.length&&r.push(e),r.push(g(A)),e="")}),e.length&&r.push(e))}();return r},WB=function(A,e,t){var B,r,n,s,o;this.text=ZB(e.data,t.textTransform),this.textBounds=(B=A,A=this.text,n=e,A=XB(A,r=t),s=[],o=0,A.forEach(function(A){var e;r.textDecorationLine.length||0<A.trim().length?VB.SUPPORT_RANGE_BOUNDS?VB.SUPPORT_WORD_BREAKING?s.push(new kB(A,NB(B,n,o,A.length))):s.push(new kB(A,d.fromDOMRectList(B,PB(n,o,A.length).getClientRects()))):(e=n.splitText(A.length),s.push(new kB(A,RB(B,n))),n=e):VB.SUPPORT_RANGE_BOUNDS||(n=n.splitText(A.length)),o+=A.length}),s)},ZB=function(A,e){switch(e){case 1:return A.toLowerCase();case 3:return A.replace(_B,qB);case 2:return A.toUpperCase();default:return A}},_B=/(^|\s|:|-|\(|\))([a-z])/g,qB=function(A,e,t){return 0<A.length?e+t.toUpperCase():A},jB=(A(zB,bB=aB),zB);function zB(A,e){A=bB.call(this,A,e)||this;return A.src=e.currentSrc||e.src,A.intrinsicWidth=e.naturalWidth,A.intrinsicHeight=e.naturalHeight,A.context.cache.addImage(A.src),A}var $B,Ar=(A(er,$B=aB),er);function er(A,e){A=$B.call(this,A,e)||this;return A.canvas=e,A.intrinsicWidth=e.width,A.intrinsicHeight=e.height,A}var tr,Br=(A(rr,tr=aB),rr);function rr(A,e){var t=tr.call(this,A,e)||this,B=new XMLSerializer,A=f(A,e);return e.setAttribute("width",A.width+"px"),e.setAttribute("height",A.height+"px"),t.svg="data:image/svg+xml,"+encodeURIComponent(B.serializeToString(e)),t.intrinsicWidth=e.width.baseVal.value,t.intrinsicHeight=e.height.baseVal.value,t.context.cache.addImage(t.svg),t}var nr,sr=(A(or,nr=aB),or);function or(A,e){A=nr.call(this,A,e)||this;return A.value=e.value,A}var ir,Qr=(A(cr,ir=aB),cr);function cr(A,e){A=ir.call(this,A,e)||this;return A.start=e.start,A.reversed="boolean"==typeof e.reversed&&!0===e.reversed,A}var ar,gr=[{type:15,flags:0,unit:"px",number:3}],wr=[{type:16,flags:0,number:50}],Ur="checkbox",Cr="radio",lr="password",ur=707406591,Fr=(A(hr,ar=aB),hr);function hr(A,e){var t=ar.call(this,A,e)||this;switch(t.type=e.type.toLowerCase(),t.checked=e.checked,t.value=0===(e=(A=e).type===lr?new Array(A.value.length+1).join("•"):A.value).length?A.placeholder||"":e,t.type!==Ur&&t.type!==Cr||(t.styles.backgroundColor=3739148031,t.styles.borderTopColor=t.styles.borderRightColor=t.styles.borderBottomColor=t.styles.borderLeftColor=2779096575,t.styles.borderTopWidth=t.styles.borderRightWidth=t.styles.borderBottomWidth=t.styles.borderLeftWidth=1,t.styles.borderTopStyle=t.styles.borderRightStyle=t.styles.borderBottomStyle=t.styles.borderLeftStyle=1,t.styles.backgroundClip=[0],t.styles.backgroundOrigin=[0],t.bounds=(e=t.bounds).width>e.height?new d(e.left+(e.width-e.height)/2,e.top,e.height,e.height):e.width<e.height?new d(e.left,e.top+(e.height-e.width)/2,e.width,e.width):e),t.type){case Ur:t.styles.borderTopRightRadius=t.styles.borderTopLeftRadius=t.styles.borderBottomRightRadius=t.styles.borderBottomLeftRadius=gr;break;case Cr:t.styles.borderTopRightRadius=t.styles.borderTopLeftRadius=t.styles.borderBottomRightRadius=t.styles.borderBottomLeftRadius=wr}return t}var dr,fr=(A(Hr,dr=aB),Hr);function Hr(A,e){A=dr.call(this,A,e)||this,e=e.options[e.selectedIndex||0];return A.value=e&&e.text||"",A}var pr,Er=(A(Ir,pr=aB),Ir);function Ir(A,e){A=pr.call(this,A,e)||this;return A.value=e.value,A}var yr,Kr=(A(mr,yr=aB),mr);function mr(A,e){var t,B,r=yr.call(this,A,e)||this;r.src=e.src,r.width=parseInt(e.width,10)||0,r.height=parseInt(e.height,10)||0,r.backgroundColor=r.styles.backgroundColor;try{e.contentWindow&&e.contentWindow.document&&e.contentWindow.document.documentElement&&(r.tree=xr(A,e.contentWindow.document.documentElement),t=e.contentWindow.document.documentElement?Ce(A,getComputedStyle(e.contentWindow.document.documentElement).backgroundColor):pe.TRANSPARENT,B=e.contentWindow.document.body?Ce(A,getComputedStyle(e.contentWindow.document.body).backgroundColor):pe.TRANSPARENT,r.backgroundColor=ee(t)?ee(B)?r.styles.backgroundColor:B:t)}catch(A){}return r}function Lr(A){return"STYLE"===A.tagName}var br=["OL","UL","MENU"],Dr=function(e,A,t,B){for(var r=A.firstChild;r;r=s){var n,s=r.nextSibling;Tr(r)&&0<r.data.trim().length?t.textNodes.push(new WB(e,r,t.styles)):Gr(r)&&(qr(r)&&r.assignedNodes?r.assignedNodes().forEach(function(A){return Dr(e,A,t,B)}):(n=vr(e,r)).styles.isVisible()&&(Mr(r,n,B)?n.flags|=4:Sr(n.styles)&&(n.flags|=2),-1!==br.indexOf(r.tagName)&&(n.flags|=8),t.elements.push(n),r.slot,r.shadowRoot?Dr(e,r.shadowRoot,n,B):Zr(r)||Nr(r)||_r(r)||Dr(e,r,n,B)))}},vr=function(A,e){return new(Yr(e)?jB:Jr(e)?Ar:Nr(e)?Br:kr(e)?sr:Rr(e)?Qr:Pr(e)?Fr:_r(e)?fr:Zr(e)?Er:Wr(e)?Kr:aB)(A,e)},xr=function(A,e){var t=vr(A,e);return t.flags|=4,Dr(A,e,t,t),t},Mr=function(A,e,t){return e.styles.isPositionedWithZIndex()||e.styles.opacity<1||e.styles.isTransformed()||Xr(A)&&t.styles.isTransparent()},Sr=function(A){return A.isPositioned()||A.isFloating()},Tr=function(A){return A.nodeType===Node.TEXT_NODE},Gr=function(A){return A.nodeType===Node.ELEMENT_NODE},Or=function(A){return Gr(A)&&void 0!==A.style&&!Vr(A)},Vr=function(A){return"object"==typeof A.className},kr=function(A){return"LI"===A.tagName},Rr=function(A){return"OL"===A.tagName},Pr=function(A){return"INPUT"===A.tagName},Nr=function(A){return"svg"===A.tagName},Xr=function(A){return"BODY"===A.tagName},Jr=function(A){return"CANVAS"===A.tagName},Yr=function(A){return"IMG"===A.tagName},Wr=function(A){return"IFRAME"===A.tagName},Zr=function(A){return"TEXTAREA"===A.tagName},_r=function(A){return"SELECT"===A.tagName},qr=function(A){return"SLOT"===A.tagName},jr=(zr.prototype.getCounterValue=function(A){A=this.counters[A];return A&&A.length?A[A.length-1]:1},zr.prototype.getCounterValues=function(A){A=this.counters[A];return A||[]},zr.prototype.pop=function(A){var e=this;A.forEach(function(A){return e.counters[A].pop()})},zr.prototype.parse=function(A){var t=this,e=A.counterIncrement,A=A.counterReset,B=!0;null!==e&&e.forEach(function(A){var e=t.counters[A.counter];e&&0!==A.increment&&(B=!1,e.length||e.push(1),e[Math.max(0,e.length-1)]+=A.increment)});var r=[];return B&&A.forEach(function(A){var e=t.counters[A.counter];r.push(A.counter),(e=e||(t.counters[A.counter]=[])).push(A.reset)}),r},zr);function zr(){this.counters={}}function $r(B,A,e,r,t,n){return B<A||e<B?an(B,t,0<n.length):r.integers.reduce(function(A,e,t){for(;e<=B;)B-=e,A+=r.values[t];return A},"")+n}function An(A,e,t,B){for(var r="";t||A--,r=B(A)+r,e<=(A/=e)*e;);return r}function en(A,e,t,B,r){var n=t-e+1;return(A<0?"-":"")+(An(Math.abs(A),n,B,function(A){return g(Math.floor(A%n)+e)})+r)}function tn(A,e,t){void 0===t&&(t=". ");var B=e.length;return An(Math.abs(A),B,!1,function(A){return e[Math.floor(A%B)]})+t}function Bn(A,e,t,B,r,n){if(A<-9999||9999<A)return an(A,4,0<r.length);var s=Math.abs(A),o=r;if(0===s)return e[0]+o;for(var i=0;0<s&&i<=4;i++){var Q=s%10;0==Q&&Gt(n,1)&&""!==o?o=e[Q]+o:1<Q||1==Q&&0===i||1==Q&&1===i&&Gt(n,2)||1==Q&&1===i&&Gt(n,4)&&100<A||1==Q&&1<i&&Gt(n,8)?o=e[Q]+(0<i?t[i-1]:"")+o:1==Q&&0<i&&(o=t[i-1]+o),s=Math.floor(s/10)}return(A<0?B:"")+o}var rn,nn={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},sn={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["Ք","Փ","Ւ","Ց","Ր","Տ","Վ","Ս","Ռ","Ջ","Պ","Չ","Ո","Շ","Ն","Յ","Մ","Ճ","Ղ","Ձ","Հ","Կ","Ծ","Խ","Լ","Ի","Ժ","Թ","Ը","Է","Զ","Ե","Դ","Գ","Բ","Ա"]},on={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["י׳","ט׳","ח׳","ז׳","ו׳","ה׳","ד׳","ג׳","ב׳","א׳","ת","ש","ר","ק","צ","פ","ע","ס","נ","מ","ל","כ","יט","יח","יז","טז","טו","י","ט","ח","ז","ו","ה","ד","ג","ב","א"]},Qn={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["ჵ","ჰ","ჯ","ჴ","ხ","ჭ","წ","ძ","ც","ჩ","შ","ყ","ღ","ქ","ფ","ჳ","ტ","ს","რ","ჟ","პ","ო","ჲ","ნ","მ","ლ","კ","ი","თ","ჱ","ზ","ვ","ე","დ","გ","ბ","ა"]},cn="마이너스",an=function(A,e,t){var B=t?". ":"",r=t?"、":"",n=t?", ":"",s=t?" ":"";switch(e){case 0:return"•"+s;case 1:return"◦"+s;case 2:return"◾"+s;case 5:var o=en(A,48,57,!0,B);return o.length<4?"0"+o:o;case 4:return tn(A,"〇一二三四五六七八九",r);case 6:return $r(A,1,3999,nn,3,B).toLowerCase();case 7:return $r(A,1,3999,nn,3,B);case 8:return en(A,945,969,!1,B);case 9:return en(A,97,122,!1,B);case 10:return en(A,65,90,!1,B);case 11:return en(A,1632,1641,!0,B);case 12:case 49:return $r(A,1,9999,sn,3,B);case 35:return $r(A,1,9999,sn,3,B).toLowerCase();case 13:return en(A,2534,2543,!0,B);case 14:case 30:return en(A,6112,6121,!0,B);case 15:return tn(A,"子丑寅卯辰巳午未申酉戌亥",r);case 16:return tn(A,"甲乙丙丁戊己庚辛壬癸",r);case 17:case 48:return Bn(A,"零一二三四五六七八九","十百千萬","負",r,14);case 47:return Bn(A,"零壹貳參肆伍陸柒捌玖","拾佰仟萬","負",r,15);case 42:return Bn(A,"零一二三四五六七八九","十百千萬","负",r,14);case 41:return Bn(A,"零壹贰叁肆伍陆柒捌玖","拾佰仟萬","负",r,15);case 26:return Bn(A,"〇一二三四五六七八九","十百千万","マイナス",r,0);case 25:return Bn(A,"零壱弐参四伍六七八九","拾百千万","マイナス",r,7);case 31:return Bn(A,"영일이삼사오육칠팔구","십백천만",cn,n,7);case 33:return Bn(A,"零一二三四五六七八九","十百千萬",cn,n,0);case 32:return Bn(A,"零壹貳參四五六七八九","拾百千",cn,n,7);case 18:return en(A,2406,2415,!0,B);case 20:return $r(A,1,19999,Qn,3,B);case 21:return en(A,2790,2799,!0,B);case 22:return en(A,2662,2671,!0,B);case 22:return $r(A,1,10999,on,3,B);case 23:return tn(A,"あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわゐゑをん");case 24:return tn(A,"いろはにほへとちりぬるをわかよたれそつねならむうゐのおくやまけふこえてあさきゆめみしゑひもせす");case 27:return en(A,3302,3311,!0,B);case 28:return tn(A,"アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヰヱヲン",r);case 29:return tn(A,"イロハニホヘトチリヌルヲワカヨタレソツネナラムウヰノオクヤマケフコエテアサキユメミシヱヒモセス",r);case 34:return en(A,3792,3801,!0,B);case 37:return en(A,6160,6169,!0,B);case 38:return en(A,4160,4169,!0,B);case 39:return en(A,2918,2927,!0,B);case 40:return en(A,1776,1785,!0,B);case 43:return en(A,3046,3055,!0,B);case 44:return en(A,3174,3183,!0,B);case 45:return en(A,3664,3673,!0,B);case 46:return en(A,3872,3881,!0,B);default:return en(A,48,57,!0,B)}},gn="data-html2canvas-ignore",wn=(Un.prototype.toIFrame=function(A,B){var e=this,r=ln(A,B);if(!r.contentWindow)return Promise.reject("Unable to find iframe window");var t=A.defaultView.pageXOffset,n=A.defaultView.pageYOffset,s=r.contentWindow,o=s.document,A=Fn(r).then(function(){return a(e,void 0,void 0,function(){var e,t;return H(this,function(A){switch(A.label){case 0:return this.scrolledElements.forEach(pn),s&&(s.scrollTo(B.left,B.top),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||s.scrollY===B.top&&s.scrollX===B.left||(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(s.scrollX-B.left,s.scrollY-B.top,0,0))),e=this.options.onclone,void 0===(t=this.clonedReferenceElement)?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:o.fonts&&o.fonts.ready?[4,o.fonts.ready]:[3,2];case 1:A.sent(),A.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,un(o)]:[3,4];case 3:A.sent(),A.label=4;case 4:return"function"==typeof e?[2,Promise.resolve().then(function(){return e(o,t)}).then(function(){return r})]:[2,r]}})})});return o.open(),o.write(fn(document.doctype)+"<html></html>"),Hn(this.referenceElement.ownerDocument,t,n),o.replaceChild(o.adoptNode(this.documentElement),o.documentElement),o.close(),A},Un.prototype.createElementClone=function(A){if(cB(A,2),Jr(A))return this.createCanvasClone(A);if(Lr(A))return this.createStyleClone(A);var e=A.cloneNode(!1);return Yr(e)&&(Yr(A)&&A.currentSrc&&A.currentSrc!==A.src&&(e.src=A.currentSrc,e.srcset=""),"lazy"===e.loading&&(e.loading="eager")),e},Un.prototype.createStyleClone=function(A){try{var e=A.sheet;if(e&&e.cssRules){var t=[].slice.call(e.cssRules,0).reduce(function(A,e){return e&&"string"==typeof e.cssText?A+e.cssText:A},""),B=A.cloneNode(!1);return B.textContent=t,B}}catch(A){if(this.context.logger.error("Unable to access cssRules property",A),"SecurityError"!==A.name)throw A}return A.cloneNode(!1)},Un.prototype.createCanvasClone=function(e){var A;if(this.options.inlineImages&&e.ownerDocument){var t=e.ownerDocument.createElement("img");try{return t.src=e.toDataURL(),t}catch(A){this.context.logger.info("Unable to inline canvas contents, canvas is tainted",e)}}t=e.cloneNode(!1);try{t.width=e.width,t.height=e.height;var B,r,n=e.getContext("2d"),s=t.getContext("2d");return s&&(!this.options.allowTaint&&n?s.putImageData(n.getImageData(0,0,e.width,e.height),0,0):(!(B=null!==(A=e.getContext("webgl2"))&&void 0!==A?A:e.getContext("webgl"))||!1===(null==(r=B.getContextAttributes())?void 0:r.preserveDrawingBuffer)&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",e),s.drawImage(e,0,0))),t}catch(A){this.context.logger.info("Unable to clone canvas as it is tainted",e)}return t},Un.prototype.cloneNode=function(A){if(Tr(A))return document.createTextNode(A.data);if(!A.ownerDocument)return A.cloneNode(!1);var e=A.ownerDocument.defaultView;if(e&&Gr(A)&&(Or(A)||Vr(A))){var t=this.createElementClone(A);t.style.transitionProperty="none";var B=e.getComputedStyle(A),r=e.getComputedStyle(A,":before"),n=e.getComputedStyle(A,":after");this.referenceElement===A&&Or(t)&&(this.clonedReferenceElement=t),Xr(t)&&Kn(t);for(var e=this.counters.parse(new iB(this.context,B)),r=this.resolvePseudoContent(A,t,r,rn.BEFORE),s=A.firstChild;s;s=s.nextSibling)Gr(s)&&("SCRIPT"===s.tagName||s.hasAttribute(gn)||"function"==typeof this.options.ignoreElements&&this.options.ignoreElements(s))||this.options.copyStyles&&Gr(s)&&Lr(s)||t.appendChild(this.cloneNode(s));r&&t.insertBefore(r,t.firstChild);n=this.resolvePseudoContent(A,t,n,rn.AFTER);return n&&t.appendChild(n),this.counters.pop(e),B&&(this.options.copyStyles||Vr(A))&&!Wr(A)&&dn(B,t),0===A.scrollTop&&0===A.scrollLeft||this.scrolledElements.push([t,A.scrollLeft,A.scrollTop]),(Zr(A)||_r(A))&&(Zr(t)||_r(t))&&(t.value=A.value),t}return A.cloneNode(!1)},Un.prototype.resolvePseudoContent=function(o,A,e,t){var i=this;if(e){var B=e.content,Q=A.ownerDocument;if(Q&&B&&"none"!==B&&"-moz-alt-content"!==B&&"none"!==e.display){this.counters.parse(new iB(this.context,e));var c=new oB(this.context,e),a=Q.createElement("html2canvaspseudoelement");dn(e,a),c.content.forEach(function(A){if(0===A.type)a.appendChild(Q.createTextNode(A.value));else if(22===A.type){var e=Q.createElement("img");e.src=A.value,e.style.opacity="1",a.appendChild(e)}else if(18===A.type){var t,B,r,n,s;"attr"===A.name?(e=A.values.filter(NA)).length&&a.appendChild(Q.createTextNode(o.getAttribute(e[0].value)||"")):"counter"===A.name?(r=(B=A.values.filter(WA))[0],B=B[1],r&&NA(r)&&(t=i.counters.getCounterValue(r.value),s=B&&NA(B)?ut.parse(i.context,B.value):3,a.appendChild(Q.createTextNode(an(t,s,!1))))):"counters"===A.name&&(r=(t=A.values.filter(WA))[0],s=t[1],B=t[2],r&&NA(r)&&(r=i.counters.getCounterValues(r.value),n=B&&NA(B)?ut.parse(i.context,B.value):3,s=s&&0===s.type?s.value:"",s=r.map(function(A){return an(A,n,!1)}).join(s),a.appendChild(Q.createTextNode(s))))}else if(20===A.type)switch(A.value){case"open-quote":a.appendChild(Q.createTextNode(Ot(c.quotes,i.quoteDepth++,!0)));break;case"close-quote":a.appendChild(Q.createTextNode(Ot(c.quotes,--i.quoteDepth,!1)));break;default:a.appendChild(Q.createTextNode(A.value))}}),a.className=En+" "+In;t=t===rn.BEFORE?" "+En:" "+In;return Vr(A)?A.className.baseValue+=t:A.className+=t,a}}},Un.destroy=function(A){return!!A.parentNode&&(A.parentNode.removeChild(A),!0)},Un);function Un(A,e,t){if(this.context=A,this.options=t,this.scrolledElements=[],this.referenceElement=e,this.counters=new jr,this.quoteDepth=0,!e.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(e.ownerDocument.documentElement)}(we=rn=rn||{})[we.BEFORE=0]="BEFORE",we[we.AFTER=1]="AFTER";function Cn(e){return new Promise(function(A){!e.complete&&e.src?(e.onload=A,e.onerror=A):A()})}var ln=function(A,e){var t=A.createElement("iframe");return t.className="html2canvas-container",t.style.visibility="hidden",t.style.position="fixed",t.style.left="-10000px",t.style.top="0px",t.style.border="0",t.width=e.width.toString(),t.height=e.height.toString(),t.scrolling="no",t.setAttribute(gn,"true"),A.body.appendChild(t),t},un=function(A){return Promise.all([].slice.call(A.images,0).map(Cn))},Fn=function(r){return new Promise(function(e,A){var t=r.contentWindow;if(!t)return A("No window assigned for iframe");var B=t.document;t.onload=r.onload=function(){t.onload=r.onload=null;var A=setInterval(function(){0<B.body.childNodes.length&&"complete"===B.readyState&&(clearInterval(A),e(r))},50)}})},hn=["all","d","content"],dn=function(A,e){for(var t=A.length-1;0<=t;t--){var B=A.item(t);-1===hn.indexOf(B)&&e.style.setProperty(B,A.getPropertyValue(B))}return e},fn=function(A){var e="";return A&&(e+="<!DOCTYPE ",A.name&&(e+=A.name),A.internalSubset&&(e+=A.internalSubset),A.publicId&&(e+='"'+A.publicId+'"'),A.systemId&&(e+='"'+A.systemId+'"'),e+=">"),e},Hn=function(A,e,t){A&&A.defaultView&&(e!==A.defaultView.pageXOffset||t!==A.defaultView.pageYOffset)&&A.defaultView.scrollTo(e,t)},pn=function(A){var e=A[0],t=A[1],A=A[2];e.scrollLeft=t,e.scrollTop=A},En="___html2canvas___pseudoelement_before",In="___html2canvas___pseudoelement_after",yn='{\n    content: "" !important;\n    display: none !important;\n}',Kn=function(A){mn(A,"."+En+":before"+yn+"\n         ."+In+":after"+yn)},mn=function(A,e){var t=A.ownerDocument;t&&((t=t.createElement("style")).textContent=e,A.appendChild(t))},Ln=(bn.getOrigin=function(A){var e=bn._link;return e?(e.href=A,e.href=e.href,e.protocol+e.hostname+e.port):"about:blank"},bn.isSameOrigin=function(A){return bn.getOrigin(A)===bn._origin},bn.setContext=function(A){bn._link=A.document.createElement("a"),bn._origin=bn.getOrigin(A.location.href)},bn._origin="about:blank",bn);function bn(){}var Dn=(vn.prototype.addImage=function(A){var e=Promise.resolve();return this.has(A)||(Vn(A)||Tn(A))&&(this._cache[A]=this.loadImage(A)).catch(function(){}),e},vn.prototype.match=function(A){return this._cache[A]},vn.prototype.loadImage=function(s){return a(this,void 0,void 0,function(){var e,B,t,r,n=this;return H(this,function(A){switch(A.label){case 0:return(e=Ln.isSameOrigin(s),B=!Gn(s)&&!0===this._options.useCORS&&VB.SUPPORT_CORS_IMAGES&&!e,t=!Gn(s)&&!e&&!Vn(s)&&"string"==typeof this._options.proxy&&VB.SUPPORT_CORS_XHR&&!B,e||!1!==this._options.allowTaint||Gn(s)||Vn(s)||t||B)?(r=s,t?[4,this.proxy(r)]:[3,2]):[2];case 1:r=A.sent(),A.label=2;case 2:return this.context.logger.debug("Added image "+s.substring(0,256)),[4,new Promise(function(A,e){var t=new Image;t.onload=function(){return A(t)},t.onerror=e,(On(r)||B)&&(t.crossOrigin="anonymous"),t.src=r,!0===t.complete&&setTimeout(function(){return A(t)},500),0<n._options.imageTimeout&&setTimeout(function(){return e("Timed out ("+n._options.imageTimeout+"ms) loading image")},n._options.imageTimeout)})];case 3:return[2,A.sent()]}})})},vn.prototype.has=function(A){return void 0!==this._cache[A]},vn.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},vn.prototype.proxy=function(s){var o=this,i=this._options.proxy;if(!i)throw new Error("No proxy defined");var Q=s.substring(0,256);return new Promise(function(e,t){var B=VB.SUPPORT_RESPONSE_TYPE?"blob":"text",r=new XMLHttpRequest;r.onload=function(){var A;200===r.status?"text"==B?e(r.response):((A=new FileReader).addEventListener("load",function(){return e(A.result)},!1),A.addEventListener("error",function(A){return t(A)},!1),A.readAsDataURL(r.response)):t("Failed to proxy resource "+Q+" with status code "+r.status)},r.onerror=t;var A,n=-1<i.indexOf("?")?"&":"?";r.open("GET",i+n+"url="+encodeURIComponent(s)+"&responseType="+B),"text"!=B&&r instanceof XMLHttpRequest&&(r.responseType=B),o._options.imageTimeout&&(A=o._options.imageTimeout,r.timeout=A,r.ontimeout=function(){return t("Timed out ("+A+"ms) proxying "+Q)}),r.send()})},vn);function vn(A,e){this.context=A,this._options=e,this._cache={}}var xn=/^data:image\/svg\+xml/i,Mn=/^data:image\/.*;base64,/i,Sn=/^data:image\/.*/i,Tn=function(A){return VB.SUPPORT_SVG_DRAWING||!kn(A)},Gn=function(A){return Sn.test(A)},On=function(A){return Mn.test(A)},Vn=function(A){return"blob"===A.substr(0,4)},kn=function(A){return"svg"===A.substr(-3).toLowerCase()||xn.test(A)},Rn=(Pn.prototype.add=function(A,e){return new Pn(this.x+A,this.y+e)},Pn);function Pn(A,e){this.type=0,this.x=A,this.y=e}function Nn(A,e,t){return new Rn(A.x+(e.x-A.x)*t,A.y+(e.y-A.y)*t)}var Xn=(Jn.prototype.subdivide=function(A,e){var t=Nn(this.start,this.startControl,A),B=Nn(this.startControl,this.endControl,A),r=Nn(this.endControl,this.end,A),n=Nn(t,B,A),B=Nn(B,r,A),A=Nn(n,B,A);return e?new Jn(this.start,t,n,A):new Jn(A,B,r,this.end)},Jn.prototype.add=function(A,e){return new Jn(this.start.add(A,e),this.startControl.add(A,e),this.endControl.add(A,e),this.end.add(A,e))},Jn.prototype.reverse=function(){return new Jn(this.end,this.endControl,this.startControl,this.start)},Jn);function Jn(A,e,t,B){this.type=1,this.start=A,this.startControl=e,this.endControl=t,this.end=B}function Yn(A){return 1===A.type}var Wn,Zn=function(A){var e=A.styles,t=A.bounds,B=(l=zA(e.borderTopLeftRadius,t.width,t.height))[0],r=l[1],n=(u=zA(e.borderTopRightRadius,t.width,t.height))[0],s=u[1],o=(F=zA(e.borderBottomRightRadius,t.width,t.height))[0],i=F[1],Q=(h=zA(e.borderBottomLeftRadius,t.width,t.height))[0],c=h[1];(d=[]).push((B+n)/t.width),d.push((Q+o)/t.width),d.push((r+c)/t.height),d.push((s+i)/t.height),1<(f=Math.max.apply(Math,d))&&(B/=f,r/=f,n/=f,s/=f,o/=f,i/=f,Q/=f,c/=f);var a=t.width-n,g=t.height-i,w=t.width-o,U=t.height-c,C=e.borderTopWidth,l=e.borderRightWidth,u=e.borderBottomWidth,F=e.borderLeftWidth,h=ie(e.paddingTop,A.bounds.width),d=ie(e.paddingRight,A.bounds.width),f=ie(e.paddingBottom,A.bounds.width),A=ie(e.paddingLeft,A.bounds.width);this.topLeftBorderDoubleOuterBox=0<B||0<r?$n(t.left+F/3,t.top+C/3,B-F/3,r-C/3,Wn.TOP_LEFT):new Rn(t.left+F/3,t.top+C/3),this.topRightBorderDoubleOuterBox=0<B||0<r?$n(t.left+a,t.top+C/3,n-l/3,s-C/3,Wn.TOP_RIGHT):new Rn(t.left+t.width-l/3,t.top+C/3),this.bottomRightBorderDoubleOuterBox=0<o||0<i?$n(t.left+w,t.top+g,o-l/3,i-u/3,Wn.BOTTOM_RIGHT):new Rn(t.left+t.width-l/3,t.top+t.height-u/3),this.bottomLeftBorderDoubleOuterBox=0<Q||0<c?$n(t.left+F/3,t.top+U,Q-F/3,c-u/3,Wn.BOTTOM_LEFT):new Rn(t.left+F/3,t.top+t.height-u/3),this.topLeftBorderDoubleInnerBox=0<B||0<r?$n(t.left+2*F/3,t.top+2*C/3,B-2*F/3,r-2*C/3,Wn.TOP_LEFT):new Rn(t.left+2*F/3,t.top+2*C/3),this.topRightBorderDoubleInnerBox=0<B||0<r?$n(t.left+a,t.top+2*C/3,n-2*l/3,s-2*C/3,Wn.TOP_RIGHT):new Rn(t.left+t.width-2*l/3,t.top+2*C/3),this.bottomRightBorderDoubleInnerBox=0<o||0<i?$n(t.left+w,t.top+g,o-2*l/3,i-2*u/3,Wn.BOTTOM_RIGHT):new Rn(t.left+t.width-2*l/3,t.top+t.height-2*u/3),this.bottomLeftBorderDoubleInnerBox=0<Q||0<c?$n(t.left+2*F/3,t.top+U,Q-2*F/3,c-2*u/3,Wn.BOTTOM_LEFT):new Rn(t.left+2*F/3,t.top+t.height-2*u/3),this.topLeftBorderStroke=0<B||0<r?$n(t.left+F/2,t.top+C/2,B-F/2,r-C/2,Wn.TOP_LEFT):new Rn(t.left+F/2,t.top+C/2),this.topRightBorderStroke=0<B||0<r?$n(t.left+a,t.top+C/2,n-l/2,s-C/2,Wn.TOP_RIGHT):new Rn(t.left+t.width-l/2,t.top+C/2),this.bottomRightBorderStroke=0<o||0<i?$n(t.left+w,t.top+g,o-l/2,i-u/2,Wn.BOTTOM_RIGHT):new Rn(t.left+t.width-l/2,t.top+t.height-u/2),this.bottomLeftBorderStroke=0<Q||0<c?$n(t.left+F/2,t.top+U,Q-F/2,c-u/2,Wn.BOTTOM_LEFT):new Rn(t.left+F/2,t.top+t.height-u/2),this.topLeftBorderBox=0<B||0<r?$n(t.left,t.top,B,r,Wn.TOP_LEFT):new Rn(t.left,t.top),this.topRightBorderBox=0<n||0<s?$n(t.left+a,t.top,n,s,Wn.TOP_RIGHT):new Rn(t.left+t.width,t.top),this.bottomRightBorderBox=0<o||0<i?$n(t.left+w,t.top+g,o,i,Wn.BOTTOM_RIGHT):new Rn(t.left+t.width,t.top+t.height),this.bottomLeftBorderBox=0<Q||0<c?$n(t.left,t.top+U,Q,c,Wn.BOTTOM_LEFT):new Rn(t.left,t.top+t.height),this.topLeftPaddingBox=0<B||0<r?$n(t.left+F,t.top+C,Math.max(0,B-F),Math.max(0,r-C),Wn.TOP_LEFT):new Rn(t.left+F,t.top+C),this.topRightPaddingBox=0<n||0<s?$n(t.left+Math.min(a,t.width-l),t.top+C,a>t.width+l?0:Math.max(0,n-l),Math.max(0,s-C),Wn.TOP_RIGHT):new Rn(t.left+t.width-l,t.top+C),this.bottomRightPaddingBox=0<o||0<i?$n(t.left+Math.min(w,t.width-F),t.top+Math.min(g,t.height-u),Math.max(0,o-l),Math.max(0,i-u),Wn.BOTTOM_RIGHT):new Rn(t.left+t.width-l,t.top+t.height-u),this.bottomLeftPaddingBox=0<Q||0<c?$n(t.left+F,t.top+Math.min(U,t.height-u),Math.max(0,Q-F),Math.max(0,c-u),Wn.BOTTOM_LEFT):new Rn(t.left+F,t.top+t.height-u),this.topLeftContentBox=0<B||0<r?$n(t.left+F+A,t.top+C+h,Math.max(0,B-(F+A)),Math.max(0,r-(C+h)),Wn.TOP_LEFT):new Rn(t.left+F+A,t.top+C+h),this.topRightContentBox=0<n||0<s?$n(t.left+Math.min(a,t.width+F+A),t.top+C+h,a>t.width+F+A?0:n-F+A,s-(C+h),Wn.TOP_RIGHT):new Rn(t.left+t.width-(l+d),t.top+C+h),this.bottomRightContentBox=0<o||0<i?$n(t.left+Math.min(w,t.width-(F+A)),t.top+Math.min(g,t.height+C+h),Math.max(0,o-(l+d)),i-(u+f),Wn.BOTTOM_RIGHT):new Rn(t.left+t.width-(l+d),t.top+t.height-(u+f)),this.bottomLeftContentBox=0<Q||0<c?$n(t.left+F+A,t.top+U,Math.max(0,Q-(F+A)),c-(u+f),Wn.BOTTOM_LEFT):new Rn(t.left+F+A,t.top+t.height-(u+f))};(we=Wn=Wn||{})[we.TOP_LEFT=0]="TOP_LEFT",we[we.TOP_RIGHT=1]="TOP_RIGHT",we[we.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",we[we.BOTTOM_LEFT=3]="BOTTOM_LEFT";function _n(A){return[A.topLeftBorderBox,A.topRightBorderBox,A.bottomRightBorderBox,A.bottomLeftBorderBox]}function qn(A){return[A.topLeftPaddingBox,A.topRightPaddingBox,A.bottomRightPaddingBox,A.bottomLeftPaddingBox]}function jn(A){return 1===A.type}function zn(A,t){return A.length===t.length&&A.some(function(A,e){return A===t[e]})}var $n=function(A,e,t,B,r){var n=(Math.sqrt(2)-1)/3*4,s=t*n,o=B*n,i=A+t,Q=e+B;switch(r){case Wn.TOP_LEFT:return new Xn(new Rn(A,Q),new Rn(A,Q-o),new Rn(i-s,e),new Rn(i,e));case Wn.TOP_RIGHT:return new Xn(new Rn(A,e),new Rn(A+s,e),new Rn(i,Q-o),new Rn(i,Q));case Wn.BOTTOM_RIGHT:return new Xn(new Rn(i,e),new Rn(i,e+o),new Rn(A+s,Q),new Rn(A,Q));default:Wn.BOTTOM_LEFT;return new Xn(new Rn(i,Q),new Rn(i-s,Q),new Rn(A,e+o),new Rn(A,e))}},As=function(A,e,t){this.offsetX=A,this.offsetY=e,this.matrix=t,this.type=0,this.target=6},es=function(A,e){this.path=A,this.target=e,this.type=1},ts=function(A){this.opacity=A,this.type=2,this.target=6},Bs=function(A){this.element=A,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]},rs=(ns.prototype.getEffects=function(e){for(var A=-1===[2,3].indexOf(this.container.styles.position),t=this.parent,B=this.effects.slice(0);t;){var r,n,s=t.effects.filter(function(A){return!jn(A)});A||0!==t.container.styles.position||!t.parent?(B.unshift.apply(B,s),A=-1===[2,3].indexOf(t.container.styles.position),0!==t.container.styles.overflowX&&(r=_n(t.curves),n=qn(t.curves),zn(r,n)||B.unshift(new es(n,6)))):B.unshift.apply(B,s),t=t.parent}return B.filter(function(A){return Gt(A.target,e)})},ns);function ns(A,e){var t,B;this.container=A,this.parent=e,this.effects=[],this.curves=new Zn(this.container),this.container.styles.opacity<1&&this.effects.push(new ts(this.container.styles.opacity)),null!==this.container.styles.transform&&(e=this.container.bounds.left+this.container.styles.transformOrigin[0].number,t=this.container.bounds.top+this.container.styles.transformOrigin[1].number,B=this.container.styles.transform,this.effects.push(new As(e,t,B))),0!==this.container.styles.overflowX&&(t=_n(this.curves),B=qn(this.curves),zn(t,B)?this.effects.push(new es(t,6)):(this.effects.push(new es(t,2)),this.effects.push(new es(B,4))))}function ss(A,e){switch(e){case 0:return Cs(A.topLeftBorderBox,A.topLeftPaddingBox,A.topRightBorderBox,A.topRightPaddingBox);case 1:return Cs(A.topRightBorderBox,A.topRightPaddingBox,A.bottomRightBorderBox,A.bottomRightPaddingBox);case 2:return Cs(A.bottomRightBorderBox,A.bottomRightPaddingBox,A.bottomLeftBorderBox,A.bottomLeftPaddingBox);default:return Cs(A.bottomLeftBorderBox,A.bottomLeftPaddingBox,A.topLeftBorderBox,A.topLeftPaddingBox)}}function os(A){var e=A.bounds,A=A.styles;return e.add(A.borderLeftWidth,A.borderTopWidth,-(A.borderRightWidth+A.borderLeftWidth),-(A.borderTopWidth+A.borderBottomWidth))}function is(A){var e=A.styles,t=A.bounds,B=ie(e.paddingLeft,t.width),r=ie(e.paddingRight,t.width),n=ie(e.paddingTop,t.width),A=ie(e.paddingBottom,t.width);return t.add(B+e.borderLeftWidth,n+e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth+B+r),-(e.borderTopWidth+e.borderBottomWidth+n+A))}function Qs(A,e,t){var B=(r=us(A.styles.backgroundOrigin,e),n=A,0===r?n.bounds:(2===r?is:os)(n)),r=(s=us(A.styles.backgroundClip,e),o=A,0===s?o.bounds:(2===s?is:os)(o)),n=ls(us(A.styles.backgroundSize,e),t,B),s=n[0],o=n[1],t=zA(us(A.styles.backgroundPosition,e),B.width-s,B.height-o);return[Fs(us(A.styles.backgroundRepeat,e),t,n,B,r),Math.round(B.left+t[0]),Math.round(B.top+t[1]),s,o]}function cs(A){return NA(A)&&A.value===xe.AUTO}function as(A){return"number"==typeof A}var gs=function(Q,c,a,g){Q.container.elements.forEach(function(A){var e=Gt(A.flags,4),t=Gt(A.flags,2),B=new rs(A,Q);Gt(A.styles.display,2048)&&g.push(B);var r,n,s,o,i=Gt(A.flags,8)?[]:g;e||t?(r=e||A.styles.isPositioned()?a:c,t=new Bs(B),A.styles.isPositioned()||A.styles.opacity<1||A.styles.isTransformed()?(n=A.styles.zIndex.order)<0?(s=0,r.negativeZIndex.some(function(A,e){return n>A.element.container.styles.zIndex.order?(s=e,!1):0<s}),r.negativeZIndex.splice(s,0,t)):0<n?(o=0,r.positiveZIndex.some(function(A,e){return n>=A.element.container.styles.zIndex.order?(o=e+1,!1):0<o}),r.positiveZIndex.splice(o,0,t)):r.zeroOrAutoZIndexOrTransformedOrOpacity.push(t):(A.styles.isFloating()?r.nonPositionedFloats:r.nonPositionedInlineLevel).push(t),gs(B,t,e?t:a,i)):((A.styles.isInlineLevel()?c.inlineLevel:c.nonInlineLevel).push(B),gs(B,c,a,i)),Gt(A.flags,8)&&ws(A,i)})},ws=function(A,e){for(var t=A instanceof Qr?A.start:1,B=A instanceof Qr&&A.reversed,r=0;r<e.length;r++){var n=e[r];n.container instanceof sr&&"number"==typeof n.container.value&&0!==n.container.value&&(t=n.container.value),n.listValue=an(t,n.container.styles.listStyleType,!0),t+=B?-1:1}},Us=function(A,e){var t=[];return Yn(A)?t.push(A.subdivide(.5,!1)):t.push(A),Yn(e)?t.push(e.subdivide(.5,!0)):t.push(e),t},Cs=function(A,e,t,B){var r=[];return Yn(A)?r.push(A.subdivide(.5,!1)):r.push(A),Yn(t)?r.push(t.subdivide(.5,!0)):r.push(t),Yn(B)?r.push(B.subdivide(.5,!0).reverse()):r.push(B),Yn(e)?r.push(e.subdivide(.5,!1).reverse()):r.push(e),r},ls=function(A,e,t){var B=e[0],r=e[1],n=e[2],s=A[0],o=A[1];if(!s)return[0,0];if(qA(s)&&o&&qA(o))return[ie(s,t.width),ie(o,t.height)];var i=as(n);if(NA(s)&&(s.value===xe.CONTAIN||s.value===xe.COVER))return as(n)?t.width/t.height<n!=(s.value===xe.COVER)?[t.width,t.width/n]:[t.height*n,t.height]:[t.width,t.height];var Q=as(B),e=as(r),A=Q||e;if(cs(s)&&(!o||cs(o)))return Q&&e?[B,r]:i||A?A&&i?[Q?B:r*n,e?r:B/n]:[Q?B:t.width,e?r:t.height]:[t.width,t.height];if(i){var c=0,a=0;return qA(s)?c=ie(s,t.width):qA(o)&&(a=ie(o,t.height)),cs(s)?c=a*n:o&&!cs(o)||(a=c/n),[c,a]}c=null,a=null;if(qA(s)?c=ie(s,t.width):o&&qA(o)&&(a=ie(o,t.height)),null!==(c=null!==(a=null!==c&&(!o||cs(o))?Q&&e?c/B*r:t.height:a)&&cs(s)?Q&&e?a/r*B:t.width:c)&&null!==a)return[c,a];throw new Error("Unable to calculate background-size for element")},us=function(A,e){e=A[e];return void 0===e?A[0]:e},Fs=function(A,e,t,B,r){var n=e[0],s=e[1],o=t[0],i=t[1];switch(A){case 2:return[new Rn(Math.round(B.left),Math.round(B.top+s)),new Rn(Math.round(B.left+B.width),Math.round(B.top+s)),new Rn(Math.round(B.left+B.width),Math.round(i+B.top+s)),new Rn(Math.round(B.left),Math.round(i+B.top+s))];case 3:return[new Rn(Math.round(B.left+n),Math.round(B.top)),new Rn(Math.round(B.left+n+o),Math.round(B.top)),new Rn(Math.round(B.left+n+o),Math.round(B.height+B.top)),new Rn(Math.round(B.left+n),Math.round(B.height+B.top))];case 1:return[new Rn(Math.round(B.left+n),Math.round(B.top+s)),new Rn(Math.round(B.left+n+o),Math.round(B.top+s)),new Rn(Math.round(B.left+n+o),Math.round(B.top+s+i)),new Rn(Math.round(B.left+n),Math.round(B.top+s+i))];default:return[new Rn(Math.round(r.left),Math.round(r.top)),new Rn(Math.round(r.left+r.width),Math.round(r.top)),new Rn(Math.round(r.left+r.width),Math.round(r.height+r.top)),new Rn(Math.round(r.left),Math.round(r.height+r.top))]}},hs="Hidden Text",ds=(fs.prototype.parseMetrics=function(A,e){var t=this._document.createElement("div"),B=this._document.createElement("img"),r=this._document.createElement("span"),n=this._document.body;t.style.visibility="hidden",t.style.fontFamily=A,t.style.fontSize=e,t.style.margin="0",t.style.padding="0",n.appendChild(t),B.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",B.width=1,B.height=1,B.style.margin="0",B.style.padding="0",B.style.verticalAlign="baseline",r.style.fontFamily=A,r.style.fontSize=e,r.style.margin="0",r.style.padding="0",r.appendChild(this._document.createTextNode(hs)),t.appendChild(r),t.appendChild(B);e=B.offsetTop-r.offsetTop+2;t.removeChild(r),t.appendChild(this._document.createTextNode(hs)),t.style.lineHeight="normal",B.style.verticalAlign="super";B=B.offsetTop-t.offsetTop+2;return n.removeChild(t),{baseline:e,middle:B}},fs.prototype.getMetrics=function(A,e){var t=A+" "+e;return void 0===this._data[t]&&(this._data[t]=this.parseMetrics(A,e)),this._data[t]},fs);function fs(A){this._data={},this._document=A}var Hs,we=function(A,e){this.context=A,this.options=e},ps=(A(Es,Hs=we),Es.prototype.applyEffects=function(A){for(var e=this;this._activeEffects.length;)this.popEffect();A.forEach(function(A){return e.applyEffect(A)})},Es.prototype.applyEffect=function(A){this.ctx.save(),2===A.type&&(this.ctx.globalAlpha=A.opacity),0===A.type&&(this.ctx.translate(A.offsetX,A.offsetY),this.ctx.transform(A.matrix[0],A.matrix[1],A.matrix[2],A.matrix[3],A.matrix[4],A.matrix[5]),this.ctx.translate(-A.offsetX,-A.offsetY)),jn(A)&&(this.path(A.path),this.ctx.clip()),this._activeEffects.push(A)},Es.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},Es.prototype.renderStack=function(e){return a(this,void 0,void 0,function(){return H(this,function(A){switch(A.label){case 0:return e.element.container.styles.isVisible()?[4,this.renderStackContent(e)]:[3,2];case 1:A.sent(),A.label=2;case 2:return[2]}})})},Es.prototype.renderNode=function(e){return a(this,void 0,void 0,function(){return H(this,function(A){switch(A.label){case 0:return Gt(e.container.flags,16),e.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(e)]:[3,3];case 1:return A.sent(),[4,this.renderNodeContent(e)];case 2:A.sent(),A.label=3;case 3:return[2]}})})},Es.prototype.renderTextWithLetterSpacing=function(t,A,B){var r=this;0===A?this.ctx.fillText(t.text,t.bounds.left,t.bounds.top+B):pB(t.text).reduce(function(A,e){return r.ctx.fillText(e,A,t.bounds.top+B),A+r.ctx.measureText(e).width},t.bounds.left)},Es.prototype.createFontStyle=function(A){var e=A.fontVariant.filter(function(A){return"normal"===A||"small-caps"===A}).join(""),t=A.fontFamily.join(", "),B=RA(A.fontSize)?""+A.fontSize.number+A.fontSize.unit:A.fontSize.number+"px";return[[A.fontStyle,e,A.fontWeight,B,t].join(" "),t,B]},Es.prototype.renderTextNode=function(i,Q){return a(this,void 0,void 0,function(){var e,t,B,r,n,s,o=this;return H(this,function(A){return B=this.createFontStyle(Q),e=B[0],t=B[1],B=B[2],this.ctx.font=e,this.ctx.direction=1===Q.direction?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",B=this.fontMetrics.getMetrics(t,B),r=B.baseline,n=B.middle,s=Q.paintOrder,i.textBounds.forEach(function(t){s.forEach(function(A){switch(A){case 0:o.ctx.fillStyle=te(Q.color),o.renderTextWithLetterSpacing(t,Q.letterSpacing,r);var e=Q.textShadow;e.length&&t.text.trim().length&&(e.slice(0).reverse().forEach(function(A){o.ctx.shadowColor=te(A.color),o.ctx.shadowOffsetX=A.offsetX.number*o.options.scale,o.ctx.shadowOffsetY=A.offsetY.number*o.options.scale,o.ctx.shadowBlur=A.blur.number,o.renderTextWithLetterSpacing(t,Q.letterSpacing,r)}),o.ctx.shadowColor="",o.ctx.shadowOffsetX=0,o.ctx.shadowOffsetY=0,o.ctx.shadowBlur=0),Q.textDecorationLine.length&&(o.ctx.fillStyle=te(Q.textDecorationColor||Q.color),Q.textDecorationLine.forEach(function(A){switch(A){case 1:o.ctx.fillRect(t.bounds.left,Math.round(t.bounds.top+r),t.bounds.width,1);break;case 2:o.ctx.fillRect(t.bounds.left,Math.round(t.bounds.top),t.bounds.width,1);break;case 3:o.ctx.fillRect(t.bounds.left,Math.ceil(t.bounds.top+n),t.bounds.width,1)}}));break;case 1:Q.webkitTextStrokeWidth&&t.text.trim().length&&(o.ctx.strokeStyle=te(Q.webkitTextStrokeColor),o.ctx.lineWidth=Q.webkitTextStrokeWidth,o.ctx.lineJoin=window.chrome?"miter":"round",o.ctx.strokeText(t.text,t.bounds.left,t.bounds.top+r)),o.ctx.strokeStyle="",o.ctx.lineWidth=0,o.ctx.lineJoin="miter"}})}),[2]})})},Es.prototype.renderReplacedElement=function(A,e,t){var B;t&&0<A.intrinsicWidth&&0<A.intrinsicHeight&&(B=is(A),e=qn(e),this.path(e),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(t,0,0,A.intrinsicWidth,A.intrinsicHeight,B.left,B.top,B.width,B.height),this.ctx.restore())},Es.prototype.renderNodeContent=function(w){return a(this,void 0,void 0,function(){var e,t,B,r,n,s,o,i,Q,c,a,g;return H(this,function(A){switch(A.label){case 0:this.applyEffects(w.getEffects(4)),e=w.container,t=w.curves,B=e.styles,r=0,n=e.textNodes,A.label=1;case 1:return r<n.length?(s=n[r],[4,this.renderTextNode(s,B)]):[3,4];case 2:A.sent(),A.label=3;case 3:return r++,[3,1];case 4:if(!(e instanceof jB))return[3,8];A.label=5;case 5:return A.trys.push([5,7,,8]),[4,this.context.cache.match(e.src)];case 6:return Q=A.sent(),this.renderReplacedElement(e,t,Q),[3,8];case 7:return A.sent(),this.context.logger.error("Error loading image "+e.src),[3,8];case 8:if(e instanceof Ar&&this.renderReplacedElement(e,t,e.canvas),!(e instanceof Br))return[3,12];A.label=9;case 9:return A.trys.push([9,11,,12]),[4,this.context.cache.match(e.svg)];case 10:return Q=A.sent(),this.renderReplacedElement(e,t,Q),[3,12];case 11:return A.sent(),this.context.logger.error("Error loading svg "+e.svg.substring(0,255)),[3,12];case 12:return e instanceof Kr&&e.tree?[4,new Es(this.context,{scale:this.options.scale,backgroundColor:e.backgroundColor,x:0,y:0,width:e.width,height:e.height}).render(e.tree)]:[3,14];case 13:s=A.sent(),e.width&&e.height&&this.ctx.drawImage(s,0,0,e.width,e.height,e.bounds.left,e.bounds.top,e.bounds.width,e.bounds.height),A.label=14;case 14:if(e instanceof Fr&&(i=Math.min(e.bounds.width,e.bounds.height),e.type===Ur?e.checked&&(this.ctx.save(),this.path([new Rn(e.bounds.left+.39363*i,e.bounds.top+.79*i),new Rn(e.bounds.left+.16*i,e.bounds.top+.5549*i),new Rn(e.bounds.left+.27347*i,e.bounds.top+.44071*i),new Rn(e.bounds.left+.39694*i,e.bounds.top+.5649*i),new Rn(e.bounds.left+.72983*i,e.bounds.top+.23*i),new Rn(e.bounds.left+.84*i,e.bounds.top+.34085*i),new Rn(e.bounds.left+.39363*i,e.bounds.top+.79*i)]),this.ctx.fillStyle=te(ur),this.ctx.fill(),this.ctx.restore()):e.type===Cr&&e.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(e.bounds.left+i/2,e.bounds.top+i/2,i/4,0,2*Math.PI,!0),this.ctx.fillStyle=te(ur),this.ctx.fill(),this.ctx.restore())),ys(e)&&e.value.length){switch(c=this.createFontStyle(B),a=c[0],i=c[1],c=this.fontMetrics.getMetrics(a,i).baseline,this.ctx.font=a,this.ctx.fillStyle=te(B.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=ms(e.styles.textAlign),g=is(e),o=0,e.styles.textAlign){case 1:o+=g.width/2;break;case 2:o+=g.width}i=g.add(o,0,0,-g.height/2+1),this.ctx.save(),this.path([new Rn(g.left,g.top),new Rn(g.left+g.width,g.top),new Rn(g.left+g.width,g.top+g.height),new Rn(g.left,g.top+g.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new kB(e.value,i),B.letterSpacing,c),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!Gt(e.styles.display,2048))return[3,20];if(null===e.styles.listStyleImage)return[3,19];if(0!==(c=e.styles.listStyleImage).type)return[3,18];Q=void 0,c=c.url,A.label=15;case 15:return A.trys.push([15,17,,18]),[4,this.context.cache.match(c)];case 16:return Q=A.sent(),this.ctx.drawImage(Q,e.bounds.left-(Q.width+10),e.bounds.top),[3,18];case 17:return A.sent(),this.context.logger.error("Error loading list-style-image "+c),[3,18];case 18:return[3,20];case 19:w.listValue&&-1!==e.styles.listStyleType&&(a=this.createFontStyle(B)[0],this.ctx.font=a,this.ctx.fillStyle=te(B.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",g=new d(e.bounds.left,e.bounds.top+ie(e.styles.paddingTop,e.bounds.width),e.bounds.width,ke(B.lineHeight,B.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new kB(w.listValue,g),B.letterSpacing,ke(B.lineHeight,B.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),A.label=20;case 20:return[2]}})})},Es.prototype.renderStackContent=function(l){return a(this,void 0,void 0,function(){var e,t,B,r,n,s,o,i,Q,c,a,g,w,U,C;return H(this,function(A){switch(A.label){case 0:return Gt(l.element.container.flags,16),[4,this.renderNodeBackgroundAndBorders(l.element)];case 1:A.sent(),e=0,t=l.negativeZIndex,A.label=2;case 2:return e<t.length?(C=t[e],[4,this.renderStack(C)]):[3,5];case 3:A.sent(),A.label=4;case 4:return e++,[3,2];case 5:return[4,this.renderNodeContent(l.element)];case 6:A.sent(),B=0,r=l.nonInlineLevel,A.label=7;case 7:return B<r.length?(C=r[B],[4,this.renderNode(C)]):[3,10];case 8:A.sent(),A.label=9;case 9:return B++,[3,7];case 10:n=0,s=l.nonPositionedFloats,A.label=11;case 11:return n<s.length?(C=s[n],[4,this.renderStack(C)]):[3,14];case 12:A.sent(),A.label=13;case 13:return n++,[3,11];case 14:o=0,i=l.nonPositionedInlineLevel,A.label=15;case 15:return o<i.length?(C=i[o],[4,this.renderStack(C)]):[3,18];case 16:A.sent(),A.label=17;case 17:return o++,[3,15];case 18:Q=0,c=l.inlineLevel,A.label=19;case 19:return Q<c.length?(C=c[Q],[4,this.renderNode(C)]):[3,22];case 20:A.sent(),A.label=21;case 21:return Q++,[3,19];case 22:a=0,g=l.zeroOrAutoZIndexOrTransformedOrOpacity,A.label=23;case 23:return a<g.length?(C=g[a],[4,this.renderStack(C)]):[3,26];case 24:A.sent(),A.label=25;case 25:return a++,[3,23];case 26:w=0,U=l.positiveZIndex,A.label=27;case 27:return w<U.length?(C=U[w],[4,this.renderStack(C)]):[3,30];case 28:A.sent(),A.label=29;case 29:return w++,[3,27];case 30:return[2]}})})},Es.prototype.mask=function(A){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(A.slice(0).reverse()),this.ctx.closePath()},Es.prototype.path=function(A){this.ctx.beginPath(),this.formatPath(A),this.ctx.closePath()},Es.prototype.formatPath=function(A){var B=this;A.forEach(function(A,e){var t=Yn(A)?A.start:A;0===e?B.ctx.moveTo(t.x,t.y):B.ctx.lineTo(t.x,t.y),Yn(A)&&B.ctx.bezierCurveTo(A.startControl.x,A.startControl.y,A.endControl.x,A.endControl.y,A.end.x,A.end.y)})},Es.prototype.renderRepeat=function(A,e,t,B){this.path(A),this.ctx.fillStyle=e,this.ctx.translate(t,B),this.ctx.fill(),this.ctx.translate(-t,-B)},Es.prototype.resizeImage=function(A,e,t){if(A.width===e&&A.height===t)return A;var B=(null!==(B=this.canvas.ownerDocument)&&void 0!==B?B:document).createElement("canvas");return B.width=Math.max(1,e),B.height=Math.max(1,t),B.getContext("2d").drawImage(A,0,0,A.width,A.height,0,0,e,t),B},Es.prototype.renderBackgroundImage=function(f){return a(this,void 0,void 0,function(){var h,e,d,t,B,r;return H(this,function(A){switch(A.label){case 0:h=f.styles.backgroundImage.length-1,e=function(e){var t,B,r,n,s,o,i,Q,c,a,g,w,U,C,l,u,F;return H(this,function(A){switch(A.label){case 0:if(0!==e.type)return[3,5];t=void 0,B=e.url,A.label=1;case 1:return A.trys.push([1,3,,4]),[4,d.context.cache.match(B)];case 2:return t=A.sent(),[3,4];case 3:return A.sent(),d.context.logger.error("Error loading background-image "+B),[3,4];case 4:return t&&(r=Qs(f,h,[t.width,t.height,t.width/t.height]),o=r[0],g=r[1],w=r[2],c=r[3],a=r[4],s=d.ctx.createPattern(d.resizeImage(t,c,a),"repeat"),d.renderRepeat(o,s,g,w)),[3,6];case 5:1===e.type?(F=Qs(f,h,[null,null,null]),o=F[0],g=F[1],w=F[2],c=F[3],a=F[4],l=Fe(e.angle,c,a),C=l[0],r=l[1],i=l[2],u=l[3],Q=l[4],(F=document.createElement("canvas")).width=c,F.height=a,l=F.getContext("2d"),n=l.createLinearGradient(r,u,i,Q),ue(e.stops,C).forEach(function(A){return n.addColorStop(A.stop,te(A.color))}),l.fillStyle=n,l.fillRect(0,0,c,a),0<c&&0<a&&(s=d.ctx.createPattern(F,"repeat"),d.renderRepeat(o,s,g,w))):2===e.type&&(u=Qs(f,h,[null,null,null]),o=u[0],i=u[1],Q=u[2],c=u[3],a=u[4],C=0===e.position.length?[se]:e.position,g=ie(C[0],c),w=ie(C[C.length-1],a),l=function(A,e,t,B,r){var n,s,o,i,Q=0,c=0;switch(A.size){case 0:0===A.shape?Q=c=Math.min(Math.abs(e),Math.abs(e-B),Math.abs(t),Math.abs(t-r)):1===A.shape&&(Q=Math.min(Math.abs(e),Math.abs(e-B)),c=Math.min(Math.abs(t),Math.abs(t-r)));break;case 2:0===A.shape?Q=c=Math.min(he(e,t),he(e,t-r),he(e-B,t),he(e-B,t-r)):1===A.shape&&(n=Math.min(Math.abs(t),Math.abs(t-r))/Math.min(Math.abs(e),Math.abs(e-B)),o=(s=de(B,r,e,t,!0))[0],i=s[1],c=n*(Q=he(o-e,(i-t)/n)));break;case 1:0===A.shape?Q=c=Math.max(Math.abs(e),Math.abs(e-B),Math.abs(t),Math.abs(t-r)):1===A.shape&&(Q=Math.max(Math.abs(e),Math.abs(e-B)),c=Math.max(Math.abs(t),Math.abs(t-r)));break;case 3:0===A.shape?Q=c=Math.max(he(e,t),he(e,t-r),he(e-B,t),he(e-B,t-r)):1===A.shape&&(n=Math.max(Math.abs(t),Math.abs(t-r))/Math.max(Math.abs(e),Math.abs(e-B)),o=(s=de(B,r,e,t,!1))[0],i=s[1],c=n*(Q=he(o-e,(i-t)/n)))}return Array.isArray(A.size)&&(Q=ie(A.size[0],B),c=2===A.size.length?ie(A.size[1],r):Q),[Q,c]}(e,g,w,c,a),F=l[0],u=l[1],0<F&&0<u&&(U=d.ctx.createRadialGradient(i+g,Q+w,0,i+g,Q+w,F),ue(e.stops,2*F).forEach(function(A){return U.addColorStop(A.stop,te(A.color))}),d.path(o),d.ctx.fillStyle=U,F!==u?(C=f.bounds.left+.5*f.bounds.width,l=f.bounds.top+.5*f.bounds.height,F=1/(u=u/F),d.ctx.save(),d.ctx.translate(C,l),d.ctx.transform(1,0,0,u,0,0),d.ctx.translate(-C,-l),d.ctx.fillRect(i,F*(Q-l)+l,c,a*F),d.ctx.restore()):d.ctx.fill())),A.label=6;case 6:return h--,[2]}})},d=this,t=0,B=f.styles.backgroundImage.slice(0).reverse(),A.label=1;case 1:return t<B.length?(r=B[t],[5,e(r)]):[3,4];case 2:A.sent(),A.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},Es.prototype.renderSolidBorder=function(e,t,B){return a(this,void 0,void 0,function(){return H(this,function(A){return this.path(ss(B,t)),this.ctx.fillStyle=te(e),this.ctx.fill(),[2]})})},Es.prototype.renderDoubleBorder=function(t,B,r,n){return a(this,void 0,void 0,function(){var e;return H(this,function(A){switch(A.label){case 0:return B<3?[4,this.renderSolidBorder(t,r,n)]:[3,2];case 1:return A.sent(),[2];case 2:return e=function(A,e){switch(e){case 0:return Cs(A.topLeftBorderBox,A.topLeftBorderDoubleOuterBox,A.topRightBorderBox,A.topRightBorderDoubleOuterBox);case 1:return Cs(A.topRightBorderBox,A.topRightBorderDoubleOuterBox,A.bottomRightBorderBox,A.bottomRightBorderDoubleOuterBox);case 2:return Cs(A.bottomRightBorderBox,A.bottomRightBorderDoubleOuterBox,A.bottomLeftBorderBox,A.bottomLeftBorderDoubleOuterBox);default:return Cs(A.bottomLeftBorderBox,A.bottomLeftBorderDoubleOuterBox,A.topLeftBorderBox,A.topLeftBorderDoubleOuterBox)}}(n,r),this.path(e),this.ctx.fillStyle=te(t),this.ctx.fill(),e=function(A,e){switch(e){case 0:return Cs(A.topLeftBorderDoubleInnerBox,A.topLeftPaddingBox,A.topRightBorderDoubleInnerBox,A.topRightPaddingBox);case 1:return Cs(A.topRightBorderDoubleInnerBox,A.topRightPaddingBox,A.bottomRightBorderDoubleInnerBox,A.bottomRightPaddingBox);case 2:return Cs(A.bottomRightBorderDoubleInnerBox,A.bottomRightPaddingBox,A.bottomLeftBorderDoubleInnerBox,A.bottomLeftPaddingBox);default:return Cs(A.bottomLeftBorderDoubleInnerBox,A.bottomLeftPaddingBox,A.topLeftBorderDoubleInnerBox,A.topLeftPaddingBox)}}(n,r),this.path(e),this.ctx.fill(),[2]}})})},Es.prototype.renderNodeBackgroundAndBorders=function(c){return a(this,void 0,void 0,function(){var e,t,B,r,n,s,o,i,Q=this;return H(this,function(A){switch(A.label){case 0:return(this.applyEffects(c.getEffects(2)),e=c.container.styles,t=!ee(e.backgroundColor)||e.backgroundImage.length,B=[{style:e.borderTopStyle,color:e.borderTopColor,width:e.borderTopWidth},{style:e.borderRightStyle,color:e.borderRightColor,width:e.borderRightWidth},{style:e.borderBottomStyle,color:e.borderBottomColor,width:e.borderBottomWidth},{style:e.borderLeftStyle,color:e.borderLeftColor,width:e.borderLeftWidth}],r=Ks(us(e.backgroundClip,0),c.curves),t||e.boxShadow.length)?(this.ctx.save(),this.path(r),this.ctx.clip(),ee(e.backgroundColor)||(this.ctx.fillStyle=te(e.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(c.container)]):[3,2];case 1:A.sent(),this.ctx.restore(),e.boxShadow.slice(0).reverse().forEach(function(A){Q.ctx.save();var t,B,r,n,e=_n(c.curves),s=A.inset?0:1e4,o=(t=-s+(A.inset?1:-1)*A.spread.number,B=(A.inset?1:-1)*A.spread.number,r=A.spread.number*(A.inset?-2:2),n=A.spread.number*(A.inset?-2:2),e.map(function(A,e){switch(e){case 0:return A.add(t,B);case 1:return A.add(t+r,B);case 2:return A.add(t+r,B+n);case 3:return A.add(t,B+n)}return A}));A.inset?(Q.path(e),Q.ctx.clip(),Q.mask(o)):(Q.mask(e),Q.ctx.clip(),Q.path(o)),Q.ctx.shadowOffsetX=A.offsetX.number+s,Q.ctx.shadowOffsetY=A.offsetY.number,Q.ctx.shadowColor=te(A.color),Q.ctx.shadowBlur=A.blur.number,Q.ctx.fillStyle=A.inset?te(A.color):"rgba(0,0,0,1)",Q.ctx.fill(),Q.ctx.restore()}),A.label=2;case 2:s=n=0,o=B,A.label=3;case 3:return s<o.length?0!==(i=o[s]).style&&!ee(i.color)&&0<i.width?2!==i.style?[3,5]:[4,this.renderDashedDottedBorder(i.color,i.width,n,c.curves,2)]:[3,11]:[3,13];case 4:return A.sent(),[3,11];case 5:return 3!==i.style?[3,7]:[4,this.renderDashedDottedBorder(i.color,i.width,n,c.curves,3)];case 6:return A.sent(),[3,11];case 7:return 4!==i.style?[3,9]:[4,this.renderDoubleBorder(i.color,i.width,n,c.curves)];case 8:return A.sent(),[3,11];case 9:return[4,this.renderSolidBorder(i.color,n,c.curves)];case 10:A.sent(),A.label=11;case 11:n++,A.label=12;case 12:return s++,[3,3];case 13:return[2]}})})},Es.prototype.renderDashedDottedBorder=function(g,w,U,C,l){return a(this,void 0,void 0,function(){var e,t,B,r,n,s,o,i,Q,c,a;return H(this,function(A){return this.ctx.save(),Q=function(A,e){switch(e){case 0:return Us(A.topLeftBorderStroke,A.topRightBorderStroke);case 1:return Us(A.topRightBorderStroke,A.bottomRightBorderStroke);case 2:return Us(A.bottomRightBorderStroke,A.bottomLeftBorderStroke);default:return Us(A.bottomLeftBorderStroke,A.topLeftBorderStroke)}}(C,U),e=ss(C,U),2===l&&(this.path(e),this.ctx.clip()),s=Yn(e[0])?(t=e[0].start.x,e[0].start.y):(t=e[0].x,e[0].y),o=Yn(e[1])?(B=e[1].end.x,e[1].end.y):(B=e[1].x,e[1].y),r=0===U||2===U?Math.abs(t-B):Math.abs(s-o),this.ctx.beginPath(),3===l?this.formatPath(Q):this.formatPath(e.slice(0,2)),n=w<3?3*w:2*w,s=w<3?2*w:w,3===l&&(s=n=w),o=!0,r<=2*n?o=!1:r<=2*n+s?(n*=i=r/(2*n+s),s*=i):(Q=Math.floor((r+s)/(n+s)),i=(r-Q*n)/(Q-1),s=(Q=(r-(Q+1)*n)/Q)<=0||Math.abs(s-i)<Math.abs(s-Q)?i:Q),o&&(3===l?this.ctx.setLineDash([0,n+s]):this.ctx.setLineDash([n,s])),3===l?(this.ctx.lineCap="round",this.ctx.lineWidth=w):this.ctx.lineWidth=2*w+1.1,this.ctx.strokeStyle=te(g),this.ctx.stroke(),this.ctx.setLineDash([]),2===l&&(Yn(e[0])&&(c=e[3],a=e[0],this.ctx.beginPath(),this.formatPath([new Rn(c.end.x,c.end.y),new Rn(a.start.x,a.start.y)]),this.ctx.stroke()),Yn(e[1])&&(c=e[1],a=e[2],this.ctx.beginPath(),this.formatPath([new Rn(c.end.x,c.end.y),new Rn(a.start.x,a.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},Es.prototype.render=function(r){return a(this,void 0,void 0,function(){return H(this,function(A){switch(A.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=te(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),t=new rs(e=r,null),B=new Bs(t),gs(t,B,B,e=[]),ws(t.container,e),[4,this.renderStack(B)];case 1:return A.sent(),this.applyEffects([]),[2,this.canvas]}var e,t,B})})},Es);function Es(A,e){A=Hs.call(this,A,e)||this;return A._activeEffects=[],A.canvas=e.canvas||document.createElement("canvas"),A.ctx=A.canvas.getContext("2d"),e.canvas||(A.canvas.width=Math.floor(e.width*e.scale),A.canvas.height=Math.floor(e.height*e.scale),A.canvas.style.width=e.width+"px",A.canvas.style.height=e.height+"px"),A.fontMetrics=new ds(document),A.ctx.scale(A.options.scale,A.options.scale),A.ctx.translate(-e.x,-e.y),A.ctx.textBaseline="bottom",A._activeEffects=[],A.context.logger.debug("Canvas renderer initialized ("+e.width+"x"+e.height+") with scale "+e.scale),A}var Is,ys=function(A){return A instanceof Er||(A instanceof fr||A instanceof Fr&&A.type!==Cr&&A.type!==Ur)},Ks=function(A,e){switch(A){case 0:return _n(e);case 2:return[e.topLeftContentBox,e.topRightContentBox,e.bottomRightContentBox,e.bottomLeftContentBox];default:return qn(e)}},ms=function(A){switch(A){case 1:return"center";case 2:return"right";default:return"left"}},Ls=(A(bs,Is=we),bs.prototype.render=function(t){return a(this,void 0,void 0,function(){var e;return H(this,function(A){switch(A.label){case 0:return e=GB(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,t),[4,Ds(e)];case 1:return e=A.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=te(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(e,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},bs);function bs(A,e){A=Is.call(this,A,e)||this;return A.canvas=e.canvas||document.createElement("canvas"),A.ctx=A.canvas.getContext("2d"),A.options=e,A.canvas.width=Math.floor(e.width*e.scale),A.canvas.height=Math.floor(e.height*e.scale),A.canvas.style.width=e.width+"px",A.canvas.style.height=e.height+"px",A.ctx.scale(A.options.scale,A.options.scale),A.ctx.translate(-e.x,-e.y),A.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+e.width+"x"+e.height+" at "+e.x+","+e.y+") with scale "+e.scale),A}var Ds=function(B){return new Promise(function(A,e){var t=new Image;t.onload=function(){A(t)},t.onerror=e,t.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(B))})},vs=(xs.prototype.debug=function(){for(var A=[],e=0;e<arguments.length;e++)A[e]=arguments[e];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.debug?console.debug.apply(console,t([this.id,this.getTime()+"ms"],A)):this.info.apply(this,A))},xs.prototype.getTime=function(){return Date.now()-this.start},xs.prototype.info=function(){for(var A=[],e=0;e<arguments.length;e++)A[e]=arguments[e];this.enabled&&"undefined"!=typeof window&&window.console&&"function"==typeof console.info&&console.info.apply(console,t([this.id,this.getTime()+"ms"],A))},xs.prototype.warn=function(){for(var A=[],e=0;e<arguments.length;e++)A[e]=arguments[e];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.warn?console.warn.apply(console,t([this.id,this.getTime()+"ms"],A)):this.info.apply(this,A))},xs.prototype.error=function(){for(var A=[],e=0;e<arguments.length;e++)A[e]=arguments[e];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.error?console.error.apply(console,t([this.id,this.getTime()+"ms"],A)):this.info.apply(this,A))},xs.instances={},xs);function xs(A){var e=A.id,A=A.enabled;this.id=e,this.enabled=A,this.start=Date.now()}var Ms=(Ss.instanceCount=1,Ss);function Ss(A,e){this.windowBounds=e,this.instanceName="#"+Ss.instanceCount++,this.logger=new vs({id:this.instanceName,enabled:A.logging}),this.cache=null!==(e=A.cache)&&void 0!==e?e:new Dn(this,A)}"undefined"!=typeof window&&Ln.setContext(window);var Ts=function(u,F){return a(void 0,void 0,void 0,function(){var e,t,B,r,n,s,o,i,Q,c,a,g,w,U,C,l;return H(this,function(A){switch(A.label){case 0:if(!u||"object"!=typeof u)return[2,Promise.reject("Invalid element provided as first argument")];if(!(e=u.ownerDocument))throw new Error("Element is not attached to a Document");if(!(t=e.defaultView))throw new Error("Document is not attached to a Window");return w={allowTaint:null!==(U=F.allowTaint)&&void 0!==U&&U,imageTimeout:null!==(c=F.imageTimeout)&&void 0!==c?c:15e3,proxy:F.proxy,useCORS:null!==(a=F.useCORS)&&void 0!==a&&a},U=h({logging:null===(g=F.logging)||void 0===g||g,cache:F.cache},w),c={windowWidth:null!==(c=F.windowWidth)&&void 0!==c?c:t.innerWidth,windowHeight:null!==(a=F.windowHeight)&&void 0!==a?a:t.innerHeight,scrollX:null!==(g=F.scrollX)&&void 0!==g?g:t.pageXOffset,scrollY:null!==(w=F.scrollY)&&void 0!==w?w:t.pageYOffset},a=new d(c.scrollX,c.scrollY,c.windowWidth,c.windowHeight),g=new Ms(U,a),c=null!==(w=F.foreignObjectRendering)&&void 0!==w&&w,w={allowTaint:null!==(U=F.allowTaint)&&void 0!==U&&U,onclone:F.onclone,ignoreElements:F.ignoreElements,inlineImages:c,copyStyles:c},g.logger.debug("Starting document clone with size "+a.width+"x"+a.height+" scrolled to "+-a.left+","+-a.top),U=new wn(g,u,w),(w=U.clonedReferenceElement)?[4,U.toIFrame(e,a)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return(B=A.sent(),C=Xr(w)||"HTML"===w.tagName?function(A){var e=A.body,t=A.documentElement;if(!e||!t)throw new Error("Unable to get document size");A=Math.max(Math.max(e.scrollWidth,t.scrollWidth),Math.max(e.offsetWidth,t.offsetWidth),Math.max(e.clientWidth,t.clientWidth)),t=Math.max(Math.max(e.scrollHeight,t.scrollHeight),Math.max(e.offsetHeight,t.offsetHeight),Math.max(e.clientHeight,t.clientHeight));return new d(0,0,A,t)}(w.ownerDocument):f(g,w),r=C.width,n=C.height,s=C.left,o=C.top,i=Gs(g,w,F.backgroundColor),C={canvas:F.canvas,backgroundColor:i,scale:null!==(C=null!==(C=F.scale)&&void 0!==C?C:t.devicePixelRatio)&&void 0!==C?C:1,x:(null!==(C=F.x)&&void 0!==C?C:0)+s,y:(null!==(C=F.y)&&void 0!==C?C:0)+o,width:null!==(C=F.width)&&void 0!==C?C:Math.ceil(r),height:null!==(C=F.height)&&void 0!==C?C:Math.ceil(n)},c)?(g.logger.debug("Document cloned, using foreign object rendering"),[4,new Ls(g,C).render(w)]):[3,3];case 2:return Q=A.sent(),[3,5];case 3:return g.logger.debug("Document cloned, element located at "+s+","+o+" with size "+r+"x"+n+" using computed rendering"),g.logger.debug("Starting DOM parsing"),l=xr(g,w),i===l.styles.backgroundColor&&(l.styles.backgroundColor=pe.TRANSPARENT),g.logger.debug("Starting renderer for element at "+C.x+","+C.y+" with size "+C.width+"x"+C.height),[4,new ps(g,C).render(l)];case 4:Q=A.sent(),A.label=5;case 5:return null!==(l=F.removeContainer)&&void 0!==l&&!l||wn.destroy(B)||g.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore"),g.logger.debug("Finished rendering"),[2,Q]}})})},Gs=function(A,e,t){var B=e.ownerDocument,r=B.documentElement?Ce(A,getComputedStyle(B.documentElement).backgroundColor):pe.TRANSPARENT,n=B.body?Ce(A,getComputedStyle(B.body).backgroundColor):pe.TRANSPARENT,t="string"==typeof t?Ce(A,t):null===t?pe.TRANSPARENT:4294967295;return e===B.documentElement?ee(r)?ee(n)?t:n:r:t};return function(A,e){return Ts(A,e=void 0===e?{}:e)}});;

/* /ks_dn_advance/static/lib/js/pdf.min.js defined in bundle 'web.assets_backend' */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).jspdf={})}(this,(function(t){"use strict";var e=function(){return"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this}();function r(){e.console&&"function"==typeof e.console.log&&e.console.log.apply(e.console,arguments)}var n={log:r,warn:function(t){e.console&&("function"==typeof e.console.warn?e.console.warn.apply(e.console,arguments):r.call(null,arguments))},error:function(t){e.console&&("function"==typeof e.console.error?e.console.error.apply(e.console,arguments):r(t))}};function i(t,e,r){var i=new XMLHttpRequest;i.open("GET",t),i.responseType="blob",i.onload=function(){c(i.response,e,r)},i.onerror=function(){n.error("could not download file")},i.send()}function a(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(t){}return e.status>=200&&e.status<=299}function o(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(r){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var s,u,c=e.saveAs||("object"!=typeof window||window!==e?function(){}:"undefined"!=typeof HTMLAnchorElement&&"download"in HTMLAnchorElement.prototype?function(t,r,n){var s=e.URL||e.webkitURL,u=document.createElement("a");r=r||t.name||"download",u.download=r,u.rel="noopener","string"==typeof t?(u.href=t,u.origin!==location.origin?a(u.href)?i(t,r,n):o(u,u.target="_blank"):o(u)):(u.href=s.createObjectURL(t),setTimeout((function(){s.revokeObjectURL(u.href)}),4e4),setTimeout((function(){o(u)}),0))}:"msSaveOrOpenBlob"in navigator?function(t,e,r){if(e=e||t.name||"download","string"==typeof t)if(a(t))i(t,e,r);else{var s=document.createElement("a");s.href=t,s.target="_blank",setTimeout((function(){o(s)}))}else navigator.msSaveOrOpenBlob(function(t,e){return void 0===e?e={autoBom:!1}:"object"!=typeof e&&(n.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t}(t,r),e)}:function(t,r,n,a){if((a=a||open("","_blank"))&&(a.document.title=a.document.body.innerText="downloading..."),"string"==typeof t)return i(t,r,n);var o="application/octet-stream"===t.type,s=/constructor/i.test(e.HTMLElement)||e.safari,u=/CriOS\/[\d]+/.test(navigator.userAgent);if((u||o&&s)&&"object"==typeof FileReader){var c=new FileReader;c.onloadend=function(){var t=c.result;t=u?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=t:location=t,a=null},c.readAsDataURL(t)}else{var l=e.URL||e.webkitURL,h=l.createObjectURL(t);a?a.location=h:location.href=h,a=null,setTimeout((function(){l.revokeObjectURL(h)}),4e4)}});function l(t){var e;t=t||"",this.ok=!1,"#"==t.charAt(0)&&(t=t.substr(1,6));t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[t=(t=t.replace(/ /g,"")).toLowerCase()]||t;for(var r=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(t){return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}}],n=0;n<r.length;n++){var i=r[n].re,a=r[n].process,o=i.exec(t);o&&(e=a(o),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var t=this.r.toString(16),e=this.g.toString(16),r=this.b.toString(16);return 1==t.length&&(t="0"+t),1==e.length&&(e="0"+e),1==r.length&&(r="0"+r),"#"+t+e+r}}
function h(t,e){var r=t[0],n=t[1],i=t[2],a=t[3];r=d(r,n,i,a,e[0],7,-680876936),a=d(a,r,n,i,e[1],12,-389564586),i=d(i,a,r,n,e[2],17,606105819),n=d(n,i,a,r,e[3],22,-1044525330),r=d(r,n,i,a,e[4],7,-176418897),a=d(a,r,n,i,e[5],12,1200080426),i=d(i,a,r,n,e[6],17,-1473231341),n=d(n,i,a,r,e[7],22,-45705983),r=d(r,n,i,a,e[8],7,1770035416),a=d(a,r,n,i,e[9],12,-1958414417),i=d(i,a,r,n,e[10],17,-42063),n=d(n,i,a,r,e[11],22,-1990404162),r=d(r,n,i,a,e[12],7,1804603682),a=d(a,r,n,i,e[13],12,-40341101),i=d(i,a,r,n,e[14],17,-1502002290),r=p(r,n=d(n,i,a,r,e[15],22,1236535329),i,a,e[1],5,-165796510),a=p(a,r,n,i,e[6],9,-1069501632),i=p(i,a,r,n,e[11],14,643717713),n=p(n,i,a,r,e[0],20,-373897302),r=p(r,n,i,a,e[5],5,-701558691),a=p(a,r,n,i,e[10],9,38016083),i=p(i,a,r,n,e[15],14,-660478335),n=p(n,i,a,r,e[4],20,-405537848),r=p(r,n,i,a,e[9],5,568446438),a=p(a,r,n,i,e[14],9,-1019803690),i=p(i,a,r,n,e[3],14,-187363961),n=p(n,i,a,r,e[8],20,1163531501),r=p(r,n,i,a,e[13],5,-1444681467),a=p(a,r,n,i,e[2],9,-51403784),i=p(i,a,r,n,e[7],14,1735328473),r=g(r,n=p(n,i,a,r,e[12],20,-1926607734),i,a,e[5],4,-378558),a=g(a,r,n,i,e[8],11,-2022574463),i=g(i,a,r,n,e[11],16,1839030562),n=g(n,i,a,r,e[14],23,-35309556),r=g(r,n,i,a,e[1],4,-1530992060),a=g(a,r,n,i,e[4],11,1272893353),i=g(i,a,r,n,e[7],16,-155497632),n=g(n,i,a,r,e[10],23,-1094730640),r=g(r,n,i,a,e[13],4,681279174),a=g(a,r,n,i,e[0],11,-358537222),i=g(i,a,r,n,e[3],16,-722521979),n=g(n,i,a,r,e[6],23,76029189),r=g(r,n,i,a,e[9],4,-640364487),a=g(a,r,n,i,e[12],11,-421815835),i=g(i,a,r,n,e[15],16,530742520),r=m(r,n=g(n,i,a,r,e[2],23,-995338651),i,a,e[0],6,-198630844),a=m(a,r,n,i,e[7],10,1126891415),i=m(i,a,r,n,e[14],15,-1416354905),n=m(n,i,a,r,e[5],21,-57434055),r=m(r,n,i,a,e[12],6,1700485571),a=m(a,r,n,i,e[3],10,-1894986606),i=m(i,a,r,n,e[10],15,-1051523),n=m(n,i,a,r,e[1],21,-2054922799),r=m(r,n,i,a,e[8],6,1873313359),a=m(a,r,n,i,e[15],10,-30611744),i=m(i,a,r,n,e[6],15,-1560198380),n=m(n,i,a,r,e[13],21,1309151649),r=m(r,n,i,a,e[4],6,-145523070),a=m(a,r,n,i,e[11],10,-1120210379),i=m(i,a,r,n,e[2],15,718787259),n=m(n,i,a,r,e[9],21,-343485551),t[0]=L(r,t[0]),t[1]=L(n,t[1]),t[2]=L(i,t[2]),t[3]=L(a,t[3])}function f(t,e,r,n,i,a){return e=L(L(e,t),L(n,a)),L(e<<i|e>>>32-i,r)}function d(t,e,r,n,i,a,o){return f(e&r|~e&n,t,e,i,a,o)}function p(t,e,r,n,i,a,o){return f(e&n|r&~n,t,e,i,a,o)}function g(t,e,r,n,i,a,o){return f(e^r^n,t,e,i,a,o)}function m(t,e,r,n,i,a,o){return f(r^(e|~n),t,e,i,a,o)}function v(t){var e,r=t.length,n=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=t.length;e+=64)h(n,b(t.substring(e-64,e)));t=t.substring(e-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<t.length;e++)i[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(i[e>>2]|=128<<(e%4<<3),e>55)for(h(n,i),e=0;e<16;e++)i[e]=0;return i[14]=8*r,h(n,i),n}function b(t){var e,r=[];for(e=0;e<64;e+=4)r[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return r}s=e.atob.bind(e),u=e.btoa.bind(e);var y="0123456789abcdef".split("");function w(t){for(var e="",r=0;r<4;r++)e+=y[t>>8*r+4&15]+y[t>>8*r&15];return e}function N(t){return String.fromCharCode((255&t)>>0,(65280&t)>>8,(16711680&t)>>16,(4278190080&t)>>24)}function A(t){return function(t){return t.map(N).join("")}(v(t))}function L(t,e){return t+e&4294967295}if("5d41402abc4b2a76b9719d911017c592"!=function(t){for(var e=0;e<t.length;e++)t[e]=w(t[e]);return t.join("")}(v("hello"))){function L(t,e){var r=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(r>>16)<<16|65535&r}}
function x(t,e){var r,n,i,a;if(t!==r){for(var o=(i=t,a=1+(256/t.length>>0),new Array(a+1).join(i)),s=[],u=0;u<256;u++)s[u]=u;var c=0;for(u=0;u<256;u++){var l=s[u];c=(c+l+o.charCodeAt(u))%256,s[u]=s[c],s[c]=l}r=t,n=s}else s=n;var h=e.length,f=0,d=0,p="";for(u=0;u<h;u++)d=(d+(l=s[f=(f+1)%256]))%256,s[f]=s[d],s[d]=l,o=s[(s[f]+s[d])%256],p+=String.fromCharCode(e.charCodeAt(u)^o);return p}
var S={print:4,modify:8,copy:16,"annot-forms":32};function _(t,e,r,n){this.v=1,this.r=2;let i=192;t.forEach((function(t){if(void 0!==S.perm)throw new Error("Invalid permission: "+t);i+=S[t]})),this.padding="(¿N^NuAd\0NVÿú\b..\0¶Ðh>/\f©þdSiz";let a=(e+this.padding).substr(0,32),o=(r+this.padding).substr(0,32);this.O=this.processOwnerPassword(a,o),this.P=-(1+(255^i)),this.encryptionKey=A(a+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(n)).substr(0,5),this.U=x(this.encryptionKey,this.padding)}function P(t){if("object"!=typeof t)throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var r={};this.subscribe=function(t,e,n){if(n=n||!1,"string"!=typeof t||"function"!=typeof e||"boolean"!=typeof n)throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");r.hasOwnProperty(t)||(r[t]={});var i=Math.random().toString(35);return r[t][i]=[e,!!n],i},this.unsubscribe=function(t){for(var e in r)if(r[e][t])return delete r[e][t],0===Object.keys(r[e]).length&&delete r[e],!0;return!1},this.publish=function(i){if(r.hasOwnProperty(i)){var a=Array.prototype.slice.call(arguments,1),o=[];for(var s in r[i]){var u=r[i][s];try{u[0].apply(t,a)}catch(t){e.console&&n.error("jsPDF PubSub Error",t.message,t)}u[1]&&o.push(s)}o.length&&o.forEach(this.unsubscribe)}},this.getTopics=function(){return r}}function k(t){if(!(this instanceof k))return new k(t);var e="opacity,stroke-opacity".split(",");for(var r in t)t.hasOwnProperty(r)&&e.indexOf(r)>=0&&(this[r]=t[r]);this.id="",this.objectNumber=-1}function F(t,e){this.gState=t,this.matrix=e,this.id="",this.objectNumber=-1}function I(t,e,r,n,i){if(!(this instanceof I))return new I(t,e,r,n,i);this.type="axial"===t?2:3,this.coords=e,this.colors=r,F.call(this,n,i)}function C(t,e,r,n,i){if(!(this instanceof C))return new C(t,e,r,n,i);this.boundingBox=t,this.xStep=e,this.yStep=r,this.stream="",this.cloneIndex=0,F.call(this,n,i)}function j(t){var r,i="string"==typeof arguments[0]?arguments[0]:"p",a=arguments[1],o=arguments[2],s=arguments[3],h=[],f=1,d=16,p="S",g=null;"object"==typeof(t=t||{})&&(i=t.orientation,a=t.unit||a,o=t.format||o,s=t.compress||t.compressPdf||s,null!==(g=t.encryption||null)&&(g.userPassword=g.userPassword||"",g.ownerPassword=g.ownerPassword||"",g.userPermissions=g.userPermissions||[]),f="number"==typeof t.userUnit?Math.abs(t.userUnit):1,void 0!==t.precision&&(r=t.precision),void 0!==t.floatPrecision&&(d=t.floatPrecision),p=t.defaultPathOperation||"S"),h=t.filters||(!0===s?["FlateEncode"]:h),a=a||"mm",i=(""+(i||"P")).toLowerCase();var m=t.putOnlyUsedFonts||!1,v={},b={internal:{},__private__:{}};b.__private__.PubSub=P;var y="1.3",w=b.__private__.getPdfVersion=function(){return y};b.__private__.setPdfVersion=function(t){y=t};var N={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};b.__private__.getPageFormats=function(){return N};var A=b.__private__.getPageFormat=function(t){return N[t]};o=o||"a4";var L={COMPAT:"compat",ADVANCED:"advanced"},x=L.COMPAT;function S(){this.saveGraphicsState(),ct(new Ht(xt,0,0,-xt,0,Er()*xt).toString()+" cm"),this.setFontSize(this.getFontSize()/xt),p="n",x=L.ADVANCED}function F(){this.restoreGraphicsState(),p="S",x=L.COMPAT}var O=function(t,e){if("bold"==t&&"normal"==e||"bold"==t&&400==e||"normal"==t&&"italic"==e||"bold"==t&&"italic"==e)throw new Error("Invalid Combination of fontweight and fontstyle");return e&&t!==e&&(t=400==e?"italic"==t?"italic":"normal":700==e&&"italic"!==t?"bold":t+""+e),t};b.advancedAPI=function(t){var e=x===L.COMPAT;return e&&S.call(this),"function"!=typeof t||(t(this),e&&F.call(this)),this},b.compatAPI=function(t){var e=x===L.ADVANCED;return e&&F.call(this),"function"!=typeof t||(t(this),e&&S.call(this)),this},b.isAdvancedAPI=function(){return x===L.ADVANCED};var B,M=function(t){if(x!==L.ADVANCED)throw new Error(t+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},E=b.roundToPrecision=b.__private__.roundToPrecision=function(t,e){var n=r||e;if(isNaN(t)||isNaN(n))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return t.toFixed(n).replace(/0+$/,"")};B=b.hpf=b.__private__.hpf="number"==typeof d?function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.hpf");return E(t,d)}:"smart"===d?function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.hpf");return E(t,t>-1&&t<1?16:5)}:function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.hpf");return E(t,16)};var q=b.f2=b.__private__.f2=function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.f2");return E(t,2)},R=b.__private__.f3=function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.f3");return E(t,3)},T=b.scale=b.__private__.scale=function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.scale");return x===L.COMPAT?t*xt:x===L.ADVANCED?t:void 0},D=function(t){return x===L.COMPAT?Er()-t:x===L.ADVANCED?t:void 0},U=function(t){return T(D(t))};b.__private__.setPrecision=b.setPrecision=function(t){"number"==typeof parseInt(t,10)&&(r=parseInt(t,10))};var z,H="00000000000000000000000000000000",W=b.__private__.getFileId=function(){return H},V=b.__private__.setFileId=function(t){return H=void 0!==t&&/^[a-fA-F0-9]{32}$/.test(t)?t.toUpperCase():H.split("").map((function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))})).join(""),null!==g&&(Ve=new _(g.userPermissions,g.userPassword,g.ownerPassword,H)),H};b.setFileId=function(t){return V(t),this},b.getFileId=function(){return W()};var G=b.__private__.convertDateToPDFDate=function(t){var e=t.getTimezoneOffset(),r=e<0?"+":"-",n=Math.floor(Math.abs(e/60)),i=Math.abs(e%60),a=[r,Z(n),"'",Z(i),"'"].join("");return["D:",t.getFullYear(),Z(t.getMonth()+1),Z(t.getDate()),Z(t.getHours()),Z(t.getMinutes()),Z(t.getSeconds()),a].join("")},Y=b.__private__.convertPDFDateToDate=function(t){var e=parseInt(t.substr(2,4),10),r=parseInt(t.substr(6,2),10)-1,n=parseInt(t.substr(8,2),10),i=parseInt(t.substr(10,2),10),a=parseInt(t.substr(12,2),10),o=parseInt(t.substr(14,2),10);return new Date(e,r,n,i,a,o,0)},J=b.__private__.setCreationDate=function(t){var e;if(void 0===t&&(t=new Date),t instanceof Date)e=G(t);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(t))throw new Error("Invalid argument passed to jsPDF.setCreationDate");e=t}return z=e},X=b.__private__.getCreationDate=function(t){var e=z;return"jsDate"===t&&(e=Y(z)),e};b.setCreationDate=function(t){return J(t),this},b.getCreationDate=function(t){return X(t)};var K,Z=b.__private__.padd2=function(t){return("0"+parseInt(t)).slice(-2)},$=b.__private__.padd2Hex=function(t){return("00"+(t=t.toString())).substr(t.length)},Q=0,tt=[],et=[],rt=0,nt=[],it=[],at=!1,ot=et,st=function(){Q=0,rt=0,et=[],tt=[],nt=[],Zt=Jt(),$t=Jt()};b.__private__.setCustomOutputDestination=function(t){at=!0,ot=t};var ut=function(t){at||(ot=t)};b.__private__.resetCustomOutputDestination=function(){at=!1,ot=et};var ct=b.__private__.out=function(t){return t=t.toString(),rt+=t.length+1,ot.push(t),ot},lt=b.__private__.write=function(t){return ct(1===arguments.length?t.toString():Array.prototype.join.call(arguments," "))},ht=b.__private__.getArrayBuffer=function(t){for(var e=t.length,r=new ArrayBuffer(e),n=new Uint8Array(r);e--;)n[e]=t.charCodeAt(e);return r},ft=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];b.__private__.getStandardFonts=function(){return ft};var dt=t.fontSize||16;b.__private__.setFontSize=b.setFontSize=function(t){return dt=x===L.ADVANCED?t/xt:t,this};var pt,gt=b.__private__.getFontSize=b.getFontSize=function(){return x===L.COMPAT?dt:dt*xt},mt=t.R2L||!1;b.__private__.setR2L=b.setR2L=function(t){return mt=t,this},b.__private__.getR2L=b.getR2L=function(){return mt};var vt,bt=b.__private__.setZoomMode=function(t){var e=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^\d*\.?\d*%$/.test(t))pt=t;else if(isNaN(t)){if(-1===e.indexOf(t))throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+t+'" is not recognized.');pt=t}else pt=parseInt(t,10)};b.__private__.getZoomMode=function(){return pt};var yt,wt=b.__private__.setPageMode=function(t){if(-1==[void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(t))throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+t+'" is not recognized.');vt=t};b.__private__.getPageMode=function(){return vt};var Nt=b.__private__.setLayoutMode=function(t){if(-1==[void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(t))throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+t+'" is not recognized.');yt=t};b.__private__.getLayoutMode=function(){return yt},b.__private__.setDisplayMode=b.setDisplayMode=function(t,e,r){return bt(t),Nt(e),wt(r),this};var At={title:"",subject:"",author:"",keywords:"",creator:""};b.__private__.getDocumentProperty=function(t){if(-1===Object.keys(At).indexOf(t))throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return At[t]},b.__private__.getDocumentProperties=function(){return At},b.__private__.setDocumentProperties=b.setProperties=b.setDocumentProperties=function(t){for(var e in At)At.hasOwnProperty(e)&&t[e]&&(At[e]=t[e]);return this},b.__private__.setDocumentProperty=function(t,e){if(-1===Object.keys(At).indexOf(t))throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return At[t]=e};var Lt,xt,St,_t,Pt,kt={},Ft={},It=[],Ct={},jt={},Ot={},Bt={},Mt=null,Et=0,qt=[],Rt=new P(b),Tt=t.hotfixes||[],Dt={},Ut={},zt=[],Ht=function(t,e,r,n,i,a){if(!(this instanceof Ht))return new Ht(t,e,r,n,i,a);isNaN(t)&&(t=1),isNaN(e)&&(e=0),isNaN(r)&&(r=0),isNaN(n)&&(n=1),isNaN(i)&&(i=0),isNaN(a)&&(a=0),this._matrix=[t,e,r,n,i,a]};Object.defineProperty(Ht.prototype,"sx",{get:function(){return this._matrix[0]},set:function(t){this._matrix[0]=t}}),Object.defineProperty(Ht.prototype,"shy",{get:function(){return this._matrix[1]},set:function(t){this._matrix[1]=t}}),Object.defineProperty(Ht.prototype,"shx",{get:function(){return this._matrix[2]},set:function(t){this._matrix[2]=t}}),Object.defineProperty(Ht.prototype,"sy",{get:function(){return this._matrix[3]},set:function(t){this._matrix[3]=t}}),Object.defineProperty(Ht.prototype,"tx",{get:function(){return this._matrix[4]},set:function(t){this._matrix[4]=t}}),Object.defineProperty(Ht.prototype,"ty",{get:function(){return this._matrix[5]},set:function(t){this._matrix[5]=t}}),Object.defineProperty(Ht.prototype,"a",{get:function(){return this._matrix[0]},set:function(t){this._matrix[0]=t}}),Object.defineProperty(Ht.prototype,"b",{get:function(){return this._matrix[1]},set:function(t){this._matrix[1]=t}}),Object.defineProperty(Ht.prototype,"c",{get:function(){return this._matrix[2]},set:function(t){this._matrix[2]=t}}),Object.defineProperty(Ht.prototype,"d",{get:function(){return this._matrix[3]},set:function(t){this._matrix[3]=t}}),Object.defineProperty(Ht.prototype,"e",{get:function(){return this._matrix[4]},set:function(t){this._matrix[4]=t}}),Object.defineProperty(Ht.prototype,"f",{get:function(){return this._matrix[5]},set:function(t){this._matrix[5]=t}}),Object.defineProperty(Ht.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Ht.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Ht.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Ht.prototype,"isIdentity",{get:function(){return 1===this.sx&&(0===this.shy&&(0===this.shx&&(1===this.sy&&(0===this.tx&&0===this.ty))))}}),Ht.prototype.join=function(t){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(B).join(t)},Ht.prototype.multiply=function(t){var e=t.sx*this.sx+t.shy*this.shx,r=t.sx*this.shy+t.shy*this.sy,n=t.shx*this.sx+t.sy*this.shx,i=t.shx*this.shy+t.sy*this.sy,a=t.tx*this.sx+t.ty*this.shx+this.tx,o=t.tx*this.shy+t.ty*this.sy+this.ty;return new Ht(e,r,n,i,a,o)},Ht.prototype.decompose=function(){var t=this.sx,e=this.shy,r=this.shx,n=this.sy,i=this.tx,a=this.ty,o=Math.sqrt(t*t+e*e),s=(t/=o)*r+(e/=o)*n;r-=t*s,n-=e*s;var u=Math.sqrt(r*r+n*n);return s/=u,t*(n/=u)<e*(r/=u)&&(t=-t,e=-e,s=-s,o=-o),{scale:new Ht(o,0,0,u,0,0),translate:new Ht(1,0,0,1,i,a),rotate:new Ht(t,e,-e,t,0,0),skew:new Ht(1,0,s,1,0,0)}},Ht.prototype.toString=function(t){return this.join(" ")},Ht.prototype.inversed=function(){var t=this.sx,e=this.shy,r=this.shx,n=this.sy,i=this.tx,a=this.ty,o=1/(t*n-e*r),s=n*o,u=-e*o,c=-r*o,l=t*o;return new Ht(s,u,c,l,-s*i-c*a,-u*i-l*a)},Ht.prototype.applyToPoint=function(t){var e=t.x*this.sx+t.y*this.shx+this.tx,r=t.x*this.shy+t.y*this.sy+this.ty;return new kr(e,r)},Ht.prototype.applyToRectangle=function(t){var e=this.applyToPoint(t),r=this.applyToPoint(new kr(t.x+t.w,t.y+t.h));return new Fr(e.x,e.y,r.x-e.x,r.y-e.y)},Ht.prototype.clone=function(){var t=this.sx,e=this.shy,r=this.shx,n=this.sy,i=this.tx,a=this.ty;return new Ht(t,e,r,n,i,a)},b.Matrix=Ht;var Wt=b.matrixMult=function(t,e){return e.multiply(t)},Vt=new Ht(1,0,0,1,0,0);b.unitMatrix=b.identityMatrix=Vt;var Gt=function(t,e){if(!jt[t]){var r=(e instanceof I?"Sh":"P")+(Object.keys(Ct).length+1).toString(10);e.id=r,jt[t]=r,Ct[r]=e,Rt.publish("addPattern",e)}};b.ShadingPattern=I,b.TilingPattern=C,b.addShadingPattern=function(t,e){return M("addShadingPattern()"),Gt(t,e),this},b.beginTilingPattern=function(t){M("beginTilingPattern()"),Cr(t.boundingBox[0],t.boundingBox[1],t.boundingBox[2]-t.boundingBox[0],t.boundingBox[3]-t.boundingBox[1],t.matrix)},b.endTilingPattern=function(t,e){M("endTilingPattern()"),e.stream=it[K].join("\n"),Gt(t,e),Rt.publish("endTilingPattern",e),zt.pop().restore()};var Yt=b.__private__.newObject=function(){var t=Jt();return Xt(t,!0),t},Jt=b.__private__.newObjectDeferred=function(){return Q++,tt[Q]=function(){return rt},Q},Xt=function(t,e){return e="boolean"==typeof e&&e,tt[t]=rt,e&&ct(t+" 0 obj"),t},Kt=b.__private__.newAdditionalObject=function(){var t={objId:Jt(),content:""};return nt.push(t),t},Zt=Jt(),$t=Jt(),Qt=b.__private__.decodeColorString=function(t){var e=t.split(" ");if(2!==e.length||"g"!==e[1]&&"G"!==e[1]){if(5===e.length&&("k"===e[4]||"K"===e[4])){e=[(1-e[0])*(1-e[3]),(1-e[1])*(1-e[3]),(1-e[2])*(1-e[3]),"r"]}}else{var r=parseFloat(e[0]);e=[r,r,r,"r"]}for(var n="#",i=0;i<3;i++)n+=("0"+Math.floor(255*parseFloat(e[i])).toString(16)).slice(-2);return n},te=b.__private__.encodeColorString=function(t){var e;"string"==typeof t&&(t={ch1:t});var r=t.ch1,n=t.ch2,i=t.ch3,a=t.ch4,o="draw"===t.pdfColorType?["G","RG","K"]:["g","rg","k"];if("string"==typeof r&&"#"!==r.charAt(0)){var s=new l(r);if(s.ok)r=s.toHex();else if(!/^\d*\.?\d*$/.test(r))throw new Error('Invalid color "'+r+'" passed to jsPDF.encodeColorString.')}if("string"==typeof r&&/^#[0-9A-Fa-f]{3}$/.test(r)&&(r="#"+r[1]+r[1]+r[2]+r[2]+r[3]+r[3]),"string"==typeof r&&/^#[0-9A-Fa-f]{6}$/.test(r)){var u=parseInt(r.substr(1),16);r=u>>16&255,n=u>>8&255,i=255&u}if(void 0===n||void 0===a&&r===n&&n===i)if("string"==typeof r)e=r+" "+o[0];else switch(t.precision){case 2:e=q(r/255)+" "+o[0];break;case 3:default:e=R(r/255)+" "+o[0]}else if(void 0===a||"object"==typeof a){if(a&&!isNaN(a.a)&&0===a.a)return e=["1.","1.","1.",o[1]].join(" ");if("string"==typeof r)e=[r,n,i,o[1]].join(" ");else switch(t.precision){case 2:e=[q(r/255),q(n/255),q(i/255),o[1]].join(" ");break;default:case 3:e=[R(r/255),R(n/255),R(i/255),o[1]].join(" ")}}else if("string"==typeof r)e=[r,n,i,a,o[2]].join(" ");else switch(t.precision){case 2:e=[q(r),q(n),q(i),q(a),o[2]].join(" ");break;case 3:default:e=[R(r),R(n),R(i),R(a),o[2]].join(" ")}return e},ee=b.__private__.getFilters=function(){return h},re=b.__private__.putStream=function(t){var e=(t=t||{}).data||"",r=t.filters||ee(),n=t.alreadyAppliedFilters||[],i=t.addLength1||!1,a=e.length,o=t.objectId,s=function(t){return t};if(null!==g&&void 0===o)throw new Error("ObjectId must be passed to putStream for file encryption");null!==g&&(s=Ve.encryptor(o,0));var u={};!0===r&&(r=["FlateEncode"]);var c=t.additionalKeyValues||[],l=(u=void 0!==j.API.processDataByFilters?j.API.processDataByFilters(e,r):{data:e,reverseChain:[]}).reverseChain+(Array.isArray(n)?n.join(" "):n.toString());if(0!==u.data.length&&(c.push({key:"Length",value:u.data.length}),!0===i&&c.push({key:"Length1",value:a})),0!=l.length)if(l.split("/").length-1==1)c.push({key:"Filter",value:l});else{c.push({key:"Filter",value:"["+l+"]"});for(var h=0;h<c.length;h+=1)if("DecodeParms"===c[h].key){for(var f=[],d=0;d<u.reverseChain.split("/").length-1;d+=1)f.push("null");f.push(c[h].value),c[h].value="["+f.join(" ")+"]"}}ct("<<");for(var p=0;p<c.length;p++)ct("/"+c[p].key+" "+c[p].value);ct(">>"),0!==u.data.length&&(ct("stream"),ct(s(u.data)),ct("endstream"))},ne=b.__private__.putPage=function(t){var e=t.number,r=t.data,n=t.objId,i=t.contentsObjId;Xt(n,!0),ct("<</Type /Page"),ct("/Parent "+t.rootDictionaryObjId+" 0 R"),ct("/Resources "+t.resourceDictionaryObjId+" 0 R"),ct("/MediaBox ["+parseFloat(B(t.mediaBox.bottomLeftX))+" "+parseFloat(B(t.mediaBox.bottomLeftY))+" "+B(t.mediaBox.topRightX)+" "+B(t.mediaBox.topRightY)+"]"),null!==t.cropBox&&ct("/CropBox ["+B(t.cropBox.bottomLeftX)+" "+B(t.cropBox.bottomLeftY)+" "+B(t.cropBox.topRightX)+" "+B(t.cropBox.topRightY)+"]"),null!==t.bleedBox&&ct("/BleedBox ["+B(t.bleedBox.bottomLeftX)+" "+B(t.bleedBox.bottomLeftY)+" "+B(t.bleedBox.topRightX)+" "+B(t.bleedBox.topRightY)+"]"),null!==t.trimBox&&ct("/TrimBox ["+B(t.trimBox.bottomLeftX)+" "+B(t.trimBox.bottomLeftY)+" "+B(t.trimBox.topRightX)+" "+B(t.trimBox.topRightY)+"]"),null!==t.artBox&&ct("/ArtBox ["+B(t.artBox.bottomLeftX)+" "+B(t.artBox.bottomLeftY)+" "+B(t.artBox.topRightX)+" "+B(t.artBox.topRightY)+"]"),"number"==typeof t.userUnit&&1!==t.userUnit&&ct("/UserUnit "+t.userUnit),Rt.publish("putPage",{objId:n,pageContext:qt[e],pageNumber:e,page:r}),ct("/Contents "+i+" 0 R"),ct(">>"),ct("endobj");var a=r.join("\n");return x===L.ADVANCED&&(a+="\nQ"),Xt(i,!0),re({data:a,filters:ee(),objectId:i}),ct("endobj"),n},ie=b.__private__.putPages=function(){var t,e,r=[];for(t=1;t<=Et;t++)qt[t].objId=Jt(),qt[t].contentsObjId=Jt();for(t=1;t<=Et;t++)r.push(ne({number:t,data:it[t],objId:qt[t].objId,contentsObjId:qt[t].contentsObjId,mediaBox:qt[t].mediaBox,cropBox:qt[t].cropBox,bleedBox:qt[t].bleedBox,trimBox:qt[t].trimBox,artBox:qt[t].artBox,userUnit:qt[t].userUnit,rootDictionaryObjId:Zt,resourceDictionaryObjId:$t}));Xt(Zt,!0),ct("<</Type /Pages");var n="/Kids [";for(e=0;e<Et;e++)n+=r[e]+" 0 R ";ct(n+"]"),ct("/Count "+Et),ct(">>"),ct("endobj"),Rt.publish("postPutPages")},ae=function(t){var e=function(t,e){return-1!==t.indexOf(" ")?"("+Fe(t,e)+")":Fe(t,e)};Rt.publish("putFont",{font:t,out:ct,newObject:Yt,putStream:re,pdfEscapeWithNeededParanthesis:e}),!0!==t.isAlreadyPutted&&(t.objectNumber=Yt(),ct("<<"),ct("/Type /Font"),ct("/BaseFont /"+e(t.postScriptName)),ct("/Subtype /Type1"),"string"==typeof t.encoding&&ct("/Encoding /"+t.encoding),ct("/FirstChar 32"),ct("/LastChar 255"),ct(">>"),ct("endobj"))},oe=function(){for(var t in kt)kt.hasOwnProperty(t)&&(!1===m||!0===m&&v.hasOwnProperty(t))&&ae(kt[t])},se=function(t){t.objectNumber=Yt();var e=[];e.push({key:"Type",value:"/XObject"}),e.push({key:"Subtype",value:"/Form"}),e.push({key:"BBox",value:"["+[B(t.x),B(t.y),B(t.x+t.width),B(t.y+t.height)].join(" ")+"]"}),e.push({key:"Matrix",value:"["+t.matrix.toString()+"]"});var r=t.pages[1].join("\n");re({data:r,additionalKeyValues:e,objectId:t.objectNumber}),ct("endobj")},ue=function(){for(var t in Dt)Dt.hasOwnProperty(t)&&se(Dt[t])},ce=function(t,e){var r,n=[],i=1/(e-1);for(r=0;r<1;r+=i)n.push(r);if(n.push(1),0!=t[0].offset){var a={offset:0,color:t[0].color};t.unshift(a)}if(1!=t[t.length-1].offset){var o={offset:1,color:t[t.length-1].color};t.push(o)}for(var s="",u=0,c=0;c<n.length;c++){for(r=n[c];r>t[u+1].offset;)u++;var l=t[u].offset,h=(r-l)/(t[u+1].offset-l),f=t[u].color,d=t[u+1].color;s+=$(Math.round((1-h)*f[0]+h*d[0]).toString(16))+$(Math.round((1-h)*f[1]+h*d[1]).toString(16))+$(Math.round((1-h)*f[2]+h*d[2]).toString(16))}return s.trim()},le=function(t,e){e||(e=21);var r=Yt(),n=ce(t.colors,e),i=[];i.push({key:"FunctionType",value:"0"}),i.push({key:"Domain",value:"[0.0 1.0]"}),i.push({key:"Size",value:"["+e+"]"}),i.push({key:"BitsPerSample",value:"8"}),i.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),i.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),re({data:n,additionalKeyValues:i,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:r}),ct("endobj"),t.objectNumber=Yt(),ct("<< /ShadingType "+t.type),ct("/ColorSpace /DeviceRGB");var a="/Coords ["+B(parseFloat(t.coords[0]))+" "+B(parseFloat(t.coords[1]))+" ";2===t.type?a+=B(parseFloat(t.coords[2]))+" "+B(parseFloat(t.coords[3])):a+=B(parseFloat(t.coords[2]))+" "+B(parseFloat(t.coords[3]))+" "+B(parseFloat(t.coords[4]))+" "+B(parseFloat(t.coords[5])),ct(a+="]"),t.matrix&&ct("/Matrix ["+t.matrix.toString()+"]"),ct("/Function "+r+" 0 R"),ct("/Extend [true true]"),ct(">>"),ct("endobj")},he=function(t,e){var r=Jt(),n=Yt();e.push({resourcesOid:r,objectOid:n}),t.objectNumber=n;var i=[];i.push({key:"Type",value:"/Pattern"}),i.push({key:"PatternType",value:"1"}),i.push({key:"PaintType",value:"1"}),i.push({key:"TilingType",value:"1"}),i.push({key:"BBox",value:"["+t.boundingBox.map(B).join(" ")+"]"}),i.push({key:"XStep",value:B(t.xStep)}),i.push({key:"YStep",value:B(t.yStep)}),i.push({key:"Resources",value:r+" 0 R"}),t.matrix&&i.push({key:"Matrix",value:"["+t.matrix.toString()+"]"}),re({data:t.stream,additionalKeyValues:i,objectId:t.objectNumber}),ct("endobj")},fe=function(t){var e;for(e in Ct)Ct.hasOwnProperty(e)&&(Ct[e]instanceof I?le(Ct[e]):Ct[e]instanceof C&&he(Ct[e],t))},de=function(t){for(var e in t.objectNumber=Yt(),ct("<<"),t)switch(e){case"opacity":ct("/ca "+q(t[e]));break;case"stroke-opacity":ct("/CA "+q(t[e]))}ct(">>"),ct("endobj")},pe=function(){var t;for(t in Ot)Ot.hasOwnProperty(t)&&de(Ot[t])},ge=function(){for(var t in ct("/XObject <<"),Dt)Dt.hasOwnProperty(t)&&Dt[t].objectNumber>=0&&ct("/"+t+" "+Dt[t].objectNumber+" 0 R");Rt.publish("putXobjectDict"),ct(">>")},me=function(){Ve.oid=Yt(),ct("<<"),ct("/Filter /Standard"),ct("/V "+Ve.v),ct("/R "+Ve.r),ct("/U <"+Ve.toHexString(Ve.U)+">"),ct("/O <"+Ve.toHexString(Ve.O)+">"),ct("/P "+Ve.P),ct(">>"),ct("endobj")},ve=function(){for(var t in ct("/Font <<"),kt)kt.hasOwnProperty(t)&&(!1===m||!0===m&&v.hasOwnProperty(t))&&ct("/"+t+" "+kt[t].objectNumber+" 0 R");ct(">>")},be=function(){if(Object.keys(Ct).length>0){for(var t in ct("/Shading <<"),Ct)Ct.hasOwnProperty(t)&&Ct[t]instanceof I&&Ct[t].objectNumber>=0&&ct("/"+t+" "+Ct[t].objectNumber+" 0 R");Rt.publish("putShadingPatternDict"),ct(">>")}},ye=function(t){if(Object.keys(Ct).length>0){for(var e in ct("/Pattern <<"),Ct)Ct.hasOwnProperty(e)&&Ct[e]instanceof b.TilingPattern&&Ct[e].objectNumber>=0&&Ct[e].objectNumber<t&&ct("/"+e+" "+Ct[e].objectNumber+" 0 R");Rt.publish("putTilingPatternDict"),ct(">>")}},we=function(){if(Object.keys(Ot).length>0){var t;for(t in ct("/ExtGState <<"),Ot)Ot.hasOwnProperty(t)&&Ot[t].objectNumber>=0&&ct("/"+t+" "+Ot[t].objectNumber+" 0 R");Rt.publish("putGStateDict"),ct(">>")}},Ne=function(t){Xt(t.resourcesOid,!0),ct("<<"),ct("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),ve(),be(),ye(t.objectOid),we(),ge(),ct(">>"),ct("endobj")},Ae=function(){var t=[];oe(),pe(),ue(),fe(t),Rt.publish("putResources"),t.forEach(Ne),Ne({resourcesOid:$t,objectOid:Number.MAX_SAFE_INTEGER}),Rt.publish("postPutResources")},Le=function(){Rt.publish("putAdditionalObjects");for(var t=0;t<nt.length;t++){var e=nt[t];Xt(e.objId,!0),ct(e.content),ct("endobj")}Rt.publish("postPutAdditionalObjects")},xe=function(t){Ft[t.fontName]=Ft[t.fontName]||{},Ft[t.fontName][t.fontStyle]=t.id},Se=function(t,e,r,n,i){var a={id:"F"+(Object.keys(kt).length+1).toString(10),postScriptName:t,fontName:e,fontStyle:r,encoding:n,isStandardFont:i||!1,metadata:{}};return Rt.publish("addFont",{font:a,instance:this}),kt[a.id]=a,xe(a),a.id},_e=function(t){for(var e=0,r=ft.length;e<r;e++){var n=Se.call(this,t[e][0],t[e][1],t[e][2],ft[e][3],!0);!1===m&&(v[n]=!0);var i=t[e][0].split("-");xe({id:n,fontName:i[0],fontStyle:i[1]||""})}Rt.publish("addFonts",{fonts:kt,dictionary:Ft})},Pe=function(t){return t.foo=function(){try{return t.apply(this,arguments)}catch(t){var r=t.stack||"";~r.indexOf(" at ")&&(r=r.split(" at ")[1]);var n="Error in function "+r.split("\n")[0].split("<")[0]+": "+t.message;if(!e.console)throw new Error(n);e.console.error(n,t),e.alert&&alert(n)}},t.foo.bar=t,t.foo},ke=function(t,e){var r,n,i,a,o,s,u,c,l;if(i=(e=e||{}).sourceEncoding||"Unicode",o=e.outputEncoding,(e.autoencode||o)&&kt[Lt].metadata&&kt[Lt].metadata[i]&&kt[Lt].metadata[i].encoding&&(a=kt[Lt].metadata[i].encoding,!o&&kt[Lt].encoding&&(o=kt[Lt].encoding),!o&&a.codePages&&(o=a.codePages[0]),"string"==typeof o&&(o=a[o]),o)){for(u=!1,s=[],r=0,n=t.length;r<n;r++)(c=o[t.charCodeAt(r)])?s.push(String.fromCharCode(c)):s.push(t[r]),s[r].charCodeAt(0)>>8&&(u=!0);t=s.join("")}for(r=t.length;void 0===u&&0!==r;)t.charCodeAt(r-1)>>8&&(u=!0),r--;if(!u)return t;for(s=e.noBOM?[]:[254,255],r=0,n=t.length;r<n;r++){if((l=(c=t.charCodeAt(r))>>8)>>8)throw new Error("Character at position "+r+" of string '"+t+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");s.push(l),s.push(c-(l<<8))}return String.fromCharCode.apply(void 0,s)},Fe=b.__private__.pdfEscape=b.pdfEscape=function(t,e){return ke(t,e).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Ie=b.__private__.beginPage=function(t){it[++Et]=[],qt[Et]={objId:0,contentsObjId:0,userUnit:Number(f),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(t[0]),topRightY:Number(t[1])}},Oe(Et),ut(it[K])},Ce=function(t,e){var r,a,s;switch(i=e||i,"string"==typeof t&&(r=A(t.toLowerCase()),Array.isArray(r)&&(a=r[0],s=r[1])),Array.isArray(t)&&(a=t[0]*xt,s=t[1]*xt),isNaN(a)&&(a=o[0],s=o[1]),(a>14400||s>14400)&&(n.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),a=Math.min(14400,a),s=Math.min(14400,s)),o=[a,s],i.substr(0,1)){case"l":s>a&&(o=[s,a]);break;case"p":a>s&&(o=[s,a])}Ie(o),hr(lr),ct(yr),0!==Sr&&ct(Sr+" J"),0!==_r&&ct(_r+" j"),Rt.publish("addPage",{pageNumber:Et})},je=function(t){t>0&&t<=Et&&(it.splice(t,1),qt.splice(t,1),Et--,K>Et&&(K=Et),this.setPage(K))},Oe=function(t){t>0&&t<=Et&&(K=t)},Be=b.__private__.getNumberOfPages=b.getNumberOfPages=function(){return it.length-1},Me=function(t,e,r){var i,a=void 0;return r=r||{},t=void 0!==t?t:kt[Lt].fontName,e=void 0!==e?e:kt[Lt].fontStyle,i=t.toLowerCase(),void 0!==Ft[i]&&void 0!==Ft[i][e]?a=Ft[i][e]:void 0!==Ft[t]&&void 0!==Ft[t][e]?a=Ft[t][e]:!1===r.disableWarning&&n.warn("Unable to look up font label for font '"+t+"', '"+e+"'. Refer to getFontList() for available fonts."),a||r.noFallback||null==(a=Ft.times[e])&&(a=Ft.times.normal),a},Ee=b.__private__.putInfo=function(){var t=Yt(),e=function(t){return t};for(var r in null!==g&&(e=Ve.encryptor(t,0)),ct("<<"),ct("/Producer ("+Fe(e("jsPDF "+j.version))+")"),At)At.hasOwnProperty(r)&&At[r]&&ct("/"+r.substr(0,1).toUpperCase()+r.substr(1)+" ("+Fe(e(At[r]))+")");ct("/CreationDate ("+Fe(e(z))+")"),ct(">>"),ct("endobj")},qe=b.__private__.putCatalog=function(t){var e=(t=t||{}).rootDictionaryObjId||Zt;switch(Yt(),ct("<<"),ct("/Type /Catalog"),ct("/Pages "+e+" 0 R"),pt||(pt="fullwidth"),pt){case"fullwidth":ct("/OpenAction [3 0 R /FitH null]");break;case"fullheight":ct("/OpenAction [3 0 R /FitV null]");break;case"fullpage":ct("/OpenAction [3 0 R /Fit]");break;case"original":ct("/OpenAction [3 0 R /XYZ null null 1]");break;default:var r=""+pt;"%"===r.substr(r.length-1)&&(pt=parseInt(pt)/100),"number"==typeof pt&&ct("/OpenAction [3 0 R /XYZ null null "+q(pt)+"]")}switch(yt||(yt="continuous"),yt){case"continuous":ct("/PageLayout /OneColumn");break;case"single":ct("/PageLayout /SinglePage");break;case"two":case"twoleft":ct("/PageLayout /TwoColumnLeft");break;case"tworight":ct("/PageLayout /TwoColumnRight")}vt&&ct("/PageMode /"+vt),Rt.publish("putCatalog"),ct(">>"),ct("endobj")},Re=b.__private__.putTrailer=function(){ct("trailer"),ct("<<"),ct("/Size "+(Q+1)),ct("/Root "+Q+" 0 R"),ct("/Info "+(Q-1)+" 0 R"),null!==g&&ct("/Encrypt "+Ve.oid+" 0 R"),ct("/ID [ <"+H+"> <"+H+"> ]"),ct(">>")},Te=b.__private__.putHeader=function(){ct("%PDF-"+y),ct("%ºß¬à")},De=b.__private__.putXRef=function(){var t="0000000000";ct("xref"),ct("0 "+(Q+1)),ct("0000000000 65535 f ");for(var e=1;e<=Q;e++){"function"==typeof tt[e]?ct((t+tt[e]()).slice(-10)+" 00000 n "):void 0!==tt[e]?ct((t+tt[e]).slice(-10)+" 00000 n "):ct("0000000000 00000 n ")}},Ue=b.__private__.buildDocument=function(){st(),ut(et),Rt.publish("buildDocument"),Te(),ie(),Le(),Ae(),null!==g&&me(),Ee(),qe();var t=rt;return De(),Re(),ct("startxref"),ct(""+t),ct("%%EOF"),ut(it[K]),et.join("\n")},ze=b.__private__.getBlob=function(t){return new Blob([ht(t)],{type:"application/pdf"})},He=b.output=b.__private__.output=Pe((function(t,r){switch("string"==typeof(r=r||{})?r={filename:r}:r.filename=r.filename||"generated.pdf",t){case void 0:return Ue();case"save":b.save(r.filename);break;case"arraybuffer":return ht(Ue());case"blob":return ze(Ue());case"bloburi":case"bloburl":if(void 0!==e.URL&&"function"==typeof e.URL.createObjectURL)return e.URL&&e.URL.createObjectURL(ze(Ue()))||void 0;n.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var i="",a=Ue();try{i=u(a)}catch(t){i=u(unescape(encodeURIComponent(a)))}return"data:application/pdf;filename="+r.filename+";base64,"+i;case"pdfobjectnewwindow":if("[object Window]"===Object.prototype.toString.call(e)){var o='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+(r.pdfObjectUrl||"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js")+'"><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(r)+");<\/script></body></html>",s=e.open();return null!==s&&s.document.write(o),s}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if("[object Window]"===Object.prototype.toString.call(e)){var c='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(r.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+r.filename+'" width="500px" height="400px" /></body></html>',l=e.open();if(null!==l){l.document.write(c);var h=this;l.document.documentElement.querySelector("#pdfViewer").onload=function(){l.document.title=r.filename,l.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(h.output("bloburl"))}}return l}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if("[object Window]"!==Object.prototype.toString.call(e))throw new Error("The option dataurlnewwindow just works in a browser-environment.");var f='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",r)+'"></iframe></body></html>',d=e.open();if(null!==d&&(d.document.write(f),d.document.title=r.filename),d||"undefined"==typeof safari)return d;break;case"datauri":case"dataurl":return e.document.location.href=this.output("datauristring",r);default:return null}})),We=function(t){return!0===Array.isArray(Tt)&&Tt.indexOf(t)>-1};switch(a){case"pt":xt=1;break;case"mm":xt=72/25.4;break;case"cm":xt=72/2.54;break;case"in":xt=72;break;case"px":xt=1==We("px_scaling")?.75:96/72;break;case"pc":case"em":xt=12;break;case"ex":xt=6;break;default:throw new Error("Invalid unit: "+a)}var Ve=null;J(),V();var Ge=function(t){return null!==g?Ve.encryptor(t,0):function(t){return t}},Ye=b.__private__.getPageInfo=b.getPageInfo=function(t){if(isNaN(t)||t%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:qt[t].objId,pageNumber:t,pageContext:qt[t]}},Je=b.__private__.getPageInfoByObjId=function(t){if(isNaN(t)||t%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var e in qt)if(qt[e].objId===t)break;return Ye(e)},Xe=b.__private__.getCurrentPageInfo=b.getCurrentPageInfo=function(){return{objId:qt[K].objId,pageNumber:K,pageContext:qt[K]}};b.addPage=function(){return Ce.apply(this,arguments),this},b.setPage=function(){return Oe.apply(this,arguments),ut.call(this,it[K]),this},b.insertPage=function(t){return this.addPage(),this.movePage(K,t),this},b.movePage=function(t,e){var r,n;if(t>e){r=it[t],n=qt[t];for(var i=t;i>e;i--)it[i]=it[i-1],qt[i]=qt[i-1];it[e]=r,qt[e]=n,this.setPage(e)}else if(t<e){r=it[t],n=qt[t];for(var a=t;a<e;a++)it[a]=it[a+1],qt[a]=qt[a+1];it[e]=r,qt[e]=n,this.setPage(e)}return this},b.deletePage=function(){return je.apply(this,arguments),this},b.__private__.text=b.text=function(t,e,r,n,i){var a,o,s,u,c,l,h,f,d=(n=n||{}).scope||this;if("number"==typeof t&&"number"==typeof e&&("string"==typeof r||Array.isArray(r))){var p=r;r=e,e=t,t=p}if(arguments[3]instanceof Ht==!1?(s=arguments[4],u=arguments[5],"object"==typeof(h=arguments[3])&&null!==h||("string"==typeof s&&(u=s,s=null),"string"==typeof h&&(u=h,h=null),"number"==typeof h&&(s=h,h=null),n={flags:h,angle:s,align:u})):(M("The transform parameter of text() with a Matrix value"),f=i),isNaN(e)||isNaN(r)||null==t)throw new Error("Invalid arguments passed to jsPDF.text");if(0===t.length)return d;var g="",m=!1,b="number"==typeof n.lineHeightFactor?n.lineHeightFactor:cr,y=d.internal.scaleFactor;function w(t){return t=t.split("\t").join(Array(n.TabLen||9).join(" ")),Fe(t,h)}function N(t){for(var e,r=t.concat(),n=[],i=r.length;i--;)"string"==typeof(e=r.shift())?n.push(e):Array.isArray(t)&&(1===e.length||void 0===e[1]&&void 0===e[2])?n.push(e[0]):n.push([e[0],e[1],e[2]]);return n}function A(t,e){var r;if("string"==typeof t)r=e(t)[0];else if(Array.isArray(t)){for(var n,i,a=t.concat(),o=[],s=a.length;s--;)"string"==typeof(n=a.shift())?o.push(e(n)[0]):Array.isArray(n)&&"string"==typeof n[0]&&(i=e(n[0],n[1],n[2]),o.push([i[0],i[1],i[2]]));r=o}return r}var S=!1,_=!0;if("string"==typeof t)S=!0;else if(Array.isArray(t)){var P=t.concat();o=[];for(var k,F=P.length;F--;)("string"!=typeof(k=P.shift())||Array.isArray(k)&&"string"!=typeof k[0])&&(_=!1);S=_}if(!1===S)throw new Error('Type of text must be string or Array. "'+t+'" is not recognized.');"string"==typeof t&&(t=t.match(/[\r?\n]/)?t.split(/\r\n|\r|\n/g):[t]);var I=dt/d.internal.scaleFactor,C=I*(cr-1);switch(n.baseline){case"bottom":r-=C;break;case"top":r+=I-C;break;case"hanging":r+=I-2*C;break;case"middle":r+=I/2-C}if((l=n.maxWidth||0)>0&&("string"==typeof t?t=d.splitTextToSize(t,l):"[object Array]"===Object.prototype.toString.call(t)&&(t=t.reduce((function(t,e){return t.concat(d.splitTextToSize(e,l))}),[]))),a={text:t,x:e,y:r,options:n,mutex:{pdfEscape:Fe,activeFontKey:Lt,fonts:kt,activeFontSize:dt}},Rt.publish("preProcessText",a),t=a.text,s=(n=a.options).angle,f instanceof Ht==!1&&s&&"number"==typeof s){s*=Math.PI/180,0===n.rotationDirection&&(s=-s),x===L.ADVANCED&&(s=-s);var j=Math.cos(s),O=Math.sin(s);f=new Ht(j,O,-O,j,0,0)}else s&&s instanceof Ht&&(f=s);x!==L.ADVANCED||f||(f=Vt),void 0!==(c=n.charSpace||Lr)&&(g+=B(T(c))+" Tc\n",this.setCharSpace(this.getCharSpace()||0));n.lang;var E=-1,q=void 0!==n.renderingMode?n.renderingMode:n.stroke,R=d.internal.getCurrentPageInfo().pageContext;switch(q){case 0:case!1:case"fill":E=0;break;case 1:case!0:case"stroke":E=1;break;case 2:case"fillThenStroke":E=2;break;case 3:case"invisible":E=3;break;case 4:case"fillAndAddForClipping":E=4;break;case 5:case"strokeAndAddPathForClipping":E=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":E=6;break;case 7:case"addToPathForClipping":E=7}var D=void 0!==R.usedRenderingMode?R.usedRenderingMode:-1;-1!==E?g+=E+" Tr\n":-1!==D&&(g+="0 Tr\n"),-1!==E&&(R.usedRenderingMode=E),u=n.align||"left";var U,z=dt*b,H=d.internal.pageSize.getWidth(),W=kt[Lt];c=n.charSpace||Lr,l=n.maxWidth||0,h=Object.assign({autoencode:!0,noBOM:!0},n.flags);var V=[];if("[object Array]"===Object.prototype.toString.call(t)){var G;o=N(t),"left"!==u&&(U=o.map((function(t){return d.getStringUnitWidth(t,{font:W,charSpace:c,fontSize:dt,doKerning:!1})*dt/y})));var Y,J=0;if("right"===u){e-=U[0],t=[],F=o.length;for(var X=0;X<F;X++)0===X?(Y=gr(e),G=mr(r)):(Y=T(J-U[X]),G=-z),t.push([o[X],Y,G]),J=U[X]}else if("center"===u){e-=U[0]/2,t=[],F=o.length;for(var K=0;K<F;K++)0===K?(Y=gr(e),G=mr(r)):(Y=T((J-U[K])/2),G=-z),t.push([o[K],Y,G]),J=U[K]}else if("left"===u){t=[],F=o.length;for(var Z=0;Z<F;Z++)t.push(o[Z])}else{if("justify"!==u)throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');t=[],F=o.length,l=0!==l?l:H;for(var $=0;$<F;$++)G=0===$?mr(r):-z,Y=0===$?gr(e):0,$<F-1&&V.push(B(T((l-U[$])/(o[$].split(" ").length-1)))),t.push([o[$],Y,G])}}var Q="boolean"==typeof n.R2L?n.R2L:mt;!0===Q&&(t=A(t,(function(t,e,r){return[t.split("").reverse().join(""),e,r]}))),a={text:t,x:e,y:r,options:n,mutex:{pdfEscape:Fe,activeFontKey:Lt,fonts:kt,activeFontSize:dt}},Rt.publish("postProcessText",a),t=a.text,m=a.mutex.isHex||!1;var tt=kt[Lt].encoding;"WinAnsiEncoding"!==tt&&"StandardEncoding"!==tt||(t=A(t,(function(t,e,r){return[w(t),e,r]}))),o=N(t),t=[];for(var et,rt,nt,it=0,at=1,ot=Array.isArray(o[0])?at:it,st="",ut=function(t,e,r){var i="";return r instanceof Ht?(r="number"==typeof n.angle?Wt(r,new Ht(1,0,0,1,t,e)):Wt(new Ht(1,0,0,1,t,e),r),x===L.ADVANCED&&(r=Wt(new Ht(1,0,0,-1,0,0),r)),i=r.join(" ")+" Tm\n"):i=B(t)+" "+B(e)+" Td\n",i},lt=0;lt<o.length;lt++){switch(st="",ot){case at:nt=(m?"<":"(")+o[lt][0]+(m?">":")"),et=parseFloat(o[lt][1]),rt=parseFloat(o[lt][2]);break;case it:nt=(m?"<":"(")+o[lt]+(m?">":")"),et=gr(e),rt=mr(r)}void 0!==V&&void 0!==V[lt]&&(st=V[lt]+" Tw\n"),0===lt?t.push(st+ut(et,rt,f)+nt):ot===it?t.push(st+nt):ot===at&&t.push(st+ut(et,rt,f)+nt)}t=ot===it?t.join(" Tj\nT* "):t.join(" Tj\n"),t+=" Tj\n";var ht="BT\n/";return ht+=Lt+" "+dt+" Tf\n",ht+=B(dt*b)+" TL\n",ht+=Nr+"\n",ht+=g,ht+=t,ct(ht+="ET"),v[Lt]=!0,d};var Ke=b.__private__.clip=b.clip=function(t){return ct("evenodd"===t?"W*":"W"),this};b.clipEvenOdd=function(){return Ke("evenodd")},b.__private__.discardPath=b.discardPath=function(){return ct("n"),this};var Ze=b.__private__.isValidStyle=function(t){var e=!1;return-1!==[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(t)&&(e=!0),e};b.__private__.setDefaultPathOperation=b.setDefaultPathOperation=function(t){return Ze(t)&&(p=t),this};var $e=b.__private__.getStyle=b.getStyle=function(t){var e=p;switch(t){case"D":case"S":e="S";break;case"F":e="f";break;case"FD":case"DF":e="B";break;case"f":case"f*":case"B":case"B*":e=t}return e},Qe=b.close=function(){return ct("h"),this};b.stroke=function(){return ct("S"),this},b.fill=function(t){return tr("f",t),this},b.fillEvenOdd=function(t){return tr("f*",t),this},b.fillStroke=function(t){return tr("B",t),this},b.fillStrokeEvenOdd=function(t){return tr("B*",t),this};var tr=function(t,e){"object"==typeof e?nr(e,t):ct(t)},er=function(t){null===t||x===L.ADVANCED&&void 0===t||(t=$e(t),ct(t))};function rr(t,e,r,n,i){var a=new C(e||this.boundingBox,r||this.xStep,n||this.yStep,this.gState,i||this.matrix);a.stream=this.stream;var o=t+"$$"+this.cloneIndex+++"$$";return Gt(o,a),a}var nr=function(t,e){var r=jt[t.key],n=Ct[r];if(n instanceof I)ct("q"),ct(ir(e)),n.gState&&b.setGState(n.gState),ct(t.matrix.toString()+" cm"),ct("/"+r+" sh"),ct("Q");else if(n instanceof C){var i=new Ht(1,0,0,-1,0,Er());t.matrix&&(i=i.multiply(t.matrix||Vt),r=rr.call(n,t.key,t.boundingBox,t.xStep,t.yStep,i).id),ct("q"),ct("/Pattern cs"),ct("/"+r+" scn"),n.gState&&b.setGState(n.gState),ct(e),ct("Q")}},ir=function(t){switch(t){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},ar=b.moveTo=function(t,e){return ct(B(T(t))+" "+B(U(e))+" m"),this},or=b.lineTo=function(t,e){return ct(B(T(t))+" "+B(U(e))+" l"),this},sr=b.curveTo=function(t,e,r,n,i,a){return ct([B(T(t)),B(U(e)),B(T(r)),B(U(n)),B(T(i)),B(U(a)),"c"].join(" ")),this};b.__private__.line=b.line=function(t,e,r,n,i){if(isNaN(t)||isNaN(e)||isNaN(r)||isNaN(n)||!Ze(i))throw new Error("Invalid arguments passed to jsPDF.line");return x===L.COMPAT?this.lines([[r-t,n-e]],t,e,[1,1],i||"S"):this.lines([[r-t,n-e]],t,e,[1,1]).stroke()},b.__private__.lines=b.lines=function(t,e,r,n,i,a){var o,s,u,c,l,h,f,d,p,g,m,v;if("number"==typeof t&&(v=r,r=e,e=t,t=v),n=n||[1,1],a=a||!1,isNaN(e)||isNaN(r)||!Array.isArray(t)||!Array.isArray(n)||!Ze(i)||"boolean"!=typeof a)throw new Error("Invalid arguments passed to jsPDF.lines");for(ar(e,r),o=n[0],s=n[1],c=t.length,g=e,m=r,u=0;u<c;u++)2===(l=t[u]).length?(g=l[0]*o+g,m=l[1]*s+m,or(g,m)):(h=l[0]*o+g,f=l[1]*s+m,d=l[2]*o+g,p=l[3]*s+m,g=l[4]*o+g,m=l[5]*s+m,sr(h,f,d,p,g,m));return a&&Qe(),er(i),this},b.path=function(t){for(var e=0;e<t.length;e++){var r=t[e],n=r.c;switch(r.op){case"m":ar(n[0],n[1]);break;case"l":or(n[0],n[1]);break;case"c":sr.apply(this,n);break;case"h":Qe()}}return this},b.__private__.rect=b.rect=function(t,e,r,n,i){if(isNaN(t)||isNaN(e)||isNaN(r)||isNaN(n)||!Ze(i))throw new Error("Invalid arguments passed to jsPDF.rect");return x===L.COMPAT&&(n=-n),ct([B(T(t)),B(U(e)),B(T(r)),B(T(n)),"re"].join(" ")),er(i),this},b.__private__.triangle=b.triangle=function(t,e,r,n,i,a,o){if(isNaN(t)||isNaN(e)||isNaN(r)||isNaN(n)||isNaN(i)||isNaN(a)||!Ze(o))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[r-t,n-e],[i-r,a-n],[t-i,e-a]],t,e,[1,1],o,!0),this},b.__private__.roundedRect=b.roundedRect=function(t,e,r,n,i,a,o){if(isNaN(t)||isNaN(e)||isNaN(r)||isNaN(n)||isNaN(i)||isNaN(a)||!Ze(o))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var s=4/3*(Math.SQRT2-1);return i=Math.min(i,.5*r),a=Math.min(a,.5*n),this.lines([[r-2*i,0],[i*s,0,i,a-a*s,i,a],[0,n-2*a],[0,a*s,-i*s,a,-i,a],[2*i-r,0],[-i*s,0,-i,-a*s,-i,-a],[0,2*a-n],[0,-a*s,i*s,-a,i,-a]],t+i,e,[1,1],o,!0),this},b.__private__.ellipse=b.ellipse=function(t,e,r,n,i){if(isNaN(t)||isNaN(e)||isNaN(r)||isNaN(n)||!Ze(i))throw new Error("Invalid arguments passed to jsPDF.ellipse");var a=4/3*(Math.SQRT2-1)*r,o=4/3*(Math.SQRT2-1)*n;return ar(t+r,e),sr(t+r,e-o,t+a,e-n,t,e-n),sr(t-a,e-n,t-r,e-o,t-r,e),sr(t-r,e+o,t-a,e+n,t,e+n),sr(t+a,e+n,t+r,e+o,t+r,e),er(i),this},b.__private__.circle=b.circle=function(t,e,r,n){if(isNaN(t)||isNaN(e)||isNaN(r)||!Ze(n))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(t,e,r,r,n)},b.setFont=function(t,e,r){return r&&(e=O(e,r)),Lt=Me(t,e,{disableWarning:!1}),this};var ur=b.__private__.getFont=b.getFont=function(){return kt[Me.apply(b,arguments)]};b.__private__.getFontList=b.getFontList=function(){var t,e,r={};for(t in Ft)if(Ft.hasOwnProperty(t))for(e in r[t]=[],Ft[t])Ft[t].hasOwnProperty(e)&&r[t].push(e);return r},b.addFont=function(t,e,r,n,i){var a=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&-1!==a.indexOf(arguments[3])?i=arguments[3]:arguments[3]&&-1==a.indexOf(arguments[3])&&(r=O(r,n)),i=i||"Identity-H",Se.call(this,t,e,r,i)};var cr,lr=t.lineWidth||.200025,hr=b.__private__.setLineWidth=b.setLineWidth=function(t){return ct(B(T(t))+" w"),this};b.__private__.setLineDash=j.API.setLineDash=j.API.setLineDashPattern=function(t,e){if(t=t||[],e=e||0,isNaN(e)||!Array.isArray(t))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return t=t.map((function(t){return B(T(t))})).join(" "),e=B(T(e)),ct("["+t+"] "+e+" d"),this};var fr=b.__private__.getLineHeight=b.getLineHeight=function(){return dt*cr};b.__private__.getLineHeight=b.getLineHeight=function(){return dt*cr};var dr=b.__private__.setLineHeightFactor=b.setLineHeightFactor=function(t){return"number"==typeof(t=t||1.15)&&(cr=t),this},pr=b.__private__.getLineHeightFactor=b.getLineHeightFactor=function(){return cr};dr(t.lineHeight);var gr=b.__private__.getHorizontalCoordinate=function(t){return T(t)},mr=b.__private__.getVerticalCoordinate=function(t){return x===L.ADVANCED?t:qt[K].mediaBox.topRightY-qt[K].mediaBox.bottomLeftY-T(t)},vr=b.__private__.getHorizontalCoordinateString=b.getHorizontalCoordinateString=function(t){return B(gr(t))},br=b.__private__.getVerticalCoordinateString=b.getVerticalCoordinateString=function(t){return B(mr(t))},yr=t.strokeColor||"0 G";b.__private__.getStrokeColor=b.getDrawColor=function(){return Qt(yr)},b.__private__.setStrokeColor=b.setDrawColor=function(t,e,r,n){return yr=te({ch1:t,ch2:e,ch3:r,ch4:n,pdfColorType:"draw",precision:2}),ct(yr),this};var wr=t.fillColor||"0 g";b.__private__.getFillColor=b.getFillColor=function(){return Qt(wr)},b.__private__.setFillColor=b.setFillColor=function(t,e,r,n){return wr=te({ch1:t,ch2:e,ch3:r,ch4:n,pdfColorType:"fill",precision:2}),ct(wr),this};var Nr=t.textColor||"0 g",Ar=b.__private__.getTextColor=b.getTextColor=function(){return Qt(Nr)};b.__private__.setTextColor=b.setTextColor=function(t,e,r,n){return Nr=te({ch1:t,ch2:e,ch3:r,ch4:n,pdfColorType:"text",precision:3}),this};var Lr=t.charSpace,xr=b.__private__.getCharSpace=b.getCharSpace=function(){return parseFloat(Lr||0)};b.__private__.setCharSpace=b.setCharSpace=function(t){if(isNaN(t))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Lr=t,this};var Sr=0;b.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},b.__private__.setLineCap=b.setLineCap=function(t){var e=b.CapJoinStyles[t];if(void 0===e)throw new Error("Line cap style of '"+t+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Sr=e,ct(e+" J"),this};var _r=0;b.__private__.setLineJoin=b.setLineJoin=function(t){var e=b.CapJoinStyles[t];if(void 0===e)throw new Error("Line join style of '"+t+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return _r=e,ct(e+" j"),this},b.__private__.setLineMiterLimit=b.__private__.setMiterLimit=b.setLineMiterLimit=b.setMiterLimit=function(t){if(t=t||0,isNaN(t))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return ct(B(T(t))+" M"),this},b.GState=k,b.setGState=function(t){(t="string"==typeof t?Ot[Bt[t]]:Pr(null,t)).equals(Mt)||(ct("/"+t.id+" gs"),Mt=t)};var Pr=function(t,e){if(!t||!Bt[t]){var r=!1;for(var n in Ot)if(Ot.hasOwnProperty(n)&&Ot[n].equals(e)){r=!0;break}if(r)e=Ot[n];else{var i="GS"+(Object.keys(Ot).length+1).toString(10);Ot[i]=e,e.id=i}return t&&(Bt[t]=e.id),Rt.publish("addGState",e),e}};b.addGState=function(t,e){return Pr(t,e),this},b.saveGraphicsState=function(){return ct("q"),It.push({key:Lt,size:dt,color:Nr}),this},b.restoreGraphicsState=function(){ct("Q");var t=It.pop();return Lt=t.key,dt=t.size,Nr=t.color,Mt=null,this},b.setCurrentTransformationMatrix=function(t){return ct(t.toString()+" cm"),this},b.comment=function(t){return ct("#"+t),this};var kr=function(t,e){var r=t||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return r},set:function(t){isNaN(t)||(r=parseFloat(t))}});var n=e||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return n},set:function(t){isNaN(t)||(n=parseFloat(t))}});var i="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return i},set:function(t){i=t.toString()}}),this},Fr=function(t,e,r,n){kr.call(this,t,e),this.type="rect";var i=r||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return i},set:function(t){isNaN(t)||(i=parseFloat(t))}});var a=n||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return a},set:function(t){isNaN(t)||(a=parseFloat(t))}}),this},Ir=function(){this.page=Et,this.currentPage=K,this.pages=it.slice(0),this.pagesContext=qt.slice(0),this.x=St,this.y=_t,this.matrix=Pt,this.width=Br(K),this.height=Er(K),this.outputDestination=ot,this.id="",this.objectNumber=-1};Ir.prototype.restore=function(){Et=this.page,K=this.currentPage,qt=this.pagesContext,it=this.pages,St=this.x,_t=this.y,Pt=this.matrix,Mr(K,this.width),qr(K,this.height),ot=this.outputDestination};var Cr=function(t,e,r,n,i){zt.push(new Ir),Et=K=0,it=[],St=t,_t=e,Pt=i,Ie([r,n])},jr=function(t){if(!Ut[t]){var e=new Ir,r="Xo"+(Object.keys(Dt).length+1).toString(10);e.id=r,Ut[t]=r,Dt[r]=e,Rt.publish("addFormObject",e),zt.pop().restore()}};for(var Or in b.beginFormObject=function(t,e,r,n,i){return Cr(t,e,r,n,i),this},b.endFormObject=function(t){return jr(t),this},b.doFormObject=function(t,e){var r=Dt[Ut[t]];return ct("q"),ct(e.toString()+" cm"),ct("/"+r.id+" Do"),ct("Q"),this},b.getFormObject=function(t){var e=Dt[Ut[t]];return{x:e.x,y:e.y,width:e.width,height:e.height,matrix:e.matrix}},b.save=function(t,r){return t=t||"generated.pdf",(r=r||{}).returnPromise=r.returnPromise||!1,!1===r.returnPromise?(c(ze(Ue()),t),"function"==typeof c.unload&&e.setTimeout&&setTimeout(c.unload,911),this):new Promise((function(r,n){try{var i=c(ze(Ue()),t);"function"==typeof c.unload&&e.setTimeout&&setTimeout(c.unload,911),r(i)}catch(t){n(t.message)}}))},j.API)j.API.hasOwnProperty(Or)&&("events"===Or&&j.API.events.length?function(t,e){var r,n,i;for(i=e.length-1;-1!==i;i--)r=e[i][0],n=e[i][1],t.subscribe.apply(t,[r].concat("function"==typeof n?[n]:n))}(Rt,j.API.events):b[Or]=j.API[Or]);var Br=b.getPageWidth=function(t){return(qt[t=t||K].mediaBox.topRightX-qt[t].mediaBox.bottomLeftX)/xt},Mr=b.setPageWidth=function(t,e){qt[t].mediaBox.topRightX=e*xt+qt[t].mediaBox.bottomLeftX},Er=b.getPageHeight=function(t){return(qt[t=t||K].mediaBox.topRightY-qt[t].mediaBox.bottomLeftY)/xt},qr=b.setPageHeight=function(t,e){qt[t].mediaBox.topRightY=e*xt+qt[t].mediaBox.bottomLeftY};return b.internal={pdfEscape:Fe,getStyle:$e,getFont:ur,getFontSize:gt,getCharSpace:xr,getTextColor:Ar,getLineHeight:fr,getLineHeightFactor:pr,write:lt,getHorizontalCoordinate:gr,getVerticalCoordinate:mr,getCoordinateString:vr,getVerticalCoordinateString:br,collections:{},newObject:Yt,newAdditionalObject:Kt,newObjectDeferred:Jt,newObjectDeferredBegin:Xt,getFilters:ee,putStream:re,events:Rt,scaleFactor:xt,pageSize:{getWidth:function(){return Br(K)},setWidth:function(t){Mr(K,t)},getHeight:function(){return Er(K)},setHeight:function(t){qr(K,t)}},encryptionOptions:g,encryption:Ve,getEncryptor:Ge,output:He,getNumberOfPages:Be,pages:it,out:ct,f2:q,f3:R,getPageInfo:Ye,getPageInfoByObjId:Je,getCurrentPageInfo:Xe,getPDFVersion:w,Point:kr,Rectangle:Fr,Matrix:Ht,hasHotfix:We},Object.defineProperty(b.internal.pageSize,"width",{get:function(){return Br(K)},set:function(t){Mr(K,t)},enumerable:!0,configurable:!0}),Object.defineProperty(b.internal.pageSize,"height",{get:function(){return Er(K)},set:function(t){qr(K,t)},enumerable:!0,configurable:!0}),_e.call(b,ft),Lt="F1",Ce(o,i),Rt.publish("initialized"),b}_.prototype.lsbFirstWord=function(t){return String.fromCharCode(t>>0&255,t>>8&255,t>>16&255,t>>24&255)},_.prototype.toHexString=function(t){return t.split("").map((function(t){return("0"+(255&t.charCodeAt(0)).toString(16)).slice(-2)})).join("")},_.prototype.hexToBytes=function(t){for(var e=[],r=0;r<t.length;r+=2)e.push(String.fromCharCode(parseInt(t.substr(r,2),16)));return e.join("")},_.prototype.processOwnerPassword=function(t,e){return x(A(e).substr(0,5),t)},_.prototype.encryptor=function(t,e){let r=A(this.encryptionKey+String.fromCharCode(255&t,t>>8&255,t>>16&255,255&e,e>>8&255)).substr(0,10);return function(t){return x(r,t)}},k.prototype.equals=function(t){var e,r="id,objectNumber,equals";if(!t||typeof t!=typeof this)return!1;var n=0;for(e in this)if(!(r.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!t.hasOwnProperty(e))return!1;if(this[e]!==t[e])return!1;n++}for(e in t)t.hasOwnProperty(e)&&r.indexOf(e)<0&&n--;return 0===n},j.API={events:[]},j.version="2.3.1";var O=j.API,B=1,M=function(t){return t.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},E=function(t){return t.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},q=function(t){return t.toFixed(2)},R=function(t){return t.toFixed(5)};O.__acroform__={};var T=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t},D=function(t){return t*B},U=function(t){var e=new at,r=yt.internal.getHeight(t)||0,n=yt.internal.getWidth(t)||0;return e.BBox=[0,0,Number(q(n)),Number(q(r))],e},z=O.__acroform__.setBit=function(t,e){if(t=t||0,e=e||0,isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return t|=1<<e},H=O.__acroform__.clearBit=function(t,e){if(t=t||0,e=e||0,isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return t&=~(1<<e)},W=O.__acroform__.getBit=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return 0==(t&1<<e)?0:1},V=O.__acroform__.getBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return W(t,e-1)},G=O.__acroform__.setBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return z(t,e-1)},Y=O.__acroform__.clearBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return H(t,e-1)},J=O.__acroform__.calculateCoordinates=function(t,e){var r=e.internal.getHorizontalCoordinate,n=e.internal.getVerticalCoordinate,i=t[0],a=t[1],o=t[2],s=t[3],u={};return u.lowerLeft_X=r(i)||0,u.lowerLeft_Y=n(a+s)||0,u.upperRight_X=r(i+o)||0,u.upperRight_Y=n(a)||0,[Number(q(u.lowerLeft_X)),Number(q(u.lowerLeft_Y)),Number(q(u.upperRight_X)),Number(q(u.upperRight_Y))]},X=function(t){if(t.appearanceStreamContent)return t.appearanceStreamContent;if(t.V||t.DV){var e=[],r=t._V||t.DV,n=K(t,r),i=t.scope.internal.getFont(t.fontName,t.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(t.scope.__private__.encodeColorString(t.color)),e.push("/"+i+" "+q(n.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(n.text),e.push("ET"),e.push("Q"),e.push("EMC");var a=U(t);return a.scope=t.scope,a.stream=e.join("\n"),a}},K=function(t,e){var r=0===t.fontSize?t.maxFontSize:t.fontSize,n={text:"",fontSize:""},i=(e=")"==(e="("==e.substr(0,1)?e.substr(1):e).substr(e.length-1)?e.substr(0,e.length-1):e).split(" "),a=r,o=yt.internal.getHeight(t)||0;o=o<0?-o:o;var s=yt.internal.getWidth(t)||0;s=s<0?-s:s;var u=function(e,r,n){if(e+1<i.length){var a=r+" "+i[e+1];return Z(a,t,n).width<=s-4}return!1};a++;t:for(;a>0;){e="",a--;var c,l,h=Z("3",t,a).height,f=t.multiline?o-a:(o-h)/2,d=f+=2,p=0,g=0;if(a<=0){e="(...) Tj\n",e+="% Width of Text: "+Z(e,t,a=12).width+", FieldWidth:"+s+"\n";break}var m="",v=0;for(var b in i)if(i.hasOwnProperty(b)){m=" "==(m+=i[b]+" ").substr(m.length-1)?m.substr(0,m.length-1):m;var y=parseInt(b),w=u(y,m,a),N=b>=i.length-1;if(w&&!N){m+=" ";continue}if(w||N){if(N)g=y;else if(t.multiline&&(h+2)*(v+2)+2>o)continue t}else{if(!t.multiline)continue t;if((h+2)*(v+2)+2>o)continue t;g=y}for(var A="",L=p;L<=g;L++)A+=i[L]+" ";switch(A=" "==A.substr(A.length-1)?A.substr(0,A.length-1):A,l=Z(A,t,a).width,t.textAlign){case"right":c=s-l-2;break;case"center":c=(s-l)/2;break;case"left":default:c=2}e+=q(c)+" "+q(d)+" Td\n",e+="("+M(A)+") Tj\n",e+=-q(c)+" 0 Td\n",d=-(a+2),l=0,p=g+1,v++,m=""}else;break}return n.text=e,n.fontSize=a,n},Z=function(t,e,r){var n=e.scope.internal.getFont(e.fontName,e.fontStyle),i=e.scope.getStringUnitWidth(t,{font:n,fontSize:parseFloat(r),charSpace:0})*parseFloat(r);return{height:e.scope.getStringUnitWidth("3",{font:n,fontSize:parseFloat(r),charSpace:0})*parseFloat(r)*1.5,width:i}},$={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},Q=function(t,e){var r={type:"reference",object:t};void 0===e.internal.getPageInfo(t.page).pageContext.annotations.find((function(t){return t.type===r.type&&t.object===r.object}))&&e.internal.getPageInfo(t.page).pageContext.annotations.push(r)},tt=function(t,e){for(var r in t)if(t.hasOwnProperty(r)){var n=r,i=t[r];e.internal.newObjectDeferredBegin(i.objId,!0),"object"==typeof i&&"function"==typeof i.putStream&&i.putStream(),delete t[n]}},et=function(t,e){if(e.scope=t,void 0!==t.internal&&(void 0===t.internal.acroformPlugin||!1===t.internal.acroformPlugin.isInitialized)){if(st.FieldNum=0,t.internal.acroformPlugin=JSON.parse(JSON.stringify($)),t.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");B=t.internal.scaleFactor,t.internal.acroformPlugin.acroFormDictionaryRoot=new ot,t.internal.acroformPlugin.acroFormDictionaryRoot.scope=t,t.internal.acroformPlugin.acroFormDictionaryRoot._eventID=t.internal.events.subscribe("postPutResources",(function(){!function(t){t.internal.events.unsubscribe(t.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete t.internal.acroformPlugin.acroFormDictionaryRoot._eventID,t.internal.acroformPlugin.printedOut=!0}(t)})),t.internal.events.subscribe("buildDocument",(function(){!function(t){t.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var e=t.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];n.objId=void 0,n.hasAnnotation&&Q(n,t)}}(t)})),t.internal.events.subscribe("putCatalog",(function(){!function(t){if(void 0===t.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("putCatalogCallback: Root missing.");t.internal.write("/AcroForm "+t.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")}(t)})),t.internal.events.subscribe("postPutPages",(function(e){!function(t,e){var r=!t;for(var n in t||(e.internal.newObjectDeferredBegin(e.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),e.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),t=t||e.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(t.hasOwnProperty(n)){var i=t[n],a=[],o=i.Rect;if(i.Rect&&(i.Rect=J(i.Rect,e)),e.internal.newObjectDeferredBegin(i.objId,!0),i.DA=yt.createDefaultAppearanceStream(i),"object"==typeof i&&"function"==typeof i.getKeyValueListForStream&&(a=i.getKeyValueListForStream()),i.Rect=o,i.hasAppearanceStream&&!i.appearanceStreamContent){var s=X(i);a.push({key:"AP",value:"<</N "+s+">>"}),e.internal.acroformPlugin.xForms.push(s)}if(i.appearanceStreamContent){var u="";for(var c in i.appearanceStreamContent)if(i.appearanceStreamContent.hasOwnProperty(c)){var l=i.appearanceStreamContent[c];if(u+="/"+c+" ",u+="<<",Object.keys(l).length>=1||Array.isArray(l)){for(var n in l)if(l.hasOwnProperty(n)){var h=l[n];"function"==typeof h&&(h=h.call(e,i)),u+="/"+n+" "+h+" ",e.internal.acroformPlugin.xForms.indexOf(h)>=0||e.internal.acroformPlugin.xForms.push(h)}}else"function"==typeof(h=l)&&(h=h.call(e,i)),u+="/"+n+" "+h,e.internal.acroformPlugin.xForms.indexOf(h)>=0||e.internal.acroformPlugin.xForms.push(h);u+=">>"}a.push({key:"AP",value:"<<\n"+u+">>"})}e.internal.putStream({additionalKeyValues:a,objectId:i.objId}),e.internal.out("endobj")}r&&tt(e.internal.acroformPlugin.xForms,e)}(e,t)})),t.internal.acroformPlugin.isInitialized=!0}},rt=O.__acroform__.arrayToPdfArray=function(t,e,r){var n=function(t){return t};if(Array.isArray(t)){for(var i="[",a=0;a<t.length;a++)switch(0!==a&&(i+=" "),typeof t[a]){case"boolean":case"number":case"object":i+=t[a].toString();break;case"string":"/"!==t[a].substr(0,1)?(void 0!==e&&r&&(n=r.internal.getEncryptor(e)),i+="("+M(n(t[a].toString()))+")"):i+=t[a].toString()}return i+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")};var nt=function(t,e,r){var n=function(t){return t};return void 0!==e&&r&&(n=r.internal.getEncryptor(e)),(t=t||"").toString(),t="("+M(n(t))+")"},it=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(void 0===this._objId){if(void 0===this.scope)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(t){this._objId=t}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};it.prototype.toString=function(){return this.objId+" 0 R"},it.prototype.putStream=function(){var t=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:t,objectId:this.objId}),this.scope.internal.out("endobj")},it.prototype.getKeyValueListForStream=function(){var t=[],e=Object.getOwnPropertyNames(this).filter((function(t){return"content"!=t&&"appearanceStreamContent"!=t&&"scope"!=t&&"objId"!=t&&"_"!=t.substring(0,1)}));for(var r in e)if(!1===Object.getOwnPropertyDescriptor(this,e[r]).configurable){var n=e[r],i=this[n];i&&(Array.isArray(i)?t.push({key:n,value:rt(i,this.objId,this.scope)}):i instanceof it?(i.scope=this.scope,t.push({key:n,value:i.objId+" 0 R"})):"function"!=typeof i&&t.push({key:n,value:i}))}return t};var at=function(){it.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var t,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(e){t=e.trim()},get:function(){return t||null}})};T(at,it);var ot=function(){it.call(this);var t,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(t){var e=function(t){return t};return this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),"("+M(e(t))+")"}},set:function(e){t=e}})};T(ot,it);var st=function(){it.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(e){if(isNaN(e))throw new Error('Invalid value "'+e+'" for attribute F supplied.');t=e}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return Boolean(V(t,3))},set:function(e){!0===Boolean(e)?this.F=G(t,3):this.F=Y(t,3)}});var e=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return e},set:function(t){if(isNaN(t))throw new Error('Invalid value "'+t+'" for attribute Ff supplied.');e=t}});var r=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(0!==r.length)return r},set:function(t){r=void 0!==t?t:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[0])?0:r[0]},set:function(t){r[0]=t}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[1])?0:r[1]},set:function(t){r[1]=t}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[2])?0:r[2]},set:function(t){r[2]=t}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[3])?0:r[3]},set:function(t){r[3]=t}});var n="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return n},set:function(t){switch(t){case"/Btn":case"/Tx":case"/Ch":case"/Sig":n=t;break;default:throw new Error('Invalid value "'+t+'" for attribute FT supplied.')}}});var i=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!i||i.length<1){if(this instanceof gt)return;i="FieldObject"+st.FieldNum++}var t=function(t){return t};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+M(t(i))+")"},set:function(t){i=t.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return i},set:function(t){i=t}});var a="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return a},set:function(t){a=t}});var o="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return o},set:function(t){o=t}});var s=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return s},set:function(t){s=t}});var u=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return void 0===u?50/B:u},set:function(t){u=t}});var c="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return c},set:function(t){c=t}});var l="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!l||this instanceof gt||this instanceof vt))return nt(l,this.objId,this.scope)},set:function(t){t=t.toString(),l=t}});var h=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(h)return this instanceof ft==!1?nt(h,this.objId,this.scope):h},set:function(t){t=t.toString(),h=this instanceof ft==!1?"("===t.substr(0,1)?E(t.substr(1,t.length-2)):E(t):t}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof ft==!0?E(h.substr(1,h.length-1)):h},set:function(t){t=t.toString(),h=this instanceof ft==!0?"/"+t:t}});var f=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(f)return f},set:function(t){this.V=t}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(f)return this instanceof ft==!1?nt(f,this.objId,this.scope):f},set:function(t){t=t.toString(),f=this instanceof ft==!1?"("===t.substr(0,1)?E(t.substr(1,t.length-2)):E(t):t}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof ft==!0?E(f.substr(1,f.length-1)):f},set:function(t){t=t.toString(),f=this instanceof ft==!0?"/"+t:t}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var d,p=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return p},set:function(t){t=Boolean(t),p=t}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(d)return d},set:function(t){d=t}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return Boolean(V(this.Ff,1))},set:function(t){!0===Boolean(t)?this.Ff=G(this.Ff,1):this.Ff=Y(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return Boolean(V(this.Ff,2))},set:function(t){!0===Boolean(t)?this.Ff=G(this.Ff,2):this.Ff=Y(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return Boolean(V(this.Ff,3))},set:function(t){!0===Boolean(t)?this.Ff=G(this.Ff,3):this.Ff=Y(this.Ff,3)}});var g=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(null!==g)return g},set:function(t){if(-1===[0,1,2].indexOf(t))throw new Error('Invalid value "'+t+'" for attribute Q supplied.');g=t}}),Object.defineProperty(this,"textAlign",{get:function(){var t;switch(g){case 0:default:t="left";break;case 1:t="center";break;case 2:t="right"}return t},configurable:!0,enumerable:!0,set:function(t){switch(t){case"right":case 2:g=2;break;case"center":case 1:g=1;break;case"left":case 0:default:g=0}}})};T(st,it);var ut=function(){st.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var t=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return t},set:function(e){t=e}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return rt(e,this.objId,this.scope)},set:function(t){var r,n;n=[],"string"==typeof(r=t)&&(n=function(t,e,r){r||(r=1);for(var n,i=[];n=e.exec(t);)i.push(n[r]);return i}(r,/\((.*?)\)/g)),e=n}}),this.getOptions=function(){return e},this.setOptions=function(t){e=t,this.sort&&e.sort()},this.addOption=function(t){t=(t=t||"").toString(),e.push(t),this.sort&&e.sort()},this.removeOption=function(t,r){for(r=r||!1,t=(t=t||"").toString();-1!==e.indexOf(t)&&(e.splice(e.indexOf(t),1),!1!==r););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return Boolean(V(this.Ff,18))},set:function(t){!0===Boolean(t)?this.Ff=G(this.Ff,18):this.Ff=Y(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return Boolean(V(this.Ff,19))},set:function(t){!0===this.combo&&(!0===Boolean(t)?this.Ff=G(this.Ff,19):this.Ff=Y(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return Boolean(V(this.Ff,20))},set:function(t){!0===Boolean(t)?(this.Ff=G(this.Ff,20),e.sort()):this.Ff=Y(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return Boolean(V(this.Ff,22))},set:function(t){!0===Boolean(t)?this.Ff=G(this.Ff,22):this.Ff=Y(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return Boolean(V(this.Ff,23))},set:function(t){!0===Boolean(t)?this.Ff=G(this.Ff,23):this.Ff=Y(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return Boolean(V(this.Ff,27))},set:function(t){!0===Boolean(t)?this.Ff=G(this.Ff,27):this.Ff=Y(this.Ff,27)}}),this.hasAppearanceStream=!1};T(ut,st);var ct=function(){ut.call(this),this.fontName="helvetica",this.combo=!1};T(ct,ut);var lt=function(){ct.call(this),this.combo=!0};T(lt,ct);var ht=function(){lt.call(this),this.edit=!0};T(ht,lt);var ft=function(){st.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return Boolean(V(this.Ff,15))},set:function(t){!0===Boolean(t)?this.Ff=G(this.Ff,15):this.Ff=Y(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return Boolean(V(this.Ff,16))},set:function(t){!0===Boolean(t)?this.Ff=G(this.Ff,16):this.Ff=Y(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return Boolean(V(this.Ff,17))},set:function(t){!0===Boolean(t)?this.Ff=G(this.Ff,17):this.Ff=Y(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return Boolean(V(this.Ff,26))},set:function(t){!0===Boolean(t)?this.Ff=G(this.Ff,26):this.Ff=Y(this.Ff,26)}});var t,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var t=function(t){return t};if(this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),0!==Object.keys(e).length){var r,n=[];for(r in n.push("<<"),e)n.push("/"+r+" ("+M(t(e[r]))+")");return n.push(">>"),n.join("\n")}},set:function(t){"object"==typeof t&&(e=t)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(t){"string"==typeof t&&(e.CA=t)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(e){t="/"+e}})};T(ft,st);var dt=function(){ft.call(this),this.pushButton=!0};T(dt,ft);var pt=function(){ft.call(this),this.radio=!0,this.pushButton=!1;var t=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return t},set:function(e){t=void 0!==e?e:[]}})};T(pt,ft);var gt=function(){var t,e;st.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(t){e=t}});var r,n={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var t=function(t){return t};this.scope&&(t=this.scope.internal.getEncryptor(this.objId));var e,r=[];for(e in r.push("<<"),n)r.push("/"+e+" ("+M(t(n[e]))+")");return r.push(">>"),r.join("\n")},set:function(t){"object"==typeof t&&(n=t)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return n.CA||""},set:function(t){"string"==typeof t&&(n.CA=t)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return r},set:function(t){r=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return r.substr(1,r.length-1)},set:function(t){r="/"+t}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=yt.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};T(gt,st),pt.prototype.setAppearance=function(t){if(!("createAppearanceStream"in t)||!("getCA"in t))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var r=this.Kids[e];r.appearanceStreamContent=t.createAppearanceStream(r.optionName),r.caption=t.getCA()}},pt.prototype.createOption=function(t){var e=new gt;return e.Parent=this,e.optionName=t,this.Kids.push(e),wt.call(this.scope,e),e};var mt=function(){ft.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=yt.CheckBox.createAppearanceStream()};T(mt,ft);var vt=function(){st.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return Boolean(V(this.Ff,13))},set:function(t){!0===Boolean(t)?this.Ff=G(this.Ff,13):this.Ff=Y(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return Boolean(V(this.Ff,21))},set:function(t){!0===Boolean(t)?this.Ff=G(this.Ff,21):this.Ff=Y(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return Boolean(V(this.Ff,23))},set:function(t){!0===Boolean(t)?this.Ff=G(this.Ff,23):this.Ff=Y(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return Boolean(V(this.Ff,24))},set:function(t){!0===Boolean(t)?this.Ff=G(this.Ff,24):this.Ff=Y(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return Boolean(V(this.Ff,25))},set:function(t){!0===Boolean(t)?this.Ff=G(this.Ff,25):this.Ff=Y(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return Boolean(V(this.Ff,26))},set:function(t){!0===Boolean(t)?this.Ff=G(this.Ff,26):this.Ff=Y(this.Ff,26)}});var t=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return t},set:function(e){Number.isInteger(e)&&(t=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};T(vt,st);var bt=function(){vt.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return Boolean(V(this.Ff,14))},set:function(t){!0===Boolean(t)?this.Ff=G(this.Ff,14):this.Ff=Y(this.Ff,14)}}),this.password=!0};T(bt,vt);var yt={CheckBox:{createAppearanceStream:function(){return{N:{On:yt.CheckBox.YesNormal},D:{On:yt.CheckBox.YesPushDown,Off:yt.CheckBox.OffPushDown}}},YesPushDown:function(t){var e=U(t);e.scope=t.scope;var r=[],n=t.scope.internal.getFont(t.fontName,t.fontStyle).id,i=t.scope.__private__.encodeColorString(t.color),a=K(t,t.caption);return r.push("0.749023 g"),r.push("0 0 "+q(yt.internal.getWidth(t))+" "+q(yt.internal.getHeight(t))+" re"),r.push("f"),r.push("BMC"),r.push("q"),r.push("0 0 1 rg"),r.push("/"+n+" "+q(a.fontSize)+" Tf "+i),r.push("BT"),r.push(a.text),r.push("ET"),r.push("Q"),r.push("EMC"),e.stream=r.join("\n"),e},YesNormal:function(t){var e=U(t);e.scope=t.scope;var r=t.scope.internal.getFont(t.fontName,t.fontStyle).id,n=t.scope.__private__.encodeColorString(t.color),i=[],a=yt.internal.getHeight(t),o=yt.internal.getWidth(t),s=K(t,t.caption);return i.push("1 g"),i.push("0 0 "+q(o)+" "+q(a)+" re"),i.push("f"),i.push("q"),i.push("0 0 1 rg"),i.push("0 0 "+q(o-1)+" "+q(a-1)+" re"),i.push("W"),i.push("n"),i.push("0 g"),i.push("BT"),i.push("/"+r+" "+q(s.fontSize)+" Tf "+n),i.push(s.text),i.push("ET"),i.push("Q"),e.stream=i.join("\n"),e},OffPushDown:function(t){var e=U(t);e.scope=t.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+q(yt.internal.getWidth(t))+" "+q(yt.internal.getHeight(t))+" re"),r.push("f"),e.stream=r.join("\n"),e}},RadioButton:{Circle:{createAppearanceStream:function(t){var e={D:{Off:yt.RadioButton.Circle.OffPushDown},N:{}};return e.N[t]=yt.RadioButton.Circle.YesNormal,e.D[t]=yt.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(t){var e=U(t);e.scope=t.scope;var r=[],n=yt.internal.getWidth(t)<=yt.internal.getHeight(t)?yt.internal.getWidth(t)/4:yt.internal.getHeight(t)/4;n=Number((.9*n).toFixed(5));var i=yt.internal.Bezier_C,a=Number((n*i).toFixed(5));return r.push("q"),r.push("1 0 0 1 "+R(yt.internal.getWidth(t)/2)+" "+R(yt.internal.getHeight(t)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+a+" "+a+" "+n+" 0 "+n+" c"),r.push("-"+a+" "+n+" -"+n+" "+a+" -"+n+" 0 c"),r.push("-"+n+" -"+a+" -"+a+" -"+n+" 0 -"+n+" c"),r.push(a+" -"+n+" "+n+" -"+a+" "+n+" 0 c"),r.push("f"),r.push("Q"),e.stream=r.join("\n"),e},YesPushDown:function(t){var e=U(t);e.scope=t.scope;var r=[],n=yt.internal.getWidth(t)<=yt.internal.getHeight(t)?yt.internal.getWidth(t)/4:yt.internal.getHeight(t)/4;n=Number((.9*n).toFixed(5));var i=Number((2*n).toFixed(5)),a=Number((i*yt.internal.Bezier_C).toFixed(5)),o=Number((n*yt.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+R(yt.internal.getWidth(t)/2)+" "+R(yt.internal.getHeight(t)/2)+" cm"),r.push(i+" 0 m"),r.push(i+" "+a+" "+a+" "+i+" 0 "+i+" c"),r.push("-"+a+" "+i+" -"+i+" "+a+" -"+i+" 0 c"),r.push("-"+i+" -"+a+" -"+a+" -"+i+" 0 -"+i+" c"),r.push(a+" -"+i+" "+i+" -"+a+" "+i+" 0 c"),r.push("f"),r.push("Q"),r.push("0 g"),r.push("q"),r.push("1 0 0 1 "+R(yt.internal.getWidth(t)/2)+" "+R(yt.internal.getHeight(t)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+o+" "+o+" "+n+" 0 "+n+" c"),r.push("-"+o+" "+n+" -"+n+" "+o+" -"+n+" 0 c"),r.push("-"+n+" -"+o+" -"+o+" -"+n+" 0 -"+n+" c"),r.push(o+" -"+n+" "+n+" -"+o+" "+n+" 0 c"),r.push("f"),r.push("Q"),e.stream=r.join("\n"),e},OffPushDown:function(t){var e=U(t);e.scope=t.scope;var r=[],n=yt.internal.getWidth(t)<=yt.internal.getHeight(t)?yt.internal.getWidth(t)/4:yt.internal.getHeight(t)/4;n=Number((.9*n).toFixed(5));var i=Number((2*n).toFixed(5)),a=Number((i*yt.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+R(yt.internal.getWidth(t)/2)+" "+R(yt.internal.getHeight(t)/2)+" cm"),r.push(i+" 0 m"),r.push(i+" "+a+" "+a+" "+i+" 0 "+i+" c"),r.push("-"+a+" "+i+" -"+i+" "+a+" -"+i+" 0 c"),r.push("-"+i+" -"+a+" -"+a+" -"+i+" 0 -"+i+" c"),r.push(a+" -"+i+" "+i+" -"+a+" "+i+" 0 c"),r.push("f"),r.push("Q"),e.stream=r.join("\n"),e}},Cross:{createAppearanceStream:function(t){var e={D:{Off:yt.RadioButton.Cross.OffPushDown},N:{}};return e.N[t]=yt.RadioButton.Cross.YesNormal,e.D[t]=yt.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(t){var e=U(t);e.scope=t.scope;var r=[],n=yt.internal.calculateCross(t);return r.push("q"),r.push("1 1 "+q(yt.internal.getWidth(t)-2)+" "+q(yt.internal.getHeight(t)-2)+" re"),r.push("W"),r.push("n"),r.push(q(n.x1.x)+" "+q(n.x1.y)+" m"),r.push(q(n.x2.x)+" "+q(n.x2.y)+" l"),r.push(q(n.x4.x)+" "+q(n.x4.y)+" m"),r.push(q(n.x3.x)+" "+q(n.x3.y)+" l"),r.push("s"),r.push("Q"),e.stream=r.join("\n"),e},YesPushDown:function(t){var e=U(t);e.scope=t.scope;var r=yt.internal.calculateCross(t),n=[];return n.push("0.749023 g"),n.push("0 0 "+q(yt.internal.getWidth(t))+" "+q(yt.internal.getHeight(t))+" re"),n.push("f"),n.push("q"),n.push("1 1 "+q(yt.internal.getWidth(t)-2)+" "+q(yt.internal.getHeight(t)-2)+" re"),n.push("W"),n.push("n"),n.push(q(r.x1.x)+" "+q(r.x1.y)+" m"),n.push(q(r.x2.x)+" "+q(r.x2.y)+" l"),n.push(q(r.x4.x)+" "+q(r.x4.y)+" m"),n.push(q(r.x3.x)+" "+q(r.x3.y)+" l"),n.push("s"),n.push("Q"),e.stream=n.join("\n"),e},OffPushDown:function(t){var e=U(t);e.scope=t.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+q(yt.internal.getWidth(t))+" "+q(yt.internal.getHeight(t))+" re"),r.push("f"),e.stream=r.join("\n"),e}}},createDefaultAppearanceStream:function(t){var e=t.scope.internal.getFont(t.fontName,t.fontStyle).id,r=t.scope.__private__.encodeColorString(t.color);return"/"+e+" "+t.fontSize+" Tf "+r}};yt.internal={Bezier_C:.551915024494,calculateCross:function(t){var e=yt.internal.getWidth(t),r=yt.internal.getHeight(t),n=Math.min(e,r);return{x1:{x:(e-n)/2,y:(r-n)/2+n},x2:{x:(e-n)/2+n,y:(r-n)/2},x3:{x:(e-n)/2,y:(r-n)/2},x4:{x:(e-n)/2+n,y:(r-n)/2+n}}}},yt.internal.getWidth=function(t){var e=0;return"object"==typeof t&&(e=D(t.Rect[2])),e},yt.internal.getHeight=function(t){var e=0;return"object"==typeof t&&(e=D(t.Rect[3])),e};var wt=O.addField=function(t){if(et(this,t),!(t instanceof st))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=t).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),t.page=t.scope.internal.getCurrentPageInfo().pageNumber,this};O.AcroFormChoiceField=ut,O.AcroFormListBox=ct,O.AcroFormComboBox=lt,O.AcroFormEditBox=ht,O.AcroFormButton=ft,O.AcroFormPushButton=dt,O.AcroFormRadioButton=pt,O.AcroFormCheckBox=mt,O.AcroFormTextField=vt,O.AcroFormPasswordField=bt,O.AcroFormAppearance=yt,O.AcroForm={ChoiceField:ut,ListBox:ct,ComboBox:lt,EditBox:ht,Button:ft,PushButton:dt,RadioButton:pt,CheckBox:mt,TextField:vt,PasswordField:bt,Appearance:yt},j.AcroForm={ChoiceField:ut,ListBox:ct,ComboBox:lt,EditBox:ht,Button:ft,PushButton:dt,RadioButton:pt,CheckBox:mt,TextField:vt,PasswordField:bt,Appearance:yt};var Nt=j.AcroForm;function At(t){return t.reduce((function(t,e,r){return t[e]=r,t}),{})}!function(t){t.__addimage__={};var e="UNKNOWN",r={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},n=t.__addimage__.getImageFileTypeByImageData=function(t,n){var i,a;n=n||e;var o,s,u,c=e;if(x(t))for(u in r)for(o=r[u],i=0;i<o.length;i+=1){for(s=!0,a=0;a<o[i].length;a+=1)if(void 0!==o[i][a]&&o[i][a]!==t[a]){s=!1;break}if(!0===s){c=u;break}}else for(u in r)for(o=r[u],i=0;i<o.length;i+=1){for(s=!0,a=0;a<o[i].length;a+=1)if(void 0!==o[i][a]&&o[i][a]!==t.charCodeAt(a)){s=!1;break}if(!0===s){c=u;break}}return c===e&&n!==e&&(c=n),c},i=function(t){for(var e=this.internal.write,r=this.internal.putStream,n=(0,this.internal.getFilters)();-1!==n.indexOf("FlateEncode");)n.splice(n.indexOf("FlateEncode"),1);t.objectId=this.internal.newObject();var a=[];if(a.push({key:"Type",value:"/XObject"}),a.push({key:"Subtype",value:"/Image"}),a.push({key:"Width",value:t.width}),a.push({key:"Height",value:t.height}),t.colorSpace===b.INDEXED?a.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(t.palette.length/3-1)+" "+("sMask"in t&&void 0!==t.sMask?t.objectId+2:t.objectId+1)+" 0 R]"}):(a.push({key:"ColorSpace",value:"/"+t.colorSpace}),t.colorSpace===b.DEVICE_CMYK&&a.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),a.push({key:"BitsPerComponent",value:t.bitsPerComponent}),"decodeParameters"in t&&void 0!==t.decodeParameters&&a.push({key:"DecodeParms",value:"<<"+t.decodeParameters+">>"}),"transparency"in t&&Array.isArray(t.transparency)){for(var o="",s=0,u=t.transparency.length;s<u;s++)o+=t.transparency[s]+" "+t.transparency[s]+" ";a.push({key:"Mask",value:"["+o+"]"})}void 0!==t.sMask&&a.push({key:"SMask",value:t.objectId+1+" 0 R"});var c=void 0!==t.filter?["/"+t.filter]:void 0;if(r({data:t.data,additionalKeyValues:a,alreadyAppliedFilters:c,objectId:t.objectId}),e("endobj"),"sMask"in t&&void 0!==t.sMask){var l="/Predictor "+t.predictor+" /Colors 1 /BitsPerComponent "+t.bitsPerComponent+" /Columns "+t.width,h={width:t.width,height:t.height,colorSpace:"DeviceGray",bitsPerComponent:t.bitsPerComponent,decodeParameters:l,data:t.sMask};"filter"in t&&(h.filter=t.filter),i.call(this,h)}if(t.colorSpace===b.INDEXED){var f=this.internal.newObject();r({data:_(new Uint8Array(t.palette)),objectId:f}),e("endobj")}},a=function(){var t=this.internal.collections.addImage_images;for(var e in t)i.call(this,t[e])},o=function(){var t,e=this.internal.collections.addImage_images,r=this.internal.write;for(var n in e)r("/I"+(t=e[n]).index,t.objectId,"0","R")},c=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",a),this.internal.events.subscribe("putXobjectDict",o))},l=function(){var t=this.internal.collections.addImage_images;return c.call(this),t},h=function(){return Object.keys(this.internal.collections.addImage_images).length},f=function(e){return"function"==typeof t["process"+e.toUpperCase()]},d=function(t){return"object"==typeof t&&1===t.nodeType},p=function(e,r){if("IMG"===e.nodeName&&e.hasAttribute("src")){var n=""+e.getAttribute("src");if(0===n.indexOf("data:image/"))return s(unescape(n).split("base64,").pop());var i=t.loadFile(n,!0);if(void 0!==i)return i}if("CANVAS"===e.nodeName){var a;switch(r){case"PNG":a="image/png";break;case"WEBP":a="image/webp";break;case"JPEG":case"JPG":default:a="image/jpeg"}return s(e.toDataURL(a,1).split("base64,").pop())}},g=function(t){var e=this.internal.collections.addImage_images;if(e)for(var r in e)if(t===e[r].alias)return e[r]},m=function(t,e,r){return t||e||(t=-96,e=-96),t<0&&(t=-1*r.width*72/t/this.internal.scaleFactor),e<0&&(e=-1*r.height*72/e/this.internal.scaleFactor),0===t&&(t=e*r.width/r.height),0===e&&(e=t*r.height/r.width),[t,e]},v=function(t,e,r,n,i,a){var o=m.call(this,r,n,i),s=this.internal.getCoordinateString,u=this.internal.getVerticalCoordinateString,c=l.call(this);if(r=o[0],n=o[1],c[i.index]=i,a){a*=Math.PI/180;var h=Math.cos(a),f=Math.sin(a),d=function(t){return t.toFixed(4)},p=[d(h),d(f),d(-1*f),d(h),0,0,"cm"]}this.internal.write("q"),a?(this.internal.write([1,"0","0",1,s(t),u(e+n),"cm"].join(" ")),this.internal.write(p.join(" ")),this.internal.write([s(r),"0","0",s(n),"0","0","cm"].join(" "))):this.internal.write([s(r),"0","0",s(n),s(t),u(e+n),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+i.index+" Do"),this.internal.write("Q")},b=t.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};t.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var y=t.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},w=t.__addimage__.sHashCode=function(t){var e,r,n=0;if("string"==typeof t)for(r=t.length,e=0;e<r;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;else if(x(t))for(r=t.byteLength/2,e=0;e<r;e++)n=(n<<5)-n+t[e],n|=0;return n},N=t.__addimage__.validateStringAsBase64=function(t){(t=t||"").toString().trim();var e=!0;return 0===t.length&&(e=!1),t.length%4!=0&&(e=!1),!1===/^[A-Za-z0-9+/]+$/.test(t.substr(0,t.length-2))&&(e=!1),!1===/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(t.substr(-2))&&(e=!1),e},A=t.__addimage__.extractImageFromDataUrl=function(t){var e=(t=t||"").split("base64,"),r=null;if(2===e.length){var n=/^data:(\w*\/\w*);*(charset=(?!charset=)[\w=-]*)*;*$/.exec(e[0]);Array.isArray(n)&&(r={mimeType:n[1],charset:n[2],data:e[1]})}return r},L=t.__addimage__.supportsArrayBuffer=function(){return"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array};t.__addimage__.isArrayBuffer=function(t){return L()&&t instanceof ArrayBuffer};var x=t.__addimage__.isArrayBufferView=function(t){return L()&&"undefined"!=typeof Uint32Array&&(t instanceof Int8Array||t instanceof Uint8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)},S=t.__addimage__.binaryStringToUint8Array=function(t){for(var e=t.length,r=new Uint8Array(e),n=0;n<e;n++)r[n]=t.charCodeAt(n);return r},_=t.__addimage__.arrayBufferToBinaryString=function(t){try{return s(u(String.fromCharCode.apply(null,t)))}catch(e){if("undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.reduce)return new Uint8Array(t).reduce((function(t,e){return t.push(String.fromCharCode(e)),t}),[]).join("")}};t.addImage=function(){var t,r,n,i,a,o,s,u,l;if("number"==typeof arguments[1]?(r=e,n=arguments[1],i=arguments[2],a=arguments[3],o=arguments[4],s=arguments[5],u=arguments[6],l=arguments[7]):(r=arguments[1],n=arguments[2],i=arguments[3],a=arguments[4],o=arguments[5],s=arguments[6],u=arguments[7],l=arguments[8]),"object"==typeof(t=arguments[0])&&!d(t)&&"imageData"in t){var h=t;t=h.imageData,r=h.format||r||e,n=h.x||n||0,i=h.y||i||0,a=h.w||h.width||a,o=h.h||h.height||o,s=h.alias||s,u=h.compression||u,l=h.rotation||h.angle||l}var f=this.internal.getFilters();if(void 0===u&&-1!==f.indexOf("FlateEncode")&&(u="SLOW"),isNaN(n)||isNaN(i))throw new Error("Invalid coordinates passed to jsPDF.addImage");c.call(this);var p=P.call(this,t,r,s,u);return v.call(this,n,i,a,o,p,l),this};var P=function(r,i,a,o){var s,u,c;if("string"==typeof r&&n(r)===e){r=unescape(r);var l=k(r,!1);(""!==l||void 0!==(l=t.loadFile(r,!0)))&&(r=l)}if(d(r)&&(r=p(r,i)),i=n(r,i),!f(i))throw new Error("addImage does not support files of type '"+i+"', please ensure that a plugin for '"+i+"' support is added.");if((null==(c=a)||0===c.length)&&(a=function(t){return"string"==typeof t||x(t)?w(t):null}(r)),(s=g.call(this,a))||(L()&&(r instanceof Uint8Array||(u=r,r=S(r))),s=this["process"+i.toUpperCase()](r,h.call(this),a,function(e){return e&&"string"==typeof e&&(e=e.toUpperCase()),e in t.image_compression?e:y.NONE}(o),u)),!s)throw new Error("An unknown error occurred whilst processing the image.");return s},k=t.__addimage__.convertBase64ToBinaryString=function(t,e){var r;e="boolean"!=typeof e||e;var n,i="";if("string"==typeof t){n=null!==(r=A(t))?r.data:t;try{i=s(n)}catch(t){if(e)throw N(n)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+t.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return i};t.getImageProperties=function(r){var i,a,o="";if(d(r)&&(r=p(r)),"string"==typeof r&&n(r)===e&&(""===(o=k(r,!1))&&(o=t.loadFile(r)||""),r=o),a=n(r),!f(a))throw new Error("addImage does not support files of type '"+a+"', please ensure that a plugin for '"+a+"' support is added.");if(!L()||r instanceof Uint8Array||(r=S(r)),!(i=this["process"+a.toUpperCase()](r)))throw new Error("An unknown error occurred whilst processing the image");return i.fileType=a,i}}(j.API),function(t){var e=function(t){if(void 0!==t&&""!=t)return!0};j.API.events.push(["addPage",function(t){this.internal.getPageInfo(t.pageNumber).pageContext.annotations=[]}]),t.events.push(["putPage",function(t){for(var r,n,i,a=this.internal.getCoordinateString,o=this.internal.getVerticalCoordinateString,s=this.internal.getPageInfoByObjId(t.objId),u=t.pageContext.annotations,c=!1,l=0;l<u.length&&!c;l++)switch((r=u[l]).type){case"link":(e(r.options.url)||e(r.options.pageNumber))&&(c=!0);break;case"reference":case"text":case"freetext":c=!0}if(0!=c){this.internal.write("/Annots [");for(var h=0;h<u.length;h++){r=u[h];var f=this.internal.pdfEscape,d=this.internal.getEncryptor(t.objId);switch(r.type){case"reference":this.internal.write(" "+r.object.objId+" 0 R ");break;case"text":var p=this.internal.newAdditionalObject(),g=this.internal.newAdditionalObject(),m=this.internal.getEncryptor(p.objId),v=r.title||"Note";i="<</Type /Annot /Subtype /Text "+(n="/Rect ["+a(r.bounds.x)+" "+o(r.bounds.y+r.bounds.h)+" "+a(r.bounds.x+r.bounds.w)+" "+o(r.bounds.y)+"] ")+"/Contents ("+f(m(r.contents))+")",i+=" /Popup "+g.objId+" 0 R",i+=" /P "+s.objId+" 0 R",i+=" /T ("+f(m(v))+") >>",p.content=i;var b=p.objId+" 0 R";i="<</Type /Annot /Subtype /Popup "+(n="/Rect ["+a(r.bounds.x+30)+" "+o(r.bounds.y+r.bounds.h)+" "+a(r.bounds.x+r.bounds.w+30)+" "+o(r.bounds.y)+"] ")+" /Parent "+b,r.open&&(i+=" /Open true"),i+=" >>",g.content=i,this.internal.write(p.objId,"0 R",g.objId,"0 R");break;case"freetext":n="/Rect ["+a(r.bounds.x)+" "+o(r.bounds.y)+" "+a(r.bounds.x+r.bounds.w)+" "+o(r.bounds.y+r.bounds.h)+"] ";var y=r.color||"#000000";i="<</Type /Annot /Subtype /FreeText "+n+"/Contents ("+f(d(r.contents))+")",i+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+y+")",i+=" /Border [0 0 0]",i+=" >>",this.internal.write(i);break;case"link":if(r.options.name){var w=this.annotations._nameMap[r.options.name];r.options.pageNumber=w.page,r.options.top=w.y}else r.options.top||(r.options.top=0);if(n="/Rect ["+r.finalBounds.x+" "+r.finalBounds.y+" "+r.finalBounds.w+" "+r.finalBounds.h+"] ",i="",r.options.url)i="<</Type /Annot /Subtype /Link "+n+"/Border [0 0 0] /A <</S /URI /URI ("+f(d(r.options.url))+") >>";else if(r.options.pageNumber){switch(i="<</Type /Annot /Subtype /Link "+n+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(r.options.pageNumber).objId+" 0 R",r.options.magFactor=r.options.magFactor||"XYZ",r.options.magFactor){case"Fit":i+=" /Fit]";break;case"FitH":i+=" /FitH "+r.options.top+"]";break;case"FitV":r.options.left=r.options.left||0,i+=" /FitV "+r.options.left+"]";break;case"XYZ":default:var N=o(r.options.top);r.options.left=r.options.left||0,void 0===r.options.zoom&&(r.options.zoom=0),i+=" /XYZ "+r.options.left+" "+N+" "+r.options.zoom+"]"}}""!=i&&(i+=" >>",this.internal.write(i))}}this.internal.write("]")}}]),t.createAnnotation=function(t){var e=this.internal.getCurrentPageInfo();switch(t.type){case"link":this.link(t.bounds.x,t.bounds.y,t.bounds.w,t.bounds.h,t);break;case"text":case"freetext":e.pageContext.annotations.push(t)}},t.link=function(t,e,r,n,i){var a=this.internal.getCurrentPageInfo(),o=this.internal.getCoordinateString,s=this.internal.getVerticalCoordinateString;a.pageContext.annotations.push({finalBounds:{x:o(t),y:s(e),w:o(t+r),h:s(e+n)},options:i,type:"link"})},t.textWithLink=function(t,e,r,n){var i=this.getTextWidth(t),a=this.internal.getLineHeight()/this.internal.scaleFactor;return this.text(t,e,r,n),r+=.2*a,"center"===n.align&&(e-=i/2),"right"===n.align&&(e-=i),this.link(e,r-a,i,a,n),i},t.getTextWidth=function(t){var e=this.internal.getFontSize();return this.getStringUnitWidth(t)*e/this.internal.scaleFactor}}(j.API),function(t){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},r={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},n={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},i=[1570,1571,1573,1575];t.__arabicParser__={};var a=t.__arabicParser__.isInArabicSubstitutionA=function(t){return void 0!==e[t.charCodeAt(0)]},o=t.__arabicParser__.isArabicLetter=function(t){return"string"==typeof t&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(t)},s=t.__arabicParser__.isArabicEndLetter=function(t){return o(t)&&a(t)&&e[t.charCodeAt(0)].length<=2},u=t.__arabicParser__.isArabicAlfLetter=function(t){return o(t)&&i.indexOf(t.charCodeAt(0))>=0};t.__arabicParser__.arabicLetterHasIsolatedForm=function(t){return o(t)&&a(t)&&e[t.charCodeAt(0)].length>=1};var c=t.__arabicParser__.arabicLetterHasFinalForm=function(t){return o(t)&&a(t)&&e[t.charCodeAt(0)].length>=2};t.__arabicParser__.arabicLetterHasInitialForm=function(t){return o(t)&&a(t)&&e[t.charCodeAt(0)].length>=3};var l=t.__arabicParser__.arabicLetterHasMedialForm=function(t){return o(t)&&a(t)&&4==e[t.charCodeAt(0)].length},h=t.__arabicParser__.resolveLigatures=function(t){var e=0,n=r,i="",a=0;for(e=0;e<t.length;e+=1)void 0!==n[t.charCodeAt(e)]?(a++,"number"==typeof(n=n[t.charCodeAt(e)])&&(i+=String.fromCharCode(n),n=r,a=0),e===t.length-1&&(n=r,i+=t.charAt(e-(a-1)),e-=a-1,a=0)):(n=r,i+=t.charAt(e-a),e-=a,a=0);return i};t.__arabicParser__.isArabicDiacritic=function(t){return void 0!==t&&void 0!==n[t.charCodeAt(0)]};var f=t.__arabicParser__.getCorrectForm=function(t,e,r){return o(t)?!1===a(t)?-1:!c(t)||!o(e)&&!o(r)||!o(r)&&s(e)||s(t)&&!o(e)||s(t)&&u(e)||s(t)&&s(e)?0:l(t)&&o(e)&&!s(e)&&o(r)&&c(r)?3:s(t)||!o(r)?1:2:-1},d=function(t){var r=0,n=0,i=0,a="",s="",u="",c=(t=t||"").split("\\s+"),l=[];for(r=0;r<c.length;r+=1){for(l.push(""),n=0;n<c[r].length;n+=1)a=c[r][n],s=c[r][n-1],u=c[r][n+1],o(a)?(i=f(a,s,u),l[r]+=-1!==i?String.fromCharCode(e[a.charCodeAt(0)][i]):a):l[r]+=a;l[r]=h(l[r])}return l.join(" ")},p=t.__arabicParser__.processArabic=t.processArabic=function(){var t,e="string"==typeof arguments[0]?arguments[0]:arguments[0].text,r=[];if(Array.isArray(e)){var n=0;for(r=[],n=0;n<e.length;n+=1)Array.isArray(e[n])?r.push([d(e[n][0]),e[n][1],e[n][2]]):r.push([d(e[n])]);t=r}else t=d(e);return"string"==typeof arguments[0]?t:(arguments[0].text=t,arguments[0])};t.events.push(["preProcessText",p])}(j.API),function(t){t.autoPrint=function(t){var e;switch((t=t||{}).variant=t.variant||"non-conform",t.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",(function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")})),this.internal.events.subscribe("putCatalog",(function(){this.internal.out("/OpenAction "+e+" 0 R")}))}return this}}(j.API),function(t){var e=function(){var t=void 0;Object.defineProperty(this,"pdf",{get:function(){return t},set:function(e){t=e}});var e=150;Object.defineProperty(this,"width",{get:function(){return e},set:function(t){e=isNaN(t)||!1===Number.isInteger(t)||t<0?150:t,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=e+1)}});var r=300;Object.defineProperty(this,"height",{get:function(){return r},set:function(t){r=isNaN(t)||!1===Number.isInteger(t)||t<0?300:t,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=r+1)}});var n=[];Object.defineProperty(this,"childNodes",{get:function(){return n},set:function(t){n=t}});var i={};Object.defineProperty(this,"style",{get:function(){return i},set:function(t){i=t}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(t,e){var r;if("2d"!==(t=t||"2d"))return null;for(r in e)this.pdf.context2d.hasOwnProperty(r)&&(this.pdf.context2d[r]=e[r]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},t.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])}(j.API),function(t){var e={left:0,top:0,bottom:0,right:0},r=!1,n=function(){void 0===this.internal.__cell__&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),i.call(this))},i=function(){this.internal.__cell__.lastCell=new a,this.internal.__cell__.pages=1},a=function(){var t=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return t},set:function(e){t=e}});var e=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return e},set:function(t){e=t}});var r=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return r},set:function(t){r=t}});var n=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return n},set:function(t){n=t}});var i=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return i},set:function(t){i=t}});var a=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return a},set:function(t){a=t}});var o=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return o},set:function(t){o=t}}),this};a.prototype.clone=function(){return new a(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},a.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},t.setHeaderFunction=function(t){return n.call(this),this.internal.__cell__.headerFunction="function"==typeof t?t:void 0,this},t.getTextDimensions=function(t,e){n.call(this);var r=(e=e||{}).fontSize||this.getFontSize(),i=e.font||this.getFont(),a=e.scaleFactor||this.internal.scaleFactor,o=0,s=0,u=0,c=this;if(!Array.isArray(t)&&"string"!=typeof t){if("number"!=typeof t)throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");t=String(t)}const l=e.maxWidth;l>0?"string"==typeof t?t=this.splitTextToSize(t,l):"[object Array]"===Object.prototype.toString.call(t)&&(t=t.reduce((function(t,e){return t.concat(c.splitTextToSize(e,l))}),[])):t=Array.isArray(t)?t:[t];for(var h=0;h<t.length;h++)o<(u=this.getStringUnitWidth(t[h],{font:i})*r)&&(o=u);return 0!==o&&(s=t.length),{w:o/=a,h:Math.max((s*r*this.getLineHeightFactor()-r*(this.getLineHeightFactor()-1))/a,0)}},t.cellAddPage=function(){n.call(this),this.addPage();var t=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new a(t.left,t.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var o=t.cell=function(){var t;t=arguments[0]instanceof a?arguments[0]:new a(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),n.call(this);var i=this.internal.__cell__.lastCell,o=this.internal.__cell__.padding,s=this.internal.__cell__.margins||e,u=this.internal.__cell__.tableHeaderRow,c=this.internal.__cell__.printHeaders;return void 0!==i.lineNumber&&(i.lineNumber===t.lineNumber?(t.x=(i.x||0)+(i.width||0),t.y=i.y||0):i.y+i.height+t.height+s.bottom>this.getPageHeight()?(this.cellAddPage(),t.y=s.top,c&&u&&(this.printHeaderRow(t.lineNumber,!0),t.y+=u[0].height)):t.y=i.y+i.height||t.y),void 0!==t.text[0]&&(this.rect(t.x,t.y,t.width,t.height,!0===r?"FD":void 0),"right"===t.align?this.text(t.text,t.x+t.width-o,t.y+o,{align:"right",baseline:"top"}):"center"===t.align?this.text(t.text,t.x+t.width/2,t.y+o,{align:"center",baseline:"top",maxWidth:t.width-o-o}):this.text(t.text,t.x+o,t.y+o,{align:"left",baseline:"top",maxWidth:t.width-o-o})),this.internal.__cell__.lastCell=t,this};t.table=function(t,r,u,c,l){if(n.call(this),!u)throw new Error("No data for PDF table.");var h,f,d,p,g=[],m=[],v=[],b={},y={},w=[],N=[],A=(l=l||{}).autoSize||!1,L=!1!==l.printHeaders,x=l.css&&void 0!==l.css["font-size"]?16*l.css["font-size"]:l.fontSize||12,S=l.margins||Object.assign({width:this.getPageWidth()},e),_="number"==typeof l.padding?l.padding:3,P=l.headerBackgroundColor||"#c8c8c8";if(i.call(this),this.internal.__cell__.printHeaders=L,this.internal.__cell__.margins=S,this.internal.__cell__.table_font_size=x,this.internal.__cell__.padding=_,this.internal.__cell__.headerBackgroundColor=P,this.setFontSize(x),null==c)m=g=Object.keys(u[0]),v=g.map((function(){return"left"}));else if(Array.isArray(c)&&"object"==typeof c[0])for(g=c.map((function(t){return t.name})),m=c.map((function(t){return t.prompt||t.name||""})),v=c.map((function(t){return t.align||"left"})),h=0;h<c.length;h+=1)y[c[h].name]=c[h].width*(19.049976/25.4);else Array.isArray(c)&&"string"==typeof c[0]&&(m=g=c,v=g.map((function(){return"left"})));if(A||Array.isArray(c)&&"string"==typeof c[0])for(h=0;h<g.length;h+=1){for(b[p=g[h]]=u.map((function(t){return t[p]})),this.setFont(void 0,"bold"),w.push(this.getTextDimensions(m[h],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),f=b[p],this.setFont(void 0,"normal"),d=0;d<f.length;d+=1)w.push(this.getTextDimensions(f[d],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);y[p]=Math.max.apply(null,w)+_+_,w=[]}if(L){var k={};for(h=0;h<g.length;h+=1)k[g[h]]={},k[g[h]].text=m[h],k[g[h]].align=v[h];var F=s.call(this,k,y);N=g.map((function(e){return new a(t,r,y[e],F,k[e].text,void 0,k[e].align)})),this.setTableHeaderRow(N),this.printHeaderRow(1,!1)}var I=c.reduce((function(t,e){return t[e.name]=e.align,t}),{});for(h=0;h<u.length;h+=1){var C=s.call(this,u[h],y);for(d=0;d<g.length;d+=1)o.call(this,new a(t,r,y[g[d]],C,u[h][g[d]],h+2,I[g[d]]))}return this.internal.__cell__.table_x=t,this.internal.__cell__.table_y=r,this};var s=function(t,e){var r=this.internal.__cell__.padding,n=this.internal.__cell__.table_font_size,i=this.internal.scaleFactor;return Object.keys(t).map((function(n){var i=t[n];return this.splitTextToSize(i.hasOwnProperty("text")?i.text:i,e[n]-r-r)}),this).map((function(t){return this.getLineHeightFactor()*t.length*n/i+r+r}),this).reduce((function(t,e){return Math.max(t,e)}),0)};t.setTableHeaderRow=function(t){n.call(this),this.internal.__cell__.tableHeaderRow=t},t.printHeaderRow=function(t,e){if(n.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var i;if(r=!0,"function"==typeof this.internal.__cell__.headerFunction){var s=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new a(s[0],s[1],s[2],s[3],void 0,-1)}this.setFont(void 0,"bold");for(var u=[],c=0;c<this.internal.__cell__.tableHeaderRow.length;c+=1)i=this.internal.__cell__.tableHeaderRow[c].clone(),e&&(i.y=this.internal.__cell__.margins.top||0,u.push(i)),i.lineNumber=t,this.setFillColor(this.internal.__cell__.headerBackgroundColor),o.call(this,i);u.length>0&&this.setTableHeaderRow(u),this.setFont(void 0,"normal"),r=!1}}(j.API);var Lt={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},xt=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],St=At(xt),_t=[100,200,300,400,500,600,700,800,900],Pt=At(_t);function kt(t){var e=t.family.replace(/"|'/g,"").toLowerCase(),r=function(t){return Lt[t=t||"normal"]?t:"normal"}(t.style),n=function(t){if(!t)return 400;if("number"==typeof t)return t>=100&&t<=900&&t%100==0?t:400;if(/^\d00$/.test(t))return parseInt(t);switch(t){case"bold":return 700;case"normal":default:return 400}}(t.weight),i=function(t){return"number"==typeof St[t=t||"normal"]?t:"normal"}(t.stretch);return{family:e,style:r,weight:n,stretch:i,src:t.src||[],ref:t.ref||{name:e,style:[i,r,n].join(" ")}}}function Ft(t,e,r,n){var i;for(i=r;i>=0&&i<e.length;i+=n)if(t[e[i]])return t[e[i]];for(i=r;i>=0&&i<e.length;i-=n)if(t[e[i]])return t[e[i]]}var It={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},Ct={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function jt(t){return[t.stretch,t.style,t.weight,t.family].join(" ")}function Ot(t,e,r){for(var n=(r=r||{}).defaultFontFamily||"times",i=Object.assign({},It,r.genericFontFamilies||{}),a=null,o=null,s=0;s<e.length;++s)if(i[(a=kt(e[s])).family]&&(a.family=i[a.family]),t.hasOwnProperty(a.family)){o=t[a.family];break}if(!(o=o||t[n]))throw new Error("Could not find a font-family for the rule '"+jt(a)+"' and default family '"+n+"'.");if(o=function(t,e){if(e[t])return e[t];var r=St[t],n=r<=St.normal?-1:1,i=Ft(e,xt,r,n);if(!i)throw new Error("Could not find a matching font-stretch value for "+t);return i}(a.stretch,o),o=function(t,e){if(e[t])return e[t];for(var r=Lt[t],n=0;n<r.length;++n)if(e[r[n]])return e[r[n]];throw new Error("Could not find a matching font-style for "+t)}(a.style,o),!(o=function(t,e){if(e[t])return e[t];if(400===t&&e[500])return e[500];if(500===t&&e[400])return e[400];var r=Pt[t],n=Ft(e,_t,r,t<400?-1:1);if(!n)throw new Error("Could not find a matching font-weight for value "+t);return n}(a.weight,o)))throw new Error("Failed to resolve a font for the rule '"+jt(a)+"'.");return o}function Bt(t){return t.trimLeft()}function Mt(t,e){for(var r=0;r<t.length;){if(t.charAt(r)===e)return[t.substring(0,r),t.substring(r+1)];r+=1}return null}function Et(t){var e=t.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return null===e?null:[e[0],t.substring(e[0].length)]}var qt=["times"];!function(t){var e,r,i,a,o,s,u,c,h,f=function(t){return t=t||{},this.isStrokeTransparent=t.isStrokeTransparent||!1,this.strokeOpacity=t.strokeOpacity||1,this.strokeStyle=t.strokeStyle||"#000000",this.fillStyle=t.fillStyle||"#000000",this.isFillTransparent=t.isFillTransparent||!1,this.fillOpacity=t.fillOpacity||1,this.font=t.font||"10px sans-serif",this.textBaseline=t.textBaseline||"alphabetic",this.textAlign=t.textAlign||"left",this.lineWidth=t.lineWidth||1,this.lineJoin=t.lineJoin||"miter",this.lineCap=t.lineCap||"butt",this.path=t.path||[],this.transform=void 0!==t.transform?t.transform.clone():new c,this.globalCompositeOperation=t.globalCompositeOperation||"normal",this.globalAlpha=t.globalAlpha||1,this.clip_path=t.clip_path||[],this.currentPoint=t.currentPoint||new s,this.miterLimit=t.miterLimit||10,this.lastPoint=t.lastPoint||new s,this.ignoreClearRect="boolean"!=typeof t.ignoreClearRect||t.ignoreClearRect,this};t.events.push(["initialized",function(){this.context2d=new d(this),e=this.internal.f2,r=this.internal.getCoordinateString,i=this.internal.getVerticalCoordinateString,a=this.internal.getHorizontalCoordinate,o=this.internal.getVerticalCoordinate,s=this.internal.Point,u=this.internal.Rectangle,c=this.internal.Matrix,h=new f}]);var d=function(t){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var e=t;Object.defineProperty(this,"pdf",{get:function(){return e}});var r=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return r},set:function(t){r=Boolean(t)}});var n=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return n},set:function(t){n=Boolean(t)}});var i=0;Object.defineProperty(this,"posX",{get:function(){return i},set:function(t){isNaN(t)||(i=t)}});var a=0;Object.defineProperty(this,"posY",{get:function(){return a},set:function(t){isNaN(t)||(a=t)}});var o=!1;Object.defineProperty(this,"autoPaging",{get:function(){return o},set:function(t){o=Boolean(t)}});var s=0;Object.defineProperty(this,"lastBreak",{get:function(){return s},set:function(t){s=t}});var u=[];Object.defineProperty(this,"pageBreaks",{get:function(){return u},set:function(t){u=t}}),Object.defineProperty(this,"ctx",{get:function(){return h},set:function(t){t instanceof f&&(h=t)}}),Object.defineProperty(this,"path",{get:function(){return h.path},set:function(t){h.path=t}});var c=[];Object.defineProperty(this,"ctxStack",{get:function(){return c},set:function(t){c=t}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(t){var e;e=p(t),this.ctx.fillStyle=e.style,this.ctx.isFillTransparent=0===e.a,this.ctx.fillOpacity=e.a,this.pdf.setFillColor(e.r,e.g,e.b,{a:e.a}),this.pdf.setTextColor(e.r,e.g,e.b,{a:e.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(t){var e=p(t);this.ctx.strokeStyle=e.style,this.ctx.isStrokeTransparent=0===e.a,this.ctx.strokeOpacity=e.a,0===e.a?this.pdf.setDrawColor(255,255,255):(e.a,this.pdf.setDrawColor(e.r,e.g,e.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(t){-1!==["butt","round","square"].indexOf(t)&&(this.ctx.lineCap=t,this.pdf.setLineCap(t))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(t){isNaN(t)||(this.ctx.lineWidth=t,this.pdf.setLineWidth(t))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(t){-1!==["bevel","round","miter"].indexOf(t)&&(this.ctx.lineJoin=t,this.pdf.setLineJoin(t))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(t){isNaN(t)||(this.ctx.miterLimit=t,this.pdf.setMiterLimit(t))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(t){this.ctx.textBaseline=t}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(t){-1!==["right","end","center","left","start"].indexOf(t)&&(this.ctx.textAlign=t)}});var l=null;function d(t,e){if(null===l){var r=function(t){var e=[];return Object.keys(t).forEach((function(r){t[r].forEach((function(t){var n=null;switch(t){case"bold":n={family:r,weight:"bold"};break;case"italic":n={family:r,style:"italic"};break;case"bolditalic":n={family:r,weight:"bold",style:"italic"};break;case"":case"normal":n={family:r}}null!==n&&(n.ref={name:r,style:t},e.push(n))}))})),e}(t.getFontList());l=function(t){for(var e={},r=0;r<t.length;++r){var n=kt(t[r]),i=n.family,a=n.stretch,o=n.style,s=n.weight;e[i]=e[i]||{},e[i][a]=e[i][a]||{},e[i][a][o]=e[i][a][o]||{},e[i][a][o][s]=n}return e}(r.concat(e))}return l}var g=null;Object.defineProperty(this,"fontFaces",{get:function(){return g},set:function(t){l=null,g=t}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(t){var e;if(this.ctx.font=t,null!==(e=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(t))){var r=e[1],n=(e[2],e[3]),i=e[4],a=(e[5],e[6]),o=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(i)[2];i="px"===o?Math.floor(parseFloat(i)*this.pdf.internal.scaleFactor):"em"===o?Math.floor(parseFloat(i)*this.pdf.getFontSize()):Math.floor(parseFloat(i)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(i);var s=function(t){var e,r,n=[],i=t.trim();if(""===i)return qt;if(i in Ct)return[Ct[i]];for(;""!==i;){switch(r=null,e=(i=Bt(i)).charAt(0)){case'"':case"'":r=Mt(i.substring(1),e);break;default:r=Et(i)}if(null===r)return qt;if(n.push(r[0]),""!==(i=Bt(r[1]))&&","!==i.charAt(0))return qt;i=i.replace(/^,/,"")}return n}(a);if(this.fontFaces){var u=Ot(d(this.pdf,this.fontFaces),s.map((function(t){return{family:t,stretch:"normal",weight:n,style:r}})));this.pdf.setFont(u.ref.name,u.ref.style)}else{var c="";("bold"===n||parseInt(n,10)>=700||"bold"===r)&&(c="bold"),"italic"===r&&(c+="italic"),0===c.length&&(c="normal");for(var l="",h={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},f=0;f<s.length;f++){if(void 0!==this.pdf.internal.getFont(s[f],c,{noFallback:!0,disableWarning:!0})){l=s[f];break}if("bolditalic"===c&&void 0!==this.pdf.internal.getFont(s[f],"bold",{noFallback:!0,disableWarning:!0}))l=s[f],c="bold";else if(void 0!==this.pdf.internal.getFont(s[f],"normal",{noFallback:!0,disableWarning:!0})){l=s[f],c="normal";break}}if(""===l)for(var p=0;p<s.length;p++)if(h[s[p]]){l=h[s[p]];break}l=""===l?"Times":l,this.pdf.setFont(l,c)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(t){this.ctx.globalCompositeOperation=t}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(t){this.ctx.globalAlpha=t}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(t){this.ctx.ignoreClearRect=Boolean(t)}})};d.prototype.fill=function(){N.call(this,"fill",!1)},d.prototype.stroke=function(){N.call(this,"stroke",!1)},d.prototype.beginPath=function(){this.path=[{type:"begin"}]},d.prototype.moveTo=function(t,e){if(isNaN(t)||isNaN(e))throw n.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var r=this.ctx.transform.applyToPoint(new s(t,e));this.path.push({type:"mt",x:r.x,y:r.y}),this.ctx.lastPoint=new s(t,e)},d.prototype.closePath=function(){var t=new s(0,0),e=0;for(e=this.path.length-1;-1!==e;e--)if("begin"===this.path[e].type&&"object"==typeof this.path[e+1]&&"number"==typeof this.path[e+1].x){t=new s(this.path[e+1].x,this.path[e+1].y),this.path.push({type:"lt",x:t.x,y:t.y});break}"object"==typeof this.path[e+2]&&"number"==typeof this.path[e+2].x&&this.path.push(JSON.parse(JSON.stringify(this.path[e+2]))),this.path.push({type:"close"}),this.ctx.lastPoint=new s(t.x,t.y)},d.prototype.lineTo=function(t,e){if(isNaN(t)||isNaN(e))throw n.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var r=this.ctx.transform.applyToPoint(new s(t,e));this.path.push({type:"lt",x:r.x,y:r.y}),this.ctx.lastPoint=new s(r.x,r.y)},d.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),N.call(this,null,!0)},d.prototype.quadraticCurveTo=function(t,e,r,i){if(isNaN(r)||isNaN(i)||isNaN(t)||isNaN(e))throw n.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var a=this.ctx.transform.applyToPoint(new s(r,i)),o=this.ctx.transform.applyToPoint(new s(t,e));this.path.push({type:"qct",x1:o.x,y1:o.y,x:a.x,y:a.y}),this.ctx.lastPoint=new s(a.x,a.y)},d.prototype.bezierCurveTo=function(t,e,r,i,a,o){if(isNaN(a)||isNaN(o)||isNaN(t)||isNaN(e)||isNaN(r)||isNaN(i))throw n.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var u=this.ctx.transform.applyToPoint(new s(a,o)),c=this.ctx.transform.applyToPoint(new s(t,e)),l=this.ctx.transform.applyToPoint(new s(r,i));this.path.push({type:"bct",x1:c.x,y1:c.y,x2:l.x,y2:l.y,x:u.x,y:u.y}),this.ctx.lastPoint=new s(u.x,u.y)},d.prototype.arc=function(t,e,r,i,a,o){if(isNaN(t)||isNaN(e)||isNaN(r)||isNaN(i)||isNaN(a))throw n.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(o=Boolean(o),!this.ctx.transform.isIdentity){var u=this.ctx.transform.applyToPoint(new s(t,e));t=u.x,e=u.y;var c=this.ctx.transform.applyToPoint(new s(0,r)),l=this.ctx.transform.applyToPoint(new s(0,0));r=Math.sqrt(Math.pow(c.x-l.x,2)+Math.pow(c.y-l.y,2))}Math.abs(a-i)>=2*Math.PI&&(i=0,a=2*Math.PI),this.path.push({type:"arc",x:t,y:e,radius:r,startAngle:i,endAngle:a,counterclockwise:o})},d.prototype.arcTo=function(t,e,r,n,i){throw new Error("arcTo not implemented.")},d.prototype.rect=function(t,e,r,i){if(isNaN(t)||isNaN(e)||isNaN(r)||isNaN(i))throw n.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(t,e),this.lineTo(t+r,e),this.lineTo(t+r,e+i),this.lineTo(t,e+i),this.lineTo(t,e),this.lineTo(t+r,e),this.lineTo(t,e)},d.prototype.fillRect=function(t,e,r,i){if(isNaN(t)||isNaN(e)||isNaN(r)||isNaN(i))throw n.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!g.call(this)){var a={};"butt"!==this.lineCap&&(a.lineCap=this.lineCap,this.lineCap="butt"),"miter"!==this.lineJoin&&(a.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(t,e,r,i),this.fill(),a.hasOwnProperty("lineCap")&&(this.lineCap=a.lineCap),a.hasOwnProperty("lineJoin")&&(this.lineJoin=a.lineJoin)}},d.prototype.strokeRect=function(t,e,r,i){if(isNaN(t)||isNaN(e)||isNaN(r)||isNaN(i))throw n.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");m.call(this)||(this.beginPath(),this.rect(t,e,r,i),this.stroke())},d.prototype.clearRect=function(t,e,r,i){if(isNaN(t)||isNaN(e)||isNaN(r)||isNaN(i))throw n.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(t,e,r,i))},d.prototype.save=function(t){t="boolean"!=typeof t||t;for(var e=this.pdf.internal.getCurrentPageInfo().pageNumber,r=0;r<this.pdf.internal.getNumberOfPages();r++)this.pdf.setPage(r+1),this.pdf.internal.out("q");if(this.pdf.setPage(e),t){this.ctx.fontSize=this.pdf.internal.getFontSize();var n=new f(this.ctx);this.ctxStack.push(this.ctx),this.ctx=n}},d.prototype.restore=function(t){t="boolean"!=typeof t||t;for(var e=this.pdf.internal.getCurrentPageInfo().pageNumber,r=0;r<this.pdf.internal.getNumberOfPages();r++)this.pdf.setPage(r+1),this.pdf.internal.out("Q");this.pdf.setPage(e),t&&0!==this.ctxStack.length&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin)},d.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var p=function(t){var e,r,n,i;if(!0===t.isCanvasGradient&&(t=t.getColor()),!t)return{r:0,g:0,b:0,a:0,style:t};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(t))e=0,r=0,n=0,i=0;else{var a=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(t);if(null!==a)e=parseInt(a[1]),r=parseInt(a[2]),n=parseInt(a[3]),i=1;else if(null!==(a=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(t)))e=parseInt(a[1]),r=parseInt(a[2]),n=parseInt(a[3]),i=parseFloat(a[4]);else{if(i=1,"string"==typeof t&&"#"!==t.charAt(0)){var o=new l(t);t=o.ok?o.toHex():"#000000"}4===t.length?(e=t.substring(1,2),e+=e,r=t.substring(2,3),r+=r,n=t.substring(3,4),n+=n):(e=t.substring(1,3),r=t.substring(3,5),n=t.substring(5,7)),e=parseInt(e,16),r=parseInt(r,16),n=parseInt(n,16)}}return{r:e,g:r,b:n,a:i,style:t}},g=function(){return this.ctx.isFillTransparent||0==this.globalAlpha},m=function(){return Boolean(this.ctx.isStrokeTransparent||0==this.globalAlpha)};d.prototype.fillText=function(t,e,r,i){if(isNaN(e)||isNaN(r)||"string"!=typeof t)throw n.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(i=isNaN(i)?void 0:i,!g.call(this)){r=L.call(this,r);var a=B(this.ctx.transform.rotation),o=this.ctx.transform.scaleX;k.call(this,{text:t,x:e,y:r,scale:o,angle:a,align:this.textAlign,maxWidth:i})}},d.prototype.strokeText=function(t,e,r,i){if(isNaN(e)||isNaN(r)||"string"!=typeof t)throw n.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!m.call(this)){i=isNaN(i)?void 0:i,r=L.call(this,r);var a=B(this.ctx.transform.rotation),o=this.ctx.transform.scaleX;k.call(this,{text:t,x:e,y:r,scale:o,renderingMode:"stroke",angle:a,align:this.textAlign,maxWidth:i})}},d.prototype.measureText=function(t){if("string"!=typeof t)throw n.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var e=this.pdf,r=this.pdf.internal.scaleFactor,i=e.internal.getFontSize(),a=e.getStringUnitWidth(t)*i/e.internal.scaleFactor,o=function(t){var e=(t=t||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return e}}),this};return new o({width:a*=Math.round(96*r/72*1e4)/1e4})},d.prototype.scale=function(t,e){if(isNaN(t)||isNaN(e))throw n.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var r=new c(t,0,0,e,0,0);this.ctx.transform=this.ctx.transform.multiply(r)},d.prototype.rotate=function(t){if(isNaN(t))throw n.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var e=new c(Math.cos(t),Math.sin(t),-Math.sin(t),Math.cos(t),0,0);this.ctx.transform=this.ctx.transform.multiply(e)},d.prototype.translate=function(t,e){if(isNaN(t)||isNaN(e))throw n.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var r=new c(1,0,0,1,t,e);this.ctx.transform=this.ctx.transform.multiply(r)},d.prototype.transform=function(t,e,r,i,a,o){if(isNaN(t)||isNaN(e)||isNaN(r)||isNaN(i)||isNaN(a)||isNaN(o))throw n.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var s=new c(t,e,r,i,a,o);this.ctx.transform=this.ctx.transform.multiply(s)},d.prototype.setTransform=function(t,e,r,n,i,a){t=isNaN(t)?1:t,e=isNaN(e)?0:e,r=isNaN(r)?0:r,n=isNaN(n)?1:n,i=isNaN(i)?0:i,a=isNaN(a)?0:a,this.ctx.transform=new c(t,e,r,n,i,a)},d.prototype.drawImage=function(t,e,r,n,i,a,o,s,l){var h=this.pdf.getImageProperties(t),f=1,d=1,p=1,g=1;void 0!==n&&void 0!==s&&(p=s/n,g=l/i,f=h.width/n*s/n,d=h.height/i*l/i),void 0===a&&(a=e,o=r,e=0,r=0),void 0!==n&&void 0===s&&(s=n,l=i),void 0===n&&void 0===s&&(s=h.width,l=h.height);for(var m,b=this.ctx.transform.decompose(),N=B(b.rotate.shx),L=new c,x=(L=(L=(L=L.multiply(b.translate)).multiply(b.skew)).multiply(b.scale)).applyToRectangle(new u(a-e*p,o-r*g,n*f,i*d)),S=v.call(this,x),_=[],P=0;P<S.length;P+=1)-1===_.indexOf(S[P])&&_.push(S[P]);if(w(_),this.autoPaging)for(var k=_[0],F=_[_.length-1],I=k;I<F+1;I++){if(this.pdf.setPage(I),0!==this.ctx.clip_path.length){var C=this.path;m=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=y(m,this.posX,-1*this.pdf.internal.pageSize.height*(I-1)+this.posY),A.call(this,"fill",!0),this.path=C}var j=JSON.parse(JSON.stringify(x));j=y([j],this.posX,-1*this.pdf.internal.pageSize.height*(I-1)+this.posY)[0],this.pdf.addImage(t,"JPEG",j.x,j.y,j.w,j.h,null,null,N)}else this.pdf.addImage(t,"JPEG",x.x,x.y,x.w,x.h,null,null,N)};var v=function(t,e,r){var n=[];switch(e=e||this.pdf.internal.pageSize.width,r=r||this.pdf.internal.pageSize.height,t.type){default:case"mt":case"lt":n.push(Math.floor((t.y+this.posY)/r)+1);break;case"arc":n.push(Math.floor((t.y+this.posY-t.radius)/r)+1),n.push(Math.floor((t.y+this.posY+t.radius)/r)+1);break;case"qct":var i=M(this.ctx.lastPoint.x,this.ctx.lastPoint.y,t.x1,t.y1,t.x,t.y);n.push(Math.floor(i.y/r)+1),n.push(Math.floor((i.y+i.h)/r)+1);break;case"bct":var a=E(this.ctx.lastPoint.x,this.ctx.lastPoint.y,t.x1,t.y1,t.x2,t.y2,t.x,t.y);n.push(Math.floor(a.y/r)+1),n.push(Math.floor((a.y+a.h)/r)+1);break;case"rect":n.push(Math.floor((t.y+this.posY)/r)+1),n.push(Math.floor((t.y+t.h+this.posY)/r)+1)}for(var o=0;o<n.length;o+=1)for(;this.pdf.internal.getNumberOfPages()<n[o];)b.call(this);return n},b=function(){var t=this.fillStyle,e=this.strokeStyle,r=this.font,n=this.lineCap,i=this.lineWidth,a=this.lineJoin;this.pdf.addPage(),this.fillStyle=t,this.strokeStyle=e,this.font=r,this.lineCap=n,this.lineWidth=i,this.lineJoin=a},y=function(t,e,r){for(var n=0;n<t.length;n++)switch(t[n].type){case"bct":t[n].x2+=e,t[n].y2+=r;case"qct":t[n].x1+=e,t[n].y1+=r;case"mt":case"lt":case"arc":default:t[n].x+=e,t[n].y+=r}return t},w=function(t){return t.sort((function(t,e){return t-e}))},N=function(t,e){for(var r,n,i=this.fillStyle,a=this.strokeStyle,o=this.lineCap,s=this.lineWidth,u=s*this.ctx.transform.scaleX,c=this.lineJoin,l=JSON.parse(JSON.stringify(this.path)),h=JSON.parse(JSON.stringify(this.path)),f=[],d=0;d<h.length;d++)if(void 0!==h[d].x)for(var p=v.call(this,h[d]),g=0;g<p.length;g+=1)-1===f.indexOf(p[g])&&f.push(p[g]);for(var m=0;m<f.length;m++)for(;this.pdf.internal.getNumberOfPages()<f[m];)b.call(this);if(w(f),this.autoPaging)for(var N=f[0],L=f[f.length-1],x=N;x<L+1;x++){if(this.pdf.setPage(x),this.fillStyle=i,this.strokeStyle=a,this.lineCap=o,this.lineWidth=u,this.lineJoin=c,0!==this.ctx.clip_path.length){var S=this.path;r=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=y(r,this.posX,-1*this.pdf.internal.pageSize.height*(x-1)+this.posY),A.call(this,t,!0),this.path=S}n=JSON.parse(JSON.stringify(l)),this.path=y(n,this.posX,-1*this.pdf.internal.pageSize.height*(x-1)+this.posY),!1!==e&&0!==x||A.call(this,t,e),this.lineWidth=s}else this.lineWidth=u,A.call(this,t,e),this.lineWidth=s;this.path=l},A=function(t,e){if(("stroke"!==t||e||!m.call(this))&&("stroke"===t||e||!g.call(this))){for(var r,n,i=[],a=this.path,o=0;o<a.length;o++){var s=a[o];switch(s.type){case"begin":i.push({begin:!0});break;case"close":i.push({close:!0});break;case"mt":i.push({start:s,deltas:[],abs:[]});break;case"lt":var u=i.length;if(!isNaN(a[o-1].x)&&(r=[s.x-a[o-1].x,s.y-a[o-1].y],u>0))for(;u>=0;u--)if(!0!==i[u-1].close&&!0!==i[u-1].begin){i[u-1].deltas.push(r),i[u-1].abs.push(s);break}break;case"bct":r=[s.x1-a[o-1].x,s.y1-a[o-1].y,s.x2-a[o-1].x,s.y2-a[o-1].y,s.x-a[o-1].x,s.y-a[o-1].y],i[i.length-1].deltas.push(r);break;case"qct":var c=a[o-1].x+2/3*(s.x1-a[o-1].x),l=a[o-1].y+2/3*(s.y1-a[o-1].y),h=s.x+2/3*(s.x1-s.x),f=s.y+2/3*(s.y1-s.y),d=s.x,p=s.y;r=[c-a[o-1].x,l-a[o-1].y,h-a[o-1].x,f-a[o-1].y,d-a[o-1].x,p-a[o-1].y],i[i.length-1].deltas.push(r);break;case"arc":i.push({deltas:[],abs:[],arc:!0}),Array.isArray(i[i.length-1].abs)&&i[i.length-1].abs.push(s)}}n=e?null:"stroke"===t?"stroke":"fill";for(var v=0;v<i.length;v++){if(i[v].arc){for(var b=i[v].abs,y=0;y<b.length;y++){var w=b[y];"arc"===w.type?x.call(this,w.x,w.y,w.radius,w.startAngle,w.endAngle,w.counterclockwise,void 0,e):F.call(this,w.x,w.y)}S.call(this,n),this.pdf.internal.out("h")}if(!i[v].arc&&!0!==i[v].close&&!0!==i[v].begin){var N=i[v].start.x,A=i[v].start.y;I.call(this,i[v].deltas,N,A)}}n&&S.call(this,n),e&&_.call(this)}},L=function(t){var e=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,r=e*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return t-r;case"top":return t+e-r;case"hanging":return t+e-2*r;case"middle":return t+e/2-r;case"ideographic":return t;case"alphabetic":default:return t}};d.prototype.createLinearGradient=function(){var t=function(){};return t.colorStops=[],t.addColorStop=function(t,e){this.colorStops.push([t,e])},t.getColor=function(){return 0===this.colorStops.length?"#000000":this.colorStops[0][1]},t.isCanvasGradient=!0,t},d.prototype.createPattern=function(){return this.createLinearGradient()},d.prototype.createRadialGradient=function(){return this.createLinearGradient()};var x=function(t,e,r,n,i,a,o,s){for(var u=j.call(this,r,n,i,a),c=0;c<u.length;c++){var l=u[c];0===c&&P.call(this,l.x1+t,l.y1+e),C.call(this,t,e,l.x2,l.y2,l.x3,l.y3,l.x4,l.y4)}s?_.call(this):S.call(this,o)},S=function(t){switch(t){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},_=function(){this.pdf.clip(),this.pdf.discardPath()},P=function(t,e){this.pdf.internal.out(r(t)+" "+i(e)+" m")},k=function(t){var e;switch(t.align){case"right":case"end":e="right";break;case"center":e="center";break;case"left":case"start":default:e="left"}var r=this.ctx.transform.applyToPoint(new s(t.x,t.y)),n=this.ctx.transform.decompose(),i=new c;i=(i=(i=i.multiply(n.translate)).multiply(n.skew)).multiply(n.scale);for(var a,o,l,h=this.pdf.getTextDimensions(t.text),f=this.ctx.transform.applyToRectangle(new u(t.x,t.y,h.w,h.h)),d=i.applyToRectangle(new u(t.x,t.y-h.h,h.w,h.h)),p=v.call(this,d),g=[],m=0;m<p.length;m+=1)-1===g.indexOf(p[m])&&g.push(p[m]);if(w(g),!0===this.autoPaging)for(var b=g[0],N=g[g.length-1],L=b;L<N+1;L++){if(this.pdf.setPage(L),0!==this.ctx.clip_path.length){var x=this.path;a=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=y(a,this.posX,-1*this.pdf.internal.pageSize.height*(L-1)+this.posY),A.call(this,"fill",!0),this.path=x}var S=JSON.parse(JSON.stringify(f));S=y([S],this.posX,-1*this.pdf.internal.pageSize.height*(L-1)+this.posY)[0],t.scale>=.01&&(o=this.pdf.internal.getFontSize(),this.pdf.setFontSize(o*t.scale),l=this.lineWidth,this.lineWidth=l*t.scale),this.pdf.text(t.text,S.x,S.y,{angle:t.angle,align:e,renderingMode:t.renderingMode,maxWidth:t.maxWidth}),t.scale>=.01&&(this.pdf.setFontSize(o),this.lineWidth=l)}else t.scale>=.01&&(o=this.pdf.internal.getFontSize(),this.pdf.setFontSize(o*t.scale),l=this.lineWidth,this.lineWidth=l*t.scale),this.pdf.text(t.text,r.x+this.posX,r.y+this.posY,{angle:t.angle,align:e,renderingMode:t.renderingMode,maxWidth:t.maxWidth}),t.scale>=.01&&(this.pdf.setFontSize(o),this.lineWidth=l)},F=function(t,e,n,a){n=n||0,a=a||0,this.pdf.internal.out(r(t+n)+" "+i(e+a)+" l")},I=function(t,e,r){return this.pdf.lines(t,e,r,null,null)},C=function(t,r,n,i,s,u,c,l){this.pdf.internal.out([e(a(n+t)),e(o(i+r)),e(a(s+t)),e(o(u+r)),e(a(c+t)),e(o(l+r)),"c"].join(" "))},j=function(t,e,r,n){for(var i=2*Math.PI,a=Math.PI/2;e>r;)e-=i;var o=Math.abs(r-e);o<i&&n&&(o=i-o);for(var s=[],u=n?-1:1,c=e;o>1e-5;){var l=c+u*Math.min(o,a);s.push(O.call(this,t,c,l)),o-=Math.abs(l-c),c=l}return s},O=function(t,e,r){var n=(r-e)/2,i=t*Math.cos(n),a=t*Math.sin(n),o=i,s=-a,u=o*o+s*s,c=u+o*i+s*a,l=4/3*(Math.sqrt(2*u*c)-c)/(o*a-s*i),h=o-l*s,f=s+l*o,d=h,p=-f,g=n+e,m=Math.cos(g),v=Math.sin(g);return{x1:t*Math.cos(e),y1:t*Math.sin(e),x2:h*m-f*v,y2:h*v+f*m,x3:d*m-p*v,y3:d*v+p*m,x4:t*Math.cos(r),y4:t*Math.sin(r)}},B=function(t){return 180*t/Math.PI},M=function(t,e,r,n,i,a){var o=t+.5*(r-t),s=e+.5*(n-e),c=i+.5*(r-i),l=a+.5*(n-a),h=Math.min(t,i,o,c),f=Math.max(t,i,o,c),d=Math.min(e,a,s,l),p=Math.max(e,a,s,l);return new u(h,d,f-h,p-d)},E=function(t,e,r,n,i,a,o,s){var c,l,h,f,d,p,g,m,v,b,y,w,N,A,L=r-t,x=n-e,S=i-r,_=a-n,P=o-i,k=s-a;for(l=0;l<41;l++)v=(g=(h=t+(c=l/40)*L)+c*((d=r+c*S)-h))+c*(d+c*(i+c*P-d)-g),b=(m=(f=e+c*x)+c*((p=n+c*_)-f))+c*(p+c*(a+c*k-p)-m),0==l?(y=v,w=b,N=v,A=b):(y=Math.min(y,v),w=Math.min(w,b),N=Math.max(N,v),A=Math.max(A,b));return new u(Math.round(y),Math.round(w),Math.round(N-y),Math.round(A-w))}}(j.API);try{require("worker_threads").Worker}catch(t){}var Rt=Uint8Array,Tt=Uint16Array,Dt=Uint32Array,Ut=new Rt([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),zt=new Rt([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ht=new Rt([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Wt=function(t,e){for(var r=new Tt(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];var i=new Dt(r[30]);for(n=1;n<30;++n)for(var a=r[n];a<r[n+1];++a)i[a]=a-r[n]<<5|n;return[r,i]},Vt=Wt(Ut,2),Gt=Vt[0],Yt=Vt[1];Gt[28]=258,Yt[258]=28;for(var Jt=Wt(zt,0),Xt=Jt[0],Kt=Jt[1],Zt=new Tt(32768),$t=0;$t<32768;++$t){var Qt=(43690&$t)>>>1|(21845&$t)<<1;Qt=(61680&(Qt=(52428&Qt)>>>2|(13107&Qt)<<2))>>>4|(3855&Qt)<<4,Zt[$t]=((65280&Qt)>>>8|(255&Qt)<<8)>>>1}var te=function(t,e,r){for(var n=t.length,i=0,a=new Tt(e);i<n;++i)++a[t[i]-1];var o,s=new Tt(e);for(i=0;i<e;++i)s[i]=s[i-1]+a[i-1]<<1;if(r){o=new Tt(1<<e);var u=15-e;for(i=0;i<n;++i)if(t[i])for(var c=i<<4|t[i],l=e-t[i],h=s[t[i]-1]++<<l,f=h|(1<<l)-1;h<=f;++h)o[Zt[h]>>>u]=c}else for(o=new Tt(n),i=0;i<n;++i)o[i]=Zt[s[t[i]-1]++]>>>15-t[i];return o},ee=new Rt(288);for($t=0;$t<144;++$t)ee[$t]=8;for($t=144;$t<256;++$t)ee[$t]=9;for($t=256;$t<280;++$t)ee[$t]=7;for($t=280;$t<288;++$t)ee[$t]=8;var re=new Rt(32);for($t=0;$t<32;++$t)re[$t]=5;var ne=te(ee,9,0),ie=te(ee,9,1),ae=te(re,5,0),oe=te(re,5,1),se=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},ue=function(t,e,r){var n=e/8>>0;return(t[n]|t[n+1]<<8)>>>(7&e)&r},ce=function(t,e){var r=e/8>>0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>>(7&e)},le=function(t){return(t/8>>0)+(7&t&&1)},he=function(t,e,r){(null==e||e<0)&&(e=0),(null==r||r>t.length)&&(r=t.length);var n=new(t instanceof Tt?Tt:t instanceof Dt?Dt:Rt)(r-e);return n.set(t.subarray(e,r)),n},fe=function(t,e,r){r<<=7&e;var n=e/8>>0;t[n]|=r,t[n+1]|=r>>>8},de=function(t,e,r){r<<=7&e;var n=e/8>>0;t[n]|=r,t[n+1]|=r>>>8,t[n+2]|=r>>>16},pe=function(t,e){for(var r=[],n=0;n<t.length;++n)t[n]&&r.push({s:n,f:t[n]});var i=r.length,a=r.slice();if(!i)return[new Rt(0),0];if(1==i){var o=new Rt(r[0].s+1);return o[r[0].s]=1,[o,1]}r.sort((function(t,e){return t.f-e.f})),r.push({s:-1,f:25001});var s=r[0],u=r[1],c=0,l=1,h=2;for(r[0]={s:-1,f:s.f+u.f,l:s,r:u};l!=i-1;)s=r[r[c].f<r[h].f?c++:h++],u=r[c!=l&&r[c].f<r[h].f?c++:h++],r[l++]={s:-1,f:s.f+u.f,l:s,r:u};var f=a[0].s;for(n=1;n<i;++n)a[n].s>f&&(f=a[n].s);var d=new Tt(f+1),p=ge(r[l-1],d,0);if(p>e){n=0;var g=0,m=p-e,v=1<<m;for(a.sort((function(t,e){return d[e.s]-d[t.s]||t.f-e.f}));n<i;++n){var b=a[n].s;if(!(d[b]>e))break;g+=v-(1<<p-d[b]),d[b]=e}for(g>>>=m;g>0;){var y=a[n].s;d[y]<e?g-=1<<e-d[y]++-1:++n}for(;n>=0&&g;--n){var w=a[n].s;d[w]==e&&(--d[w],++g)}p=e}return[new Rt(d),p]},ge=function(t,e,r){return-1==t.s?Math.max(ge(t.l,e,r+1),ge(t.r,e,r+1)):e[t.s]=r},me=function(t){for(var e=t.length;e&&!t[--e];);for(var r=new Tt(++e),n=0,i=t[0],a=1,o=function(t){r[n++]=t},s=1;s<=e;++s)if(t[s]==i&&s!=e)++a;else{if(!i&&a>2){for(;a>138;a-=138)o(32754);a>2&&(o(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(o(i),--a;a>6;a-=6)o(8304);a>2&&(o(a-3<<5|8208),a=0)}for(;a--;)o(i);a=1,i=t[s]}return[r.subarray(0,n),e]},ve=function(t,e){for(var r=0,n=0;n<e.length;++n)r+=t[n]*e[n];return r},be=function(t,e,r){var n=r.length,i=le(e+2);t[i]=255&n,t[i+1]=n>>>8,t[i+2]=255^t[i],t[i+3]=255^t[i+1];for(var a=0;a<n;++a)t[i+a+4]=r[a];return 8*(i+4+n)},ye=function(t,e,r,n,i,a,o,s,u,c,l){fe(e,l++,r),++i[256];for(var h=pe(i,15),f=h[0],d=h[1],p=pe(a,15),g=p[0],m=p[1],v=me(f),b=v[0],y=v[1],w=me(g),N=w[0],A=w[1],L=new Tt(19),x=0;x<b.length;++x)L[31&b[x]]++;for(x=0;x<N.length;++x)L[31&N[x]]++;for(var S=pe(L,7),_=S[0],P=S[1],k=19;k>4&&!_[Ht[k-1]];--k);var F,I,C,j,O=c+5<<3,B=ve(i,ee)+ve(a,re)+o,M=ve(i,f)+ve(a,g)+o+14+3*k+ve(L,_)+(2*L[16]+3*L[17]+7*L[18]);if(O<=B&&O<=M)return be(e,l,t.subarray(u,u+c));if(fe(e,l,1+(M<B)),l+=2,M<B){F=te(f,d,0),I=f,C=te(g,m,0),j=g;var E=te(_,P,0);fe(e,l,y-257),fe(e,l+5,A-1),fe(e,l+10,k-4),l+=14;for(x=0;x<k;++x)fe(e,l+3*x,_[Ht[x]]);l+=3*k;for(var q=[b,N],R=0;R<2;++R){var T=q[R];for(x=0;x<T.length;++x){var D=31&T[x];fe(e,l,E[D]),l+=_[D],D>15&&(fe(e,l,T[x]>>>5&127),l+=T[x]>>>12)}}}else F=ne,I=ee,C=ae,j=re;for(x=0;x<s;++x)if(n[x]>255){D=n[x]>>>18&31;de(e,l,F[D+257]),l+=I[D+257],D>7&&(fe(e,l,n[x]>>>23&31),l+=Ut[D]);var U=31&n[x];de(e,l,C[U]),l+=j[U],U>3&&(de(e,l,n[x]>>>5&8191),l+=zt[U])}else de(e,l,F[n[x]]),l+=I[n[x]];return de(e,l,F[256]),l+I[256]},we=new Dt([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Ne=new Rt(0),Ae=function(t,e,r,n,i){return function(t,e,r,n,i,a){var o=t.length,s=new Rt(n+o+5*(1+Math.floor(o/7e3))+i),u=s.subarray(n,s.length-i),c=0;if(!e||o<8)for(var l=0;l<=o;l+=65535){var h=l+65535;h<o?c=be(u,c,t.subarray(l,h)):(u[l]=a,c=be(u,c,t.subarray(l,o)))}else{for(var f=we[e-1],d=f>>>13,p=8191&f,g=(1<<r)-1,m=new Tt(32768),v=new Tt(g+1),b=Math.ceil(r/3),y=2*b,w=function(e){return(t[e]^t[e+1]<<b^t[e+2]<<y)&g},N=new Dt(25e3),A=new Tt(288),L=new Tt(32),x=0,S=0,_=(l=0,0),P=0,k=0;l<o;++l){var F=w(l),I=32767&l,C=v[F];if(m[I]=C,v[F]=I,P<=l){var j=o-l;if((x>7e3||_>24576)&&j>423){c=ye(t,u,0,N,A,L,S,_,k,l-k,c),_=x=S=0,k=l;for(var O=0;O<286;++O)A[O]=0;for(O=0;O<30;++O)L[O]=0}var B=2,M=0,E=p,q=I-C&32767;if(j>2&&F==w(l-q))for(var R=Math.min(d,j)-1,T=Math.min(32767,l),D=Math.min(258,j);q<=T&&--E&&I!=C;){if(t[l+B]==t[l+B-q]){for(var U=0;U<D&&t[l+U]==t[l+U-q];++U);if(U>B){if(B=U,M=q,U>R)break;var z=Math.min(q,U-2),H=0;for(O=0;O<z;++O){var W=l-q+O+32768&32767,V=W-m[W]+32768&32767;V>H&&(H=V,C=W)}}}q+=(I=C)-(C=m[I])+32768&32767}if(M){N[_++]=268435456|Yt[B]<<18|Kt[M];var G=31&Yt[B],Y=31&Kt[M];S+=Ut[G]+zt[Y],++A[257+G],++L[Y],P=l+B,++x}else N[_++]=t[l],++A[t[l]]}}c=ye(t,u,a,N,A,L,S,_,k,l-k,c),a||(c=be(u,c,Ne))}return he(s,0,n+le(c)+i)}(t,null==e.level?6:e.level,null==e.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):12+e.mem,r,n,!i)};function Le(t,e){void 0===e&&(e={});var r=function(){var t=1,e=0;return{p:function(r){for(var n=t,i=e,a=r.length,o=0;o!=a;){for(var s=Math.min(o+5552,a);o<s;++o)i+=n+=r[o];n%=65521,i%=65521}t=n,e=i},d:function(){return(t>>>8<<16|(255&e)<<8|e>>>8)+2*((255&t)<<23)}}}();r.p(t);var n=Ae(t,e,2,4);return function(t,e){var r=e.level,n=0==r?0:r<6?1:9==r?3:2;t[0]=120,t[1]=n<<6|(n?32-2*n:1)}(n,e),function(t,e,r){for(;r;++e)t[e]=r,r>>>=8}(n,n.length-4,r.d()),n}function xe(t,e){return function(t,e,r){var n=t.length,i=!e||r,a=!r||r.i;r||(r={}),e||(e=new Rt(3*n));var o=function(t){var r=e.length;if(t>r){var n=new Rt(Math.max(2*r,t));n.set(e),e=n}},s=r.f||0,u=r.p||0,c=r.b||0,l=r.l,h=r.d,f=r.m,d=r.n,p=8*n;do{if(!l){r.f=s=ue(t,u,1);var g=ue(t,u+1,3);if(u+=3,!g){var m=t[(P=le(u)+4)-4]|t[P-3]<<8,v=P+m;if(v>n){if(a)throw"unexpected EOF";break}i&&o(c+m),e.set(t.subarray(P,v),c),r.b=c+=m,r.p=u=8*v;continue}if(1==g)l=ie,h=oe,f=9,d=5;else{if(2!=g)throw"invalid block type";var b=ue(t,u,31)+257,y=ue(t,u+10,15)+4,w=b+ue(t,u+5,31)+1;u+=14;for(var N=new Rt(w),A=new Rt(19),L=0;L<y;++L)A[Ht[L]]=ue(t,u+3*L,7);u+=3*y;var x=se(A),S=(1<<x)-1;if(!a&&u+w*(x+7)>p)break;var _=te(A,x,1);for(L=0;L<w;){var P,k=_[ue(t,u,S)];if(u+=15&k,(P=k>>>4)<16)N[L++]=P;else{var F=0,I=0;for(16==P?(I=3+ue(t,u,3),u+=2,F=N[L-1]):17==P?(I=3+ue(t,u,7),u+=3):18==P&&(I=11+ue(t,u,127),u+=7);I--;)N[L++]=F}}var C=N.subarray(0,b),j=N.subarray(b);f=se(C),d=se(j),l=te(C,f,1),h=te(j,d,1)}if(u>p)throw"unexpected EOF"}i&&o(c+131072);for(var O=(1<<f)-1,B=(1<<d)-1,M=f+d+18;a||u+M<p;){var E=(F=l[ce(t,u)&O])>>>4;if((u+=15&F)>p)throw"unexpected EOF";if(!F)throw"invalid length/literal";if(E<256)e[c++]=E;else{if(256==E){l=null;break}var q=E-254;if(E>264){var R=Ut[L=E-257];q=ue(t,u,(1<<R)-1)+Gt[L],u+=R}var T=h[ce(t,u)&B],D=T>>>4;if(!T)throw"invalid distance";u+=15&T;j=Xt[D];if(D>3){R=zt[D];j+=ce(t,u)&(1<<R)-1,u+=R}if(u>p)throw"unexpected EOF";i&&o(c+131072);for(var U=c+q;c<U;c+=4)e[c]=e[c-j],e[c+1]=e[c+1-j],e[c+2]=e[c+2-j],e[c+3]=e[c+3-j];c=U}}r.l=l,r.p=u,r.b=c,l&&(s=1,r.m=f,r.d=h,r.n=d)}while(!s);return c==e.length?e:he(e,0,c)}((function(t){if(8!=(15&t[0])||t[0]>>>4>7||(t[0]<<8|t[1])%31)throw"invalid zlib data";if(32&t[1])throw"invalid zlib data: preset dictionaries not supported"}(t),t.subarray(2,-4)),e)}
!function(t){var e=function(t){var e,r,n,i,a,o,s,u,c,l;for(/[^\x00-\xFF]/.test(t),r=[],n=0,i=(t+=e="\0\0\0\0".slice(t.length%4||4)).length;i>n;n+=4)0!==(a=(t.charCodeAt(n)<<24)+(t.charCodeAt(n+1)<<16)+(t.charCodeAt(n+2)<<8)+t.charCodeAt(n+3))?(o=(a=((a=((a=((a=(a-(l=a%85))/85)-(c=a%85))/85)-(u=a%85))/85)-(s=a%85))/85)%85,r.push(o+33,s+33,u+33,c+33,l+33)):r.push(122);return function(t,e){for(var r=e;r>0;r--)t.pop()}(r,e.length),String.fromCharCode.apply(String,r)+"~>"},r=function(t){var e,r,n,i,a,o=String,s="length",u=255,c="charCodeAt",l="slice",h="replace";for(t[l](-2),t=t[l](0,-2)[h](/\s/g,"")[h]("z","!!!!!"),n=[],i=0,a=(t+=e="uuuuu"[l](t[s]%5||5))[s];a>i;i+=5)r=52200625*(t[c](i)-33)+614125*(t[c](i+1)-33)+7225*(t[c](i+2)-33)+85*(t[c](i+3)-33)+(t[c](i+4)-33),n.push(u&r>>24,u&r>>16,u&r>>8,u&r);return function(t,e){for(var r=e;r>0;r--)t.pop()}(n,e[s]),o.fromCharCode.apply(o,n)},n=function(t){var e=new RegExp(/^([0-9A-Fa-f]{2})+$/);if(-1!==(t=t.replace(/\s/g,"")).indexOf(">")&&(t=t.substr(0,t.indexOf(">"))),t.length%2&&(t+="0"),!1===e.test(t))return"";for(var r="",n=0;n<t.length;n+=2)r+=String.fromCharCode("0x"+(t[n]+t[n+1]));return r},i=function(t){for(var e=new Uint8Array(t.length),r=t.length;r--;)e[r]=t.charCodeAt(r);return t=(e=Le(e)).reduce((function(t,e){return t+String.fromCharCode(e)}),"")};t.processDataByFilters=function(t,a){var o=0,s=t||"",u=[];for("string"==typeof(a=a||[])&&(a=[a]),o=0;o<a.length;o+=1)switch(a[o]){case"ASCII85Decode":case"/ASCII85Decode":s=r(s),u.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":s=e(s),u.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":s=n(s),u.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":s=s.split("").map((function(t){return("0"+t.charCodeAt().toString(16)).slice(-2)})).join("")+">",u.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":s=i(s),u.push("/FlateDecode");break;default:throw new Error('The filter: "'+a[o]+'" is not implemented')}return{data:s,reverseChain:u.reverse().join(" ")}}}(j.API),function(t){t.loadFile=function(t,e,r){return function(t,e,r){e=!1!==e,r="function"==typeof r?r:function(){};var n=void 0;try{n=function(t,e,r){var n=new XMLHttpRequest,i=0,a=function(t){var e=t.length,r=[],n=String.fromCharCode;for(i=0;i<e;i+=1)r.push(n(255&t.charCodeAt(i)));return r.join("")};if(n.open("GET",t,!e),n.overrideMimeType("text/plain; charset=x-user-defined"),!1===e&&(n.onload=function(){200===n.status?r(a(this.responseText)):r(void 0)}),n.send(null),e&&200===n.status)return a(n.responseText)}(t,e,r)}catch(t){}return n}(t,e,r)},t.loadImageFile=t.loadFile}(j.API),function(r){function n(){return(e.html2canvas?Promise.resolve(e.html2canvas):"object"==typeof t&&"undefined"!=typeof module?new Promise((function(t,e){try{t(require("html2canvas"))}catch(t){e(t)}})):"function"==typeof define&&define.amd?new Promise((function(t,e){try{require(["html2canvas"],t)}catch(t){e(t)}})):Promise.reject(new Error("Could not load html2canvas"))).catch((function(t){return Promise.reject(new Error("Could not load html2canvas: "+t))})).then((function(t){return t.default?t.default:t}))}function i(){return(e.DOMPurify?Promise.resolve(e.DOMPurify):"object"==typeof t&&"undefined"!=typeof module?new Promise((function(t,e){try{t(require("dompurify"))}catch(t){e(t)}})):"function"==typeof define&&define.amd?new Promise((function(t,e){try{require(["dompurify"],t)}catch(t){e(t)}})):Promise.reject(new Error("Could not load dompurify"))).catch((function(t){return Promise.reject(new Error("Could not load dompurify: "+t))})).then((function(t){return t.default?t.default:t}))}var a=function(t){var e=typeof t;return"undefined"===e?"undefined":"string"===e||t instanceof String?"string":"number"===e||t instanceof Number?"number":"function"===e||t instanceof Function?"function":t&&t.constructor===Array?"array":t&&1===t.nodeType?"element":"object"===e?"object":"unknown"},o=function(t,e){var r=document.createElement(t);for(var n in e.className&&(r.className=e.className),e.innerHTML&&e.dompurify&&(r.innerHTML=e.dompurify.sanitize(e.innerHTML)),e.style)r.style[n]=e.style[n];return r},s=function(t,e){for(var r=3===t.nodeType?document.createTextNode(t.nodeValue):t.cloneNode(!1),n=t.firstChild;n;n=n.nextSibling)!0!==e&&1===n.nodeType&&"SCRIPT"===n.nodeName||r.appendChild(s(n,e));return 1===t.nodeType&&("CANVAS"===t.nodeName?(r.width=t.width,r.height=t.height,r.getContext("2d").drawImage(t,0,0)):"TEXTAREA"!==t.nodeName&&"SELECT"!==t.nodeName||(r.value=t.value),r.addEventListener("load",(function(){r.scrollTop=t.scrollTop,r.scrollLeft=t.scrollLeft}),!0)),r},u=function t(e){var r=Object.assign(t.convert(Promise.resolve()),JSON.parse(JSON.stringify(t.template))),n=t.convert(Promise.resolve(),r);return n=(n=n.setProgress(1,t,1,[t])).set(e)};(u.prototype=Object.create(Promise.prototype)).constructor=u,u.convert=function(t,e){return t.__proto__=e||u.prototype,t},u.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},u.prototype.from=function(t,e){return this.then((function(){switch(e=e||function(t){switch(a(t)){case"string":return"string";case"element":return"canvas"===t.nodeName.toLowerCase()?"canvas":"element";default:return"unknown"}}(t)){case"string":return this.then(i).then((function(e){return this.set({src:o("div",{innerHTML:t,dompurify:e})})}));case"element":return this.set({src:t});case"canvas":return this.set({canvas:t});case"img":return this.set({img:t});default:return this.error("Unknown source type.")}}))},u.prototype.to=function(t){switch(t){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},u.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then((function(){var t={position:"relative",display:"inline-block",width:Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},e=s(this.prop.src,this.opt.html2canvas.javascriptEnabled);"BODY"===e.tagName&&(t.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=o("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=o("div",{className:"html2pdf__container",style:t}),this.prop.container.appendChild(e),this.prop.container.firstChild.appendChild(o("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"}))},u.prototype.toCanvas=function(){var t=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(t).then(n).then((function(t){var e=Object.assign({},this.opt.html2canvas);return delete e.onrendered,t(this.prop.container,e)})).then((function(t){(this.opt.html2canvas.onrendered||function(){})(t),this.prop.canvas=t,document.body.removeChild(this.prop.overlay)}))},u.prototype.toContext2d=function(){var t=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(t).then(n).then((function(t){var e=this.opt.jsPDF,r=this.opt.fontFaces,n=Object.assign({async:!0,allowTaint:!0,scale:1,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete n.onrendered,e.context2d.autoPaging=!0,e.context2d.posX=this.opt.x,e.context2d.posY=this.opt.y,e.context2d.fontFaces=r,r)for(var i=0;i<r.length;++i){var a=r[i],o=a.src.find((function(t){return"truetype"===t.format}));o&&e.addFont(o.url,a.ref.name,a.ref.style)}return n.windowHeight=n.windowHeight||0,n.windowHeight=0==n.windowHeight?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):n.windowHeight,t(this.prop.container,n)})).then((function(t){(this.opt.html2canvas.onrendered||function(){})(t),this.prop.canvas=t,document.body.removeChild(this.prop.overlay)}))},u.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then((function(){var t=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=t}))},u.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then((function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF}))},u.prototype.output=function(t,e,r){return"img"===(r=r||"pdf").toLowerCase()||"image"===r.toLowerCase()?this.outputImg(t,e):this.outputPdf(t,e)},u.prototype.outputPdf=function(t,e){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then((function(){return this.prop.pdf.output(t,e)}))},u.prototype.outputImg=function(t){return this.thenList([function(){return this.prop.img||this.toImg()}]).then((function(){switch(t){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+t+'" is not supported.'}}))},u.prototype.save=function(t){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(t?{filename:t}:null).then((function(){this.prop.pdf.save(this.opt.filename)}))},u.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then((function(){this.prop.callback(this.prop.pdf)}))},u.prototype.set=function(t){if("object"!==a(t))return this;var e=Object.keys(t||{}).map((function(e){if(e in u.template.prop)return function(){this.prop[e]=t[e]};switch(e){case"margin":return this.setMargin.bind(this,t.margin);case"jsPDF":return function(){return this.opt.jsPDF=t.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,t.pageSize);default:return function(){this.opt[e]=t[e]}}}),this);return this.then((function(){return this.thenList(e)}))},u.prototype.get=function(t,e){return this.then((function(){var r=t in u.template.prop?this.prop[t]:this.opt[t];return e?e(r):r}))},u.prototype.setMargin=function(t){return this.then((function(){switch(a(t)){case"number":t=[t,t,t,t];case"array":if(2===t.length&&(t=[t[0],t[1],t[0],t[1]]),4===t.length)break;default:return this.error("Invalid margin array.")}this.opt.margin=t})).then(this.setPageSize)},u.prototype.setPageSize=function(t){function e(t,e){return Math.floor(t*e/72*96)}return this.then((function(){(t=t||j.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(t.inner={width:t.width-this.opt.margin[1]-this.opt.margin[3],height:t.height-this.opt.margin[0]-this.opt.margin[2]},t.inner.px={width:e(t.inner.width,t.k),height:e(t.inner.height,t.k)},t.inner.ratio=t.inner.height/t.inner.width),this.prop.pageSize=t}))},u.prototype.setProgress=function(t,e,r,n){return null!=t&&(this.progress.val=t),null!=e&&(this.progress.state=e),null!=r&&(this.progress.n=r),null!=n&&(this.progress.stack=n),this.progress.ratio=this.progress.val/this.progress.state,this},u.prototype.updateProgress=function(t,e,r,n){return this.setProgress(t?this.progress.val+t:null,e||null,r?this.progress.n+r:null,n?this.progress.stack.concat(n):null)},u.prototype.then=function(t,e){var r=this;return this.thenCore(t,e,(function(t,e){return r.updateProgress(null,null,1,[t]),Promise.prototype.then.call(this,(function(e){return r.updateProgress(null,t),e})).then(t,e).then((function(t){return r.updateProgress(1),t}))}))},u.prototype.thenCore=function(t,e,r){r=r||Promise.prototype.then;t&&(t=t.bind(this)),e&&(e=e.bind(this));var n=-1!==Promise.toString().indexOf("[native code]")&&"Promise"===Promise.name?this:u.convert(Object.assign({},this),Promise.prototype),i=r.call(n,t,e);return u.convert(i,this.__proto__)},u.prototype.thenExternal=function(t,e){return Promise.prototype.then.call(this,t,e)},u.prototype.thenList=function(t){var e=this;return t.forEach((function(t){e=e.thenCore(t)})),e},u.prototype.catch=function(t){t&&(t=t.bind(this));var e=Promise.prototype.catch.call(this,t);return u.convert(e,this)},u.prototype.catchExternal=function(t){return Promise.prototype.catch.call(this,t)},u.prototype.error=function(t){return this.then((function(){throw new Error(t)}))},u.prototype.using=u.prototype.set,u.prototype.saveAs=u.prototype.save,u.prototype.export=u.prototype.output,u.prototype.run=u.prototype.then,j.getPageSize=function(t,e,r){if("object"==typeof t){var n=t;t=n.orientation,e=n.unit||e,r=n.format||r}e=e||"mm",r=r||"a4",t=(""+(t||"P")).toLowerCase();var i,a=(""+r).toLowerCase(),o={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(e){case"pt":i=1;break;case"mm":i=72/25.4;break;case"cm":i=72/2.54;break;case"in":i=72;break;case"px":i=.75;break;case"pc":case"em":i=12;break;case"ex":i=6;break;default:throw"Invalid unit: "+e}var s,u=0,c=0;if(o.hasOwnProperty(a))u=o[a][1]/i,c=o[a][0]/i;else try{u=r[1],c=r[0]}catch(t){throw new Error("Invalid format: "+r)}if("p"===t||"portrait"===t)t="p",c>u&&(s=c,c=u,u=s);else{if("l"!==t&&"landscape"!==t)throw"Invalid orientation: "+t;t="l",u>c&&(s=c,c=u,u=s)}return{width:c,height:u,unit:e,k:i,orientation:t}},r.html=function(t,e){(e=e||{}).callback=e.callback||function(){},e.html2canvas=e.html2canvas||{},e.html2canvas.canvas=e.html2canvas.canvas||this.canvas,e.jsPDF=e.jsPDF||this,e.fontFaces=e.fontFaces?e.fontFaces.map(kt):null;var r=new u(e);return e.worker?r:r.from(t).doCallback()}}(j.API),function(t){var e,r,n;t.addJS=function(t){return n=t,this.internal.events.subscribe("postPutResources",(function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(e+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),r=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+n+")"),this.internal.out(">>"),this.internal.out("endobj")})),this.internal.events.subscribe("putCatalog",(function(){void 0!==e&&void 0!==r&&this.internal.out("/Names <</JavaScript "+e+" 0 R>>")})),this}}(j.API),function(t){var e;t.events.push(["postPutResources",function(){var t=this,r=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var n=t.outline.render().split(/\r\n/),i=0;i<n.length;i++){var a=n[i],o=r.exec(a);if(null!=o){var s=o[1];t.internal.newObjectDeferredBegin(s,!1)}t.internal.write(a)}if(this.outline.createNamedDestinations){var u=this.internal.pages.length,c=[];for(i=0;i<u;i++){var l=t.internal.newObject();c.push(l);var h=t.internal.getPageInfo(i+1);t.internal.write("<< /D["+h.objId+" 0 R /XYZ null null null]>> endobj")}var f=t.internal.newObject();t.internal.write("<< /Names [ ");for(i=0;i<c.length;i++)t.internal.write("(page_"+(i+1)+")"+c[i]+" 0 R");t.internal.write(" ] >>","endobj"),e=t.internal.newObject(),t.internal.write("<< /Dests "+f+" 0 R"),t.internal.write(">>","endobj")}}]),t.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+e+" 0 R"))}]),t.events.push(["initialized",function(){var t=this;t.outline={createNamedDestinations:!1,root:{children:[]}},t.outline.add=function(t,e,r){var n={title:e,options:r,children:[]};return null==t&&(t=this.root),t.children.push(n),n},t.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=t,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},t.outline.genIds_r=function(e){e.id=t.internal.newObjectDeferred();for(var r=0;r<e.children.length;r++)this.genIds_r(e.children[r])},t.outline.renderRoot=function(t){this.objStart(t),this.line("/Type /Outlines"),t.children.length>0&&(this.line("/First "+this.makeRef(t.children[0])),this.line("/Last "+this.makeRef(t.children[t.children.length-1]))),this.line("/Count "+this.count_r({count:0},t)),this.objEnd()},t.outline.renderItems=function(e){for(var r=this.ctx.pdf.internal.getVerticalCoordinateString,n=0;n<e.children.length;n++){var i=e.children[n];this.objStart(i),this.line("/Title "+this.makeString(i.title)),this.line("/Parent "+this.makeRef(e)),n>0&&this.line("/Prev "+this.makeRef(e.children[n-1])),n<e.children.length-1&&this.line("/Next "+this.makeRef(e.children[n+1])),i.children.length>0&&(this.line("/First "+this.makeRef(i.children[0])),this.line("/Last "+this.makeRef(i.children[i.children.length-1])));var a=this.count=this.count_r({count:0},i);if(a>0&&this.line("/Count "+a),i.options&&i.options.pageNumber){var o=t.internal.getPageInfo(i.options.pageNumber);this.line("/Dest ["+o.objId+" 0 R /XYZ 0 "+r(0)+" 0]")}this.objEnd()}for(var s=0;s<e.children.length;s++)this.renderItems(e.children[s])},t.outline.line=function(t){this.ctx.val+=t+"\r\n"},t.outline.makeRef=function(t){return t.id+" 0 R"},t.outline.makeString=function(e){return"("+t.internal.pdfEscape(e)+")"},t.outline.objStart=function(t){this.ctx.val+="\r\n"+t.id+" 0 obj\r\n<<\r\n"},t.outline.objEnd=function(){this.ctx.val+=">> \r\nendobj\r\n"},t.outline.count_r=function(t,e){for(var r=0;r<e.children.length;r++)t.count++,this.count_r(t,e.children[r]);return t.count}}])}(j.API),function(t){var e=[192,193,194,195,196,197,198,199];t.processJPEG=function(t,r,n,i,a,o){var s,u=this.decode.DCT_DECODE,c=null;if("string"==typeof t||this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t)){switch(t=a||t,t=this.__addimage__.isArrayBuffer(t)?new Uint8Array(t):t,(s=function(t){for(var r,n=256*t.charCodeAt(4)+t.charCodeAt(5),i=t.length,a={width:0,height:0,numcomponents:1},o=4;o<i;o+=2){if(o+=n,-1!==e.indexOf(t.charCodeAt(o+1))){r=256*t.charCodeAt(o+5)+t.charCodeAt(o+6),a={width:256*t.charCodeAt(o+7)+t.charCodeAt(o+8),height:r,numcomponents:t.charCodeAt(o+9)};break}n=256*t.charCodeAt(o+2)+t.charCodeAt(o+3)}return a}(t=this.__addimage__.isArrayBufferView(t)?this.__addimage__.arrayBufferToBinaryString(t):t)).numcomponents){case 1:o=this.color_spaces.DEVICE_GRAY;break;case 4:o=this.color_spaces.DEVICE_CMYK;break;case 3:o=this.color_spaces.DEVICE_RGB}c={data:t,width:s.width,height:s.height,colorSpace:o,bitsPerComponent:8,filter:u,index:r,alias:n}}return c}}(j.API);var Se,_e,Pe,ke,Fe,Ie=function(){var t,r,n;function i(t){var e,r,n,i,a,o,s,u,c,l,h,f,d,p;for(this.data=t,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},o=null;;){switch(e=this.readUInt32(),c=function(){var t,e;for(e=[],t=0;t<4;++t)e.push(String.fromCharCode(this.data[this.pos++]));return e}.call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(e);break;case"fcTL":o&&this.animation.frames.push(o),this.pos+=4,o={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},a=this.readUInt16(),i=this.readUInt16()||100,o.delay=1e3*a/i,o.disposeOp=this.data[this.pos++],o.blendOp=this.data[this.pos++],o.data=[];break;case"IDAT":case"fdAT":for("fdAT"===c&&(this.pos+=4,e-=4),t=(null!=o?o.data:void 0)||this.imgData,f=0;0<=e?f<e:f>e;0<=e?++f:--f)t.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(n=this.palette.length/3,this.transparency.indexed=this.read(e),this.transparency.indexed.length>n)throw new Error("More transparent colors than palette size");if((l=n-this.transparency.indexed.length)>0)for(d=0;0<=l?d<l:d>l;0<=l?++d:--d)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(e)[0];break;case 2:this.transparency.rgb=this.read(e)}break;case"tEXt":s=(h=this.read(e)).indexOf(0),u=String.fromCharCode.apply(String,h.slice(0,s)),this.text[u]=String.fromCharCode.apply(String,h.slice(s+1));break;case"IEND":return o&&this.animation.frames.push(o),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=4===(p=this.colorType)||6===p,r=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*r,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=e}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}i.prototype.read=function(t){var e,r;for(r=[],e=0;0<=t?e<t:e>t;0<=t?++e:--e)r.push(this.data[this.pos++]);return r},i.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},i.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},i.prototype.decodePixels=function(t){var e=this.pixelBitlength/8,r=new Uint8Array(this.width*this.height*e),n=0,i=this;if(null==t&&(t=this.imgData),0===t.length)return new Uint8Array(0);function a(a,o,s,u){var c,l,h,f,d,p,g,m,v,b,y,w,N,A,L,x,S,_,P,k,F,I=Math.ceil((i.width-a)/s),C=Math.ceil((i.height-o)/u),j=i.width==I&&i.height==C;for(A=e*I,w=j?r:new Uint8Array(A*C),p=t.length,N=0,l=0;N<C&&n<p;){switch(t[n++]){case 0:for(f=S=0;S<A;f=S+=1)w[l++]=t[n++];break;case 1:for(f=_=0;_<A;f=_+=1)c=t[n++],d=f<e?0:w[l-e],w[l++]=(c+d)%256;break;case 2:for(f=P=0;P<A;f=P+=1)c=t[n++],h=(f-f%e)/e,L=N&&w[(N-1)*A+h*e+f%e],w[l++]=(L+c)%256;break;case 3:for(f=k=0;k<A;f=k+=1)c=t[n++],h=(f-f%e)/e,d=f<e?0:w[l-e],L=N&&w[(N-1)*A+h*e+f%e],w[l++]=(c+Math.floor((d+L)/2))%256;break;case 4:for(f=F=0;F<A;f=F+=1)c=t[n++],h=(f-f%e)/e,d=f<e?0:w[l-e],0===N?L=x=0:(L=w[(N-1)*A+h*e+f%e],x=h&&w[(N-1)*A+(h-1)*e+f%e]),g=d+L-x,m=Math.abs(g-d),b=Math.abs(g-L),y=Math.abs(g-x),v=m<=b&&m<=y?d:b<=y?L:x,w[l++]=(c+v)%256;break;default:throw new Error("Invalid filter algorithm: "+t[n-1])}if(!j){var O=((o+N*u)*i.width+a)*e,B=N*A;for(f=0;f<I;f+=1){for(var M=0;M<e;M+=1)r[O++]=w[B++];O+=(s-1)*e}}N++}}return t=xe(t),1==i.interlaceMethod?(a(0,0,8,8),a(4,0,8,8),a(0,4,4,8),a(2,0,4,4),a(0,2,2,4),a(1,0,2,2),a(0,1,1,2)):a(0,0,1,1),r},i.prototype.decodePalette=function(){var t,e,r,n,i,a,o,s,u;for(r=this.palette,a=this.transparency.indexed||[],i=new Uint8Array((a.length||0)+r.length),n=0,t=0,e=o=0,s=r.length;o<s;e=o+=3)i[n++]=r[e],i[n++]=r[e+1],i[n++]=r[e+2],i[n++]=null!=(u=a[t++])?u:255;return i},i.prototype.copyToImageData=function(t,e){var r,n,i,a,o,s,u,c,l,h,f;if(n=this.colors,l=null,r=this.hasAlphaChannel,this.palette.length&&(l=null!=(f=this._decodedPalette)?f:this._decodedPalette=this.decodePalette(),n=4,r=!0),c=(i=t.data||t).length,o=l||e,a=s=0,1===n)for(;a<c;)u=l?4*e[a/4]:s,h=o[u++],i[a++]=h,i[a++]=h,i[a++]=h,i[a++]=r?o[u++]:255,s=u;else for(;a<c;)u=l?4*e[a/4]:s,i[a++]=o[u++],i[a++]=o[u++],i[a++]=o[u++],i[a++]=r?o[u++]:255,s=u},i.prototype.decode=function(){var t;return t=new Uint8Array(this.width*this.height*4),this.copyToImageData(t,this.decodePixels()),t};var a=function(){if("[object Window]"===Object.prototype.toString.call(e)){try{r=e.document.createElement("canvas"),n=r.getContext("2d")}catch(t){return!1}return!0}return!1};return a(),t=function(t){var e;if(!0===a())return n.width=t.width,n.height=t.height,n.clearRect(0,0,t.width,t.height),n.putImageData(t,0,0),(e=new Image).src=r.toDataURL(),e;throw new Error("This method requires a Browser with Canvas-capability.")},i.prototype.decodeFrames=function(e){var r,n,i,a,o,s,u,c;if(this.animation){for(c=[],n=o=0,s=(u=this.animation.frames).length;o<s;n=++o)r=u[n],i=e.createImageData(r.width,r.height),a=this.decodePixels(new Uint8Array(r.data)),this.copyToImageData(i,a),r.imageData=i,c.push(r.image=t(i));return c}},i.prototype.renderFrame=function(t,e){var r,n,i;return r=(n=this.animation.frames)[e],i=n[e-1],0===e&&t.clearRect(0,0,this.width,this.height),1===(null!=i?i.disposeOp:void 0)?t.clearRect(i.xOffset,i.yOffset,i.width,i.height):2===(null!=i?i.disposeOp:void 0)&&t.putImageData(i.imageData,i.xOffset,i.yOffset),0===r.blendOp&&t.clearRect(r.xOffset,r.yOffset,r.width,r.height),t.drawImage(r.image,r.xOffset,r.yOffset)},i.prototype.animate=function(t){var e,r,n,i,a,o,s=this;return r=0,o=this.animation,i=o.numFrames,n=o.frames,a=o.numPlays,(e=function(){var o,u;if(o=r++%i,u=n[o],s.renderFrame(t,o),i>1&&r/i<a)return s.animation._timeout=setTimeout(e,u.delay)})()},i.prototype.stopAnimation=function(){var t;return clearTimeout(null!=(t=this.animation)?t._timeout:void 0)},i.prototype.render=function(t){var e,r;return t._png&&t._png.stopAnimation(),t._png=this,t.width=this.width,t.height=this.height,e=t.getContext("2d"),this.animation?(this.decodeFrames(e),this.animate(e)):(r=e.createImageData(this.width,this.height),this.copyToImageData(r,this.decodePixels()),e.putImageData(r,0,0))},i}();function Ce(t){var e=0;if(71!==t[e++]||73!==t[e++]||70!==t[e++]||56!==t[e++]||56!=(t[e++]+1&253)||97!==t[e++])throw new Error("Invalid GIF 87a/89a header.");var r=t[e++]|t[e++]<<8,n=t[e++]|t[e++]<<8,i=t[e++],a=i>>7,o=1<<(7&i)+1;t[e++];t[e++];var s=null,u=null;a&&(s=e,u=o,e+=3*o);var c=!0,l=[],h=0,f=null,d=0,p=null;for(this.width=r,this.height=n;c&&e<t.length;)switch(t[e++]){case 33:switch(t[e++]){case 255:if(11!==t[e]||78==t[e+1]&&69==t[e+2]&&84==t[e+3]&&83==t[e+4]&&67==t[e+5]&&65==t[e+6]&&80==t[e+7]&&69==t[e+8]&&50==t[e+9]&&46==t[e+10]&&48==t[e+11]&&3==t[e+12]&&1==t[e+13]&&0==t[e+16])e+=14,p=t[e++]|t[e++]<<8,e++;else for(e+=12;;){if(!((P=t[e++])>=0))throw Error("Invalid block size");if(0===P)break;e+=P}break;case 249:if(4!==t[e++]||0!==t[e+4])throw new Error("Invalid graphics extension block.");var g=t[e++];h=t[e++]|t[e++]<<8,f=t[e++],0==(1&g)&&(f=null),d=g>>2&7,e++;break;case 254:for(;;){if(!((P=t[e++])>=0))throw Error("Invalid block size");if(0===P)break;e+=P}break;default:throw new Error("Unknown graphic control label: 0x"+t[e-1].toString(16))}break;case 44:var m=t[e++]|t[e++]<<8,v=t[e++]|t[e++]<<8,b=t[e++]|t[e++]<<8,y=t[e++]|t[e++]<<8,w=t[e++],N=w>>6&1,A=1<<(7&w)+1,L=s,x=u,S=!1;if(w>>7){S=!0;L=e,x=A,e+=3*A}var _=e;for(e++;;){var P;if(!((P=t[e++])>=0))throw Error("Invalid block size");if(0===P)break;e+=P}l.push({x:m,y:v,width:b,height:y,has_local_palette:S,palette_offset:L,palette_size:x,data_offset:_,data_length:e-_,transparent_index:f,interlaced:!!N,delay:h,disposal:d});break;case 59:c=!1;break;default:throw new Error("Unknown gif block: 0x"+t[e-1].toString(16))}this.numFrames=function(){return l.length},this.loopCount=function(){return p},this.frameInfo=function(t){if(t<0||t>=l.length)throw new Error("Frame index out of range.");return l[t]},this.decodeAndBlitFrameBGRA=function(e,n){var i=this.frameInfo(e),a=i.width*i.height,o=new Uint8Array(a);je(t,i.data_offset,o,a);var s=i.palette_offset,u=i.transparent_index;null===u&&(u=256);var c=i.width,l=r-c,h=c,f=4*(i.y*r+i.x),d=4*((i.y+i.height)*r+i.x),p=f,g=4*l;!0===i.interlaced&&(g+=4*r*7);for(var m=8,v=0,b=o.length;v<b;++v){var y=o[v];if(0===h&&(h=c,(p+=g)>=d&&(g=4*l+4*r*(m-1),p=f+(c+l)*(m<<1),m>>=1)),y===u)p+=4;else{var w=t[s+3*y],N=t[s+3*y+1],A=t[s+3*y+2];n[p++]=A,n[p++]=N,n[p++]=w,n[p++]=255}--h}},this.decodeAndBlitFrameRGBA=function(e,n){var i=this.frameInfo(e),a=i.width*i.height,o=new Uint8Array(a);je(t,i.data_offset,o,a);var s=i.palette_offset,u=i.transparent_index;null===u&&(u=256);var c=i.width,l=r-c,h=c,f=4*(i.y*r+i.x),d=4*((i.y+i.height)*r+i.x),p=f,g=4*l;!0===i.interlaced&&(g+=4*r*7);for(var m=8,v=0,b=o.length;v<b;++v){var y=o[v];if(0===h&&(h=c,(p+=g)>=d&&(g=4*l+4*r*(m-1),p=f+(c+l)*(m<<1),m>>=1)),y===u)p+=4;else{var w=t[s+3*y],N=t[s+3*y+1],A=t[s+3*y+2];n[p++]=w,n[p++]=N,n[p++]=A,n[p++]=255}--h}}}function je(t,e,r,i){for(var a=t[e++],o=1<<a,s=o+1,u=s+1,c=a+1,l=(1<<c)-1,h=0,f=0,d=0,p=t[e++],g=new Int32Array(4096),m=null;;){for(;h<16&&0!==p;)f|=t[e++]<<h,h+=8,1===p?p=t[e++]:--p;if(h<c)break;var v=f&l;if(f>>=c,h-=c,v!==o){if(v===s)break;for(var b=v<u?v:m,y=0,w=b;w>o;)w=g[w]>>8,++y;var N=w;if(d+y+(b!==v?1:0)>i)return void n.log("Warning, gif stream longer than expected.");r[d++]=N;var A=d+=y;for(b!==v&&(r[d++]=N),w=b;y--;)w=g[w],r[--A]=255&w,w>>=8;null!==m&&u<4096&&(g[u++]=m<<8|N,u>=l+1&&c<12&&(++c,l=l<<1|1)),m=v}else u=s+1,l=(1<<(c=a+1))-1,m=null}return d!==i&&n.log("Warning, gif stream shorter than expected."),r}
function Oe(t){var e,r,n,i,a,o=Math.floor,s=new Array(64),u=new Array(64),c=new Array(64),l=new Array(64),h=new Array(65535),f=new Array(65535),d=new Array(64),p=new Array(64),g=[],m=0,v=7,b=new Array(64),y=new Array(64),w=new Array(64),N=new Array(256),A=new Array(2048),L=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],x=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],S=[0,1,2,3,4,5,6,7,8,9,10,11],_=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],P=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],k=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],F=[0,1,2,3,4,5,6,7,8,9,10,11],I=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],C=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function j(t,e){for(var r=0,n=0,i=new Array,a=1;a<=16;a++){for(var o=1;o<=t[a];o++)i[e[n]]=[],i[e[n]][0]=r,i[e[n]][1]=a,n++,r++;r*=2}return i}function O(t){for(var e=t[0],r=t[1]-1;r>=0;)e&1<<r&&(m|=1<<v),r--,--v<0&&(255==m?(B(255),B(0)):B(m),v=7,m=0)}function B(t){g.push(t)}function M(t){B(t>>8&255),B(255&t)}function E(t,e,r,n,i){for(var a,o=i[0],s=i[240],u=function(t,e){var r,n,i,a,o,s,u,c,l,h,f=0;for(l=0;l<8;++l){r=t[f],n=t[f+1],i=t[f+2],a=t[f+3],o=t[f+4],s=t[f+5],u=t[f+6];var p=r+(c=t[f+7]),g=r-c,m=n+u,v=n-u,b=i+s,y=i-s,w=a+o,N=a-o,A=p+w,L=p-w,x=m+b,S=m-b;t[f]=A+x,t[f+4]=A-x;var _=.707106781*(S+L);t[f+2]=L+_,t[f+6]=L-_;var P=.382683433*((A=N+y)-(S=v+g)),k=.5411961*A+P,F=1.306562965*S+P,I=.707106781*(x=y+v),C=g+I,j=g-I;t[f+5]=j+k,t[f+3]=j-k,t[f+1]=C+F,t[f+7]=C-F,f+=8}for(f=0,l=0;l<8;++l){r=t[f],n=t[f+8],i=t[f+16],a=t[f+24],o=t[f+32],s=t[f+40],u=t[f+48];var O=r+(c=t[f+56]),B=r-c,M=n+u,E=n-u,q=i+s,R=i-s,T=a+o,D=a-o,U=O+T,z=O-T,H=M+q,W=M-q;t[f]=U+H,t[f+32]=U-H;var V=.707106781*(W+z);t[f+16]=z+V,t[f+48]=z-V;var G=.382683433*((U=D+R)-(W=E+B)),Y=.5411961*U+G,J=1.306562965*W+G,X=.707106781*(H=R+E),K=B+X,Z=B-X;t[f+40]=Z+Y,t[f+24]=Z-Y,t[f+8]=K+J,t[f+56]=K-J,f++}for(l=0;l<64;++l)h=t[l]*e[l],d[l]=h>0?h+.5|0:h-.5|0;return d}(t,e),c=0;c<64;++c)p[L[c]]=u[c];var l=p[0]-r;r=p[0],0==l?O(n[0]):(O(n[f[a=32767+l]]),O(h[a]));for(var g=63;g>0&&0==p[g];)g--;if(0==g)return O(o),r;for(var m,v=1;v<=g;){for(var b=v;0==p[v]&&v<=g;)++v;var y=v-b;if(y>=16){m=y>>4;for(var w=1;w<=m;++w)O(s);y&=15}a=32767+p[v],O(i[(y<<4)+f[a]]),O(h[a]),v++}return 63!=g&&O(o),r}function q(t){(t=Math.min(Math.max(t,1),100),a!=t)&&(!function(t){for(var e=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],r=0;r<64;r++){var n=o((e[r]*t+50)/100);n=Math.min(Math.max(n,1),255),s[L[r]]=n}for(var i=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],a=0;a<64;a++){var h=o((i[a]*t+50)/100);h=Math.min(Math.max(h,1),255),u[L[a]]=h}for(var f=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],d=0,p=0;p<8;p++)for(var g=0;g<8;g++)c[d]=1/(s[L[d]]*f[p]*f[g]*8),l[d]=1/(u[L[d]]*f[p]*f[g]*8),d++}(t<50?Math.floor(5e3/t):Math.floor(200-2*t)),a=t)}this.encode=function(t,a){a&&q(a),g=new Array,m=0,v=7,M(65496),M(65504),M(16),B(74),B(70),B(73),B(70),B(0),B(1),B(1),B(0),M(1),M(1),B(0),B(0),function(){M(65499),M(132),B(0);for(var t=0;t<64;t++)B(s[t]);B(1);for(var e=0;e<64;e++)B(u[e])}(),function(t,e){M(65472),M(17),B(8),M(e),M(t),B(3),B(1),B(17),B(0),B(2),B(17),B(1),B(3),B(17),B(1)}(t.width,t.height),function(){M(65476),M(418),B(0);for(var t=0;t<16;t++)B(x[t+1]);for(var e=0;e<=11;e++)B(S[e]);B(16);for(var r=0;r<16;r++)B(_[r+1]);for(var n=0;n<=161;n++)B(P[n]);B(1);for(var i=0;i<16;i++)B(k[i+1]);for(var a=0;a<=11;a++)B(F[a]);B(17);for(var o=0;o<16;o++)B(I[o+1]);for(var s=0;s<=161;s++)B(C[s])}(),M(65498),M(12),B(3),B(1),B(0),B(2),B(17),B(3),B(17),B(0),B(63),B(0);var o=0,h=0,f=0;m=0,v=7,this.encode.displayName="_encode_";for(var d,p,N,L,j,R,T,D,U,z=t.data,H=t.width,W=t.height,V=4*H,G=0;G<W;){for(d=0;d<V;){for(j=V*G+d,T=-1,D=0,U=0;U<64;U++)R=j+(D=U>>3)*V+(T=4*(7&U)),G+D>=W&&(R-=V*(G+1+D-W)),d+T>=V&&(R-=d+T-V+4),p=z[R++],N=z[R++],L=z[R++],b[U]=(A[p]+A[N+256>>0]+A[L+512>>0]>>16)-128,y[U]=(A[p+768>>0]+A[N+1024>>0]+A[L+1280>>0]>>16)-128,w[U]=(A[p+1280>>0]+A[N+1536>>0]+A[L+1792>>0]>>16)-128;o=E(b,c,o,e,n),h=E(y,l,h,r,i),f=E(w,l,f,r,i),d+=32}G+=8}if(v>=0){var Y=[];Y[1]=v+1,Y[0]=(1<<v+1)-1,O(Y)}return M(65497),new Uint8Array(g)},t=t||50,function(){for(var t=String.fromCharCode,e=0;e<256;e++)N[e]=t(e)}(),e=j(x,S),r=j(k,F),n=j(_,P),i=j(I,C),function(){for(var t=1,e=2,r=1;r<=15;r++){for(var n=t;n<e;n++)f[32767+n]=r,h[32767+n]=[],h[32767+n][1]=r,h[32767+n][0]=n;for(var i=-(e-1);i<=-t;i++)f[32767+i]=r,h[32767+i]=[],h[32767+i][1]=r,h[32767+i][0]=e-1+i;t<<=1,e<<=1}}(),function(){for(var t=0;t<256;t++)A[t]=19595*t,A[t+256>>0]=38470*t,A[t+512>>0]=7471*t+32768,A[t+768>>0]=-11059*t,A[t+1024>>0]=-21709*t,A[t+1280>>0]=32768*t+8421375,A[t+1536>>0]=-27439*t,A[t+1792>>0]=-5329*t}(),q(t)}
function Be(t,e){if(this.pos=0,this.buffer=t,this.datav=new DataView(t.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,-1===["BM","BA","CI","CP","IC","PT"].indexOf(this.flag))throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function Me(t){function e(t){if(!t)throw Error("assert :P")}function r(t,e,r){for(var n=0;4>n;n++)if(t[e+n]!=r.charCodeAt(n))return!0;return!1}function n(t,e,r,n,i){for(var a=0;a<i;a++)t[e+a]=r[n+a]}function i(t,e,r,n){for(var i=0;i<n;i++)t[e+i]=r}function a(t){return new Int32Array(t)}function o(t,e){for(var r=[],n=0;n<t;n++)r.push(new e);return r}function s(t,e){var r=[];return function t(r,n,i){for(var a=i[n],o=0;o<a&&(r.push(i.length>n+1?[]:new e),!(i.length<n+1));o++)t(r[o],n+1,i)}(r,0,t),r}function u(t,e){for(var r="",n=0;n<4;n++)r+=String.fromCharCode(t[e++]);return r}function c(t,e){return(t[e+0]<<0|t[e+1]<<8|t[e+2]<<16)>>>0}function l(t,e){return(t[e+0]<<0|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}new(Me=function(){var t=this;function u(t,e){for(var r=1<<e-1>>>0;t&r;)r>>>=1;return r?(t&r-1)+r:t}function c(t,r,n,i,a){e(!(i%n));do{t[r+(i-=n)]=a}while(0<i)}function l(t,r,n,i,o){if(e(2328>=o),512>=o)var s=a(512);else if(null==(s=a(o)))return 0;return function(t,r,n,i,o,s){var l,f,d=r,p=1<<n,g=a(16),m=a(16);for(e(0!=o),e(null!=i),e(null!=t),e(0<n),f=0;f<o;++f){if(15<i[f])return 0;++g[i[f]]}if(g[0]==o)return 0;for(m[1]=0,l=1;15>l;++l){if(g[l]>1<<l)return 0;m[l+1]=m[l]+g[l]}for(f=0;f<o;++f)l=i[f],0<i[f]&&(s[m[l]++]=f);if(1==m[15])return(i=new h).g=0,i.value=s[0],c(t,d,1,p,i),p;var v,b=-1,y=p-1,w=0,N=1,A=1,L=1<<n;for(f=0,l=1,o=2;l<=n;++l,o<<=1){if(N+=A<<=1,0>(A-=g[l]))return 0;for(;0<g[l];--g[l])(i=new h).g=l,i.value=s[f++],c(t,d+w,o,L,i),w=u(w,l)}for(l=n+1,o=2;15>=l;++l,o<<=1){if(N+=A<<=1,0>(A-=g[l]))return 0;for(;0<g[l];--g[l]){if(i=new h,(w&y)!=b){for(d+=L,v=1<<(b=l)-n;15>b&&!(0>=(v-=g[b]));)++b,v<<=1;p+=L=1<<(v=b-n),t[r+(b=w&y)].g=v+n,t[r+b].value=d-r-b}i.g=l-n,i.value=s[f++],c(t,d+(w>>n),o,L,i),w=u(w,l)}}return N!=2*m[15]-1?0:p}(t,r,n,i,o,s)}function h(){this.value=this.g=0}function f(){this.value=this.g=0}function d(){this.G=o(5,h),this.H=a(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=o(Rr,f)}function p(t,r,n,i){e(null!=t),e(null!=r),e(2147483648>i),t.Ca=254,t.I=0,t.b=-8,t.Ka=0,t.oa=r,t.pa=n,t.Jd=r,t.Yc=n+i,t.Zc=4<=i?n+i-4+1:n,_(t)}function g(t,e){for(var r=0;0<e--;)r|=k(t,128)<<e;return r}function m(t,e){var r=g(t,e);return P(t)?-r:r}function v(t,r,n,i){var a,o=0;for(e(null!=t),e(null!=r),e(4294967288>i),t.Sb=i,t.Ra=0,t.u=0,t.h=0,4<i&&(i=4),a=0;a<i;++a)o+=r[n+a]<<8*a;t.Ra=o,t.bb=i,t.oa=r,t.pa=n}function b(t){for(;8<=t.u&&t.bb<t.Sb;)t.Ra>>>=8,t.Ra+=t.oa[t.pa+t.bb]<<Ur-8>>>0,++t.bb,t.u-=8;L(t)&&(t.h=1,t.u=0)}function y(t,r){if(e(0<=r),!t.h&&r<=Dr){var n=A(t)&Tr[r];return t.u+=r,b(t),n}return t.h=1,t.u=0}function w(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function N(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function A(t){return t.Ra>>>(t.u&Ur-1)>>>0}function L(t){return e(t.bb<=t.Sb),t.h||t.bb==t.Sb&&t.u>Ur}function x(t,e){t.u=e,t.h=L(t)}function S(t){t.u>=zr&&(e(t.u>=zr),b(t))}function _(t){e(null!=t&&null!=t.oa),t.pa<t.Zc?(t.I=(t.oa[t.pa++]|t.I<<8)>>>0,t.b+=8):(e(null!=t&&null!=t.oa),t.pa<t.Yc?(t.b+=8,t.I=t.oa[t.pa++]|t.I<<8):t.Ka?t.b=0:(t.I<<=8,t.b+=8,t.Ka=1))}function P(t){return g(t,1)}function k(t,e){var r=t.Ca;0>t.b&&_(t);var n=t.b,i=r*e>>>8,a=(t.I>>>n>i)+0;for(a?(r-=i,t.I-=i+1<<n>>>0):r=i+1,n=r,i=0;256<=n;)i+=8,n>>=8;return n=7^i+Hr[n],t.b-=n,t.Ca=(r<<n)-1,a}function F(t,e,r){t[e+0]=r>>24&255,t[e+1]=r>>16&255,t[e+2]=r>>8&255,t[e+3]=r>>0&255}function I(t,e){return t[e+0]<<0|t[e+1]<<8}function C(t,e){return I(t,e)|t[e+2]<<16}function j(t,e){return I(t,e)|I(t,e+2)<<16}function O(t,r){var n=1<<r;return e(null!=t),e(0<r),t.X=a(n),null==t.X?0:(t.Mb=32-r,t.Xa=r,1)}function B(t,r){e(null!=t),e(null!=r),e(t.Xa==r.Xa),n(r.X,0,t.X,0,1<<r.Xa)}function M(){this.X=[],this.Xa=this.Mb=0}function E(t,r,n,i){e(null!=n),e(null!=i);var a=n[0],o=i[0];return 0==a&&(a=(t*o+r/2)/r),0==o&&(o=(r*a+t/2)/t),0>=a||0>=o?0:(n[0]=a,i[0]=o,1)}function q(t,e){return t+(1<<e)-1>>>e}function R(t,e){return((4278255360&t)+(4278255360&e)>>>0&4278255360)+((16711935&t)+(16711935&e)>>>0&16711935)>>>0}function T(e,r){t[r]=function(r,n,i,a,o,s,u){var c;for(c=0;c<o;++c){var l=t[e](s[u+c-1],i,a+c);s[u+c]=R(r[n+c],l)}}}function D(){this.ud=this.hd=this.jd=0}function U(t,e){return((4278124286&(t^e))>>>1)+(t&e)>>>0}function z(t){return 0<=t&&256>t?t:0>t?0:255<t?255:void 0}function H(t,e){return z(t+(t-e+.5>>1))}function W(t,e,r){return Math.abs(e-r)-Math.abs(t-r)}function V(t,e,r,n,i,a,o){for(n=a[o-1],r=0;r<i;++r)a[o+r]=n=R(t[e+r],n)}function G(t,e,r,n,i){var a;for(a=0;a<r;++a){var o=t[e+a],s=o>>8&255,u=16711935&(u=(u=16711935&o)+((s<<16)+s));n[i+a]=(4278255360&o)+u>>>0}}function Y(t,e){e.jd=t>>0&255,e.hd=t>>8&255,e.ud=t>>16&255}function J(t,e,r,n,i,a){var o;for(o=0;o<n;++o){var s=e[r+o],u=s>>>8,c=s,l=255&(l=(l=s>>>16)+((t.jd<<24>>24)*(u<<24>>24)>>>5));c=255&(c=(c=c+((t.hd<<24>>24)*(u<<24>>24)>>>5))+((t.ud<<24>>24)*(l<<24>>24)>>>5));i[a+o]=(4278255360&s)+(l<<16)+c}}function X(e,r,n,i,a){t[r]=function(t,e,r,n,o,s,u,c,l){for(n=u;n<c;++n)for(u=0;u<l;++u)o[s++]=a(r[i(t[e++])])},t[e]=function(e,r,o,s,u,c,l){var h=8>>e.b,f=e.Ea,d=e.K[0],p=e.w;if(8>h)for(e=(1<<e.b)-1,p=(1<<h)-1;r<o;++r){var g,m=0;for(g=0;g<f;++g)g&e||(m=i(s[u++])),c[l++]=a(d[m&p]),m>>=h}else t["VP8LMapColor"+n](s,u,d,p,c,l,r,o,f)}}function K(t,e,r,n,i){for(r=e+r;e<r;){var a=t[e++];n[i++]=a>>16&255,n[i++]=a>>8&255,n[i++]=a>>0&255}}function Z(t,e,r,n,i){for(r=e+r;e<r;){var a=t[e++];n[i++]=a>>16&255,n[i++]=a>>8&255,n[i++]=a>>0&255,n[i++]=a>>24&255}}function $(t,e,r,n,i){for(r=e+r;e<r;){var a=(o=t[e++])>>16&240|o>>12&15,o=o>>0&240|o>>28&15;n[i++]=a,n[i++]=o}}function Q(t,e,r,n,i){for(r=e+r;e<r;){var a=(o=t[e++])>>16&248|o>>13&7,o=o>>5&224|o>>3&31;n[i++]=a,n[i++]=o}}function tt(t,e,r,n,i){for(r=e+r;e<r;){var a=t[e++];n[i++]=a>>0&255,n[i++]=a>>8&255,n[i++]=a>>16&255}}function et(t,e,r,i,a,o){if(0==o)for(r=e+r;e<r;)F(i,((o=t[e++])[0]>>24|o[1]>>8&65280|o[2]<<8&16711680|o[3]<<24)>>>0),a+=32;else n(i,a,t,e,r)}function rt(e,r){t[r][0]=t[e+"0"],t[r][1]=t[e+"1"],t[r][2]=t[e+"2"],t[r][3]=t[e+"3"],t[r][4]=t[e+"4"],t[r][5]=t[e+"5"],t[r][6]=t[e+"6"],t[r][7]=t[e+"7"],t[r][8]=t[e+"8"],t[r][9]=t[e+"9"],t[r][10]=t[e+"10"],t[r][11]=t[e+"11"],t[r][12]=t[e+"12"],t[r][13]=t[e+"13"],t[r][14]=t[e+"0"],t[r][15]=t[e+"0"]}function nt(t){return t==Hn||t==Wn||t==Vn||t==Gn}function it(){this.eb=[],this.size=this.A=this.fb=0}function at(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function ot(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new it,this.f.kb=new at,this.sd=null}function st(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function ut(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function ct(t){return alert("todo:WebPSamplerProcessPlane"),t.T}function lt(t,e){var r=t.T,i=e.ba.f.RGBA,a=i.eb,o=i.fb+t.ka*i.A,s=vi[e.ba.S],u=t.y,c=t.O,l=t.f,h=t.N,f=t.ea,d=t.W,p=e.cc,g=e.dc,m=e.Mc,v=e.Nc,b=t.ka,y=t.ka+t.T,w=t.U,N=w+1>>1;for(0==b?s(u,c,null,null,l,h,f,d,l,h,f,d,a,o,null,null,w):(s(e.ec,e.fc,u,c,p,g,m,v,l,h,f,d,a,o-i.A,a,o,w),++r);b+2<y;b+=2)p=l,g=h,m=f,v=d,h+=t.Rc,d+=t.Rc,o+=2*i.A,s(u,(c+=2*t.fa)-t.fa,u,c,p,g,m,v,l,h,f,d,a,o-i.A,a,o,w);return c+=t.fa,t.j+y<t.o?(n(e.ec,e.fc,u,c,w),n(e.cc,e.dc,l,h,N),n(e.Mc,e.Nc,f,d,N),r--):1&y||s(u,c,null,null,l,h,f,d,l,h,f,d,a,o+i.A,null,null,w),r}function ht(t,r,n){var i=t.F,a=[t.J];if(null!=i){var o=t.U,s=r.ba.S,u=s==Dn||s==Vn;r=r.ba.f.RGBA;var c=[0],l=t.ka;c[0]=t.T,t.Kb&&(0==l?--c[0]:(--l,a[0]-=t.width),t.j+t.ka+t.T==t.o&&(c[0]=t.o-t.j-l));var h=r.eb;l=r.fb+l*r.A;t=Sn(i,a[0],t.width,o,c,h,l+(u?0:3),r.A),e(n==c),t&&nt(s)&&Ln(h,l,u,o,c,r.A)}return 0}function ft(t){var e=t.ma,r=e.ba.S,n=11>r,i=r==qn||r==Tn||r==Dn||r==Un||12==r||nt(r);if(e.memory=null,e.Ib=null,e.Jb=null,e.Nd=null,!Mr(e.Oa,t,i?11:12))return 0;if(i&&nt(r)&&br(),t.da)alert("todo:use_scaling");else{if(n){if(e.Ib=ct,t.Kb){if(r=t.U+1>>1,e.memory=a(t.U+2*r),null==e.memory)return 0;e.ec=e.memory,e.fc=0,e.cc=e.ec,e.dc=e.fc+t.U,e.Mc=e.cc,e.Nc=e.dc+r,e.Ib=lt,br()}}else alert("todo:EmitYUV");i&&(e.Jb=ht,n&&mr())}if(n&&!Ci){for(t=0;256>t;++t)ji[t]=89858*(t-128)+_i>>Si,Mi[t]=-22014*(t-128)+_i,Bi[t]=-45773*(t-128),Oi[t]=113618*(t-128)+_i>>Si;for(t=Pi;t<ki;++t)e=76283*(t-16)+_i>>Si,Ei[t-Pi]=Vt(e,255),qi[t-Pi]=Vt(e+8>>4,15);Ci=1}return 1}function dt(t){var r=t.ma,n=t.U,i=t.T;return e(!(1&t.ka)),0>=n||0>=i?0:(n=r.Ib(t,r),null!=r.Jb&&r.Jb(t,r,n),r.Dc+=n,1)}function pt(t){t.ma.memory=null}function gt(t,e,r,n){return 47!=y(t,8)?0:(e[0]=y(t,14)+1,r[0]=y(t,14)+1,n[0]=y(t,1),0!=y(t,3)?0:!t.h)}function mt(t,e){if(4>t)return t+1;var r=t-2>>1;return(2+(1&t)<<r)+y(e,r)+1}function vt(t,e){return 120<e?e-120:1<=(r=((r=$n[e-1])>>4)*t+(8-(15&r)))?r:1;var r}function bt(t,e,r){var n=A(r),i=t[e+=255&n].g-8;return 0<i&&(x(r,r.u+8),n=A(r),e+=t[e].value,e+=n&(1<<i)-1),x(r,r.u+t[e].g),t[e].value}function yt(t,r,n){return n.g+=t.g,n.value+=t.value<<r>>>0,e(8>=n.g),t.g}function wt(t,r,n){var i=t.xc;return e((r=0==i?0:t.vc[t.md*(n>>i)+(r>>i)])<t.Wb),t.Ya[r]}function Nt(t,r,i,a){var o=t.ab,s=t.c*r,u=t.C;r=u+r;var c=i,l=a;for(a=t.Ta,i=t.Ua;0<o--;){var h=t.gc[o],f=u,d=r,p=c,g=l,m=(l=a,c=i,h.Ea);switch(e(f<d),e(d<=h.nc),h.hc){case 2:Gr(p,g,(d-f)*m,l,c);break;case 0:var v=f,b=d,y=l,w=c,N=(_=h).Ea;0==v&&(Wr(p,g,null,null,1,y,w),V(p,g+1,0,0,N-1,y,w+1),g+=N,w+=N,++v);for(var A=1<<_.b,L=A-1,x=q(N,_.b),S=_.K,_=_.w+(v>>_.b)*x;v<b;){var P=S,k=_,F=1;for(Vr(p,g,y,w-N,1,y,w);F<N;){var I=(F&~L)+A;I>N&&(I=N),(0,Zr[P[k++]>>8&15])(p,g+ +F,y,w+F-N,I-F,y,w+F),F=I}g+=N,w+=N,++v&L||(_+=x)}d!=h.nc&&n(l,c-m,l,c+(d-f-1)*m,m);break;case 1:for(m=p,b=g,N=(p=h.Ea)-(w=p&~(y=(g=1<<h.b)-1)),v=q(p,h.b),A=h.K,h=h.w+(f>>h.b)*v;f<d;){for(L=A,x=h,S=new D,_=b+w,P=b+p;b<_;)Y(L[x++],S),$r(S,m,b,g,l,c),b+=g,c+=g;b<P&&(Y(L[x++],S),$r(S,m,b,N,l,c),b+=N,c+=N),++f&y||(h+=v)}break;case 3:if(p==l&&g==c&&0<h.b){for(b=l,p=m=c+(d-f)*m-(w=(d-f)*q(h.Ea,h.b)),g=l,y=c,v=[],w=(N=w)-1;0<=w;--w)v[w]=g[y+w];for(w=N-1;0<=w;--w)b[p+w]=v[w];Yr(h,f,d,l,m,l,c)}else Yr(h,f,d,p,g,l,c)}c=a,l=i}l!=i&&n(a,i,c,l,s)}function At(t,r){var n=t.V,i=t.Ba+t.c*t.C,a=r-t.C;if(e(r<=t.l.o),e(16>=a),0<a){var o=t.l,s=t.Ta,u=t.Ua,c=o.width;if(Nt(t,a,n,i),a=u=[u],e((n=t.C)<(i=r)),e(o.v<o.va),i>o.o&&(i=o.o),n<o.j){var l=o.j-n;n=o.j;a[0]+=l*c}if(n>=i?n=0:(a[0]+=4*o.v,o.ka=n-o.j,o.U=o.va-o.v,o.T=i-n,n=1),n){if(u=u[0],11>(n=t.ca).S){var h=n.f.RGBA,f=(i=n.S,a=o.U,o=o.T,l=h.eb,h.A),d=o;for(h=h.fb+t.Ma*h.A;0<d--;){var p=s,g=u,m=a,v=l,b=h;switch(i){case En:Qr(p,g,m,v,b);break;case qn:tn(p,g,m,v,b);break;case Hn:tn(p,g,m,v,b),Ln(v,b,0,m,1,0);break;case Rn:nn(p,g,m,v,b);break;case Tn:et(p,g,m,v,b,1);break;case Wn:et(p,g,m,v,b,1),Ln(v,b,0,m,1,0);break;case Dn:et(p,g,m,v,b,0);break;case Vn:et(p,g,m,v,b,0),Ln(v,b,1,m,1,0);break;case Un:en(p,g,m,v,b);break;case Gn:en(p,g,m,v,b),xn(v,b,m,1,0);break;case zn:rn(p,g,m,v,b);break;default:e(0)}u+=c,h+=f}t.Ma+=o}else alert("todo:EmitRescaledRowsYUVA");e(t.Ma<=n.height)}}t.C=r,e(t.C<=t.i)}function Lt(t){var e;if(0<t.ua)return 0;for(e=0;e<t.Wb;++e){var r=t.Ya[e].G,n=t.Ya[e].H;if(0<r[1][n[1]+0].g||0<r[2][n[2]+0].g||0<r[3][n[3]+0].g)return 0}return 1}function xt(t,r,n,i,a,o){if(0!=t.Z){var s=t.qd,u=t.rd;for(e(null!=mi[t.Z]);r<n;++r)mi[t.Z](s,u,i,a,i,a,o),s=i,u=a,a+=o;t.qd=s,t.rd=u}}function St(t,r){var n=t.l.ma,i=0==n.Z||1==n.Z?t.l.j:t.C;i=t.C<i?i:t.C;if(e(r<=t.l.o),r>i){var a=t.l.width,o=n.ca,s=n.tb+a*i,u=t.V,c=t.Ba+t.c*i,l=t.gc;e(1==t.ab),e(3==l[0].hc),Xr(l[0],i,r,u,c,o,s),xt(n,i,r,o,s,a)}t.C=t.Ma=r}function _t(t,r,n,i,a,o,s){var u=t.$/i,c=t.$%i,l=t.m,h=t.s,f=n+t.$,d=f;a=n+i*a;var p=n+i*o,g=280+h.ua,m=t.Pb?u:16777216,v=0<h.ua?h.Wa:null,b=h.wc,y=f<p?wt(h,c,u):null;e(t.C<o),e(p<=a);var w=!1;t:for(;;){for(;w||f<p;){var N=0;if(u>=m){var _=f-n;e((m=t).Pb),m.wd=m.m,m.xd=_,0<m.s.ua&&B(m.s.Wa,m.s.vb),m=u+ti}if(c&b||(y=wt(h,c,u)),e(null!=y),y.Qb&&(r[f]=y.qb,w=!0),!w)if(S(l),y.jc){N=l,_=r;var P=f,k=y.pd[A(N)&Rr-1];e(y.jc),256>k.g?(x(N,N.u+k.g),_[P]=k.value,N=0):(x(N,N.u+k.g-256),e(256<=k.value),N=k.value),0==N&&(w=!0)}else N=bt(y.G[0],y.H[0],l);if(l.h)break;if(w||256>N){if(!w)if(y.nd)r[f]=(y.qb|N<<8)>>>0;else{if(S(l),w=bt(y.G[1],y.H[1],l),S(l),_=bt(y.G[2],y.H[2],l),P=bt(y.G[3],y.H[3],l),l.h)break;r[f]=(P<<24|w<<16|N<<8|_)>>>0}if(w=!1,++f,++c>=i&&(c=0,++u,null!=s&&u<=o&&!(u%16)&&s(t,u),null!=v))for(;d<f;)N=r[d++],v.X[(506832829*N&4294967295)>>>v.Mb]=N}else if(280>N){if(N=mt(N-256,l),_=bt(y.G[4],y.H[4],l),S(l),_=vt(i,_=mt(_,l)),l.h)break;if(f-n<_||a-f<N)break t;for(P=0;P<N;++P)r[f+P]=r[f+P-_];for(f+=N,c+=N;c>=i;)c-=i,++u,null!=s&&u<=o&&!(u%16)&&s(t,u);if(e(f<=a),c&b&&(y=wt(h,c,u)),null!=v)for(;d<f;)N=r[d++],v.X[(506832829*N&4294967295)>>>v.Mb]=N}else{if(!(N<g))break t;for(w=N-280,e(null!=v);d<f;)N=r[d++],v.X[(506832829*N&4294967295)>>>v.Mb]=N;N=f,e(!(w>>>(_=v).Xa)),r[N]=_.X[w],w=!0}w||e(l.h==L(l))}if(t.Pb&&l.h&&f<a)e(t.m.h),t.a=5,t.m=t.wd,t.$=t.xd,0<t.s.ua&&B(t.s.vb,t.s.Wa);else{if(l.h)break t;null!=s&&s(t,u>o?o:u),t.a=0,t.$=f-n}return 1}return t.a=3,0}function Pt(t){e(null!=t),t.vc=null,t.yc=null,t.Ya=null;var r=t.Wa;null!=r&&(r.X=null),t.vb=null,e(null!=t)}function kt(){var e=new or;return null==e?null:(e.a=0,e.xb=gi,rt("Predictor","VP8LPredictors"),rt("Predictor","VP8LPredictors_C"),rt("PredictorAdd","VP8LPredictorsAdd"),rt("PredictorAdd","VP8LPredictorsAdd_C"),Gr=G,$r=J,Qr=K,tn=Z,en=$,rn=Q,nn=tt,t.VP8LMapColor32b=Jr,t.VP8LMapColor8b=Kr,e)}function Ft(t,r,n,s,u){var c=1,f=[t],p=[r],g=s.m,m=s.s,v=null,b=0;t:for(;;){if(n)for(;c&&y(g,1);){var w=f,N=p,L=s,_=1,P=L.m,k=L.gc[L.ab],F=y(P,2);if(L.Oc&1<<F)c=0;else{switch(L.Oc|=1<<F,k.hc=F,k.Ea=w[0],k.nc=N[0],k.K=[null],++L.ab,e(4>=L.ab),F){case 0:case 1:k.b=y(P,3)+2,_=Ft(q(k.Ea,k.b),q(k.nc,k.b),0,L,k.K),k.K=k.K[0];break;case 3:var I,C=y(P,8)+1,j=16<C?0:4<C?1:2<C?2:3;if(w[0]=q(k.Ea,j),k.b=j,I=_=Ft(C,1,0,L,k.K)){var B,M=C,E=k,T=1<<(8>>E.b),D=a(T);if(null==D)I=0;else{var U=E.K[0],z=E.w;for(D[0]=E.K[0][0],B=1;B<1*M;++B)D[B]=R(U[z+B],D[B-1]);for(;B<4*T;++B)D[B]=0;E.K[0]=null,E.K[0]=D,I=1}}_=I;break;case 2:break;default:e(0)}c=_}}if(f=f[0],p=p[0],c&&y(g,1)&&!(c=1<=(b=y(g,4))&&11>=b)){s.a=3;break t}var H;if(H=c)e:{var W,V,G,Y=s,J=f,X=p,K=b,Z=n,$=Y.m,Q=Y.s,tt=[null],et=1,rt=0,nt=Qn[K];r:for(;;){if(Z&&y($,1)){var it=y($,3)+2,at=q(J,it),ot=q(X,it),st=at*ot;if(!Ft(at,ot,0,Y,tt))break r;for(tt=tt[0],Q.xc=it,W=0;W<st;++W){var ut=tt[W]>>8&65535;tt[W]=ut,ut>=et&&(et=ut+1)}}if($.h)break r;for(V=0;5>V;++V){var ct=Xn[V];!V&&0<K&&(ct+=1<<K),rt<ct&&(rt=ct)}var lt=o(et*nt,h),ht=et,ft=o(ht,d);if(null==ft)var dt=null;else e(65536>=ht),dt=ft;var pt=a(rt);if(null==dt||null==pt||null==lt){Y.a=1;break r}var gt=lt;for(W=G=0;W<et;++W){var mt=dt[W],vt=mt.G,bt=mt.H,wt=0,Nt=1,At=0;for(V=0;5>V;++V){ct=Xn[V],vt[V]=gt,bt[V]=G,!V&&0<K&&(ct+=1<<K);n:{var Lt,xt=ct,St=Y,kt=pt,It=gt,Ct=G,jt=0,Ot=St.m,Bt=y(Ot,1);if(i(kt,0,0,xt),Bt){var Mt=y(Ot,1)+1,Et=y(Ot,1),qt=y(Ot,0==Et?1:8);kt[qt]=1,2==Mt&&(kt[qt=y(Ot,8)]=1);var Rt=1}else{var Tt=a(19),Dt=y(Ot,4)+4;if(19<Dt){St.a=3;var Ut=0;break n}for(Lt=0;Lt<Dt;++Lt)Tt[Zn[Lt]]=y(Ot,3);var zt=void 0,Ht=void 0,Wt=St,Vt=Tt,Gt=xt,Yt=kt,Jt=0,Xt=Wt.m,Kt=8,Zt=o(128,h);i:for(;l(Zt,0,7,Vt,19);){if(y(Xt,1)){var $t=2+2*y(Xt,3);if((zt=2+y(Xt,$t))>Gt)break i}else zt=Gt;for(Ht=0;Ht<Gt&&zt--;){S(Xt);var Qt=Zt[0+(127&A(Xt))];x(Xt,Xt.u+Qt.g);var te=Qt.value;if(16>te)Yt[Ht++]=te,0!=te&&(Kt=te);else{var ee=16==te,re=te-16,ne=Jn[re],ie=y(Xt,Yn[re])+ne;if(Ht+ie>Gt)break i;for(var ae=ee?Kt:0;0<ie--;)Yt[Ht++]=ae}}Jt=1;break i}Jt||(Wt.a=3),Rt=Jt}(Rt=Rt&&!Ot.h)&&(jt=l(It,Ct,8,kt,xt)),Rt&&0!=jt?Ut=jt:(St.a=3,Ut=0)}if(0==Ut)break r;if(Nt&&1==Kn[V]&&(Nt=0==gt[G].g),wt+=gt[G].g,G+=Ut,3>=V){var oe,se=pt[0];for(oe=1;oe<ct;++oe)pt[oe]>se&&(se=pt[oe]);At+=se}}if(mt.nd=Nt,mt.Qb=0,Nt&&(mt.qb=(vt[3][bt[3]+0].value<<24|vt[1][bt[1]+0].value<<16|vt[2][bt[2]+0].value)>>>0,0==wt&&256>vt[0][bt[0]+0].value&&(mt.Qb=1,mt.qb+=vt[0][bt[0]+0].value<<8)),mt.jc=!mt.Qb&&6>At,mt.jc){var ue,ce=mt;for(ue=0;ue<Rr;++ue){var le=ue,he=ce.pd[le],fe=ce.G[0][ce.H[0]+le];256<=fe.value?(he.g=fe.g+256,he.value=fe.value):(he.g=0,he.value=0,le>>=yt(fe,8,he),le>>=yt(ce.G[1][ce.H[1]+le],16,he),le>>=yt(ce.G[2][ce.H[2]+le],0,he),yt(ce.G[3][ce.H[3]+le],24,he))}}}Q.vc=tt,Q.Wb=et,Q.Ya=dt,Q.yc=lt,H=1;break e}H=0}if(!(c=H)){s.a=3;break t}if(0<b){if(m.ua=1<<b,!O(m.Wa,b)){s.a=1,c=0;break t}}else m.ua=0;var de=s,pe=f,ge=p,me=de.s,ve=me.xc;if(de.c=pe,de.i=ge,me.md=q(pe,ve),me.wc=0==ve?-1:(1<<ve)-1,n){s.xb=pi;break t}if(null==(v=a(f*p))){s.a=1,c=0;break t}c=(c=_t(s,v,0,f,p,p,null))&&!g.h;break t}return c?(null!=u?u[0]=v:(e(null==v),e(n)),s.$=0,n||Pt(m)):Pt(m),c}function It(t,r){var n=t.c*t.i,i=n+r+16*r;return e(t.c<=r),t.V=a(i),null==t.V?(t.Ta=null,t.Ua=0,t.a=1,0):(t.Ta=t.V,t.Ua=t.Ba+n+r,1)}function Ct(t,r){var n=t.C,i=r-n,a=t.V,o=t.Ba+t.c*n;for(e(r<=t.l.o);0<i;){var s=16<i?16:i,u=t.l.ma,c=t.l.width,l=c*s,h=u.ca,f=u.tb+c*n,d=t.Ta,p=t.Ua;Nt(t,s,a,o),_n(d,p,h,f,l),xt(u,n,n+s,h,f,c),i-=s,a+=s*t.c,n+=s}e(n==r),t.C=t.Ma=r}function jt(){this.ub=this.yd=this.td=this.Rb=0}function Ot(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Bt(){this.Fb=this.Bb=this.Cb=0,this.Zb=a(4),this.Lb=a(4)}function Mt(){this.Yb=function(){var t=[];return function t(e,r,n){for(var i=n[r],a=0;a<i&&(e.push(n.length>r+1?[]:0),!(n.length<r+1));a++)t(e[a],r+1,n)}(t,0,[3,11]),t}()}function Et(){this.jb=a(3),this.Wc=s([4,8],Mt),this.Xc=s([4,17],Mt)}function qt(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new a(4),this.od=new a(4)}function Rt(){this.ld=this.La=this.dd=this.tc=0}function Tt(){this.Na=this.la=0}function Dt(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Ut(){this.ad=a(384),this.Za=0,this.Ob=a(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function zt(){this.uc=this.M=this.Nb=0,this.wa=Array(new Rt),this.Y=0,this.ya=Array(new Ut),this.aa=0,this.l=new Gt}function Ht(){this.y=a(16),this.f=a(8),this.ea=a(8)}function Wt(){this.cb=this.a=0,this.sc="",this.m=new w,this.Od=new jt,this.Kc=new Ot,this.ed=new qt,this.Qa=new Bt,this.Ic=this.$c=this.Aa=0,this.D=new zt,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=o(8,w),this.ia=0,this.pb=o(4,Dt),this.Pa=new Et,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Ht),this.Hd=0,this.rb=Array(new Tt),this.sb=0,this.wa=Array(new Rt),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Ut),this.L=this.aa=0,this.gd=s([4,2],Rt),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function Vt(t,e){return 0>t?0:t>e?e:t}function Gt(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Yt(){var t=new Wt;return null!=t&&(t.a=0,t.sc="OK",t.cb=0,t.Xb=0,ni||(ni=Zt)),t}function Jt(t,e,r){return 0==t.a&&(t.a=e,t.sc=r,t.cb=0),0}function Xt(t,e,r){return 3<=r&&157==t[e+0]&&1==t[e+1]&&42==t[e+2]}function Kt(t,r){if(null==t)return 0;if(t.a=0,t.sc="OK",null==r)return Jt(t,2,"null VP8Io passed to VP8GetHeaders()");var n=r.data,a=r.w,o=r.ha;if(4>o)return Jt(t,7,"Truncated header.");var s=n[a+0]|n[a+1]<<8|n[a+2]<<16,u=t.Od;if(u.Rb=!(1&s),u.td=s>>1&7,u.yd=s>>4&1,u.ub=s>>5,3<u.td)return Jt(t,3,"Incorrect keyframe parameters.");if(!u.yd)return Jt(t,4,"Frame not displayable.");a+=3,o-=3;var c=t.Kc;if(u.Rb){if(7>o)return Jt(t,7,"cannot parse picture header");if(!Xt(n,a,o))return Jt(t,3,"Bad code word");c.c=16383&(n[a+4]<<8|n[a+3]),c.Td=n[a+4]>>6,c.i=16383&(n[a+6]<<8|n[a+5]),c.Ud=n[a+6]>>6,a+=7,o-=7,t.za=c.c+15>>4,t.Ub=c.i+15>>4,r.width=c.c,r.height=c.i,r.Da=0,r.j=0,r.v=0,r.va=r.width,r.o=r.height,r.da=0,r.ib=r.width,r.hb=r.height,r.U=r.width,r.T=r.height,i((s=t.Pa).jb,0,255,s.jb.length),e(null!=(s=t.Qa)),s.Cb=0,s.Bb=0,s.Fb=1,i(s.Zb,0,0,s.Zb.length),i(s.Lb,0,0,s.Lb)}if(u.ub>o)return Jt(t,7,"bad partition length");p(s=t.m,n,a,u.ub),a+=u.ub,o-=u.ub,u.Rb&&(c.Ld=P(s),c.Kd=P(s)),c=t.Qa;var l,h=t.Pa;if(e(null!=s),e(null!=c),c.Cb=P(s),c.Cb){if(c.Bb=P(s),P(s)){for(c.Fb=P(s),l=0;4>l;++l)c.Zb[l]=P(s)?m(s,7):0;for(l=0;4>l;++l)c.Lb[l]=P(s)?m(s,6):0}if(c.Bb)for(l=0;3>l;++l)h.jb[l]=P(s)?g(s,8):255}else c.Bb=0;if(s.Ka)return Jt(t,3,"cannot parse segment header");if((c=t.ed).zd=P(s),c.Tb=g(s,6),c.wb=g(s,3),c.Pc=P(s),c.Pc&&P(s)){for(h=0;4>h;++h)P(s)&&(c.vd[h]=m(s,6));for(h=0;4>h;++h)P(s)&&(c.od[h]=m(s,6))}if(t.L=0==c.Tb?0:c.zd?1:2,s.Ka)return Jt(t,3,"cannot parse filter header");var f=o;if(o=l=a,a=l+f,c=f,t.Xb=(1<<g(t.m,2))-1,f<3*(h=t.Xb))n=7;else{for(l+=3*h,c-=3*h,f=0;f<h;++f){var d=n[o+0]|n[o+1]<<8|n[o+2]<<16;d>c&&(d=c),p(t.Jc[+f],n,l,d),l+=d,c-=d,o+=3}p(t.Jc[+h],n,l,c),n=l<a?0:5}if(0!=n)return Jt(t,n,"cannot parse partitions");for(n=g(l=t.m,7),o=P(l)?m(l,4):0,a=P(l)?m(l,4):0,c=P(l)?m(l,4):0,h=P(l)?m(l,4):0,l=P(l)?m(l,4):0,f=t.Qa,d=0;4>d;++d){if(f.Cb){var v=f.Zb[d];f.Fb||(v+=n)}else{if(0<d){t.pb[d]=t.pb[0];continue}v=n}var b=t.pb[d];b.Sc[0]=ei[Vt(v+o,127)],b.Sc[1]=ri[Vt(v+0,127)],b.Eb[0]=2*ei[Vt(v+a,127)],b.Eb[1]=101581*ri[Vt(v+c,127)]>>16,8>b.Eb[1]&&(b.Eb[1]=8),b.Qc[0]=ei[Vt(v+h,117)],b.Qc[1]=ri[Vt(v+l,127)],b.lc=v+l}if(!u.Rb)return Jt(t,4,"Not a key frame.");for(P(s),u=t.Pa,n=0;4>n;++n){for(o=0;8>o;++o)for(a=0;3>a;++a)for(c=0;11>c;++c)h=k(s,ci[n][o][a][c])?g(s,8):si[n][o][a][c],u.Wc[n][o].Yb[a][c]=h;for(o=0;17>o;++o)u.Xc[n][o]=u.Wc[n][li[o]]}return t.kc=P(s),t.kc&&(t.Bd=g(s,8)),t.cb=1}function Zt(t,e,r,n,i,a,o){var s=e[i].Yb[r];for(r=0;16>i;++i){if(!k(t,s[r+0]))return i;for(;!k(t,s[r+1]);)if(s=e[++i].Yb[0],r=0,16==i)return 16;var u=e[i+1].Yb;if(k(t,s[r+2])){var c=t,l=0;if(k(c,(f=s)[(h=r)+3]))if(k(c,f[h+6])){for(s=0,h=2*(l=k(c,f[h+8]))+(f=k(c,f[h+9+l])),l=0,f=ii[h];f[s];++s)l+=l+k(c,f[s]);l+=3+(8<<h)}else k(c,f[h+7])?(l=7+2*k(c,165),l+=k(c,145)):l=5+k(c,159);else l=k(c,f[h+4])?3+k(c,f[h+5]):2;s=u[2]}else l=1,s=u[1];u=o+ai[i],0>(c=t).b&&_(c);var h,f=c.b,d=(h=c.Ca>>1)-(c.I>>f)>>31;--c.b,c.Ca+=d,c.Ca|=1,c.I-=(h+1&d)<<f,a[u]=((l^d)-d)*n[(0<i)+0]}return 16}function $t(t){var e=t.rb[t.sb-1];e.la=0,e.Na=0,i(t.zc,0,0,t.zc.length),t.ja=0}function Qt(t,r){if(null==t)return 0;if(null==r)return Jt(t,2,"NULL VP8Io parameter in VP8Decode().");if(!t.cb&&!Kt(t,r))return 0;if(e(t.cb),null==r.ac||r.ac(r)){r.ob&&(t.L=0);var s=Ti[t.L];if(2==t.L?(t.yb=0,t.zb=0):(t.yb=r.v-s>>4,t.zb=r.j-s>>4,0>t.yb&&(t.yb=0),0>t.zb&&(t.zb=0)),t.Va=r.o+15+s>>4,t.Hb=r.va+15+s>>4,t.Hb>t.za&&(t.Hb=t.za),t.Va>t.Ub&&(t.Va=t.Ub),0<t.L){var u=t.ed;for(s=0;4>s;++s){var c;if(t.Qa.Cb){var l=t.Qa.Lb[s];t.Qa.Fb||(l+=u.Tb)}else l=u.Tb;for(c=0;1>=c;++c){var h=t.gd[s][c],f=l;if(u.Pc&&(f+=u.vd[0],c&&(f+=u.od[0])),0<(f=0>f?0:63<f?63:f)){var d=f;0<u.wb&&((d=4<u.wb?d>>2:d>>1)>9-u.wb&&(d=9-u.wb)),1>d&&(d=1),h.dd=d,h.tc=2*f+d,h.ld=40<=f?2:15<=f?1:0}else h.tc=0;h.La=c}}}s=0}else Jt(t,6,"Frame setup failed"),s=t.a;if(s=0==s){if(s){t.$c=0,0<t.Aa||(t.Ic=Ui);t:{s=t.Ic;u=4*(d=t.za);var p=32*d,g=d+1,m=0<t.L?d*(0<t.Aa?2:1):0,v=(2==t.Aa?2:1)*d;if((h=u+832+(c=3*(16*s+Ti[t.L])/2*p)+(l=null!=t.Fa&&0<t.Fa.length?t.Kc.c*t.Kc.i:0))!=h)s=0;else{if(h>t.Vb){if(t.Vb=0,t.Ec=a(h),t.Fc=0,null==t.Ec){s=Jt(t,1,"no memory during frame initialization.");break t}t.Vb=h}h=t.Ec,f=t.Fc,t.Ac=h,t.Bc=f,f+=u,t.Gd=o(p,Ht),t.Hd=0,t.rb=o(g+1,Tt),t.sb=1,t.wa=m?o(m,Rt):null,t.Y=0,t.D.Nb=0,t.D.wa=t.wa,t.D.Y=t.Y,0<t.Aa&&(t.D.Y+=d),e(!0),t.oc=h,t.pc=f,f+=832,t.ya=o(v,Ut),t.aa=0,t.D.ya=t.ya,t.D.aa=t.aa,2==t.Aa&&(t.D.aa+=d),t.R=16*d,t.B=8*d,d=(p=Ti[t.L])*t.R,p=p/2*t.B,t.sa=h,t.ta=f+d,t.qa=t.sa,t.ra=t.ta+16*s*t.R+p,t.Ha=t.qa,t.Ia=t.ra+8*s*t.B+p,t.$c=0,f+=c,t.mb=l?h:null,t.nb=l?f:null,e(f+l<=t.Fc+t.Vb),$t(t),i(t.Ac,t.Bc,0,u),s=1}}if(s){if(r.ka=0,r.y=t.sa,r.O=t.ta,r.f=t.qa,r.N=t.ra,r.ea=t.Ha,r.Vd=t.Ia,r.fa=t.R,r.Rc=t.B,r.F=null,r.J=0,!Cn){for(s=-255;255>=s;++s)Pn[255+s]=0>s?-s:s;for(s=-1020;1020>=s;++s)kn[1020+s]=-128>s?-128:127<s?127:s;for(s=-112;112>=s;++s)Fn[112+s]=-16>s?-16:15<s?15:s;for(s=-255;510>=s;++s)In[255+s]=0>s?0:255<s?255:s;Cn=1}an=ce,on=ae,un=oe,cn=se,ln=ue,sn=ie,hn=Je,fn=Xe,dn=$e,pn=Qe,gn=Ke,mn=Ze,vn=tr,bn=er,yn=ze,wn=He,Nn=We,An=Ve,fi[0]=xe,fi[1]=he,fi[2]=Ae,fi[3]=Le,fi[4]=Se,fi[5]=Pe,fi[6]=_e,fi[7]=ke,fi[8]=Ie,fi[9]=Fe,hi[0]=ve,hi[1]=de,hi[2]=pe,hi[3]=ge,hi[4]=be,hi[5]=ye,hi[6]=we,di[0]=Be,di[1]=fe,di[2]=Ce,di[3]=je,di[4]=Ee,di[5]=Me,di[6]=qe,s=1}else s=0}s&&(s=function(t,r){for(t.M=0;t.M<t.Va;++t.M){var o,s=t.Jc[t.M&t.Xb],u=t.m,c=t;for(o=0;o<c.za;++o){var l=u,h=c,f=h.Ac,d=h.Bc+4*o,p=h.zc,g=h.ya[h.aa+o];if(h.Qa.Bb?g.$b=k(l,h.Pa.jb[0])?2+k(l,h.Pa.jb[2]):k(l,h.Pa.jb[1]):g.$b=0,h.kc&&(g.Ad=k(l,h.Bd)),g.Za=!k(l,145)+0,g.Za){var m=g.Ob,v=0;for(h=0;4>h;++h){var b,y=p[0+h];for(b=0;4>b;++b){y=ui[f[d+b]][y];for(var w=oi[k(l,y[0])];0<w;)w=oi[2*w+k(l,y[w])];y=-w,f[d+b]=y}n(m,v,f,d,4),v+=4,p[0+h]=y}}else y=k(l,156)?k(l,128)?1:3:k(l,163)?2:0,g.Ob[0]=y,i(f,d,y,4),i(p,0,y,4);g.Dd=k(l,142)?k(l,114)?k(l,183)?1:3:2:0}if(c.m.Ka)return Jt(t,7,"Premature end-of-partition0 encountered.");for(;t.ja<t.za;++t.ja){if(c=s,l=(u=t).rb[u.sb-1],f=u.rb[u.sb+u.ja],o=u.ya[u.aa+u.ja],d=u.kc?o.Ad:0)l.la=f.la=0,o.Za||(l.Na=f.Na=0),o.Hc=0,o.Gc=0,o.ia=0;else{var N,A;l=f,f=c,d=u.Pa.Xc,p=u.ya[u.aa+u.ja],g=u.pb[p.$b];if(h=p.ad,m=0,v=u.rb[u.sb-1],y=b=0,i(h,m,0,384),p.Za)var L=0,x=d[3];else{w=a(16);var S=l.Na+v.Na;if(S=ni(f,d[1],S,g.Eb,0,w,0),l.Na=v.Na=(0<S)+0,1<S)an(w,0,h,m);else{var _=w[0]+3>>3;for(w=0;256>w;w+=16)h[m+w]=_}L=1,x=d[0]}var P=15&l.la,F=15&v.la;for(w=0;4>w;++w){var I=1&F;for(_=A=0;4>_;++_)P=P>>1|(I=(S=ni(f,x,S=I+(1&P),g.Sc,L,h,m))>L)<<7,A=A<<2|(3<S?3:1<S?2:0!=h[m+0]),m+=16;P>>=4,F=F>>1|I<<7,b=(b<<8|A)>>>0}for(x=P,L=F>>4,N=0;4>N;N+=2){for(A=0,P=l.la>>4+N,F=v.la>>4+N,w=0;2>w;++w){for(I=1&F,_=0;2>_;++_)S=I+(1&P),P=P>>1|(I=0<(S=ni(f,d[2],S,g.Qc,0,h,m)))<<3,A=A<<2|(3<S?3:1<S?2:0!=h[m+0]),m+=16;P>>=2,F=F>>1|I<<5}y|=A<<4*N,x|=P<<4<<N,L|=(240&F)<<N}l.la=x,v.la=L,p.Hc=b,p.Gc=y,p.ia=43690&y?0:g.ia,d=!(b|y)}if(0<u.L&&(u.wa[u.Y+u.ja]=u.gd[o.$b][o.Za],u.wa[u.Y+u.ja].La|=!d),c.Ka)return Jt(t,7,"Premature end-of-file encountered.")}if($t(t),u=r,c=1,o=(s=t).D,l=0<s.L&&s.M>=s.zb&&s.M<=s.Va,0==s.Aa)t:{if(o.M=s.M,o.uc=l,Or(s,o),c=1,o=(A=s.D).Nb,l=(y=Ti[s.L])*s.R,f=y/2*s.B,w=16*o*s.R,_=8*o*s.B,d=s.sa,p=s.ta-l+w,g=s.qa,h=s.ra-f+_,m=s.Ha,v=s.Ia-f+_,F=0==(P=A.M),b=P>=s.Va-1,2==s.Aa&&Or(s,A),A.uc)for(I=(S=s).D.M,e(S.D.uc),A=S.yb;A<S.Hb;++A){L=A,x=I;var C=(j=(U=S).D).Nb;N=U.R;var j=j.wa[j.Y+L],O=U.sa,B=U.ta+16*C*N+16*L,M=j.dd,E=j.tc;if(0!=E)if(e(3<=E),1==U.L)0<L&&wn(O,B,N,E+4),j.La&&An(O,B,N,E),0<x&&yn(O,B,N,E+4),j.La&&Nn(O,B,N,E);else{var q=U.B,R=U.qa,T=U.ra+8*C*q+8*L,D=U.Ha,U=U.Ia+8*C*q+8*L;C=j.ld;0<L&&(fn(O,B,N,E+4,M,C),pn(R,T,D,U,q,E+4,M,C)),j.La&&(mn(O,B,N,E,M,C),bn(R,T,D,U,q,E,M,C)),0<x&&(hn(O,B,N,E+4,M,C),dn(R,T,D,U,q,E+4,M,C)),j.La&&(gn(O,B,N,E,M,C),vn(R,T,D,U,q,E,M,C))}}if(s.ia&&alert("todo:DitherRow"),null!=u.put){if(A=16*P,P=16*(P+1),F?(u.y=s.sa,u.O=s.ta+w,u.f=s.qa,u.N=s.ra+_,u.ea=s.Ha,u.W=s.Ia+_):(A-=y,u.y=d,u.O=p,u.f=g,u.N=h,u.ea=m,u.W=v),b||(P-=y),P>u.o&&(P=u.o),u.F=null,u.J=null,null!=s.Fa&&0<s.Fa.length&&A<P&&(u.J=hr(s,u,A,P-A),u.F=s.mb,null==u.F&&0==u.F.length)){c=Jt(s,3,"Could not decode alpha data.");break t}A<u.j&&(y=u.j-A,A=u.j,e(!(1&y)),u.O+=s.R*y,u.N+=s.B*(y>>1),u.W+=s.B*(y>>1),null!=u.F&&(u.J+=u.width*y)),A<P&&(u.O+=u.v,u.N+=u.v>>1,u.W+=u.v>>1,null!=u.F&&(u.J+=u.v),u.ka=A-u.j,u.U=u.va-u.v,u.T=P-A,c=u.put(u))}o+1!=s.Ic||b||(n(s.sa,s.ta-l,d,p+16*s.R,l),n(s.qa,s.ra-f,g,h+8*s.B,f),n(s.Ha,s.Ia-f,m,v+8*s.B,f))}if(!c)return Jt(t,6,"Output aborted.")}return 1}(t,r)),null!=r.bc&&r.bc(r),s&=1}return s?(t.cb=0,s):0}function te(t,e,r,n,i){i=t[e+r+32*n]+(i>>3),t[e+r+32*n]=-256&i?0>i?0:255:i}function ee(t,e,r,n,i,a){te(t,e,0,r,n+i),te(t,e,1,r,n+a),te(t,e,2,r,n-a),te(t,e,3,r,n-i)}function re(t){return(20091*t>>16)+t}function ne(t,e,r,n){var i,o=0,s=a(16);for(i=0;4>i;++i){var u=t[e+0]+t[e+8],c=t[e+0]-t[e+8],l=(35468*t[e+4]>>16)-re(t[e+12]),h=re(t[e+4])+(35468*t[e+12]>>16);s[o+0]=u+h,s[o+1]=c+l,s[o+2]=c-l,s[o+3]=u-h,o+=4,e++}for(i=o=0;4>i;++i)u=(t=s[o+0]+4)+s[o+8],c=t-s[o+8],l=(35468*s[o+4]>>16)-re(s[o+12]),te(r,n,0,0,u+(h=re(s[o+4])+(35468*s[o+12]>>16))),te(r,n,1,0,c+l),te(r,n,2,0,c-l),te(r,n,3,0,u-h),o++,n+=32}function ie(t,e,r,n){var i=t[e+0]+4,a=35468*t[e+4]>>16,o=re(t[e+4]),s=35468*t[e+1]>>16;ee(r,n,0,i+o,t=re(t[e+1]),s),ee(r,n,1,i+a,t,s),ee(r,n,2,i-a,t,s),ee(r,n,3,i-o,t,s)}function ae(t,e,r,n,i){ne(t,e,r,n),i&&ne(t,e+16,r,n+4)}function oe(t,e,r,n){on(t,e+0,r,n,1),on(t,e+32,r,n+128,1)}function se(t,e,r,n){var i;for(t=t[e+0]+4,i=0;4>i;++i)for(e=0;4>e;++e)te(r,n,e,i,t)}function ue(t,e,r,n){t[e+0]&&cn(t,e+0,r,n),t[e+16]&&cn(t,e+16,r,n+4),t[e+32]&&cn(t,e+32,r,n+128),t[e+48]&&cn(t,e+48,r,n+128+4)}function ce(t,e,r,n){var i,o=a(16);for(i=0;4>i;++i){var s=t[e+0+i]+t[e+12+i],u=t[e+4+i]+t[e+8+i],c=t[e+4+i]-t[e+8+i],l=t[e+0+i]-t[e+12+i];o[0+i]=s+u,o[8+i]=s-u,o[4+i]=l+c,o[12+i]=l-c}for(i=0;4>i;++i)s=(t=o[0+4*i]+3)+o[3+4*i],u=o[1+4*i]+o[2+4*i],c=o[1+4*i]-o[2+4*i],l=t-o[3+4*i],r[n+0]=s+u>>3,r[n+16]=l+c>>3,r[n+32]=s-u>>3,r[n+48]=l-c>>3,n+=64}function le(t,e,r){var n,i=e-32,a=Bn,o=255-t[i-1];for(n=0;n<r;++n){var s,u=a,c=o+t[e-1];for(s=0;s<r;++s)t[e+s]=u[c+t[i+s]];e+=32}}function he(t,e){le(t,e,4)}function fe(t,e){le(t,e,8)}function de(t,e){le(t,e,16)}function pe(t,e){var r;for(r=0;16>r;++r)n(t,e+32*r,t,e-32,16)}function ge(t,e){var r;for(r=16;0<r;--r)i(t,e,t[e-1],16),e+=32}function me(t,e,r){var n;for(n=0;16>n;++n)i(e,r+32*n,t,16)}function ve(t,e){var r,n=16;for(r=0;16>r;++r)n+=t[e-1+32*r]+t[e+r-32];me(n>>5,t,e)}function be(t,e){var r,n=8;for(r=0;16>r;++r)n+=t[e-1+32*r];me(n>>4,t,e)}function ye(t,e){var r,n=8;for(r=0;16>r;++r)n+=t[e+r-32];me(n>>4,t,e)}function we(t,e){me(128,t,e)}function Ne(t,e,r){return t+2*e+r+2>>2}function Ae(t,e){var r,i=e-32;i=new Uint8Array([Ne(t[i-1],t[i+0],t[i+1]),Ne(t[i+0],t[i+1],t[i+2]),Ne(t[i+1],t[i+2],t[i+3]),Ne(t[i+2],t[i+3],t[i+4])]);for(r=0;4>r;++r)n(t,e+32*r,i,0,i.length)}function Le(t,e){var r=t[e-1],n=t[e-1+32],i=t[e-1+64],a=t[e-1+96];F(t,e+0,16843009*Ne(t[e-1-32],r,n)),F(t,e+32,16843009*Ne(r,n,i)),F(t,e+64,16843009*Ne(n,i,a)),F(t,e+96,16843009*Ne(i,a,a))}function xe(t,e){var r,n=4;for(r=0;4>r;++r)n+=t[e+r-32]+t[e-1+32*r];for(n>>=3,r=0;4>r;++r)i(t,e+32*r,n,4)}function Se(t,e){var r=t[e-1+0],n=t[e-1+32],i=t[e-1+64],a=t[e-1-32],o=t[e+0-32],s=t[e+1-32],u=t[e+2-32],c=t[e+3-32];t[e+0+96]=Ne(n,i,t[e-1+96]),t[e+1+96]=t[e+0+64]=Ne(r,n,i),t[e+2+96]=t[e+1+64]=t[e+0+32]=Ne(a,r,n),t[e+3+96]=t[e+2+64]=t[e+1+32]=t[e+0+0]=Ne(o,a,r),t[e+3+64]=t[e+2+32]=t[e+1+0]=Ne(s,o,a),t[e+3+32]=t[e+2+0]=Ne(u,s,o),t[e+3+0]=Ne(c,u,s)}function _e(t,e){var r=t[e+1-32],n=t[e+2-32],i=t[e+3-32],a=t[e+4-32],o=t[e+5-32],s=t[e+6-32],u=t[e+7-32];t[e+0+0]=Ne(t[e+0-32],r,n),t[e+1+0]=t[e+0+32]=Ne(r,n,i),t[e+2+0]=t[e+1+32]=t[e+0+64]=Ne(n,i,a),t[e+3+0]=t[e+2+32]=t[e+1+64]=t[e+0+96]=Ne(i,a,o),t[e+3+32]=t[e+2+64]=t[e+1+96]=Ne(a,o,s),t[e+3+64]=t[e+2+96]=Ne(o,s,u),t[e+3+96]=Ne(s,u,u)}function Pe(t,e){var r=t[e-1+0],n=t[e-1+32],i=t[e-1+64],a=t[e-1-32],o=t[e+0-32],s=t[e+1-32],u=t[e+2-32],c=t[e+3-32];t[e+0+0]=t[e+1+64]=a+o+1>>1,t[e+1+0]=t[e+2+64]=o+s+1>>1,t[e+2+0]=t[e+3+64]=s+u+1>>1,t[e+3+0]=u+c+1>>1,t[e+0+96]=Ne(i,n,r),t[e+0+64]=Ne(n,r,a),t[e+0+32]=t[e+1+96]=Ne(r,a,o),t[e+1+32]=t[e+2+96]=Ne(a,o,s),t[e+2+32]=t[e+3+96]=Ne(o,s,u),t[e+3+32]=Ne(s,u,c)}function ke(t,e){var r=t[e+0-32],n=t[e+1-32],i=t[e+2-32],a=t[e+3-32],o=t[e+4-32],s=t[e+5-32],u=t[e+6-32],c=t[e+7-32];t[e+0+0]=r+n+1>>1,t[e+1+0]=t[e+0+64]=n+i+1>>1,t[e+2+0]=t[e+1+64]=i+a+1>>1,t[e+3+0]=t[e+2+64]=a+o+1>>1,t[e+0+32]=Ne(r,n,i),t[e+1+32]=t[e+0+96]=Ne(n,i,a),t[e+2+32]=t[e+1+96]=Ne(i,a,o),t[e+3+32]=t[e+2+96]=Ne(a,o,s),t[e+3+64]=Ne(o,s,u),t[e+3+96]=Ne(s,u,c)}function Fe(t,e){var r=t[e-1+0],n=t[e-1+32],i=t[e-1+64],a=t[e-1+96];t[e+0+0]=r+n+1>>1,t[e+2+0]=t[e+0+32]=n+i+1>>1,t[e+2+32]=t[e+0+64]=i+a+1>>1,t[e+1+0]=Ne(r,n,i),t[e+3+0]=t[e+1+32]=Ne(n,i,a),t[e+3+32]=t[e+1+64]=Ne(i,a,a),t[e+3+64]=t[e+2+64]=t[e+0+96]=t[e+1+96]=t[e+2+96]=t[e+3+96]=a}function Ie(t,e){var r=t[e-1+0],n=t[e-1+32],i=t[e-1+64],a=t[e-1+96],o=t[e-1-32],s=t[e+0-32],u=t[e+1-32],c=t[e+2-32];t[e+0+0]=t[e+2+32]=r+o+1>>1,t[e+0+32]=t[e+2+64]=n+r+1>>1,t[e+0+64]=t[e+2+96]=i+n+1>>1,t[e+0+96]=a+i+1>>1,t[e+3+0]=Ne(s,u,c),t[e+2+0]=Ne(o,s,u),t[e+1+0]=t[e+3+32]=Ne(r,o,s),t[e+1+32]=t[e+3+64]=Ne(n,r,o),t[e+1+64]=t[e+3+96]=Ne(i,n,r),t[e+1+96]=Ne(a,i,n)}function Ce(t,e){var r;for(r=0;8>r;++r)n(t,e+32*r,t,e-32,8)}function je(t,e){var r;for(r=0;8>r;++r)i(t,e,t[e-1],8),e+=32}function Oe(t,e,r){var n;for(n=0;8>n;++n)i(e,r+32*n,t,8)}function Be(t,e){var r,n=8;for(r=0;8>r;++r)n+=t[e+r-32]+t[e-1+32*r];Oe(n>>4,t,e)}function Me(t,e){var r,n=4;for(r=0;8>r;++r)n+=t[e+r-32];Oe(n>>3,t,e)}function Ee(t,e){var r,n=4;for(r=0;8>r;++r)n+=t[e-1+32*r];Oe(n>>3,t,e)}function qe(t,e){Oe(128,t,e)}function Re(t,e,r){var n=t[e-r],i=t[e+0],a=3*(i-n)+jn[1020+t[e-2*r]-t[e+r]],o=On[112+(a+4>>3)];t[e-r]=Bn[255+n+On[112+(a+3>>3)]],t[e+0]=Bn[255+i-o]}function Te(t,e,r,n){var i=t[e+0],a=t[e+r];return Mn[255+t[e-2*r]-t[e-r]]>n||Mn[255+a-i]>n}function De(t,e,r,n){return 4*Mn[255+t[e-r]-t[e+0]]+Mn[255+t[e-2*r]-t[e+r]]<=n}function Ue(t,e,r,n,i){var a=t[e-3*r],o=t[e-2*r],s=t[e-r],u=t[e+0],c=t[e+r],l=t[e+2*r],h=t[e+3*r];return 4*Mn[255+s-u]+Mn[255+o-c]>n?0:Mn[255+t[e-4*r]-a]<=i&&Mn[255+a-o]<=i&&Mn[255+o-s]<=i&&Mn[255+h-l]<=i&&Mn[255+l-c]<=i&&Mn[255+c-u]<=i}function ze(t,e,r,n){var i=2*n+1;for(n=0;16>n;++n)De(t,e+n,r,i)&&Re(t,e+n,r)}function He(t,e,r,n){var i=2*n+1;for(n=0;16>n;++n)De(t,e+n*r,1,i)&&Re(t,e+n*r,1)}function We(t,e,r,n){var i;for(i=3;0<i;--i)ze(t,e+=4*r,r,n)}function Ve(t,e,r,n){var i;for(i=3;0<i;--i)He(t,e+=4,r,n)}function Ge(t,e,r,n,i,a,o,s){for(a=2*a+1;0<i--;){if(Ue(t,e,r,a,o))if(Te(t,e,r,s))Re(t,e,r);else{var u=t,c=e,l=r,h=u[c-2*l],f=u[c-l],d=u[c+0],p=u[c+l],g=u[c+2*l],m=27*(b=jn[1020+3*(d-f)+jn[1020+h-p]])+63>>7,v=18*b+63>>7,b=9*b+63>>7;u[c-3*l]=Bn[255+u[c-3*l]+b],u[c-2*l]=Bn[255+h+v],u[c-l]=Bn[255+f+m],u[c+0]=Bn[255+d-m],u[c+l]=Bn[255+p-v],u[c+2*l]=Bn[255+g-b]}e+=n}}function Ye(t,e,r,n,i,a,o,s){for(a=2*a+1;0<i--;){if(Ue(t,e,r,a,o))if(Te(t,e,r,s))Re(t,e,r);else{var u=t,c=e,l=r,h=u[c-l],f=u[c+0],d=u[c+l],p=On[112+((g=3*(f-h))+4>>3)],g=On[112+(g+3>>3)],m=p+1>>1;u[c-2*l]=Bn[255+u[c-2*l]+m],u[c-l]=Bn[255+h+g],u[c+0]=Bn[255+f-p],u[c+l]=Bn[255+d-m]}e+=n}}function Je(t,e,r,n,i,a){Ge(t,e,r,1,16,n,i,a)}function Xe(t,e,r,n,i,a){Ge(t,e,1,r,16,n,i,a)}function Ke(t,e,r,n,i,a){var o;for(o=3;0<o;--o)Ye(t,e+=4*r,r,1,16,n,i,a)}function Ze(t,e,r,n,i,a){var o;for(o=3;0<o;--o)Ye(t,e+=4,1,r,16,n,i,a)}function $e(t,e,r,n,i,a,o,s){Ge(t,e,i,1,8,a,o,s),Ge(r,n,i,1,8,a,o,s)}function Qe(t,e,r,n,i,a,o,s){Ge(t,e,1,i,8,a,o,s),Ge(r,n,1,i,8,a,o,s)}function tr(t,e,r,n,i,a,o,s){Ye(t,e+4*i,i,1,8,a,o,s),Ye(r,n+4*i,i,1,8,a,o,s)}function er(t,e,r,n,i,a,o,s){Ye(t,e+4,1,i,8,a,o,s),Ye(r,n+4,1,i,8,a,o,s)}function rr(){this.ba=new ot,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new ut,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function nr(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function ir(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function ar(){this.ua=0,this.Wa=new M,this.vb=new M,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new d,this.yc=new h}function or(){this.xb=this.a=0,this.l=new Gt,this.ca=new ot,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new N,this.Pb=0,this.wd=new N,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new ar,this.ab=0,this.gc=o(4,ir),this.Oc=0}function sr(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Gt,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function ur(t,e,r,n,i,a,o){for(t=null==t?0:t[e+0],e=0;e<o;++e)i[a+e]=t+r[n+e]&255,t=i[a+e]}function cr(t,e,r,n,i,a,o){var s;if(null==t)ur(null,null,r,n,i,a,o);else for(s=0;s<o;++s)i[a+s]=t[e+s]+r[n+s]&255}function lr(t,e,r,n,i,a,o){if(null==t)ur(null,null,r,n,i,a,o);else{var s,u=t[e+0],c=u,l=u;for(s=0;s<o;++s)c=l+(u=t[e+s])-c,l=r[n+s]+(-256&c?0>c?0:255:c)&255,c=u,i[a+s]=l}}function hr(t,r,i,o){var s=r.width,u=r.o;if(e(null!=t&&null!=r),0>i||0>=o||i+o>u)return null;if(!t.Cc){if(null==t.ga){var c;if(t.ga=new sr,(c=null==t.ga)||(c=r.width*r.o,e(0==t.Gb.length),t.Gb=a(c),t.Uc=0,null==t.Gb?c=0:(t.mb=t.Gb,t.nb=t.Uc,t.rc=null,c=1),c=!c),!c){c=t.ga;var l=t.Fa,h=t.P,f=t.qc,d=t.mb,p=t.nb,g=h+1,m=f-1,b=c.l;if(e(null!=l&&null!=d&&null!=r),mi[0]=null,mi[1]=ur,mi[2]=cr,mi[3]=lr,c.ca=d,c.tb=p,c.c=r.width,c.i=r.height,e(0<c.c&&0<c.i),1>=f)r=0;else if(c.$a=l[h+0]>>0&3,c.Z=l[h+0]>>2&3,c.Lc=l[h+0]>>4&3,h=l[h+0]>>6&3,0>c.$a||1<c.$a||4<=c.Z||1<c.Lc||h)r=0;else if(b.put=dt,b.ac=ft,b.bc=pt,b.ma=c,b.width=r.width,b.height=r.height,b.Da=r.Da,b.v=r.v,b.va=r.va,b.j=r.j,b.o=r.o,c.$a)t:{e(1==c.$a),r=kt();e:for(;;){if(null==r){r=0;break t}if(e(null!=c),c.mc=r,r.c=c.c,r.i=c.i,r.l=c.l,r.l.ma=c,r.l.width=c.c,r.l.height=c.i,r.a=0,v(r.m,l,g,m),!Ft(c.c,c.i,1,r,null))break e;if(1==r.ab&&3==r.gc[0].hc&&Lt(r.s)?(c.ic=1,l=r.c*r.i,r.Ta=null,r.Ua=0,r.V=a(l),r.Ba=0,null==r.V?(r.a=1,r=0):r=1):(c.ic=0,r=It(r,c.c)),!r)break e;r=1;break t}c.mc=null,r=0}else r=m>=c.c*c.i;c=!r}if(c)return null;1!=t.ga.Lc?t.Ga=0:o=u-i}e(null!=t.ga),e(i+o<=u);t:{if(r=(l=t.ga).c,u=l.l.o,0==l.$a){if(g=t.rc,m=t.Vc,b=t.Fa,h=t.P+1+i*r,f=t.mb,d=t.nb+i*r,e(h<=t.P+t.qc),0!=l.Z)for(e(null!=mi[l.Z]),c=0;c<o;++c)mi[l.Z](g,m,b,h,f,d,r),g=f,m=d,d+=r,h+=r;else for(c=0;c<o;++c)n(f,d,b,h,r),g=f,m=d,d+=r,h+=r;t.rc=g,t.Vc=m}else{if(e(null!=l.mc),r=i+o,e(null!=(c=l.mc)),e(r<=c.i),c.C>=r)r=1;else if(l.ic||mr(),l.ic){l=c.V,g=c.Ba,m=c.c;var y=c.i,w=(b=1,h=c.$/m,f=c.$%m,d=c.m,p=c.s,c.$),N=m*y,A=m*r,x=p.wc,_=w<A?wt(p,f,h):null;e(w<=N),e(r<=y),e(Lt(p));e:for(;;){for(;!d.h&&w<A;){if(f&x||(_=wt(p,f,h)),e(null!=_),S(d),256>(y=bt(_.G[0],_.H[0],d)))l[g+w]=y,++w,++f>=m&&(f=0,++h<=r&&!(h%16)&&St(c,h));else{if(!(280>y)){b=0;break e}y=mt(y-256,d);var P,k=bt(_.G[4],_.H[4],d);if(S(d),!(w>=(k=vt(m,k=mt(k,d)))&&N-w>=y)){b=0;break e}for(P=0;P<y;++P)l[g+w+P]=l[g+w+P-k];for(w+=y,f+=y;f>=m;)f-=m,++h<=r&&!(h%16)&&St(c,h);w<A&&f&x&&(_=wt(p,f,h))}e(d.h==L(d))}St(c,h>r?r:h);break e}!b||d.h&&w<N?(b=0,c.a=d.h?5:3):c.$=w,r=b}else r=_t(c,c.V,c.Ba,c.c,c.i,r,Ct);if(!r){o=0;break t}}i+o>=u&&(t.Cc=1),o=1}if(!o)return null;if(t.Cc&&(null!=(o=t.ga)&&(o.mc=null),t.ga=null,0<t.Ga))return alert("todo:WebPDequantizeLevels"),null}return t.nb+i*s}function fr(t,e,r,n,i,a){for(;0<i--;){var o,s=t,u=e+(r?1:0),c=t,l=e+(r?0:3);for(o=0;o<n;++o){var h=c[l+4*o];255!=h&&(h*=32897,s[u+4*o+0]=s[u+4*o+0]*h>>23,s[u+4*o+1]=s[u+4*o+1]*h>>23,s[u+4*o+2]=s[u+4*o+2]*h>>23)}e+=a}}function dr(t,e,r,n,i){for(;0<n--;){var a;for(a=0;a<r;++a){var o=t[e+2*a+0],s=15&(c=t[e+2*a+1]),u=4369*s,c=(240&c|c>>4)*u>>16;t[e+2*a+0]=(240&o|o>>4)*u>>16&240|(15&o|o<<4)*u>>16>>4&15,t[e+2*a+1]=240&c|s}e+=i}}function pr(t,e,r,n,i,a,o,s){var u,c,l=255;for(c=0;c<i;++c){for(u=0;u<n;++u){var h=t[e+u];a[o+4*u]=h,l&=h}e+=r,o+=s}return 255!=l}function gr(t,e,r,n,i){var a;for(a=0;a<i;++a)r[n+a]=t[e+a]>>8}function mr(){Ln=fr,xn=dr,Sn=pr,_n=gr}function vr(r,n,i){t[r]=function(t,r,a,o,s,u,c,l,h,f,d,p,g,m,v,b,y){var w,N=y-1>>1,A=s[u+0]|c[l+0]<<16,L=h[f+0]|d[p+0]<<16;e(null!=t);var x=3*A+L+131074>>2;for(n(t[r+0],255&x,x>>16,g,m),null!=a&&(x=3*L+A+131074>>2,n(a[o+0],255&x,x>>16,v,b)),w=1;w<=N;++w){var S=s[u+w]|c[l+w]<<16,_=h[f+w]|d[p+w]<<16,P=A+S+L+_+524296,k=P+2*(S+L)>>3;x=k+A>>1,A=(P=P+2*(A+_)>>3)+S>>1,n(t[r+2*w-1],255&x,x>>16,g,m+(2*w-1)*i),n(t[r+2*w-0],255&A,A>>16,g,m+(2*w-0)*i),null!=a&&(x=P+L>>1,A=k+_>>1,n(a[o+2*w-1],255&x,x>>16,v,b+(2*w-1)*i),n(a[o+2*w+0],255&A,A>>16,v,b+(2*w+0)*i)),A=S,L=_}1&y||(x=3*A+L+131074>>2,n(t[r+y-1],255&x,x>>16,g,m+(y-1)*i),null!=a&&(x=3*L+A+131074>>2,n(a[o+y-1],255&x,x>>16,v,b+(y-1)*i)))}}function br(){vi[En]=bi,vi[qn]=wi,vi[Rn]=yi,vi[Tn]=Ni,vi[Dn]=Ai,vi[Un]=Li,vi[zn]=xi,vi[Hn]=wi,vi[Wn]=Ni,vi[Vn]=Ai,vi[Gn]=Li}function yr(t){return t&~Ii?0>t?0:255:t>>Fi}function wr(t,e){return yr((19077*t>>8)+(26149*e>>8)-14234)}function Nr(t,e,r){return yr((19077*t>>8)-(6419*e>>8)-(13320*r>>8)+8708)}function Ar(t,e){return yr((19077*t>>8)+(33050*e>>8)-17685)}function Lr(t,e,r,n,i){n[i+0]=wr(t,r),n[i+1]=Nr(t,e,r),n[i+2]=Ar(t,e)}function xr(t,e,r,n,i){n[i+0]=Ar(t,e),n[i+1]=Nr(t,e,r),n[i+2]=wr(t,r)}function Sr(t,e,r,n,i){var a=Nr(t,e,r);e=a<<3&224|Ar(t,e)>>3,n[i+0]=248&wr(t,r)|a>>5,n[i+1]=e}function _r(t,e,r,n,i){var a=240&Ar(t,e)|15;n[i+0]=240&wr(t,r)|Nr(t,e,r)>>4,n[i+1]=a}function Pr(t,e,r,n,i){n[i+0]=255,Lr(t,e,r,n,i+1)}function kr(t,e,r,n,i){xr(t,e,r,n,i),n[i+3]=255}function Fr(t,e,r,n,i){Lr(t,e,r,n,i),n[i+3]=255}function Vt(t,e){return 0>t?0:t>e?e:t}function Ir(e,r,n){t[e]=function(t,e,i,a,o,s,u,c,l){for(var h=c+(-2&l)*n;c!=h;)r(t[e+0],i[a+0],o[s+0],u,c),r(t[e+1],i[a+0],o[s+0],u,c+n),e+=2,++a,++s,c+=2*n;1&l&&r(t[e+0],i[a+0],o[s+0],u,c)}}function Cr(t,e,r){return 0==r?0==t?0==e?6:5:0==e?4:0:r}function jr(t,e,r,n,i){switch(t>>>30){case 3:on(e,r,n,i,0);break;case 2:sn(e,r,n,i);break;case 1:cn(e,r,n,i)}}function Or(t,e){var r,a,o=e.M,s=e.Nb,u=t.oc,c=t.pc+40,l=t.oc,h=t.pc+584,f=t.oc,d=t.pc+600;for(r=0;16>r;++r)u[c+32*r-1]=129;for(r=0;8>r;++r)l[h+32*r-1]=129,f[d+32*r-1]=129;for(0<o?u[c-1-32]=l[h-1-32]=f[d-1-32]=129:(i(u,c-32-1,127,21),i(l,h-32-1,127,9),i(f,d-32-1,127,9)),a=0;a<t.za;++a){var p=e.ya[e.aa+a];if(0<a){for(r=-1;16>r;++r)n(u,c+32*r-4,u,c+32*r+12,4);for(r=-1;8>r;++r)n(l,h+32*r-4,l,h+32*r+4,4),n(f,d+32*r-4,f,d+32*r+4,4)}var g=t.Gd,m=t.Hd+a,v=p.ad,b=p.Hc;if(0<o&&(n(u,c-32,g[m].y,0,16),n(l,h-32,g[m].f,0,8),n(f,d-32,g[m].ea,0,8)),p.Za){var y=u,w=c-32+16;for(0<o&&(a>=t.za-1?i(y,w,g[m].y[15],4):n(y,w,g[m+1].y,0,4)),r=0;4>r;r++)y[w+128+r]=y[w+256+r]=y[w+384+r]=y[w+0+r];for(r=0;16>r;++r,b<<=2)y=u,w=c+Ri[r],fi[p.Ob[r]](y,w),jr(b,v,16*+r,y,w)}else if(y=Cr(a,o,p.Ob[0]),hi[y](u,c),0!=b)for(r=0;16>r;++r,b<<=2)jr(b,v,16*+r,u,c+Ri[r]);for(r=p.Gc,y=Cr(a,o,p.Dd),di[y](l,h),di[y](f,d),b=v,y=l,w=h,255&(p=r>>0)&&(170&p?un(b,256,y,w):ln(b,256,y,w)),p=f,b=d,255&(r>>=8)&&(170&r?un(v,320,p,b):ln(v,320,p,b)),o<t.Ub-1&&(n(g[m].y,0,u,c+480,16),n(g[m].f,0,l,h+224,8),n(g[m].ea,0,f,d+224,8)),r=8*s*t.B,g=t.sa,m=t.ta+16*a+16*s*t.R,v=t.qa,p=t.ra+8*a+r,b=t.Ha,y=t.Ia+8*a+r,r=0;16>r;++r)n(g,m+r*t.R,u,c+32*r,16);for(r=0;8>r;++r)n(v,p+r*t.B,l,h+32*r,8),n(b,y+r*t.B,f,d+32*r,8)}}function Br(t,n,i,a,o,s,u,c,l){var h=[0],f=[0],d=0,p=null!=l?l.kd:0,g=null!=l?l:new nr;if(null==t||12>i)return 7;g.data=t,g.w=n,g.ha=i,n=[n],i=[i],g.gb=[g.gb];t:{var m=n,b=i,y=g.gb;if(e(null!=t),e(null!=b),e(null!=y),y[0]=0,12<=b[0]&&!r(t,m[0],"RIFF")){if(r(t,m[0]+8,"WEBP")){y=3;break t}var w=j(t,m[0]+4);if(12>w||4294967286<w){y=3;break t}if(p&&w>b[0]-8){y=7;break t}y[0]=w,m[0]+=12,b[0]-=12}y=0}if(0!=y)return y;for(w=0<g.gb[0],i=i[0];;){t:{var A=t;b=n,y=i;var L=h,x=f,S=m=[0];if((k=d=[d])[0]=0,8>y[0])y=7;else{if(!r(A,b[0],"VP8X")){if(10!=j(A,b[0]+4)){y=3;break t}if(18>y[0]){y=7;break t}var _=j(A,b[0]+8),P=1+C(A,b[0]+12);if(2147483648<=P*(A=1+C(A,b[0]+15))){y=3;break t}null!=S&&(S[0]=_),null!=L&&(L[0]=P),null!=x&&(x[0]=A),b[0]+=18,y[0]-=18,k[0]=1}y=0}}if(d=d[0],m=m[0],0!=y)return y;if(b=!!(2&m),!w&&d)return 3;if(null!=s&&(s[0]=!!(16&m)),null!=u&&(u[0]=b),null!=c&&(c[0]=0),u=h[0],m=f[0],d&&b&&null==l){y=0;break}if(4>i){y=7;break}if(w&&d||!w&&!d&&!r(t,n[0],"ALPH")){i=[i],g.na=[g.na],g.P=[g.P],g.Sa=[g.Sa];t:{_=t,y=n,w=i;var k=g.gb;L=g.na,x=g.P,S=g.Sa;P=22,e(null!=_),e(null!=w),A=y[0];var F=w[0];for(e(null!=L),e(null!=S),L[0]=null,x[0]=null,S[0]=0;;){if(y[0]=A,w[0]=F,8>F){y=7;break t}var I=j(_,A+4);if(4294967286<I){y=3;break t}var O=8+I+1&-2;if(P+=O,0<k&&P>k){y=3;break t}if(!r(_,A,"VP8 ")||!r(_,A,"VP8L")){y=0;break t}if(F[0]<O){y=7;break t}r(_,A,"ALPH")||(L[0]=_,x[0]=A+8,S[0]=I),A+=O,F-=O}}if(i=i[0],g.na=g.na[0],g.P=g.P[0],g.Sa=g.Sa[0],0!=y)break}i=[i],g.Ja=[g.Ja],g.xa=[g.xa];t:if(k=t,y=n,w=i,L=g.gb[0],x=g.Ja,S=g.xa,_=y[0],A=!r(k,_,"VP8 "),P=!r(k,_,"VP8L"),e(null!=k),e(null!=w),e(null!=x),e(null!=S),8>w[0])y=7;else{if(A||P){if(k=j(k,_+4),12<=L&&k>L-12){y=3;break t}if(p&&k>w[0]-8){y=7;break t}x[0]=k,y[0]+=8,w[0]-=8,S[0]=P}else S[0]=5<=w[0]&&47==k[_+0]&&!(k[_+4]>>5),x[0]=w[0];y=0}if(i=i[0],g.Ja=g.Ja[0],g.xa=g.xa[0],n=n[0],0!=y)break;if(4294967286<g.Ja)return 3;if(null==c||b||(c[0]=g.xa?2:1),u=[u],m=[m],g.xa){if(5>i){y=7;break}c=u,p=m,b=s,null==t||5>i?t=0:5<=i&&47==t[n+0]&&!(t[n+4]>>5)?(w=[0],k=[0],L=[0],v(x=new N,t,n,i),gt(x,w,k,L)?(null!=c&&(c[0]=w[0]),null!=p&&(p[0]=k[0]),null!=b&&(b[0]=L[0]),t=1):t=0):t=0}else{if(10>i){y=7;break}c=m,null==t||10>i||!Xt(t,n+3,i-3)?t=0:(p=t[n+0]|t[n+1]<<8|t[n+2]<<16,b=16383&(t[n+7]<<8|t[n+6]),t=16383&(t[n+9]<<8|t[n+8]),1&p||3<(p>>1&7)||!(p>>4&1)||p>>5>=g.Ja||!b||!t?t=0:(u&&(u[0]=b),c&&(c[0]=t),t=1))}if(!t)return 3;if(u=u[0],m=m[0],d&&(h[0]!=u||f[0]!=m))return 3;null!=l&&(l[0]=g,l.offset=n-l.w,e(4294967286>n-l.w),e(l.offset==l.ha-i));break}return 0==y||7==y&&d&&null==l?(null!=s&&(s[0]|=null!=g.na&&0<g.na.length),null!=a&&(a[0]=u),null!=o&&(o[0]=m),0):y}function Mr(t,e,r){var n=e.width,i=e.height,a=0,o=0,s=n,u=i;if(e.Da=null!=t&&0<t.Da,e.Da&&(s=t.cd,u=t.bd,a=t.v,o=t.j,11>r||(a&=-2,o&=-2),0>a||0>o||0>=s||0>=u||a+s>n||o+u>i))return 0;if(e.v=a,e.j=o,e.va=a+s,e.o=o+u,e.U=s,e.T=u,e.da=null!=t&&0<t.da,e.da){if(!E(s,u,r=[t.ib],a=[t.hb]))return 0;e.ib=r[0],e.hb=a[0]}return e.ob=null!=t&&t.ob,e.Kb=null==t||!t.Sd,e.da&&(e.ob=e.ib<3*n/4&&e.hb<3*i/4,e.Kb=0),1}function Er(t){if(null==t)return 2;if(11>t.S){var e=t.f.RGBA;e.fb+=(t.height-1)*e.A,e.A=-e.A}else e=t.f.kb,t=t.height,e.O+=(t-1)*e.fa,e.fa=-e.fa,e.N+=(t-1>>1)*e.Ab,e.Ab=-e.Ab,e.W+=(t-1>>1)*e.Db,e.Db=-e.Db,null!=e.F&&(e.J+=(t-1)*e.lb,e.lb=-e.lb);return 0}function qr(t,e,r,n){if(null==n||0>=t||0>=e)return 2;if(null!=r){if(r.Da){var i=r.cd,o=r.bd,s=-2&r.v,u=-2&r.j;if(0>s||0>u||0>=i||0>=o||s+i>t||u+o>e)return 2;t=i,e=o}if(r.da){if(!E(t,e,i=[r.ib],o=[r.hb]))return 2;t=i[0],e=o[0]}}n.width=t,n.height=e;t:{var c=n.width,l=n.height;if(t=n.S,0>=c||0>=l||!(t>=En&&13>t))t=2;else{if(0>=n.Rd&&null==n.sd){s=o=i=e=0;var h=(u=c*zi[t])*l;if(11>t||(o=(l+1)/2*(e=(c+1)/2),12==t&&(s=(i=c)*l)),null==(l=a(h+2*o+s))){t=1;break t}n.sd=l,11>t?((c=n.f.RGBA).eb=l,c.fb=0,c.A=u,c.size=h):((c=n.f.kb).y=l,c.O=0,c.fa=u,c.Fd=h,c.f=l,c.N=0+h,c.Ab=e,c.Cd=o,c.ea=l,c.W=0+h+o,c.Db=e,c.Ed=o,12==t&&(c.F=l,c.J=0+h+2*o),c.Tc=s,c.lb=i)}if(e=1,i=n.S,o=n.width,s=n.height,i>=En&&13>i)if(11>i)t=n.f.RGBA,e&=(u=Math.abs(t.A))*(s-1)+o<=t.size,e&=u>=o*zi[i],e&=null!=t.eb;else{t=n.f.kb,u=(o+1)/2,h=(s+1)/2,c=Math.abs(t.fa);l=Math.abs(t.Ab);var f=Math.abs(t.Db),d=Math.abs(t.lb),p=d*(s-1)+o;e&=c*(s-1)+o<=t.Fd,e&=l*(h-1)+u<=t.Cd,e=(e&=f*(h-1)+u<=t.Ed)&c>=o&l>=u&f>=u,e&=null!=t.y,e&=null!=t.f,e&=null!=t.ea,12==i&&(e&=d>=o,e&=p<=t.Tc,e&=null!=t.F)}else e=0;t=e?0:2}}return 0!=t||null!=r&&r.fd&&(t=Er(n)),t}var Rr=64,Tr=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],Dr=24,Ur=32,zr=8,Hr=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];T("Predictor0","PredictorAdd0"),t.Predictor0=function(){return 4278190080},t.Predictor1=function(t){return t},t.Predictor2=function(t,e,r){return e[r+0]},t.Predictor3=function(t,e,r){return e[r+1]},t.Predictor4=function(t,e,r){return e[r-1]},t.Predictor5=function(t,e,r){return U(U(t,e[r+1]),e[r+0])},t.Predictor6=function(t,e,r){return U(t,e[r-1])},t.Predictor7=function(t,e,r){return U(t,e[r+0])},t.Predictor8=function(t,e,r){return U(e[r-1],e[r+0])},t.Predictor9=function(t,e,r){return U(e[r+0],e[r+1])},t.Predictor10=function(t,e,r){return U(U(t,e[r-1]),U(e[r+0],e[r+1]))},t.Predictor11=function(t,e,r){var n=e[r+0];return 0>=W(n>>24&255,t>>24&255,(e=e[r-1])>>24&255)+W(n>>16&255,t>>16&255,e>>16&255)+W(n>>8&255,t>>8&255,e>>8&255)+W(255&n,255&t,255&e)?n:t},t.Predictor12=function(t,e,r){var n=e[r+0];return(z((t>>24&255)+(n>>24&255)-((e=e[r-1])>>24&255))<<24|z((t>>16&255)+(n>>16&255)-(e>>16&255))<<16|z((t>>8&255)+(n>>8&255)-(e>>8&255))<<8|z((255&t)+(255&n)-(255&e)))>>>0},t.Predictor13=function(t,e,r){var n=e[r-1];return(H((t=U(t,e[r+0]))>>24&255,n>>24&255)<<24|H(t>>16&255,n>>16&255)<<16|H(t>>8&255,n>>8&255)<<8|H(t>>0&255,n>>0&255))>>>0};var Wr=t.PredictorAdd0;t.PredictorAdd1=V,T("Predictor2","PredictorAdd2"),T("Predictor3","PredictorAdd3"),T("Predictor4","PredictorAdd4"),T("Predictor5","PredictorAdd5"),T("Predictor6","PredictorAdd6"),T("Predictor7","PredictorAdd7"),T("Predictor8","PredictorAdd8"),T("Predictor9","PredictorAdd9"),T("Predictor10","PredictorAdd10"),T("Predictor11","PredictorAdd11"),T("Predictor12","PredictorAdd12"),T("Predictor13","PredictorAdd13");var Vr=t.PredictorAdd2;X("ColorIndexInverseTransform","MapARGB","32b",(function(t){return t>>8&255}),(function(t){return t})),X("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",(function(t){return t}),(function(t){return t>>8&255}));var Gr,Yr=t.ColorIndexInverseTransform,Jr=t.MapARGB,Xr=t.VP8LColorIndexInverseTransformAlpha,Kr=t.MapAlpha,Zr=t.VP8LPredictorsAdd=[];Zr.length=16,(t.VP8LPredictors=[]).length=16,(t.VP8LPredictorsAdd_C=[]).length=16,(t.VP8LPredictors_C=[]).length=16;var $r,Qr,tn,en,rn,nn,an,on,sn,un,cn,ln,hn,fn,dn,pn,gn,mn,vn,bn,yn,wn,Nn,An,Ln,xn,Sn,_n,Pn=a(511),kn=a(2041),Fn=a(225),In=a(767),Cn=0,jn=kn,On=Fn,Bn=In,Mn=Pn,En=0,qn=1,Rn=2,Tn=3,Dn=4,Un=5,zn=6,Hn=7,Wn=8,Vn=9,Gn=10,Yn=[2,3,7],Jn=[3,3,11],Xn=[280,256,256,256,40],Kn=[0,1,1,1,0],Zn=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],$n=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],Qn=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],ti=8,ei=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],ri=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],ni=null,ii=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],ai=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],oi=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],si=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],ui=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],ci=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],li=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],hi=[],fi=[],di=[],pi=1,gi=2,mi=[],vi=[];vr("UpsampleRgbLinePair",Lr,3),vr("UpsampleBgrLinePair",xr,3),vr("UpsampleRgbaLinePair",Fr,4),vr("UpsampleBgraLinePair",kr,4),vr("UpsampleArgbLinePair",Pr,4),vr("UpsampleRgba4444LinePair",_r,2),vr("UpsampleRgb565LinePair",Sr,2);var bi=t.UpsampleRgbLinePair,yi=t.UpsampleBgrLinePair,wi=t.UpsampleRgbaLinePair,Ni=t.UpsampleBgraLinePair,Ai=t.UpsampleArgbLinePair,Li=t.UpsampleRgba4444LinePair,xi=t.UpsampleRgb565LinePair,Si=16,_i=1<<Si-1,Pi=-227,ki=482,Fi=6,Ii=(256<<Fi)-1,Ci=0,ji=a(256),Oi=a(256),Bi=a(256),Mi=a(256),Ei=a(ki-Pi),qi=a(ki-Pi);Ir("YuvToRgbRow",Lr,3),Ir("YuvToBgrRow",xr,3),Ir("YuvToRgbaRow",Fr,4),Ir("YuvToBgraRow",kr,4),Ir("YuvToArgbRow",Pr,4),Ir("YuvToRgba4444Row",_r,2),Ir("YuvToRgb565Row",Sr,2);var Ri=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],Ti=[0,2,8],Di=[8,7,6,4,4,2,2,2,1,1,1,1],Ui=1;this.WebPDecodeRGBA=function(t,r,n,i,a){var o=qn,s=new rr,u=new ot;s.ba=u,u.S=o,u.width=[u.width],u.height=[u.height];var c=u.width,l=u.height,h=new st;if(null==h||null==t)var f=2;else e(null!=h),f=Br(t,r,n,h.width,h.height,h.Pd,h.Qd,h.format,null);if(0!=f?c=0:(null!=c&&(c[0]=h.width[0]),null!=l&&(l[0]=h.height[0]),c=1),c){u.width=u.width[0],u.height=u.height[0],null!=i&&(i[0]=u.width),null!=a&&(a[0]=u.height);t:{if(i=new Gt,(a=new nr).data=t,a.w=r,a.ha=n,a.kd=1,r=[0],e(null!=a),(0==(t=Br(a.data,a.w,a.ha,null,null,null,r,null,a))||7==t)&&r[0]&&(t=4),0==(r=t)){if(e(null!=s),i.data=a.data,i.w=a.w+a.offset,i.ha=a.ha-a.offset,i.put=dt,i.ac=ft,i.bc=pt,i.ma=s,a.xa){if(null==(t=kt())){s=1;break t}if(function(t,r){var n=[0],i=[0],a=[0];e:for(;;){if(null==t)return 0;if(null==r)return t.a=2,0;if(t.l=r,t.a=0,v(t.m,r.data,r.w,r.ha),!gt(t.m,n,i,a)){t.a=3;break e}if(t.xb=gi,r.width=n[0],r.height=i[0],!Ft(n[0],i[0],1,t,null))break e;return 1}return e(0!=t.a),0}(t,i)){if(i=0==(r=qr(i.width,i.height,s.Oa,s.ba))){e:{i=t;r:for(;;){if(null==i){i=0;break e}if(e(null!=i.s.yc),e(null!=i.s.Ya),e(0<i.s.Wb),e(null!=(n=i.l)),e(null!=(a=n.ma)),0!=i.xb){if(i.ca=a.ba,i.tb=a.tb,e(null!=i.ca),!Mr(a.Oa,n,Tn)){i.a=2;break r}if(!It(i,n.width))break r;if(n.da)break r;if((n.da||nt(i.ca.S))&&mr(),11>i.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),null!=i.ca.f.kb.F&&mr()),i.Pb&&0<i.s.ua&&null==i.s.vb.X&&!O(i.s.vb,i.s.Wa.Xa)){i.a=1;break r}i.xb=0}if(!_t(i,i.V,i.Ba,i.c,i.i,n.o,At))break r;a.Dc=i.Ma,i=1;break e}e(0!=i.a),i=0}i=!i}i&&(r=t.a)}else r=t.a}else{if(null==(t=new Yt)){s=1;break t}if(t.Fa=a.na,t.P=a.P,t.qc=a.Sa,Kt(t,i)){if(0==(r=qr(i.width,i.height,s.Oa,s.ba))){if(t.Aa=0,n=s.Oa,e(null!=(a=t)),null!=n){if(0<(c=0>(c=n.Md)?0:100<c?255:255*c/100)){for(l=h=0;4>l;++l)12>(f=a.pb[l]).lc&&(f.ia=c*Di[0>f.lc?0:f.lc]>>3),h|=f.ia;h&&(alert("todo:VP8InitRandom"),a.ia=1)}a.Ga=n.Id,100<a.Ga?a.Ga=100:0>a.Ga&&(a.Ga=0)}Qt(t,i)||(r=t.a)}}else r=t.a}0==r&&null!=s.Oa&&s.Oa.fd&&(r=Er(s.ba))}s=r}o=0!=s?null:11>o?u.f.RGBA.eb:u.f.kb.y}else o=null;return o};var zi=[3,4,3,4,4,2,2,4,4,4,2,1,1]});var h=[0],f=[0],d=[],p=new Me,g=t,m=function(t,e){var r={},n=0,i=!1,a=0,o=0;if(r.frames=[],!function(t,e,r,n){for(var i=0;i<n;i++)if(t[e+i]!=r.charCodeAt(i))return!0;return!1}(t,e,"RIFF",4)){var s,h;l(t,e+=4);for(e+=8;e<t.length;){var f=u(t,e),d=l(t,e+=4);e+=4;var p=d+(1&d);switch(f){case"VP8 ":case"VP8L":void 0===r.frames[n]&&(r.frames[n]={});(v=r.frames[n]).src_off=i?o:e-8,v.src_size=a+d+8,n++,i&&(i=!1,a=0,o=0);break;case"VP8X":(v=r.header={}).feature_flags=t[e];var g=e+4;v.canvas_width=1+c(t,g);g+=3;v.canvas_height=1+c(t,g);g+=3;break;case"ALPH":i=!0,a=p+8,o=e-8;break;case"ANIM":(v=r.header).bgcolor=l(t,e);g=e+4;v.loop_count=(s=t)[(h=g)+0]<<0|s[h+1]<<8;g+=2;break;case"ANMF":var m,v;(v=r.frames[n]={}).offset_x=2*c(t,e),e+=3,v.offset_y=2*c(t,e),e+=3,v.width=1+c(t,e),e+=3,v.height=1+c(t,e),e+=3,v.duration=c(t,e),e+=3,m=t[e++],v.dispose=1&m,v.blend=m>>1&1}"ANMF"!=f&&(e+=p)}return r}}(g,0);m.response=g,m.rgbaoutput=!0,m.dataurl=!1;var v=m.header?m.header:null,b=m.frames?m.frames:null;if(v){v.loop_counter=v.loop_count,h=[v.canvas_height],f=[v.canvas_width];for(var y=0;y<b.length&&0!=b[y].blend;y++);}var w=b[0],N=p.WebPDecodeRGBA(g,w.src_off,w.src_size,f,h);w.rgba=N,w.imgwidth=f[0],w.imgheight=h[0];for(var A=0;A<f[0]*h[0]*4;A++)d[A]=N[A];return this.width=f,this.height=h,this.data=d,this}!function(t){var e=function(){return!0},r=function(e,r,i,c){var l=4,h=o;switch(c){case t.image_compression.FAST:l=1,h=a;break;case t.image_compression.MEDIUM:l=6,h=s;break;case t.image_compression.SLOW:l=9,h=u}var f=Le(e=n(e,r,i,h),{level:l});return t.__addimage__.arrayBufferToBinaryString(f)},n=function(t,e,r,n){for(var i,a,o,s=t.length/e,u=new Uint8Array(t.length+s),c=l(),f=0;f<s;f+=1){if(o=f*e,i=t.subarray(o,o+e),n)u.set(n(i,r,a),o+f);else{for(var d,p=c.length,g=[];d<p;d+=1)g[d]=c[d](i,r,a);var m=h(g.concat());u.set(g[m],o+f)}a=i}return u},i=function(t){var e=Array.apply([],t);return e.unshift(0),e},a=function(t,e){var r,n=[],i=t.length;n[0]=1;for(var a=0;a<i;a+=1)r=t[a-e]||0,n[a+1]=t[a]-r+256&255;return n},o=function(t,e,r){var n,i=[],a=t.length;i[0]=2;for(var o=0;o<a;o+=1)n=r&&r[o]||0,i[o+1]=t[o]-n+256&255;return i},s=function(t,e,r){var n,i,a=[],o=t.length;a[0]=3;for(var s=0;s<o;s+=1)n=t[s-e]||0,i=r&&r[s]||0,a[s+1]=t[s]+256-(n+i>>>1)&255;return a},u=function(t,e,r){var n,i,a,o,s=[],u=t.length;s[0]=4;for(var l=0;l<u;l+=1)n=t[l-e]||0,i=r&&r[l]||0,a=r&&r[l-e]||0,o=c(n,i,a),s[l+1]=t[l]-o+256&255;return s},c=function(t,e,r){if(t===e&&e===r)return t;var n=Math.abs(e-r),i=Math.abs(t-r),a=Math.abs(t+e-r-r);return n<=i&&n<=a?t:i<=a?e:r},l=function(){return[i,a,o,s,u]},h=function(t){var e=t.map((function(t){return t.reduce((function(t,e){return t+Math.abs(e)}),0)}));return e.indexOf(Math.min.apply(null,e))};t.processPNG=function(n,i,a,o){var s,u,c,l,h,f,d,p,g,m,v,b,y,w,N,A=this.decode.FLATE_DECODE,L="";if(this.__addimage__.isArrayBuffer(n)&&(n=new Uint8Array(n)),this.__addimage__.isArrayBufferView(n)){if(n=(c=new Ie(n)).imgData,u=c.bits,s=c.colorSpace,h=c.colors,-1!==[4,6].indexOf(c.colorType)){if(8===c.bits){g=(p=32==c.pixelBitlength?new Uint32Array(c.decodePixels().buffer):16==c.pixelBitlength?new Uint16Array(c.decodePixels().buffer):new Uint8Array(c.decodePixels().buffer)).length,v=new Uint8Array(g*c.colors),m=new Uint8Array(g);var x,S=c.pixelBitlength-c.bits;for(w=0,N=0;w<g;w++){for(y=p[w],x=0;x<S;)v[N++]=y>>>x&255,x+=c.bits;m[w]=y>>>x&255}}if(16===c.bits){g=(p=new Uint32Array(c.decodePixels().buffer)).length,v=new Uint8Array(g*(32/c.pixelBitlength)*c.colors),m=new Uint8Array(g*(32/c.pixelBitlength)),b=c.colors>1,w=0,N=0;for(var _=0;w<g;)y=p[w++],v[N++]=y>>>0&255,b&&(v[N++]=y>>>16&255,y=p[w++],v[N++]=y>>>0&255),m[_++]=y>>>16&255;u=8}o!==t.image_compression.NONE&&e()?(n=r(v,c.width*c.colors,c.colors,o),d=r(m,c.width,1,o)):(n=v,d=m,A=void 0)}if(3===c.colorType&&(s=this.color_spaces.INDEXED,f=c.palette,c.transparency.indexed)){var P=c.transparency.indexed,k=0;for(w=0,g=P.length;w<g;++w)k+=P[w];if((k/=255)===g-1&&-1!==P.indexOf(0))l=[P.indexOf(0)];else if(k!==g){for(p=c.decodePixels(),m=new Uint8Array(p.length),w=0,g=p.length;w<g;w++)m[w]=P[p[w]];d=r(m,c.width,1)}}var F=function(e){var r;switch(e){case t.image_compression.FAST:r=11;break;case t.image_compression.MEDIUM:r=13;break;case t.image_compression.SLOW:r=14;break;default:r=12}return r}(o);return A===this.decode.FLATE_DECODE&&(L="/Predictor "+F+" "),L+="/Colors "+h+" /BitsPerComponent "+u+" /Columns "+c.width,(this.__addimage__.isArrayBuffer(n)||this.__addimage__.isArrayBufferView(n))&&(n=this.__addimage__.arrayBufferToBinaryString(n)),(d&&this.__addimage__.isArrayBuffer(d)||this.__addimage__.isArrayBufferView(d))&&(d=this.__addimage__.arrayBufferToBinaryString(d)),{alias:a,data:n,index:i,filter:A,decodeParameters:L,transparency:l,palette:f,sMask:d,predictor:F,width:c.width,height:c.height,bitsPerComponent:u,colorSpace:s}}}}(j.API),function(t){t.processGIF89A=function(e,r,n,i){var a=new Ce(e),o=a.width,s=a.height,u=[];a.decodeAndBlitFrameRGBA(0,u);var c={data:u,width:o,height:s},l=new Oe(100).encode(c,100);return t.processJPEG.call(this,l,r,n,i)},t.processGIF87A=t.processGIF89A}(j.API),Be.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,16===this.bitPP&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var t=0===this.colors?1<<this.bitPP:this.colors;this.palette=new Array(t);for(var e=0;e<t;e++){var r=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:i,green:n,blue:r,quad:a}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Be.prototype.parseBGR=function(){this.pos=this.offset;try{var t="bit"+this.bitPP,e=this.width*this.height*4;this.data=new Uint8Array(e),this[t]()}catch(t){n.log("bit decode error:"+t)}},Be.prototype.bit1=function(){var t,e=Math.ceil(this.width/8),r=e%4;for(t=this.height-1;t>=0;t--){for(var n=this.bottom_up?t:this.height-1-t,i=0;i<e;i++)for(var a=this.datav.getUint8(this.pos++,!0),o=n*this.width*4+8*i*4,s=0;s<8&&8*i+s<this.width;s++){var u=this.palette[a>>7-s&1];this.data[o+4*s]=u.blue,this.data[o+4*s+1]=u.green,this.data[o+4*s+2]=u.red,this.data[o+4*s+3]=255}0!==r&&(this.pos+=4-r)}},Be.prototype.bit4=function(){for(var t=Math.ceil(this.width/2),e=t%4,r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,i=0;i<t;i++){var a=this.datav.getUint8(this.pos++,!0),o=n*this.width*4+2*i*4,s=a>>4,u=15&a,c=this.palette[s];if(this.data[o]=c.blue,this.data[o+1]=c.green,this.data[o+2]=c.red,this.data[o+3]=255,2*i+1>=this.width)break;c=this.palette[u],this.data[o+4]=c.blue,this.data[o+4+1]=c.green,this.data[o+4+2]=c.red,this.data[o+4+3]=255}0!==e&&(this.pos+=4-e)}},Be.prototype.bit8=function(){for(var t=this.width%4,e=this.height-1;e>=0;e--){for(var r=this.bottom_up?e:this.height-1-e,n=0;n<this.width;n++){var i=this.datav.getUint8(this.pos++,!0),a=r*this.width*4+4*n;if(i<this.palette.length){var o=this.palette[i];this.data[a]=o.red,this.data[a+1]=o.green,this.data[a+2]=o.blue,this.data[a+3]=255}else this.data[a]=255,this.data[a+1]=255,this.data[a+2]=255,this.data[a+3]=255}0!==t&&(this.pos+=4-t)}},Be.prototype.bit15=function(){for(var t=this.width%3,e=parseInt("11111",2),r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,i=0;i<this.width;i++){var a=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(a&e)/e*255|0,s=(a>>5&e)/e*255|0,u=(a>>10&e)/e*255|0,c=a>>15?255:0,l=n*this.width*4+4*i;this.data[l]=u,this.data[l+1]=s,this.data[l+2]=o,this.data[l+3]=c}this.pos+=t}},Be.prototype.bit16=function(){for(var t=this.width%3,e=parseInt("11111",2),r=parseInt("111111",2),n=this.height-1;n>=0;n--){for(var i=this.bottom_up?n:this.height-1-n,a=0;a<this.width;a++){var o=this.datav.getUint16(this.pos,!0);this.pos+=2;var s=(o&e)/e*255|0,u=(o>>5&r)/r*255|0,c=(o>>11)/e*255|0,l=i*this.width*4+4*a;this.data[l]=c,this.data[l+1]=u,this.data[l+2]=s,this.data[l+3]=255}this.pos+=t}},Be.prototype.bit24=function(){for(var t=this.height-1;t>=0;t--){for(var e=this.bottom_up?t:this.height-1-t,r=0;r<this.width;r++){var n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=e*this.width*4+4*r;this.data[o]=a,this.data[o+1]=i,this.data[o+2]=n,this.data[o+3]=255}this.pos+=this.width%4}},Be.prototype.bit32=function(){for(var t=this.height-1;t>=0;t--)for(var e=this.bottom_up?t:this.height-1-t,r=0;r<this.width;r++){var n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),s=e*this.width*4+4*r;this.data[s]=a,this.data[s+1]=i,this.data[s+2]=n,this.data[s+3]=o}},Be.prototype.getData=function(){return this.data},function(t){t.processBMP=function(e,r,n,i){var a=new Be(e,!1),o=a.width,s=a.height,u={data:a.getData(),width:o,height:s},c=new Oe(100).encode(u,100);return t.processJPEG.call(this,c,r,n,i)}}(j.API),Me.prototype.getData=function(){return this.data},function(t){t.processWEBP=function(e,r,n,i){var a=new Me(e,!1),o=a.width,s=a.height,u={data:a.getData(),width:o,height:s},c=new Oe(100).encode(u,100);return t.processJPEG.call(this,c,r,n,i)}}(j.API),function(t){t.setLanguage=function(t){return void 0===this.internal.languageSettings&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),void 0!=={af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"FYRO Macedonian",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[t]&&(this.internal.languageSettings.languageCode=t,!1===this.internal.languageSettings.isSubscribed&&(this.internal.events.subscribe("putCatalog",(function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")})),this.internal.languageSettings.isSubscribed=!0)),this}}(j.API),Se=j.API,_e=Se.getCharWidthsArray=function(t,e){var r,n,i=(e=e||{}).font||this.internal.getFont(),a=e.fontSize||this.internal.getFontSize(),o=e.charSpace||this.internal.getCharSpace(),s=e.widths?e.widths:i.metadata.Unicode.widths,u=s.fof?s.fof:1,c=e.kerning?e.kerning:i.metadata.Unicode.kerning,l=c.fof?c.fof:1,h=!1!==e.doKerning,f=0,d=t.length,p=0,g=s[0]||u,m=[];for(r=0;r<d;r++)n=t.charCodeAt(r),"function"==typeof i.metadata.widthOfString?m.push((i.metadata.widthOfGlyph(i.metadata.characterToGlyph(n))+o*(1e3/a)||0)/1e3):(f=h&&"object"==typeof c[n]&&!isNaN(parseInt(c[n][p],10))?c[n][p]/l:0,m.push((s[n]||g)/u+f)),p=n;return m},Pe=Se.getStringUnitWidth=function(t,e){var r=(e=e||{}).fontSize||this.internal.getFontSize(),n=e.font||this.internal.getFont(),i=e.charSpace||this.internal.getCharSpace();return Se.processArabic&&(t=Se.processArabic(t)),"function"==typeof n.metadata.widthOfString?n.metadata.widthOfString(t,r,i)/r:_e.apply(this,arguments).reduce((function(t,e){return t+e}),0)},ke=function(t,e,r,n){for(var i=[],a=0,o=t.length,s=0;a!==o&&s+e[a]<r;)s+=e[a],a++;i.push(t.slice(0,a));var u=a;for(s=0;a!==o;)s+e[a]>n&&(i.push(t.slice(u,a)),s=0,u=a),s+=e[a],a++;return u!==a&&i.push(t.slice(u,a)),i},Fe=function(t,e,r){r||(r={});var n,i,a,o,s,u,c,l=[],h=[l],f=r.textIndent||0,d=0,p=0,g=t.split(" "),m=_e.apply(this,[" ",r])[0];if(u=-1===r.lineIndent?g[0].length+2:r.lineIndent||0){var v=Array(u).join(" "),b=[];g.map((function(t){(t=t.split(/\s*\n/)).length>1?b=b.concat(t.map((function(t,e){return(e&&t.length?"\n":"")+t}))):b.push(t[0])})),g=b,u=Pe.apply(this,[v,r])}for(a=0,o=g.length;a<o;a++){var y=0;if(n=g[a],u&&"\n"==n[0]&&(n=n.substr(1),y=1),f+d+(p=(i=_e.apply(this,[n,r])).reduce((function(t,e){return t+e}),0))>e||y){if(p>e){for(s=ke.apply(this,[n,i,e-(f+d),e]),l.push(s.shift()),l=[s.pop()];s.length;)h.push([s.shift()]);p=i.slice(n.length-(l[0]?l[0].length:0)).reduce((function(t,e){return t+e}),0)}else l=[n];h.push(l),f=p+u,d=m}else l.push(n),f+=d+p,d=m}return c=u?function(t,e){return(e?v:"")+t.join(" ")}:function(t){return t.join(" ")},h.map(c)},Se.splitTextToSize=function(t,e,r){var n,i=(r=r||{}).fontSize||this.internal.getFontSize(),a=function(t){if(t.widths&&t.kerning)return{widths:t.widths,kerning:t.kerning};var e=this.internal.getFont(t.fontName,t.fontStyle);return e.metadata.Unicode?{widths:e.metadata.Unicode.widths||{0:1},kerning:e.metadata.Unicode.kerning||{}}:{font:e.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}.call(this,r);n=Array.isArray(t)?t:String(t).split(/\r?\n/);var o=1*this.internal.scaleFactor*e/i;a.textIndent=r.textIndent?1*r.textIndent*this.internal.scaleFactor/i:0,a.lineIndent=r.lineIndent;var s,u,c=[];for(s=0,u=n.length;s<u;s++)c=c.concat(Fe.apply(this,[n[s],o,a]));return c},function(t){t.__fontmetrics__=t.__fontmetrics__||{};for(var e="klmnopqrstuvwxyz",r={},n={},i=0;i<e.length;i++)r[e[i]]="0123456789abcdef"[i],n["0123456789abcdef"[i]]=e[i];var a=function(t){return"0x"+parseInt(t,10).toString(16)},o=t.__fontmetrics__.compress=function(t){var e,r,i,s,u=["{"];for(var c in t){if(e=t[c],isNaN(parseInt(c,10))?r="'"+c+"'":(c=parseInt(c,10),r=(r=a(c).slice(2)).slice(0,-1)+n[r.slice(-1)]),"number"==typeof e)e<0?(i=a(e).slice(3),s="-"):(i=a(e).slice(2),s=""),i=s+i.slice(0,-1)+n[i.slice(-1)];else{if("object"!=typeof e)throw new Error("Don't know what to do with value type "+typeof e+".");i=o(e)}u.push(r+i)}return u.push("}"),u.join("")},s=t.__fontmetrics__.uncompress=function(t){if("string"!=typeof t)throw new Error("Invalid argument passed to uncompress.");for(var e,n,i,a,o={},s=1,u=o,c=[],l="",h="",f=t.length-1,d=1;d<f;d+=1)"'"==(a=t[d])?e?(i=e.join(""),e=void 0):e=[]:e?e.push(a):"{"==a?(c.push([u,i]),u={},i=void 0):"}"==a?((n=c.pop())[0][n[1]]=u,i=void 0,u=n[0]):"-"==a?s=-1:void 0===i?r.hasOwnProperty(a)?(l+=r[a],i=parseInt(l,16)*s,s=1,l=""):l+=a:r.hasOwnProperty(a)?(h+=r[a],u[i]=parseInt(h,16)*s,s=1,i=void 0,h=""):h+=a;return o},u={codePages:["WinAnsiEncoding"],WinAnsiEncoding:s("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},c={Unicode:{Courier:u,"Courier-Bold":u,"Courier-BoldOblique":u,"Courier-Oblique":u,Helvetica:u,"Helvetica-Bold":u,"Helvetica-BoldOblique":u,"Helvetica-Oblique":u,"Times-Roman":u,"Times-Bold":u,"Times-BoldItalic":u,"Times-Italic":u}},l={Unicode:{"Courier-Oblique":s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":s("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":s("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":s("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:s("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:s("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":s("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:s("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":s("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":s("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":s("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};t.events.push(["addFont",function(t){var e=t.font,r=l.Unicode[e.postScriptName];r&&(e.metadata.Unicode={},e.metadata.Unicode.widths=r.widths,e.metadata.Unicode.kerning=r.kerning);var n=c.Unicode[e.postScriptName];n&&(e.metadata.Unicode.encoding=n,e.encoding=n.codePages[0])}])}(j.API),function(t){var e=function(t){for(var e=t.length,r=new Uint8Array(e),n=0;n<e;n++)r[n]=t.charCodeAt(n);return r};t.API.events.push(["addFont",function(r){var n=void 0,i=r.font,a=r.instance;if(!i.isStandardFont){if(void 0===a)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");if("string"!=typeof(n=!1===a.existsFileInVFS(i.postScriptName)?a.loadFile(i.postScriptName):a.getFileFromVFS(i.postScriptName)))throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");!function(r,n){n=/^\x00\x01\x00\x00/.test(n)?e(n):e(s(n)),r.metadata=t.API.TTFFont.open(n),r.metadata.Unicode=r.metadata.Unicode||{encoding:{},kerning:{},widths:[]},r.metadata.glyIdsUsed=[0]}(i,n)}}])}(j),function(r){function i(){return(e.canvg?Promise.resolve(e.canvg):"object"==typeof t&&"undefined"!=typeof module?new Promise((function(t,e){try{t(require("canvg"))}catch(t){e(t)}})):"function"==typeof define&&define.amd?new Promise((function(t,e){try{require(["canvg"],t)}catch(t){e(t)}})):Promise.reject(new Error("Could not load canvg"))).catch((function(t){return Promise.reject(new Error("Could not load canvg: "+t))})).then((function(t){return t.default?t.default:t}))}r.addSvgAsImage=function(t,e,r,a,o,s,u,c){if(isNaN(e)||isNaN(r))throw n.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(a)||isNaN(o))throw n.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var l=document.createElement("canvas");l.width=a,l.height=o;var h=l.getContext("2d");h.fillStyle="#fff",h.fillRect(0,0,l.width,l.height);var f={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},d=this;return i().then((function(e){return e.fromString(h,t,f)}),(function(){return Promise.reject(new Error("Could not load canvg."))})).then((function(t){return t.render(f)})).then((function(){d.addImage(l.toDataURL("image/jpeg",1),e,r,a,o,u,c)}))}}(j.API),function(t){t.putTotalPages=function(t){var e,r=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(t,"g"),r=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(t,this.internal.getFont()),"g"),r=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var n=1;n<=this.internal.getNumberOfPages();n++)for(var i=0;i<this.internal.pages[n].length;i++)this.internal.pages[n][i]=this.internal.pages[n][i].replace(e,r);return this}}(j.API),function(t){t.viewerPreferences=function(t,e){var r;t=t||{},e=e||!1;var n,i,a,o={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},s=Object.keys(o),u=[],c=0,l=0,h=0;function f(t,e){var r,n=!1;for(r=0;r<t.length;r+=1)t[r]===e&&(n=!0);return n}if(void 0===this.internal.viewerpreferences&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(o)),this.internal.viewerpreferences.isSubscribed=!1),r=this.internal.viewerpreferences.configuration,"reset"===t||!0===e){var d=s.length;for(h=0;h<d;h+=1)r[s[h]].value=r[s[h]].defaultValue,r[s[h]].explicitSet=!1}if("object"==typeof t)for(i in t)if(a=t[i],f(s,i)&&void 0!==a){if("boolean"===r[i].type&&"boolean"==typeof a)r[i].value=a;else if("name"===r[i].type&&f(r[i].valueSet,a))r[i].value=a;else if("integer"===r[i].type&&Number.isInteger(a))r[i].value=a;else if("array"===r[i].type){for(c=0;c<a.length;c+=1)if(n=!0,1===a[c].length&&"number"==typeof a[c][0])u.push(String(a[c]-1));else if(a[c].length>1){for(l=0;l<a[c].length;l+=1)"number"!=typeof a[c][l]&&(n=!1);!0===n&&u.push([a[c][0]-1,a[c][1]-1].join(" "))}r[i].value="["+u.join(" ")+"]"}else r[i].value=r[i].defaultValue;r[i].explicitSet=!0}return!1===this.internal.viewerpreferences.isSubscribed&&(this.internal.events.subscribe("putCatalog",(function(){var t,e=[];for(t in r)!0===r[t].explicitSet&&("name"===r[t].type?e.push("/"+t+" /"+r[t].value):e.push("/"+t+" "+r[t].value));0!==e.length&&this.internal.write("/ViewerPreferences\n<<\n"+e.join("\n")+"\n>>")})),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=r,this}}(j.API),function(t){var e=function(){var t='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',e=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),r=unescape(encodeURIComponent(t)),n=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),i=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),a=unescape(encodeURIComponent("</x:xmpmeta>")),o=r.length+n.length+i.length+e.length+a.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+o+" >>"),this.internal.write("stream"),this.internal.write(e+r+n+i+a),this.internal.write("endstream"),this.internal.write("endobj")},r=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};t.addMetadata=function(t,n){return void 0===this.internal.__metadata__&&(this.internal.__metadata__={metadata:t,namespaceuri:n||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",r),this.internal.events.subscribe("postPutResources",e)),this}}(j.API),function(t){var e=t.API,r=e.pdfEscape16=function(t,e){for(var r,n=e.metadata.Unicode.widths,i=["","0","00","000","0000"],a=[""],o=0,s=t.length;o<s;++o){if(r=e.metadata.characterToGlyph(t.charCodeAt(o)),e.metadata.glyIdsUsed.push(r),e.metadata.toUnicode[r]=t.charCodeAt(o),-1==n.indexOf(r)&&(n.push(r),n.push([parseInt(e.metadata.widthOfGlyph(r),10)])),"0"==r)return a.join("");r=r.toString(16),a.push(i[4-r.length],r)}return a.join("")},n=function(t){var e,r,n,i,a,o,s;for(a="/CIDInit /ProcSet findresource begin\n12 dict begin\nbegincmap\n/CIDSystemInfo <<\n  /Registry (Adobe)\n  /Ordering (UCS)\n  /Supplement 0\n>> def\n/CMapName /Adobe-Identity-UCS def\n/CMapType 2 def\n1 begincodespacerange\n<0000><ffff>\nendcodespacerange",n=[],o=0,s=(r=Object.keys(t).sort((function(t,e){return t-e}))).length;o<s;o++)e=r[o],n.length>=100&&(a+="\n"+n.length+" beginbfchar\n"+n.join("\n")+"\nendbfchar",n=[]),void 0!==t[e]&&null!==t[e]&&"function"==typeof t[e].toString&&(i=("0000"+t[e].toString(16)).slice(-4),e=("0000"+(+e).toString(16)).slice(-4),n.push("<"+e+"><"+i+">"));return n.length&&(a+="\n"+n.length+" beginbfchar\n"+n.join("\n")+"\nendbfchar\n"),a+="endcmap\nCMapName currentdict /CMap defineresource pop\nend\nend"};e.events.push(["putFont",function(e){!function(e){var r=e.font,i=e.out,a=e.newObject,o=e.putStream,s=e.pdfEscapeWithNeededParanthesis;if(r.metadata instanceof t.API.TTFFont&&"Identity-H"===r.encoding){for(var u=r.metadata.Unicode.widths,c=r.metadata.subset.encode(r.metadata.glyIdsUsed,1),l="",h=0;h<c.length;h++)l+=String.fromCharCode(c[h]);var f=a();o({data:l,addLength1:!0,objectId:f}),i("endobj");var d=a();o({data:n(r.metadata.toUnicode),addLength1:!0,objectId:d}),i("endobj");var p=a();i("<<"),i("/Type /FontDescriptor"),i("/FontName /"+s(r.fontName)),i("/FontFile2 "+f+" 0 R"),i("/FontBBox "+t.API.PDFObject.convert(r.metadata.bbox)),i("/Flags "+r.metadata.flags),i("/StemV "+r.metadata.stemV),i("/ItalicAngle "+r.metadata.italicAngle),i("/Ascent "+r.metadata.ascender),i("/Descent "+r.metadata.decender),i("/CapHeight "+r.metadata.capHeight),i(">>"),i("endobj");var g=a();i("<<"),i("/Type /Font"),i("/BaseFont /"+s(r.fontName)),i("/FontDescriptor "+p+" 0 R"),i("/W "+t.API.PDFObject.convert(u)),i("/CIDToGIDMap /Identity"),i("/DW 1000"),i("/Subtype /CIDFontType2"),i("/CIDSystemInfo"),i("<<"),i("/Supplement 0"),i("/Registry (Adobe)"),i("/Ordering ("+r.encoding+")"),i(">>"),i(">>"),i("endobj"),r.objectNumber=a(),i("<<"),i("/Type /Font"),i("/Subtype /Type0"),i("/ToUnicode "+d+" 0 R"),i("/BaseFont /"+s(r.fontName)),i("/Encoding /"+r.encoding),i("/DescendantFonts ["+g+" 0 R]"),i(">>"),i("endobj"),r.isAlreadyPutted=!0}}(e)}]);e.events.push(["putFont",function(e){!function(e){var r=e.font,i=e.out,a=e.newObject,o=e.putStream,s=e.pdfEscapeWithNeededParanthesis;if(r.metadata instanceof t.API.TTFFont&&"WinAnsiEncoding"===r.encoding){for(var u=r.metadata.rawData,c="",l=0;l<u.length;l++)c+=String.fromCharCode(u[l]);var h=a();o({data:c,addLength1:!0,objectId:h}),i("endobj");var f=a();o({data:n(r.metadata.toUnicode),addLength1:!0,objectId:f}),i("endobj");var d=a();i("<<"),i("/Descent "+r.metadata.decender),i("/CapHeight "+r.metadata.capHeight),i("/StemV "+r.metadata.stemV),i("/Type /FontDescriptor"),i("/FontFile2 "+h+" 0 R"),i("/Flags 96"),i("/FontBBox "+t.API.PDFObject.convert(r.metadata.bbox)),i("/FontName /"+s(r.fontName)),i("/ItalicAngle "+r.metadata.italicAngle),i("/Ascent "+r.metadata.ascender),i(">>"),i("endobj"),r.objectNumber=a();for(var p=0;p<r.metadata.hmtx.widths.length;p++)r.metadata.hmtx.widths[p]=parseInt(r.metadata.hmtx.widths[p]*(1e3/r.metadata.head.unitsPerEm));i("<</Subtype/TrueType/Type/Font/ToUnicode "+f+" 0 R/BaseFont/"+s(r.fontName)+"/FontDescriptor "+d+" 0 R/Encoding/"+r.encoding+" /FirstChar 29 /LastChar 255 /Widths "+t.API.PDFObject.convert(r.metadata.hmtx.widths)+">>"),i("endobj"),r.isAlreadyPutted=!0}}(e)}]);var i=function(t){var e,n=t.text||"",i=t.x,a=t.y,o=t.options||{},s=t.mutex||{},u=s.pdfEscape,c=s.activeFontKey,l=s.fonts,h=c,f="",d=0,p="",g=l[h].encoding;if("Identity-H"!==l[h].encoding)return{text:n,x:i,y:a,options:o,mutex:s};for(p=n,h=c,Array.isArray(n)&&(p=n[0]),d=0;d<p.length;d+=1)l[h].metadata.hasOwnProperty("cmap")&&(e=l[h].metadata.cmap.unicode.codeMap[p[d].charCodeAt(0)]),e||p[d].charCodeAt(0)<256&&l[h].metadata.hasOwnProperty("Unicode")?f+=p[d]:f+="";var m="";return parseInt(h.slice(1))<14||"WinAnsiEncoding"===g?m=u(f,h).split("").map((function(t){return t.charCodeAt(0).toString(16)})).join(""):"Identity-H"===g&&(m=r(f,l[h])),s.isHex=!0,{text:m,x:i,y:a,options:o,mutex:s}};e.events.push(["postProcessText",function(t){var e=t.text||"",r=[],n={text:e,x:t.x,y:t.y,options:t.options,mutex:t.mutex};if(Array.isArray(e)){var a=0;for(a=0;a<e.length;a+=1)Array.isArray(e[a])&&3===e[a].length?r.push([i(Object.assign({},n,{text:e[a][0]})).text,e[a][1],e[a][2]]):r.push(i(Object.assign({},n,{text:e[a]})).text);t.text=r}else t.text=i(Object.assign({},n,{text:e})).text}])}(j),function(t){var e=function(){return void 0===this.internal.vFS&&(this.internal.vFS={}),!0};t.existsFileInVFS=function(t){return e.call(this),void 0!==this.internal.vFS[t]},t.addFileToVFS=function(t,r){return e.call(this),this.internal.vFS[t]=r,this},t.getFileFromVFS=function(t){return e.call(this),void 0!==this.internal.vFS[t]?this.internal.vFS[t]:null}}(j.API),function(t){t.__bidiEngine__=t.prototype.__bidiEngine__=function(t){var r,n,i,a,o,s,u,c=e,l=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],h=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],f={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},d={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},p=["(",")","(","<",">","<","[","]","[","{","}","{","«","»","«","‹","›","‹","⁅","⁆","⁅","⁽","⁾","⁽","₍","₎","₍","≤","≥","≤","〈","〉","〈","﹙","﹚","﹙","﹛","﹜","﹛","﹝","﹞","﹝","﹤","﹥","﹤"],g=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),m=!1,v=0;this.__bidiEngine__={};var b=function(t){var e=t.charCodeAt(),r=e>>8,n=d[r];return void 0!==n?c[256*n+(255&e)]:252===r||253===r?"AL":g.test(r)?"L":8===r?"R":"N"},y=function(t){for(var e,r=0;r<t.length;r++){if("L"===(e=b(t.charAt(r))))return!1;if("R"===e)return!0}return!1},w=function(t,e,o,s){var u,c,l,h,f=e[s];switch(f){case"L":case"R":m=!1;break;case"N":case"AN":break;case"EN":m&&(f="AN");break;case"AL":m=!0,f="R";break;case"WS":f="N";break;case"CS":s<1||s+1>=e.length||"EN"!==(u=o[s-1])&&"AN"!==u||"EN"!==(c=e[s+1])&&"AN"!==c?f="N":m&&(c="AN"),f=c===u?c:"N";break;case"ES":f="EN"===(u=s>0?o[s-1]:"B")&&s+1<e.length&&"EN"===e[s+1]?"EN":"N";break;case"ET":if(s>0&&"EN"===o[s-1]){f="EN";break}if(m){f="N";break}for(l=s+1,h=e.length;l<h&&"ET"===e[l];)l++;f=l<h&&"EN"===e[l]?"EN":"N";break;case"NSM":if(i&&!a){for(h=e.length,l=s+1;l<h&&"NSM"===e[l];)l++;if(l<h){var d=t[s],p=d>=1425&&d<=2303||64286===d;if(u=e[l],p&&("R"===u||"AL"===u)){f="R";break}}}f=s<1||"B"===(u=e[s-1])?"N":o[s-1];break;case"B":m=!1,r=!0,f=v;break;case"S":n=!0,f="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":m=!1;break;case"BN":f="N"}return f},N=function(t,e,r){var n=t.split("");return r&&A(n,r,{hiLevel:v}),n.reverse(),e&&e.reverse(),n.join("")},A=function(t,e,i){var a,o,s,u,c,d=-1,p=t.length,g=0,y=[],N=v?h:l,A=[];for(m=!1,r=!1,n=!1,o=0;o<p;o++)A[o]=b(t[o]);for(s=0;s<p;s++){if(c=g,y[s]=w(t,A,y,s),a=240&(g=N[c][f[y[s]]]),g&=15,e[s]=u=N[g][5],a>0)if(16===a){for(o=d;o<s;o++)e[o]=1;d=-1}else d=-1;if(N[g][6])-1===d&&(d=s);else if(d>-1){for(o=d;o<s;o++)e[o]=u;d=-1}"B"===A[s]&&(e[s]=0),i.hiLevel|=u}n&&function(t,e,r){for(var n=0;n<r;n++)if("S"===t[n]){e[n]=v;for(var i=n-1;i>=0&&"WS"===t[i];i--)e[i]=v}}(A,e,p)},L=function(t,e,n,i,a){if(!(a.hiLevel<t)){if(1===t&&1===v&&!r)return e.reverse(),void(n&&n.reverse());for(var o,s,u,c,l=e.length,h=0;h<l;){if(i[h]>=t){for(u=h+1;u<l&&i[u]>=t;)u++;for(c=h,s=u-1;c<s;c++,s--)o=e[c],e[c]=e[s],e[s]=o,n&&(o=n[c],n[c]=n[s],n[s]=o);h=u}h++}}},x=function(t,e,r){var n=t.split(""),i={hiLevel:v};return r||(r=[]),A(n,r,i),function(t,e,r){if(0!==r.hiLevel&&u)for(var n,i=0;i<t.length;i++)1===e[i]&&(n=p.indexOf(t[i]))>=0&&(t[i]=p[n+1])}(n,r,i),L(2,n,e,r,i),L(1,n,e,r,i),n.join("")};return this.__bidiEngine__.doBidiReorder=function(t,e,r){if(function(t,e){if(e)for(var r=0;r<t.length;r++)e[r]=r;void 0===a&&(a=y(t)),void 0===s&&(s=y(t))}(t,e),i||!o||s)if(i&&o&&a^s)v=a?1:0,t=N(t,e,r);else if(!i&&o&&s)v=a?1:0,t=x(t,e,r),t=N(t,e);else if(!i||a||o||s){if(i&&!o&&a^s)t=N(t,e),a?(v=0,t=x(t,e,r)):(v=1,t=x(t,e,r),t=N(t,e));else if(i&&a&&!o&&s)v=1,t=x(t,e,r),t=N(t,e);else if(!i&&!o&&a^s){var n=u;a?(v=1,t=x(t,e,r),v=0,u=!1,t=x(t,e,r),u=n):(v=0,t=x(t,e,r),t=N(t,e),v=1,u=!1,t=x(t,e,r),u=n,t=N(t,e))}}else v=0,t=x(t,e,r);else v=a?1:0,t=x(t,e,r);return t},this.__bidiEngine__.setOptions=function(t){t&&(i=t.isInputVisual,o=t.isOutputVisual,a=t.isInputRtl,s=t.isOutputRtl,u=t.isSymmetricSwapping)},this.__bidiEngine__.setOptions(t),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],r=new t.__bidiEngine__({isInputVisual:!0});t.API.events.push(["postProcessText",function(t){var e=t.text,n=(t.x,t.y,t.options||{}),i=(t.mutex,n.lang,[]);if(n.isInputVisual="boolean"!=typeof n.isInputVisual||n.isInputVisual,r.setOptions(n),"[object Array]"===Object.prototype.toString.call(e)){var a=0;for(i=[],a=0;a<e.length;a+=1)"[object Array]"===Object.prototype.toString.call(e[a])?i.push([r.doBidiReorder(e[a][0]),e[a][1],e[a][2]]):i.push([r.doBidiReorder(e[a])]);t.text=i}else t.text=r.doBidiReorder(e);r.setOptions({isInputVisual:!0})}])}(j),j.API.TTFFont=function(){function t(t){var e;if(this.rawData=t,e=this.contents=new qe(t),this.contents.pos=4,"ttcf"===e.readString(4))throw new Error("TTCF not supported.");e.pos=0,this.parse(),this.subset=new rr(this),this.registerTTF()}return t.open=function(e){return new t(e)},t.prototype.parse=function(){return this.directory=new Re(this.contents),this.head=new Ue(this),this.name=new Je(this),this.cmap=new He(this),this.toUnicode={},this.hhea=new We(this),this.maxp=new Xe(this),this.hmtx=new Ke(this),this.post=new Ge(this),this.os2=new Ve(this),this.loca=new er(this),this.glyf=new $e(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},t.prototype.registerTTF=function(){var t,e,r,n,i;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=function(){var e,r,n,i;for(i=[],e=0,r=(n=this.bbox).length;e<r;e++)t=n[e],i.push(Math.round(t*this.scaleFactor));return i}.call(this),this.stemV=0,this.post.exists?(r=255&(n=this.post.italic_angle),0!=(32768&(e=n>>16))&&(e=-(1+(65535^e))),this.italicAngle=+(e+"."+r)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=1===(i=this.familyClass)||2===i||3===i||4===i||5===i||7===i,this.isScript=10===this.familyClass,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),0!==this.italicAngle&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},t.prototype.characterToGlyph=function(t){var e;return(null!=(e=this.cmap.unicode)?e.codeMap[t]:void 0)||0},t.prototype.widthOfGlyph=function(t){var e;return e=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(t).advance*e},t.prototype.widthOfString=function(t,e,r){var n,i,a,o;for(a=0,i=0,o=(t=""+t).length;0<=o?i<o:i>o;i=0<=o?++i:--i)n=t.charCodeAt(i),a+=this.widthOfGlyph(this.characterToGlyph(n))+r*(1e3/e)||0;return a*(e/1e3)},t.prototype.lineHeight=function(t,e){var r;return null==e&&(e=!1),r=e?this.lineGap:0,(this.ascender+r-this.decender)/1e3*t},t}();var Ee,qe=function(){function t(t){this.data=null!=t?t:[],this.pos=0,this.length=this.data.length}return t.prototype.readByte=function(){return this.data[this.pos++]},t.prototype.writeByte=function(t){return this.data[this.pos++]=t},t.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},t.prototype.writeUInt32=function(t){return this.writeByte(t>>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t)},t.prototype.readInt32=function(){var t;return(t=this.readUInt32())>=2147483648?t-4294967296:t},t.prototype.writeInt32=function(t){return t<0&&(t+=4294967296),this.writeUInt32(t)},t.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},t.prototype.writeUInt16=function(t){return this.writeByte(t>>8&255),this.writeByte(255&t)},t.prototype.readInt16=function(){var t;return(t=this.readUInt16())>=32768?t-65536:t},t.prototype.writeInt16=function(t){return t<0&&(t+=65536),this.writeUInt16(t)},t.prototype.readString=function(t){var e,r;for(r=[],e=0;0<=t?e<t:e>t;e=0<=t?++e:--e)r[e]=String.fromCharCode(this.readByte());return r.join("")},t.prototype.writeString=function(t){var e,r,n;for(n=[],e=0,r=t.length;0<=r?e<r:e>r;e=0<=r?++e:--e)n.push(this.writeByte(t.charCodeAt(e)));return n},t.prototype.readShort=function(){return this.readInt16()},t.prototype.writeShort=function(t){return this.writeInt16(t)},t.prototype.readLongLong=function(){var t,e,r,n,i,a,o,s;return t=this.readByte(),e=this.readByte(),r=this.readByte(),n=this.readByte(),i=this.readByte(),a=this.readByte(),o=this.readByte(),s=this.readByte(),128&t?-1*(72057594037927940*(255^t)+281474976710656*(255^e)+1099511627776*(255^r)+4294967296*(255^n)+16777216*(255^i)+65536*(255^a)+256*(255^o)+(255^s)+1):72057594037927940*t+281474976710656*e+1099511627776*r+4294967296*n+16777216*i+65536*a+256*o+s},t.prototype.writeLongLong=function(t){var e,r;return e=Math.floor(t/4294967296),r=4294967295&t,this.writeByte(e>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e),this.writeByte(r>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r)},t.prototype.readInt=function(){return this.readInt32()},t.prototype.writeInt=function(t){return this.writeInt32(t)},t.prototype.read=function(t){var e,r;for(e=[],r=0;0<=t?r<t:r>t;r=0<=t?++r:--r)e.push(this.readByte());return e},t.prototype.write=function(t){var e,r,n,i;for(i=[],r=0,n=t.length;r<n;r++)e=t[r],i.push(this.writeByte(e));return i},t}(),Re=function(){var t;function e(t){var e,r,n;for(this.scalarType=t.readInt(),this.tableCount=t.readShort(),this.searchRange=t.readShort(),this.entrySelector=t.readShort(),this.rangeShift=t.readShort(),this.tables={},r=0,n=this.tableCount;0<=n?r<n:r>n;r=0<=n?++r:--r)e={tag:t.readString(4),checksum:t.readInt(),offset:t.readInt(),length:t.readInt()},this.tables[e.tag]=e}return e.prototype.encode=function(e){var r,n,i,a,o,s,u,c,l,h,f,d,p;for(p in f=Object.keys(e).length,s=Math.log(2),l=16*Math.floor(Math.log(f)/s),a=Math.floor(l/s),c=16*f-l,(n=new qe).writeInt(this.scalarType),n.writeShort(f),n.writeShort(l),n.writeShort(a),n.writeShort(c),i=16*f,u=n.pos+i,o=null,d=[],e)for(h=e[p],n.writeString(p),n.writeInt(t(h)),n.writeInt(u),n.writeInt(h.length),d=d.concat(h),"head"===p&&(o=u),u+=h.length;u%4;)d.push(0),u++;return n.write(d),r=2981146554-t(n.data),n.pos=o+8,n.writeUInt32(r),n.data},t=function(t){var e,r,n,i;for(t=Ze.call(t);t.length%4;)t.push(0);for(n=new qe(t),r=0,e=0,i=t.length;e<i;e=e+=4)r+=n.readUInt32();return 4294967295&r},e}(),Te={}.hasOwnProperty,De=function(t,e){for(var r in e)Te.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},Ue=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return De(e,t),e.prototype.tag="head",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.revision=t.readInt(),this.checkSumAdjustment=t.readInt(),this.magicNumber=t.readInt(),this.flags=t.readShort(),this.unitsPerEm=t.readShort(),this.created=t.readLongLong(),this.modified=t.readLongLong(),this.xMin=t.readShort(),this.yMin=t.readShort(),this.xMax=t.readShort(),this.yMax=t.readShort(),this.macStyle=t.readShort(),this.lowestRecPPEM=t.readShort(),this.fontDirectionHint=t.readShort(),this.indexToLocFormat=t.readShort(),this.glyphDataFormat=t.readShort()},e.prototype.encode=function(t){var e;return(e=new qe).writeInt(this.version),e.writeInt(this.revision),e.writeInt(this.checkSumAdjustment),e.writeInt(this.magicNumber),e.writeShort(this.flags),e.writeShort(this.unitsPerEm),e.writeLongLong(this.created),e.writeLongLong(this.modified),e.writeShort(this.xMin),e.writeShort(this.yMin),e.writeShort(this.xMax),e.writeShort(this.yMax),e.writeShort(this.macStyle),e.writeShort(this.lowestRecPPEM),e.writeShort(this.fontDirectionHint),e.writeShort(t),e.writeShort(this.glyphDataFormat),e.data},e}(Ee=function(){function t(t){var e;this.file=t,e=this.file.directory.tables[this.tag],this.exists=!!e,e&&(this.offset=e.offset,this.length=e.length,this.parse(this.file.contents))}return t.prototype.parse=function(){},t.prototype.encode=function(){},t.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},t}()),ze=function(){function t(t,e){var r,n,i,a,o,s,u,c,l,h,f,d,p,g,m,v,b;switch(this.platformID=t.readUInt16(),this.encodingID=t.readShort(),this.offset=e+t.readInt(),l=t.pos,t.pos=this.offset,this.format=t.readUInt16(),this.length=t.readUInt16(),this.language=t.readUInt16(),this.isUnicode=3===this.platformID&&1===this.encodingID&&4===this.format||0===this.platformID&&4===this.format,this.codeMap={},this.format){case 0:for(s=0;s<256;++s)this.codeMap[s]=t.readByte();break;case 4:for(f=t.readUInt16(),h=f/2,t.pos+=6,i=function(){var e,r;for(r=[],s=e=0;0<=h?e<h:e>h;s=0<=h?++e:--e)r.push(t.readUInt16());return r}(),t.pos+=2,p=function(){var e,r;for(r=[],s=e=0;0<=h?e<h:e>h;s=0<=h?++e:--e)r.push(t.readUInt16());return r}(),u=function(){var e,r;for(r=[],s=e=0;0<=h?e<h:e>h;s=0<=h?++e:--e)r.push(t.readUInt16());return r}(),c=function(){var e,r;for(r=[],s=e=0;0<=h?e<h:e>h;s=0<=h?++e:--e)r.push(t.readUInt16());return r}(),n=(this.length-t.pos+this.offset)/2,o=function(){var e,r;for(r=[],s=e=0;0<=n?e<n:e>n;s=0<=n?++e:--e)r.push(t.readUInt16());return r}(),s=m=0,b=i.length;m<b;s=++m)for(g=i[s],r=v=d=p[s];d<=g?v<=g:v>=g;r=d<=g?++v:--v)0===c[s]?a=r+u[s]:0!==(a=o[c[s]/2+(r-d)-(h-s)]||0)&&(a+=u[s]),this.codeMap[r]=65535&a}t.pos=l}return t.encode=function(t,e){var r,n,i,a,o,s,u,c,l,h,f,d,p,g,m,v,b,y,w,N,A,L,x,S,_,P,k,F,I,C,j,O,B,M,E,q,R,T,D,U,z,H,W,V,G,Y;switch(F=new qe,a=Object.keys(t).sort((function(t,e){return t-e})),e){case"macroman":for(p=0,g=function(){var t=[];for(d=0;d<256;++d)t.push(0);return t}(),v={0:0},i={},I=0,B=a.length;I<B;I++)null==v[W=t[n=a[I]]]&&(v[W]=++p),i[n]={old:t[n],new:v[t[n]]},g[n]=v[t[n]];return F.writeUInt16(1),F.writeUInt16(0),F.writeUInt32(12),F.writeUInt16(0),F.writeUInt16(262),F.writeUInt16(0),F.write(g),{charMap:i,subtable:F.data,maxGlyphID:p+1};case"unicode":for(P=[],l=[],b=0,v={},r={},m=u=null,C=0,M=a.length;C<M;C++)null==v[w=t[n=a[C]]]&&(v[w]=++b),r[n]={old:w,new:v[w]},o=v[w]-n,null!=m&&o===u||(m&&l.push(m),P.push(n),u=o),m=n;for(m&&l.push(m),l.push(65535),P.push(65535),S=2*(x=P.length),L=2*Math.pow(Math.log(x)/Math.LN2,2),h=Math.log(L/2)/Math.LN2,A=2*x-L,s=[],N=[],f=[],d=j=0,E=P.length;j<E;d=++j){if(_=P[d],c=l[d],65535===_){s.push(0),N.push(0);break}if(_-(k=r[_].new)>=32768)for(s.push(0),N.push(2*(f.length+x-d)),n=O=_;_<=c?O<=c:O>=c;n=_<=c?++O:--O)f.push(r[n].new);else s.push(k-_),N.push(0)}for(F.writeUInt16(3),F.writeUInt16(1),F.writeUInt32(12),F.writeUInt16(4),F.writeUInt16(16+8*x+2*f.length),F.writeUInt16(0),F.writeUInt16(S),F.writeUInt16(L),F.writeUInt16(h),F.writeUInt16(A),z=0,q=l.length;z<q;z++)n=l[z],F.writeUInt16(n);for(F.writeUInt16(0),H=0,R=P.length;H<R;H++)n=P[H],F.writeUInt16(n);for(V=0,T=s.length;V<T;V++)o=s[V],F.writeUInt16(o);for(G=0,D=N.length;G<D;G++)y=N[G],F.writeUInt16(y);for(Y=0,U=f.length;Y<U;Y++)p=f[Y],F.writeUInt16(p);return{charMap:r,subtable:F.data,maxGlyphID:b+1}}},t}(),He=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return De(e,t),e.prototype.tag="cmap",e.prototype.parse=function(t){var e,r,n;for(t.pos=this.offset,this.version=t.readUInt16(),n=t.readUInt16(),this.tables=[],this.unicode=null,r=0;0<=n?r<n:r>n;r=0<=n?++r:--r)e=new ze(t,this.offset),this.tables.push(e),e.isUnicode&&null==this.unicode&&(this.unicode=e);return!0},e.encode=function(t,e){var r,n;return null==e&&(e="macroman"),r=ze.encode(t,e),(n=new qe).writeUInt16(0),n.writeUInt16(1),r.table=n.data.concat(r.subtable),r},e}(Ee),We=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return De(e,t),e.prototype.tag="hhea",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.ascender=t.readShort(),this.decender=t.readShort(),this.lineGap=t.readShort(),this.advanceWidthMax=t.readShort(),this.minLeftSideBearing=t.readShort(),this.minRightSideBearing=t.readShort(),this.xMaxExtent=t.readShort(),this.caretSlopeRise=t.readShort(),this.caretSlopeRun=t.readShort(),this.caretOffset=t.readShort(),t.pos+=8,this.metricDataFormat=t.readShort(),this.numberOfMetrics=t.readUInt16()},e}(Ee),Ve=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return De(e,t),e.prototype.tag="OS/2",e.prototype.parse=function(t){if(t.pos=this.offset,this.version=t.readUInt16(),this.averageCharWidth=t.readShort(),this.weightClass=t.readUInt16(),this.widthClass=t.readUInt16(),this.type=t.readShort(),this.ySubscriptXSize=t.readShort(),this.ySubscriptYSize=t.readShort(),this.ySubscriptXOffset=t.readShort(),this.ySubscriptYOffset=t.readShort(),this.ySuperscriptXSize=t.readShort(),this.ySuperscriptYSize=t.readShort(),this.ySuperscriptXOffset=t.readShort(),this.ySuperscriptYOffset=t.readShort(),this.yStrikeoutSize=t.readShort(),this.yStrikeoutPosition=t.readShort(),this.familyClass=t.readShort(),this.panose=function(){var e,r;for(r=[],e=0;e<10;++e)r.push(t.readByte());return r}(),this.charRange=function(){var e,r;for(r=[],e=0;e<4;++e)r.push(t.readInt());return r}(),this.vendorID=t.readString(4),this.selection=t.readShort(),this.firstCharIndex=t.readShort(),this.lastCharIndex=t.readShort(),this.version>0&&(this.ascent=t.readShort(),this.descent=t.readShort(),this.lineGap=t.readShort(),this.winAscent=t.readShort(),this.winDescent=t.readShort(),this.codePageRange=function(){var e,r;for(r=[],e=0;e<2;e=++e)r.push(t.readInt());return r}(),this.version>1))return this.xHeight=t.readShort(),this.capHeight=t.readShort(),this.defaultChar=t.readShort(),this.breakChar=t.readShort(),this.maxContext=t.readShort()},e}(Ee),Ge=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return De(e,t),e.prototype.tag="post",e.prototype.parse=function(t){var e,r,n;switch(t.pos=this.offset,this.format=t.readInt(),this.italicAngle=t.readInt(),this.underlinePosition=t.readShort(),this.underlineThickness=t.readShort(),this.isFixedPitch=t.readInt(),this.minMemType42=t.readInt(),this.maxMemType42=t.readInt(),this.minMemType1=t.readInt(),this.maxMemType1=t.readInt(),this.format){case 65536:break;case 131072:var i;for(r=t.readUInt16(),this.glyphNameIndex=[],i=0;0<=r?i<r:i>r;i=0<=r?++i:--i)this.glyphNameIndex.push(t.readUInt16());for(this.names=[],n=[];t.pos<this.offset+this.length;)e=t.readByte(),n.push(this.names.push(t.readString(e)));return n;case 151552:return r=t.readUInt16(),this.offsets=t.read(r);case 196608:break;case 262144:return this.map=function(){var e,r,n;for(n=[],i=e=0,r=this.file.maxp.numGlyphs;0<=r?e<r:e>r;i=0<=r?++e:--e)n.push(t.readUInt32());return n}.call(this)}},e}(Ee),Ye=function(t,e){this.raw=t,this.length=t.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},Je=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return De(e,t),e.prototype.tag="name",e.prototype.parse=function(t){var e,r,n,i,a,o,s,u,c,l,h;for(t.pos=this.offset,t.readShort(),e=t.readShort(),o=t.readShort(),r=[],i=0;0<=e?i<e:i>e;i=0<=e?++i:--i)r.push({platformID:t.readShort(),encodingID:t.readShort(),languageID:t.readShort(),nameID:t.readShort(),length:t.readShort(),offset:this.offset+o+t.readShort()});for(s={},i=c=0,l=r.length;c<l;i=++c)n=r[i],t.pos=n.offset,u=t.readString(n.length),a=new Ye(u,n),null==s[h=n.nameID]&&(s[h]=[]),s[n.nameID].push(a);this.strings=s,this.copyright=s[0],this.fontFamily=s[1],this.fontSubfamily=s[2],this.uniqueSubfamily=s[3],this.fontName=s[4],this.version=s[5];try{this.postscriptName=s[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch(t){this.postscriptName=s[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=s[7],this.manufacturer=s[8],this.designer=s[9],this.description=s[10],this.vendorUrl=s[11],this.designerUrl=s[12],this.license=s[13],this.licenseUrl=s[14],this.preferredFamily=s[15],this.preferredSubfamily=s[17],this.compatibleFull=s[18],this.sampleText=s[19]},e}(Ee),Xe=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return De(e,t),e.prototype.tag="maxp",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.numGlyphs=t.readUInt16(),this.maxPoints=t.readUInt16(),this.maxContours=t.readUInt16(),this.maxCompositePoints=t.readUInt16(),this.maxComponentContours=t.readUInt16(),this.maxZones=t.readUInt16(),this.maxTwilightPoints=t.readUInt16(),this.maxStorage=t.readUInt16(),this.maxFunctionDefs=t.readUInt16(),this.maxInstructionDefs=t.readUInt16(),this.maxStackElements=t.readUInt16(),this.maxSizeOfInstructions=t.readUInt16(),this.maxComponentElements=t.readUInt16(),this.maxComponentDepth=t.readUInt16()},e}(Ee),Ke=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return De(e,t),e.prototype.tag="hmtx",e.prototype.parse=function(t){var e,r,n,i,a,o,s;for(t.pos=this.offset,this.metrics=[],e=0,o=this.file.hhea.numberOfMetrics;0<=o?e<o:e>o;e=0<=o?++e:--e)this.metrics.push({advance:t.readUInt16(),lsb:t.readInt16()});for(n=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var r,i;for(i=[],e=r=0;0<=n?r<n:r>n;e=0<=n?++r:--r)i.push(t.readInt16());return i}(),this.widths=function(){var t,e,r,n;for(n=[],t=0,e=(r=this.metrics).length;t<e;t++)i=r[t],n.push(i.advance);return n}.call(this),r=this.widths[this.widths.length-1],s=[],e=a=0;0<=n?a<n:a>n;e=0<=n?++a:--a)s.push(this.widths.push(r));return s},e.prototype.forGlyph=function(t){return t in this.metrics?this.metrics[t]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[t-this.metrics.length]}},e}(Ee),Ze=[].slice,$e=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return De(e,t),e.prototype.tag="glyf",e.prototype.parse=function(){return this.cache={}},e.prototype.glyphFor=function(t){var e,r,n,i,a,o,s,u,c,l;return t in this.cache?this.cache[t]:(i=this.file.loca,e=this.file.contents,r=i.indexOf(t),0===(n=i.lengthOf(t))?this.cache[t]=null:(e.pos=this.offset+r,a=(o=new qe(e.read(n))).readShort(),u=o.readShort(),l=o.readShort(),s=o.readShort(),c=o.readShort(),this.cache[t]=-1===a?new tr(o,u,l,s,c):new Qe(o,a,u,l,s,c),this.cache[t]))},e.prototype.encode=function(t,e,r){var n,i,a,o,s;for(a=[],i=[],o=0,s=e.length;o<s;o++)n=t[e[o]],i.push(a.length),n&&(a=a.concat(n.encode(r)));return i.push(a.length),{table:a,offsets:i}},e}(Ee),Qe=function(){function t(t,e,r,n,i,a){this.raw=t,this.numberOfContours=e,this.xMin=r,this.yMin=n,this.xMax=i,this.yMax=a,this.compound=!1}return t.prototype.encode=function(){return this.raw.data},t}(),tr=function(){function t(t,e,r,n,i){var a,o;for(this.raw=t,this.xMin=e,this.yMin=r,this.xMax=n,this.yMax=i,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],a=this.raw;o=a.readShort(),this.glyphOffsets.push(a.pos),this.glyphIDs.push(a.readUInt16()),32&o;)a.pos+=1&o?4:2,128&o?a.pos+=8:64&o?a.pos+=4:8&o&&(a.pos+=2)}return 1,8,32,64,128,t.prototype.encode=function(){var t,e,r;for(e=new qe(Ze.call(this.raw.data)),t=0,r=this.glyphIDs.length;t<r;++t)e.pos=this.glyphOffsets[t];return e.data},t}(),er=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return De(e,t),e.prototype.tag="loca",e.prototype.parse=function(t){var e,r;return t.pos=this.offset,e=this.file.head.indexToLocFormat,this.offsets=0===e?function(){var e,n;for(n=[],r=0,e=this.length;r<e;r+=2)n.push(2*t.readUInt16());return n}.call(this):function(){var e,n;for(n=[],r=0,e=this.length;r<e;r+=4)n.push(t.readUInt32());return n}.call(this)},e.prototype.indexOf=function(t){return this.offsets[t]},e.prototype.lengthOf=function(t){return this.offsets[t+1]-this.offsets[t]},e.prototype.encode=function(t,e){for(var r=new Uint32Array(this.offsets.length),n=0,i=0,a=0;a<r.length;++a)if(r[a]=n,i<e.length&&e[i]==a){++i,r[a]=n;var o=this.offsets[a],s=this.offsets[a+1]-o;s>0&&(n+=s)}for(var u=new Array(4*r.length),c=0;c<r.length;++c)u[4*c+3]=255&r[c],u[4*c+2]=(65280&r[c])>>8,u[4*c+1]=(16711680&r[c])>>16,u[4*c]=(4278190080&r[c])>>24;return u},e}(Ee),rr=function(){function t(t){this.font=t,this.subset={},this.unicodes={},this.next=33}return t.prototype.generateCmap=function(){var t,e,r,n,i;for(e in n=this.font.cmap.tables[0].codeMap,t={},i=this.subset)r=i[e],t[e]=n[r];return t},t.prototype.glyphsFor=function(t){var e,r,n,i,a,o,s;for(n={},a=0,o=t.length;a<o;a++)n[i=t[a]]=this.font.glyf.glyphFor(i);for(i in e=[],n)(null!=(r=n[i])?r.compound:void 0)&&e.push.apply(e,r.glyphIDs);if(e.length>0)for(i in s=this.glyphsFor(e))r=s[i],n[i]=r;return n},t.prototype.encode=function(t,e){var r,n,i,a,o,s,u,c,l,h,f,d,p,g,m;for(n in r=He.encode(this.generateCmap(),"unicode"),a=this.glyphsFor(t),f={0:0},m=r.charMap)f[(s=m[n]).old]=s.new;for(d in h=r.maxGlyphID,a)d in f||(f[d]=h++);return c=function(t){var e,r;for(e in r={},t)r[t[e]]=e;return r}(f),l=Object.keys(c).sort((function(t,e){return t-e})),p=function(){var t,e,r;for(r=[],t=0,e=l.length;t<e;t++)o=l[t],r.push(c[o]);return r}(),i=this.font.glyf.encode(a,p,f),u=this.font.loca.encode(i.offsets,p),g={cmap:this.font.cmap.raw(),glyf:i.table,loca:u,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(e)},this.font.os2.exists&&(g["OS/2"]=this.font.os2.raw()),this.font.directory.encode(g)},t}();j.API.PDFObject=function(){var t;function e(){}return t=function(t,e){return(Array(e+1).join("0")+t).slice(-e)},e.convert=function(r){var n,i,a,o;if(Array.isArray(r))return"["+function(){var t,i,a;for(a=[],t=0,i=r.length;t<i;t++)n=r[t],a.push(e.convert(n));return a}().join(" ")+"]";if("string"==typeof r)return"/"+r;if(null!=r?r.isString:void 0)return"("+r+")";if(r instanceof Date)return"(D:"+t(r.getUTCFullYear(),4)+t(r.getUTCMonth(),2)+t(r.getUTCDate(),2)+t(r.getUTCHours(),2)+t(r.getUTCMinutes(),2)+t(r.getUTCSeconds(),2)+"Z)";if("[object Object]"==={}.toString.call(r)){for(i in a=["<<"],r)o=r[i],a.push("/"+i+" "+e.convert(o));return a.push(">>"),a.join("\n")}return""+r},e}(),t.AcroForm=Nt,t.AcroFormAppearance=yt,t.AcroFormButton=ft,t.AcroFormCheckBox=mt,t.AcroFormChoiceField=ut,t.AcroFormComboBox=lt,t.AcroFormEditBox=ht,t.AcroFormListBox=ct,t.AcroFormPasswordField=bt,t.AcroFormPushButton=dt,t.AcroFormRadioButton=pt,t.AcroFormTextField=vt,t.GState=k,t.ShadingPattern=I,t.TilingPattern=C,t.default=j,t.jsPDF=j,Object.defineProperty(t,"__esModule",{value:!0})}));;

/* /ks_account_dashboard/static/src/js/ks_dashboard_fiscal.js defined in bundle 'web.assets_backend' */
odoo.define('ks_account_dashboard.ks_fiscal_filter_dashboard',function(require){"use strict";var core=require('web.core');var _t=core._t;var QWeb=core.qweb;var config=require('web.config');var time=require('web.time');var field_utils=require('web.field_utils');var KsDashboardNinja=require('ks_dashboard_ninja.ks_dashboard');KsDashboardNinja.include({init:function(parent,state,params){this._super.apply(this,arguments);this.ks_mode='active';this.action_manager=parent;this.controllerID=params.controllerID;this.name="ks_dashboard";this.ksIsDashboardManager=false;this.ksDashboardEditMode=false;this.ksNewDashboardName=false;this.file_type_magic_word={'/':'jpg','R':'gif','i':'png','P':'svg+xml',};this.ksAllowItemClick=true;var l10n=_t.database.parameters;this.form_template='ks_dashboard_ninja_template_view';this.date_format=time.strftime_to_moment_format(_t.database.parameters.date_format)
this.date_format=this.date_format.replace(/\bYY\b/g,"YYYY");this.datetime_format=time.strftime_to_moment_format((_t.database.parameters.date_format+' '+l10n.time_format))
this.ks_date_filter_data;this.ks_date_filter_selections={'l_none':_t('Date Filter'),'l_day':_t('Today'),'t_week':_t('This Week'),'t_month':_t('This Month'),'t_quarter':_t('This Quarter'),'t_year':_t('This Year'),'n_day':_t('Next Day'),'n_week':_t('Next Week'),'n_month':_t('Next Month'),'n_quarter':_t('Next Quarter'),'n_year':_t('Next Year'),'ls_day':_t('Last Day'),'ls_week':_t('Last Week'),'ls_month':_t('Last Month'),'ls_quarter':_t('Last Quarter'),'ls_year':_t('Last Year'),'l_week':_t('Last 7 days'),'l_month':_t('Last 30 days'),'l_quarter':_t('Last 90 days'),'l_year':_t('Last 365 days'),'ls_past_until_now':_t('Past Till Now'),'ls_pastwithout_now':_t('Past Excluding Today'),'n_future_starting_now':_t('Future Starting Now'),'n_futurestarting_tomorrow':_t('Future Starting Tomorrow'),'l_custom':_t('Custom Filter'),};this.ks_date_filter_selection_order=['l_day','t_week','t_month','t_quarter','t_year','n_day','n_week','n_month','n_quarter','n_year','ls_day','ls_week','ls_month','ls_quarter','ls_year','l_week','l_month','l_quarter','l_year','ls_past_until_now','ls_pastwithout_now','n_future_starting_now','n_futurestarting_tomorrow','l_custom'];this.ks_dashboard_id=state.params.ks_dashboard_id;this.gridstack_options={staticGrid:true,float:false,animate:true,cellHeight:80,styleInHead:true,};this.gridstackConfig={};this.grid=false;this.chartMeasure={};this.chart_container={};this.list_container={};this.ksChartColorOptions=['default','cool','warm','neon'];this.ksUpdateDashboardItem=this.ksUpdateDashboardItem.bind(this);this.ksDateFilterSelection=false;this.ksDateFilterStartDate=false;this.ksDateFilterEndDate=false;this.ksUpdateDashboard={};},});});;

/* /account_reconciliation_widget_partial/static/src/js/reconciliation_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('account_reconcile_partial.ReconciliationRenderer',function(require){"use strict";var renderer=require('account.ReconciliationRenderer')
renderer.LineRenderer.include({events:_.extend({},renderer.LineRenderer.prototype.events,{'click .accounting_view .line_info_edit.fa-pencil':'_onInfoEdit',}),_onInfoEdit:function(e){e.stopPropagation();var $line=$(event.target);this.trigger_up('getPartialAmount',{'data':$line.closest('.mv_line').data('line-id')});},updatePartialAmount:function(line_id,amount){var $line=this.$('.mv_line[data-line-id='+line_id+']');$line.find('.line_info_edit').addClass('o_hidden');$line.find('.edit_amount_input').removeClass('o_hidden');$line.find('.edit_amount_input').focus();$line.find('.edit_amount_input').val(amount);$line.find('.edit_amount_input').select();$line.find('.line_amount').addClass('o_hidden');},_onInputKeyup:function(event){if(event.keyCode===13){if($(event.target).hasClass('edit_amount_input')){$(event.target).blur();return;}}
if($(event.target).hasClass('edit_amount_input')){if(event.type==='keyup'){return;}
else{return this._editAmount(event);}}
return this._super.apply(this,arguments);},});});;

/* /account_reconciliation_widget_partial/static/src/js/reconciliation_model.js defined in bundle 'web.assets_backend' */
odoo.define("account_reconcile_partial.ReconciliationModel",function(require){var model=require('account.ReconciliationModel');var field_utils=require('web.field_utils');var utils=require('web.utils');var session=require('web.session');model.StatementModel.include({getPartialReconcileAmount:function(handle,data){var line=this.getLine(handle);var formatOptions={currency_id:line.st_line.currency_id,noSymbol:true,};var prop=_.find(line.reconciliation_proposition,{'id':data.data});if(prop){var amount=prop.partial_amount||prop.amount;var partial=Math.abs(line.balance.amount+amount);if(Math.abs(line.balance.amount)>=Math.abs(amount)){amount=Math.abs(amount);}else if(partial<=Math.abs(prop.amount)&&partial>=0){amount=partial;}else{amount=Math.abs(amount);}
return field_utils.format.monetary(amount,{},formatOptions);}},partialReconcile:function(handle,data){var line=this.getLine(handle);var prop=_.find(line.reconciliation_proposition,{'id':data.mvLineId});if(prop){var amount=data.amount;try{amount=field_utils.parse.float(data.amount);}
catch(err){amount=NaN;}
if(amount>=Math.abs(prop.amount)||amount<=0||isNaN(amount)){delete prop.partial_amount_str;delete prop.partial_amount;if(isNaN(amount)||amount<0){this.do_warn(_.str.sprintf(_t('The amount %s is not a valid partial amount'),data.amount));}
return this._computeLine(line);}
else{var format_options={currency_id:line.st_line.currency_id};prop.partial_reconcile=true;prop.partial_amount=(prop.amount>0?1:-1)*amount;prop.write_off_amount=prop.partial_amount;prop.partial_amount_str=field_utils.format.monetary(Math.abs(prop.partial_amount),{},format_options);}}
return this._computeLine(line);},_computeLine:function(line){var self=this;var formatOptions={currency_id:line.st_line.currency_id,};return this._super.apply(this,arguments).then(function(){var amount_currency=0;var total=line.st_line.amount||0;var isOtherCurrencyId=_.uniq(_.pluck(_.reject(line.reconciliation_proposition,'invalid'),'currency_id'));isOtherCurrencyId=(isOtherCurrencyId.length===1&&!total&&isOtherCurrencyId[0]!==formatOptions.currency_id?isOtherCurrencyId[0]:false);_.each(line.reconciliation_proposition,function(prop){if(!prop.invalid){if(prop.partial_reconcile)
total-=prop.partial_amount||prop.amount;else
total-=prop.amount;if(isOtherCurrencyId){amount_currency-=(prop.amount<0?-1:1)*Math.abs(prop.amount_currency);}}});var company_currency=session.get_currency(line.st_line.currency_id);var company_precision=(company_currency&&company_currency.digits[1]||2);total=utils.round_decimals(total,company_precision)||0;if(isOtherCurrencyId){var other_currency=session.get_currency(isOtherCurrencyId);var other_precision=other_currency&&other_currency.digits[1]||2;amount_currency=utils.round_decimals(amount_currency,other_precision);}
line.balance={amount:total,amount_str:field_utils.format.monetary(Math.abs(total),{},formatOptions),currency_id:isOtherCurrencyId,amount_currency:isOtherCurrencyId?amount_currency:total,amount_currency_str:isOtherCurrencyId?field_utils.format.monetary(Math.abs(amount_currency),{},{currency_id:isOtherCurrencyId}):false,account_code:self.accounts[line.st_line.open_balance_account_id],};line.balance.show_balance=line.balance.amount_currency!=0;line.balance.type=line.balance.amount_currency?(line.st_line.partner_id?0:-1):1;});},});model.ManualModel.include({validate:function(handle){var self=this;var handles=[];if(handle){handles=[handle];}else{_.each(this.lines,function(line,handle){if(!line.reconciled&&!line.balance.amount&&line.reconciliation_proposition.length){handles.push(handle);}});}
var def=Promise.resolve();var process_reconciliations=[];var reconciled=[];var context=self.context;_.each(handles,function(handle){var line=self.getLine(handle);if(line.reconciled){return;}
var props=line.reconciliation_proposition;if(!props.length){self.valuenow++;reconciled.push(handle);line.reconciled=true;process_reconciliations.push({id:line.type==='accounts'?line.account_id:line.partner_id,type:line.type,mv_line_ids:[],new_mv_line_dicts:[],});}else{var move_lines={};for(prop in props){var p=props[prop];if(!isNaN(p.id)){move_lines[p.id]=p;}}
context["move_lines"]=move_lines;var mv_line_ids=_.pluck(_.filter(props,function(prop){return!isNaN(prop.id);}),'id');var new_mv_line_dicts=_.map(_.filter(props,function(prop){return isNaN(prop.id)&&prop.display;}),self._formatToProcessReconciliation.bind(self,line));process_reconciliations.push({id:null,type:null,mv_line_ids:mv_line_ids,new_mv_line_dicts:new_mv_line_dicts});}
line.reconciliation_proposition=[];});if(process_reconciliations.length){def=self._rpc({model:'account.reconciliation.widget',method:'process_move_lines',args:[process_reconciliations],context:context});}
return def.then(function(){var defs=[];var account_ids=[];var partner_ids=[];_.each(handles,function(handle){var line=self.getLine(handle);if(line.reconciled){return;}
line.filter_match="";defs.push(self._performMoveLine(handle,'match').then(function(){if(!line.mv_lines_match.length){self.valuenow++;reconciled.push(handle);line.reconciled=true;if(line.type==='accounts'){account_ids.push(line.account_id.id);}else{partner_ids.push(line.partner_id);}}}));});return Promise.all(defs).then(function(){if(partner_ids.length){self._rpc({model:'res.partner',method:'mark_as_reconciled',args:[partner_ids],});}
return{reconciled:reconciled,updated:_.difference(handles,reconciled)};});});},});});